!function(){var __webpack_modules__={3829:function(e,t){!function(e){"use strict";function G(e,t,i){if(i=i||{},!Q(i))throw new Error("options is invalid");var r=i.bbox,n=i.id;if(void 0===e)throw new Error("geometry is required");if(t&&t.constructor!==Object)throw new Error("properties must be an Object");r&&re(r),n&&ne(n);var o={type:"Feature"};return n&&(o.id=n),r&&(o.bbox=r),o.properties=t||{},o.geometry=e,o}function t(e,t,i){if(i=i||{},!Q(i))throw new Error("options is invalid");var r=i.bbox;if(!e)throw new Error("type is required");if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");r&&re(r);var n;switch(e){case"Point":n=z(t).geometry;break;case"LineString":n=W(t).geometry;break;case"Polygon":n=k(t).geometry;break;case"MultiPoint":n=o(t).geometry;break;case"MultiLineString":n=q(t).geometry;break;case"MultiPolygon":n=K(t).geometry;break;default:throw new Error(e+" is invalid")}return r&&(n.bbox=r),n}function z(e,t,i){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ie(e[0])||!ie(e[1]))throw new Error("coordinates must contain numbers");return G({type:"Point",coordinates:e},t,i)}function i(e,t,i){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");return H(e.map(function(e){return z(e,t)}),i)}function k(e,t,i){if(!e)throw new Error("coordinates is required");for(var r=0;r<e.length;r++){var n=e[r];if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var o=0;o<n[n.length-1].length;o++){if(0===r&&0===o&&!ie(n[0][0])||!ie(n[0][1]))throw new Error("coordinates must contain numbers");if(n[n.length-1][o]!==n[0][o])throw new Error("First and last Position are not equivalent.")}}return G({type:"Polygon",coordinates:e},t,i)}function r(e,t,i){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");return H(e.map(function(e){return k(e,t)}),i)}function W(e,t,i){if(!e)throw new Error("coordinates is required");if(e.length<2)throw new Error("coordinates must be an array of two or more positions");if(!ie(e[0][1])||!ie(e[0][1]))throw new Error("coordinates must contain numbers");return G({type:"LineString",coordinates:e},t,i)}function n(e,t,i){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");return H(e.map(function(e){return W(e,t)}),i)}function H(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=t.bbox,r=t.id;if(!e)throw new Error("No features passed");if(!Array.isArray(e))throw new Error("features must be an Array");i&&re(i),r&&ne(r);var n={type:"FeatureCollection"};return r&&(n.id=r),i&&(n.bbox=i),n.features=e,n}function q(e,t,i){if(!e)throw new Error("coordinates is required");return G({type:"MultiLineString",coordinates:e},t,i)}function o(e,t,i){if(!e)throw new Error("coordinates is required");return G({type:"MultiPoint",coordinates:e},t,i)}function K(e,t,i){if(!e)throw new Error("coordinates is required");return G({type:"MultiPolygon",coordinates:e},t,i)}function s(e,t,i){if(!e)throw new Error("geometries is required");if(!Array.isArray(e))throw new Error("geometries must be an Array");return G({type:"GeometryCollection",geometries:e},t,i)}function a(e,t){if(void 0===e||null===e||isNaN(e))throw new Error("num is required");if(t&&!(t>=0))throw new Error("precision must be a positive number");var i=Math.pow(10,t||0);return Math.round(e*i)/i}function j(e,t){if(void 0===e||null===e)throw new Error("radians is required");if(t&&"string"!=typeof t)throw new Error("units must be a string");var i=ps[t||"kilometers"];if(!i)throw new Error(t+" units is invalid");return e*i}function Z(e,t){if(void 0===e||null===e)throw new Error("distance is required");if(t&&"string"!=typeof t)throw new Error("units must be a string");var i=ps[t||"kilometers"];if(!i)throw new Error(t+" units is invalid");return e/i}function Y(e,t){return J(Z(e,t))}function X(e){if(null===e||void 0===e)throw new Error("bearing is required");var t=e%360;return t<0&&(t+=360),t}function J(e){if(null===e||void 0===e)throw new Error("radians is required");return 180*(e%(2*Math.PI))/Math.PI}function $(e){if(null===e||void 0===e)throw new Error("degrees is required");return e%360*Math.PI/180}function ee(e,t,i){if(null===e||void 0===e)throw new Error("length is required");if(!(e>=0))throw new Error("length must be a positive number");return j(Z(e,t),i||"kilometers")}function te(e,t,i){if(null===e||void 0===e)throw new Error("area is required");if(!(e>=0))throw new Error("area must be a positive number");var r=ds[t||"meters"];if(!r)throw new Error("invalid original units");var n=ds[i||"kilometers"];if(!n)throw new Error("invalid final units");return e/r*n}function ie(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function Q(e){return!!e&&e.constructor===Object}function re(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(4!==e.length&&6!==e.length)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(e){if(!ie(e))throw new Error("bbox must only contain numbers")})}function ne(e){if(!e)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof e))throw new Error("id must be a number or a string")}function oe(e,t,i){if(null!==e)for(var r,n,o,s,a,l,u,c,h=0,A=0,p=e.type,f="FeatureCollection"===p,d="Feature"===p,g=f?e.features.length:1,m=0;m<g;m++){a=(c=!!(u=f?e.features[m].geometry:d?e.geometry:e)&&"GeometryCollection"===u.type)?u.geometries.length:1;for(var y=0;y<a;y++){var _=0,v=0;if(null!==(s=c?u.geometries[y]:u)){l=s.coordinates;var C=s.type;switch(h=!i||"Polygon"!==C&&"MultiPolygon"!==C?0:1,C){case null:break;case"Point":t(l,A,m,_,v),A++,_++;break;case"LineString":case"MultiPoint":for(r=0;r<l.length;r++)t(l[r],A,m,_,v),A++,"MultiPoint"===C&&_++;"LineString"===C&&_++;break;case"Polygon":case"MultiLineString":for(r=0;r<l.length;r++){for(n=0;n<l[r].length-h;n++)t(l[r][n],A,m,_,v),A++;"MultiLineString"===C&&_++,"Polygon"===C&&v++}"Polygon"===C&&_++;break;case"MultiPolygon":for(r=0;r<l.length;r++){for("MultiPolygon"===C&&(v=0),n=0;n<l[r].length;n++){for(o=0;o<l[r][n].length-h;o++)t(l[r][n][o],A,m,_,v),A++;v++}_++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)oe(s.geometries[r],t,i);break;default:throw new Error("Unknown Geometry Type")}}}}}function se(e,o,s,t){var a=s;return oe(e,function(e,t,i,r,n){a=0===t&&void 0===s?e:o(a,e,t,i,r,n)},t),a}function ae(e,t){var i;switch(e.type){case"FeatureCollection":for(i=0;i<e.features.length;i++)t(e.features[i].properties,i);break;case"Feature":t(e.properties,0)}}function le(e,i,r){var n=r;return ae(e,function(e,t){n=0===t&&void 0===r?e:i(n,e,t)}),n}function ue(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var i=0;i<e.features.length;i++)t(e.features[i],i)}function ce(e,i,r){var n=r;return ue(e,function(e,t){n=0===t&&void 0===r?e:i(n,e,t)}),n}function he(e){var t=[];return oe(e,function(e){t.push(e)}),t}function Ae(e,t){var i,r,n,o,s,a,l,u,c,h,A=0,p="FeatureCollection"===e.type,f="Feature"===e.type,d=p?e.features.length:1;for(i=0;i<d;i++){for(a=p?e.features[i].geometry:f?e.geometry:e,u=p?e.features[i].properties:f?e.properties:{},c=p?e.features[i].bbox:f?e.bbox:void 0,h=p?e.features[i].id:f?e.id:void 0,s=(l=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,n=0;n<s;n++)if(null!==(o=l?a.geometries[n]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":t(o,A,u,c,h);break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)t(o.geometries[r],A,u,c,h);break;default:throw new Error("Unknown Geometry Type")}else t(null,A,u,c,h);A++}}function pe(e,o,s){var a=s;return Ae(e,function(e,t,i,r,n){a=0===t&&void 0===s?e:o(a,e,t,i,r,n)}),a}function fe(e,a){Ae(e,function(e,i,r,t,n){var o=null===e?null:e.type;switch(o){case null:case"Point":case"LineString":case"Polygon":return void a(G(e,r,{bbox:t,id:n}),i,0)}var s;switch(o){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}e.coordinates.forEach(function(e,t){a(G({type:s,coordinates:e},r),i,t)})})}function de(e,r,n){var o=n;return fe(e,function(e,t,i){o=0===t&&0===i&&void 0===n?e:r(o,e,t,i)}),o}function ge(e,h){fe(e,function(a,l,u){var c=0;if(a.geometry){var e=a.geometry.type;"Point"!==e&&"MultiPoint"!==e&&se(a,function(e,t,i,r,n,o){var s=W([e,t],a.properties);return h(s,l,u,o,c),c++,t})}})}function me(e,o,s){var a=s,l=!1;return ge(e,function(e,t,i,r,n){a=!1===l&&void 0===s?e:o(a,e,t,i,r,n),l=!0}),a}function ye(e,s){if(!e)throw new Error("geojson is required");fe(e,function(e,t,i){if(null!==e.geometry){var r=e.geometry.type,n=e.geometry.coordinates;switch(r){case"LineString":s(e,t,i,0,0);break;case"Polygon":for(var o=0;o<n.length;o++)s(W(n[o],e.properties),t,i,o)}}})}function _e(e,n,o){var s=o;return ye(e,function(e,t,i,r){s=0===t&&void 0===o?e:n(s,e,t,i,r)}),s}function ve(e){var t=[1/0,1/0,-1/0,-1/0];return oe(e,function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])}),t}function Ce(e){if(!e)throw new Error("obj is required");var t=x(e);if(t.length>1&&ie(t[0])&&ie(t[1]))return t;throw new Error("Coordinate is not a valid Point")}function x(e){if(!e)throw new Error("obj is required");var t;if(e.length?t=e:e.coordinates?t=e.coordinates:e.geometry&&e.geometry.coordinates&&(t=e.geometry.coordinates),t)return we(t),t;throw new Error("No valid coordinates")}function we(e){if(e.length>1&&ie(e[0])&&ie(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return we(e[0]);throw new Error("coordinates must only contain numbers")}function xe(e,t,i){if(!t||!i)throw new Error("type and name required");if(!e||e.type!==t)throw new Error("Invalid input to "+i+": must be a "+t+", given "+e.type)}function be(e,t,i){if(!e)throw new Error("No feature passed");if(!i)throw new Error(".featureOf() requires a name");if(!e||"Feature"!==e.type||!e.geometry)throw new Error("Invalid input to "+i+", Feature with geometry required");if(!e.geometry||e.geometry.type!==t)throw new Error("Invalid input to "+i+": must be a "+t+", given "+e.geometry.type)}function Ee(e,t,i){if(!e)throw new Error("No featureCollection passed");if(!i)throw new Error(".collectionOf() requires a name");if(!e||"FeatureCollection"!==e.type)throw new Error("Invalid input to "+i+", FeatureCollection required");for(var r=0;r<e.features.length;r++){var n=e.features[r];if(!n||"Feature"!==n.type||!n.geometry)throw new Error("Invalid input to "+i+", Feature with geometry required");if(!n.geometry||n.geometry.type!==t)throw new Error("Invalid input to "+i+": must be a "+t+", given "+n.geometry.type)}}function Be(e){if(!e)throw new Error("geojson is required");if(void 0!==e.geometry)return e.geometry;if(e.coordinates||e.geometries)return e;throw new Error("geojson must be a valid Feature or Geometry Object")}function Me(){throw new Error("invariant.getGeomType has been deprecated in v5.0 in favor of invariant.getType")}function Ie(e,t){if(!e)throw new Error((t||"geojson")+" is required");if(e.geometry&&e.geometry.type)return e.geometry.type;if(e.type)return e.type;throw new Error((t||"geojson")+" is invalid")}function Se(e,t,i){i=i||{};for(var r=Object.keys(_s),n=0;n<r.length;n++){var o=r[n],s=i[o];s=void 0!==s&&null!==s?s:_s[o],vs[o]=s}vs.verbose&&console.log("MarchingSquaresJS-isoContours: computing isocontour for "+t);var a=function(u){var c=[],h=0;u.rows,u.cols;return u.cells.forEach(function(e,l){e.forEach(function(e,t){if(void 0!==e&&!function(e){return 5===e.cval||10===e.cval}(e)&&!Te(e)){var i=function(e,t,i){var r,n,o,s=e.length,a=[],l=[0,0,1,1,0,0,0,0,-1,0,1,1,-1,0,-1,0],u=[0,-1,0,0,1,1,1,1,0,-1,0,0,0,-1,0,0],c=["none","bottom","right","right","top","top","top","top","left","bottom","right","right","left","bottom","left","none"],h=(e[t][i],e[t][i]),A=h.cval,p=De(h,o=["none","left","bottom","left","right","none","bottom","left","top","top","none","top","right","right","bottom","none"][A]);a.push([i+p[0],t+p[1]]),p=De(h,o=c[A]),a.push([i+p[0],t+p[1]]),Le(h);for(var f=i+l[A],d=t+u[A],g=A;f>=0&&d>=0&&d<s&&(f!=i||d!=t)&&void 0!==(h=e[d][f]);){if(0===(A=h.cval)||15===A)return{path:a,info:"mergeable"};o=c[A],r=l[A],n=u[A],5!==A&&10!==A||(5===A?h.flipped?-1===u[g]?(o="left",r=-1,n=0):(o="right",r=1,n=0):-1===l[g]&&(o="bottom",r=0,n=-1):10===A&&(h.flipped?-1===l[g]?(o="top",r=0,n=1):(o="bottom",r=0,n=-1):1===u[g]&&(o="left",r=-1,n=0))),p=De(h,o),a.push([f+p[0],d+p[1]]),Le(h),f+=r,d+=n,g=A}return{path:a,info:"closed"}}(u.cells,l,t),r=!1;if("mergeable"===i.info)for(var n=i.path[i.path.length-1][0],o=i.path[i.path.length-1][1],s=h-1;s>=0;s--)if(Math.abs(c[s][0][0]-n)<=1e-7&&Math.abs(c[s][0][1]-o)<=1e-7){for(var a=i.path.length-2;a>=0;--a)c[s].unshift(i.path[a]);r=!0;break}r||(c[h++]=i.path)}})}),c}(function(e,t){for(var i=e.length-1,r=e[0].length-1,n={rows:i,cols:r,cells:[]},o=0;o<i;++o){n.cells[o]=[];for(var s=0;s<r;++s){var a=0,l=e[o+1][s],u=e[o+1][s+1],c=e[o][s+1],h=e[o][s];if(!(isNaN(l)||isNaN(u)||isNaN(c)||isNaN(h))){a|=l>=t?8:0,a|=u>=t?4:0,a|=c>=t?2:0;var A=!1;if(5===(a|=h>=t?1:0)||10===a){var p=(l+u+c+h)/4;5===a&&p<t?(a=10,A=!0):10===a&&p<t&&(a=5,A=!0)}if(0!==a&&15!==a){var f,d,g,m;f=d=g=m=.5,1===a?(g=1-Pe(t,l,h),d=1-Pe(t,c,h)):2===a?(d=Pe(t,h,c),m=1-Pe(t,u,c)):3===a?(g=1-Pe(t,l,h),m=1-Pe(t,u,c)):4===a?(f=Pe(t,l,u),m=Pe(t,c,u)):5===a?(f=Pe(t,l,u),m=Pe(t,c,u),d=1-Pe(t,c,h),g=1-Pe(t,l,h)):6===a?(d=Pe(t,h,c),f=Pe(t,l,u)):7===a?(g=1-Pe(t,l,h),f=Pe(t,l,u)):8===a?(g=Pe(t,h,l),f=1-Pe(t,u,l)):9===a?(d=1-Pe(t,c,h),f=1-Pe(t,u,l)):10===a?(f=1-Pe(t,u,l),m=1-Pe(t,u,c),d=Pe(t,h,c),g=Pe(t,h,l)):11===a?(f=1-Pe(t,u,l),m=1-Pe(t,u,c)):12===a?(g=Pe(t,h,l),m=Pe(t,c,u)):13===a?(d=1-Pe(t,c,h),m=Pe(t,c,u)):14===a?(g=Pe(t,h,l),d=Pe(t,h,c)):console.log("MarchingSquaresJS-isoContours: Illegal cval detected: "+a),n.cells[o][s]={cval:a,flipped:A,top:f,right:m,bottom:d,left:g}}}}}return n}(e,t));return"function"==typeof vs.successCallback&&vs.successCallback(a),a}function Pe(e,t,i){return(e-t)/(i-t)}function Te(e){return 0===e.cval||15===e.cval}function Le(e){Te(e)||5===e.cval||10===e.cval||(e.cval=15)}function De(e,t){return"top"===t?[e.top,1]:"bottom"===t?[e.bottom,0]:"right"===t?[1,e.right]:"left"===t?[0,e.left]:void 0}function Fe(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=t.zProperty||"elevation",r=t.flip,n=t.flags;Ee(e,"Point","input must contain Points");for(var o=function(e,i){var r={};ue(e,function(e){var t=x(e)[1];r[t]||(r[t]=[]),r[t].push(e)});return Object.keys(r).map(function(e){var t=r[e],i=t.sort(function(e,t){return x(e)[0]-x(t)[0]});return i}).sort(function(e,t){return i?x(e[0])[1]-x(t[0])[1]:x(t[0])[1]-x(e[0])[1]})}(e,r),s=[],a=0;a<o.length;a++){for(var l=o[a],u=[],c=0;c<l.length;c++){var h=l[c];h.properties[i]?u.push(h.properties[i]):u.push(0),!0===n&&(h.properties.matrixPosition=[a,c])}s.push(u)}return s}function Ne(e,t,i,r,n){for(i=i||0,r=r||e.length-1,n=n||function(e,t){return e<t?-1:e>t?1:0};r>i;){if(r-i>600){var o=r-i+1,s=t-i+1,a=Math.log(o),l=.5*Math.exp(2*a/3),u=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);Ne(e,t,Math.max(i,Math.floor(t-s*l/o+u)),Math.min(r,Math.floor(t+(o-s)*l/o+u)),n)}var c=e[t],h=i,A=r;for(Oe(e,i,t),n(e[r],c)>0&&Oe(e,i,r);h<A;){for(Oe(e,h,A),h++,A--;n(e[h],c)<0;)h++;for(;n(e[A],c)>0;)A--}0===n(e[i],c)?Oe(e,i,A):Oe(e,++A,r),A<=t&&(i=A+1),t<=A&&(r=A-1)}}function Oe(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function Re(e,t){if(!(this instanceof Re))return new Re(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&this._initFormat(t),this.clear()}function Ue(e,t){ke(e,0,e.children.length,t,e)}function ke(e,t,i,r,n){n||(n=Ke(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var o,s=t;s<i;s++)o=e.children[s],He(n,e.leaf?r(o):o);return n}function He(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function Qe(e,t){return e.minX-t.minX}function Ve(e,t){return e.minY-t.minY}function Ge(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function ze(e){return e.maxX-e.minX+(e.maxY-e.minY)}function We(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function qe(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function Ke(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function je(e,t,i,r,n){for(var o,s=[t,i];s.length;)(i=s.pop())-(t=s.pop())<=r||(o=t+Math.ceil((i-t)/r/2)*r,Cs(e,o,t,i,n),s.push(t,o,o,i))}function Ze(e,t){return t={exports:{}},e(t,t.exports),t.exports}function Ye(e,t){if(!(this instanceof Ye))return new Ye(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||function(e,t){return e<t?-1:e>t?1:0},this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function Xe(e,t,i){t=Math.max(0,void 0===t?2:t),i=i||0;for(var r,n=function(e){for(var t=e[0],i=e[0],r=e[0],n=e[0],o=0;o<e.length;o++){var s=e[o];s[0]<t[0]&&(t=s),s[0]>r[0]&&(r=s),s[1]<i[1]&&(i=s),s[1]>n[1]&&(n=s)}var a=[t,i,r,n],l=a.slice();for(o=0;o<e.length;o++)Fs(e[o],a)||l.push(e[o]);var u=Ps(l),c=[];for(o=0;o<u.length;o++)c.push(l[u[o]]);return c}(e),o=ws(16,["[0]","[1]","[0]","[1]"]).load(e),s=[],a=0;a<n.length;a++){var l=n[a];o.remove(l),r=it(l,r),s.push(r)}var u=ws(16);for(a=0;a<s.length;a++)u.insert(tt(s[a]));for(var c=t*t,h=i*i;s.length;){var A=s.shift(),p=A.p,f=A.next.p,d=rt(p,f);if(!(d<h)){var g=d/c;(l=function(e,t,i,r,n,o,s){var a=new Ls(null,Je),l=e.data;for(;l;){for(var u=0;u<l.children.length;u++){var c=l.children[u],h=l.leaf?nt(c,i,r):function(e,t,i){if($e(e,i)||$e(t,i))return 0;var r=ot(e[0],e[1],t[0],t[1],i.minX,i.minY,i.maxX,i.minY);if(0===r)return 0;var n=ot(e[0],e[1],t[0],t[1],i.minX,i.minY,i.minX,i.maxY);if(0===n)return 0;var o=ot(e[0],e[1],t[0],t[1],i.maxX,i.minY,i.maxX,i.maxY);if(0===o)return 0;var s=ot(e[0],e[1],t[0],t[1],i.minX,i.maxY,i.maxX,i.maxY);return 0===s?0:Math.min(r,n,o,s)}(i,r,c);h>o||a.push({node:c,dist:h})}for(;a.length&&!a.peek().node.children;){var A=a.pop(),p=A.node,f=nt(p,t,i),d=nt(p,r,n);if(A.dist<f&&A.dist<d&&et(i,p,s)&&et(r,p,s))return p}(l=a.pop())&&(l=l.node)}return null}(o,A.prev.p,p,f,A.next.next.p,g,u))&&Math.min(rt(l,p),rt(l,f))<=g&&(s.push(A),s.push(it(l,A)),o.remove(l),u.remove(A),u.insert(tt(A)),u.insert(tt(A.next)))}}A=r;var m=[];do{m.push(A.p),A=A.next}while(A!==r);return m.push(A.p),m}function Je(e,t){return e.dist-t.dist}function $e(e,t){return e[0]>=t.minX&&e[0]<=t.maxX&&e[1]>=t.minY&&e[1]<=t.maxY}function et(e,t,i){for(var r=Math.min(e[0],t[0]),n=Math.min(e[1],t[1]),o=Math.max(e[0],t[0]),s=Math.max(e[1],t[1]),a=i.search({minX:r,minY:n,maxX:o,maxY:s}),l=0;l<a.length;l++)if(function(e,t,i,r){return e!==r&&t!==i&&Ns(e,t,i)>0!=Ns(e,t,r)>0&&Ns(i,r,e)>0!=Ns(i,r,t)>0}(a[l].p,a[l].next.p,e,t))return!1;return!0}function tt(e){var t=e.p,i=e.next.p;return e.minX=Math.min(t[0],i[0]),e.minY=Math.min(t[1],i[1]),e.maxX=Math.max(t[0],i[0]),e.maxY=Math.max(t[1],i[1]),e}function it(e,t){var i={p:e,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return t?(i.next=t.next,i.prev=t,t.next.prev=i,t.next=i):(i.prev=i,i.next=i),i}function rt(e,t){var i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function nt(e,t,i){var r=t[0],n=t[1],o=i[0]-r,s=i[1]-n;if(0!==o||0!==s){var a=((e[0]-r)*o+(e[1]-n)*s)/(o*o+s*s);a>1?(r=i[0],n=i[1]):a>0&&(r+=o*a,n+=s*a)}return o=e[0]-r,s=e[1]-n,o*o+s*s}function ot(e,t,i,r,n,o,s,a){var l,u,c,h,A=i-e,p=r-t,f=s-n,d=a-o,g=e-n,m=t-o,y=A*A+p*p,_=A*f+p*d,v=f*f+d*d,C=A*g+p*m,w=f*g+d*m,x=y*v-_*_,b=x,E=x;0===x?(u=0,b=1,h=w,E=v):(h=y*w-_*C,(u=_*w-v*C)<0?(u=0,h=w,E=v):u>b&&(u=b,h=w+_,E=v)),h<0?(h=0,-C<0?u=0:-C>y?u=b:(u=-C,b=y)):h>E&&(h=E,-C+_<0?u=0:-C+_>y?u=b:(u=-C+_,b=y)),l=0===u?0:u/b;var B=(1-(c=0===h?0:h/E))*n+c*s-((1-l)*e+l*i),M=(1-c)*o+c*a-((1-l)*t+l*r);return B*B+M*M}function st(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=t.concavity||1/0,r=[];if(oe(e,function(e){r.push([e[0],e[1]])}),!r.length)return null;var n=Os(r,i);return n.length>3?k([n]):null}function at(e,t,i){if("object"!=typeof(i=i||{}))throw new Error("options is invalid");var r=i.ignoreBoundary;if(!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var n=Ce(e),o=x(t),s=t.geometry?t.geometry.type:t.type,a=t.bbox;if(a&&!1===function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(n,a))return!1;"Polygon"===s&&(o=[o]);for(var l=0,u=!1;l<o.length&&!u;l++)if(lt(n,o[l][0],r)){for(var c=!1,h=1;h<o[l].length&&!c;)lt(n,o[l][h],!r)&&(c=!0),h++;c||(u=!0)}return u}function lt(e,t,i){var r=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var n=0,o=t.length-1;n<t.length;o=n++){var s=t[n][0],a=t[n][1],l=t[o][0],u=t[o][1];if(e[1]*(s-l)+a*(l-e[0])+u*(e[0]-s)==0&&(s-e[0])*(l-e[0])<=0&&(a-e[1])*(u-e[1])<=0)return!i;a>e[1]!=u>e[1]&&e[0]<(l-s)*(e[1]-a)/(u-a)+s&&(r=!r)}return r}function ut(e,t){var i=[];return Ae(t,function(t){ue(e,function(e){at(e,t)&&i.push(e)})}),H(i)}function ct(e,i){if("FeatureCollection"!==e.type)throw new Error("points must be a FeatureCollection");var o=!1;return H(function(e){if(e.length<3)return[];e.sort(At);var t,i,r,n,o,s,a=e.length-1,l=e[a].x,u=e[0].x,c=e[a].y,h=c;for(;a--;)e[a].y<c&&(c=e[a].y),e[a].y>h&&(h=e[a].y);var A,p=u-l,f=h-c,d=p>f?p:f,g=.5*(u+l),m=.5*(h+c),y=[new ht({x:g-20*d,y:m-d,__sentinel:!0},{x:g,y:m+20*d,__sentinel:!0},{x:g+20*d,y:m-d,__sentinel:!0})],_=[],v=[];a=e.length;for(;a--;){for(v.length=0,A=y.length;A--;)(p=e[a].x-y[A].x)>0&&p*p>y[A].r?(_.push(y[A]),y.splice(A,1)):(f=e[a].y-y[A].y,p*p+f*f>y[A].r||(v.push(y[A].a,y[A].b,y[A].b,y[A].c,y[A].c,y[A].a),y.splice(A,1)));for(pt(v),A=v.length;A;)i=v[--A],t=v[--A],r=e[a],n=i.x-t.x,o=i.y-t.y,s=2*(n*(r.y-i.y)-o*(r.x-i.x)),Math.abs(s)>1e-12&&y.push(new ht(t,i,r))}Array.prototype.push.apply(_,y),a=_.length;for(;a--;)(_[a].a.__sentinel||_[a].b.__sentinel||_[a].c.__sentinel)&&_.splice(a,1);return _}(e.features.map(function(e){var t={x:e.geometry.coordinates[0],y:e.geometry.coordinates[1]};return i?t.z=e.properties[i]:3===e.geometry.coordinates.length&&(o=!0,t.z=e.geometry.coordinates[2]),t})).map(function(e){var t=[e.a.x,e.a.y],i=[e.b.x,e.b.y],r=[e.c.x,e.c.y],n={};return o?(t.push(e.a.z),i.push(e.b.z),r.push(e.c.z)):n={a:e.a.z,b:e.b.z,c:e.c.z},k([[t,i,r,t]],n)}))}function ht(e,t,i){this.a=e,this.b=t,this.c=i;var r,n,o=t.x-e.x,s=t.y-e.y,a=i.x-e.x,l=i.y-e.y,u=o*(e.x+t.x)+s*(e.y+t.y),c=a*(e.x+i.x)+l*(e.y+i.y),h=2*(o*(i.y-t.y)-s*(i.x-t.x));this.x=(l*u-s*c)/h,this.y=(o*c-a*u)/h,r=this.x-e.x,n=this.y-e.y,this.r=r*r+n*n}function At(e,t){return t.x-e.x}function pt(e){var t,i,r,n,o,s=e.length;e:for(;s;)for(i=e[--s],t=e[--s],r=s;r;)if(o=e[--r],n=e[--r],t===n&&i===o||t===o&&i===n){e.splice(s,2),e.splice(r,2),s-=2;continue e}}function ft(e,t,i){if(i=i||{},!Q(i))throw new Error("options is invalid");var r=i.units,n=Ce(e),o=Ce(t),s=$(o[1]-n[1]),a=$(o[0]-n[0]),l=$(n[1]),u=$(o[1]),c=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(l)*Math.cos(u);return j(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),r)}function dt(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return gt(e);case"FeatureCollection":return function(t){var i={type:"FeatureCollection"};return Object.keys(t).forEach(function(e){switch(e){case"type":case"features":return;default:i[e]=t[e]}}),i.features=t.features.map(function(e){return gt(e)}),i}(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return yt(e);default:throw new Error("unknown GeoJSON type")}}function gt(t){var i={type:"Feature"};return Object.keys(t).forEach(function(e){switch(e){case"type":case"properties":case"geometry":return;default:i[e]=t[e]}}),i.properties=mt(t.properties),i.geometry=yt(t.geometry),i}function mt(i){var r={};return i?(Object.keys(i).forEach(function(e){var t=i[e];"object"==typeof t?null===t?r[e]=null:t.length?r[e]=t.map(function(e){return e}):r[e]=mt(t):r[e]=t}),r):r}function yt(e){var t={type:e.type};return e.bbox&&(t.bbox=e.bbox),"GeometryCollection"===e.type?(t.geometries=e.geometries.map(function(e){return yt(e)}),t):(t.coordinates=_t(e.coordinates),t)}function _t(e){return"object"!=typeof e[0]?e.slice():e.map(function(e){return _t(e)})}function vt(e,t){function n(e,t){t.length&&t.pop();for(var i=u[e<0?~e:e],r=0,n=i.length;r<n;++r)t.push(l(i[r],r));e<0&&Hs(t,n)}function r(e){return l(e)}function o(e){for(var t=[],i=0,r=e.length;i<r;++i)n(e[i],t);return t.length<2&&t.push(t[0]),t}function i(e){for(var t=o(e);t.length<4;)t.push(t[0]);return t}function s(e){return e.map(i)}function a(e){var t,i=e.type;switch(i){case"GeometryCollection":return{type:i,geometries:e.geometries.map(a)};case"Point":t=r(e.coordinates);break;case"MultiPoint":t=e.coordinates.map(r);break;case"LineString":t=o(e.arcs);break;case"MultiLineString":t=e.arcs.map(o);break;case"Polygon":t=s(e.arcs);break;case"MultiPolygon":t=e.arcs.map(s);break;default:return null}return{type:i,coordinates:t}}var l=ks(e.transform),u=e.arcs;return a(t)}function Ct(a,e){function t(e){switch(e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"Polygon":i(e.arcs);break;case"MultiPolygon":e.arcs.forEach(i)}}function i(t){t.forEach(function(e){e.forEach(function(e){(u[e=e<0?~e:e]||(u[e]=[])).push(t)})}),r.push(t)}function l(e){return function(e){for(var t,i=-1,r=e.length,n=e[r-1],o=0;++i<r;)t=n,n=e[i],o+=t[0]*n[1]-t[1]*n[0];return Math.abs(o)}(vt(a,{type:"Polygon",arcs:[e]}).coordinates[0])}var u={},r=[],n=[];return e.forEach(t),r.forEach(function(e){if(!e._){var t=[],i=[e];for(e._=1,n.push(t);e=i.pop();)t.push(e),e.forEach(function(e){e.forEach(function(e){u[e<0?~e:e].forEach(function(e){e._||(e._=1,i.push(e))})})})}}),r.forEach(function(e){delete e._}),{type:"MultiPolygon",arcs:n.map(function(e){var t,i=[];if(e.forEach(function(e){e.forEach(function(e){e.forEach(function(e){u[e<0?~e:e].length<2&&i.push(e)})})}),i=Qs(a,i),(t=i.length)>1)for(var r,n,o=1,s=l(i[0]);o<t;++o)(r=l(i[o]))>s&&(n=i[0],i[0]=i[o],i[o]=n,s=r);return i})}}function wt(e,t,i){for(var r,n=t+(i---t>>1);t<n;++t,--i)r=e[t],e[t]=e[i],e[i]=r}function xt(e){return null==e?{type:null}:("FeatureCollection"===e.type?function(e){var t={type:"GeometryCollection",geometries:e.features.map(bt)};null!=e.bbox&&(t.bbox=e.bbox);return t}:"Feature"===e.type?bt:Et)(e)}function bt(e){var t,i=Et(e.geometry);null!=e.id&&(i.id=e.id),null!=e.bbox&&(i.bbox=e.bbox);for(t in e.properties){i.properties=e.properties;break}return i}function Et(e){if(null==e)return{type:null};var t="GeometryCollection"===e.type?{type:"GeometryCollection",geometries:e.geometries.map(Et)}:"Point"===e.type||"MultiPoint"===e.type?{type:e.type,coordinates:e.coordinates}:{type:e.type,arcs:e.coordinates};return null!=e.bbox&&(t.bbox=e.bbox),t}function Bt(e){var t,i=e[0],r=e[1];return r<i&&(t=i,i=r,r=t),i+31*r}function Mt(e,t){var i,r=e[0],n=e[1],o=t[0],s=t[1];return n<r&&(i=r,r=n,n=i),s<o&&(i=o,o=s,s=i),r===o&&n===s}function It(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=t.mutate;if("FeatureCollection"!==Ie(e))throw new Error("geojson must be a FeatureCollection");if(!e.features.length)throw new Error("geojson is empty");!1!==i&&void 0!==i||(e=dt(e));var r=[],n=_e(e,function(e,t){var i=function(e,t){var i,r=e.geometry.coordinates,n=t.geometry.coordinates,o=St(r[0]),s=St(r[r.length-1]),a=St(n[0]),l=St(n[n.length-1]);if(o===l)i=n.concat(r.slice(1));else if(a===s)i=r.concat(n.slice(1));else if(o===a)i=r.slice(1).reverse().concat(n);else{if(s!==l)return null;i=r.concat(n.reverse().slice(1))}return W(i)}(e,t);return i||(r.push(e),t)});return n&&r.push(n),r.length?1===r.length?r[0]:q(r.map(function(e){return e.coordinates})):null}function St(e){return e[0].toString()+","+e[1].toString()}function Pt(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=t.mutate;if("FeatureCollection"!==Ie(e))throw new Error("geojson must be a FeatureCollection");if(!e.features.length)throw new Error("geojson is empty");!1!==i&&void 0!==i||(e=dt(e));var r=function(e){var t={};fe(e,function(e){t[e.geometry.type]=!0});var i=Object.keys(t);return 1===i.length?i[0]:null}(e);if(!r)throw new Error("geojson must be homogenous");switch(r){case"LineString":return It(e,t);case"Polygon":return function(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=t.mutate;if("FeatureCollection"!==Ie(e))throw new Error("geojson must be a FeatureCollection");if(!e.features.length)throw new Error("geojson is empty");!1!==i&&void 0!==i||(e=dt(e));var r=[];fe(e,function(e){r.push(e.geometry)});var n=Js({geoms:s(r).geometry});return Vs(n,n.objects.geoms.geometries)}(e,t);default:throw new Error(r+" is not supported")}}function Tt(e,t){var i="object"==typeof t?t.mutate:t;if(!e)throw new Error("geojson is required");var r=Ie(e),n=[];switch(r){case"LineString":n=Lt(e);break;case"MultiLineString":case"Polygon":x(e).forEach(function(e){n.push(Lt(e))});break;case"MultiPolygon":x(e).forEach(function(e){var t=[];e.forEach(function(e){t.push(Lt(e))}),n.push(t)});break;case"Point":return e;case"MultiPoint":var o={};x(e).forEach(function(e){var t=e.join("-");o.hasOwnProperty(t)||(n.push(e),o[t]=!0)});break;default:throw new Error(r+" geometry not supported")}return e.coordinates?!0===i?(e.coordinates=n,e):{type:r,coordinates:n}:!0===i?(e.geometry.coordinates=n,e):G({type:r,coordinates:n},e.properties,e.bbox,e.id)}function Lt(e){var t=x(e);if(2===t.length&&!function(e,t){return e[0]===t[0]&&e[1]===t[1]}(t[0],t[1]))return t;var i,r,n,o=[],s=t.length-1;o.push(t[0]);for(var a=1;a<s;a++)i=t[a-1],r=t[a],function(e,t,i){var r=i[0],n=i[1],o=e[0],s=e[1],a=t[0],l=t[1],u=a-o,c=l-s;return(r-o)*c-(n-s)*u==0&&(Math.abs(u)>=Math.abs(c)?u>0?o<=r&&r<=a:a<=r&&r<=o:c>0?s<=n&&n<=l:l<=n&&n<=s)}(i,n=t[a+1],r)||o.push(r);return o.push(n),o}function Dt(e,t){var i=e.x-t.x,r=e.y-t.y;return i*i+r*r}function Ft(e,t,i){var r=t.x,n=t.y,o=i.x-r,s=i.y-n;if(0!==o||0!==s){var a=((e.x-r)*o+(e.y-n)*s)/(o*o+s*s);a>1?(r=i.x,n=i.y):a>0&&(r+=o*a,n+=s*a)}return o=e.x-r,s=e.y-n,o*o+s*s}function Nt(e,t,i,r,n){for(var o,s=r,a=t+1;a<i;a++){var l=Ft(e[a],e[t],e[i]);l>s&&(o=a,s=l)}s>r&&(o-t>1&&Nt(e,t,o,r,n),n.push(e[o]),i-o>1&&Nt(e,o,i,r,n))}function Ot(e,t,i){if(e.length<=2)return e;var r=void 0!==t?t*t:1;return e=i?e:function(e,t){for(var i,r=e[0],n=[r],o=1,s=e.length;o<s;o++)Dt(i=e[o],r)>t&&(n.push(i),r=i);return r!==i&&n.push(i),n}(e,r),e=function(e,t){var i=e.length-1,r=[e[0]];return Nt(e,0,i,t,r),r.push(e[i]),r}(e,r)}function Rt(e,t,i){return Ot(e.map(function(e){return{x:e[0],y:e[1],z:e[2]}}),t,i).map(function(e){return e.z?[e.x,e.y,e.z]:[e.x,e.y]})}function Ut(e,r,n){return e.map(function(e){var t=e.map(function(e){return{x:e[0],y:e[1]}});if(t.length<4)throw new Error("invalid polygon");for(var i=Ot(t,r,n).map(function(e){return[e.x,e.y]});!function(e){return!(e.length<3||3===e.length&&e[2][0]===e[0][0]&&e[2][1]===e[0][1])}(i);)i=Ot(t,r-=.01*r,n).map(function(e){return[e.x,e.y]});return i[i.length-1][0]===i[0][0]&&i[i.length-1][1]===i[0][1]||i.push(i[0]),i})}function kt(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=t.resolution||1e4,r=t.sharpness||.85;if(!e)throw new Error("line is required");if(!ie(i))throw new Error("resolution must be an number");if(!ie(r))throw new Error("sharpness must be an number");for(var n=[],o=new $s({points:Be(e).coordinates.map(function(e){return{x:e[0],y:e[1]}}),duration:i,sharpness:r}),s=0;s<o.duration;s+=10){var a=o.pos(s);Math.floor(s/100)%2==0&&n.push([a.x,a.y])}return W(n,e.properties)}function Ht(e){re(e);var t=Number(e[0]),i=Number(e[1]),r=Number(e[2]),n=Number(e[3]);if(6===e.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var o=[t,i];return k([[o,[r,i],[r,n],[t,n],o]])}function Qt(e){return Ht(ve(e))}function Vt(e){var t=e[0],i=e[1],r=e[2],n=e[3];if(ft(e.slice(0,2),[r,i])>=ft(e.slice(0,2),[t,n])){var o=(i+n)/2;return[t,o-(r-t)/2,r,o+(r-t)/2]}var s=(t+r)/2;return[s-(n-i)/2,i,s+(n-i)/2,n]}function Gt(e,t,i,r){if(r=r||{},!Q(r))throw new Error("options is invalid");var n=r.units,o=r.properties,s=Ce(e),a=$(s[0]),l=$(s[1]),u=$(i),c=Z(t,n),h=Math.asin(Math.sin(l)*Math.cos(c)+Math.cos(l)*Math.sin(c)*Math.cos(u));return z([J(a+Math.atan2(Math.sin(u)*Math.sin(c)*Math.cos(l),Math.cos(c)-Math.sin(l)*Math.sin(h))),J(h)],o)}function zt(e,t,i){var r=(i=i||{}).steps||64,n=i.properties;if(!e)throw new Error("center is required");if(!t)throw new Error("radius is required");if("object"!=typeof i)throw new Error("options must be an object");if("number"!=typeof r)throw new Error("steps must be a number");r=r||64,n=n||e.properties||{};for(var o=[],s=0;s<r;s++)o.push(Gt(e,t,-360*s/r,i).geometry.coordinates);return o.push(o[0]),k([o],n)}function Wt(e,t,i){if(i=i||{},!Q(i))throw new Error("options is invalid");if(!0===i.final)return function(e,t){var i=Wt(t,e);return i=(i+180)%360}(e,t);var r=Ce(e),n=Ce(t),o=$(r[0]),s=$(n[0]),a=$(r[1]),l=$(n[1]),u=Math.sin(s-o)*Math.cos(l),c=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return J(Math.atan2(u,c))}function qt(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=t.properties;if(!e)throw new Error("geojson is required");var r=ve(e);return z([(r[0]+r[2])/2,(r[1]+r[3])/2],i)}function Kt(e,t){var i=0,r=0,n=0;return oe(e,function(e){i+=e[0],r+=e[1],n++},!0),z([i/n,r/n],t)}function jt(e,t){switch(Ie(e)){case"Point":return e;case"Polygon":var i=[];oe(e,function(e){i.push(e)});var r,n,o,s,a,l,u,c,h=Kt(e,t),A=h.geometry.coordinates,p=0,f=0,d=0,g=i.map(function(e){return[e[0]-A[0],e[1]-A[1]]});for(r=0;r<i.length-1;r++)s=(n=g[r])[0],l=n[1],a=(o=g[r+1])[0],d+=c=s*(u=o[1])-a*l,p+=(s+a)*c,f+=(l+u)*c;if(0===d)return h;var m=1/(6*(.5*d));return z([A[0]+m*p,A[1]+m*f],t);default:var y=st(e);return y?jt(y,t):Kt(e,t)}}function Zt(t){var i=[];return"FeatureCollection"===t.type?ue(t,function(t){oe(t,function(e){i.push(z(e,t.properties))})}):oe(t,function(e){i.push(z(e,t.properties))}),H(i)}function Yt(e,t,i){i=i||2;var r=t&&t.length,n=r?t[0]*i:e.length,o=Xt(e,0,n,i,!0),s=[];if(!o)return s;var a,l,u,c,h,A,p;if(r&&(o=function(e,t,i,r){var n,o,s,a,l,u=[];for(n=0,o=t.length;n<o;n++)s=t[n]*r,a=n<o-1?t[n+1]*r:e.length,(l=Xt(e,s,a,r,!1))===l.next&&(l.steiner=!0),u.push(function(e){var t=e,i=e;do{t.x<i.x&&(i=t),t=t.next}while(t!==e);return i}(l));for(u.sort(ei),n=0;n<u.length;n++)!function(e,t){if(t=function(e,t){var i,r=t,n=e.x,o=e.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s){if(s=a,a===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===s)return i.prev;var l,u=i,c=i.x,h=i.y,A=1/0;for(r=i.next;r!==u;)n>=r.x&&r.x>=c&&n!==r.x&&ii(o<h?n:s,o,c,h,o<h?s:n,o,r.x,r.y)&&((l=Math.abs(o-r.y)/(n-r.x))<A||l===A&&r.x>i.x)&&si(r,e)&&(i=r,A=l),r=r.next;return i}(e,t)){var i=ai(t,e);Jt(i,i.next)}}(u[n],i),i=Jt(i,i.next);return i}(e,t,o,i)),e.length>80*i){a=u=e[0],l=c=e[1];for(var f=i;f<n;f+=i)h=e[f],A=e[f+1],h<a&&(a=h),A<l&&(l=A),h>u&&(u=h),A>c&&(c=A);p=0!==(p=Math.max(u-a,c-l))?1/p:0}return $t(o,s,i,a,l,p),s}function Xt(e,t,i,r,n){var o,s;if(n===hi(e,t,i,r)>0)for(o=t;o<i;o+=r)s=li(o,e[o],e[o+1],s);else for(o=i-r;o>=t;o-=r)s=li(o,e[o],e[o+1],s);return s&&ni(s,s.next)&&(ui(s),s=s.next),s}function Jt(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!ni(r,r.next)&&0!==ri(r.prev,r,r.next))r=r.next;else{if(ui(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function $t(e,t,i,r,n,o,s){if(e){!s&&o&&function(e,t,i,r){var n=e;do{null===n.z&&(n.z=ti(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,o,s,a,l,u=1;do{for(i=e,e=null,o=null,s=0;i;){for(s++,r=i,a=0,t=0;t<u&&(a++,r=r.nextZ);t++);for(l=u;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,u*=2}while(s>1)}(n)}(e,r,n,o);for(var a,l,u=e;e.prev!==e.next;)if(a=e.prev,l=e.next,o?function(e,t,i,r){var n=e.prev,o=e,s=e.next;if(ri(n,o,s)>=0)return!1;var a=n.x<o.x?n.x<s.x?n.x:s.x:o.x<s.x?o.x:s.x,l=n.y<o.y?n.y<s.y?n.y:s.y:o.y<s.y?o.y:s.y,u=n.x>o.x?n.x>s.x?n.x:s.x:o.x>s.x?o.x:s.x,c=n.y>o.y?n.y>s.y?n.y:s.y:o.y>s.y?o.y:s.y,h=ti(a,l,t,i,r),A=ti(u,c,t,i,r),p=e.nextZ;for(;p&&p.z<=A;){if(p!==e.prev&&p!==e.next&&ii(n.x,n.y,o.x,o.y,s.x,s.y,p.x,p.y)&&ri(p.prev,p,p.next)>=0)return!1;p=p.nextZ}p=e.prevZ;for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&ii(n.x,n.y,o.x,o.y,s.x,s.y,p.x,p.y)&&ri(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}(e,r,n,o):function(e){var t=e.prev,i=e,r=e.next;if(ri(t,i,r)>=0)return!1;var n=e.next.next;for(;n!==e.prev;){if(ii(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&ri(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}(e))t.push(a.i/i),t.push(e.i/i),t.push(l.i/i),ui(e),e=l.next,u=l.next;else if((e=l)===u){s?1===s?$t(e=function(e,t,i){var r=e;do{var n=r.prev,o=r.next.next;!ni(n,o)&&oi(n,r,r.next,o)&&si(n,o)&&si(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),ui(r),ui(r.next),r=e=o),r=r.next}while(r!==e);return r}(e,t,i),t,i,r,n,o,2):2===s&&function(e,t,i,r,n,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&function(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&oi(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&si(e,t)&&si(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)}(s,a)){var l=ai(s,a);return s=Jt(s,s.next),l=Jt(l,l.next),$t(s,t,i,r,n,o),void $t(l,t,i,r,n,o)}a=a.next}s=s.next}while(s!==e)}(e,t,i,r,n,o):$t(Jt(e),t,i,r,n,o,1);break}}}function ei(e,t){return e.x-t.x}function ti(e,t,i,r,n){return e=32767*(e-i)*n,t=32767*(t-r)*n,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e|t<<1}function ii(e,t,i,r,n,o,s,a){return(n-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(r-a)-(i-s)*(t-a)>=0&&(i-s)*(o-a)-(n-s)*(r-a)>=0}function ri(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function ni(e,t){return e.x===t.x&&e.y===t.y}function oi(e,t,i,r){return!!(ni(e,t)&&ni(i,r)||ni(e,r)&&ni(i,t))||ri(e,t,i)>0!=ri(e,t,r)>0&&ri(i,r,e)>0!=ri(i,r,t)>0}function si(e,t){return ri(e.prev,e,e.next)<0?ri(e,t,e.next)>=0&&ri(e,e.prev,t)>=0:ri(e,t,e.prev)<0||ri(e,e.next,t)<0}function ai(e,t){var i=new ci(e.i,e.x,e.y),r=new ci(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function li(e,t,i,r){var n=new ci(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function ui(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function ci(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function hi(e,t,i,r){for(var n=0,o=t,s=i-r;o<i;o+=r)n+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return n}function Ai(e){var r=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var s=0;s<t;s++)i.vertices.push(e[n][o][s]);n>0&&(r+=e[n-1].length,i.holes.push(r))}return i}(e),n=ea(r.vertices,r.holes,2),t=[],o=[];n.forEach(function(e,t){var i=n[t];o.push([r.vertices[2*i],r.vertices[2*i+1]])});for(var i=0;i<o.length;i+=3){var s=o.slice(i,i+3);s.push(o[i]),t.push(k([s]))}return t}function pi(r,e){if(!r)throw new Error("targetPoint is required");if(!e)throw new Error("points is required");var n,o=1/0;return ue(e,function(e,t){var i=ft(r,e);i<o&&((n=dt(e)).properties.featureIndex=t,n.properties.distanceToPoint=i,o=i)}),n}function fi(e,t,i,r,n){di(e,t,i||0,r||e.length-1,n||function(e,t){return e<t?-1:e>t?1:0})}function di(e,t,i,r,n){for(;r>i;){if(r-i>600){var o=r-i+1,s=t-i+1,a=Math.log(o),l=.5*Math.exp(2*a/3),u=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);di(e,t,Math.max(i,Math.floor(t-s*l/o+u)),Math.min(r,Math.floor(t+(o-s)*l/o+u)),n)}var c=e[t],h=i,A=r;for(gi(e,i,t),n(e[r],c)>0&&gi(e,i,r);h<A;){for(gi(e,h,A),h++,A--;n(e[h],c)<0;)h++;for(;n(e[A],c)>0;)A--}0===n(e[i],c)?gi(e,i,A):gi(e,++A,r),A<=t&&(i=A+1),t<=A&&(r=A-1)}}function gi(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function mi(e,t){if(!(this instanceof mi))return new mi(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&this._initFormat(t),this.clear()}function yi(e,t){_i(e,0,e.children.length,t,e)}function _i(e,t,i,r,n){n||(n=Mi(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var o,s=t;s<i;s++)o=e.children[s],vi(n,e.leaf?r(o):o);return n}function vi(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function Ci(e,t){return e.minX-t.minX}function wi(e,t){return e.minY-t.minY}function xi(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function bi(e){return e.maxX-e.minX+(e.maxY-e.minY)}function Ei(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function Bi(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function Mi(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Ii(e,t,i,r,n){for(var o,s=[t,i];s.length;)(i=s.pop())-(t=s.pop())<=r||(fi(e,o=t+Math.ceil((i-t)/r/2)*r,t,i,n),s.push(t,o,o,i))}function Si(e){var t=mi(e);return t.insert=function(e){if(Array.isArray(e)){var t=e;(e=Pi(t)).bbox=t}else e.bbox=e.bbox?e.bbox:Ti(e);return mi.prototype.insert.call(this,e)},t.load=function(e){var i=[];return Array.isArray(e)?e.forEach(function(e){var t=Pi(e);t.bbox=e,i.push(t)}):ue(e,function(e){e.bbox=e.bbox?e.bbox:Ti(e),i.push(e)}),mi.prototype.load.call(this,i)},t.remove=function(e){if(Array.isArray(e)){var t=e;(e=Pi(t)).bbox=t}return mi.prototype.remove.call(this,e)},t.clear=function(){return mi.prototype.clear.call(this)},t.search=function(e){return{type:"FeatureCollection",features:mi.prototype.search.call(this,this.toBBox(e))}},t.collides=function(e){return mi.prototype.collides.call(this,this.toBBox(e))},t.all=function(){return{type:"FeatureCollection",features:mi.prototype.all.call(this)}},t.toJSON=function(){return mi.prototype.toJSON.call(this)},t.fromJSON=function(e){return mi.prototype.fromJSON.call(this,e)},t.toBBox=function(e){var t;return t=e.bbox?e.bbox:Array.isArray(e)&&4===e.length?e:Ti(e),{minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}},t}function Pi(e){var t=[e[0],e[1]],i=[e[0],e[3]],r=[e[2],e[3]];return{type:"Feature",bbox:e,properties:{},geometry:{type:"Polygon",coordinates:[[t,[e[2],e[1]],r,i,t]]}}}function Ti(e){var t=[1/0,1/0,-1/0,-1/0];return oe(e,function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])}),t}function Li(e){if(!e)throw new Error("geojson is required");var t=[];return fe(e,function(e){!function(i,r){var e=[],t=i.geometry;switch(t.type){case"Polygon":e=x(t);break;case"LineString":e=[x(t)]}e.forEach(function(e){var t=function(e,r){var n=[];return e.reduce(function(e,t){var i=W([e,t],r);return i.bbox=function(e,t){var i=e[0],r=e[1],n=t[0],o=t[1];return[i<n?i:n,r<o?r:o,i>n?i:n,r>o?r:o]}(e,t),n.push(i),t}),n}(e,i.properties);t.forEach(function(e){e.id=r.length,r.push(e)})})}(e,t)}),H(t)}function Di(e,t){var n={},o=[];if("LineString"===e.type&&(e=G(e)),"LineString"===t.type&&(t=G(t)),"Feature"===e.type&&"Feature"===t.type&&"LineString"===e.geometry.type&&"LineString"===t.geometry.type&&2===e.geometry.coordinates.length&&2===t.geometry.coordinates.length){var i=Fi(e,t);return i&&o.push(i),H(o)}var s=Si();return s.load(Li(t)),ue(Li(e),function(r){ue(s.search(r),function(e){var t=Fi(r,e);if(t){var i=x(t).join(",");n[i]||(n[i]=!0,o.push(t))}})}),H(o)}function Fi(e,t){var i=x(e),r=x(t);if(2!==i.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==r.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var n=i[0][0],o=i[0][1],s=i[1][0],a=i[1][1],l=r[0][0],u=r[0][1],c=r[1][0],h=r[1][1],A=(h-u)*(s-n)-(c-l)*(a-o),p=(c-l)*(o-u)-(h-u)*(n-l),f=(s-n)*(o-u)-(a-o)*(n-l);if(0===A)return null;var d=p/A,g=f/A;if(d>=0&&d<=1&&g>=0&&g<=1)return z([n+d*(s-n),o+d*(a-o)]);return null}function Ni(e,A,p){if(p=p||{},!Q(p))throw new Error("options is invalid");var t=e.geometry?e.geometry.type:e.type;if("LineString"!==t&&"MultiLineString"!==t)throw new Error("lines must be LineString or MultiLineString");var f=z([1/0,1/0],{dist:1/0}),d=0;return fe(e,function(e){for(var t=x(e),i=0;i<t.length-1;i++){var r=z(t[i]);r.properties.dist=ft(A,r,p);var n=z(t[i+1]);n.properties.dist=ft(A,n,p);var o=ft(r,n,p),s=Math.max(r.properties.dist,n.properties.dist),a=Wt(r,n),l=Gt(A,s,a+90,p),u=Gt(A,s,a-90,p),c=Di(W([l.geometry.coordinates,u.geometry.coordinates]),W([r.geometry.coordinates,n.geometry.coordinates])),h=null;c.features.length>0&&((h=c.features[0]).properties.dist=ft(A,h,p),h.properties.location=d+ft(r,h,p)),r.properties.dist<f.properties.dist&&((f=r).properties.index=i,f.properties.location=d),n.properties.dist<f.properties.dist&&((f=n).properties.index=i+1,f.properties.location=d+o),h&&h.properties.dist<f.properties.dist&&((f=h).properties.index=i),d+=o}}),f}function Oi(e,t,i){if(i=i||{},!Q(i))throw new Error("options is invalid");var r=i.final;if(!e)throw new Error("start point is required");if(!t)throw new Error("end point is required");var n;return(n=r?Ri(Ce(t),Ce(e)):Ri(Ce(e),Ce(t)))>180?-(360-n):n}function Ri(e,t){var i=$(e[1]),r=$(t[1]),n=$(t[0]-e[0]);n>Math.PI&&(n-=2*Math.PI),n<-Math.PI&&(n+=2*Math.PI);var o=Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(i/2+Math.PI/4));return(J(Math.atan2(n,o))+360)%360}function Ui(e,t,i){if(i=i||{},!Q(i))throw new Error("options is invalid");var r=i.units;if(!e)throw new Error("from point is required");if(!t)throw new Error("to point is required");var n=Ce(e),o=Ce(t);o[0]+=o[0]-n[0]>180?-360:n[0]-o[0]>180?360:0;return ee(function(e,t,i){var r=i=void 0===i?As:Number(i),n=e[1]*Math.PI/180,o=t[1]*Math.PI/180,s=o-n,a=Math.abs(t[0]-e[0])*Math.PI/180;a>Math.PI&&(a-=2*Math.PI);var l=Math.log(Math.tan(o/2+Math.PI/4)/Math.tan(n/2+Math.PI/4)),u=Math.abs(l)>1e-11?s/l:Math.cos(n);return Math.sqrt(s*s+u*u*a*a)*r}(n,o),"meters",r)}function ki(e,t){return Qi(e,"mercator",t)}function Hi(e,t){return Qi(e,"wgs84",t)}function Qi(e,i,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var r=t.mutate;if(!e)throw new Error("geojson is required");return Array.isArray(e)&&ie(e[0])?e="mercator"===i?Vi(e):Gi(e):(!0!==r&&(e=dt(e)),oe(e,function(e){var t="mercator"===i?Vi(e):Gi(e);e[0]=t[0],e[1]=t[1]})),e}function Vi(e){var t=Math.PI/180,i=20037508.342789244,r=[6378137*(Math.abs(e[0])<=180?e[0]:e[0]-360*function(e){return e<0?-1:e>0?1:0}(e[0]))*t,6378137*Math.log(Math.tan(.25*Math.PI+.5*e[1]*t))];return r[0]>i&&(r[0]=i),r[0]<-i&&(r[0]=-i),r[1]>i&&(r[1]=i),r[1]<-i&&(r[1]=-i),r}function Gi(e){var t=180/Math.PI;return[e[0]*t/6378137,(.5*Math.PI-2*Math.atan(Math.exp(-e[1]/6378137)))*t]}function zi(e,t,n){if(n=n||{},!Q(n))throw new Error("options is invalid");if(!e)throw new Error("pt is required");if(Array.isArray(e)?e=z(e):"Point"===e.type?e=G(e):be(e,"Point","point"),!t)throw new Error("line is required");Array.isArray(t)?t=W(t):"LineString"===t.type?t=G(t):be(t,"LineString","line");var o=1/0,s=e.geometry.coordinates;return ge(t,function(e){var t=e.geometry.coordinates[0],i=e.geometry.coordinates[1],r=function(e,t,i,r){var n=r.mercator,o=!0!==n?ft(t,e,r):Wi(t,e,r),s=X(!0!==n?Wt(t,e):Oi(t,e)),a=X(!0!==n?Wt(t,i):Oi(t,i)),l=Math.abs(s-a);if(l>90)return o;var u=(a+180)%360,c=X(!0!==n?Wt(i,e):Oi(i,e)),h=Math.abs(c-u);h>180&&(h=Math.abs(h-360));return h>90?!0!==n?ft(e,i,r):Wi(e,i,r):!0!==n?o*Math.sin($(l)):function(e,t,i,r){var n=0;(Math.abs(e[0])>=180||Math.abs(t[0])>=180||Math.abs(i[0])>=180)&&(n=e[0]>0||t[0]>0||i[0]>0?-180:180);var o=z(i),s=ki([e[0]+n,e[1]]),a=ki([t[0]+n,t[1]]),l=ki([i[0]+n,i[1]]),u=Hi(function(e,t,i){var r=e[0],n=e[1],o=t[0],s=t[1],a=i[0],l=i[1],u=o-r,c=s-n,h=((a-r)*u+(l-n)*c)/(u*u+c*c);return[r+h*u,n+h*c]}(s,a,l));return 0!==n&&(u[0]-=n),Ui(o,u,r)}(t,i,e,r)}(s,t,i,n);o>r&&(o=r)}),o}function Wi(e,t,i){var r=i.units,n=0;Math.abs(e[0])>=180&&(n=e[0]>0?-180:180),Math.abs(t[0])>=180&&(n=t[0]>0?-180:180);var o=ki([e[0]+n,e[1]]),s=ki([t[0]+n,t[1]]),a=function(e){return e*e},l=a(o[0]-s[0])+a(o[1]-s[1]);return ee(Math.sqrt(l),"meters",r)}function qi(e){for(var t=function(e){if("FeatureCollection"!==e.type)return"Feature"!==e.type?H([G(e)]):H([e]);return e}(e),i=qt(t),r=!1,n=0;!r&&n<t.features.length;){var o,s=t.features[n].geometry,a=!1;if("Point"===s.type)i.geometry.coordinates[0]===s.coordinates[0]&&i.geometry.coordinates[1]===s.coordinates[1]&&(r=!0);else if("MultiPoint"===s.type){var l=!1;for(o=0;!l&&o<s.coordinates.length;)i.geometry.coordinates[0]===s.coordinates[o][0]&&i.geometry.coordinates[1]===s.coordinates[o][1]&&(r=!0,l=!0),o++}else if("LineString"===s.type)for(o=0;!a&&o<s.coordinates.length-1;)Ki(i.geometry.coordinates[0],i.geometry.coordinates[1],s.coordinates[o][0],s.coordinates[o][1],s.coordinates[o+1][0],s.coordinates[o+1][1])&&(a=!0,r=!0),o++;else if("MultiLineString"===s.type)for(var u=0;u<s.coordinates.length;){a=!1,o=0;for(var c=s.coordinates[u];!a&&o<c.length-1;)Ki(i.geometry.coordinates[0],i.geometry.coordinates[1],c[o][0],c[o][1],c[o+1][0],c[o+1][1])&&(a=!0,r=!0),o++;u++}else"Polygon"!==s.type&&"MultiPolygon"!==s.type||at(i,s)&&(r=!0);n++}if(r)return i;var h=H([]);for(n=0;n<t.features.length;n++)h.features=h.features.concat(Zt(t.features[n]).features);return z(pi(i,h).geometry.coordinates)}function Ki(e,t,i,r,n,o){return Math.sqrt((n-i)*(n-i)+(o-r)*(o-r))===Math.sqrt((e-i)*(e-i)+(t-r)*(t-r))+Math.sqrt((n-e)*(n-e)+(o-t)*(o-t))}function ji(e){return pe(e,function(e,t){return e+Zi(t)},0)}function Zi(e){var t,i=0;switch(e.type){case"Polygon":return Yi(e.coordinates);case"MultiPolygon":for(t=0;t<e.coordinates.length;t++)i+=Yi(e.coordinates[t]);return i;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(t=0;t<e.geometries.length;t++)i+=Zi(e.geometries[t]);return i}}function Yi(e){var t=0;if(e&&e.length>0){t+=Math.abs(Xi(e[0]));for(var i=1;i<e.length;i++)t-=Math.abs(Xi(e[i]))}return t}function Xi(e){var t,i,r,n,o,s,a=0,l=e.length;if(l>2){for(s=0;s<l;s++)s===l-2?(r=l-2,n=l-1,o=0):s===l-1?(r=l-1,n=0,o=1):(r=s,n=s+1,o=s+2),t=e[r],i=e[n],a+=(Ji(e[o][0])-Ji(t[0]))*Math.sin(Ji(i[1]));a=a*ra*ra/2}return a}function Ji(e){return e*Math.PI/180}function $i(e,r){if(r=r||{},!Q(r))throw new Error("options is invalid");if(!e)throw new Error("geojson is required");return me(e,function(e,t){var i=t.geometry.coordinates;return e+ft(i[0],i[1],r)},0)}function er(e,t,i,r){if(r=r||{},!Q(r))throw new Error("options is invalid");var n,o=[];if("Feature"===e.type)n=e.geometry.coordinates;else{if("LineString"!==e.type)throw new Error("input must be a LineString Feature or Geometry");n=e.coordinates}for(var s,a,l,u=0,c=0;c<n.length&&!(t>=u&&c===n.length-1);c++){if(u>t&&0===o.length){if(!(s=t-u))return o.push(n[c]),W(o);a=Wt(n[c],n[c-1])-180,l=Gt(n[c],s,a,r),o.push(l.geometry.coordinates)}if(u>=i)return(s=i-u)?(a=Wt(n[c],n[c-1])-180,l=Gt(n[c],s,a,r),o.push(l.geometry.coordinates),W(o)):(o.push(n[c]),W(o));if(u>=t&&o.push(n[c]),c===n.length-1)return W(o);u+=ft(n[c],n[c+1],r)}return W(n[n.length-1])}function tr(e,t,i){var r=(i=i||{}).ignoreEndVertices;if(!Q(i))throw new Error("invalid options");if(!e)throw new Error("pt is required");if(!t)throw new Error("line is required");for(var n=Ce(e),o=x(t),s=0;s<o.length-1;s++){var a=!1;if(r&&(0===s&&(a="start"),s===o.length-2&&(a="end"),0===s&&s+1===o.length-1&&(a="both")),function(e,t,i,r){var n=i[0],o=i[1],s=e[0],a=e[1],l=t[0],u=t[1],c=i[0]-s,h=i[1]-a,A=l-s,p=u-a;if(c*p-h*A!=0)return!1;{if(!r)return Math.abs(A)>=Math.abs(p)?A>0?s<=n&&n<=l:l<=n&&n<=s:p>0?a<=o&&o<=u:u<=o&&o<=a;if("start"===r)return Math.abs(A)>=Math.abs(p)?A>0?s<n&&n<=l:l<=n&&n<s:p>0?a<o&&o<=u:u<=o&&o<a;if("end"===r)return Math.abs(A)>=Math.abs(p)?A>0?s<=n&&n<l:l<n&&n<=s:p>0?a<=o&&o<u:u<o&&o<=a;if("both"===r)return Math.abs(A)>=Math.abs(p)?A>0?s<n&&n<l:l<n&&n<s:p>0?a<o&&o<u:u<o&&o<a}}(o[s],o[s+1],n,a))return!0}return!1}function ir(e,t){var i=Ie(e),r=Ie(t),n=Be(e),o=Be(t);switch(i){case"Point":switch(r){case"MultiPoint":return function(e,t){var i,r=!1;for(i=0;i<t.coordinates.length;i++)if(nr(t.coordinates[i],e.coordinates)){r=!0;break}return r}(n,o);case"LineString":return tr(n,o,{ignoreEndVertices:!0});case"Polygon":return at(n,o,{ignoreBoundary:!0});default:throw new Error("feature2 "+r+" geometry not supported")}case"MultiPoint":switch(r){case"MultiPoint":return function(e,t){for(var i=0;i<e.coordinates.length;i++){for(var r=!1,n=0;n<t.coordinates.length;n++)nr(e.coordinates[i],t.coordinates[n])&&(r=!0);if(!r)return!1}return!0}(n,o);case"LineString":return function(e,t){for(var i=!1,r=0;r<e.coordinates.length;r++){if(!tr(e.coordinates[r],t))return!1;i||(i=tr(e.coordinates[r],t,{ignoreEndVertices:!0}))}return i}(n,o);case"Polygon":return function(e,t){for(var i=!0,r=0;r<e.coordinates.length;r++){var n=at(e.coordinates[1],t);if(!n){i=!1;break}n=at(e.coordinates[1],t,{ignoreBoundary:!0})}return i&&n}(n,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"LineString":switch(r){case"LineString":return function(e,t){for(var i=0;i<e.coordinates.length;i++)if(!tr(e.coordinates[i],t))return!1;return!0}(n,o);case"Polygon":return function(e,t){var i=ve(t),r=ve(e);if(!rr(i,r))return!1;for(var n=!1,o=0;o<e.coordinates.length-1;o++){if(!at(e.coordinates[o],t))return!1;if(n||(n=at(e.coordinates[o],t,{ignoreBoundary:!0})),!n){var s=function(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}(e.coordinates[o],e.coordinates[o+1]);n=at(s,t,{ignoreBoundary:!0})}}return n}(n,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"Polygon":switch(r){case"Polygon":return function(e,t){var i=ve(e);if(!rr(ve(t),i))return!1;for(var r=0;r<e.coordinates[0].length;r++)if(!at(e.coordinates[0][r],t))return!1;return!0}(n,o);default:throw new Error("feature2 "+r+" geometry not supported")}default:throw new Error("feature1 "+i+" geometry not supported")}}function rr(e,t){return!(e[0]>t[0])&&(!(e[2]<t[2])&&(!(e[1]>t[1])&&!(e[3]<t[3])))}function nr(e,t){return e[0]===t[0]&&e[1]===t[1]}function or(e,t,i){if(i=i||{},!Q(i))throw new Error("options is invalid");var r=i.mask,n=i.properties,o=[];if(null===t||void 0===t)throw new Error("cellSide is required");if(!ie(t))throw new Error("cellSide is invalid");if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be array");if(4!==e.length)throw new Error("bbox must contain 4 numbers");if(r&&-1===["Polygon","MultiPolygon"].indexOf(Ie(r)))throw new Error("options.mask must be a (Multi)Polygon");for(var s=e[0],a=e[1],l=e[2],u=e[3],c=t/ft([s,a],[l,a],i)*(l-s),h=t/ft([s,a],[s,u],i)*(u-a),A=l-s,p=u-a,f=Math.floor(A/c),d=(p-Math.floor(p/h)*h)/2,g=s+(A-f*c)/2;g<=l;){for(var m=a+d;m<=u;){var y=z([g,m],n);r?ir(y,r)&&o.push(y):o.push(y),m+=h}g+=c}return H(o)}function sr(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=t.precision,r=t.coordinates,n=t.mutate;if(i=void 0===i||null===i||isNaN(i)?6:i,r=void 0===r||null===r||isNaN(r)?3:r,!e)throw new Error("<geojson> is required");if("number"!=typeof i)throw new Error("<precision> must be a number");if("number"!=typeof r)throw new Error("<coordinates> must be a number");!1!==n&&void 0!==n||(e=JSON.parse(JSON.stringify(e)));var o=Math.pow(10,i);return oe(e,function(e){!function(e,t,i){e.length>i&&e.splice(i,e.length);for(var r=0;r<e.length;r++)e[r]=Math.round(e[r]*t)/t}(e,o,r)}),e}function ar(e,t){if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var i=0,r=e.length;i<r;i++)if(e[i]instanceof Array&&t[i]instanceof Array){if(!ar(e[i],t[i]))return!1}else if(e[i]!==t[i])return!1;return!0}function lr(e,t){if(void 0===t&&(t=!0),3!=e.length)throw new Error("This function requires an array of three points [x,y]");return(e[1][0]-e[0][0])*(e[2][1]-e[0][1])-(e[1][1]-e[0][1])*(e[2][0]-e[0][0])>=0==t}function ur(e,t){if(!e||!t)return!1;if(e.length!=t.length)return!1;for(var i=0,r=e.length;i<r;i++)if(e[i]instanceof Array&&t[i]instanceof Array){if(!ur(e[i],t[i]))return!1}else if(e[i]!=t[i])return!1;return!0}function cr(r,e){var n=[],o=Si();return fe(e,function(e){if(n.forEach(function(e,t){e.id=t}),n.length){var t=o.search(e);if(t.features.length){var i=Ar(e,t);n=n.filter(function(e){return e.id!==i.id}),o.remove(i),ue(hr(i,e),function(e){n.push(e),o.insert(e)})}}else(n=hr(r,e).features).forEach(function(e){e.bbox||(e.bbox=Vt(ve(e)))}),o.load(H(n))}),H(n)}function hr(e,o){var s=[],t=x(e)[0],i=x(e)[e.geometry.coordinates.length-1];if(pr(t,Ce(o))||pr(i,Ce(o)))return H([e]);var r=Si(),n=Li(e);r.load(n);var a=r.search(o);if(!a.features.length)return H([e]);var l=Ar(o,a),u=ce(n,function(e,t,i){var r=x(t)[1],n=Ce(o);return i===l.id?(e.push(n),s.push(W(e)),pr(n,r)?[n]:[n,r]):(e.push(r),e)},[t]);return u.length>1&&s.push(W(u)),H(s)}function Ar(i,e){if(!e.features.length)throw new Error("lines must contain features");if(1===e.features.length)return e.features[0];var r,n=1/0;return ue(e,function(e){var t=Ni(e,i).properties.dist;t<n&&(r=e,n=t)}),r}function pr(e,t){return e[0]===t[0]&&e[1]===t[1]}function fr(e,t,i,r,n){if(n=n||{},!Q(n))throw new Error("options is invalid");var o=n.steps,s=n.units;if(!e)throw new Error("center is required");if(!t)throw new Error("radius is required");if(void 0===i||null===i)throw new Error("bearing1 is required");if(void 0===r||null===r)throw new Error("bearing2 is required");if("object"!=typeof n)throw new Error("options must be an object");o=o||64;var a=dr(i),l=dr(r),u=e.properties;if(a===l)return W(zt(e,t,n).geometry.coordinates[0],u);for(var c=a,h=a<l?l:l+360,A=c,p=[],f=0;A<h;)p.push(Gt(e,t,A,s).geometry.coordinates),A=c+360*++f/o;return A>h&&p.push(Gt(e,t,h,s).geometry.coordinates),W(p,u)}function dr(e){var t=e%360;return t<0&&(t+=360),t}function gr(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=t.properties,r=Ie(e),n=x(e);if(i=i||e.properties||{},!n.length)throw new Error("polygon must contain coordinates");switch(r){case"Polygon":return mr(n,i);case"MultiPolygon":var o=[];return n.forEach(function(e){o.push(mr(e,i))}),H(o);default:throw new Error("geom "+r+" not supported")}}function mr(e,t){return e.length>1?q(e,t):W(e[0],t)}function yr(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=t.properties,r=t.autoComplete,n=t.orderCoords;if(!e)throw new Error("lines is required");r=void 0===r||r,n=void 0===n||n;switch(Ie(e)){case"FeatureCollection":case"GeometryCollection":var o=[];return(e.features?e.features:e.geometries).forEach(function(e){o.push(x(_r(e,{},r,n)))}),K(o,i)}return _r(e,i,r,n)}function _r(e,t,i,r){t=t||e.properties||{};var n=x(e),o=Ie(e);if(!n.length)throw new Error("line must contain coordinates");switch(o){case"LineString":return i&&(n=vr(n)),k([n],t);case"MultiLineString":var s=[],a=0;return n.forEach(function(e){if(i&&(e=vr(e)),r){var t=function(e){var t=e[0],i=e[1],r=e[2],n=e[3];return Math.abs(t-r)*Math.abs(i-n)}(ve(W(e)));t>a?(s.unshift(e),a=t):s.push(e)}else s.push(e)}),k(s,t);default:throw new Error("geometry type "+o+" is not supported")}}function vr(e){var t=e[0],i=t[0],r=t[1],n=e[e.length-1],o=n[0],s=n[1];return i===o&&r===s||e.push(t),e}function Cr(e,t,i){var r,n,o,s,a,l=e.length,u=xr(e[0],t),c=[];for(i||(i=[]),r=1;r<l;r++){for(n=e[r-1],s=a=xr(o=e[r],t);;){if(!(u|s)){c.push(n),s!==a?(c.push(o),r<l-1&&(i.push(c),c=[])):r===l-1&&c.push(o);break}if(u&s)break;u?u=xr(n=wr(n,o,u,t),t):s=xr(o=wr(n,o,s,t),t)}u=a}return c.length&&i.push(c),i}function wr(e,t,i,r){return 8&i?[e[0]+(t[0]-e[0])*(r[3]-e[1])/(t[1]-e[1]),r[3]]:4&i?[e[0]+(t[0]-e[0])*(r[1]-e[1])/(t[1]-e[1]),r[1]]:2&i?[r[2],e[1]+(t[1]-e[1])*(r[2]-e[0])/(t[0]-e[0])]:1&i?[r[0],e[1]+(t[1]-e[1])*(r[0]-e[0])/(t[0]-e[0])]:null}function xr(e,t){var i=0;return e[0]<t[0]?i|=1:e[0]>t[2]&&(i|=2),e[1]<t[1]?i|=4:e[1]>t[3]&&(i|=8),i}function br(e,t){for(var i=[],r=0;r<e.length;r++){var n=fa.polygon(e[r],t);n.length>0&&(n[0][0]===n[n.length-1][0]&&n[0][1]===n[n.length-1][1]||n.push(n[0]),n.length>=4&&i.push(n))}return i}function Er(e){return"[object Arguments]"===Object.prototype.toString.call(e)}function Br(e,t,i){return i||(i={}),e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||"object"!=typeof e&&"object"!=typeof t?(i.strict,e===t):function(e,t,i){var r,n;if(Mr(e)||Mr(t))return!1;if(e.prototype!==t.prototype)return!1;if(Er(e))return!!Er(t)&&(e=da.call(e),t=da.call(t),Br(e,t,i));if(Ir(e)){if(!Ir(t))return!1;if(e.length!==t.length)return!1;for(r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}try{var o=Object.keys(e),s=Object.keys(t)}catch(e){return!1}if(o.length!==s.length)return!1;for(o.sort(),s.sort(),r=o.length-1;r>=0;r--)if(o[r]!==s[r])return!1;for(r=o.length-1;r>=0;r--)if(n=o[r],!Br(e[n],t[n],i))return!1;return typeof e==typeof t}(e,t,i))}function Mr(e){return null===e||void 0===e}function Ir(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length)&&("function"==typeof e.copy&&"function"==typeof e.slice&&!(e.length>0&&"number"!=typeof e[0]))}function Sr(e,t,i){if(i=i||{},!Q(i))throw new Error("options is invalid");var o=i.tolerance||0,s=[],a=Si();a.load(Li(e));var l;return ge(t,function(r){var n=!1;ue(a.search(r),function(e){if(!1===n){var t=x(r).sort(),i=x(e).sort();Br(t,i)?(n=!0,l=l?Pr(l,r):r):(0===o?tr(t[0],e)&&tr(t[1],e):Ni(e,t[0]).properties.dist<=o&&Ni(e,t[1]).properties.dist<=o)?(n=!0,l=l?Pr(l,r):r):(0===o?tr(i[0],r)&&tr(i[1],r):Ni(r,i[0]).properties.dist<=o&&Ni(r,i[1]).properties.dist<=o)&&(l=l?Pr(l,e):e)}}),!1===n&&l&&(s.push(l),l=void 0)}),l&&s.push(l),H(s)}function Pr(e,t){var i=x(t),r=x(e),n=r[0],o=r[r.length-1],s=e.geometry.coordinates;return Br(i[0],n)?s.unshift(i[1]):Br(i[0],o)?s.push(i[1]):Br(i[1],n)?s.unshift(i[0]):Br(i[1],o)&&s.push(i[0]),e}function Tr(e){var t=e%360;return t<0&&(t+=360),t}function Lr(e,t,i,r){if(r=r||{},!Q(r))throw new Error("options is invalid");var n=r.units,o=r.properties;if(!e)throw new Error("origin is required");if(void 0===t||null===t)throw new Error("distance is required");if(void 0===i||null===i)throw new Error("bearing is required");if(!(t>=0))throw new Error("distance must be greater than 0");var s=ee(t,n,"meters"),a=Ce(e),l=function(e,t,i,r){r=void 0===r?As:Number(r);var n=t/r,o=e[0]*Math.PI/180,s=$(e[1]),a=$(i),l=n*Math.cos(a),u=s+l;Math.abs(u)>Math.PI/2&&(u=u>0?Math.PI-u:-Math.PI-u);var c=Math.log(Math.tan(u/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)),h=Math.abs(c)>1e-11?l/c:Math.cos(s),A=n*Math.sin(a)/h;return[(180*(o+A)/Math.PI+540)%360-180,180*u/Math.PI]}(a,s,i);return l[0]+=l[0]-a[0]>180?-360:a[0]-l[0]>180?360:0,z(l,o)}function Dr(e,t,i,r,n,o){for(var s=0;s<e.length;s++){var a=e[s],l=e[s+1];s===e.length-1&&(l=e[0]),r=Fr(a,l,t),i<=0&&r>0?function(e,t,i){return Fr(e,t,i)<0}(t,a,n)||(n=a):i>0&&r<=0&&(function(e,t,i){return Fr(e,t,i)>0}(t,a,o)||(o=a)),i=r}return[n,o]}function Fr(e,t,i){return(t[0]-e[0])*(i[1]-e[1])-(i[0]-e[0])*(t[1]-e[1])}function Nr(e){if(!e)throw new Error("line is required");var t=e.geometry?e.geometry.type:e.type;if(!Array.isArray(e)&&"LineString"!==t)throw new Error("geometry must be a LineString");for(var i,r,n=x(e),o=0,s=1;s<n.length;)i=r||n[0],o+=((r=n[s])[0]-i[0])*(r[1]+i[1]),s++;return o>0}function Or(e,t){switch("Feature"===e.type?e.geometry.type:e.type){case"GeometryCollection":return Ae(e,function(e){Or(e,t)}),e;case"LineString":return Rr(x(e),t),e;case"Polygon":return Ur(x(e),t),e;case"MultiLineString":return x(e).forEach(function(e){Rr(e,t)}),e;case"MultiPolygon":return x(e).forEach(function(e){Ur(e,t)}),e;case"Point":case"MultiPoint":return e}}function Rr(e,t){Nr(e)===t&&e.reverse()}function Ur(e,t){Nr(e[0])!==t&&e[0].reverse();for(var i=1;i<e.length;i++)Nr(e[i])===t&&e[i].reverse()}function kr(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=t.zProperty||"elevation",r=t.flip,n=t.flags;Ee(e,"Point","input must contain Points");for(var o=function(e,i){var r={};ue(e,function(e){var t=x(e)[1];r[t]||(r[t]=[]),r[t].push(e)});return Object.keys(r).map(function(e){var t=r[e],i=t.sort(function(e,t){return x(e)[0]-x(t)[0]});return i}).sort(function(e,t){return i?x(e[0])[1]-x(t[0])[1]:x(t[0])[1]-x(e[0])[1]})}(e,r),s=[],a=0;a<o.length;a++){for(var l=o[a],u=[],c=0;c<l.length;c++){var h=l[c];h.properties[i]?u.push(h.properties[i]):u.push(0),!0===n&&(h.properties.matrixPosition=[a,c])}s.push(u)}return s}function Hr(e,t,i,r){r=r||{};for(var n=Object.keys(ga),o=0;o<n.length;o++){var s=n[o],a=r[s];a=void 0!==a&&null!==a?a:ga[s],ma[s]=a}ma.verbose&&console.log("MarchingSquaresJS-isoBands: computing isobands for ["+t+":"+(t+i)+"]");var l,u=function(e,t,i){for(var r=e.length-1,n=e[0].length-1,o={rows:r,cols:n,cells:[]},s=t+Math.abs(i),a=0;a<r;++a){o.cells[a]=[];for(var l=0;l<n;++l){var u=0,c=e[a+1][l],h=e[a+1][l+1],A=e[a][l+1],p=e[a][l];if(!(isNaN(c)||isNaN(h)||isNaN(A)||isNaN(p))){u|=c<t?0:c>s?128:64,u|=h<t?0:h>s?32:16,u|=A<t?0:A>s?8:4;var f=+(u|=p<t?0:p>s?2:1),d=0;if(17===u||18===u||33===u||34===u||38===u||68===u||72===u||98===u||102===u||132===u||136===u||137===u||152===u||153===u){var g=(c+h+A+p)/4;d=g>s?2:g<t?0:1,34===u?1===d?u=35:0===d&&(u=136):136===u?1===d?(u=35,d=4):0===d&&(u=34):17===u?1===d?(u=155,d=4):0===d&&(u=153):68===u?1===d?(u=103,d=4):0===d&&(u=102):153===u?1===d&&(u=155):102===u?1===d&&(u=103):152===u?d<2&&(u=156,d=1):137===u?d<2&&(u=139,d=1):98===u?d<2&&(u=99,d=1):38===u?d<2&&(u=39,d=1):18===u?d>0?(u=156,d=4):u=152:33===u?d>0?(u=139,d=4):u=137:72===u?d>0?(u=99,d=4):u=98:132===u&&(d>0?(u=39,d=4):u=38)}if(0!=u&&170!=u){var m,y,_,v,C,w,x,b;m=y=_=v=C=w=x=b=.5;var E=[];1===u?(_=1-B(t,A,p),b=1-B(t,c,p),E.push(P[u])):169===u?(_=B(s,p,A),b=B(s,p,c),E.push(P[u])):4===u?(w=1-B(t,h,A),v=B(t,p,A),E.push(I[u])):166===u?(w=B(s,A,h),v=1-B(s,A,p),E.push(I[u])):16===u?(C=B(t,A,h),y=B(t,c,h),E.push(M[u])):154===u?(C=1-B(s,h,A),y=1-B(s,h,c),E.push(M[u])):64===u?(x=B(t,p,c),m=1-B(t,h,c),E.push(L[u])):106===u?(x=1-B(s,c,p),m=B(s,c,h),E.push(L[u])):168===u?(v=B(s,p,A),_=B(t,p,A),b=B(t,p,c),x=B(s,p,c),E.push(S[u]),E.push(P[u])):2===u?(v=1-B(t,A,p),_=1-B(s,A,p),b=1-B(s,c,p),x=1-B(t,c,p),E.push(S[u]),E.push(P[u])):162===u?(C=B(s,A,h),w=B(t,A,h),v=1-B(t,A,p),_=1-B(s,A,p),E.push(S[u]),E.push(P[u])):8===u?(C=1-B(t,h,A),w=1-B(s,h,A),v=B(s,p,A),_=B(t,p,A),E.push(M[u]),E.push(I[u])):138===u?(C=1-B(t,h,A),w=1-B(s,h,A),m=1-B(s,h,c),y=1-B(t,h,c),E.push(M[u]),E.push(I[u])):32===u?(C=B(s,A,h),w=B(t,A,h),m=B(t,c,h),y=B(s,c,h),E.push(M[u]),E.push(I[u])):42===u?(b=1-B(s,c,p),x=1-B(t,c,p),m=B(t,c,h),y=B(s,c,h),E.push(T[u]),E.push(L[u])):128===u&&(b=B(t,p,c),x=B(s,p,c),m=1-B(s,h,c),y=1-B(t,h,c),E.push(T[u]),E.push(L[u])),5===u?(w=1-B(t,h,A),b=1-B(t,c,p),E.push(I[u])):165===u?(w=B(s,A,h),b=B(s,p,c),E.push(I[u])):20===u?(v=B(t,p,A),y=B(t,c,h),E.push(S[u])):150===u?(v=1-B(s,A,p),y=1-B(s,h,c),E.push(S[u])):80===u?(C=B(t,A,h),x=B(t,p,c),E.push(M[u])):90===u?(C=1-B(s,h,A),x=1-B(s,c,p),E.push(M[u])):65===u?(_=1-B(t,A,p),m=1-B(t,h,c),E.push(P[u])):105===u?(_=B(s,p,A),m=B(s,c,h),E.push(P[u])):160===u?(C=B(s,A,h),w=B(t,A,h),b=B(t,p,c),x=B(s,p,c),E.push(M[u]),E.push(I[u])):10===u?(C=1-B(t,h,A),w=1-B(s,h,A),b=1-B(s,c,p),x=1-B(t,c,p),E.push(M[u]),E.push(I[u])):130===u?(v=1-B(t,A,p),_=1-B(s,A,p),m=1-B(s,h,c),y=1-B(t,h,c),E.push(S[u]),E.push(P[u])):40===u?(v=B(s,p,A),_=B(t,p,A),m=B(t,c,h),y=B(s,c,h),E.push(S[u]),E.push(P[u])):101===u?(w=B(s,A,h),m=B(s,c,h),E.push(I[u])):69===u?(w=1-B(t,h,A),m=1-B(t,h,c),E.push(I[u])):149===u?(b=B(s,p,c),y=1-B(s,h,c),E.push(T[u])):21===u?(b=1-B(t,c,p),y=B(t,c,h),E.push(T[u])):86===u?(v=1-B(s,A,p),x=1-B(s,c,p),E.push(S[u])):84===u?(v=B(t,p,A),x=B(t,p,c),E.push(S[u])):89===u?(C=1-B(s,h,A),_=B(s,p,A),E.push(P[u])):81===u?(C=B(t,A,h),_=1-B(t,A,p),E.push(P[u])):96===u?(C=B(s,A,h),w=B(t,A,h),x=B(t,p,c),m=B(s,c,h),E.push(M[u]),E.push(I[u])):74===u?(C=1-B(t,h,A),w=1-B(s,h,A),x=1-B(s,c,p),m=1-B(t,h,c),E.push(M[u]),E.push(I[u])):24===u?(C=1-B(s,h,A),v=B(s,p,A),_=B(t,p,A),y=B(t,c,h),E.push(M[u]),E.push(P[u])):146===u?(C=B(t,A,h),v=1-B(t,A,p),_=1-B(s,A,p),y=1-B(s,h,c),E.push(M[u]),E.push(P[u])):6===u?(w=1-B(t,h,A),v=1-B(s,A,p),b=1-B(s,c,p),x=1-B(t,c,p),E.push(I[u]),E.push(S[u])):164===u?(w=B(s,A,h),v=B(t,p,A),b=B(t,p,c),x=B(s,p,c),E.push(I[u]),E.push(S[u])):129===u?(_=1-B(t,A,p),b=B(s,p,c),m=1-B(s,h,c),y=1-B(t,h,c),E.push(P[u]),E.push(T[u])):41===u?(_=B(s,p,A),b=1-B(t,c,p),m=B(t,c,h),y=B(s,c,h),E.push(P[u]),E.push(T[u])):66===u?(v=1-B(t,A,p),_=1-B(s,A,p),x=1-B(s,c,p),m=1-B(t,h,c),E.push(S[u]),E.push(P[u])):104===u?(v=B(s,p,A),_=B(t,p,A),x=B(t,p,c),m=B(s,c,h),E.push(P[u]),E.push(ja[u])):144===u?(C=B(t,A,h),b=B(t,p,c),x=B(s,p,c),y=1-B(s,h,c),E.push(M[u]),E.push(L[u])):26===u?(C=1-B(s,h,A),b=1-B(s,c,p),x=1-B(t,c,p),y=B(t,c,h),E.push(M[u]),E.push(L[u])):36===u?(w=B(s,A,h),v=B(t,p,A),m=B(t,c,h),y=B(s,c,h),E.push(I[u]),E.push(S[u])):134===u?(w=1-B(t,h,A),v=1-B(s,A,p),m=1-B(s,h,c),y=1-B(t,h,c),E.push(I[u]),E.push(S[u])):9===u?(C=1-B(t,h,A),w=1-B(s,h,A),_=B(s,p,A),b=1-B(t,c,p),E.push(M[u]),E.push(I[u])):161===u?(C=B(s,A,h),w=B(t,A,h),_=1-B(t,A,p),b=B(s,p,c),E.push(M[u]),E.push(I[u])):37===u?(w=B(s,A,h),b=1-B(t,c,p),m=B(t,c,h),y=B(s,c,h),E.push(I[u]),E.push(T[u])):133===u?(w=1-B(t,h,A),b=B(s,p,c),m=1-B(s,h,c),y=1-B(t,h,c),E.push(I[u]),E.push(T[u])):148===u?(v=B(t,p,A),b=B(t,p,c),x=B(s,p,c),y=1-B(s,h,c),E.push(S[u]),E.push(L[u])):22===u?(v=1-B(s,A,p),b=1-B(s,c,p),x=1-B(t,c,p),y=B(t,c,h),E.push(S[u]),E.push(L[u])):82===u?(C=B(t,A,h),v=1-B(t,A,p),_=1-B(s,A,p),x=1-B(s,c,p),E.push(M[u]),E.push(P[u])):88===u?(C=1-B(s,h,A),v=B(s,p,A),_=B(t,p,A),x=B(t,p,c),E.push(M[u]),E.push(P[u])):73===u?(C=1-B(t,h,A),w=1-B(s,h,A),_=B(s,p,A),m=1-B(t,h,c),E.push(M[u]),E.push(I[u])):97===u?(C=B(s,A,h),w=B(t,A,h),_=1-B(t,A,p),m=B(s,c,h),E.push(M[u]),E.push(I[u])):145===u?(C=B(t,A,h),_=1-B(t,A,p),b=B(s,p,c),y=1-B(s,h,c),E.push(M[u]),E.push(T[u])):25===u?(C=1-B(s,h,A),_=B(s,p,A),b=1-B(t,c,p),y=B(t,c,h),E.push(M[u]),E.push(T[u])):70===u?(w=1-B(t,h,A),v=1-B(s,A,p),x=1-B(s,c,p),m=1-B(t,h,c),E.push(I[u]),E.push(S[u])):100===u?(w=B(s,A,h),v=B(t,p,A),x=B(t,p,c),m=B(s,c,h),E.push(I[u]),E.push(S[u])):34===u?(0===d?(C=1-B(t,h,A),w=1-B(s,h,A),v=B(s,p,A),_=B(t,p,A),b=B(t,p,c),x=B(s,p,c),m=1-B(s,h,c),y=1-B(t,h,c)):(C=B(s,A,h),w=B(t,A,h),v=1-B(t,A,p),_=1-B(s,A,p),b=1-B(s,c,p),x=1-B(t,c,p),m=B(t,c,h),y=B(s,c,h)),E.push(M[u]),E.push(I[u]),E.push(T[u]),E.push(L[u])):35===u?(4===d?(C=1-B(t,h,A),w=1-B(s,h,A),v=B(s,p,A),_=B(t,p,A),b=B(t,p,c),x=B(s,p,c),m=1-B(s,h,c),y=1-B(t,h,c)):(C=B(s,A,h),w=B(t,A,h),v=1-B(t,A,p),_=1-B(s,A,p),b=1-B(s,c,p),x=1-B(t,c,p),m=B(t,c,h),y=B(s,c,h)),E.push(M[u]),E.push(I[u]),E.push(P[u]),E.push(L[u])):136===u?(0===d?(C=B(s,A,h),w=B(t,A,h),v=1-B(t,A,p),_=1-B(s,A,p),b=1-B(s,c,p),x=1-B(t,c,p),m=B(t,c,h),y=B(s,c,h)):(C=1-B(t,h,A),w=1-B(s,h,A),v=B(s,p,A),_=B(t,p,A),b=B(t,p,c),x=B(s,p,c),m=1-B(s,h,c),y=1-B(t,h,c)),E.push(M[u]),E.push(I[u]),E.push(T[u]),E.push(L[u])):153===u?(0===d?(C=B(t,A,h),_=1-B(t,A,p),b=1-B(t,c,p),y=B(t,c,h)):(C=1-B(s,h,A),_=B(s,p,A),b=B(s,p,c),y=1-B(s,h,c)),E.push(M[u]),E.push(P[u])):102===u?(0===d?(w=1-B(t,h,A),v=B(t,p,A),x=B(t,p,c),m=1-B(t,h,c)):(w=B(s,A,h),v=1-B(s,A,p),x=1-B(s,c,p),m=B(s,c,h)),E.push(I[u]),E.push(L[u])):155===u?(4===d?(C=B(t,A,h),_=1-B(t,A,p),b=1-B(t,c,p),y=B(t,c,h)):(C=1-B(s,h,A),_=B(s,p,A),b=B(s,p,c),y=1-B(s,h,c)),E.push(M[u]),E.push(T[u])):103===u?(4===d?(w=1-B(t,h,A),v=B(t,p,A),x=B(t,p,c),m=1-B(t,h,c)):(w=B(s,A,h),v=1-B(s,A,p),x=1-B(s,c,p),m=B(s,c,h)),E.push(I[u]),E.push(S[u])):152===u?(0===d?(C=B(t,A,h),v=1-B(t,A,p),_=1-B(s,A,p),b=1-B(s,c,p),x=1-B(t,c,p),y=B(t,c,h)):(C=1-B(s,h,A),v=B(s,p,A),_=B(t,p,A),b=B(t,p,c),x=B(s,p,c),y=1-B(s,h,c)),E.push(M[u]),E.push(S[u]),E.push(P[u])):156===u?(4===d?(C=B(t,A,h),v=1-B(t,A,p),_=1-B(s,A,p),b=1-B(s,c,p),x=1-B(t,c,p),y=B(t,c,h)):(C=1-B(s,h,A),v=B(s,p,A),_=B(t,p,A),b=B(t,p,c),x=B(s,p,c),y=1-B(s,h,c)),E.push(M[u]),E.push(P[u]),E.push(L[u])):137===u?(0===d?(C=B(s,A,h),w=B(t,A,h),_=1-B(t,A,p),b=1-B(t,c,p),m=B(t,c,h),y=B(s,c,h)):(C=1-B(t,h,A),w=1-B(s,h,A),_=B(s,p,A),b=B(s,p,c),m=1-B(s,h,c),y=1-B(t,h,c)),E.push(M[u]),E.push(I[u]),E.push(P[u])):139===u?(4===d?(C=B(s,A,h),w=B(t,A,h),_=1-B(t,A,p),b=1-B(t,c,p),m=B(t,c,h),y=B(s,c,h)):(C=1-B(t,h,A),w=1-B(s,h,A),_=B(s,p,A),b=B(s,p,c),m=1-B(s,h,c),y=1-B(t,h,c)),E.push(M[u]),E.push(I[u]),E.push(T[u])):98===u?(0===d?(C=1-B(t,h,A),w=1-B(s,h,A),v=B(s,p,A),_=B(t,p,A),x=B(t,p,c),m=1-B(t,h,c)):(C=B(s,A,h),w=B(t,A,h),v=1-B(t,A,p),_=1-B(s,A,p),x=1-B(s,c,p),m=B(s,c,h)),E.push(M[u]),E.push(I[u]),E.push(L[u])):99===u?(4===d?(C=1-B(t,h,A),w=1-B(s,h,A),v=B(s,p,A),_=B(t,p,A),x=B(t,p,c),m=1-B(t,h,c)):(C=B(s,A,h),w=B(t,A,h),v=1-B(t,A,p),_=1-B(s,A,p),x=1-B(s,c,p),m=B(s,c,h)),E.push(M[u]),E.push(I[u]),E.push(P[u])):38===u?(0===d?(w=1-B(t,h,A),v=B(t,p,A),b=B(t,p,c),x=B(s,p,c),m=1-B(s,h,c),y=1-B(t,h,c)):(w=B(s,A,h),v=1-B(s,A,p),b=1-B(s,c,p),x=1-B(t,c,p),m=B(t,c,h),y=B(s,c,h)),E.push(I[u]),E.push(T[u]),E.push(L[u])):39===u?(4===d?(w=1-B(t,h,A),v=B(t,p,A),b=B(t,p,c),x=B(s,p,c),m=1-B(s,h,c),y=1-B(t,h,c)):(w=B(s,A,h),v=1-B(s,A,p),b=1-B(s,c,p),x=1-B(t,c,p),m=B(t,c,h),y=B(s,c,h)),E.push(I[u]),E.push(S[u]),E.push(L[u])):85===u&&(C=1,w=0,v=1,_=0,b=0,x=1,m=0,y=1),(m<0||m>1||y<0||y>1||C<0||C>1||v<0||v>1||b<0||b>1||x<0||x>1)&&console.log("MarchingSquaresJS-isoBands: "+u+" "+f+" "+c+","+h+","+A+","+p+" "+d+" "+m+" "+y+" "+C+" "+w+" "+v+" "+_+" "+b+" "+x),o.cells[a][l]={cval:u,cval_real:f,flipped:d,topleft:m,topright:y,righttop:C,rightbottom:w,bottomright:v,bottomleft:_,leftbottom:b,lefttop:x,edges:E}}}}}return o}(e,t,i);return ma.polygons?(ma.verbose&&console.log("MarchingSquaresJS-isoBands: returning single polygons for each grid cell"),l=function(e){var n=[],o=0;return e.cells.forEach(function(e,r){e.forEach(function(e,t){if(void 0!==e){var i=c[e.cval](e);"object"==typeof i&&Qr(i)?"object"==typeof i[0]&&Qr(i[0])?"object"==typeof i[0][0]&&Qr(i[0][0])?i.forEach(function(e){e.forEach(function(e){e[0]+=t,e[1]+=r}),n[o++]=e}):(i.forEach(function(e){e[0]+=t,e[1]+=r}),n[o++]=i):console.log("MarchingSquaresJS-isoBands: bandcell polygon with malformed coordinates"):console.log("MarchingSquaresJS-isoBands: bandcell polygon with null coordinates")}})}),n}(u)):(ma.verbose&&console.log("MarchingSquaresJS-isoBands: returning polygon paths for entire data grid"),l=function(e){for(var t=[],i=e.rows,r=e.cols,n=[],o=0;o<i;o++)for(var s=0;s<r;s++)if(void 0!==e.cells[o][s]&&e.cells[o][s].edges.length>0){var a=e.cells[o][s],l=function(e){if(e.edges.length>0){var t=e.edges[e.edges.length-1],i=e.cval_real;switch(t){case 0:return i&_a?{p:[1,e.righttop],x:-1,y:0,o:1}:{p:[e.topleft,1],x:0,y:-1,o:0};case 1:return i&va?{p:[e.topleft,1],x:0,y:-1,o:0}:{p:[1,e.rightbottom],x:-1,y:0,o:0};case 2:return i&va?{p:[e.bottomright,0],x:0,y:1,o:1}:{p:[e.topleft,1],x:0,y:-1,o:0};case 3:return i&Ca?{p:[e.topleft,1],x:0,y:-1,o:0}:{p:[e.bottomleft,0],x:0,y:1,o:0};case 4:return i&_a?{p:[1,e.righttop],x:-1,y:0,o:1}:{p:[e.topright,1],x:0,y:-1,o:1};case 5:return i&va?{p:[e.topright,1],x:0,y:-1,o:1}:{p:[1,e.rightbottom],x:-1,y:0,o:0};case 6:return i&va?{p:[e.bottomright,0],x:0,y:1,o:1}:{p:[e.topright,1],x:0,y:-1,o:1};case 7:return i&Ca?{p:[e.topright,1],x:0,y:-1,o:1}:{p:[e.bottomleft,0],x:0,y:1,o:0};case 8:return i&va?{p:[e.bottomright,0],x:0,y:1,o:1}:{p:[1,e.righttop],x:-1,y:0,o:1};case 9:return i&Ca?{p:[1,e.righttop],x:-1,y:0,o:1}:{p:[e.bottomleft,0],x:0,y:1,o:0};case 10:return i&Ca?{p:[0,e.leftbottom],x:1,y:0,o:0}:{p:[1,e.righttop],x:-1,y:0,o:1};case 11:return i&ya?{p:[1,e.righttop],x:-1,y:0,o:1}:{p:[0,e.lefttop],x:1,y:0,o:1};case 12:return i&va?{p:[e.bottomright,0],x:0,y:1,o:1}:{p:[1,e.rightbottom],x:-1,y:0,o:0};case 13:return i&Ca?{p:[1,e.rightbottom],x:-1,y:0,o:0}:{p:[e.bottomleft,0],x:0,y:1,o:0};case 14:return i&Ca?{p:[0,e.leftbottom],x:1,y:0,o:0}:{p:[1,e.rightbottom],x:-1,y:0,o:0};case 15:return i&ya?{p:[1,e.rightbottom],x:-1,y:0,o:0}:{p:[0,e.lefttop],x:1,y:0,o:1};case 16:return i&va?{p:[e.bottomright,0],x:0,y:1,o:1}:{p:[0,e.leftbottom],x:1,y:0,o:0};case 17:return i&ya?{p:[e.bottomright,0],x:0,y:1,o:1}:{p:[0,e.lefttop],x:1,y:0,o:1};case 18:return i&Ca?{p:[0,e.leftbottom],x:1,y:0,o:0}:{p:[e.bottomleft,0],x:0,y:1,o:0};case 19:return i&ya?{p:[e.bottomleft,0],x:0,y:1,o:0}:{p:[0,e.lefttop],x:1,y:0,o:1};case 20:return i&ya?{p:[e.topleft,1],x:0,y:-1,o:0}:{p:[0,e.leftbottom],x:1,y:0,o:0};case 21:return i&_a?{p:[0,e.leftbottom],x:1,y:0,o:0}:{p:[e.topright,1],x:0,y:-1,o:1};case 22:return i&ya?{p:[e.topleft,1],x:0,y:-1,o:0}:{p:[0,e.lefttop],x:1,y:0,o:1};case 23:return i&_a?{p:[0,e.lefttop],x:1,y:0,o:1}:{p:[e.topright,1],x:0,y:-1,o:1};default:console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(e)}}return null}(a),u=null,c=s,h=o;null!==l&&n.push([l.p[0]+c,l.p[1]+h]);do{if(null===(u=function(e,t,i,r){var n,o,s,a,l,u=e.cval;switch(t){case-1:switch(r){case 0:n=I[u],s=Ea[u],a=Ba[u],l=Ma[u];break;default:n=M[u],s=wa[u],a=xa[u],l=ba[u]}break;case 1:switch(r){case 0:n=T[u],s=Ra[u],a=Ua[u],l=ka[u];break;default:n=L[u],s=Fa[u],a=Na[u],l=Oa[u]}break;default:switch(i){case-1:switch(r){case 0:n=ja[u],s=p[u],a=f[u],l=d[u];break;default:n=Za[u],s=g[u],a=m[u],l=y[u]}break;case 1:switch(r){case 0:n=P[u],s=Ia[u],a=Sa[u],l=Pa[u];break;default:n=S[u],s=Ta[u],a=La[u],l=Da[u]}}}{if(o=e.edges.indexOf(n),void 0===e.edges[o])return null;!function(e,t){delete e.edges[t];for(var i=t+1;i<e.edges.length;i++)e.edges[i-1]=e.edges[i];e.edges.pop()}(e,o)}switch(u=e.cval_real,n){case 0:u&_a?(t=e.topleft,i=1):(t=1,i=e.righttop);break;case 1:u&va?(t=1,i=e.rightbottom):(t=e.topleft,i=1);break;case 2:u&va?(t=e.topleft,i=1):(t=e.bottomright,i=0);break;case 3:u&Ca?(t=e.bottomleft,i=0):(t=e.topleft,i=1);break;case 4:u&_a?(t=e.topright,i=1):(t=1,i=e.righttop);break;case 5:u&va?(t=1,i=e.rightbottom):(t=e.topright,i=1);break;case 6:u&va?(t=e.topright,i=1):(t=e.bottomright,i=0);break;case 7:u&Ca?(t=e.bottomleft,i=0):(t=e.topright,i=1);break;case 8:u&va?(t=1,i=e.righttop):(t=e.bottomright,i=0);break;case 9:u&Ca?(t=e.bottomleft,i=0):(t=1,i=e.righttop);break;case 10:u&Ca?(t=1,i=e.righttop):(t=0,i=e.leftbottom);break;case 11:u&ya?(t=0,i=e.lefttop):(t=1,i=e.righttop);break;case 12:u&va?(t=1,i=e.rightbottom):(t=e.bottomright,i=0);break;case 13:u&Ca?(t=e.bottomleft,i=0):(t=1,i=e.rightbottom);break;case 14:u&Ca?(t=1,i=e.rightbottom):(t=0,i=e.leftbottom);break;case 15:u&ya?(t=0,i=e.lefttop):(t=1,i=e.rightbottom);break;case 16:u&va?(t=0,i=e.leftbottom):(t=e.bottomright,i=0);break;case 17:u&ya?(t=0,i=e.lefttop):(t=e.bottomright,i=0);break;case 18:u&Ca?(t=e.bottomleft,i=0):(t=0,i=e.leftbottom);break;case 19:u&ya?(t=0,i=e.lefttop):(t=e.bottomleft,i=0);break;case 20:u&ya?(t=0,i=e.leftbottom):(t=e.topleft,i=1);break;case 21:u&_a?(t=e.topright,i=1):(t=0,i=e.leftbottom);break;case 22:u&ya?(t=0,i=e.lefttop):(t=e.topleft,i=1);break;case 23:u&_a?(t=e.topright,i=1):(t=0,i=e.lefttop);break;default:return console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(e),null}void 0!==t&&void 0!==i&&void 0!==s&&void 0!==a&&void 0!==l||(console.log("MarchingSquaresJS-isoBands: undefined value!"),console.log(e),console.log(t+" "+i+" "+s+" "+a+" "+l));return{p:[t,i],x:s,y:a,o:l}}(e.cells[h][c],l.x,l.y,l.o)))break;if(n.push([u.p[0]+c,u.p[1]+h]),c+=u.x,h+=u.y,l=u,h<0||h>=i||c<0||c>=r||void 0===e.cells[h][c]){c-=u.x,h-=u.y;var A=function(e,t,i,r,n,o){var s=e.cells[i][t],a=s.cval_real,l=t+r,u=i+n,c=[],h=!1;for(;!h;){if(void 0===e.cells[u]||void 0===e.cells[u][l])if(u-=n,l-=r,s=e.cells[u][l],a=s.cval_real,-1===n)if(0===o)if(a&Ca)c.push([l,u]),r=-1,n=0,o=0;else{if(!(a&va)){c.push([l+s.bottomright,u]),r=0,n=1,o=1,h=!0;break}c.push([l+1,u]),r=1,n=0,o=0}else{if(!(a&Ca)){if(a&va){c.push([l+s.bottomright,u]),r=0,n=1,o=1,h=!0;break}c.push([l+s.bottomleft,u]),r=0,n=1,o=0,h=!0;break}c.push([l,u]),r=-1,n=0,o=0}else if(1===n)if(0===o){if(!(a&_a)){if(a&ya){c.push([l+s.topleft,u+1]),r=0,n=-1,o=0,h=!0;break}c.push([l+s.topright,u+1]),r=0,n=-1,o=1,h=!0;break}c.push([l+1,u+1]),r=1,n=0,o=1}else c.push([l+1,u+1]),r=1,n=0,o=1;else if(-1===r)if(0===o){if(!(a&ya)){if(a&Ca){c.push([l,u+s.leftbottom]),r=1,n=0,o=0,h=!0;break}c.push([l,u+s.lefttop]),r=1,n=0,o=1,h=!0;break}c.push([l,u+1]),r=0,n=1,o=0}else{if(!(a&ya)){console.log("MarchingSquaresJS-isoBands: wtf");break}c.push([l,u+1]),r=0,n=1,o=0}else{if(1!==r){console.log("MarchingSquaresJS-isoBands: we came from nowhere!");break}if(0===o){if(!(a&va)){c.push([l+1,u+s.rightbottom]),r=-1,n=0,o=0,h=!0;break}c.push([l+1,u]),r=0,n=-1,o=1}else{if(!(a&va)){if(a&_a){c.push([l+1,u+s.righttop]),r=-1,n=0,o=1;break}c.push([l+1,u+s.rightbottom]),r=-1,n=0,o=0,h=!0;break}c.push([l+1,u]),r=0,n=-1,o=1}}else if(s=e.cells[u][l],a=s.cval_real,-1===r)if(0===o)if(void 0!==e.cells[u-1]&&void 0!==e.cells[u-1][l])r=0,n=-1,o=1;else{if(!(a&Ca)){c.push([l+s.bottomright,u]),r=0,n=1,o=1,h=!0;break}c.push([l,u])}else{if(!(a&ya)){console.log("MarchingSquaresJS-isoBands: found entry from top at "+l+","+u);break}console.log("MarchingSquaresJS-isoBands: proceeding in x-direction!")}else if(1===r){if(0===o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==e.cells[u+1]&&void 0!==e.cells[u+1][l])r=0,n=1,o=0;else{if(!(a&_a)){c.push([l+s.topleft,u+1]),r=0,n=-1,o=0,h=!0;break}c.push([l+1,u+1]),r=1,n=0,o=1}}else if(-1===n){if(1!==o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==e.cells[u][l+1])r=1,n=0,o=1;else{if(!(a&va)){c.push([l+1,u+s.righttop]),r=-1,n=0,o=1,h=!0;break}c.push([l+1,u]),r=0,n=-1,o=1}}else{if(1!==n){console.log("MarchingSquaresJS-isoBands: where did we came from???");break}if(0!==o){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==e.cells[u][l-1])r=-1,n=0,o=0;else{if(!(a&ya)){c.push([l,u+s.leftbottom]),r=1,n=0,o=0,h=!0;break}c.push([l,u+1]),r=0,n=1,o=0}}if(l+=r,u+=n,l===t&&u===i)break}return{path:c,i:l,j:u,x:r,y:n,o:o}}(e,c,h,u.x,u.y,u.o);if(null===A)break;A.path.forEach(function(e){n.push(e)}),c=A.i,h=A.j,l=A}}while(void 0!==e.cells[h][c]&&e.cells[h][c].edges.length>0);t.push(n),n=[],e.cells[o][s].edges.length>0&&s--}return t}(u)),"function"==typeof ma.successCallback&&ma.successCallback(l),l}function B(e,t,i){return(e-t)/(i-t)}function Qr(e){return e.constructor.toString().indexOf("Array")>-1}function Vr(e,n,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var o=t.pivot,i=t.mutate;if(!e)throw new Error("geojson is required");if(void 0===n||null===n||isNaN(n))throw new Error("angle is required");return 0===n?e:(o||(o=Kt(e)),!1!==i&&void 0!==i||(e=dt(e)),oe(e,function(e){var t=Oi(o,e)+n,i=Ui(o,e),r=x(Lr(o,i,t));e[0]=r[0],e[1]=r[1]}),e)}function Gr(i,r,e){if(e=e||{},!Q(e))throw new Error("options is invalid");var n=e.origin,t=e.mutate;if(!i)throw new Error("geojson required");if("number"!=typeof r||0===r)throw new Error("invalid factor");var o=Array.isArray(n)||"object"==typeof n;return!0!==t&&(i=dt(i)),"FeatureCollection"!==i.type||o?zr(i,r,n):(ue(i,function(e,t){i.features[t]=zr(e,r,n)}),i)}function zr(e,n,o){var t="Point"===Ie(e);return o=function(e,t){void 0!==t&&null!==t||(t="centroid");if(Array.isArray(t)||"object"==typeof t)return Ce(t);var i=e.bbox?e.bbox:ve(e),r=i[0],n=i[1],o=i[2],s=i[3];switch(t){case"sw":case"southwest":case"westsouth":case"bottomleft":return z([r,n]);case"se":case"southeast":case"eastsouth":case"bottomright":return z([o,n]);case"nw":case"northwest":case"westnorth":case"topleft":return z([r,s]);case"ne":case"northeast":case"eastnorth":case"topright":return z([o,s]);case"center":return qt(e);case void 0:case null:case"centroid":return Kt(e);default:throw new Error("invalid origin")}}(e,o),1===n||t?e:(oe(e,function(e){var t=Ui(o,e),i=Oi(o,e),r=x(Lr(o,t*n,i));e[0]=r[0],e[1]=r[1],3===e.length&&(e[2]*=n)}),e)}function Wr(e){var t=e[0],i=e[1];return[i[0]-t[0],i[1]-t[1]]}function qr(e,t){return e[0]*t[1]-t[0]*e[1]}function Kr(e,t){return!function(e,t){return 0===qr(Wr(e),Wr(t))}(e,t)&&function(e,t){var i=e[0],r=Wr(e),n=t[0],o=Wr(t),s=qr(r,o);return function(e,t){return[e[0]+t[0],e[1]+t[1]]}(i,function(e,t){return[e*t[0],e*t[1]]}(qr(function(e,t){return[e[0]-t[0],e[1]-t[1]]}(n,i),o)/s,r))}(e,t)}function jr(e,t,i){var o=[],s=Y(t,i),a=x(e),l=[];return a.forEach(function(e,t){if(t!==a.length-1){var i=function(e,t,i){var r=Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])),n=e[0]+i*(t[1]-e[1])/r,o=t[0]+i*(t[1]-e[1])/r,s=e[1]+i*(e[0]-t[0])/r,a=t[1]+i*(e[0]-t[0])/r;return[[n,s],[o,a]]}(e,a[t+1],s);if(o.push(i),t>0){var r=o[t-1],n=Kr(i,r);!1!==n&&(r[1]=n,i[0]=n),l.push(r[0]),t===a.length-2&&(l.push(i[0]),l.push(i[1]))}2===a.length&&(l.push(i[0]),l.push(i[1]))}}),W(l,e.properties)}function Zr(e,t,i){var r=t[0]-e[0],n=t[1]-e[1],o=i[0]-t[0],s=i[1]-t[1];return Math.sign(r*s-o*n)}function Yr(t,e){return e.geometry.coordinates[0].every(function(e){return at(z(e),t)})}function Xr(e,t){for(var i=0;i<e.coordinates.length-1;i++)if(function(e,t,i){var r=i[0]-e[0],n=i[1]-e[1],o=t[0]-e[0],s=t[1]-e[1];if(r*s-n*o!=0)return!1;return Math.abs(o)>=Math.abs(s)?o>0?e[0]<=i[0]&&i[0]<=t[0]:t[0]<=i[0]&&i[0]<=e[0]:s>0?e[1]<=i[1]&&i[1]<=t[1]:t[1]<=i[1]&&i[1]<=e[1]}(e.coordinates[i],e.coordinates[i+1],t.coordinates))return!0;return!1}function Jr(e,t){return Di(t,gr(e)).features.length>0}function $r(e,t){return!(e[0]>t[0])&&(!(e[2]<t[2])&&(!(e[1]>t[1])&&!(e[3]<t[3])))}function en(e,t){return e[0]===t[0]&&e[1]===t[1]}function tn(e,t){for(var i=!1,r=!1,n=e.coordinates.length,o=0;o<n&&!i&&!r;){for(var s=0;s<t.coordinates.length-1;s++){var a=!0;0!==s&&s!==t.coordinates.length-2||(a=!1),on(t.coordinates[s],t.coordinates[s+1],e.coordinates[o],a)?i=!0:r=!0}o++}return i&&r}function rn(e,t){return Di(e,gr(t)).features.length>0}function nn(e,t){for(var i=!1,r=!1,n=e.coordinates[0].length,o=0;o<n&&i&&r;)at(z(e.coordinates[0][o]),t)?i=!0:r=!0,o++;return r&&r}function on(e,t,i,r){var n=i[0]-e[0],o=i[1]-e[1],s=t[0]-e[0],a=t[1]-e[1];return 0==n*a-o*s&&(r?Math.abs(s)>=Math.abs(a)?s>0?e[0]<=i[0]&&i[0]<=t[0]:t[0]<=i[0]&&i[0]<=e[0]:a>0?e[1]<=i[1]&&i[1]<=t[1]:t[1]<=i[1]&&i[1]<=e[1]:Math.abs(s)>=Math.abs(a)?s>0?e[0]<i[0]&&i[0]<t[0]:t[0]<i[0]&&i[0]<e[0]:a>0?e[1]<i[1]&&i[1]<t[1]:t[1]<i[1]&&i[1]<e[1])}function sn(t){return t.coordinates.map(function(e){return{type:t.type.replace("Multi",""),coordinates:e}})}function an(e,t){return e.hasOwnProperty("coordinates")?e.coordinates.length===t.coordinates.length:e.length===t.length}function ln(e,t){return rl(e,t,{strict:!0})}function un(e,i){if(!e)throw new Error("feature1 is required");if(!i)throw new Error("feature2 is required");var t=Ie(e);if(t!==Ie(i))throw new Error("features must be of the same type");if("Point"===t)throw new Error("Point geometry not supported");if(new ol({precision:6}).compare(e,i))return!1;var r=0;switch(t){case"MultiPoint":var n=he(e),o=he(i);n.forEach(function(t){o.forEach(function(e){t[0]===e[0]&&t[1]===e[1]&&r++})});break;case"LineString":case"MultiLineString":ge(e,function(t){ge(i,function(e){Sr(t,e).features.length&&r++})});break;case"Polygon":case"MultiPolygon":ge(e,function(t){ge(i,function(e){Di(t,e).features.length&&r++})})}return r>0}function cn(e,t,i){i=i||[];for(var r=0;r<e;r++)i[r]=t;return i}function hn(e,t){if(e.geometry&&e.geometry.type)return e.geometry.type;if(e.type)return e.type;throw new Error("Invalid GeoJSON object for "+t)}function An(e){for(var t=e,i=[];t.parent;)i.unshift(t),t=t.parent;return i}function pn(e,t){t=t||{},this.nodes=[],this.diagonal=!!t.diagonal,this.grid=[];for(var i=0;i<e.length;i++){this.grid[i]=[];for(var r=0,n=e[i];r<n.length;r++){var o=new fn(i,r,n[r]);this.grid[i][r]=o,this.nodes.push(o)}}this.init()}function fn(e,t,i){this.x=e,this.y=t,this.weight=i}function dn(e){this.content=[],this.scoreFunction=e}function gn(e){return e[0]}function mn(e){return e[1]}function yn(){this._=null}function _n(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function vn(e,t){var i=t,r=t.R,n=i.U;n?n.L===i?n.L=r:n.R=r:e._=r,r.U=n,i.U=r,i.R=r.L,i.R&&(i.R.U=i),r.L=i}function Cn(e,t){var i=t,r=t.L,n=i.U;n?n.L===i?n.L=r:n.R=r:e._=r,r.U=n,i.U=r,i.L=r.R,i.L&&(i.L.U=i),r.R=i}function wn(e){for(;e.L;)e=e.L;return e}function xn(e,t,i,r){var n=[null,null],o=El.push(n)-1;return n.left=e,n.right=t,i&&En(n,e,t,i),r&&En(n,t,e,r),xl[e.index].halfedges.push(o),xl[t.index].halfedges.push(o),n}function bn(e,t,i){var r=[t,i];return r.left=e,r}function En(e,t,i,r){e[0]||e[1]?e.left===i?e[1]=r:e[0]=r:(e[0]=r,e.left=t,e.right=i)}function Bn(e,t,i,r,n){var o,s=e[0],a=e[1],l=s[0],u=s[1],c=0,h=1,A=a[0]-l,p=a[1]-u;if(o=t-l,A||!(o>0)){if(o/=A,A<0){if(o<c)return;o<h&&(h=o)}else if(A>0){if(o>h)return;o>c&&(c=o)}if(o=r-l,A||!(o<0)){if(o/=A,A<0){if(o>h)return;o>c&&(c=o)}else if(A>0){if(o<c)return;o<h&&(h=o)}if(o=i-u,p||!(o>0)){if(o/=p,p<0){if(o<c)return;o<h&&(h=o)}else if(p>0){if(o>h)return;o>c&&(c=o)}if(o=n-u,p||!(o<0)){if(o/=p,p<0){if(o>h)return;o>c&&(c=o)}else if(p>0){if(o<c)return;o<h&&(h=o)}return!(c>0||h<1)||(c>0&&(e[0]=[l+c*A,u+c*p]),h<1&&(e[1]=[l+h*A,u+h*p]),!0)}}}}}function Mn(e,t,i,r,n){var o=e[1];if(o)return!0;var s,a,l=e[0],u=e.left,c=e.right,h=u[0],A=u[1],p=c[0],f=c[1],d=(h+p)/2,g=(A+f)/2;if(f===A){if(d<t||d>=r)return;if(h>p){if(l){if(l[1]>=n)return}else l=[d,i];o=[d,n]}else{if(l){if(l[1]<i)return}else l=[d,n];o=[d,i]}}else if(s=(h-p)/(f-A),a=g-s*d,s<-1||s>1)if(h>p){if(l){if(l[1]>=n)return}else l=[(i-a)/s,i];o=[(n-a)/s,n]}else{if(l){if(l[1]<i)return}else l=[(n-a)/s,n];o=[(i-a)/s,i]}else if(A<f){if(l){if(l[0]>=r)return}else l=[t,s*t+a];o=[r,s*r+a]}else{if(l){if(l[0]<t)return}else l=[r,s*r+a];o=[t,s*t+a]}return e[0]=l,e[1]=o,!0}function In(e,t){var i=e.site,r=t.left,n=t.right;return i===n&&(n=r,r=i),n?Math.atan2(n[1]-r[1],n[0]-r[0]):(i===r?(r=t[1],n=t[0]):(r=t[0],n=t[1]),Math.atan2(r[0]-n[0],n[1]-r[1]))}function Sn(e,t){return t[+(t.left!==e.site)]}function Pn(e,t){return t[+(t.left===e.site)]}function Tn(e){var t=e.P,i=e.N;if(t&&i){var r=t.site,n=e.site,o=i.site;if(r!==o){var s=n[0],a=n[1],l=r[0]-s,u=r[1]-a,c=o[0]-s,h=o[1]-a,A=2*(l*h-u*c);if(!(A>=-Sl)){var p=l*l+u*u,f=c*c+h*h,d=(h*p-u*f)/A,g=(l*f-c*p)/A,m=Bl.pop()||new function(){_n(this),this.x=this.y=this.arc=this.site=this.cy=null};m.arc=e,m.site=n,m.x=d+s,m.y=(m.cy=g+a)+Math.sqrt(d*d+g*g),e.circle=m;for(var y=null,_=bl._;_;)if(m.y<_.y||m.y===_.y&&m.x<=_.x){if(!_.L){y=_.P;break}_=_.L}else{if(!_.R){y=_;break}_=_.R}bl.insert(y,m),y||(Cl=m)}}}}function Ln(e){var t=e.circle;t&&(t.P||(Cl=t.N),bl.remove(t),Bl.push(t),_n(t),e.circle=null)}function Dn(e){var t=Ml.pop()||new function(){_n(this),this.edge=this.site=this.circle=null};return t.site=e,t}function Fn(e){Ln(e),wl.remove(e),Ml.push(e),_n(e)}function Nn(e){var t=e.circle,i=t.x,r=t.cy,n=[i,r],o=e.P,s=e.N,a=[e];Fn(e);for(var l=o;l.circle&&Math.abs(i-l.circle.x)<Il&&Math.abs(r-l.circle.cy)<Il;)o=l.P,a.unshift(l),Fn(l),l=o;a.unshift(l),Ln(l);for(var u=s;u.circle&&Math.abs(i-u.circle.x)<Il&&Math.abs(r-u.circle.cy)<Il;)s=u.N,a.push(u),Fn(u),u=s;a.push(u),Ln(u);var c,h=a.length;for(c=1;c<h;++c)u=a[c],l=a[c-1],En(u.edge,l.site,u.site,n);l=a[0],(u=a[h-1]).edge=xn(l.site,u.site,null,n),Tn(l),Tn(u)}function On(e){for(var t,i,r,n,o=e[0],s=e[1],a=wl._;a;)if((r=Rn(a,s)-o)>Il)a=a.L;else{if(!((n=o-function(e,t){var i=e.N;if(i)return Rn(i,t);var r=e.site;return r[1]===t?r[0]:1/0}(a,s))>Il)){r>-Il?(t=a.P,i=a):n>-Il?(t=a,i=a.N):t=i=a;break}if(!a.R){t=a;break}a=a.R}!function(e){xl[e.index]={site:e,halfedges:[]}}(e);var l=Dn(e);if(wl.insert(t,l),t||i){if(t===i)return Ln(t),i=Dn(t.site),wl.insert(l,i),l.edge=i.edge=xn(t.site,l.site),Tn(t),void Tn(i);if(i){Ln(t),Ln(i);var u=t.site,c=u[0],h=u[1],A=e[0]-c,p=e[1]-h,f=i.site,d=f[0]-c,g=f[1]-h,m=2*(A*g-p*d),y=A*A+p*p,_=d*d+g*g,v=[(g*y-p*_)/m+c,(A*_-d*y)/m+h];En(i.edge,u,f,v),l.edge=xn(u,e,null,v),i.edge=xn(e,f,null,v),Tn(t),Tn(i)}else l.edge=xn(t.site,l.site)}}function Rn(e,t){var i=e.site,r=i[0],n=i[1],o=n-t;if(!o)return r;var s=e.P;if(!s)return-1/0;var a=(i=s.site)[0],l=i[1],u=l-t;if(!u)return a;var c=a-r,h=1/o-1/u,A=c/u;return h?(-A+Math.sqrt(A*A-2*h*(c*c/(-2*u)-l+u/2+n-o/2)))/h+r:(r+a)/2}function Un(e,t,i){return(e[0]-i[0])*(t[1]-e[1])-(e[0]-t[0])*(i[1]-e[1])}function kn(e,t){return t[1]-e[1]||t[0]-e[0]}function Hn(e,t){var i,r,n,o=e.sort(kn).pop();for(El=[],xl=new Array(e.length),wl=new yn,bl=new yn;;)if(n=Cl,o&&(!n||o[1]<n.y||o[1]===n.y&&o[0]<n.x))o[0]===i&&o[1]===r||(On(o),i=o[0],r=o[1]),o=e.pop();else{if(!n)break;Nn(n.arc)}if(function(){for(var e,t,i,r,n=0,o=xl.length;n<o;++n)if((e=xl[n])&&(r=(t=e.halfedges).length)){var s=new Array(r),a=new Array(r);for(i=0;i<r;++i)s[i]=i,a[i]=In(e,El[t[i]]);for(s.sort(function(e,t){return a[t]-a[e]}),i=0;i<r;++i)a[i]=t[s[i]];for(i=0;i<r;++i)t[i]=a[i]}}(),t){var s=+t[0][0],a=+t[0][1],l=+t[1][0],u=+t[1][1];!function(e,t,i,r){for(var n,o=El.length;o--;)Mn(n=El[o],e,t,i,r)&&Bn(n,e,t,i,r)&&(Math.abs(n[0][0]-n[1][0])>Il||Math.abs(n[0][1]-n[1][1])>Il)||delete El[o]}(s,a,l,u),function(e,t,i,r){var n,o,s,a,l,u,c,h,A,p,f,d,g=xl.length,m=!0;for(n=0;n<g;++n)if(o=xl[n]){for(s=o.site,a=(l=o.halfedges).length;a--;)El[l[a]]||l.splice(a,1);for(a=0,u=l.length;a<u;)f=(p=Pn(o,El[l[a]]))[0],d=p[1],h=(c=Sn(o,El[l[++a%u]]))[0],A=c[1],(Math.abs(f-h)>Il||Math.abs(d-A)>Il)&&(l.splice(a,0,El.push(bn(s,p,Math.abs(f-e)<Il&&r-d>Il?[e,Math.abs(h-e)<Il?A:r]:Math.abs(d-r)<Il&&i-f>Il?[Math.abs(A-r)<Il?h:i,r]:Math.abs(f-i)<Il&&d-t>Il?[i,Math.abs(h-i)<Il?A:t]:Math.abs(d-t)<Il&&f-e>Il?[Math.abs(A-t)<Il?h:e,t]:null))-1),++u);u&&(m=!1)}if(m){var y,_,v,C=1/0;for(n=0,m=null;n<g;++n)(o=xl[n])&&(v=(y=(s=o.site)[0]-e)*y+(_=s[1]-t)*_)<C&&(C=v,m=o);if(m){var w=[e,t],x=[e,r],b=[i,r],E=[i,t];m.halfedges.push(El.push(bn(s=m.site,w,x))-1,El.push(bn(s,x,b))-1,El.push(bn(s,b,E))-1,El.push(bn(s,E,w))-1)}}for(n=0;n<g;++n)(o=xl[n])&&(o.halfedges.length||delete xl[n])}(s,a,l,u)}this.edges=El,this.cells=xl,wl=bl=El=xl=null}function Qn(e){return(e=e.slice()).push(e[0]),k([e])}function Vn(e,t,i,r){var n=(r=r||{}).steps||64,o=r.units||"kilometers",s=r.angle||0,a=r.pivot||e,l=r.properties||e.properties||{};if(!e)throw new Error("center is required");if(!t)throw new Error("xSemiAxis is required");if(!i)throw new Error("ySemiAxis is required");if(!Q(r))throw new Error("options must be an object");if(!ie(n))throw new Error("steps must be a number");if(!ie(s))throw new Error("angle must be a number");var u=Ce(e);if("degrees"===o)var c=$(s);else t=Lr(e,t,90,{units:o}),i=Lr(e,i,0,{units:o}),t=Ce(t)[0]-u[0],i=Ce(i)[1]-u[1];for(var h=[],A=0;A<n;A+=1){var p=-360*A/n,f=t*i/Math.sqrt(Math.pow(i,2)+Math.pow(t,2)*Math.pow(Gn(p),2)),d=t*i/Math.sqrt(Math.pow(t,2)+Math.pow(i,2)/Math.pow(Gn(p),2));if(p<-90&&p>=-270&&(f=-f),p<-180&&p>=-360&&(d=-d),"degrees"===o){var g=f*Math.cos(c)+d*Math.sin(c),m=d*Math.cos(c)-f*Math.sin(c);f=g,d=m}h.push([f+u[0],d+u[1]])}return h.push(h[0]),"degrees"===o?k([h],l):Vr(k([h],l),s,{pivot:a})}function Gn(e){var t=e*Math.PI/180;return Math.tan(t)}function zn(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=t.properties,n=t.weight;if(!e)throw new Error("geojson is required");var o=0,s=0,a=0;return Ae(e,function(e,t,i){var r=i[n];if(r=void 0===r||null===r?1:r,!ie(r))throw new Error("weight value must be a number for feature index "+t);(r=Number(r))>0&&oe(e,function(e){o+=e[0]*r,s+=e[1]*r,a+=r})}),z([o/a,s/a],i)}function Wn(o,e,t,i){var r=t.properties.tolerance||.001,s=0,a=0,l=0,u=0;if(ue(t,function(e){var t=e.properties.weight,i=void 0===t||null===t?1:t;if(i=Number(i),!ie(i))throw new Error("weight value must be a number");if(i>0){u+=1;var r=i*ft(e,o);0===r&&(r=1);var n=i/r;s+=e.geometry.coordinates[0]*n,a+=e.geometry.coordinates[1]*n,l+=n}}),u<1)throw new Error("no features to measure");var n=s/l,c=a/l;return 1===u||0===i||Math.abs(n-e[0])<r&&Math.abs(c-e[1])<r?z([n,c],{medianCandidates:t.properties.medianCandidates}):(t.properties.medianCandidates.push([n,c]),Wn([n,c],o,t,i-1))}function qn(e,t){return{x:e[0]-t[0],y:e[1]-t[1]}}function Kn(e){if(Q(e)&&(e=e.bbox),e&&!Array.isArray(e))throw new Error("bbox is invalid");return e?function(e){return[Math.random()*(e[2]-e[0])+e[0],Math.random()*(e[3]-e[1])+e[1]]}(e):[360*Xn(),180*Xn()]}function jn(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=t.bbox;void 0!==e&&null!==e||(e=1);for(var r=[],n=0;n<e;n++)r.push(z(Kn(i)));return H(r)}function Zn(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=t.bbox,r=t.num_vertices,n=t.max_radial_length;void 0!==e&&null!==e||(e=1),ie(r)||(r=10),ie(n)||(n=10);for(var o=[],s=0;s<e;s++){var a=[],l=Array.apply(null,new Array(r+1)).map(Math.random);l.forEach(function(e,t,i){i[t]=t>0?e+i[t-1]:e}),l.forEach(function(e){e=2*e*Math.PI/l[l.length-1];var t=Math.random();a.push([t*n*Math.sin(e),t*n*Math.cos(e)])}),a[a.length-1]=a[0],a=a.map(function(t){return function(e){return[e[0]+t[0],e[1]+t[1]]}}(Kn(i))),o.push(k([a]))}return H(o)}function Yn(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=t.bbox,r=t.num_vertices,n=t.max_length,o=t.max_rotation;void 0!==e&&null!==e||(e=1),(!ie(r)||r<2)&&(r=10),ie(n)||(n=1e-4),ie(o)||(o=Math.PI/8);for(var s=[],a=0;a<e;a++){for(var l=[Kn(i)],u=0;u<r-1;u++){var c=(0===u?2*Math.random()*Math.PI:Math.tan((l[u][1]-l[u-1][1])/(l[u][0]-l[u-1][0])))+(Math.random()-.5)*o*2,h=Math.random()*n;l.push([l[u][0]+h*Math.cos(c),l[u][1]+h*Math.sin(c)])}s.push(W(l))}return H(s)}function Xn(){return Math.random()-.5}function Jn(e,t){if(!e)throw new Error("geojson is required");if("FeatureCollection"!==e.type)throw new Error("geojson must be a FeatureCollection");if(void 0===t||null===t)throw new Error("filter is required");var i=[];return ue(e,function(e){io(e.properties,t)&&i.push(e)}),H(i)}function $n(e,t,i){if(!e)throw new Error("geojson is required");if("FeatureCollection"!==e.type)throw new Error("geojson must be a FeatureCollection");if(void 0===t||null===t)throw new Error("property is required");for(var r=to(e,t),n=Object.keys(r),o=0;o<n.length;o++){for(var s=n[o],a=r[s],l=[],u=0;u<a.length;u++)l.push(e.features[a[u]]);i(H(l),s,o)}}function eo(e,t,r,n){var o=n;return $n(e,t,function(e,t,i){o=0===i&&void 0===n?e:r(o,e,t,i)}),o}function to(e,n){var o={};return ue(e,function(e,t){var i=e.properties||{};if(i.hasOwnProperty(n)){var r=i[n];o.hasOwnProperty(r)?o[r].push(t):o[r]=[t]}}),o}function io(e,t){if(void 0===e)return!1;var i=typeof t;if("number"===i||"string"===i)return e.hasOwnProperty(t);if(Array.isArray(t)){for(var r=0;r<t.length;r++)if(!io(e,t[r]))return!1;return!0}return ro(e,t)}function ro(e,t){for(var i=Object.keys(t),r=0;r<i.length;r++){var n=i[r];if(e[n]!==t[n])return!1}return!0}function no(e,t){if(!t)return{};if(!t.length)return{};for(var i={},r=0;r<t.length;r++){var n=t[r];e.hasOwnProperty(n)&&(i[n]=e[n])}return i}function oo(){}function so(e){this.message=e||""}function ao(e){this.message=e||""}function lo(){}function uo(e){return null===e?ku:e.color}function co(e){return null===e?null:e.parent}function ho(e,t){null!==e&&(e.color=t)}function Ao(e){return null===e?null:e.left}function po(e){return null===e?null:e.right}function fo(){this.root_=null,this.size_=0}function go(){}function mo(){this.array_=[],arguments[0]instanceof Bu&&this.addAll(arguments[0])}function yo(){}function _o(e){this.message=e||""}function vo(){this.array_=[]}function Co(e){switch(e.type){case"Polygon":return ji(e)>1?e:null;case"MultiPolygon":var t=[];if(fe(e,function(e){ji(e)>1&&t.push(e.geometry.coordinates)}),t.length)return{type:"MultiPolygon",coordinates:t}}}function wo(){this.reset()}function xo(e,t,i){var r=e.s=t+i,n=r-t,o=r-n;e.t=t-o+(i-n)}function bo(e){return e>1?kp:e<-1?-kp:Math.asin(e)}function Eo(){}function Bo(e,t){e&&ef.hasOwnProperty(e.type)&&ef[e.type](e,t)}function Mo(e,t,i){var r,n=-1,o=e.length-i;for(t.lineStart();++n<o;)r=e[n],t.point(r[0],r[1],r[2]);t.lineEnd()}function Io(e,t){var i=-1,r=e.length;for(t.polygonStart();++i<r;)Mo(e[i],t,1);t.polygonEnd()}function So(e){return[qp(e[1],e[0]),bo(e[2])]}function Po(e){var t=e[0],i=e[1],r=Kp(i);return[r*Kp(t),r*Yp(t),Yp(i)]}function To(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Lo(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Do(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Fo(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function No(e){var t=Xp(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function Oo(e,t){return[e>Up?e-Qp:e<-Up?e+Qp:e,t]}function Ro(e,t,i){return(e%=Qp)?t||i?rf(ko(e),Ho(t,i)):ko(e):t||i?Ho(t,i):Oo}function Uo(i){return function(e,t){return e+=i,[e>Up?e-Qp:e<-Up?e+Qp:e,t]}}function ko(e){var t=Uo(e);return t.invert=Uo(-e),t}function Ho(e,t){function i(e,t){var i=Kp(t),r=Kp(e)*i,n=Yp(e)*i,o=Yp(t),s=o*a+r*l;return[qp(n*u-s*c,r*a-o*l),bo(s*u+n*c)]}var a=Kp(e),l=Yp(e),u=Kp(t),c=Yp(t);return i.invert=function(e,t){var i=Kp(t),r=Kp(e)*i,n=Yp(e)*i,o=Yp(t),s=o*u-n*c;return[qp(n*u+o*c,r*a+s*l),bo(s*a-r*l)]},i}function Qo(e,t){(t=Po(t))[0]-=e,No(t);var i=function(e){return e>1?0:e<-1?Up:Math.acos(e)}(-t[1]);return((-t[2]<0?-i:i)+Qp-Rp)%Qp}function Vo(e,t,i,r){this.x=e,this.z=t,this.o=i,this.e=r,this.v=!1,this.n=this.p=null}function Go(e){if(t=e.length){for(var t,i,r=0,n=e[0];++r<t;)n.n=i=e[r],i.p=n,n=i;n.n=i=e[0],i.p=n}}function zo(m,y,_,v){function C(e,t){return m<=e&&e<=_&&y<=t&&t<=v}function w(e,t,i,r){var n=0,o=0;if(null==e||(n=s(e,i))!==(o=s(t,i))||a(e,t)<0^i>0)do{r.point(0===n||3===n?m:_,n>1?v:y)}while((n=(n+i+4)%4)!==o);else r.point(t[0],t[1])}function s(e,t){return zp(e[0]-m)<Rp?t>0?0:3:zp(e[0]-_)<Rp?t>0?2:1:zp(e[1]-y)<Rp?t>0?1:0:t>0?3:2}function x(e,t){return a(e.x,t.x)}function a(e,t){var i=s(e,1),r=s(t,1);return i!==r?i-r:0===i?t[1]-e[1]:1===i?e[0]-t[0]:2===i?e[1]-t[1]:t[0]-e[0]}return function(r){function e(e,t){C(e,t)&&d.point(e,t)}function t(e,t){var i=C(e,t);if(h&&o.push([e,t]),p)s=e,a=t,l=i,p=!1,i&&(d.lineStart(),d.point(e,t));else if(i&&A)d.point(e,t);else{var r=[u=Math.max(Af,Math.min(hf,u)),c=Math.max(Af,Math.min(hf,c))],n=[e=Math.max(Af,Math.min(hf,e)),t=Math.max(Af,Math.min(hf,t))];sf(r,n,m,y,_,v)?(A||(d.lineStart(),d.point(r[0],r[1])),d.point(n[0],n[1]),i||d.lineEnd(),f=!1):i&&(d.lineStart(),d.point(e,t),f=!1)}u=e,c=t,A=i}var n,h,o,s,a,l,u,c,A,p,f,d=r,i=of(),g={point:e,lineStart:function(){g.point=t,h&&h.push(o=[]),p=!0,A=!1,u=c=NaN},lineEnd:function(){n&&(t(s,a),l&&A&&i.rejoin(),n.push(i.result())),g.point=e,A&&d.lineEnd()},polygonStart:function(){d=i,n=[],h=[],f=!0},polygonEnd:function(){var e=function(){for(var e=0,t=0,i=h.length;t<i;++t)for(var r,n,o=h[t],s=1,a=o.length,l=o[0],u=l[0],c=l[1];s<a;++s)r=u,n=c,u=(l=o[s])[0],c=l[1],n<=v?c>v&&(u-r)*(v-n)>(c-n)*(m-r)&&++e:c<=v&&(u-r)*(v-n)<(c-n)*(m-r)&&--e;return e}(),t=f&&e,i=(n=cf(n)).length;(t||i)&&(r.polygonStart(),t&&(r.lineStart(),w(null,null,1,r),r.lineEnd()),i&&lf(n,x,e,w,r),r.polygonEnd()),d=r,n=h=o=null}};return g}}function Wo(e){return e.length>1}function qo(e,t){return((e=e.x)[0]<0?e[1]-kp-Rp:kp-e[1])-((t=t.x)[0]<0?t[1]-kp-Rp:kp-t[1])}function Ko(r){return function(e){var t=new jo;for(var i in r)t[i]=r[i];return t.stream=e,t}}function jo(){}function Zo(e,t,i){var r=t[1][0]-t[0][0],n=t[1][1]-t[0][1],o=e.clipExtent&&e.clipExtent();e.scale(150).translate([0,0]),null!=o&&e.clipExtent(null),tf(i,e.stream(_f));var s=_f.result(),a=Math.min(r/(s[1][0]-s[0][0]),n/(s[1][1]-s[0][1])),l=+t[0][0]+(r-a*(s[1][0]+s[0][0]))/2,u=+t[0][1]+(n-a*(s[1][1]+s[0][1]))/2;return null!=o&&e.clipExtent(o),e.scale(150*a).translate([l,u])}function Yo(e){return function(e){function i(e){return e=u(e[0]*Gp,e[1]*Gp),[e[0]*d+s,a-e[1]*d]}function t(e,t){return e=o(e,t),[e[0]*d+s,a-e[1]*d]}function r(){u=rf(l=Ro(v,C,w),o);var e=o(y,_);return s=g-e[0]*d,a=m+e[1]*d,n()}function n(){return p=f=null,i}var o,s,a,l,u,c,h,A,p,f,d=150,g=480,m=250,y=0,_=0,v=0,C=0,w=0,x=null,b=Cf,E=null,B=ff,M=.5,I=Ef(t,M);i.stream=function(e){return p&&f===e?p:p=Bf(b(l,I(B(f=e))))},i.clipAngle=function(e){return arguments.length?(b=+e?wf(x=e*Gp,6*Gp):(x=null,Cf),n()):x*Vp},i.clipExtent=function(e){return arguments.length?(B=null==e?(E=c=h=A=null,ff):zo(E=+e[0][0],c=+e[0][1],h=+e[1][0],A=+e[1][1]),n()):null==E?null:[[E,c],[h,A]]},i.scale=function(e){return arguments.length?(d=+e,r()):d},i.translate=function(e){return arguments.length?(g=+e[0],m=+e[1],r()):[g,m]},i.center=function(e){return arguments.length?(y=e[0]%360*Gp,_=e[1]%360*Gp,r()):[y*Vp,_*Vp]},i.rotate=function(e){return arguments.length?(v=e[0]%360*Gp,C=e[1]%360*Gp,w=e.length>2?e[2]%360*Gp:0,r()):[v*Vp,C*Vp,w*Vp]},i.precision=function(e){return arguments.length?(I=Ef(t,M=e*e),n()):Xp(M)},i.fitExtent=function(e,t){return Zo(i,e,t)},i.fitSize=function(e,t){return function(e,t,i){return Zo(e,[[0,0],t],i)}(i,e,t)};return function(){return o=e.apply(this,arguments),i.invert=o.invert&&function(e){return(e=u.invert((e[0]-s)/d,(a-e[1])/d))&&[e[0]*Vp,e[1]*Vp]},r()}}(function(){return e})()}function Xo(e,t){return[e,Zp(Jp((kp+t)/2))]}function Jo(e,t){return[Zp(Jp((kp+t)/2)),-e]}function $o(e,i,r,n){var t=e.properties||{},o="Feature"===e.type?e.geometry:e;if("GeometryCollection"===o.type){var s=[];return Ae(e,function(e){var t=$o(e,i,r,n);t&&s.push(t)}),H(s)}var a,l=ve(e),u=l[1]>50&&l[3]>50;a=u?{type:o.type,coordinates:ts(o.coordinates,rs(o))}:ki(o);var c=(new Mc).read(a),h=j(Z(i,r),"meters"),A=dA.bufferOp(c,h);if(A=(new Ic).write(A),!es(A.coordinates)){var p;return(p=u?{type:A.type,coordinates:is(A.coordinates,rs(o))}:Hi(A)).geometry?p:G(p,t)}}function es(e){return Array.isArray(e[0])?es(e[0]):isNaN(e[0])}function ts(e,t){return"object"!=typeof e[0]?t(e):e.map(function(e){return ts(e,t)})}function is(e,t){return"object"!=typeof e[0]?t.invert(e):e.map(function(e){return is(e,t)})}function rs(e){var t=qt(e).geometry.coordinates.reverse(),i=t.map(function(e){return-e});return Mf().center(t).rotate(i).scale(As)}function ns(){for(var e=new Mc,t=e.read(JSON.stringify(arguments[0].geometry)),i=1;i<arguments.length;i++)t=Fp.union(t,e.read(JSON.stringify(arguments[i].geometry)));return t=(new Ic).write(t),{type:"Feature",geometry:t,properties:arguments[0].properties}}function os(e,t){var i=Be(e),r=Be(t);if(Tt(sr(r,{precision:4})).coordinates[0].length<4)return null;if(Tt(sr(i,{precision:4})).coordinates[0].length<4)return null;var n=new Mc,o=n.read(sr(i)),s=n.read(sr(r)),a=A.intersection(o,s);if(a.isEmpty())return null;return G((new Ic).write(a))}function ss(e,t){return function(r,e,n){var o,s;if(!Array.isArray(e))throw new Error("Get closest expects an array as second argument");return e.forEach(function(e,t){var i=n(e,r);i>=0&&(void 0===s||i<s)&&(s=i,o=t)}),o}(e,t,function(e,t){return e-t})}function as(e,t,i){if(i=i||{},!Q(i))throw new Error("options is invalid");var r=i.properties||{},n=i.triangles,o=i.mask;if(null===t||void 0===t)throw new Error("cellSide is required");if(!ie(t))throw new Error("cellSide is invalid");if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be array");if(4!==e.length)throw new Error("bbox must contain 4 numbers");if(o&&-1===["Polygon","MultiPolygon"].indexOf(Ie(o)))throw new Error("options.mask must be a (Multi)Polygon");var s=e[0],a=e[1],l=e[2],u=e[3],c=(a+u)/2,h=(s+l)/2,A=2*t/ft([s,c],[l,c],i)*(l-s),p=2*t/ft([h,a],[h,u],i)*(u-a),f=A/2,d=2*f,g=Math.sqrt(3)/2*p,m=l-s,y=u-a,_=.75*d,v=g,O=(m-d)/(d-f/2),C=Math.floor(O),R=(C*_-f/2-m)/2-f/2+_/2,w=Math.floor((y-g)/g),x=(y-w*g)/2,b=w*g-y>g/2;b&&(x-=g/4);for(var E=[],B=[],M=0;M<6;M++){var I=2*Math.PI/6*M;E.push(Math.cos(I)),B.push(Math.sin(I))}for(var S=[],P=0;P<=C;P++)for(var T=0;T<=w;T++){var L=P%2==1;if((0!==T||!L)&&(0!==T||!b)){var D=P*_+s-R,F=T*v+a+x;if(L&&(F-=g/2),!0===n)(function(e,t,i,r,n,o){for(var s=[],a=0;a<6;a++){var l=[];l.push(e),l.push([e[0]+t*n[a],e[1]+i*o[a]]),l.push([e[0]+t*n[(a+1)%6],e[1]+i*o[(a+1)%6]]),l.push(e),s.push(k([l],r))}return s})([D,F],A/2,p/2,r,E,B).forEach(function(e){o?os(o,e)&&S.push(e):S.push(e)});else{var N=function(e,t,i,r,n,o){for(var s=[],a=0;a<6;a++){var l=e[0]+t*n[a],u=e[1]+i*o[a];s.push([l,u])}return s.push(s[0].slice()),k([s],r)}([D,F],A/2,p/2,r,E,B);o?os(o,N)&&S.push(N):S.push(N)}}}return H(S)}function ls(e){if(e.features.length<=1)return e;var o=function(e){var t=ws(),r=[];return fe(e,function(e,t){var i=ve(e);r.push({minX:i[0],minY:i[1],maxX:i[2],maxY:i[3],geojson:e,index:t})}),t.load(r),t}(e),s=[],a={};return fe(e,function(e,t){if(a[t])return!0;for(o.remove({index:t},us),a[t]=!0;;){var i=ve(e),r=o.search({minX:i[0],minY:i[1],maxX:i[2],maxY:i[3]});if(r.length>0){var n=r.map(function(e){return a[e.index]=!0,o.remove({index:e.index},us),e.geojson});n.push(e),e=ns.apply(this,n)}if(0===r.length)break}s.push(e)}),H(s)}function us(e,t){return e.index===t.index}function cs(e,t,i){if(i=i||{},!Q(i))throw new Error("options is invalid");var r=i.properties,n=i.mask,o=[];if(null===t||void 0===t)throw new Error("cellSide is required");if(!ie(t))throw new Error("cellSide is invalid");if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be array");if(4!==e.length)throw new Error("bbox must contain 4 numbers");if(n&&-1===["Polygon","MultiPolygon"].indexOf(Ie(n)))throw new Error("options.mask must be a (Multi)Polygon");for(var s=e[0],a=e[1],l=e[2],u=e[3],c=t/ft([s,a],[l,a],i)*(l-s),h=t/ft([s,a],[s,u],i)*(u-a),A=l-s,p=u-a,f=Math.floor(A/c),d=Math.floor(p/h),g=(p-d*h)/2,m=s+(A-f*c)/2,y=0;y<f;y++){for(var _=a+g,v=0;v<d;v++){var C=k([[[m,_],[m,_+h],[m+c,_+h],[m+c,_],[m,_]]],r);n?os(n,C)&&o.push(C):o.push(C),_+=h}m+=c}return H(o)}function hs(e,t,i){if(i=i||{},!Q(i))throw new Error("options is invalid");var r=i.properties,n=i.mask,o=[];if(null===t||void 0===t)throw new Error("cellSide is required");if(!ie(t))throw new Error("cellSide is invalid");if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be array");if(4!==e.length)throw new Error("bbox must contain 4 numbers");if(n&&-1===["Polygon","MultiPolygon"].indexOf(Ie(n)))throw new Error("options.mask must be a (Multi)Polygon");for(var s=t/ft([e[0],e[1]],[e[2],e[1]],i)*(e[2]-e[0]),a=t/ft([e[0],e[1]],[e[0],e[3]],i)*(e[3]-e[1]),l=0,u=e[0];u<=e[2];){for(var c=0,h=e[1];h<=e[3];){var A=null,p=null;l%2==0&&c%2==0?(A=k([[[u,h],[u,h+a],[u+s,h],[u,h]]],r),p=k([[[u,h+a],[u+s,h+a],[u+s,h],[u,h+a]]],r)):l%2==0&&c%2==1?(A=k([[[u,h],[u+s,h+a],[u+s,h],[u,h]]],r),p=k([[[u,h],[u,h+a],[u+s,h+a],[u,h]]],r)):c%2==0&&l%2==1?(A=k([[[u,h],[u,h+a],[u+s,h+a],[u,h]]],r),p=k([[[u,h],[u+s,h+a],[u+s,h],[u,h]]],r)):c%2==1&&l%2==1&&(A=k([[[u,h],[u,h+a],[u+s,h],[u,h]]],r),p=k([[[u,h+a],[u+s,h+a],[u+s,h],[u,h+a]]],r)),n?(os(n,A)&&o.push(A),os(n,p)&&o.push(p)):(o.push(A),o.push(p)),h+=a,c++}l++,u+=s}return H(o)}var As=6371008.8,ps={meters:As,metres:As,millimeters:1e3*As,millimetres:1e3*As,centimeters:100*As,centimetres:100*As,kilometers:As/1e3,kilometres:As/1e3,miles:As/1609.344,nauticalmiles:As/1852,inches:39.37*As,yards:As/1.0936,feet:3.28084*As,radians:1,degrees:As/111325},fs={meters:1,metres:1,millimeters:1e3,millimetres:1e3,centimeters:100,centimetres:100,kilometers:.001,kilometres:.001,miles:1/1609.344,nauticalmiles:1/1852,inches:39.37,yards:1/1.0936,feet:3.28084,radians:1/As,degrees:1/111325},ds={meters:1,metres:1,millimeters:1e6,millimetres:1e6,centimeters:1e4,centimetres:1e4,kilometers:1e-6,kilometres:1e-6,acres:247105e-9,miles:386e-9,yards:1.195990046,feet:10.763910417,inches:1550.003100006},gs=Object.freeze({earthRadius:As,factors:ps,unitsFactors:fs,areaFactors:ds,feature:G,geometry:t,point:z,points:i,polygon:k,polygons:r,lineString:W,lineStrings:n,featureCollection:H,multiLineString:q,multiPoint:o,multiPolygon:K,geometryCollection:s,round:a,radiansToLength:j,lengthToRadians:Z,lengthToDegrees:Y,bearingToAzimuth:X,radiansToDegrees:J,degreesToRadians:$,convertLength:ee,convertArea:te,isNumber:ie,isObject:Q,validateBBox:re,validateId:ne,radians2degrees:function(){throw new Error("method has been renamed to `radiansToDegrees`")},degrees2radians:function(){throw new Error("method has been renamed to `degreesToRadians`")},distanceToDegrees:function(){throw new Error("method has been renamed to `lengthToDegrees`")},distanceToRadians:function(){throw new Error("method has been renamed to `lengthToRadians`")},radiansToDistance:function(){throw new Error("method has been renamed to `radiansToLength`")},bearingToAngle:function(){throw new Error("method has been renamed to `bearingToAzimuth`")},convertDistance:function(){throw new Error("method has been renamed to `convertLength`")}}),ms=Object.freeze({coordEach:oe,coordReduce:se,propEach:ae,propReduce:le,featureEach:ue,featureReduce:ce,coordAll:he,geomEach:Ae,geomReduce:pe,flattenEach:fe,flattenReduce:de,segmentEach:ge,segmentReduce:me,lineEach:ye,lineReduce:_e}),ys=Object.freeze({getCoord:Ce,getCoords:x,containsNumber:we,geojsonType:xe,featureOf:be,collectionOf:Ee,getGeom:Be,getGeomType:Me,getType:Ie}),_s={successCallback:null,verbose:!1},vs={},Cs=Ne,ws=Re,xs=(Re.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,i=[],r=this.toBBox;if(!qe(e,t))return i;for(var n,o,s,a,l=[];t;){for(n=0,o=t.children.length;n<o;n++)s=t.children[n],qe(e,a=t.leaf?r(s):s)&&(t.leaf?i.push(s):We(e,a)?this._all(s,i):l.push(s));t=l.pop()}return i},collides:function(e){var t=this.data,i=this.toBBox;if(!qe(e,t))return!1;for(var r,n,o,s,a=[];t;){for(r=0,n=t.children.length;r<n;r++)if(o=t.children[r],s=t.leaf?i(o):o,qe(e,s)){if(t.leaf||We(e,s))return!0;a.push(o)}t=a.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}var r=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var n=this.data;this.data=r,r=n}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=Ke([]),this},remove:function(e,t){if(!e)return this;for(var i,r,n,o,s=this.data,a=this.toBBox(e),l=[],u=[];s||l.length;){if(s||(s=l.pop(),r=l[l.length-1],i=u.pop(),o=!0),s.leaf&&-1!==(n=function(e,t,i){if(!i)return t.indexOf(e);for(var r=0;r<t.length;r++)if(i(e,t[r]))return r;return-1}(e,s.children,t)))return s.children.splice(n,1),l.push(s),this._condense(l),this;o||s.leaf||!We(s,a)?r?(i++,s=r.children[i],o=!1):s=null:(l.push(s),u.push(i),i=0,r=s,s=s.children[0])}return this},toBBox:function(e){return e},compareMinX:Qe,compareMinY:Ve,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},_build:function(e,t,i,r){var n,o=i-t+1,s=this._maxEntries;if(o<=s)return n=Ke(e.slice(t,i+1)),Ue(n,this.toBBox),n;r||(r=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,r-1))),(n=Ke([])).leaf=!1,n.height=r;var a,l,u,c,h=Math.ceil(o/s),A=h*Math.ceil(Math.sqrt(s));for(je(e,t,i,A,this.compareMinX),a=t;a<=i;a+=A)for(je(e,a,u=Math.min(a+A-1,i),h,this.compareMinY),l=a;l<=u;l+=h)c=Math.min(l+h-1,u),n.children.push(this._build(e,l,c,r-1));return Ue(n,this.toBBox),n},_chooseSubtree:function(e,t,i,r){for(var n,o,s,a,l,u,c,h;r.push(t),!t.leaf&&r.length-1!==i;){for(c=h=1/0,n=0,o=t.children.length;n<o;n++)l=Ge(s=t.children[n]),(u=function(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}(e,s)-l)<h?(h=u,c=l<c?l:c,a=s):u===h&&l<c&&(c=l,a=s);t=a||t.children[0]}return t},_insert:function(e,t,i){var r=this.toBBox,n=i?e:r(e),o=[],s=this._chooseSubtree(n,this.data,t,o);for(s.children.push(e),He(s,n);t>=0&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(n,o,t)},_split:function(e,t){var i=e[t],r=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,r);var o=this._chooseSplitIndex(i,n,r),s=Ke(i.children.splice(o,i.children.length-o));s.height=i.height,s.leaf=i.leaf,Ue(i,this.toBBox),Ue(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(i,s)},_splitRoot:function(e,t){this.data=Ke([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Ue(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,i){var r,n,o,s,a,l,u,c;for(l=u=1/0,r=t;r<=i-t;r++)s=function(e,t){var i=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),n=Math.min(e.maxX,t.maxX),o=Math.min(e.maxY,t.maxY);return Math.max(0,n-i)*Math.max(0,o-r)}(n=ke(e,0,r,this.toBBox),o=ke(e,r,i,this.toBBox)),a=Ge(n)+Ge(o),s<l?(l=s,c=r,u=a<u?a:u):s===l&&a<u&&(u=a,c=r);return c},_chooseSplitAxis:function(e,t,i){var r=e.leaf?this.compareMinX:Qe,n=e.leaf?this.compareMinY:Ve;this._allDistMargin(e,t,i,r)<this._allDistMargin(e,t,i,n)&&e.children.sort(r)},_allDistMargin:function(e,t,i,r){e.children.sort(r);var n,o,s=this.toBBox,a=ke(e,0,t,s),l=ke(e,i-t,i,s),u=ze(a)+ze(l);for(n=t;n<i-t;n++)o=e.children[n],He(a,e.leaf?s(o):o),u+=ze(a);for(n=i-t-1;n>=t;n--)o=e.children[n],He(l,e.leaf?s(o):o),u+=ze(l);return u},_adjustParentBBoxes:function(e,t,i){for(var r=i;r>=0;r--)He(t[r],e)},_condense:function(e){for(var t,i=e.length-1;i>=0;i--)0===e[i].children.length?i>0?(t=e[i-1].children).splice(t.indexOf(e[i]),1):this.clear():Ue(e[i],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}},function(e,t,i){var r=e*t,n=bs*e,o=n-(n-e),s=e-o,a=bs*t,l=a-(a-t),u=t-l,c=s*u-(r-o*l-s*l-o*u);return i?(i[0]=c,i[1]=r,i):[c,r]}),bs=+(Math.pow(2,27)+1),Es=function(e,t){var i=0|e.length,r=0|t.length;if(1===i&&1===r)return function(e,t){var i=e+t,r=i-e,n=e-(i-r)+(t-r);return n?[n,i]:[i]}(e[0],t[0]);var n,o,s=i+r,a=new Array(s),l=0,u=0,c=0,h=Math.abs,A=e[u],p=h(A),f=t[c],d=h(f);p<d?(o=A,(u+=1)<i&&(p=h(A=e[u]))):(o=f,(c+=1)<r&&(d=h(f=t[c]))),u<i&&p<d||c>=r?(n=A,(u+=1)<i&&(p=h(A=e[u]))):(n=f,(c+=1)<r&&(d=h(f=t[c])));for(var g,m,y=n+o,_=y-n,v=o-_,C=v,w=y;u<i&&c<r;)p<d?(n=A,(u+=1)<i&&(p=h(A=e[u]))):(n=f,(c+=1)<r&&(d=h(f=t[c]))),(v=(o=C)-(_=(y=n+o)-n))&&(a[l++]=v),C=w-((g=w+y)-(m=g-w))+(y-m),w=g;for(;u<i;)(v=(o=C)-(_=(y=(n=A)+o)-n))&&(a[l++]=v),C=w-((g=w+y)-(m=g-w))+(y-m),w=g,(u+=1)<i&&(A=e[u]);for(;c<r;)(v=(o=C)-(_=(y=(n=f)+o)-n))&&(a[l++]=v),C=w-((g=w+y)-(m=g-w))+(y-m),w=g,(c+=1)<r&&(f=t[c]);return C&&(a[l++]=C),w&&(a[l++]=w),l||(a[l++]=0),a.length=l,a},Bs=function(e,t,i){var r=e+t,n=r-e,o=t-n,s=e-(r-n);return i?(i[0]=s+o,i[1]=r,i):[s+o,r]},Ms=function(e,t){var i=e.length;if(1===i){var r=xs(e[0],t);return r[0]?r:[r[1]]}var n=new Array(2*i),o=[.1,.1],s=[.1,.1],a=0;xs(e[0],t,o),o[0]&&(n[a++]=o[0]);for(var l=1;l<i;++l){xs(e[l],t,s);var u=o[1];Bs(u,s[0],o),o[0]&&(n[a++]=o[0]);var c=s[1],h=o[1],A=c+h,p=h-(A-c);o[1]=A,p&&(n[a++]=p)}return o[1]&&(n[a++]=o[1]),0===a&&(n[a++]=0),n.length=a,n},Is=function(e,t){var i=0|e.length,r=0|t.length;if(1===i&&1===r)return function(e,t){var i=e+t,r=i-e,n=e-(i-r)+(t-r);return n?[n,i]:[i]}(e[0],-t[0]);var n,o,s=i+r,a=new Array(s),l=0,u=0,c=0,h=Math.abs,A=e[u],p=h(A),f=-t[c],d=h(f);p<d?(o=A,(u+=1)<i&&(p=h(A=e[u]))):(o=f,(c+=1)<r&&(d=h(f=-t[c]))),u<i&&p<d||c>=r?(n=A,(u+=1)<i&&(p=h(A=e[u]))):(n=f,(c+=1)<r&&(d=h(f=-t[c])));for(var g,m,y=n+o,_=y-n,v=o-_,C=v,w=y;u<i&&c<r;)p<d?(n=A,(u+=1)<i&&(p=h(A=e[u]))):(n=f,(c+=1)<r&&(d=h(f=-t[c]))),(v=(o=C)-(_=(y=n+o)-n))&&(a[l++]=v),C=w-((g=w+y)-(m=g-w))+(y-m),w=g;for(;u<i;)(v=(o=C)-(_=(y=(n=A)+o)-n))&&(a[l++]=v),C=w-((g=w+y)-(m=g-w))+(y-m),w=g,(u+=1)<i&&(A=e[u]);for(;c<r;)(v=(o=C)-(_=(y=(n=f)+o)-n))&&(a[l++]=v),C=w-((g=w+y)-(m=g-w))+(y-m),w=g,(c+=1)<r&&(f=-t[c]);return C&&(a[l++]=C),w&&(a[l++]=w),l||(a[l++]=0),a.length=l,a},Ss=Ze(function(o){function c(e,t){for(var i=new Array(e.length-1),r=1;r<e.length;++r)for(var n=i[r-1]=new Array(e.length-1),o=0,s=0;o<e.length;++o)o!==t&&(n[s++]=e[r][o]);return i}function r(e){return 1&e?"-":""}function h(e){if(1===e.length)return e[0];if(2===e.length)return["sum(",e[0],",",e[1],")"].join("");var t=e.length>>1;return["sum(",h(e.slice(0,t)),",",h(e.slice(t)),")"].join("")}function A(e){if(2===e.length)return[["sum(prod(",e[0][0],",",e[1][1],"),prod(-",e[0][1],",",e[1][0],"))"].join("")];for(var t=[],i=0;i<e.length;++i)t.push(["scale(",h(A(c(e,i))),",",r(i),e[0][i],")"].join(""));return t}function s(e){for(var t=[],i=[],r=function(e){for(var t=new Array(e),i=0;i<e;++i){t[i]=new Array(e);for(var r=0;r<e;++r)t[i][r]=["m",r,"[",e-i-1,"]"].join("")}return t}(e),n=[],o=0;o<e;++o)0==(1&o)?t.push.apply(t,A(c(r,o))):i.push.apply(i,A(c(r,o))),n.push("m"+o);var s=h(t),a=h(i),l="orientation"+e+"Exact",u=["function ",l,"(",n.join(),"){var p=",s,",n=",a,",d=sub(p,n);return d[d.length-1];};return ",l].join("");return new Function("sum","prod","scale","sub",u)(Es,xs,Ms,Is)}var a=5,l=s(3),C=s(4),u=[function(){return 0},function(){return 0},function(e,t){return t[0]-e[0]},function(e,t,i){var r,n=(e[1]-i[1])*(t[0]-i[0]),o=(e[0]-i[0])*(t[1]-i[1]),s=n-o;if(n>0){if(o<=0)return s;r=n+o}else{if(!(n<0))return s;if(o>=0)return s;r=-(n+o)}var a=33306690738754716e-32*r;return s>=a||s<=-a?s:l(e,t,i)},function(e,t,i,r){var n=e[0]-r[0],o=t[0]-r[0],s=i[0]-r[0],a=e[1]-r[1],l=t[1]-r[1],u=i[1]-r[1],c=e[2]-r[2],h=t[2]-r[2],A=i[2]-r[2],p=o*u,f=s*l,d=s*a,g=n*u,m=n*l,y=o*a,_=c*(p-f)+h*(d-g)+A*(m-y),v=7771561172376103e-31*((Math.abs(p)+Math.abs(f))*Math.abs(c)+(Math.abs(d)+Math.abs(g))*Math.abs(h)+(Math.abs(m)+Math.abs(y))*Math.abs(A));return _>v||-_>v?_:C(e,t,i,r)}];!function(){for(;u.length<=a;)u.push(s(u.length));for(var e=[],t=["slow"],i=0;i<=a;++i)e.push("a"+i),t.push("o"+i);var r=["function getOrientation(",e.join(),"){switch(arguments.length){case 0:case 1:return 0;"];for(i=2;i<=a;++i)r.push("case ",i,":return o",i,"(",e.slice(0,i).join(),");");r.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),t.push(r.join(""));var n=Function.apply(void 0,t);for(o.exports=n.apply(void 0,[function(e){var t=u[e.length];return t||(t=u[e.length]=s(e.length)),t.apply(void 0,e)}].concat(u)),i=0;i<=a;++i)o.exports[i]=u[i]}()}),Ps=function(r){var e=r.length;if(e<3){for(var t=new Array(e),i=0;i<e;++i)t[i]=i;return 2===e&&r[0][0]===r[1][0]&&r[0][1]===r[1][1]?[0]:t}var n=new Array(e);for(i=0;i<e;++i)n[i]=i;n.sort(function(e,t){var i=r[e][0]-r[t][0];return i||r[e][1]-r[t][1]});var o=[n[0],n[1]],s=[n[0],n[1]];for(i=2;i<e;++i){for(var a=n[i],l=r[a],u=o.length;u>1&&Ts(r[o[u-2]],r[o[u-1]],l)<=0;)u-=1,o.pop();for(o.push(a),u=s.length;u>1&&Ts(r[s[u-2]],r[s[u-1]],l)>=0;)u-=1,s.pop();s.push(a)}t=new Array(s.length+o.length-2);for(var c=0,h=(i=0,o.length);i<h;++i)t[c++]=o[i];for(var A=s.length-2;A>0;--A)t[c++]=s[A];return t},Ts=Ss[3],Ls=Ye,Ds=Ye,Fs=(Ye.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,i=this.compare,r=t[e];e>0;){var n=e-1>>1,o=t[n];if(i(r,o)>=0)break;t[e]=o,e=n}t[e]=r},_down:function(e){for(var t=this.data,i=this.compare,r=this.length>>1,n=t[e];e<r;){var o=1+(e<<1),s=o+1,a=t[o];if(s<this.length&&i(t[s],a)<0&&(o=s,a=t[s]),i(a,n)>=0)break;t[e]=a,e=o}t[e]=n}},Ls.default=Ds,function(e,t){for(var i=e[0],r=e[1],n=!1,o=0,s=t.length-1;o<t.length;s=o++){var a=t[o][0],l=t[o][1],u=t[s][0],c=t[s][1];l>r!=c>r&&i<(u-a)*(r-l)/(c-l)+a&&(n=!n)}return n}),Ns=Ss[3],Os=Xe,Rs,Us=(Os.default=Xe,function(e){return e}),ks=function(e){if(null==e)return Us;var o,s,a=e.scale[0],l=e.scale[1],u=e.translate[0],c=e.translate[1];return function(e,t){t||(o=s=0);var i=2,r=e.length,n=new Array(r);for(n[0]=(o+=e[0])*a+u,n[1]=(s+=e[1])*l+c;i<r;)n[i]=e[i],++i;return n}},Hs=function(e,t){for(var i,r=e.length,n=r-t;n<--r;)i=e[n],e[n++]=e[r],e[r]=i},Qs=function(l,n){function e(e,t){for(var i in e){var r=e[i];delete t[r.start],delete r.start,delete r.end,r.forEach(function(e){o[e<0?~e:e]=1}),s.push(r)}}var o={},u={},c={},s=[],a=-1;return n.forEach(function(e,t){var i,r=l.arcs[e<0?~e:e];r.length<3&&!r[1][0]&&!r[1][1]&&(i=n[++a],n[a]=e,n[t]=i)}),n.forEach(function(e){var t,i,r=function(e){var t,i=l.arcs[e<0?~e:e],r=i[0];return l.transform?(t=[0,0],i.forEach(function(e){t[0]+=e[0],t[1]+=e[1]})):t=i[i.length-1],e<0?[t,r]:[r,t]}(e),n=r[0],o=r[1];if(t=c[n])if(delete c[t.end],t.push(e),t.end=o,i=u[o]){delete u[i.start];var s=i===t?t:t.concat(i);u[s.start=t.start]=c[s.end=i.end]=s}else u[t.start]=c[t.end]=t;else if(t=u[o])if(delete u[t.start],t.unshift(e),t.start=n,i=c[n]){delete c[i.end];var a=i===t?t:i.concat(t);u[a.start=i.start]=c[a.end=t.end]=a}else u[t.start]=c[t.end]=t;else u[(t=[e]).start=n]=c[t.end=o]=t}),e(c,u),e(u,c),n.forEach(function(e){o[e<0?~e:e]||s.push([e])}),s},Vs=function(e){return vt(e,Ct.apply(this,arguments))},Gs=function(o,s,a,e,l,t){3===arguments.length&&(e=t=Array,l=null);for(var u=new e(o=1<<Math.max(4,Math.ceil(Math.log(o)/Math.LN2))),c=new t(o),h=o-1,i=0;i<o;++i)u[i]=l;return{set:function(e,t){for(var i=s(e)&h,r=u[i],n=0;r!=l;){if(a(r,e))return c[i]=t;if(++n>=o)throw new Error("full hashmap");r=u[i=i+1&h]}return u[i]=e,c[i]=t,t},maybeSet:function(e,t){for(var i=s(e)&h,r=u[i],n=0;r!=l;){if(a(r,e))return c[i];if(++n>=o)throw new Error("full hashmap");r=u[i=i+1&h]}return u[i]=e,c[i]=t,t},get:function(e,t){for(var i=s(e)&h,r=u[i],n=0;r!=l;){if(a(r,e))return c[i];if(++n>=o)break;r=u[i=i+1&h]}return t},keys:function(){for(var e=[],t=0,i=u.length;t<i;++t){var r=u[t];r!=l&&e.push(r)}return e}}},zs=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Ws=new ArrayBuffer(16),qs=new Float64Array(Ws),Ks=new Uint32Array(Ws),js=function(e){qs[0]=e[0],qs[1]=e[1];var t=Ks[0]^Ks[1];return 2147483647&(t=t<<5^t>>7^Ks[2]^Ks[3])},Zs=function(e){function t(e,t,i,r){if(A[i]!==e){A[i]=e;var n=p[i];if(n>=0){var o=f[i];n===t&&o===r||n===r&&o===t||(++g,d[i]=1)}else p[i]=t,f[i]=r}}function n(e){return js(l[e])}function o(e,t){return zs(l[e],l[t])}var i,r,s,a,l=e.coordinates,u=e.lines,c=e.rings,h=function(){for(var e=Gs(1.4*l.length,n,o,Int32Array,-1,Int32Array),t=new Int32Array(l.length),i=0,r=l.length;i<r;++i)t[i]=e.maybeSet(i,i);return t}(),A=new Int32Array(l.length),p=new Int32Array(l.length),f=new Int32Array(l.length),d=new Int8Array(l.length),g=0;for(i=0,r=l.length;i<r;++i)A[i]=p[i]=f[i]=-1;for(i=0,r=u.length;i<r;++i){var m=u[i],y=m[0],_=m[1];for(s=h[y],a=h[++y],++g,d[s]=1;++y<=_;)t(i,s,s=a,a=h[y]);++g,d[a]=1}for(i=0,r=l.length;i<r;++i)A[i]=-1;for(i=0,r=c.length;i<r;++i){var v=c[i],C=v[0]+1,w=v[1];for(t(i,h[w-1],s=h[C-1],a=h[C]);++C<=w;)t(i,s,s=a,a=h[C])}A=p=f=null;var x,b=function(n,o,s,e,a){3===arguments.length&&(e=Array,a=null);for(var l=new e(n=1<<Math.max(4,Math.ceil(Math.log(n)/Math.LN2))),u=n-1,t=0;t<n;++t)l[t]=a;return{add:function(e){for(var t=o(e)&u,i=l[t],r=0;i!=a;){if(s(i,e))return!0;if(++r>=n)throw new Error("full hashset");i=l[t=t+1&u]}return l[t]=e,!0},has:function(e){for(var t=o(e)&u,i=l[t],r=0;i!=a;){if(s(i,e))return!0;if(++r>=n)break;i=l[t=t+1&u]}return!1},values:function(){for(var e=[],t=0,i=l.length;t<i;++t){var r=l[t];r!=a&&e.push(r)}return e}}}(1.4*g,js,zs);for(i=0,r=l.length;i<r;++i)d[x=h[i]]&&b.add(l[x]);return b},Ys=function(e){var t,i,r,n=Zs(e),o=e.coordinates,s=e.lines,a=e.rings;for(i=0,r=s.length;i<r;++i)for(var l=s[i],u=l[0],c=l[1];++u<c;)n.has(o[u])&&(t={0:u,1:l[1]},l[1]=u,l=l.next=t);for(i=0,r=a.length;i<r;++i)for(var h=a[i],A=h[0],p=A,f=h[1],d=n.has(o[A]);++p<f;)n.has(o[p])&&(d?(t={0:p,1:h[1]},h[1]=p,h=h.next=t):(!function(e,t,i,r){wt(e,t,i),wt(e,t,t+r),wt(e,t+r,i)}(o,A,f,f-p),o[f]=o[A],d=!0,p=A));return e},Xs=function(e){function t(e){var t,i,r,n,o,s,a,l;if(r=p.get(t=h[e[0]]))for(a=0,l=r.length;a<l;++a)if(n=r[a],function(e,t){var i=e[0],r=t[0],n=e[1],o=t[1];if(i-n!=r-o)return!1;for(;i<=n;++i,++r)if(!zs(h[i],h[r]))return!1;return!0}(n,e))return e[0]=n[0],void(e[1]=n[1]);if(o=p.get(i=h[e[1]]))for(a=0,l=o.length;a<l;++a)if(s=o[a],function(e,t){var i=e[0],r=t[0],n=e[1],o=t[1];if(i-n!=r-o)return!1;for(;i<=n;++i,--o)if(!zs(h[i],h[o]))return!1;return!0}(s,e))return e[1]=s[0],void(e[0]=s[1]);r?r.push(e):p.set(t,[e]),o?o.push(e):p.set(i,[e]),f.push(e)}function s(e,t){var i=e[0],r=t[0],n=e[1]-i;if(n!==t[1]-r)return!1;for(var o=c(e),s=c(t),a=0;a<n;++a)if(!zs(h[i+(a+o)%n],h[r+(a+s)%n]))return!1;return!0}function a(e,t){var i=e[0],r=t[0],n=e[1],o=t[1],s=n-i;if(s!==o-r)return!1;for(var a=c(e),l=s-c(t),u=0;u<s;++u)if(!zs(h[i+(u+a)%s],h[o-(u+l)%s]))return!1;return!0}function c(e){for(var t=e[0],i=e[1],r=t,n=r,o=h[r];++r<i;){var s=h[r];(s[0]<o[0]||s[0]===o[0]&&s[1]<o[1])&&(n=r,o=s)}return n-t}var i,r,n,o,h=e.coordinates,l=e.lines,u=e.rings,A=l.length+u.length;for(delete e.lines,delete e.rings,n=0,o=l.length;n<o;++n)for(i=l[n];i=i.next;)++A;for(n=0,o=u.length;n<o;++n)for(r=u[n];r=r.next;)++A;var p=Gs(2*A*1.4,js,zs),f=e.arcs=[];for(n=0,o=l.length;n<o;++n){i=l[n];do{t(i)}while(i=i.next)}for(n=0,o=u.length;n<o;++n)if((r=u[n]).next)do{t(r)}while(r=r.next);else!function(e){var t,i,r,n,o;if(i=p.get(t=h[e[0]]))for(n=0,o=i.length;n<o;++n){if(r=i[n],s(r,e))return e[0]=r[0],void(e[1]=r[1]);if(a(r,e))return e[0]=r[1],void(e[1]=r[0])}if(i=p.get(t=h[e[0]+c(e)]))for(n=0,o=i.length;n<o;++n){if(r=i[n],s(r,e))return e[0]=r[0],void(e[1]=r[1]);if(a(r,e))return e[0]=r[1],void(e[1]=r[0])}i?i.push(e):p.set(t,[e]),f.push(e)}(r);return e},Js=function(e,t){function i(e){e&&c.hasOwnProperty(e.type)&&c[e.type](e)}function r(e){var t=[];do{var i=u.get(e);t.push(e[0]<e[1]?i:~i)}while(e=e.next);return t}function n(e){return e.map(r)}var o=function(e){function t(e){null!=e&&u.hasOwnProperty(e.type)&&u[e.type](e)}function i(e){var t=e[0],i=e[1];t<o&&(o=t),t>a&&(a=t),i<s&&(s=i),i>l&&(l=i)}function r(e){e.forEach(i)}function n(e){e.forEach(r)}var o=1/0,s=1/0,a=-1/0,l=-1/0,u={GeometryCollection:function(e){e.geometries.forEach(t)},Point:function(e){i(e.coordinates)},MultiPoint:function(e){e.coordinates.forEach(i)},LineString:function(e){r(e.arcs)},MultiLineString:function(e){e.arcs.forEach(r)},Polygon:function(e){e.arcs.forEach(r)},MultiPolygon:function(e){e.arcs.forEach(n)}};for(var c in e)t(e[c]);return a>=o&&l>=s?[o,s,a,l]:void 0}(e=function(e){var t,i={};for(t in e)i[t]=xt(e[t]);return i}(e)),s=t>0&&o&&function(e,t,i){function r(e){return[Math.round((e[0]-h)*p),Math.round((e[1]-A)*f)]}function n(e,t){for(var i,r,n,o,s,a=-1,l=0,u=e.length,c=new Array(u);++a<u;)i=e[a],o=Math.round((i[0]-h)*p),s=Math.round((i[1]-A)*f),o===r&&s===n||(c[l++]=[r=o,n=s]);for(c.length=l;l<t;)l=c.push([c[0][0],c[0][1]]);return c}function o(e){return n(e,2)}function s(e){return n(e,4)}function a(e){return e.map(s)}function l(e){null!=e&&d.hasOwnProperty(e.type)&&d[e.type](e)}var h=t[0],A=t[1],u=t[2],c=t[3],p=u-h?(i-1)/(u-h):1,f=c-A?(i-1)/(c-A):1,d={GeometryCollection:function(e){e.geometries.forEach(l)},Point:function(e){e.coordinates=r(e.coordinates)},MultiPoint:function(e){e.coordinates=e.coordinates.map(r)},LineString:function(e){e.arcs=o(e.arcs)},MultiLineString:function(e){e.arcs=e.arcs.map(o)},Polygon:function(e){e.arcs=a(e.arcs)},MultiPolygon:function(e){e.arcs=e.arcs.map(a)}};for(var g in e)l(e[g]);return{scale:[1/p,1/f],translate:[h,A]}}(e,o,t),a=Xs(Ys(function(e){function t(e){e&&u.hasOwnProperty(e.type)&&u[e.type](e)}function i(e){for(var t=0,i=e.length;t<i;++t)l[++o]=e[t];var r={0:o-i+1,1:o};return s.push(r),r}function r(e){for(var t=0,i=e.length;t<i;++t)l[++o]=e[t];var r={0:o-i+1,1:o};return a.push(r),r}function n(e){return e.map(r)}var o=-1,s=[],a=[],l=[],u={GeometryCollection:function(e){e.geometries.forEach(t)},LineString:function(e){e.arcs=i(e.arcs)},MultiLineString:function(e){e.arcs=e.arcs.map(i)},Polygon:function(e){e.arcs=e.arcs.map(r)},MultiPolygon:function(e){e.arcs=e.arcs.map(n)}};for(var c in e)t(e[c]);return{type:"Topology",coordinates:l,lines:s,rings:a,objects:e}}(e))),l=a.coordinates,u=Gs(1.4*a.arcs.length,Bt,Mt);e=a.objects,a.bbox=o,a.arcs=a.arcs.map(function(e,t){return u.set(e,t),l.slice(e[0],e[1]+1)}),delete a.coordinates,l=null;var c={GeometryCollection:function(e){e.geometries.forEach(i)},LineString:function(e){e.arcs=r(e.arcs)},MultiLineString:function(e){e.arcs=e.arcs.map(r)},Polygon:function(e){e.arcs=e.arcs.map(r)},MultiPolygon:function(e){e.arcs=e.arcs.map(n)}};for(var h in e)i(e[h]);return s&&(a.transform=s,a.arcs=function(e){for(var t=-1,i=e.length;++t<i;){for(var r,n,o=e[t],s=0,a=1,l=o.length,u=o[0],c=u[0],h=u[1];++s<l;)r=(u=o[s])[0],n=u[1],r===c&&n===h||(o[a++]=[r-c,n-h],c=r,h=n);1===a&&(o[a++]=[0,0]),o.length=a}return e}(a.arcs)),a},$s=function(e){this.points=e.points||[],this.duration=e.duration||1e4,this.sharpness=e.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=e.stepLength||60,this.length=this.points.length,this.delay=0;for(var t=0;t<this.length;t++)this.points[t].z=this.points[t].z||0;for(t=0;t<this.length-1;t++){var i=this.points[t],r=this.points[t+1];this.centers.push({x:(i.x+r.x)/2,y:(i.y+r.y)/2,z:(i.z+r.z)/2})}this.controls.push([this.points[0],this.points[0]]);for(t=0;t<this.centers.length-1;t++){i=this.centers[t],r=this.centers[t+1];var n=this.points[t+1].x-(this.centers[t].x+this.centers[t+1].x)/2,o=this.points[t+1].y-(this.centers[t].y+this.centers[t+1].y)/2,s=this.points[t+1].z-(this.centers[t].y+this.centers[t+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[t+1].x+this.sharpness*(this.centers[t].x+n),y:(1-this.sharpness)*this.points[t+1].y+this.sharpness*(this.centers[t].y+o),z:(1-this.sharpness)*this.points[t+1].z+this.sharpness*(this.centers[t].z+s)},{x:(1-this.sharpness)*this.points[t+1].x+this.sharpness*(this.centers[t+1].x+n),y:(1-this.sharpness)*this.points[t+1].y+this.sharpness*(this.centers[t+1].y+o),z:(1-this.sharpness)*this.points[t+1].z+this.sharpness*(this.centers[t+1].z+s)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this},ea=($s.prototype.cacheSteps=function(e){var t=[],i=this.pos(0);t.push(0);for(var r=0;r<this.duration;r+=10){var n=this.pos(r);Math.sqrt((n.x-i.x)*(n.x-i.x)+(n.y-i.y)*(n.y-i.y)+(n.z-i.z)*(n.z-i.z))>e&&(t.push(r),i=n)}return t},$s.prototype.vector=function(e){var t=this.pos(e+10),i=this.pos(e-10);return{angle:180*Math.atan2(t.y-i.y,t.x-i.x)/3.14,speed:Math.sqrt((i.x-t.x)*(i.x-t.x)+(i.y-t.y)*(i.y-t.y)+(i.z-t.z)*(i.z-t.z))}},$s.prototype.pos=function(e){var t=e-this.delay;t<0&&(t=0),t>this.duration&&(t=this.duration-1);var i=t/this.duration;if(i>=1)return this.points[this.length-1];var r=Math.floor((this.points.length-1)*i);return function(e,t,i,r,n){var o=function(e){var t=e*e;return[t*e,3*t*(1-e),3*e*(1-e)*(1-e),(1-e)*(1-e)*(1-e)]}(e);return{x:n.x*o[0]+r.x*o[1]+i.x*o[2]+t.x*o[3],y:n.y*o[0]+r.y*o[1]+i.y*o[2]+t.y*o[3],z:n.z*o[0]+r.z*o[1]+i.z*o[2]+t.z*o[3]}}((this.length-1)*i-r,this.points[r],this.controls[r][1],this.controls[r+1][0],this.points[r+1])},Yt),ta=Yt,ia=(Yt.deviation=function(e,t,i,r){var n=t&&t.length,o=n?t[0]*i:e.length,s=Math.abs(hi(e,0,o,i));if(n)for(var a=0,l=t.length;a<l;a++){var u=t[a]*i,c=a<l-1?t[a+1]*i:e.length;s-=Math.abs(hi(e,u,c,i))}var h=0;for(a=0;a<r.length;a+=3){var A=r[a]*i,p=r[a+1]*i,f=r[a+2]*i;h+=Math.abs((e[A]-e[f])*(e[p+1]-e[A+1])-(e[A]-e[p])*(e[f+1]-e[A+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},Yt.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var s=0;s<t;s++)i.vertices.push(e[n][o][s]);n>0&&(r+=e[n-1].length,i.holes.push(r))}return i},ea.default=ta,mi.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,i=[],r=this.toBBox;if(!Bi(e,t))return i;for(var n,o,s,a,l=[];t;){for(n=0,o=t.children.length;n<o;n++)s=t.children[n],Bi(e,a=t.leaf?r(s):s)&&(t.leaf?i.push(s):Ei(e,a)?this._all(s,i):l.push(s));t=l.pop()}return i},collides:function(e){var t=this.data,i=this.toBBox;if(!Bi(e,t))return!1;for(var r,n,o,s,a=[];t;){for(r=0,n=t.children.length;r<n;r++)if(o=t.children[r],s=t.leaf?i(o):o,Bi(e,s)){if(t.leaf||Ei(e,s))return!0;a.push(o)}t=a.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}var r=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var n=this.data;this.data=r,r=n}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=Mi([]),this},remove:function(e,t){if(!e)return this;for(var i,r,n,o,s=this.data,a=this.toBBox(e),l=[],u=[];s||l.length;){if(s||(s=l.pop(),r=l[l.length-1],i=u.pop(),o=!0),s.leaf&&-1!==(n=function(e,t,i){if(!i)return t.indexOf(e);for(var r=0;r<t.length;r++)if(i(e,t[r]))return r;return-1}(e,s.children,t)))return s.children.splice(n,1),l.push(s),this._condense(l),this;o||s.leaf||!Ei(s,a)?r?(i++,s=r.children[i],o=!1):s=null:(l.push(s),u.push(i),i=0,r=s,s=s.children[0])}return this},toBBox:function(e){return e},compareMinX:Ci,compareMinY:wi,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},_build:function(e,t,i,r){var n,o=i-t+1,s=this._maxEntries;if(o<=s)return n=Mi(e.slice(t,i+1)),yi(n,this.toBBox),n;r||(r=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,r-1))),(n=Mi([])).leaf=!1,n.height=r;var a,l,u,c,h=Math.ceil(o/s),A=h*Math.ceil(Math.sqrt(s));for(Ii(e,t,i,A,this.compareMinX),a=t;a<=i;a+=A)for(Ii(e,a,u=Math.min(a+A-1,i),h,this.compareMinY),l=a;l<=u;l+=h)c=Math.min(l+h-1,u),n.children.push(this._build(e,l,c,r-1));return yi(n,this.toBBox),n},_chooseSubtree:function(e,t,i,r){for(var n,o,s,a,l,u,c,h;r.push(t),!t.leaf&&r.length-1!==i;){for(c=h=1/0,n=0,o=t.children.length;n<o;n++)l=xi(s=t.children[n]),(u=function(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}(e,s)-l)<h?(h=u,c=l<c?l:c,a=s):u===h&&l<c&&(c=l,a=s);t=a||t.children[0]}return t},_insert:function(e,t,i){var r=this.toBBox,n=i?e:r(e),o=[],s=this._chooseSubtree(n,this.data,t,o);for(s.children.push(e),vi(s,n);t>=0&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(n,o,t)},_split:function(e,t){var i=e[t],r=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,r);var o=this._chooseSplitIndex(i,n,r),s=Mi(i.children.splice(o,i.children.length-o));s.height=i.height,s.leaf=i.leaf,yi(i,this.toBBox),yi(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(i,s)},_splitRoot:function(e,t){this.data=Mi([e,t]),this.data.height=e.height+1,this.data.leaf=!1,yi(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,i){var r,n,o,s,a,l,u,c;for(l=u=1/0,r=t;r<=i-t;r++)s=function(e,t){var i=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),n=Math.min(e.maxX,t.maxX),o=Math.min(e.maxY,t.maxY);return Math.max(0,n-i)*Math.max(0,o-r)}(n=_i(e,0,r,this.toBBox),o=_i(e,r,i,this.toBBox)),a=xi(n)+xi(o),s<l?(l=s,c=r,u=a<u?a:u):s===l&&a<u&&(u=a,c=r);return c},_chooseSplitAxis:function(e,t,i){var r=e.leaf?this.compareMinX:Ci,n=e.leaf?this.compareMinY:wi;this._allDistMargin(e,t,i,r)<this._allDistMargin(e,t,i,n)&&e.children.sort(r)},_allDistMargin:function(e,t,i,r){e.children.sort(r);var n,o,s=this.toBBox,a=_i(e,0,t,s),l=_i(e,i-t,i,s),u=bi(a)+bi(l);for(n=t;n<i-t;n++)o=e.children[n],vi(a,e.leaf?s(o):o),u+=bi(a);for(n=i-t-1;n>=t;n--)o=e.children[n],vi(l,e.leaf?s(o):o),u+=bi(l);return u},_adjustParentBBoxes:function(e,t,i){for(var r=i;r>=0;r--)vi(t[r],e)},_condense:function(e){for(var t,i=e.length-1;i>=0;i--)0===e[i].children.length?i>0?(t=e[i-1].children).splice(t.indexOf(e[i]),1):this.clear():yi(e[i],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}},Object.freeze({toMercator:ki,toWgs84:Hi})),ra=6378137,na=function(e,p,t){function r(e,t,i,r){var n=f[e][t],o=f[e][t+1],s=f[i][r],a=f[i][r+1],l=function(e,t,i,r){if(ar(e,i)||ar(e,r)||ar(t,i)||ar(r,i))return null;var n=e[0],o=e[1],s=t[0],a=t[1],l=i[0],u=i[1],c=r[0],h=r[1],A=(n-s)*(u-h)-(o-a)*(l-c);return 0===A?null:[((n*a-o*s)*(l-c)-(n-s)*(l*h-u*c))/A,((n*a-o*s)*(u-h)-(o-a)*(l*h-u*c))/A]}(n,o,s,a);if(null!==l){var u,c;if(u=o[0]!==n[0]?(l[0]-n[0])/(o[0]-n[0]):(l[1]-n[1])/(o[1]-n[1]),c=a[0]!==s[0]?(l[0]-s[0])/(a[0]-s[0]):(l[1]-s[1])/(a[1]-s[1]),!(u>=1||u<=0||c>=1||c<=0)){var h=l,A=!g[h];A&&(g[h]=!0),p?d.push(p(l,e,t,n,o,u,i,r,s,a,c,A)):d.push(l)}}}function i(e,t){var i,r,n,o,s=f[e][t],a=f[e][t+1];return s[0]<a[0]?(i=s[0],r=a[0]):(i=a[0],r=s[0]),s[1]<a[1]?(n=s[1],o=a[1]):(n=a[1],o=s[1]),{minX:i,minY:n,maxX:r,maxY:o,ring:e,edge:t}}if("Polygon"!==e.geometry.type)throw new Error("The input feature must be a Polygon");void 0===t&&(t=1);var f=e.geometry.coordinates,d=[],g={};if(t){for(var n=[],o=0;o<f.length;o++)for(var s=0;s<f[o].length-1;s++)n.push(i(o,s));var a=ws();a.load(n)}for(var l=0;l<f.length;l++)for(var u=0;u<f[l].length-1;u++)if(t)a.search(i(l,u)).forEach(function(e){var t=e.ring,i=e.edge;r(l,u,t,i)});else for(var c=0;c<f.length;c++)for(var h=0;h<f[c].length-1;h++)r(l,u,c,h);return p||(d={type:"Feature",geometry:{type:"MultiPoint",coordinates:d}}),d},oa=function(e){function t(){for(var e=[],t=0;t<A.features.length;t++)-1==A.features[t].properties.parent&&e.push(t);if(e.length>1)for(t=0;t<e.length;t++){for(var i=-1,r=0;r<A.features.length;r++)e[t]!=r&&at(A.features[e[t]].geometry.coordinates[0][0],A.features[r],{ignoreBoundary:!0})&&ji(A.features[r])<1/0&&(i=r);A.features[e[t]].properties.parent=i}}function i(){for(var e=0;e<A.features.length;e++)if(-1==A.features[e].properties.parent){var t=A.features[e].properties.winding;A.features[e].properties.netWinding=t,n(e,t)}}function n(e,t){for(var i=0;i<A.features.length;i++)if(A.features[i].properties.parent==e){var r=t+A.features[i].properties.winding;A.features[i].properties.netWinding=r,n(i,r)}}if("Feature"!=e.type)throw new Error("The input must a geojson object of type Feature");if(void 0===e.geometry||null==e.geometry)throw new Error("The input must a geojson object with a non-empty geometry");if("Polygon"!=e.geometry.type)throw new Error("The input must be a geojson Polygon");for(var r=e.geometry.coordinates.length,o=[],s=0;s<r;s++){var a=e.geometry.coordinates[s];ur(a[0],a[a.length-1])||a.push(a[0]),o.push.apply(o,a.slice(0,a.length-1))}if(!function(e){for(var t={},i=1,r=0,n=e.length;r<n;++r){if(t.hasOwnProperty(e[r])){i=0;break}t[e[r]]=1}return i}(o))throw new Error("The input polygon may not have duplicate vertices (except for the first and last vertex of each ring)");var l=o.length,u=na(e,function(e,t,i,r,n,o,s,a,l,u,c,h){return[e,t,i,r,n,o,s,a,l,u,c,h]}),c=u.length;if(0==c){var h=[];for(s=0;s<r;s++)h.push(k([e.geometry.coordinates[s]],{parent:-1,winding:function(e){for(var t=0,i=0;i<e.length-1;i++)e[i][0]<e[t][0]&&(t=i);if(lr([e[(t-1).modulo(e.length-1)],e[t],e[(t+1).modulo(e.length-1)]],!0))var r=1;else r=-1;return r}(e.geometry.coordinates[s])}));var A=H(h);return t(),i(),A}var p=[],f=[];for(s=0;s<r;s++){p.push([]);for(var d=0;d<e.geometry.coordinates[s].length-1;d++)p[s].push([new sa(e.geometry.coordinates[s][(d+1).modulo(e.geometry.coordinates[s].length-1)],1,[s,d],[s,(d+1).modulo(e.geometry.coordinates[s].length-1)],void 0)]),f.push(new aa(e.geometry.coordinates[s][d],[s,(d-1).modulo(e.geometry.coordinates[s].length-1)],[s,d],void 0,void 0,!1,!0))}for(s=0;s<c;s++)p[u[s][1]][u[s][2]].push(new sa(u[s][0],u[s][5],[u[s][1],u[s][2]],[u[s][6],u[s][7]],void 0)),u[s][11]&&f.push(new aa(u[s][0],[u[s][1],u[s][2]],[u[s][6],u[s][7]],void 0,void 0,!0,!0));var g=f.length;for(s=0;s<p.length;s++)for(d=0;d<p[s].length;d++)p[s][d].sort(function(e,t){return e.param<t.param?-1:1});var m=[];for(s=0;s<g;s++)m.push({minX:f[s].coord[0],minY:f[s].coord[1],maxX:f[s].coord[0],maxY:f[s].coord[1],index:s});var y=ws();y.load(m);for(s=0;s<p.length;s++)for(d=0;d<p[s].length;d++)for(var _=0;_<p[s][d].length;_++){C=_==p[s][d].length-1?p[s][(d+1).modulo(e.geometry.coordinates[s].length-1)][0].coord:p[s][d][_+1].coord;var v=y.search({minX:C[0],minY:C[1],maxX:C[0],maxY:C[1]})[0];p[s][d][_].nxtIsectAlongEdgeIn=v.index}for(s=0;s<p.length;s++)for(d=0;d<p[s].length;d++)for(_=0;_<p[s][d].length;_++){var C=p[s][d][_].coord,w=(v=y.search({minX:C[0],minY:C[1],maxX:C[0],maxY:C[1]})[0]).index;w<l?f[w].nxtIsectAlongRingAndEdge2=p[s][d][_].nxtIsectAlongEdgeIn:ur(f[w].ringAndEdge1,p[s][d][_].ringAndEdgeIn)?f[w].nxtIsectAlongRingAndEdge1=p[s][d][_].nxtIsectAlongEdgeIn:f[w].nxtIsectAlongRingAndEdge2=p[s][d][_].nxtIsectAlongEdgeIn}var x=[];for(s=0,d=0;d<r;d++){var b=s;for(_=0;_<e.geometry.coordinates[d].length-1;_++)f[s].coord[0]<f[b].coord[0]&&(b=s),s++;var O=f[b].nxtIsectAlongRingAndEdge2;for(_=0;_<f.length;_++)if(f[_].nxtIsectAlongRingAndEdge1==b||f[_].nxtIsectAlongRingAndEdge2==b){var R=_;break}var U=lr([f[R].coord,f[b].coord,f[O].coord],!0)?1:-1;x.push({isect:b,parent:-1,winding:U})}x.sort(function(e,t){return f[e.isect].coord>f[t.isect].coord?-1:1});for(h=[];x.length>0;){var E=x.pop(),B=E.isect,M=E.parent,I=E.winding,S=h.length,P=[f[B].coord],T=B;if(f[B].ringAndEdge1Walkable)var L=f[B].ringAndEdge1,D=f[B].nxtIsectAlongRingAndEdge1;else L=f[B].ringAndEdge2,D=f[B].nxtIsectAlongRingAndEdge2;for(;!ur(f[B].coord,f[D].coord);){P.push(f[D].coord);var F=void 0;for(s=0;s<x.length;s++)if(x[s].isect==D){F=s;break}if(void 0!=F&&x.splice(F,1),ur(L,f[D].ringAndEdge1)){if(L=f[D].ringAndEdge2,f[D].ringAndEdge2Walkable=!1,f[D].ringAndEdge1Walkable){var N={isect:D};lr([f[T].coord,f[D].coord,f[f[D].nxtIsectAlongRingAndEdge2].coord],1==I)?(N.parent=M,N.winding=-I):(N.parent=S,N.winding=I),x.push(N)}T=D,D=f[D].nxtIsectAlongRingAndEdge2}else{if(L=f[D].ringAndEdge1,f[D].ringAndEdge1Walkable=!1,f[D].ringAndEdge2Walkable){N={isect:D};lr([f[T].coord,f[D].coord,f[f[D].nxtIsectAlongRingAndEdge1].coord],1==I)?(N.parent=M,N.winding=-I):(N.parent=S,N.winding=I),x.push(N)}T=D,D=f[D].nxtIsectAlongRingAndEdge1}}P.push(f[D].coord),h.push(k([P],{index:S,parent:M,winding:I,netWinding:void 0}))}A=H(h);return t(),i(),A},sa=function(e,t,i,r,n){this.coord=e,this.param=t,this.ringAndEdgeIn=i,this.ringAndEdgeOut=r,this.nxtIsectAlongEdgeIn=n},aa=function(e,t,i,r,n,o,s){this.coord=e,this.ringAndEdge1=t,this.ringAndEdge2=i,this.nxtIsectAlongRingAndEdge1=r,this.nxtIsectAlongRingAndEdge2=n,this.ringAndEdge1Walkable=o,this.ringAndEdge2Walkable=s},la=(Number.prototype.modulo=function(e){return(this%e+e)%e},Math.PI/180),ua=180/Math.PI,ca=function(e,t){this.lon=e,this.lat=t,this.x=la*e,this.y=la*t},ha=(ca.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},ca.prototype.antipode=function(){var e=-1*this.lat,t=this.lon<0?180+this.lon:-1*(180-this.lon);return new ca(t,e)},function(){this.coords=[],this.length=0}),Aa=(ha.prototype.move_to=function(e){this.length++,this.coords.push(e)},function(e){this.properties=e||{},this.geometries=[]}),pa=(Aa.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var e=[],t=0;t<this.geometries.length;t++)e.push(this.geometries[t].coords);return{geometry:{type:"MultiLineString",coordinates:e},type:"Feature",properties:this.properties}},Aa.prototype.wkt=function(){for(var e="",t="LINESTRING(",i=function(e){t+=e[0]+" "+e[1]+","},r=0;r<this.geometries.length;r++){if(0===this.geometries[r].coords.length)return"LINESTRING(empty)";this.geometries[r].coords.forEach(i),e+=t.substring(0,t.length-1)+")"}return e},function(e,t,i){if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new ca(e.x,e.y),this.end=new ca(t.x,t.y),this.properties=i||{};var r=this.start.x-this.end.x,n=this.start.y-this.end.y,o=Math.pow(Math.sin(n/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(r/2),2);if(this.g=2*Math.asin(Math.sqrt(o)),this.g===Math.PI)throw new Error("it appears "+e.view()+" and "+t.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+e+" and "+t)}),fa=(pa.prototype.interpolate=function(e){var t=Math.sin((1-e)*this.g)/Math.sin(this.g),i=Math.sin(e*this.g)/Math.sin(this.g),r=t*Math.cos(this.start.y)*Math.cos(this.start.x)+i*Math.cos(this.end.y)*Math.cos(this.end.x),n=t*Math.cos(this.start.y)*Math.sin(this.start.x)+i*Math.cos(this.end.y)*Math.sin(this.end.x),o=t*Math.sin(this.start.y)+i*Math.sin(this.end.y),s=ua*Math.atan2(o,Math.sqrt(Math.pow(r,2)+Math.pow(n,2)));return[ua*Math.atan2(n,r),s]},pa.prototype.Arc=function(e,t){var i=[];if(!e||e<=2)i.push([this.start.lon,this.start.lat]),i.push([this.end.lon,this.end.lat]);else for(var r=1/(e-1),n=0;n<e;++n){var o=r*n,s=this.interpolate(o);i.push(s)}for(var a=!1,l=0,u=t&&t.offset?t.offset:10,c=180-u,h=-180+u,A=360-u,p=1;p<i.length;++p){var f=i[p-1][0],d=i[p][0],g=Math.abs(d-f);g>A&&(d>c&&f<h||f>c&&d<h)?a=!0:g>l&&(l=g)}var m=[];if(a&&l<u){var y=[];m.push(y);for(var _=0;_<i.length;++_){var v=parseFloat(i[_][0]);if(_>0&&Math.abs(v-i[_-1][0])>A){var C=parseFloat(i[_-1][0]),w=parseFloat(i[_-1][1]),x=parseFloat(i[_][0]),b=parseFloat(i[_][1]);if(C>-180&&C<h&&180===x&&_+1<i.length&&i[_-1][0]>-180&&i[_-1][0]<h){y.push([-180,i[_][1]]),_++,y.push([i[_][0],i[_][1]]);continue}if(C>c&&C<180&&-180===x&&_+1<i.length&&i[_-1][0]>c&&i[_-1][0]<180){y.push([180,i[_][1]]),_++,y.push([i[_][0],i[_][1]]);continue}if(C<h&&x>c){var E=C;C=x,x=E;var B=w;w=b,b=B}if(C>c&&x<h&&(x+=360),C<=180&&x>=180&&C<x){var M=(180-C)/(x-C),I=M*b+(1-M)*w;y.push([i[_-1][0]>c?180:-180,I]),(y=[]).push([i[_-1][0]>c?-180:180,I]),m.push(y)}else y=[],m.push(y);y.push([v,i[_][1]])}else y.push([i[_][0],i[_][1]])}}else{var S=[];m.push(S);for(var P=0;P<i.length;++P)S.push([i[P][0],i[P][1]])}for(var T=new Aa(this.properties),L=0;L<m.length;++L){var D=new ha;T.geometries.push(D);for(var F=m[L],N=0;N<F.length;++N)D.move_to(F[N])}return T},Cr),da=((Cr.polyline=Cr).polygon=function(e,t){var i,r,n,o,s,a,l;for(r=1;r<=8;r*=2){for(i=[],o=!(xr(n=e[e.length-1],t)&r),s=0;s<e.length;s++)(l=!(xr(a=e[s],t)&r))!==o&&i.push(wr(n,a,r,t)),l&&i.push(a),n=a,o=l;if(!(e=i).length)break}return i},Array.prototype.slice),ga={successCallback:null,verbose:!1,polygons:!1},ma={},ya=64,_a=16,va=4,Ca=1,p=[],f=[],d=[],g=[],m=[],y=[],wa=[],xa=[],ba=[],Ea=[],Ba=[],Ma=[],Ia=[],Sa=[],Pa=[],Ta=[],La=[],Da=[],Fa=[],Na=[],Oa=[],Ra=[],Ua=[],ka=[],Ha=(wa[85]=Ea[85]=-1,xa[85]=Ba[85]=0,ba[85]=Ma[85]=1,Fa[85]=Ra[85]=1,Na[85]=Ua[85]=0,Oa[85]=ka[85]=1,p[85]=g[85]=0,f[85]=m[85]=-1,d[85]=Pa[85]=0,Ta[85]=Ia[85]=0,La[85]=Sa[85]=1,y[85]=Da[85]=1,Ra[1]=Ra[169]=0,Ua[1]=Ua[169]=-1,ka[1]=ka[169]=0,Ia[1]=Ia[169]=-1,Sa[1]=Sa[169]=0,Pa[1]=Pa[169]=0,Ea[4]=Ea[166]=0,Ba[4]=Ba[166]=-1,Ma[4]=Ma[166]=1,Ta[4]=Ta[166]=1,La[4]=La[166]=0,Da[4]=Da[166]=0,wa[16]=wa[154]=0,xa[16]=xa[154]=1,ba[16]=ba[154]=1,g[16]=g[154]=1,m[16]=m[154]=0,y[16]=y[154]=1,Fa[64]=Fa[106]=0,Na[64]=Na[106]=1,Oa[64]=Oa[106]=0,p[64]=p[106]=-1,f[64]=f[106]=0,d[64]=d[106]=1,Fa[2]=Fa[168]=0,Na[2]=Na[168]=-1,Oa[2]=Oa[168]=1,Ra[2]=Ra[168]=0,Ua[2]=Ua[168]=-1,ka[2]=ka[168]=0,Ia[2]=Ia[168]=-1,Sa[2]=Sa[168]=0,Pa[2]=Pa[168]=0,Ta[2]=Ta[168]=-1,La[2]=La[168]=0,Da[2]=Da[168]=1,wa[8]=wa[162]=0,xa[8]=xa[162]=-1,ba[8]=ba[162]=0,Ea[8]=Ea[162]=0,Ba[8]=Ba[162]=-1,Ma[8]=Ma[162]=1,Ia[8]=Ia[162]=1,Sa[8]=Sa[162]=0,Pa[8]=Pa[162]=1,Ta[8]=Ta[162]=1,La[8]=La[162]=0,Da[8]=Da[162]=0,wa[32]=wa[138]=0,xa[32]=xa[138]=1,ba[32]=ba[138]=1,Ea[32]=Ea[138]=0,Ba[32]=Ba[138]=1,Ma[32]=Ma[138]=0,p[32]=p[138]=1,f[32]=f[138]=0,d[32]=d[138]=0,g[32]=g[138]=1,m[32]=m[138]=0,y[32]=y[138]=1,Ra[128]=Ra[42]=0,Ua[128]=Ua[42]=1,ka[128]=ka[42]=1,Fa[128]=Fa[42]=0,Na[128]=Na[42]=1,Oa[128]=Oa[42]=0,p[128]=p[42]=-1,f[128]=f[42]=0,d[128]=d[42]=1,g[128]=g[42]=-1,m[128]=m[42]=0,y[128]=y[42]=0,Ea[5]=Ea[165]=-1,Ba[5]=Ba[165]=0,Ma[5]=Ma[165]=0,Ra[5]=Ra[165]=1,Ua[5]=Ua[165]=0,ka[5]=ka[165]=0,Ta[20]=Ta[150]=0,La[20]=La[150]=1,Da[20]=Da[150]=1,g[20]=g[150]=0,m[20]=m[150]=-1,y[20]=y[150]=1,wa[80]=wa[90]=-1,xa[80]=xa[90]=0,ba[80]=ba[90]=1,Fa[80]=Fa[90]=1,Na[80]=Na[90]=0,Oa[80]=Oa[90]=1,Ia[65]=Ia[105]=0,Sa[65]=Sa[105]=1,Pa[65]=Pa[105]=0,p[65]=p[105]=0,f[65]=f[105]=-1,d[65]=d[105]=0,wa[160]=wa[10]=-1,xa[160]=xa[10]=0,ba[160]=ba[10]=1,Ea[160]=Ea[10]=-1,Ba[160]=Ba[10]=0,Ma[160]=Ma[10]=0,Ra[160]=Ra[10]=1,Ua[160]=Ua[10]=0,ka[160]=ka[10]=0,Fa[160]=Fa[10]=1,Na[160]=Na[10]=0,Oa[160]=Oa[10]=1,Ta[130]=Ta[40]=0,La[130]=La[40]=1,Da[130]=Da[40]=1,Ia[130]=Ia[40]=0,Sa[130]=Sa[40]=1,Pa[130]=Pa[40]=0,p[130]=p[40]=0,f[130]=f[40]=-1,d[130]=d[40]=0,g[130]=g[40]=0,m[130]=m[40]=-1,y[130]=y[40]=1,Ea[37]=Ea[133]=0,Ba[37]=Ba[133]=1,Ma[37]=Ma[133]=1,Ra[37]=Ra[133]=0,Ua[37]=Ua[133]=1,ka[37]=ka[133]=0,p[37]=p[133]=-1,f[37]=f[133]=0,d[37]=d[133]=0,g[37]=g[133]=1,m[37]=m[133]=0,y[37]=y[133]=0,Ta[148]=Ta[22]=-1,La[148]=La[22]=0,Da[148]=Da[22]=0,Ra[148]=Ra[22]=0,Ua[148]=Ua[22]=-1,ka[148]=ka[22]=1,Fa[148]=Fa[22]=0,Na[148]=Na[22]=1,Oa[148]=Oa[22]=1,g[148]=g[22]=-1,m[148]=m[22]=0,y[148]=y[22]=1,wa[82]=wa[88]=0,xa[82]=xa[88]=-1,ba[82]=ba[88]=1,Ta[82]=Ta[88]=1,La[82]=La[88]=0,Da[82]=Da[88]=1,Ia[82]=Ia[88]=-1,Sa[82]=Sa[88]=0,Pa[82]=Pa[88]=1,Fa[82]=Fa[88]=0,Na[82]=Na[88]=-1,Oa[82]=Oa[88]=0,wa[73]=wa[97]=0,xa[73]=xa[97]=1,ba[73]=ba[97]=0,Ea[73]=Ea[97]=0,Ba[73]=Ba[97]=-1,Ma[73]=Ma[97]=0,Ia[73]=Ia[97]=1,Sa[73]=Sa[97]=0,Pa[73]=Pa[97]=0,p[73]=p[97]=1,f[73]=f[97]=0,d[73]=d[97]=1,wa[145]=wa[25]=0,xa[145]=xa[25]=-1,ba[145]=ba[25]=0,Ia[145]=Ia[25]=1,Sa[145]=Sa[25]=0,Pa[145]=Pa[25]=1,Ra[145]=Ra[25]=0,Ua[145]=Ua[25]=1,ka[145]=ka[25]=1,g[145]=g[25]=-1,m[145]=m[25]=0,y[145]=y[25]=0,Ea[70]=Ea[100]=0,Ba[70]=Ba[100]=1,Ma[70]=Ma[100]=0,Ta[70]=Ta[100]=-1,La[70]=La[100]=0,Da[70]=Da[100]=1,Fa[70]=Fa[100]=0,Na[70]=Na[100]=-1,Oa[70]=Oa[100]=1,p[70]=p[100]=1,f[70]=f[100]=0,d[70]=d[100]=0,Ea[101]=Ea[69]=0,Ba[101]=Ba[69]=1,Ma[101]=Ma[69]=0,p[101]=p[69]=1,f[101]=f[69]=0,d[101]=d[69]=0,Ra[149]=Ra[21]=0,Ua[149]=Ua[21]=1,ka[149]=ka[21]=1,g[149]=g[21]=-1,m[149]=m[21]=0,y[149]=y[21]=0,Ta[86]=Ta[84]=-1,La[86]=La[84]=0,Da[86]=Da[84]=1,Fa[86]=Fa[84]=0,Na[86]=Na[84]=-1,Oa[86]=Oa[84]=1,wa[89]=wa[81]=0,xa[89]=xa[81]=-1,ba[89]=ba[81]=0,Ia[89]=Ia[81]=1,Sa[89]=Sa[81]=0,Pa[89]=Pa[81]=1,wa[96]=wa[74]=0,xa[96]=xa[74]=1,ba[96]=ba[74]=0,Ea[96]=Ea[74]=-1,Ba[96]=Ba[74]=0,Ma[96]=Ma[74]=1,Fa[96]=Fa[74]=1,Na[96]=Na[74]=0,Oa[96]=Oa[74]=0,p[96]=p[74]=1,f[96]=f[74]=0,d[96]=d[74]=1,wa[24]=wa[146]=0,xa[24]=xa[146]=-1,ba[24]=ba[146]=1,Ta[24]=Ta[146]=1,La[24]=La[146]=0,Da[24]=Da[146]=1,Ia[24]=Ia[146]=0,Sa[24]=Sa[146]=1,Pa[24]=Pa[146]=1,g[24]=g[146]=0,m[24]=m[146]=-1,y[24]=y[146]=0,Ea[6]=Ea[164]=-1,Ba[6]=Ba[164]=0,Ma[6]=Ma[164]=1,Ta[6]=Ta[164]=-1,La[6]=La[164]=0,Da[6]=Da[164]=0,Ra[6]=Ra[164]=0,Ua[6]=Ua[164]=-1,ka[6]=ka[164]=1,Fa[6]=Fa[164]=1,Na[6]=Na[164]=0,Oa[6]=Oa[164]=0,Ia[129]=Ia[41]=0,Sa[129]=Sa[41]=1,Pa[129]=Pa[41]=1,Ra[129]=Ra[41]=0,Ua[129]=Ua[41]=1,ka[129]=ka[41]=0,p[129]=p[41]=-1,f[129]=f[41]=0,d[129]=d[41]=0,g[129]=g[41]=0,m[129]=m[41]=-1,y[129]=y[41]=0,Ta[66]=Ta[104]=0,La[66]=La[104]=1,Da[66]=Da[104]=0,Ia[66]=Ia[104]=-1,Sa[66]=Sa[104]=0,Pa[66]=Pa[104]=1,Fa[66]=Fa[104]=0,Na[66]=Na[104]=-1,Oa[66]=Oa[104]=0,p[66]=p[104]=0,f[66]=f[104]=-1,d[66]=d[104]=1,wa[144]=wa[26]=-1,xa[144]=xa[26]=0,ba[144]=ba[26]=0,Ra[144]=Ra[26]=1,Ua[144]=Ua[26]=0,ka[144]=ka[26]=1,Fa[144]=Fa[26]=0,Na[144]=Na[26]=1,Oa[144]=Oa[26]=1,g[144]=g[26]=-1,m[144]=m[26]=0,y[144]=y[26]=1,Ea[36]=Ea[134]=0,Ba[36]=Ba[134]=1,Ma[36]=Ma[134]=1,Ta[36]=Ta[134]=0,La[36]=La[134]=1,Da[36]=Da[134]=0,p[36]=p[134]=0,f[36]=f[134]=-1,d[36]=d[134]=1,g[36]=g[134]=1,m[36]=m[134]=0,y[36]=y[134]=0,wa[9]=wa[161]=-1,xa[9]=xa[161]=0,ba[9]=ba[161]=0,Ea[9]=Ea[161]=0,Ba[9]=Ba[161]=-1,Ma[9]=Ma[161]=0,Ia[9]=Ia[161]=1,Sa[9]=Sa[161]=0,Pa[9]=Pa[161]=0,Ra[9]=Ra[161]=1,Ua[9]=Ua[161]=0,ka[9]=ka[161]=1,wa[136]=0,ba[136]=xa[136]=1,Ea[136]=0,Ba[136]=1,Ma[136]=0,Ta[136]=-1,La[136]=0,Ia[136]=-(Da[136]=1),Ra[136]=Pa[136]=Sa[136]=0,Ua[136]=-1,Fa[136]=ka[136]=0,Na[136]=-1,p[136]=Oa[136]=1,d[136]=f[136]=0,g[136]=1,m[136]=0,y[136]=1,wa[34]=0,xa[34]=-1,Ea[34]=ba[34]=0,Ba[34]=-1,Ta[34]=Ma[34]=1,Da[34]=La[34]=0,Ia[34]=1,Sa[34]=0,Pa[34]=1,Ra[34]=0,ka[34]=Ua[34]=1,Fa[34]=0,Na[34]=1,Oa[34]=0,p[34]=-1,f[34]=0,g[34]=-(d[34]=1),wa[35]=y[34]=m[34]=0,ba[35]=xa[35]=1,Ea[35]=0,Ba[35]=-1,Ta[35]=Ma[35]=1,Da[35]=La[35]=0,Ia[35]=-1,Ra[35]=Pa[35]=Sa[35]=0,Ua[35]=-1,Fa[35]=ka[35]=0,Na[35]=1,Oa[35]=0,p[35]=-1,f[35]=0,g[35]=d[35]=1,m[35]=0,y[35]=1,wa[153]=0,Ia[153]=-(ba[153]=xa[153]=1),Ra[153]=Pa[153]=Sa[153]=0,Ua[153]=-1,ka[153]=0,g[153]=1,m[153]=0,y[153]=1,Ea[102]=0,Ba[102]=-1,Ta[102]=Ma[102]=1,Fa[102]=Da[102]=La[102]=0,Na[102]=1,Oa[102]=0,p[102]=-1,f[102]=0,d[102]=1,wa[155]=0,xa[155]=-1,ba[155]=0,Ia[155]=1,Sa[155]=0,Pa[155]=1,Ra[155]=0,g[155]=-(ka[155]=Ua[155]=1),Ea[103]=y[155]=m[155]=0,Ba[103]=1,Ma[103]=0,Ta[103]=-1,La[103]=0,Da[103]=1,Fa[103]=0,Na[103]=-1,p[103]=Oa[103]=1,wa[152]=d[103]=f[103]=0,Ta[152]=-(ba[152]=xa[152]=1),La[152]=0,Ia[152]=-(Da[152]=1),Ra[152]=Pa[152]=Sa[152]=0,Ua[152]=-1,Fa[152]=ka[152]=0,Na[152]=-1,g[152]=Oa[152]=1,m[152]=0,y[152]=1,wa[156]=0,xa[156]=-1,Ta[156]=ba[156]=1,La[156]=0,Ia[156]=-(Da[156]=1),Ra[156]=Pa[156]=Sa[156]=0,Ua[156]=-1,Fa[156]=ka[156]=0,g[156]=-(Oa[156]=Na[156]=1),m[156]=0,y[156]=1,wa[137]=0,ba[137]=xa[137]=1,Ea[137]=0,Ba[137]=1,Ma[137]=0,Ia[137]=-1,Ra[137]=Pa[137]=Sa[137]=0,Ua[137]=-1,ka[137]=0,p[137]=1,d[137]=f[137]=0,g[137]=1,m[137]=0,y[137]=1,wa[139]=0,ba[139]=xa[139]=1,Ea[139]=0,Ba[139]=-1,Ma[139]=0,Ia[139]=1,Ra[139]=Pa[139]=Sa[139]=0,Ua[139]=1,ka[139]=0,p[139]=-1,d[139]=f[139]=0,g[139]=1,m[139]=0,y[139]=1,wa[98]=0,xa[98]=-1,Ea[98]=ba[98]=0,Ba[98]=-1,Ta[98]=Ma[98]=1,Da[98]=La[98]=0,Ia[98]=1,Sa[98]=0,Pa[98]=1,Fa[98]=0,Na[98]=1,Oa[98]=0,p[98]=-1,f[98]=0,d[98]=1,wa[99]=0,xa[99]=1,Ea[99]=ba[99]=0,Ba[99]=-1,Ta[99]=Ma[99]=1,Da[99]=La[99]=0,Ia[99]=-1,Sa[99]=0,Pa[99]=1,Fa[99]=0,Na[99]=-1,Oa[99]=0,p[99]=1,f[99]=0,d[99]=1,Ea[38]=0,Ba[38]=-1,Ta[38]=Ma[38]=1,Ra[38]=Da[38]=La[38]=0,ka[38]=Ua[38]=1,Fa[38]=0,Na[38]=1,Oa[38]=0,p[38]=-1,f[38]=0,g[38]=-(d[38]=1),Ea[39]=y[38]=m[38]=0,Ta[39]=-(Ma[39]=Ba[39]=1),Ra[39]=Da[39]=La[39]=0,Ua[39]=-1,ka[39]=1,Fa[39]=0,Na[39]=1,Oa[39]=0,p[39]=-1,f[39]=0,g[39]=d[39]=1,y[39]=m[39]=0,function(e){return[[e.bottomleft,0],[0,0],[0,e.leftbottom]]}),Qa=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0]]},Va=function(e){return[[e.topright,1],[1,1],[1,e.righttop]]},Ga=function(e){return[[0,e.lefttop],[0,1],[e.topleft,1]]},za=function(e){return[[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop]]},Wa=function(e){return[[e.bottomright,0],[e.bottomleft,0],[1,e.righttop],[1,e.rightbottom]]},qa=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.topleft,1],[e.topright,1]]},Ka=function(e){return[[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]},M=[],I=[],S=[],P=[],T=[],L=[],ja=[],Za=[],c=(P[1]=T[1]=18,P[169]=T[169]=18,S[4]=I[4]=12,S[166]=I[166]=12,M[16]=Za[16]=4,M[154]=Za[154]=4,L[64]=ja[64]=22,L[106]=ja[106]=22,S[2]=L[2]=17,P[2]=T[2]=18,S[168]=L[168]=17,P[168]=T[168]=18,M[8]=P[8]=9,I[8]=S[8]=12,M[162]=P[162]=9,I[162]=S[162]=12,M[32]=Za[32]=4,I[32]=ja[32]=1,M[138]=Za[138]=4,I[138]=ja[138]=1,T[128]=Za[128]=21,L[128]=ja[128]=22,T[42]=Za[42]=21,L[42]=ja[42]=22,I[5]=T[5]=14,I[165]=T[165]=14,S[20]=Za[20]=6,S[150]=Za[150]=6,M[80]=L[80]=11,M[90]=L[90]=11,P[65]=ja[65]=3,P[105]=ja[105]=3,M[160]=L[160]=11,I[160]=T[160]=14,M[10]=L[10]=11,I[10]=T[10]=14,S[130]=Za[130]=6,P[130]=ja[130]=3,S[40]=Za[40]=6,P[40]=ja[40]=3,I[101]=ja[101]=1,I[69]=ja[69]=1,T[149]=Za[149]=21,T[21]=Za[21]=21,S[86]=L[86]=17,S[84]=L[84]=17,M[89]=P[89]=9,M[81]=P[81]=9,M[96]=ja[96]=0,I[96]=L[96]=15,M[74]=ja[74]=0,I[74]=L[74]=15,M[24]=S[24]=8,P[24]=Za[24]=7,M[146]=S[146]=8,P[146]=Za[146]=7,I[6]=L[6]=15,S[6]=T[6]=16,I[164]=L[164]=15,S[164]=T[164]=16,P[129]=Za[129]=7,T[129]=ja[129]=20,P[41]=Za[41]=7,T[41]=ja[41]=20,S[66]=ja[66]=2,P[66]=L[66]=19,S[104]=ja[104]=2,P[104]=L[104]=19,M[144]=T[144]=10,L[144]=Za[144]=23,M[26]=T[26]=10,L[26]=Za[26]=23,I[36]=Za[36]=5,S[36]=ja[36]=2,I[134]=Za[134]=5,S[134]=ja[134]=2,M[9]=T[9]=10,I[9]=P[9]=13,M[161]=T[161]=10,I[161]=P[161]=13,I[37]=Za[37]=5,T[37]=ja[37]=20,I[133]=Za[133]=5,T[133]=ja[133]=20,S[148]=T[148]=16,L[148]=Za[148]=23,S[22]=T[22]=16,L[22]=Za[22]=23,M[82]=S[82]=8,P[82]=L[82]=19,M[88]=S[88]=8,P[88]=L[88]=19,M[73]=ja[73]=0,I[73]=P[73]=13,M[97]=ja[97]=0,I[97]=P[97]=13,M[145]=P[145]=9,T[145]=Za[145]=21,M[25]=P[25]=9,T[25]=Za[25]=21,I[70]=ja[70]=1,S[70]=L[70]=17,I[100]=ja[100]=1,S[100]=L[100]=17,M[34]=P[34]=9,I[34]=S[34]=12,T[34]=Za[34]=21,L[34]=ja[34]=22,M[136]=Za[136]=4,I[136]=ja[136]=1,S[136]=L[136]=17,P[136]=T[136]=18,M[35]=Za[35]=4,I[35]=S[35]=12,P[35]=T[35]=18,L[35]=ja[35]=22,M[153]=Za[153]=4,P[153]=T[153]=18,I[102]=S[102]=12,L[102]=ja[102]=22,M[155]=P[155]=9,T[155]=Za[155]=23,I[103]=ja[103]=1,S[103]=L[103]=17,M[152]=Za[152]=4,S[152]=L[152]=17,P[152]=T[152]=18,M[156]=S[156]=8,P[156]=T[156]=18,L[156]=Za[156]=23,M[137]=Za[137]=4,I[137]=ja[137]=1,P[137]=T[137]=18,M[139]=Za[139]=4,I[139]=P[139]=13,T[139]=ja[139]=20,M[98]=P[98]=9,I[98]=S[98]=12,L[98]=ja[98]=22,M[99]=ja[99]=0,I[99]=S[99]=12,P[99]=L[99]=19,I[38]=S[38]=12,T[38]=Za[38]=21,L[38]=ja[38]=22,I[39]=Za[39]=5,S[39]=T[39]=16,L[39]=ja[39]=22,[]),Ya=(c[1]=c[169]=Ha,c[4]=c[166]=Qa,c[16]=c[154]=Va,c[64]=c[106]=Ga,c[168]=c[2]=za,c[162]=c[8]=Wa,c[138]=c[32]=qa,c[42]=c[128]=Ka,c[5]=c[165]=function(e){return[[0,0],[0,e.leftbottom],[1,e.rightbottom],[1,0]]},c[20]=c[150]=function(e){return[[1,0],[e.bottomright,0],[e.topright,1],[1,1]]},c[80]=c[90]=function(e){return[[1,1],[1,e.righttop],[0,e.lefttop],[0,1]]},c[65]=c[105]=function(e){return[[e.bottomleft,0],[0,0],[0,1],[e.topleft,1]]},c[160]=c[10]=function(e){return[[1,e.righttop],[1,e.rightbottom],[0,e.leftbottom],[0,e.lefttop]]},c[130]=c[40]=function(e){return[[e.topleft,1],[e.topright,1],[e.bottomright,0],[e.bottomleft,0]]},c[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},c[101]=c[69]=function(e){return[[1,e.rightbottom],[1,0],[0,0],[0,1],[e.topleft,1]]},c[149]=c[21]=function(e){return[[e.topright,1],[1,1],[1,0],[0,0],[0,e.leftbottom]]},c[86]=c[84]=function(e){return[[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[1,1]]},c[89]=c[81]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,1]]},c[96]=c[74]=function(e){return[[1,e.righttop],[1,e.rightbottom],[0,e.lefttop],[0,1],[e.topleft,1]]},c[24]=c[146]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[e.topright,1]]},c[6]=c[164]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop]]},c[129]=c[41]=function(e){return[[e.topright,1],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topleft,1]]},c[66]=c[104]=function(e){return[[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1],[e.topleft,1]]},c[144]=c[26]=function(e){return[[1,1],[1,e.righttop],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},c[36]=c[134]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[e.topleft,1],[e.topright,1]]},c[9]=c[161]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,e.leftbottom]]},c[37]=c[133]=function(e){return[[1,e.rightbottom],[1,0],[0,0],[0,e.leftbottom],[e.topleft,1],[e.topright,1]]},c[148]=c[22]=function(e){return[[1,1],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},c[82]=c[88]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1]]},c[73]=c[97]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,1],[e.topleft,1]]},c[145]=c[25]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topright,1]]},c[70]=c[100]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[e.topleft,1]]},c[34]=function(e){return[Ka(e),Wa(e)]},c[35]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]},c[136]=function(e){return[qa(e),za(e)]},c[153]=function(e){return[Va(e),Ha(e)]},c[102]=function(e){return[Qa(e),Ga(e)]},c[155]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topright,1]]},c[103]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[e.topleft,1]]},c[152]=function(e){return[Va(e),za(e)]},c[156]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},c[137]=function(e){return[qa(e),Ha(e)]},c[139]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topleft,1],[e.topright,1]]},c[98]=function(e){return[Wa(e),Ga(e)]},c[99]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1],[e.topleft,1]]},c[38]=function(e){return[Qa(e),Ka(e)]},c[39]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]},function e(t){this.id=e.buildId(t),this.coordinates=t,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}),Xa=(Ya.buildId=function(e){return e.join(",")},Ya.prototype.removeInnerEdge=function(t){this.innerEdges=this.innerEdges.filter(function(e){return e.from.id!==t.from.id})},Ya.prototype.removeOuterEdge=function(t){this.outerEdges=this.outerEdges.filter(function(e){return e.to.id!==t.to.id})},Ya.prototype.addOuterEdge=function(e){this.outerEdges.push(e),this.outerEdgesSorted=!1},Ya.prototype.sortOuterEdges=function(){var o=this;this.outerEdgesSorted||(this.outerEdges.sort(function(e,t){var i=e.to,r=t.to;if(i.coordinates[0]-o.coordinates[0]>=0&&r.coordinates[0]-o.coordinates[0]<0)return 1;if(i.coordinates[0]-o.coordinates[0]<0&&r.coordinates[0]-o.coordinates[0]>=0)return-1;if(i.coordinates[0]-o.coordinates[0]==0&&r.coordinates[0]-o.coordinates[0]==0)return i.coordinates[1]-o.coordinates[1]>=0||r.coordinates[1]-o.coordinates[1]>=0?i.coordinates[1]-r.coordinates[1]:r.coordinates[1]-i.coordinates[1];var n=Zr(o.coordinates,i.coordinates,r.coordinates);if(n<0)return 1;if(n>0)return-1;return Math.pow(i.coordinates[0]-o.coordinates[0],2)+Math.pow(i.coordinates[1]-o.coordinates[1],2)-(Math.pow(r.coordinates[0]-o.coordinates[0],2)+Math.pow(r.coordinates[1]-o.coordinates[1],2))}),this.outerEdgesSorted=!0)},Ya.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},Ya.prototype.getOuterEdge=function(e){return this.sortOuterEdges(),this.outerEdges[e]},Ya.prototype.addInnerEdge=function(e){this.innerEdges.push(e)},function(e,t){this.from=e,this.to=t,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}),Ja=(Xa.prototype.getSymetric=function(){return this.symetric||(this.symetric=new Xa(this.to,this.from),this.symetric.symetric=this),this.symetric},Xa.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},Xa.prototype.isEqual=function(e){return this.from.id===e.from.id&&this.to.id===e.to.id},Xa.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},Xa.prototype.toLineString=function(){return W([this.from.coordinates,this.to.coordinates])},Xa.prototype.compareTo=function(e){return Zr(e.from.coordinates,e.to.coordinates,this.to.coordinates)},function(){this.edges=[],this.polygon=void 0,this.envelope=void 0}),$a={length:{configurable:!0}},el=(Ja.prototype.push=function(e){this[this.edges.length]=e,this.edges.push(e),this.polygon=this.envelope=void 0},Ja.prototype.get=function(e){return this.edges[e]},$a.length.get=function(){return this.edges.length},Ja.prototype.forEach=function(e){this.edges.forEach(e)},Ja.prototype.map=function(e){return this.edges.map(e)},Ja.prototype.some=function(e){return this.edges.some(e)},Ja.prototype.isValid=function(){return!0},Ja.prototype.isHole=function(){var r=this,e=this.edges.reduce(function(e,t,i){return t.from.coordinates[1]>r.edges[e].from.coordinates[1]&&(e=i),e},0),t=(0===e?this.length:e)-1,i=(e+1)%this.length,n=Zr(this.edges[t].from.coordinates,this.edges[e].from.coordinates,this.edges[i].from.coordinates);return 0===n?this.edges[t].from.coordinates[0]>this.edges[i].from.coordinates[0]:n>0},Ja.prototype.toMultiPoint=function(){return o(this.edges.map(function(e){return e.from.coordinates}))},Ja.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var e=this.edges.map(function(e){return e.from.coordinates});return e.push(this.edges[0].from.coordinates),this.polygon=k([e])},Ja.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=Qt(this.toPolygon())},Ja.findEdgeRingContaining=function(r,e){var n,o,s=r.getEnvelope();return e.forEach(function(e){var t=e.getEnvelope();if(o&&(n=o.getEnvelope()),!function(e,t){var i=e.geometry.coordinates.map(function(e){return e[0]}),r=e.geometry.coordinates.map(function(e){return e[1]}),n=t.geometry.coordinates.map(function(e){return e[0]}),o=t.geometry.coordinates.map(function(e){return e[1]});return Math.max(null,i)===Math.max(null,n)&&Math.max(null,r)===Math.max(null,o)&&Math.min(null,i)===Math.min(null,n)&&Math.min(null,r)===Math.min(null,o)}(t,s)&&Yr(t,s)){var i=r.map(function(e){return e.from.coordinates}).find(function(t){return!e.some(function(e){return function(e,t){return e[0]===t[0]&&e[1]===t[1]}(t,e.from.coordinates)})});i&&e.inside(z(i))&&(o&&!Yr(n,t)||(o=e))}}),o},Ja.prototype.inside=function(e){return at(e,this.toPolygon())},Object.defineProperties(Ja.prototype,$a),function(){this.edges=[],this.nodes={}}),tl=(el.fromGeoJson=function(e){!function(e){if(!e)throw new Error("No geojson passed");if("FeatureCollection"!==e.type&&"GeometryCollection"!==e.type&&"MultiLineString"!==e.type&&"LineString"!==e.type&&"Feature"!==e.type)throw new Error("Invalid input type '"+e.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}(e);var n=new el;return fe(e,function(e){be(e,"LineString","Graph::fromGeoJson"),se(e,function(e,t){if(e){var i=n.getNode(e),r=n.getNode(t);n.addEdge(i,r)}return t})}),n},el.prototype.getNode=function(e){var t=Ya.buildId(e),i=this.nodes[t];return i||(i=this.nodes[t]=new Ya(e)),i},el.prototype.addEdge=function(e,t){var i=new Xa(e,t),r=i.getSymetric();this.edges.push(i),this.edges.push(r)},el.prototype.deleteDangles=function(){var t=this;Object.keys(this.nodes).map(function(e){return t.nodes[e]}).forEach(function(e){return t._removeIfDangle(e)})},el.prototype._removeIfDangle=function(e){var t=this;if(e.innerEdges.length<=1){var i=e.getOuterEdges().map(function(e){return e.to});this.removeNode(e),i.forEach(function(e){return t._removeIfDangle(e)})}},el.prototype.deleteCutEdges=function(){var t=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach(function(e){e.label===e.symetric.label&&(t.removeEdge(e.symetric),t.removeEdge(e))})},el.prototype._computeNextCWEdges=function(i){var t=this;void 0===i?Object.keys(this.nodes).forEach(function(e){return t._computeNextCWEdges(t.nodes[e])}):i.getOuterEdges().forEach(function(e,t){i.getOuterEdge((0===t?i.getOuterEdges().length:t)-1).symetric.next=e})},el.prototype._computeNextCCWEdges=function(e,t){for(var i,r,n=e.getOuterEdges(),o=n.length-1;o>=0;--o){var s=n[o],a=s.symetric,l=void 0,u=void 0;s.label===t&&(l=s),a.label===t&&(u=a),l&&u&&(u&&(r=u),l&&(r&&(r.next=l,r=void 0),i||(i=l)))}r&&(r.next=i)},el.prototype._findLabeledEdgeRings=function(){var i=[],r=0;return this.edges.forEach(function(e){if(!(e.label>=0)){i.push(e);var t=e;do{t.label=r,t=t.next}while(!e.isEqual(t));r++}}),i},el.prototype.getEdgeRings=function(){var i=this;this._computeNextCWEdges(),this.edges.forEach(function(e){e.label=void 0}),this._findLabeledEdgeRings().forEach(function(t){i._findIntersectionNodes(t).forEach(function(e){i._computeNextCCWEdges(e,t.label)})});var t=[];return this.edges.forEach(function(e){e.ring||t.push(i._findEdgeRing(e))}),t},el.prototype._findIntersectionNodes=function(i){var e=[],r=i,t=function(){var t=0;r.from.getOuterEdges().forEach(function(e){e.label===i.label&&++t}),t>1&&e.push(r.from),r=r.next};do{t()}while(!i.isEqual(r));return e},el.prototype._findEdgeRing=function(e){var t=e,i=new Ja;do{i.push(t),t.ring=i,t=t.next}while(!e.isEqual(t));return i},el.prototype.removeNode=function(e){var t=this;e.getOuterEdges().forEach(function(e){return t.removeEdge(e)}),e.innerEdges.forEach(function(e){return t.removeEdge(e)}),delete this.nodes[e.id]},el.prototype.removeEdge=function(t){this.edges=this.edges.filter(function(e){return!e.isEqual(t)}),t.deleteEdge()},Ze(function(e,t){function i(e){var t=[];for(var i in e)t.push(i);return t}(e.exports="function"==typeof Object.keys?Object.keys:i).shim=i})),il=(tl.shim,Ze(function(e,t){function i(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function r(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Object.prototype.hasOwnProperty.call(e,"callee")&&!Object.prototype.propertyIsEnumerable.call(e,"callee")||!1}var n="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();(t=e.exports=n?i:r).supported=i,t.unsupported=r})),rl=(il.supported,il.unsupported,Ze(function(e){function a(e){return null===e||void 0===e}function l(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length)&&("function"==typeof e.copy&&"function"==typeof e.slice&&!(e.length>0&&"number"!=typeof e[0]))}var u=Array.prototype.slice,c=e.exports=function(e,t,i){return i||(i={}),e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||"object"!=typeof e&&"object"!=typeof t?i.strict?e===t:e==t:function(e,t,i){var r,n;if(a(e)||a(t))return!1;if(e.prototype!==t.prototype)return!1;if(il(e))return!!il(t)&&(e=u.call(e),t=u.call(t),c(e,t,i));if(l(e)){if(!l(t))return!1;if(e.length!==t.length)return!1;for(r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}try{var o=tl(e),s=tl(t)}catch(e){return!1}if(o.length!=s.length)return!1;for(o.sort(),s.sort(),r=o.length-1;r>=0;r--)if(o[r]!=s[r])return!1;for(r=o.length-1;r>=0;r--)if(n=o[r],!c(e[n],t[n],i))return!1;return typeof e==typeof t}(e,t,i))}})),nl=function(e){this.precision=e&&e.precision?e.precision:17,this.direction=!(!e||!e.direction)&&e.direction,this.pseudoNode=!(!e||!e.pseudoNode)&&e.pseudoNode,this.objectComparator=e&&e.objectComparator?e.objectComparator:ln},ol=(nl.prototype.compare=function(e,t){if(e.type!==t.type||!an(e,t))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,t.coordinates);case"LineString":return this.compareLine(e.coordinates,t.coordinates,0,!1);case"Polygon":return this.comparePolygon(e,t);case"Feature":return this.compareFeature(e,t);default:if(0===e.type.indexOf("Multi")){var i=this,r=sn(e),n=sn(t);return r.every(function(t){return this.some(function(e){return i.compare(t,e)})},n)}}return!1},nl.prototype.compareCoord=function(e,t){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(e[i].toFixed(this.precision)!==t[i].toFixed(this.precision))return!1;return!0},nl.prototype.compareLine=function(e,t,i,r){if(!an(e,t))return!1;var n=this.pseudoNode?e:this.removePseudo(e),o=this.pseudoNode?t:this.removePseudo(t);if(!r||this.compareCoord(n[0],o[0])||(o=this.fixStartIndex(o,n))){var s=this.compareCoord(n[i],o[i]);return this.direction||s?this.comparePath(n,o):!!this.compareCoord(n[i],o[o.length-(1+i)])&&this.comparePath(n.slice().reverse(),o)}},nl.prototype.fixStartIndex=function(e,t){for(var i,r=-1,n=0;n<e.length;n++)if(this.compareCoord(e[n],t[0])){r=n;break}return r>=0&&(i=[].concat(e.slice(r,e.length),e.slice(1,r+1))),i},nl.prototype.comparePath=function(e,t){var i=this;return e.every(function(e,t){return i.compareCoord(e,this[t])},t)},nl.prototype.comparePolygon=function(e,t){if(this.compareLine(e.coordinates[0],t.coordinates[0],1,!0)){var i=e.coordinates.slice(1,e.coordinates.length),r=t.coordinates.slice(1,t.coordinates.length),n=this;return i.every(function(t){return this.some(function(e){return n.compareLine(t,e,1,!0)})},r)}return!1},nl.prototype.compareFeature=function(e,t){return!(e.id!==t.id||!this.objectComparator(e.properties,t.properties)||!this.compareBBox(e,t))&&this.compare(e.geometry,t.geometry)},nl.prototype.compareBBox=function(e,t){return!!(!e.bbox&&!t.bbox||e.bbox&&t.bbox&&this.compareCoord(e.bbox,t.bbox))},nl.prototype.removePseudo=function(e){return e},nl),sl=Ze(function(e){function t(e,t,i,r){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(e,t,i,r)}t.prototype.run=function(e,t,i,r){this._init(e,t,i,r);for(var n=0;n<this._datasetLength;n++)if(1!==this._visited[n]){this._visited[n]=1;var o=this._regionQuery(n);if(o.length<this.minPts)this.noise.push(n);else{var s=this.clusters.length;this.clusters.push([]),this._addToCluster(n,s),this._expandCluster(s,o)}}return this.clusters},t.prototype._init=function(e,t,i,r){if(e){if(!(e instanceof Array))throw Error("Dataset must be of type array, "+typeof e+" given");this.dataset=e,this.clusters=[],this.noise=[],this._datasetLength=e.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}t&&(this.epsilon=t),i&&(this.minPts=i),r&&(this.distance=r)},t.prototype._expandCluster=function(e,t){for(var i=0;i<t.length;i++){var r=t[i];if(1!==this._visited[r]){this._visited[r]=1;var n=this._regionQuery(r);n.length>=this.minPts&&(t=this._mergeArrays(t,n))}1!==this._assigned[r]&&this._addToCluster(r,e)}},t.prototype._addToCluster=function(e,t){this.clusters[t].push(e),this._assigned[e]=1},t.prototype._regionQuery=function(e){for(var t=[],i=0;i<this._datasetLength;i++)this.distance(this.dataset[e],this.dataset[i])<this.epsilon&&t.push(i);return t},t.prototype._mergeArrays=function(e,t){for(var i=t.length,r=0;r<i;r++){var n=t[r];e.indexOf(n)<0&&e.push(n)}return e},t.prototype._euclideanDistance=function(e,t){for(var i=0,r=Math.min(e.length,t.length);r--;)i+=(e[r]-t[r])*(e[r]-t[r]);return Math.sqrt(i)},e.exports&&(e.exports=t)}),al=Ze(function(e){function t(e,t,i){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(e,t,i)}t.prototype.init=function(e,t,i){this.assignments=[],this.centroids=[],void 0!==e&&(this.dataset=e),void 0!==t&&(this.k=t),void 0!==i&&(this.distance=i)},t.prototype.run=function(e,t){this.init(e,t);for(var i=this.dataset.length,r=0;r<this.k;r++)this.centroids[r]=this.randomCentroid();for(var n=!0;n;){n=this.assign();for(var o=0;o<this.k;o++){for(var s=new Array(c),a=0,l=0;l<c;l++)s[l]=0;for(var u=0;u<i;u++){var c=this.dataset[u].length;if(o===this.assignments[u]){for(l=0;l<c;l++)s[l]+=this.dataset[u][l];a++}}if(a>0){for(l=0;l<c;l++)s[l]/=a;this.centroids[o]=s}else this.centroids[o]=this.randomCentroid(),n=!0}}return this.getClusters()},t.prototype.randomCentroid=function(){var e,t,i=this.dataset.length-1;do{t=Math.round(Math.random()*i),e=this.dataset[t]}while(this.centroids.indexOf(e)>=0);return e},t.prototype.assign=function(){for(var e,t=!1,i=this.dataset.length,r=0;r<i;r++)(e=this.argmin(this.dataset[r],this.centroids,this.distance))!=this.assignments[r]&&(this.assignments[r]=e,t=!0);return t},t.prototype.getClusters=function(){for(var e,t=new Array(this.k),i=0;i<this.assignments.length;i++)void 0===t[e=this.assignments[i]]&&(t[e]=[]),t[e].push(i);return t},t.prototype.argmin=function(e,t,i){for(var r,n=Number.MAX_VALUE,o=0,s=t.length,a=0;a<s;a++)(r=i(e,t[a]))<n&&(n=r,o=a);return o},t.prototype.distance=function(e,t){for(var i=0,r=Math.min(e.length,t.length);r--;){var n=e[r]-t[r];i+=n*n}return Math.sqrt(i)},e.exports&&(e.exports=t)}),ll=Ze(function(e){function t(e,t,i){this._queue=[],this._priorities=[],this._sorting="desc",this._init(e,t,i)}t.prototype.insert=function(e,t){for(var i=this._queue.length,r=i;r--;){var n=this._priorities[r];"desc"===this._sorting?t>n&&(i=r):t<n&&(i=r)}this._insertAt(e,t,i)},t.prototype.remove=function(e){for(var t=this._queue.length;t--;)if(e===this._queue[t]){this._queue.splice(t,1),this._priorities.splice(t,1);break}},t.prototype.forEach=function(e){this._queue.forEach(e)},t.prototype.getElements=function(){return this._queue},t.prototype.getElementPriority=function(e){return this._priorities[e]},t.prototype.getPriorities=function(){return this._priorities},t.prototype.getElementsWithPriorities=function(){for(var e=[],t=0,i=this._queue.length;t<i;t++)e.push([this._queue[t],this._priorities[t]]);return e},t.prototype._init=function(e,t,i){if(e&&t){if(this._queue=[],this._priorities=[],e.length!==t.length)throw new Error("Arrays must have the same length");for(var r=0;r<e.length;r++)this.insert(e[r],t[r])}i&&(this._sorting=i)},t.prototype._insertAt=function(e,t,i){this._queue.length===i?(this._queue.push(e),this._priorities.push(t)):(this._queue.splice(i,0,e),this._priorities.splice(i,0,t))},e.exports&&(e.exports=t)}),ul=Ze(function(e){function t(e,t,i,r){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(e,t,i,r)}if(e.exports)var u=ll;t.prototype.run=function(e,t,i,r){this._init(e,t,i,r);for(var n=0,o=this.dataset.length;n<o;n++)if(1!==this._processed[n]){this._processed[n]=1,this.clusters.push([n]);var s=this.clusters.length-1;this._orderedList.push(n);var a=new u(null,null,"asc"),l=this._regionQuery(n);void 0!==this._distanceToCore(n)&&(this._updateQueue(n,l,a),this._expandCluster(s,a))}return this.clusters},t.prototype.getReachabilityPlot=function(){for(var e=[],t=0,i=this._orderedList.length;t<i;t++){var r=this._orderedList[t],n=this._reachability[r];e.push([r,n])}return e},t.prototype._init=function(e,t,i,r){if(e){if(!(e instanceof Array))throw Error("Dataset must be of type array, "+typeof e+" given");this.dataset=e,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}t&&(this.epsilon=t),i&&(this.minPts=i),r&&(this.distance=r)},t.prototype._updateQueue=function(r,e,n){var o=this;this._coreDistance=this._distanceToCore(r),e.forEach(function(e){if(void 0===o._processed[e]){var t=o.distance(o.dataset[r],o.dataset[e]),i=Math.max(o._coreDistance,t);void 0===o._reachability[e]?(o._reachability[e]=i,n.insert(e,i)):i<o._reachability[e]&&(o._reachability[e]=i,n.remove(e),n.insert(e,i))}})},t.prototype._expandCluster=function(e,t){for(var i=t.getElements(),r=0,n=i.length;r<n;r++){var o=i[r];if(void 0===this._processed[o]){var s=this._regionQuery(o);this._processed[o]=1,this.clusters[e].push(o),this._orderedList.push(o),void 0!==this._distanceToCore(o)&&(this._updateQueue(o,s,t),this._expandCluster(e,t))}}},t.prototype._distanceToCore=function(e){for(var t=this.epsilon,i=0;i<t;i++)if(this._regionQuery(e,i).length>=this.minPts)return i},t.prototype._regionQuery=function(e,t){t=t||this.epsilon;for(var i=[],r=0,n=this.dataset.length;r<n;r++)this.distance(this.dataset[e],this.dataset[r])<t&&i.push(r);return i},t.prototype._euclideanDistance=function(e,t){for(var i=0,r=Math.min(e.length,t.length);r--;)i+=(e[r]-t[r])*(e[r]-t[r]);return Math.sqrt(i)},e.exports&&(e.exports=t)}),cl=Ze(function(e){e.exports&&(e.exports={DBSCAN:sl,KMEANS:al,OPTICS:ul,PriorityQueue:ll})}),hl=(cl.DBSCAN,cl.KMEANS,cl.OPTICS,cl.PriorityQueue,function(e,t,i){for(var r=e.length,n=0,o=0;o<r;o++){var s=(e[o]||0)-(t[o]||0);n+=s*s}return i?Math.sqrt(n):n}),Al=hl,pl=function(e,t,i){var r=Math.abs(e-t);return i?r:r*r},fl=hl,dl=function(e,t){for(var i={},r=[],n=t<<2,o=e.length,s=e[0].length>0;r.length<t&&n-- >0;){var a=e[Math.floor(Math.random()*o)],l=s?a.join("_"):""+a;i[l]||(i[l]=!0,r.push(a))}if(r.length<t)throw new Error("Error initializating clusters");return r},gl=function(e,t){var i=e[0].length?Al:pl,r=[],n=e.length,o=e[0].length>0,s=e[Math.floor(Math.random()*n)];o&&s.join("_");for(r.push(s);r.length<t;){for(var a=[],l=r.length,u=0,c=[],h=0;h<n;h++){for(var A=1/0,p=0;p<l;p++){var f=i(e[h],r[p]);f<=A&&(A=f)}a[h]=A}for(var d=0;d<n;d++)u+=a[d];for(var g=0;g<n;g++)c[g]={i:g,v:e[g],pr:a[g]/u,cs:0};c.sort(function(e,t){return e.pr-t.pr}),c[0].cs=c[0].pr;for(var m=1;m<n;m++)c[m].cs=c[m-1].cs+c[m].pr;for(var y=Math.random(),_=0;_<n-1&&c[_++].cs<y;);r.push(c[_-1].v)}return r},ml=1e4,yl=function(e,t,i,r){var n=[],o=[],s=[],a=[],l=!1,u=r||ml,c=e.length,h=e[0].length,A=h>0,p=[];if(i)n="kmrand"==i?dl(e,t):"kmpp"==i?gl(e,t):i;else for(var f={};n.length<t;){var d=Math.floor(Math.random()*c);f[d]||(f[d]=!0,n.push(e[d]))}do{cn(t,0,p);for(var g=0;g<c;g++){for(var m=1/0,y=0,_=0;_<t;_++)(a=A?fl(e[g],n[_]):Math.abs(e[g]-n[_]))<=m&&(m=a,y=_);s[g]=y,p[y]++}for(var v=[],C=(o=[],0);C<t;C++)v[C]=A?cn(h,0,v[C]):0,o[C]=n[C];if(A){for(var w=0;w<t;w++)n[w]=[];for(var x=0;x<c;x++)for(var b=v[s[x]],E=e[x],B=0;B<h;B++)b[B]+=E[B];l=!0;for(var M=0;M<t;M++){for(var I=n[M],S=v[M],P=o[M],O=p[M],T=0;T<h;T++)I[T]=S[T]/O||0;if(l)for(var L=0;L<h;L++)if(P[L]!=I[L]){l=!1;break}}}else{for(var D=0;D<c;D++)v[s[D]]+=e[D];for(var F=0;F<t;F++)n[F]=v[F]/p[F]||0;l=!0;for(var N=0;N<t;N++)if(o[N]!=n[N]){l=!1;break}}l=l||--u<=0}while(!l);return{it:ml-u,k:t,idxs:s,centroids:n}},_l={search:function(e,t,i,r){e.cleanDirty();var n=(r=r||{}).heuristic||_l.heuristics.manhattan,o=r.closest||!1,s=new dn(function(e){return e.f}),a=t;for(t.h=n(t,i),s.push(t);s.size()>0;){var l=s.pop();if(l===i)return An(l);l.closed=!0;for(var u=e.neighbors(l),c=0,h=u.length;c<h;++c){var A=u[c];if(!A.closed&&!A.isWall()){var p=l.g+A.getCost(l),f=A.visited;(!f||p<A.g)&&(A.visited=!0,A.parent=l,A.h=A.h||n(A,i),A.g=p,A.f=A.g+A.h,e.markDirty(A),o&&(A.h<a.h||A.h===a.h&&A.g<a.g)&&(a=A),f?s.rescoreElement(A):s.push(A))}}}return o?An(a):[]},heuristics:{manhattan:function(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},diagonal:function(e,t){var i=Math.sqrt(2),r=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y);return 1*(r+n)+(i-2)*Math.min(r,n)}},cleanNode:function(e){e.f=0,e.g=0,e.h=0,e.visited=!1,e.closed=!1,e.parent=null}},vl=(pn.prototype.init=function(){this.dirtyNodes=[];for(var e=0;e<this.nodes.length;e++)_l.cleanNode(this.nodes[e])},pn.prototype.cleanDirty=function(){for(var e=0;e<this.dirtyNodes.length;e++)_l.cleanNode(this.dirtyNodes[e]);this.dirtyNodes=[]},pn.prototype.markDirty=function(e){this.dirtyNodes.push(e)},pn.prototype.neighbors=function(e){var t=[],i=e.x,r=e.y,n=this.grid;return n[i-1]&&n[i-1][r]&&t.push(n[i-1][r]),n[i+1]&&n[i+1][r]&&t.push(n[i+1][r]),n[i]&&n[i][r-1]&&t.push(n[i][r-1]),n[i]&&n[i][r+1]&&t.push(n[i][r+1]),this.diagonal&&(n[i-1]&&n[i-1][r-1]&&t.push(n[i-1][r-1]),n[i+1]&&n[i+1][r-1]&&t.push(n[i+1][r-1]),n[i-1]&&n[i-1][r+1]&&t.push(n[i-1][r+1]),n[i+1]&&n[i+1][r+1]&&t.push(n[i+1][r+1])),t},pn.prototype.toString=function(){for(var e,t,i,r,n=[],o=this.grid,s=0,a=o.length;s<a;s++){for(e=[],i=0,r=(t=o[s]).length;i<r;i++)e.push(t[i].weight);n.push(e.join(" "))}return n.join("\n")},fn.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},fn.prototype.getCost=function(e){return e&&e.x!==this.x&&e.y!==this.y?1.41421*this.weight:this.weight},fn.prototype.isWall=function(){return 0===this.weight},dn.prototype={push:function(e){this.content.push(e),this.sinkDown(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),e},remove:function(e){var t=this.content.indexOf(e),i=this.content.pop();t!==this.content.length-1&&(this.content[t]=i,this.scoreFunction(i)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))},size:function(){return this.content.length},rescoreElement:function(e){this.sinkDown(this.content.indexOf(e))},sinkDown:function(e){for(var t=this.content[e];e>0;){var i=(e+1>>1)-1,r=this.content[i];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[i]=t,this.content[e]=r,e=i}},bubbleUp:function(e){for(var t=this.content.length,i=this.content[e],r=this.scoreFunction(i);;){var n,o=e+1<<1,s=o-1,a=null;if(s<t){var l=this.content[s];(n=this.scoreFunction(l))<r&&(a=s)}if(o<t){var u=this.content[o];this.scoreFunction(u)<(null===a?r:n)&&(a=o)}if(null===a)break;this.content[e]=this.content[a],this.content[a]=i,e=a}}},function(e){return function(){return e}});yn.prototype={constructor:yn,insert:function(e,t){var i,r,n;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;i=e}else this._?(e=wn(this._),t.P=null,t.N=e,e.P=e.L=t,i=e):(t.P=t.N=null,this._=t,i=null);for(t.L=t.R=null,t.U=i,t.C=!0,e=t;i&&i.C;)i===(r=i.U).L?(n=r.R)&&n.C?(i.C=n.C=!1,r.C=!0,e=r):(e===i.R&&(vn(this,i),i=(e=i).U),i.C=!1,r.C=!0,Cn(this,r)):(n=r.L)&&n.C?(i.C=n.C=!1,r.C=!0,e=r):(e===i.L&&(Cn(this,i),i=(e=i).U),i.C=!1,r.C=!0,vn(this,r)),i=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,i,r,n=e.U,o=e.L,s=e.R;if(i=o?s?wn(s):o:s,n?n.L===e?n.L=i:n.R=i:this._=i,o&&s?(r=i.C,i.C=e.C,i.L=o,o.U=i,i!==s?(n=i.U,i.U=e.U,e=i.R,n.L=e,i.R=s,s.U=i):(i.U=n,n=i,e=i.R)):(r=e.C,e=i),e&&(e.U=n),!r)if(e&&e.C)e.C=!1;else{do{if(e===this._)break;if(e===n.L){if((t=n.R).C&&(t.C=!1,n.C=!0,vn(this,n),t=n.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,Cn(this,t),t=n.R),t.C=n.C,n.C=t.R.C=!1,vn(this,n),e=this._;break}}else if((t=n.L).C&&(t.C=!1,n.C=!0,Cn(this,n),t=n.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,vn(this,t),t=n.L),t.C=n.C,n.C=t.L.C=!1,Cn(this,n),e=this._;break}t.C=!0,e=n,n=n.U}while(!e.C);e&&(e.C=!1)}}};var Cl,wl,xl,bl,El,Bl=[],Ml=[],Il=1e-6,Sl=1e-12,Pl=(Hn.prototype={constructor:Hn,polygons:function(){var i=this.edges;return this.cells.map(function(t){var e=t.halfedges.map(function(e){return Sn(t,i[e])});return e.data=t.site.data,e})},triangles:function(){var u=[],c=this.edges;return this.cells.forEach(function(e,t){if(r=(i=e.halfedges).length)for(var i,r,n,o=e.site,s=-1,a=c[i[r-1]],l=a.left===o?a.right:a.left;++s<r;)n=l,l=(a=c[i[s]]).left===o?a.right:a.left,n&&l&&t<n.index&&t<l.index&&Un(o,n,l)<0&&u.push([o.data,n.data,l.data])}),u},links:function(){return this.edges.filter(function(e){return e.right}).map(function(e){return{source:e.left.data,target:e.right.data}})},find:function(s,a,e){for(var t,l,u=this,c=u._found||0,i=u.cells.length;!(l=u.cells[c]);)if(++c>=i)return null;var r=s-l.site[0],n=a-l.site[1],h=r*r+n*n;do{l=u.cells[t=c],c=null,l.halfedges.forEach(function(e){var t=u.edges[e],i=t.left;if(i!==l.site&&i||(i=t.right)){var r=s-i[0],n=a-i[1],o=r*r+n*n;o<h&&(h=o,c=i.index)}})}while(null!==c);return u._found=t,null==e||h<=e*e?l.site:null}},function(){function t(r){return new Hn(r.map(function(e,t){var i=[Math.round(n(e,t,r)/Il)*Il,Math.round(o(e,t,r)/Il)*Il];return i.index=t,i.data=e,i}),i)}var n=gn,o=mn,i=null;return t.polygons=function(e){return t(e).polygons()},t.links=function(e){return t(e).links()},t.triangles=function(e){return t(e).triangles()},t.x=function(e){return arguments.length?(n="function"==typeof e?e:vl(+e),t):n},t.y=function(e){return arguments.length?(o="function"==typeof e?e:vl(+e),t):o},t.extent=function(e){return arguments.length?(i=null==e?null:[[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]],t):i&&[[i[0][0],i[0][1]],[i[1][0],i[1][1]]]},t.size=function(e){return arguments.length?(i=null==e?null:[[0,0],[+e[0],+e[1]]],t):i&&[i[1][0]-i[0][0],i[1][1]-i[0][1]]},t}),Tl=Object.freeze({randomPosition:Kn,randomPoint:jn,randomPolygon:Zn,randomLineString:Yn}),Ll=Object.freeze({getCluster:Jn,clusterEach:$n,clusterReduce:eo,createBins:to,applyFilter:io,propertiesContainsFilter:ro,filterProperties:no}),Dl=("fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(e){if(void 0===this||null===this)throw new TypeError(this+" is not an object");var t=Object(this),i=Math.max(Math.min(t.length,9007199254740991),0)||0,r=1 in arguments?parseInt(Number(arguments[1]),10)||0:0;r=r<0?Math.max(i+r,0):Math.min(r,i);var n=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:i;for(n=n<0?Math.max(i+arguments[2],0):Math.min(n,i);r<n;)t[r]=e,++r;return t},writable:!0}),Number.isFinite=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(e){return e!=e},Math.trunc=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)},function(){}),Fl=(Dl.prototype.interfaces_=function(){return[]},Dl.prototype.getClass=function(){return Dl},Dl.prototype.equalsWithTolerance=function(e,t,i){return Math.abs(e-t)<=i},function(){}),_=function(){},Nl={MAX_VALUE:{configurable:!0}},Ol=(_.isNaN=function(e){return Number.isNaN(e)},_.doubleToLongBits=function(e){return e},_.longBitsToDouble=function(e){return e},_.isInfinite=function(e){return!Number.isFinite(e)},Nl.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(_,Nl),function(){}),Rl=function(){},Ul=function(){},C=function e(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=e.NULL_ORDINATE;else if(1===arguments.length){var t=arguments[0];this.x=t.x,this.y=t.y,this.z=t.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=e.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},kl={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}},Hl=(C.prototype.setOrdinate=function(e,t){switch(e){case C.X:this.x=t;break;case C.Y:this.y=t;break;case C.Z:this.z=t;break;default:throw new Fl("Invalid ordinate index: "+e)}},C.prototype.equals2D=function(){if(1===arguments.length){var e=arguments[0];return this.x===e.x&&this.y===e.y}if(2===arguments.length){var t=arguments[0],i=arguments[1];return!!Dl.equalsWithTolerance(this.x,t.x,i)&&!!Dl.equalsWithTolerance(this.y,t.y,i)}},C.prototype.getOrdinate=function(e){switch(e){case C.X:return this.x;case C.Y:return this.y;case C.Z:return this.z}throw new Fl("Invalid ordinate index: "+e)},C.prototype.equals3D=function(e){return this.x===e.x&&this.y===e.y&&(this.z===e.z||_.isNaN(this.z))&&_.isNaN(e.z)},C.prototype.equals=function(e){return e instanceof C&&this.equals2D(e)},C.prototype.equalInZ=function(e,t){return Dl.equalsWithTolerance(this.z,e.z,t)},C.prototype.compareTo=function(e){var t=e;return this.x<t.x?-1:this.x>t.x?1:this.y<t.y?-1:this.y>t.y?1:0},C.prototype.clone=function(){},C.prototype.copy=function(){return new C(this)},C.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},C.prototype.distance3D=function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return Math.sqrt(t*t+i*i+r*r)},C.prototype.distance=function(e){var t=this.x-e.x,i=this.y-e.y;return Math.sqrt(t*t+i*i)},C.prototype.hashCode=function(){var e=17;return e=37*e+C.hashCode(this.x),e=37*e+C.hashCode(this.y)},C.prototype.setCoordinate=function(e){this.x=e.x,this.y=e.y,this.z=e.z},C.prototype.interfaces_=function(){return[Ol,Rl,oo]},C.prototype.getClass=function(){return C},C.hashCode=function(){if(1===arguments.length){var e=arguments[0],t=_.doubleToLongBits(e);return Math.trunc((t^t)>>>32)}},kl.DimensionalComparator.get=function(){return Hl},kl.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},kl.NULL_ORDINATE.get=function(){return _.NaN},kl.X.get=function(){return 0},kl.Y.get=function(){return 1},kl.Z.get=function(){return 2},Object.defineProperties(C,kl),function(e){if(this._dimensionsToTest=2,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(2!==t&&3!==t)throw new Fl("only 2 or 3 dimensions may be specified");this._dimensionsToTest=t}}),Ql=(Hl.prototype.compare=function(e,t){var i=e,r=t,n=Hl.compare(i.x,r.x);if(0!==n)return n;var o=Hl.compare(i.y,r.y);if(0!==o)return o;if(this._dimensionsToTest<=2)return 0;return Hl.compare(i.z,r.z)},Hl.prototype.interfaces_=function(){return[Ul]},Hl.prototype.getClass=function(){return Hl},Hl.compare=function(e,t){return e<t?-1:e>t?1:_.isNaN(e)?_.isNaN(t)?0:-1:_.isNaN(t)?1:0},function(){}),v=(Ql.prototype.create=function(){},Ql.prototype.interfaces_=function(){return[]},Ql.prototype.getClass=function(){return Ql},function(){}),Vl={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}},w=(v.prototype.interfaces_=function(){return[]},v.prototype.getClass=function(){return v},v.toLocationSymbol=function(e){switch(e){case v.EXTERIOR:return"e";case v.BOUNDARY:return"b";case v.INTERIOR:return"i";case v.NONE:return"-"}throw new Fl("Unknown location value: "+e)},Vl.INTERIOR.get=function(){return 0},Vl.BOUNDARY.get=function(){return 1},Vl.EXTERIOR.get=function(){return 2},Vl.NONE.get=function(){return-1},Object.defineProperties(v,Vl),function(e,t){return e.interfaces_&&e.interfaces_().indexOf(t)>-1}),Gl=function(){},zl={LOG_10:{configurable:!0}},Wl=(Gl.prototype.interfaces_=function(){return[]},Gl.prototype.getClass=function(){return Gl},Gl.log10=function(e){var t=Math.log(e);return _.isInfinite(t)?t:_.isNaN(t)?t:t/Gl.LOG_10},Gl.min=function(e,t,i,r){var n=e;return t<n&&(n=t),i<n&&(n=i),r<n&&(n=r),n},Gl.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var e=arguments[0],t=arguments[1],i=arguments[2];return e<t?t:e>i?i:e}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var r=arguments[0],n=arguments[1],o=arguments[2];return r<n?n:r>o?o:r}},Gl.wrap=function(e,t){return e<0?t- -e%t:e%t},Gl.max=function(){if(3===arguments.length){var e=arguments[0],t=arguments[1],i=arguments[2],r=e;return t>r&&(r=t),i>r&&(r=i),r}if(4===arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3],l=n;return o>l&&(l=o),s>l&&(l=s),a>l&&(l=a),l}},Gl.average=function(e,t){return(e+t)/2},zl.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(Gl,zl),function(e){this.str=e}),ql=(Wl.prototype.append=function(e){this.str+=e},Wl.prototype.setCharAt=function(e,t){this.str=this.str.substr(0,e)+t+this.str.substr(e+1)},Wl.prototype.toString=function(e){return this.str},function(e){this.value=e}),Kl=(ql.prototype.intValue=function(){return this.value},ql.prototype.compareTo=function(e){return this.value<e?-1:this.value>e?1:0},ql.isNaN=function(e){return Number.isNaN(e)},function(){}),b=(Kl.isWhitespace=function(e){return e<=32&&e>=0||127===e},Kl.toUpperCase=function(e){return e.toUpperCase()},function e(){if(this._hi=0,this._lo=0,0===arguments.length)this.init(0);else if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof e){var i=arguments[0];this.init(i)}else if("string"==typeof arguments[0]){var r=arguments[0];e.call(this,e.parse(r))}}else if(2===arguments.length){var n=arguments[0],o=arguments[1];this.init(n,o)}}),jl={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}},Zl=(b.prototype.le=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<=e._lo},b.prototype.extractSignificantDigits=function(e,t){var i=this.abs(),r=b.magnitude(i._hi),n=b.TEN.pow(r);(i=i.divide(n)).gt(b.TEN)?(i=i.divide(b.TEN),r+=1):i.lt(b.ONE)&&(i=i.multiply(b.TEN),r-=1);for(var o=r+1,s=new Wl,a=b.MAX_PRINT_DIGITS-1,l=0;l<=a;l++){e&&l===o&&s.append(".");var u=Math.trunc(i._hi);if(u<0)break;var c=!1,h=0;u>9?(c=!0,h="9"):h="0"+u,s.append(h),i=i.subtract(b.valueOf(u)).multiply(b.TEN),c&&i.selfAdd(b.TEN);var A=!0,p=b.magnitude(i._hi);if(p<0&&Math.abs(p)>=a-l&&(A=!1),!A)break}return t[0]=r,s.toString()},b.prototype.sqr=function(){return this.multiply(this)},b.prototype.doubleValue=function(){return this._hi+this._lo},b.prototype.subtract=function(){if(arguments[0]instanceof b){var e=arguments[0];return this.add(e.negate())}if("number"==typeof arguments[0]){var t=arguments[0];return this.add(-t)}},b.prototype.equals=function(){if(1===arguments.length){var e=arguments[0];return this._hi===e._hi&&this._lo===e._lo}},b.prototype.isZero=function(){return 0===this._hi&&0===this._lo},b.prototype.selfSubtract=function(){if(arguments[0]instanceof b){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e._hi,-e._lo)}if("number"==typeof arguments[0]){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t,0)}},b.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},b.prototype.min=function(e){return this.le(e)?this:e},b.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof b){var e=arguments[0];return this.selfDivide(e._hi,e._lo)}if("number"==typeof arguments[0]){var t=arguments[0];return this.selfDivide(t,0)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1],n=null,o=null,s=null,a=null,l=null,u=null,c=null,h=null;return l=this._hi/i,u=b.SPLIT*l,n=u-l,h=b.SPLIT*i,n=u-n,o=l-n,s=h-i,c=l*i,s=h-s,a=i-s,h=n*s-c+n*a+o*s+o*a,u=(this._hi-c-h+this._lo-l*r)/i,h=l+u,this._hi=h,this._lo=l-h+u,this}},b.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},b.prototype.divide=function(){if(arguments[0]instanceof b){var e=arguments[0],t=null,i=null,r=null,n=null,o=null,s=null,a=null,l=null;i=(o=this._hi/e._hi)-(t=(s=b.SPLIT*o)-(t=s-o)),l=t*(r=(l=b.SPLIT*e._hi)-(r=l-e._hi))-(a=o*e._hi)+t*(n=e._hi-r)+i*r+i*n,s=(this._hi-a-l+this._lo-o*e._lo)/e._hi;return new b(l=o+s,o-l+s)}if("number"==typeof arguments[0]){var u=arguments[0];return _.isNaN(u)?b.createNaN():b.copy(this).selfDivide(u,0)}},b.prototype.ge=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>=e._lo},b.prototype.pow=function(e){if(0===e)return b.valueOf(1);var t=new b(this),i=b.valueOf(1),r=Math.abs(e);if(r>1)for(;r>0;)r%2==1&&i.selfMultiply(t),(r/=2)>0&&(t=t.sqr());else i=t;return e<0?i.reciprocal():i},b.prototype.ceil=function(){if(this.isNaN())return b.NaN;var e=Math.ceil(this._hi),t=0;return e===this._hi&&(t=Math.ceil(this._lo)),new b(e,t)},b.prototype.compareTo=function(e){var t=e;return this._hi<t._hi?-1:this._hi>t._hi?1:this._lo<t._lo?-1:this._lo>t._lo?1:0},b.prototype.rint=function(){if(this.isNaN())return this;return this.add(.5).floor()},b.prototype.setValue=function(){if(arguments[0]instanceof b){var e=arguments[0];return this.init(e),this}if("number"==typeof arguments[0]){var t=arguments[0];return this.init(t),this}},b.prototype.max=function(e){return this.ge(e)?this:e},b.prototype.sqrt=function(){if(this.isZero())return b.valueOf(0);if(this.isNegative())return b.NaN;var e=1/Math.sqrt(this._hi),t=this._hi*e,i=b.valueOf(t),r=this.subtract(i.sqr())._hi*(.5*e);return i.add(r)},b.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof b){var e=arguments[0];return this.selfAdd(e._hi,e._lo)}if("number"==typeof arguments[0]){var t=arguments[0],i=null,r=null,n=null,o=null,s=null,a=null;return n=this._hi+t,s=n-this._hi,o=n-s,o=t-s+(this._hi-o),a=o+this._lo,i=n+a,r=a+(n-i),this._hi=i+r,this._lo=r+(i-this._hi),this}}else if(2===arguments.length){var l=arguments[0],u=arguments[1],c=null,h=null,A=null,p=null,f=null,d=null,g=null;p=this._hi+l,h=this._lo+u,f=p-(d=p-this._hi),A=h-(g=h-this._lo);var m=(c=p+(d=(f=l-d+(this._hi-f))+h))+(d=(A=u-g+(this._lo-A))+(d+(p-c))),y=d+(c-m);return this._hi=m,this._lo=y,this}},b.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof b){var e=arguments[0];return this.selfMultiply(e._hi,e._lo)}if("number"==typeof arguments[0]){var t=arguments[0];return this.selfMultiply(t,0)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1],n=null,o=null,s=null,a=null,l=null,u=null;n=(l=b.SPLIT*this._hi)-this._hi,u=b.SPLIT*i,n=l-n,o=this._hi-n,s=u-i;var c=(l=this._hi*i)+(u=n*(s=u-s)-l+n*(a=i-s)+o*s+o*a+(this._hi*r+this._lo*i)),h=u+(n=l-c);return this._hi=c,this._lo=h,this}},b.prototype.selfSqr=function(){return this.selfMultiply(this)},b.prototype.floor=function(){if(this.isNaN())return b.NaN;var e=Math.floor(this._hi),t=0;return e===this._hi&&(t=Math.floor(this._lo)),new b(e,t)},b.prototype.negate=function(){return this.isNaN()?this:new b(-this._hi,-this._lo)},b.prototype.clone=function(){},b.prototype.multiply=function(){if(arguments[0]instanceof b){var e=arguments[0];return e.isNaN()?b.createNaN():b.copy(this).selfMultiply(e)}if("number"==typeof arguments[0]){var t=arguments[0];return _.isNaN(t)?b.createNaN():b.copy(this).selfMultiply(t,0)}},b.prototype.isNaN=function(){return _.isNaN(this._hi)},b.prototype.intValue=function(){return Math.trunc(this._hi)},b.prototype.toString=function(){var e=b.magnitude(this._hi);return e>=-3&&e<=20?this.toStandardNotation():this.toSciNotation()},b.prototype.toStandardNotation=function(){var e=this.getSpecialNumberString();if(null!==e)return e;var t=new Array(1).fill(null),i=this.extractSignificantDigits(!0,t),r=t[0]+1,n=i;if("."===i.charAt(0))n="0"+i;else if(r<0)n="0."+b.stringOfChar("0",-r)+i;else if(-1===i.indexOf(".")){var o=r-i.length;n=i+b.stringOfChar("0",o)+".0"}return this.isNegative()?"-"+n:n},b.prototype.reciprocal=function(){var e=null,t=null,i=null,r=null,n=null,o=null,s=null,a=null;t=(n=1/this._hi)-(e=(o=b.SPLIT*n)-(e=o-n)),i=(a=b.SPLIT*this._hi)-this._hi;var l=n+(o=(1-(s=n*this._hi)-(a=e*(i=a-i)-s+e*(r=this._hi-i)+t*i+t*r)-n*this._lo)/this._hi);return new b(l,n-l+o)},b.prototype.toSciNotation=function(){if(this.isZero())return b.SCI_NOT_ZERO;var e=this.getSpecialNumberString();if(null!==e)return e;var t=new Array(1).fill(null),i=this.extractSignificantDigits(!1,t),r=b.SCI_NOT_EXPONENT_CHAR+t[0];if("0"===i.charAt(0))throw new Error("Found leading zero: "+i);var n="";i.length>1&&(n=i.substring(1));var o=i.charAt(0)+"."+n;return this.isNegative()?"-"+o+r:o+r},b.prototype.abs=function(){return this.isNaN()?b.NaN:this.isNegative()?this.negate():new b(this)},b.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},b.prototype.lt=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<e._lo},b.prototype.add=function(){if(arguments[0]instanceof b){var e=arguments[0];return b.copy(this).selfAdd(e)}if("number"==typeof arguments[0]){var t=arguments[0];return b.copy(this).selfAdd(t)}},b.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0]){var e=arguments[0];this._hi=e,this._lo=0}else if(arguments[0]instanceof b){var t=arguments[0];this._hi=t._hi,this._lo=t._lo}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this._hi=i,this._lo=r}},b.prototype.gt=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>e._lo},b.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},b.prototype.trunc=function(){return this.isNaN()?b.NaN:this.isPositive()?this.floor():this.ceil()},b.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},b.prototype.interfaces_=function(){return[oo,Ol,Rl]},b.prototype.getClass=function(){return b},b.sqr=function(e){return b.valueOf(e).selfMultiply(e)},b.valueOf=function(){if("string"==typeof arguments[0]){var e=arguments[0];return b.parse(e)}if("number"==typeof arguments[0]){var t=arguments[0];return new b(t)}},b.sqrt=function(e){return b.valueOf(e).sqrt()},b.parse=function(e){for(var t=0,i=e.length;Kl.isWhitespace(e.charAt(t));)t++;var r=!1;if(t<i){var n=e.charAt(t);"-"!==n&&"+"!==n||(t++,"-"===n&&(r=!0))}for(var o=new b,s=0,a=0,l=0;!(t>=i);){var u=e.charAt(t);if(t++,Kl.isDigit(u)){var c=u-"0";o.selfMultiply(b.TEN),o.selfAdd(c),s++}else{if("."!==u){if("e"===u||"E"===u){var h=e.substring(t);try{l=ql.parseInt(h)}catch(t){throw t instanceof Error?new Error("Invalid exponent "+h+" in string "+e):t}break}throw new Error("Unexpected character '"+u+"' at position "+t+" in string "+e)}a=s}}var A=o,p=s-a-l;if(0===p)A=o;else if(p>0){var f=b.TEN.pow(p);A=o.divide(f)}else if(p<0){var d=b.TEN.pow(-p);A=o.multiply(d)}return r?A.negate():A},b.createNaN=function(){return new b(_.NaN,_.NaN)},b.copy=function(e){return new b(e)},b.magnitude=function(e){var t=Math.abs(e),i=Math.log(t)/Math.log(10),r=Math.trunc(Math.floor(i));return 10*Math.pow(10,r)<=t&&(r+=1),r},b.stringOfChar=function(e,t){for(var i=new Wl,r=0;r<t;r++)i.append(e);return i.toString()},jl.PI.get=function(){return new b(3.141592653589793,12246467991473532e-32)},jl.TWO_PI.get=function(){return new b(6.283185307179586,24492935982947064e-32)},jl.PI_2.get=function(){return new b(1.5707963267948966,6123233995736766e-32)},jl.E.get=function(){return new b(2.718281828459045,14456468917292502e-32)},jl.NaN.get=function(){return new b(_.NaN,_.NaN)},jl.EPS.get=function(){return 123259516440783e-46},jl.SPLIT.get=function(){return 134217729},jl.MAX_PRINT_DIGITS.get=function(){return 32},jl.TEN.get=function(){return b.valueOf(10)},jl.ONE.get=function(){return b.valueOf(1)},jl.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},jl.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(b,jl),function(){}),Yl={DP_SAFE_EPSILON:{configurable:!0}},E=(Zl.prototype.interfaces_=function(){return[]},Zl.prototype.getClass=function(){return Zl},Zl.orientationIndex=function(e,t,i){var r=Zl.orientationIndexFilter(e,t,i);if(r<=1)return r;var n=b.valueOf(t.x).selfAdd(-e.x),o=b.valueOf(t.y).selfAdd(-e.y),s=b.valueOf(i.x).selfAdd(-t.x),a=b.valueOf(i.y).selfAdd(-t.y);return n.selfMultiply(a).selfSubtract(o.selfMultiply(s)).signum()},Zl.signOfDet2x2=function(e,t,i,r){return e.multiply(r).selfSubtract(t.multiply(i)).signum()},Zl.intersection=function(e,t,i,r){var n=b.valueOf(r.y).selfSubtract(i.y).selfMultiply(b.valueOf(t.x).selfSubtract(e.x)),o=b.valueOf(r.x).selfSubtract(i.x).selfMultiply(b.valueOf(t.y).selfSubtract(e.y)),s=n.subtract(o),a=b.valueOf(r.x).selfSubtract(i.x).selfMultiply(b.valueOf(e.y).selfSubtract(i.y)),l=b.valueOf(r.y).selfSubtract(i.y).selfMultiply(b.valueOf(e.x).selfSubtract(i.x)),u=a.subtract(l).selfDivide(s).doubleValue(),c=b.valueOf(e.x).selfAdd(b.valueOf(t.x).selfSubtract(e.x).selfMultiply(u)).doubleValue(),h=b.valueOf(t.x).selfSubtract(e.x).selfMultiply(b.valueOf(e.y).selfSubtract(i.y)),A=b.valueOf(t.y).selfSubtract(e.y).selfMultiply(b.valueOf(e.x).selfSubtract(i.x)),p=h.subtract(A).selfDivide(s).doubleValue(),f=b.valueOf(i.y).selfAdd(b.valueOf(r.y).selfSubtract(i.y).selfMultiply(p)).doubleValue();return new C(c,f)},Zl.orientationIndexFilter=function(e,t,i){var r=null,n=(e.x-i.x)*(t.y-i.y),o=(e.y-i.y)*(t.x-i.x),s=n-o;if(n>0){if(o<=0)return Zl.signum(s);r=n+o}else{if(!(n<0))return Zl.signum(s);if(o>=0)return Zl.signum(s);r=-n-o}var a=Zl.DP_SAFE_EPSILON*r;return s>=a||-s>=a?Zl.signum(s):2},Zl.signum=function(e){return e>0?1:e<0?-1:0},Yl.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(Zl,Yl),function(){}),Xl={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}},Jl=(Xl.X.get=function(){return 0},Xl.Y.get=function(){return 1},Xl.Z.get=function(){return 2},Xl.M.get=function(){return 3},E.prototype.setOrdinate=function(e,t,i){},E.prototype.size=function(){},E.prototype.getOrdinate=function(e,t){},E.prototype.getCoordinate=function(){},E.prototype.getCoordinateCopy=function(e){},E.prototype.getDimension=function(){},E.prototype.getX=function(e){},E.prototype.clone=function(){},E.prototype.expandEnvelope=function(e){},E.prototype.copy=function(){},E.prototype.getY=function(e){},E.prototype.toCoordinateArray=function(){},E.prototype.interfaces_=function(){return[Rl]},E.prototype.getClass=function(){return E},Object.defineProperties(E,Xl),function(){}),$l=function(e){function t(){e.call(this,"Projective point not representable on the Cartesian plane.")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Jl),eu=function(){},tu=(eu.arraycopy=function(e,t,i,r,n){for(var o=0,s=t;s<t+n;s++)i[r+o]=e[s],o++},eu.getProperty=function(e){return{"line.separator":"\n"}[e]},function e(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var i=arguments[0],r=arguments[1];this.x=i,this.y=r,this.w=1}else if(arguments[0]instanceof e&&arguments[1]instanceof e){var n=arguments[0],o=arguments[1];this.x=n.y*o.w-o.y*n.w,this.y=o.x*n.w-n.x*o.w,this.w=n.x*o.y-o.x*n.y}else if(arguments[0]instanceof C&&arguments[1]instanceof C){var s=arguments[0],a=arguments[1];this.x=s.y-a.y,this.y=a.x-s.x,this.w=s.x*a.y-a.x*s.y}}else if(3===arguments.length){var l=arguments[0],u=arguments[1],c=arguments[2];this.x=l,this.y=u,this.w=c}else if(4===arguments.length){var h=arguments[0],A=arguments[1],p=arguments[2],f=arguments[3],d=h.y-A.y,g=A.x-h.x,m=h.x*A.y-A.x*h.y,y=p.y-f.y,_=f.x-p.x,v=p.x*f.y-f.x*p.y;this.x=g*v-_*m,this.y=y*m-d*v,this.w=d*_-y*g}}),u=(tu.prototype.getY=function(){var e=this.y/this.w;if(_.isNaN(e)||_.isInfinite(e))throw new $l;return e},tu.prototype.getX=function(){var e=this.x/this.w;if(_.isNaN(e)||_.isInfinite(e))throw new $l;return e},tu.prototype.getCoordinate=function(){var e=new C;return e.x=this.getX(),e.y=this.getY(),e},tu.prototype.interfaces_=function(){return[]},tu.prototype.getClass=function(){return tu},tu.intersection=function(e,t,i,r){var n=e.y-t.y,o=t.x-e.x,s=e.x*t.y-t.x*e.y,a=i.y-r.y,l=r.x-i.x,u=i.x*r.y-r.x*i.y,c=n*l-a*o,h=(o*u-l*s)/c,A=(a*s-n*u)/c;if(_.isNaN(h)||_.isInfinite(h)||_.isNaN(A)||_.isInfinite(A))throw new $l;return new C(h,A)},function e(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof C){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var i=arguments[0];this.init(i)}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this.init(r.x,n.x,r.y,n.y)}else if(4===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],l=arguments[3];this.init(o,s,a,l)}}),iu={serialVersionUID:{configurable:!0}},ru=(u.prototype.getArea=function(){return this.getWidth()*this.getHeight()},u.prototype.equals=function(e){if(!(e instanceof u))return!1;var t=e;return this.isNull()?t.isNull():this._maxx===t.getMaxX()&&this._maxy===t.getMaxY()&&this._minx===t.getMinX()&&this._miny===t.getMinY()},u.prototype.intersection=function(e){if(this.isNull()||e.isNull()||!this.intersects(e))return new u;var t=this._minx>e._minx?this._minx:e._minx,i=this._miny>e._miny?this._miny:e._miny,r=this._maxx<e._maxx?this._maxx:e._maxx,n=this._maxy<e._maxy?this._maxy:e._maxy;return new u(t,r,i,n)},u.prototype.isNull=function(){return this._maxx<this._minx},u.prototype.getMaxX=function(){return this._maxx},u.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof C){var e=arguments[0];return this.covers(e.x,e.y)}if(arguments[0]instanceof u){var t=arguments[0];return!this.isNull()&&!t.isNull()&&(t.getMinX()>=this._minx&&t.getMaxX()<=this._maxx&&t.getMinY()>=this._miny&&t.getMaxY()<=this._maxy)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return!this.isNull()&&(i>=this._minx&&i<=this._maxx&&r>=this._miny&&r<=this._maxy)}},u.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof u){var e=arguments[0];return!this.isNull()&&!e.isNull()&&!(e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny)}if(arguments[0]instanceof C){var t=arguments[0];return this.intersects(t.x,t.y)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return!this.isNull()&&!(i>this._maxx||i<this._minx||r>this._maxy||r<this._miny)}},u.prototype.getMinY=function(){return this._miny},u.prototype.getMinX=function(){return this._minx},u.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof C){var e=arguments[0];this.expandToInclude(e.x,e.y)}else if(arguments[0]instanceof u){var t=arguments[0];if(t.isNull())return null;this.isNull()?(this._minx=t.getMinX(),this._maxx=t.getMaxX(),this._miny=t.getMinY(),this._maxy=t.getMaxY()):(t._minx<this._minx&&(this._minx=t._minx),t._maxx>this._maxx&&(this._maxx=t._maxx),t._miny<this._miny&&(this._miny=t._miny),t._maxy>this._maxy&&(this._maxy=t._maxy))}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.isNull()?(this._minx=i,this._maxx=i,this._miny=r,this._maxy=r):(i<this._minx&&(this._minx=i),i>this._maxx&&(this._maxx=i),r<this._miny&&(this._miny=r),r>this._maxy&&(this._maxy=r))}},u.prototype.minExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e<t?e:t},u.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},u.prototype.compareTo=function(e){var t=e;return this.isNull()?t.isNull()?0:-1:t.isNull()?1:this._minx<t._minx?-1:this._minx>t._minx?1:this._miny<t._miny?-1:this._miny>t._miny?1:this._maxx<t._maxx?-1:this._maxx>t._maxx?1:this._maxy<t._maxy?-1:this._maxy>t._maxy?1:0},u.prototype.translate=function(e,t){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+t,this.getMaxY()+t)},u.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},u.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},u.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},u.prototype.maxExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e>t?e:t},u.prototype.expandBy=function(){if(1===arguments.length){var e=arguments[0];this.expandBy(e,e)}else if(2===arguments.length){var t=arguments[0],i=arguments[1];if(this.isNull())return null;this._minx-=t,this._maxx+=t,this._miny-=i,this._maxy+=i,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},u.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof u){var e=arguments[0];return this.covers(e)}if(arguments[0]instanceof C){var t=arguments[0];return this.covers(t)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return this.covers(i,r)}},u.prototype.centre=function(){return this.isNull()?null:new C((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},u.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof C){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof u){var t=arguments[0];this._minx=t._minx,this._maxx=t._maxx,this._miny=t._miny,this._maxy=t._maxy}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.init(i.x,r.x,i.y,r.y)}else if(4===arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];n<o?(this._minx=n,this._maxx=o):(this._minx=o,this._maxx=n),s<a?(this._miny=s,this._maxy=a):(this._miny=a,this._maxy=s)}},u.prototype.getMaxY=function(){return this._maxy},u.prototype.distance=function(e){if(this.intersects(e))return 0;var t=0;this._maxx<e._minx?t=e._minx-this._maxx:this._minx>e._maxx&&(t=this._minx-e._maxx);var i=0;return this._maxy<e._miny?i=e._miny-this._maxy:this._miny>e._maxy&&(i=this._miny-e._maxy),0===t?i:0===i?t:Math.sqrt(t*t+i*i)},u.prototype.hashCode=function(){var e=17;return e=37*e+C.hashCode(this._minx),e=37*e+C.hashCode(this._maxx),e=37*e+C.hashCode(this._miny),e=37*e+C.hashCode(this._maxy)},u.prototype.interfaces_=function(){return[Ol,oo]},u.prototype.getClass=function(){return u},u.intersects=function(){if(3===arguments.length){var e=arguments[0],t=arguments[1],i=arguments[2];return i.x>=(e.x<t.x?e.x:t.x)&&i.x<=(e.x>t.x?e.x:t.x)&&i.y>=(e.y<t.y?e.y:t.y)&&i.y<=(e.y>t.y?e.y:t.y)}if(4===arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2],s=arguments[3],a=Math.min(o.x,s.x),l=Math.max(o.x,s.x),u=Math.min(r.x,n.x),c=Math.max(r.x,n.x);return!(u>l)&&(!(c<a)&&(a=Math.min(o.y,s.y),l=Math.max(o.y,s.y),u=Math.min(r.y,n.y),c=Math.max(r.y,n.y),!(u>l)&&!(c<a)))}},iu.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(u,iu),{typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/}),nu=function(e){this.geometryFactory=e||new l},ou=(nu.prototype.read=function(e){var t,i,r;e=e.replace(/[\n\r]/g," ");var n=ru.typeStr.exec(e);if(-1!==e.search("EMPTY")&&((n=ru.emptyTypeStr.exec(e))[2]=void 0),n&&(i=n[1].toLowerCase(),r=n[2],su[i]&&(t=su[i].apply(this,[r]))),void 0===t)throw new Error("Could not parse WKT "+e);return t},nu.prototype.write=function(e){return this.extractGeometry(e)},nu.prototype.extractGeometry=function(e){var t=e.getGeometryType().toLowerCase();if(!ou[t])return null;var i=t.toUpperCase();return e.isEmpty()?i+" EMPTY":i+"("+ou[t].apply(this,[e])+")"},{coordinate:function(e){return e.x+" "+e.y},point:function(e){return ou.coordinate.call(this,e._coordinates._coordinates[0])},multipoint:function(e){for(var t=[],i=0,r=e._geometries.length;i<r;++i)t.push("("+ou.point.apply(this,[e._geometries[i]])+")");return t.join(",")},linestring:function(e){for(var t=[],i=0,r=e._points._coordinates.length;i<r;++i)t.push(ou.coordinate.apply(this,[e._points._coordinates[i]]));return t.join(",")},linearring:function(e){for(var t=[],i=0,r=e._points._coordinates.length;i<r;++i)t.push(ou.coordinate.apply(this,[e._points._coordinates[i]]));return t.join(",")},multilinestring:function(e){for(var t=[],i=0,r=e._geometries.length;i<r;++i)t.push("("+ou.linestring.apply(this,[e._geometries[i]])+")");return t.join(",")},polygon:function(e){var t=[];t.push("("+ou.linestring.apply(this,[e._shell])+")");for(var i=0,r=e._holes.length;i<r;++i)t.push("("+ou.linestring.apply(this,[e._holes[i]])+")");return t.join(",")},multipolygon:function(e){for(var t=[],i=0,r=e._geometries.length;i<r;++i)t.push("("+ou.polygon.apply(this,[e._geometries[i]])+")");return t.join(",")},geometrycollection:function(e){for(var t=[],i=0,r=e._geometries.length;i<r;++i)t.push(this.extractGeometry(e._geometries[i]));return t.join(",")}}),su={point:function(e){if(void 0===e)return this.geometryFactory.createPoint();var t=e.trim().split(ru.spaces);return this.geometryFactory.createPoint(new C(Number.parseFloat(t[0]),Number.parseFloat(t[1])))},multipoint:function(e){if(void 0===e)return this.geometryFactory.createMultiPoint();for(var t,i=e.trim().split(","),r=[],n=0,o=i.length;n<o;++n)t=i[n].replace(ru.trimParens,"$1"),r.push(su.point.apply(this,[t]));return this.geometryFactory.createMultiPoint(r)},linestring:function(e){if(void 0===e)return this.geometryFactory.createLineString();for(var t,i=e.trim().split(","),r=[],n=0,o=i.length;n<o;++n)t=i[n].trim().split(ru.spaces),r.push(new C(Number.parseFloat(t[0]),Number.parseFloat(t[1])));return this.geometryFactory.createLineString(r)},linearring:function(e){if(void 0===e)return this.geometryFactory.createLinearRing();for(var t,i=e.trim().split(","),r=[],n=0,o=i.length;n<o;++n)t=i[n].trim().split(ru.spaces),r.push(new C(Number.parseFloat(t[0]),Number.parseFloat(t[1])));return this.geometryFactory.createLinearRing(r)},multilinestring:function(e){if(void 0===e)return this.geometryFactory.createMultiLineString();for(var t,i=e.trim().split(ru.parenComma),r=[],n=0,o=i.length;n<o;++n)t=i[n].replace(ru.trimParens,"$1"),r.push(su.linestring.apply(this,[t]));return this.geometryFactory.createMultiLineString(r)},polygon:function(e){if(void 0===e)return this.geometryFactory.createPolygon();for(var t,i,r,n,o=e.trim().split(ru.parenComma),s=[],a=0,l=o.length;a<l;++a)t=o[a].replace(ru.trimParens,"$1"),i=su.linestring.apply(this,[t]),r=this.geometryFactory.createLinearRing(i._points),0===a?n=r:s.push(r);return this.geometryFactory.createPolygon(n,s)},multipolygon:function(e){if(void 0===e)return this.geometryFactory.createMultiPolygon();for(var t,i=e.trim().split(ru.doubleParenComma),r=[],n=0,o=i.length;n<o;++n)t=i[n].replace(ru.trimParens,"$1"),r.push(su.polygon.apply(this,[t]));return this.geometryFactory.createMultiPolygon(r)},geometrycollection:function(e){if(void 0===e)return this.geometryFactory.createGeometryCollection();for(var t=(e=e.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),i=[],r=0,n=t.length;r<n;++r)i.push(this.read(t[r]));return this.geometryFactory.createGeometryCollection(i)}},au=function(e){this.parser=new nu(e)},lu=(au.prototype.write=function(e){return this.parser.write(e)},au.toLineString=function(e,t){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+t.x+" "+t.y+" )"},function(t){function e(e){t.call(this,e),this.name="RuntimeException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error)),uu=function(t){function e(){if(t.call(this),0===arguments.length)t.call(this);else if(1===arguments.length){var e=arguments[0];t.call(this,e)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(lu),D=function(){},cu=(D.prototype.interfaces_=function(){return[]},D.prototype.getClass=function(){return D},D.shouldNeverReachHere=function(){if(0===arguments.length)D.shouldNeverReachHere(null);else if(1===arguments.length){var e=arguments[0];throw new uu("Should never reach here"+(null!==e?": "+e:""))}},D.isTrue=function(){var e,t;if(1===arguments.length)e=arguments[0],D.isTrue(e,null);else if(2===arguments.length&&(e=arguments[0],t=arguments[1],!e))throw null===t?new uu:new uu(t)},D.equals=function(){var e,t,i;if(2===arguments.length)e=arguments[0],t=arguments[1],D.equals(e,t,null);else if(3===arguments.length&&(e=arguments[0],t=arguments[1],i=arguments[2],!t.equals(e)))throw new uu("Expected "+e+" but encountered "+t+(null!==i?": "+i:""))},function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new C,this._intPt[1]=new C,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}),hu={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}},Au=(cu.prototype.getIndexAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intLineIndex[e][t]},cu.prototype.getTopologySummary=function(){var e=new Wl;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()},cu.prototype.computeIntersection=function(e,t,i,r){this._inputLines[0][0]=e,this._inputLines[0][1]=t,this._inputLines[1][0]=i,this._inputLines[1][1]=r,this._result=this.computeIntersect(e,t,i,r)},cu.prototype.getIntersectionNum=function(){return this._result},cu.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var e=arguments[0];this.getEdgeDistance(e,0)>this.getEdgeDistance(e,1)?(this._intLineIndex[e][0]=0,this._intLineIndex[e][1]=1):(this._intLineIndex[e][0]=1,this._intLineIndex[e][1]=0)}},cu.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},cu.prototype.setPrecisionModel=function(e){this._precisionModel=e},cu.prototype.isInteriorIntersection=function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var e=arguments[0],t=0;t<this._result;t++)if(!this._intPt[t].equals2D(this._inputLines[e][0])&&!this._intPt[t].equals2D(this._inputLines[e][1]))return!0;return!1}},cu.prototype.getIntersection=function(e){return this._intPt[e]},cu.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},cu.prototype.hasIntersection=function(){return this._result!==cu.NO_INTERSECTION},cu.prototype.getEdgeDistance=function(e,t){return cu.computeEdgeDistance(this._intPt[t],this._inputLines[e][0],this._inputLines[e][1])},cu.prototype.isCollinear=function(){return this._result===cu.COLLINEAR_INTERSECTION},cu.prototype.toString=function(){return au.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+au.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},cu.prototype.getEndpoint=function(e,t){return this._inputLines[e][t]},cu.prototype.isIntersection=function(e){for(var t=0;t<this._result;t++)if(this._intPt[t].equals2D(e))return!0;return!1},cu.prototype.getIntersectionAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[e][t]]},cu.prototype.interfaces_=function(){return[]},cu.prototype.getClass=function(){return cu},cu.computeEdgeDistance=function(e,t,i){var r=Math.abs(i.x-t.x),n=Math.abs(i.y-t.y),o=-1;if(e.equals(t))o=0;else if(e.equals(i))o=r>n?r:n;else{var s=Math.abs(e.x-t.x),a=Math.abs(e.y-t.y);0!==(o=r>n?s:a)||e.equals(t)||(o=Math.max(s,a))}return D.isTrue(!(0===o&&!e.equals(t)),"Bad distance calculation"),o},cu.nonRobustComputeEdgeDistance=function(e,t,i){var r=e.x-t.x,n=e.y-t.y,o=Math.sqrt(r*r+n*n);return D.isTrue(!(0===o&&!e.equals(t)),"Invalid distance calculation"),o},hu.DONT_INTERSECT.get=function(){return 0},hu.DO_INTERSECT.get=function(){return 1},hu.COLLINEAR.get=function(){return 2},hu.NO_INTERSECTION.get=function(){return 0},hu.POINT_INTERSECTION.get=function(){return 1},hu.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(cu,hu),function(l){function s(){l.apply(this,arguments)}return l&&(s.__proto__=l),s.prototype=Object.create(l&&l.prototype),s.prototype.constructor=s,s.prototype.isInSegmentEnvelopes=function(e){var t=new u(this._inputLines[0][0],this._inputLines[0][1]),i=new u(this._inputLines[1][0],this._inputLines[1][1]);return t.contains(e)&&i.contains(e)},s.prototype.computeIntersection=function(){if(3!==arguments.length)return l.prototype.computeIntersection.apply(this,arguments);var e=arguments[0],t=arguments[1],i=arguments[2];if(this._isProper=!1,u.intersects(t,i,e)&&0===F.orientationIndex(t,i,e)&&0===F.orientationIndex(i,t,e))return this._isProper=!0,(e.equals(t)||e.equals(i))&&(this._isProper=!1),this._result=l.POINT_INTERSECTION,null;this._result=l.NO_INTERSECTION},s.prototype.normalizeToMinimum=function(e,t,i,r,n){n.x=this.smallestInAbsValue(e.x,t.x,i.x,r.x),n.y=this.smallestInAbsValue(e.y,t.y,i.y,r.y),e.x-=n.x,e.y-=n.y,t.x-=n.x,t.y-=n.y,i.x-=n.x,i.y-=n.y,r.x-=n.x,r.y-=n.y},s.prototype.safeHCoordinateIntersection=function(t,i,r,n){var o=null;try{o=tu.intersection(t,i,r,n)}catch(e){if(!(e instanceof $l))throw e;o=s.nearestEndpoint(t,i,r,n)}return o},s.prototype.intersection=function(e,t,i,r){var n=this.intersectionWithNormalization(e,t,i,r);return this.isInSegmentEnvelopes(n)||(n=new C(s.nearestEndpoint(e,t,i,r))),null!==this._precisionModel&&this._precisionModel.makePrecise(n),n},s.prototype.smallestInAbsValue=function(e,t,i,r){var n=e,o=Math.abs(n);return Math.abs(t)<o&&(n=t,o=Math.abs(t)),Math.abs(i)<o&&(n=i,o=Math.abs(i)),Math.abs(r)<o&&(n=r),n},s.prototype.checkDD=function(e,t,i,r,n){var o=Zl.intersection(e,t,i,r),s=this.isInSegmentEnvelopes(o);eu.out.println("DD in env = "+s+"  --------------------- "+o),n.distance(o)>1e-4&&eu.out.println("Distance = "+n.distance(o))},s.prototype.intersectionWithNormalization=function(e,t,i,r){var n=new C(e),o=new C(t),s=new C(i),a=new C(r),l=new C;this.normalizeToEnvCentre(n,o,s,a,l);var u=this.safeHCoordinateIntersection(n,o,s,a);return u.x+=l.x,u.y+=l.y,u},s.prototype.computeCollinearIntersection=function(e,t,i,r){var n=u.intersects(e,t,i),o=u.intersects(e,t,r),s=u.intersects(i,r,e),a=u.intersects(i,r,t);return n&&o?(this._intPt[0]=i,this._intPt[1]=r,l.COLLINEAR_INTERSECTION):s&&a?(this._intPt[0]=e,this._intPt[1]=t,l.COLLINEAR_INTERSECTION):n&&s?(this._intPt[0]=i,this._intPt[1]=e,!i.equals(e)||o||a?l.COLLINEAR_INTERSECTION:l.POINT_INTERSECTION):n&&a?(this._intPt[0]=i,this._intPt[1]=t,!i.equals(t)||o||s?l.COLLINEAR_INTERSECTION:l.POINT_INTERSECTION):o&&s?(this._intPt[0]=r,this._intPt[1]=e,!r.equals(e)||n||a?l.COLLINEAR_INTERSECTION:l.POINT_INTERSECTION):o&&a?(this._intPt[0]=r,this._intPt[1]=t,!r.equals(t)||n||s?l.COLLINEAR_INTERSECTION:l.POINT_INTERSECTION):l.NO_INTERSECTION},s.prototype.normalizeToEnvCentre=function(e,t,i,r,n){var o=e.x<t.x?e.x:t.x,s=e.y<t.y?e.y:t.y,a=e.x>t.x?e.x:t.x,l=e.y>t.y?e.y:t.y,u=i.x<r.x?i.x:r.x,c=i.y<r.y?i.y:r.y,h=i.x>r.x?i.x:r.x,A=i.y>r.y?i.y:r.y,p=((o>u?o:u)+(a<h?a:h))/2,f=((s>c?s:c)+(l<A?l:A))/2;n.x=p,n.y=f,e.x-=n.x,e.y-=n.y,t.x-=n.x,t.y-=n.y,i.x-=n.x,i.y-=n.y,r.x-=n.x,r.y-=n.y},s.prototype.computeIntersect=function(e,t,i,r){if(this._isProper=!1,!u.intersects(e,t,i,r))return l.NO_INTERSECTION;var n=F.orientationIndex(e,t,i),o=F.orientationIndex(e,t,r);if(n>0&&o>0||n<0&&o<0)return l.NO_INTERSECTION;var s=F.orientationIndex(i,r,e),a=F.orientationIndex(i,r,t);if(s>0&&a>0||s<0&&a<0)return l.NO_INTERSECTION;return 0===n&&0===o&&0===s&&0===a?this.computeCollinearIntersection(e,t,i,r):(0===n||0===o||0===s||0===a?(this._isProper=!1,e.equals2D(i)||e.equals2D(r)?this._intPt[0]=e:t.equals2D(i)||t.equals2D(r)?this._intPt[0]=t:0===n?this._intPt[0]=new C(i):0===o?this._intPt[0]=new C(r):0===s?this._intPt[0]=new C(e):0===a&&(this._intPt[0]=new C(t))):(this._isProper=!0,this._intPt[0]=this.intersection(e,t,i,r)),l.POINT_INTERSECTION)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s.nearestEndpoint=function(e,t,i,r){var n=e,o=F.distancePointLine(e,i,r),s=F.distancePointLine(t,i,r);return s<o&&(o=s,n=t),(s=F.distancePointLine(i,e,t))<o&&(o=s,n=i),(s=F.distancePointLine(r,e,t))<o&&(o=s,n=r),n},s}(cu)),pu=function(){},fu=(pu.prototype.interfaces_=function(){return[]},pu.prototype.getClass=function(){return pu},pu.orientationIndex=function(e,t,i){var r=t.x-e.x,n=t.y-e.y,o=i.x-t.x,s=i.y-t.y;return pu.signOfDet2x2(r,n,o,s)},pu.signOfDet2x2=function(e,t,i,r){var n=null,o=null,s=null;if(n=1,0===e||0===r)return 0===t||0===i?0:t>0?i>0?-n:n:i>0?n:-n;if(0===t||0===i)return r>0?e>0?n:-n:e>0?-n:n;if(t>0?r>0?t<=r||(n=-n,o=e,e=i,i=o,o=t,t=r,r=o):t<=-r?(n=-n,i=-i,r=-r):(o=e,e=-i,i=o,o=t,t=-r,r=o):r>0?-t<=r?(n=-n,e=-e,t=-t):(o=-e,e=i,i=o,o=-t,t=r,r=o):t>=r?(e=-e,t=-t,i=-i,r=-r):(n=-n,o=-e,e=-i,i=o,o=-t,t=-r,r=o),e>0){if(!(i>0))return n;if(!(e<=i))return n}else{if(i>0)return-n;if(!(e>=i))return-n;n=-n,e=-e,i=-i}for(;;){if(s=Math.floor(i/e),i-=s*e,(r-=s*t)<0)return-n;if(r>t)return n;if(e>i+i){if(t<r+r)return n}else{if(t>r+r)return-n;i=e-i,r=t-r,n=-n}if(0===r)return 0===i?0:-n;if(0===i)return n;if(s=Math.floor(e/i),e-=s*i,(t-=s*r)<0)return n;if(t>r)return-n;if(i>e+e){if(r<t+t)return-n}else{if(r>t+t)return n;e=i-e,t=r-t,n=-n}if(0===t)return 0===e?0:n;if(0===e)return-n}},function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var e=arguments[0];this._p=e}),F=(fu.prototype.countSegment=function(e,t){if(e.x<this._p.x&&t.x<this._p.x)return null;if(this._p.x===t.x&&this._p.y===t.y)return this._isPointOnSegment=!0,null;if(e.y===this._p.y&&t.y===this._p.y){var i=e.x,r=t.x;return i>r&&(i=t.x,r=e.x),this._p.x>=i&&this._p.x<=r&&(this._isPointOnSegment=!0),null}if(e.y>this._p.y&&t.y<=this._p.y||t.y>this._p.y&&e.y<=this._p.y){var n=e.x-this._p.x,o=e.y-this._p.y,s=t.x-this._p.x,a=t.y-this._p.y,l=pu.signOfDet2x2(n,o,s,a);if(0===l)return this._isPointOnSegment=!0,null;a<o&&(l=-l),l>0&&this._crossingCount++}},fu.prototype.isPointInPolygon=function(){return this.getLocation()!==v.EXTERIOR},fu.prototype.getLocation=function(){return this._isPointOnSegment?v.BOUNDARY:this._crossingCount%2==1?v.INTERIOR:v.EXTERIOR},fu.prototype.isOnSegment=function(){return this._isPointOnSegment},fu.prototype.interfaces_=function(){return[]},fu.prototype.getClass=function(){return fu},fu.locatePointInRing=function(){if(arguments[0]instanceof C&&w(arguments[1],E)){for(var e=arguments[0],t=arguments[1],i=new fu(e),r=new C,n=new C,o=1;o<t.size();o++)if(t.getCoordinate(o,r),t.getCoordinate(o-1,n),i.countSegment(r,n),i.isOnSegment())return i.getLocation();return i.getLocation()}if(arguments[0]instanceof C&&arguments[1]instanceof Array){for(var s=arguments[0],a=arguments[1],l=new fu(s),u=1;u<a.length;u++){var c=a[u],h=a[u-1];if(l.countSegment(c,h),l.isOnSegment())return l.getLocation()}return l.getLocation()}},function(){}),du={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}},gu=(F.prototype.interfaces_=function(){return[]},F.prototype.getClass=function(){return F},F.orientationIndex=function(e,t,i){return Zl.orientationIndex(e,t,i)},F.signedArea=function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var t=0,i=e[0].x,r=1;r<e.length-1;r++){var n=e[r].x-i,o=e[r+1].y;t+=n*(e[r-1].y-o)}return t/2}if(w(arguments[0],E)){var s=arguments[0],a=s.size();if(a<3)return 0;var l=new C,u=new C,c=new C;s.getCoordinate(0,u),s.getCoordinate(1,c);var h=u.x;c.x-=h;for(var A=0,p=1;p<a-1;p++)l.y=u.y,u.x=c.x,u.y=c.y,s.getCoordinate(p+1,c),c.x-=h,A+=u.x*(l.y-c.y);return A/2}},F.distanceLineLine=function(e,t,i,r){if(e.equals(t))return F.distancePointLine(e,i,r);if(i.equals(r))return F.distancePointLine(r,e,t);var n=!1;if(u.intersects(e,t,i,r)){var o=(t.x-e.x)*(r.y-i.y)-(t.y-e.y)*(r.x-i.x);if(0===o)n=!0;else{var s=(e.y-i.y)*(r.x-i.x)-(e.x-i.x)*(r.y-i.y),a=((e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y))/o,l=s/o;(l<0||l>1||a<0||a>1)&&(n=!0)}}else n=!0;return n?Gl.min(F.distancePointLine(e,i,r),F.distancePointLine(t,i,r),F.distancePointLine(i,e,t),F.distancePointLine(r,e,t)):0},F.isPointInRing=function(e,t){return F.locatePointInRing(e,t)!==v.EXTERIOR},F.computeLength=function(e){var t=e.size();if(t<=1)return 0;var i=0,r=new C;e.getCoordinate(0,r);for(var n=r.x,o=r.y,s=1;s<t;s++){e.getCoordinate(s,r);var a=r.x,l=r.y,u=a-n,c=l-o;i+=Math.sqrt(u*u+c*c),n=a,o=l}return i},F.isCCW=function(e){var t=e.length-1;if(t<3)throw new Fl("Ring has fewer than 4 points, so orientation cannot be determined");for(var i=e[0],r=0,n=1;n<=t;n++){var o=e[n];o.y>i.y&&(i=o,r=n)}var s=r;do{(s-=1)<0&&(s=t)}while(e[s].equals2D(i)&&s!==r);var a=r;do{a=(a+1)%t}while(e[a].equals2D(i)&&a!==r);var l=e[s],u=e[a];if(l.equals2D(i)||u.equals2D(i)||l.equals2D(u))return!1;var c=F.computeOrientation(l,i,u),h=!1;return h=0===c?l.x>u.x:c>0,h},F.locatePointInRing=function(e,t){return fu.locatePointInRing(e,t)},F.distancePointLinePerpendicular=function(e,t,i){var r=(i.x-t.x)*(i.x-t.x)+(i.y-t.y)*(i.y-t.y),n=((t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y))/r;return Math.abs(n)*Math.sqrt(r)},F.computeOrientation=function(e,t,i){return F.orientationIndex(e,t,i)},F.distancePointLine=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];if(0===t.length)throw new Fl("Line array must contain at least one vertex");for(var i=e.distance(t[0]),r=0;r<t.length-1;r++){var n=F.distancePointLine(e,t[r],t[r+1]);n<i&&(i=n)}return i}if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];if(s.x===a.x&&s.y===a.y)return o.distance(s);var l=(a.x-s.x)*(a.x-s.x)+(a.y-s.y)*(a.y-s.y),u=((o.x-s.x)*(a.x-s.x)+(o.y-s.y)*(a.y-s.y))/l;if(u<=0)return o.distance(s);if(u>=1)return o.distance(a);var c=((s.y-o.y)*(a.x-s.x)-(s.x-o.x)*(a.y-s.y))/l;return Math.abs(c)*Math.sqrt(l)}},F.isOnLine=function(e,t){for(var i=new Au,r=1;r<t.length;r++){var n=t[r-1],o=t[r];if(i.computeIntersection(e,n,o),i.hasIntersection())return!0}return!1},du.CLOCKWISE.get=function(){return-1},du.RIGHT.get=function(){return F.CLOCKWISE},du.COUNTERCLOCKWISE.get=function(){return 1},du.LEFT.get=function(){return F.COUNTERCLOCKWISE},du.COLLINEAR.get=function(){return 0},du.STRAIGHT.get=function(){return F.COLLINEAR},Object.defineProperties(F,du),function(){}),N=(gu.prototype.filter=function(e){},gu.prototype.interfaces_=function(){return[]},gu.prototype.getClass=function(){return gu},function(){var e=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=e,this._SRID=e.getSRID()}),mu={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}},yu=(N.prototype.isGeometryCollection=function(){return this.getSortIndex()===N.SORTINDEX_GEOMETRYCOLLECTION},N.prototype.getFactory=function(){return this._factory},N.prototype.getGeometryN=function(e){return this},N.prototype.getArea=function(){return 0},N.prototype.isRectangle=function(){return!1},N.prototype.equals=function(){if(arguments[0]instanceof N){var e=arguments[0];return null!==e&&this.equalsTopo(e)}if(arguments[0]instanceof Object){var t=arguments[0];if(!(t instanceof N))return!1;var i=t;return this.equalsExact(i)}},N.prototype.equalsExact=function(e){return this===e||this.equalsExact(e,0)},N.prototype.geometryChanged=function(){this.apply(N.geometryChangedFilter)},N.prototype.geometryChangedAction=function(){this._envelope=null},N.prototype.equalsNorm=function(e){return null!==e&&this.norm().equalsExact(e.norm())},N.prototype.getLength=function(){return 0},N.prototype.getNumGeometries=function(){return 1},N.prototype.compareTo=function(){if(1===arguments.length){var e=arguments[0],t=e;return this.getSortIndex()!==t.getSortIndex()?this.getSortIndex()-t.getSortIndex():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(e)}if(2===arguments.length){var i=arguments[0],r=arguments[1];return this.getSortIndex()!==i.getSortIndex()?this.getSortIndex()-i.getSortIndex():this.isEmpty()&&i.isEmpty()?0:this.isEmpty()?-1:i.isEmpty()?1:this.compareToSameClass(i,r)}},N.prototype.getUserData=function(){return this._userData},N.prototype.getSRID=function(){return this._SRID},N.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},N.prototype.checkNotGeometryCollection=function(e){if(e.getSortIndex()===N.SORTINDEX_GEOMETRYCOLLECTION)throw new Fl("This method does not support GeometryCollection arguments")},N.prototype.equal=function(e,t,i){return 0===i?e.equals(t):e.distance(t)<=i},N.prototype.norm=function(){var e=this.copy();return e.normalize(),e},N.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},N.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new u(this._envelope)},N.prototype.setSRID=function(e){this._SRID=e},N.prototype.setUserData=function(e){this._userData=e},N.prototype.compare=function(e,t){for(var i=e.iterator(),r=t.iterator();i.hasNext()&&r.hasNext();){var n=i.next(),o=r.next(),s=n.compareTo(o);if(0!==s)return s}return i.hasNext()?1:r.hasNext()?-1:0},N.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},N.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===N.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===N.SORTINDEX_MULTIPOINT||this.getSortIndex()===N.SORTINDEX_MULTILINESTRING||this.getSortIndex()===N.SORTINDEX_MULTIPOLYGON},N.prototype.interfaces_=function(){return[Rl,Ol,oo]},N.prototype.getClass=function(){return N},N.hasNonEmptyElements=function(e){for(var t=0;t<e.length;t++)if(!e[t].isEmpty())return!0;return!1},N.hasNullElements=function(e){for(var t=0;t<e.length;t++)if(null===e[t])return!0;return!1},mu.serialVersionUID.get=function(){return 0x799ea46522854c00},mu.SORTINDEX_POINT.get=function(){return 0},mu.SORTINDEX_MULTIPOINT.get=function(){return 1},mu.SORTINDEX_LINESTRING.get=function(){return 2},mu.SORTINDEX_LINEARRING.get=function(){return 3},mu.SORTINDEX_MULTILINESTRING.get=function(){return 4},mu.SORTINDEX_POLYGON.get=function(){return 5},mu.SORTINDEX_MULTIPOLYGON.get=function(){return 6},mu.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},mu.geometryChangedFilter.get=function(){return yu},Object.defineProperties(N,mu),function(){}),_u=(yu.interfaces_=function(){return[gu]},yu.filter=function(e){e.geometryChangedAction()},function(){}),vu=(_u.prototype.filter=function(e){},_u.prototype.interfaces_=function(){return[]},_u.prototype.getClass=function(){return _u},function(){}),Cu={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}},wu=(vu.prototype.isInBoundary=function(e){},vu.prototype.interfaces_=function(){return[]},vu.prototype.getClass=function(){return vu},Cu.Mod2BoundaryNodeRule.get=function(){return wu},Cu.EndPointBoundaryNodeRule.get=function(){return xu},Cu.MultiValentEndPointBoundaryNodeRule.get=function(){return bu},Cu.MonoValentEndPointBoundaryNodeRule.get=function(){return Eu},Cu.MOD2_BOUNDARY_RULE.get=function(){return new wu},Cu.ENDPOINT_BOUNDARY_RULE.get=function(){return new xu},Cu.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new bu},Cu.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Eu},Cu.OGC_SFS_BOUNDARY_RULE.get=function(){return vu.MOD2_BOUNDARY_RULE},Object.defineProperties(vu,Cu),function(){}),xu=(wu.prototype.isInBoundary=function(e){return e%2==1},wu.prototype.interfaces_=function(){return[vu]},wu.prototype.getClass=function(){return wu},function(){}),bu=(xu.prototype.isInBoundary=function(e){return e>0},xu.prototype.interfaces_=function(){return[vu]},xu.prototype.getClass=function(){return xu},function(){}),Eu=(bu.prototype.isInBoundary=function(e){return e>1},bu.prototype.interfaces_=function(){return[vu]},bu.prototype.getClass=function(){return bu},function(){}),Bu=(Eu.prototype.isInBoundary=function(e){return 1===e},Eu.prototype.interfaces_=function(){return[vu]},Eu.prototype.getClass=function(){return Eu},function(){}),Mu=(Bu.prototype.add=function(){},Bu.prototype.addAll=function(){},Bu.prototype.isEmpty=function(){},Bu.prototype.iterator=function(){},Bu.prototype.size=function(){},Bu.prototype.toArray=function(){},Bu.prototype.remove=function(){},function(t){function e(e){t.call(this),this.message=e||""}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={name:{configurable:!0}};return i.name.get=function(){return"IndexOutOfBoundsException"},Object.defineProperties(e,i),e}(Error)),Iu=function(){},Su=(Iu.prototype.hasNext=function(){},Iu.prototype.next=function(){},Iu.prototype.remove=function(){},function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(){},t.prototype.set=function(){},t.prototype.isEmpty=function(){},t}(Bu)),O=((so.prototype=new Error).name="NoSuchElementException",function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof Bu&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.ensureCapacity=function(){},t.prototype.interfaces_=function(){return[e,Bu]},t.prototype.add=function(e){return 1===arguments.length?this.array_.push(e):this.array_.splice(arguments[0],arguments[1]),!0},t.prototype.clear=function(){this.array_=[]},t.prototype.addAll=function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next());return!0},t.prototype.set=function(e,t){var i=this.array_[e];return this.array_[e]=t,i},t.prototype.iterator=function(){return new Pu(this)},t.prototype.get=function(e){if(e<0||e>=this.size())throw new Mu;return this.array_[e]},t.prototype.isEmpty=function(){return 0===this.array_.length},t.prototype.size=function(){return this.array_.length},t.prototype.toArray=function(){for(var e=[],t=0,i=this.array_.length;t<i;t++)e.push(this.array_[t]);return e},t.prototype.remove=function(e){for(var t=!1,i=0,r=this.array_.length;i<r;i++)if(this.array_[i]===e){this.array_.splice(i,1),t=!0;break}return t},t}(Su)),Pu=function(t){function e(e){t.call(this),this.arrayList_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new so;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(e){return this.arrayList_.set(this.position_-1,e)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(Iu),Tu=function(_){function e(){if(_.call(this),0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.ensureCapacity(e.length),this.add(e,!0)}else if(2===arguments.length){var t=arguments[0],i=arguments[1];this.ensureCapacity(t.length),this.add(t,i)}}_&&(e.__proto__=_),(e.prototype=Object.create(_&&_.prototype)).constructor=e;var t={coordArrayType:{configurable:!0}};return t.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(e){return this.get(e)},e.prototype.addAll=function(){if(2===arguments.length){for(var e=arguments[0],t=arguments[1],i=!1,r=e.iterator();r.hasNext();)this.add(r.next(),t),i=!0;return i}return _.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var e=_.prototype.clone.call(this),t=0;t<this.size();t++)e.add(t,this.get(t).copy());return e},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){if(1===arguments.length){var e=arguments[0];_.prototype.add.call(this,e)}else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var t=arguments[0],i=arguments[1];return this.add(t,i,!0),!0}if(arguments[0]instanceof C&&"boolean"==typeof arguments[1]){var r=arguments[0];if(!arguments[1]&&this.size()>=1)if(this.get(this.size()-1).equals2D(r))return null;_.prototype.add.call(this,r)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var n=arguments[0],o=arguments[1];return this.add(n,o),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var s=arguments[0],a=arguments[1];if(arguments[2])for(var l=0;l<s.length;l++)this.add(s[l],a);else for(var u=s.length-1;u>=0;u--)this.add(s[u],a);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof C){var c=arguments[0],h=arguments[1];if(!arguments[2]){var A=this.size();if(A>0){if(c>0)if(this.get(c-1).equals2D(h))return null;if(c<A)if(this.get(c).equals2D(h))return null}}_.prototype.add.call(this,c,h)}}else if(4===arguments.length){var p=arguments[0],f=arguments[1],d=arguments[2],g=arguments[3],m=1;d>g&&(m=-1);for(var y=d;y!==g;y+=m)this.add(p[y],f);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new C(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,t),e}(O),h=function(){},Lu={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}},Du=(Lu.ForwardComparator.get=function(){return Du},Lu.BidirectionalComparator.get=function(){return Fu},Lu.coordArrayType.get=function(){return new Array(0).fill(null)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.isRing=function(e){return!(e.length<4)&&!!e[0].equals2D(e[e.length-1])},h.ptNotInList=function(e,t){for(var i=0;i<e.length;i++){var r=e[i];if(h.indexOf(r,t)<0)return r}return null},h.scroll=function(e,t){var i=h.indexOf(t,e);if(i<0)return null;var r=new Array(e.length).fill(null);eu.arraycopy(e,i,r,0,e.length-i),eu.arraycopy(e,0,r,e.length-i,i),eu.arraycopy(r,0,e,0,e.length)},h.equals=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];if(e===t)return!0;if(null===e||null===t)return!1;if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(!e[i].equals(t[i]))return!1;return!0}if(3===arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2];if(r===n)return!0;if(null===r||null===n)return!1;if(r.length!==n.length)return!1;for(var s=0;s<r.length;s++)if(0!==o.compare(r[s],n[s]))return!1;return!0}},h.intersection=function(e,t){for(var i=new Tu,r=0;r<e.length;r++)t.intersects(e[r])&&i.add(e[r],!0);return i.toCoordinateArray()},h.hasRepeatedPoints=function(e){for(var t=1;t<e.length;t++)if(e[t-1].equals(e[t]))return!0;return!1},h.removeRepeatedPoints=function(e){if(!h.hasRepeatedPoints(e))return e;return new Tu(e,!1).toCoordinateArray()},h.reverse=function(e){for(var t=e.length-1,i=Math.trunc(t/2),r=0;r<=i;r++){var n=e[r];e[r]=e[t-r],e[t-r]=n}},h.removeNull=function(e){for(var t=0,i=0;i<e.length;i++)null!==e[i]&&t++;var r=new Array(t).fill(null);if(0===t)return r;for(var n=0,o=0;o<e.length;o++)null!==e[o]&&(r[n++]=e[o]);return r},h.copyDeep=function(){if(1===arguments.length){for(var e=arguments[0],t=new Array(e.length).fill(null),i=0;i<e.length;i++)t[i]=new C(e[i]);return t}if(5===arguments.length)for(var r=arguments[0],n=arguments[1],o=arguments[2],s=arguments[3],a=arguments[4],l=0;l<a;l++)o[s+l]=new C(r[n+l])},h.isEqualReversed=function(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=t[e.length-i-1];if(0!==r.compareTo(n))return!1}return!0},h.envelope=function(e){for(var t=new u,i=0;i<e.length;i++)t.expandToInclude(e[i]);return t},h.toCoordinateArray=function(e){return e.toArray(h.coordArrayType)},h.atLeastNCoordinatesOrNothing=function(e,t){return t.length>=e?t:[]},h.indexOf=function(e,t){for(var i=0;i<t.length;i++)if(e.equals(t[i]))return i;return-1},h.increasingDirection=function(e){for(var t=0;t<Math.trunc(e.length/2);t++){var i=e.length-1-t,r=e[t].compareTo(e[i]);if(0!==r)return r}return 1},h.compare=function(e,t){for(var i=0;i<e.length&&i<t.length;){var r=e[i].compareTo(t[i]);if(0!==r)return r;i++}return i<t.length?-1:i<e.length?1:0},h.minCoordinate=function(e){for(var t=null,i=0;i<e.length;i++)(null===t||t.compareTo(e[i])>0)&&(t=e[i]);return t},h.extract=function(e,t,i){t=Gl.clamp(t,0,e.length);var r=(i=Gl.clamp(i,-1,e.length))-t+1;i<0&&(r=0),t>=e.length&&(r=0),i<t&&(r=0);var n=new Array(r).fill(null);if(0===r)return n;for(var o=0,s=t;s<=i;s++)n[o++]=e[s];return n},Object.defineProperties(h,Lu),function(){}),Fu=(Du.prototype.compare=function(e,t){return h.compare(e,t)},Du.prototype.interfaces_=function(){return[Ul]},Du.prototype.getClass=function(){return Du},function(){}),Nu=(Fu.prototype.compare=function(e,t){var i=e,r=t;if(i.length<r.length)return-1;if(i.length>r.length)return 1;if(0===i.length)return 0;var n=h.compare(i,r);return h.isEqualReversed(i,r)?0:n},Fu.prototype.OLDcompare=function(e,t){var i=e,r=t;if(i.length<r.length)return-1;if(i.length>r.length)return 1;if(0===i.length)return 0;for(var n=h.increasingDirection(i),o=h.increasingDirection(r),s=n>0?0:i.length-1,a=o>0?0:i.length-1,l=0;l<i.length;l++){var u=i[s].compareTo(r[a]);if(0!==u)return u;s+=n,a+=o}return 0},Fu.prototype.interfaces_=function(){return[Ul]},Fu.prototype.getClass=function(){return Fu},function(){}),Ou=(Nu.prototype.get=function(){},Nu.prototype.put=function(){},Nu.prototype.size=function(){},Nu.prototype.values=function(){},Nu.prototype.entrySet=function(){},function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Nu)),Ru=((ao.prototype=new Error).name="OperationNotSupported",(lo.prototype=new Bu).contains=function(){},function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof Bu&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.contains=function(e){for(var t=0,i=this.array_.length;t<i;t++)if(this.array_[t]===e)return!0;return!1},t.prototype.add=function(e){return!this.contains(e)&&(this.array_.push(e),!0)},t.prototype.addAll=function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next());return!0},t.prototype.remove=function(e){throw new Error},t.prototype.size=function(){return this.array_.length},t.prototype.isEmpty=function(){return 0===this.array_.length},t.prototype.toArray=function(){for(var e=[],t=0,i=this.array_.length;t<i;t++)e.push(this.array_[t]);return e},t.prototype.iterator=function(){return new Uu(this)},t}(lo)),Uu=function(t){function e(e){t.call(this),this.hashSet_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new so;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new ao},e}(Iu),ku=0,Hu=((fo.prototype=new Ou).get=function(e){for(var t=this.root_;null!==t;){var i=e.compareTo(t.key);if(i<0)t=t.left;else{if(!(i>0))return t.value;t=t.right}}return null},fo.prototype.put=function(e,t){if(null===this.root_)return this.root_={key:e,value:t,left:null,right:null,parent:null,color:ku,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var i,r,n=this.root_;do{if(i=n,(r=e.compareTo(n.key))<0)n=n.left;else{if(!(r>0)){var o=n.value;return n.value=t,o}n=n.right}}while(null!==n);var s={key:e,left:null,right:null,value:t,parent:i,color:ku,getValue:function(){return this.value},getKey:function(){return this.key}};return r<0?i.left=s:i.right=s,this.fixAfterInsertion(s),this.size_++,null},fo.prototype.fixAfterInsertion=function(e){for(e.color=1;null!=e&&e!==this.root_&&1===e.parent.color;)if(co(e)===Ao(co(co(e)))){var t=po(co(co(e)));1===uo(t)?(ho(co(e),ku),ho(t,ku),ho(co(co(e)),1),e=co(co(e))):(e===po(co(e))&&(e=co(e),this.rotateLeft(e)),ho(co(e),ku),ho(co(co(e)),1),this.rotateRight(co(co(e))))}else{var i=Ao(co(co(e)));1===uo(i)?(ho(co(e),ku),ho(i,ku),ho(co(co(e)),1),e=co(co(e))):(e===Ao(co(e))&&(e=co(e),this.rotateRight(e)),ho(co(e),ku),ho(co(co(e)),1),this.rotateLeft(co(co(e))))}this.root_.color=ku},fo.prototype.values=function(){var e=new O,t=this.getFirstEntry();if(null!==t)for(e.add(t.value);null!==(t=fo.successor(t));)e.add(t.value);return e},fo.prototype.entrySet=function(){var e=new Ru,t=this.getFirstEntry();if(null!==t)for(e.add(t);null!==(t=fo.successor(t));)e.add(t);return e},fo.prototype.rotateLeft=function(e){if(null!=e){var t=e.right;e.right=t.left,null!=t.left&&(t.left.parent=e),t.parent=e.parent,null===e.parent?this.root_=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}},fo.prototype.rotateRight=function(e){if(null!=e){var t=e.left;e.left=t.right,null!=t.right&&(t.right.parent=e),t.parent=e.parent,null===e.parent?this.root_=t:e.parent.right===e?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}},fo.prototype.getFirstEntry=function(){var e=this.root_;if(null!=e)for(;null!=e.left;)e=e.left;return e},fo.successor=function(e){if(null===e)return null;if(null!==e.right){for(var t=e.right;null!==t.left;)t=t.left;return t}for(var i=e.parent,r=e;null!==i&&r===i.right;)r=i,i=i.parent;return i},fo.prototype.size=function(){return this.size_},function(){}),Qu=(Hu.prototype.interfaces_=function(){return[]},Hu.prototype.getClass=function(){return Hu},go.prototype=new lo,(mo.prototype=new go).contains=function(e){for(var t=0,i=this.array_.length;t<i;t++)if(0===this.array_[t].compareTo(e))return!0;return!1},mo.prototype.add=function(e){if(this.contains(e))return!1;for(var t=0,i=this.array_.length;t<i;t++)if(1===this.array_[t].compareTo(e))return this.array_.splice(t,0,e),!0;return this.array_.push(e),!0},mo.prototype.addAll=function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next());return!0},mo.prototype.remove=function(e){throw new ao},mo.prototype.size=function(){return this.array_.length},mo.prototype.isEmpty=function(){return 0===this.array_.length},mo.prototype.toArray=function(){for(var e=[],t=0,i=this.array_.length;t<i;t++)e.push(this.array_[t]);return e},mo.prototype.iterator=function(){return new Qu(this)},function(e){this.treeSet_=e,this.position_=0}),Vu=(Qu.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new so;return this.treeSet_.array_[this.position_++]},Qu.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Qu.prototype.remove=function(){throw new ao},function(){}),Gu=(Vu.sort=function(){var e,t,i,r,n=arguments[0];if(1===arguments.length)r=function(e,t){return e.compareTo(t)},n.sort(r);else if(2===arguments.length)i=arguments[1],r=function(e,t){return i.compare(e,t)},n.sort(r);else if(3===arguments.length){(t=n.slice(arguments[1],arguments[2])).sort();var o=n.slice(0,arguments[1]).concat(t,n.slice(arguments[2],n.length));for(n.splice(0,n.length),e=0;e<o.length;e++)n.push(o[e])}else if(4===arguments.length)for(t=n.slice(arguments[1],arguments[2]),i=arguments[3],r=function(e,t){return i.compare(e,t)},t.sort(r),o=n.slice(0,arguments[1]).concat(t,n.slice(arguments[2],n.length)),n.splice(0,n.length),e=0;e<o.length;e++)n.push(o[e])},Vu.asList=function(e){for(var t=new O,i=0,r=e.length;i<r;i++)t.add(e[i]);return t},function(){}),zu={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}},Wu=(zu.P.get=function(){return 0},zu.L.get=function(){return 1},zu.A.get=function(){return 2},zu.FALSE.get=function(){return-1},zu.TRUE.get=function(){return-2},zu.DONTCARE.get=function(){return-3},zu.SYM_FALSE.get=function(){return"F"},zu.SYM_TRUE.get=function(){return"T"},zu.SYM_DONTCARE.get=function(){return"*"},zu.SYM_P.get=function(){return"0"},zu.SYM_L.get=function(){return"1"},zu.SYM_A.get=function(){return"2"},Gu.prototype.interfaces_=function(){return[]},Gu.prototype.getClass=function(){return Gu},Gu.toDimensionSymbol=function(e){switch(e){case Gu.FALSE:return Gu.SYM_FALSE;case Gu.TRUE:return Gu.SYM_TRUE;case Gu.DONTCARE:return Gu.SYM_DONTCARE;case Gu.P:return Gu.SYM_P;case Gu.L:return Gu.SYM_L;case Gu.A:return Gu.SYM_A}throw new Fl("Unknown dimension value: "+e)},Gu.toDimensionValue=function(e){switch(Kl.toUpperCase(e)){case Gu.SYM_FALSE:return Gu.FALSE;case Gu.SYM_TRUE:return Gu.TRUE;case Gu.SYM_DONTCARE:return Gu.DONTCARE;case Gu.SYM_P:return Gu.P;case Gu.SYM_L:return Gu.L;case Gu.SYM_A:return Gu.A}throw new Fl("Unknown dimension symbol: "+e)},Object.defineProperties(Gu,zu),function(){}),qu=(Wu.prototype.filter=function(e){},Wu.prototype.interfaces_=function(){return[]},Wu.prototype.getClass=function(){return Wu},function(){}),Ku=(qu.prototype.filter=function(e,t){},qu.prototype.isDone=function(){},qu.prototype.isGeometryChanged=function(){},qu.prototype.interfaces_=function(){return[]},qu.prototype.getClass=function(){return qu},function(n){function i(e,t){if(n.call(this,t),this._geometries=e||[],n.hasNullElements(this._geometries))throw new Fl("geometries must not contain null elements")}n&&(i.__proto__=n),(i.prototype=Object.create(n&&n.prototype)).constructor=i;var e={serialVersionUID:{configurable:!0}};return i.prototype.computeEnvelopeInternal=function(){for(var e=new u,t=0;t<this._geometries.length;t++)e.expandToInclude(this._geometries[t].getEnvelopeInternal());return e},i.prototype.getGeometryN=function(e){return this._geometries[e]},i.prototype.getSortIndex=function(){return n.SORTINDEX_GEOMETRYCOLLECTION},i.prototype.getCoordinates=function(){for(var e=new Array(this.getNumPoints()).fill(null),t=-1,i=0;i<this._geometries.length;i++)for(var r=this._geometries[i].getCoordinates(),n=0;n<r.length;n++)e[++t]=r[n];return e},i.prototype.getArea=function(){for(var e=0,t=0;t<this._geometries.length;t++)e+=this._geometries[t].getArea();return e},i.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];if(!this.isEquivalentClass(e))return!1;var i=e;if(this._geometries.length!==i._geometries.length)return!1;for(var r=0;r<this._geometries.length;r++)if(!this._geometries[r].equalsExact(i._geometries[r],t))return!1;return!0}return n.prototype.equalsExact.apply(this,arguments)},i.prototype.normalize=function(){for(var e=0;e<this._geometries.length;e++)this._geometries[e].normalize();Vu.sort(this._geometries)},i.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},i.prototype.getBoundaryDimension=function(){for(var e=Gu.FALSE,t=0;t<this._geometries.length;t++)e=Math.max(e,this._geometries[t].getBoundaryDimension());return e},i.prototype.getDimension=function(){for(var e=Gu.FALSE,t=0;t<this._geometries.length;t++)e=Math.max(e,this._geometries[t].getDimension());return e},i.prototype.getLength=function(){for(var e=0,t=0;t<this._geometries.length;t++)e+=this._geometries[t].getLength();return e},i.prototype.getNumPoints=function(){for(var e=0,t=0;t<this._geometries.length;t++)e+=this._geometries[t].getNumPoints();return e},i.prototype.getNumGeometries=function(){return this._geometries.length},i.prototype.reverse=function(){for(var e=this._geometries.length,t=new Array(e).fill(null),i=0;i<this._geometries.length;i++)t[i]=this._geometries[i].reverse();return this.getFactory().createGeometryCollection(t)},i.prototype.compareToSameClass=function(){if(1===arguments.length){var e=arguments[0],t=new mo(Vu.asList(this._geometries)),i=new mo(Vu.asList(e._geometries));return this.compare(t,i)}if(2===arguments.length){for(var r=arguments[0],n=arguments[1],o=r,s=this.getNumGeometries(),a=o.getNumGeometries(),l=0;l<s&&l<a;){var u=this.getGeometryN(l),c=o.getGeometryN(l),h=u.compareToSameClass(c,n);if(0!==h)return h;l++}return l<s?1:l<a?-1:0}},i.prototype.apply=function(){if(w(arguments[0],_u))for(var e=arguments[0],t=0;t<this._geometries.length;t++)this._geometries[t].apply(e);else if(w(arguments[0],qu)){var i=arguments[0];if(0===this._geometries.length)return null;for(var r=0;r<this._geometries.length&&(this._geometries[r].apply(i),!i.isDone());r++);i.isGeometryChanged()&&this.geometryChanged()}else if(w(arguments[0],Wu)){var n=arguments[0];n.filter(this);for(var o=0;o<this._geometries.length;o++)this._geometries[o].apply(n)}else if(w(arguments[0],gu)){var s=arguments[0];s.filter(this);for(var a=0;a<this._geometries.length;a++)this._geometries[a].apply(s)}},i.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),D.shouldNeverReachHere(),null},i.prototype.clone=function(){var e=n.prototype.clone.call(this);e._geometries=new Array(this._geometries.length).fill(null);for(var t=0;t<this._geometries.length;t++)e._geometries[t]=this._geometries[t].clone();return e},i.prototype.getGeometryType=function(){return"GeometryCollection"},i.prototype.copy=function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new i(e,this._factory)},i.prototype.isEmpty=function(){for(var e=0;e<this._geometries.length;e++)if(!this._geometries[e].isEmpty())return!1;return!0},i.prototype.interfaces_=function(){return[]},i.prototype.getClass=function(){return i},e.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(i,e),i}(N)),ju=function(i){function r(){i.apply(this,arguments)}i&&(r.__proto__=i),(r.prototype=Object.create(i&&i.prototype)).constructor=r;var e={serialVersionUID:{configurable:!0}};return r.prototype.getSortIndex=function(){return N.SORTINDEX_MULTILINESTRING},r.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return!!this.isEquivalentClass(e)&&i.prototype.equalsExact.call(this,e,t)}return i.prototype.equalsExact.apply(this,arguments)},r.prototype.getBoundaryDimension=function(){return this.isClosed()?Gu.FALSE:0},r.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var e=0;e<this._geometries.length;e++)if(!this._geometries[e].isClosed())return!1;return!0},r.prototype.getDimension=function(){return 1},r.prototype.reverse=function(){for(var e=this._geometries.length,t=new Array(e).fill(null),i=0;i<this._geometries.length;i++)t[e-1-i]=this._geometries[i].reverse();return this.getFactory().createMultiLineString(t)},r.prototype.getBoundary=function(){return new Zu(this).getBoundary()},r.prototype.getGeometryType=function(){return"MultiLineString"},r.prototype.copy=function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new r(e,this._factory)},r.prototype.interfaces_=function(){return[Hu]},r.prototype.getClass=function(){return r},e.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(r,e),r}(Ku),Zu=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var e=arguments[0],t=vu.MOD2_BOUNDARY_RULE;this._geom=e,this._geomFact=e.getFactory(),this._bnRule=t}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this._geom=i,this._geomFact=i.getFactory(),this._bnRule=r}},Yu=(Zu.prototype.boundaryMultiLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var t=this.computeBoundaryCoordinates(e);return 1===t.length?this._geomFact.createPoint(t[0]):this._geomFact.createMultiPointFromCoords(t)},Zu.prototype.getBoundary=function(){return this._geom instanceof ec?this.boundaryLineString(this._geom):this._geom instanceof ju?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},Zu.prototype.boundaryLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(e.isClosed())return this._bnRule.isInBoundary(2)?e.getStartPoint():this._geomFact.createMultiPoint();return this._geomFact.createMultiPoint([e.getStartPoint(),e.getEndPoint()])},Zu.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},Zu.prototype.computeBoundaryCoordinates=function(e){var t=new O;this._endpointMap=new fo;for(var i=0;i<e.getNumGeometries();i++){var r=e.getGeometryN(i);0!==r.getNumPoints()&&(this.addEndpoint(r.getCoordinateN(0)),this.addEndpoint(r.getCoordinateN(r.getNumPoints()-1)))}for(var n=this._endpointMap.entrySet().iterator();n.hasNext();){var o=n.next(),s=o.getValue().count;this._bnRule.isInBoundary(s)&&t.add(o.getKey())}return h.toCoordinateArray(t)},Zu.prototype.addEndpoint=function(e){var t=this._endpointMap.get(e);null===t&&(t=new Yu,this._endpointMap.put(e,t)),t.count++},Zu.prototype.interfaces_=function(){return[]},Zu.prototype.getClass=function(){return Zu},Zu.getBoundary=function(){if(1===arguments.length){var e=arguments[0];return new Zu(e).getBoundary()}if(2===arguments.length){var t=arguments[0],i=arguments[1];return new Zu(t,i).getBoundary()}},function(){this.count=null}),Xu=(Yu.prototype.interfaces_=function(){return[]},Yu.prototype.getClass=function(){return Yu},function(){}),Ju={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}},$u=(Xu.prototype.interfaces_=function(){return[]},Xu.prototype.getClass=function(){return Xu},Xu.chars=function(e,t){for(var i=new Array(t).fill(null),r=0;r<t;r++)i[r]=e;return String(i)},Xu.getStackTrace=function(){if(1===arguments.length){var e=arguments[0],t=new function(){},i=new function(){}(t);return e.printStackTrace(i),t.toString()}if(2===arguments.length){for(var r=arguments[0],n=arguments[1],o="",s=new function(){}(new function(){}(Xu.getStackTrace(r))),a=0;a<n;a++)try{o+=s.readLine()+Xu.NEWLINE}catch(e){if(!(e instanceof yo))throw e;D.shouldNeverReachHere()}return o}},Xu.split=function(e,t){for(var i=t.length,r=new O,n=""+e,o=n.indexOf(t);o>=0;){var s=n.substring(0,o);r.add(s),o=(n=n.substring(o+i)).indexOf(t)}n.length>0&&r.add(n);for(var a=new Array(r.size()).fill(null),l=0;l<a.length;l++)a[l]=r.get(l);return a},Xu.toString=function(){if(1===arguments.length){var e=arguments[0];return Xu.SIMPLE_ORDINATE_FORMAT.format(e)}},Xu.spaces=function(e){return Xu.chars(" ",e)},Ju.NEWLINE.get=function(){return eu.getProperty("line.separator")},Ju.SIMPLE_ORDINATE_FORMAT.get=function(){return new function(){}("0.#")},Object.defineProperties(Xu,Ju),function(){}),ec=($u.prototype.interfaces_=function(){return[]},$u.prototype.getClass=function(){return $u},$u.copyCoord=function(e,t,i,r){for(var n=Math.min(e.getDimension(),i.getDimension()),o=0;o<n;o++)i.setOrdinate(r,o,e.getOrdinate(t,o))},$u.isRing=function(e){var t=e.size();return 0===t||!(t<=3)&&(e.getOrdinate(0,E.X)===e.getOrdinate(t-1,E.X)&&e.getOrdinate(0,E.Y)===e.getOrdinate(t-1,E.Y))},$u.isEqual=function(e,t){var i=e.size();if(i!==t.size())return!1;for(var r=Math.min(e.getDimension(),t.getDimension()),n=0;n<i;n++)for(var o=0;o<r;o++){var s=e.getOrdinate(n,o),a=t.getOrdinate(n,o);if(e.getOrdinate(n,o)!==t.getOrdinate(n,o)&&(!_.isNaN(s)||!_.isNaN(a)))return!1}return!0},$u.extend=function(e,t,i){var r=e.create(i,t.getDimension()),n=t.size();if($u.copy(t,0,r,0,n),n>0)for(var o=n;o<i;o++)$u.copy(t,n-1,r,o,1);return r},$u.reverse=function(e){for(var t=e.size()-1,i=Math.trunc(t/2),r=0;r<=i;r++)$u.swap(e,r,t-r)},$u.swap=function(e,t,i){if(t===i)return null;for(var r=0;r<e.getDimension();r++){var n=e.getOrdinate(t,r);e.setOrdinate(t,r,e.getOrdinate(i,r)),e.setOrdinate(i,r,n)}},$u.copy=function(e,t,i,r,n){for(var o=0;o<n;o++)$u.copyCoord(e,t+o,i,r+o)},$u.toString=function(){if(1===arguments.length){var e=arguments[0],t=e.size();if(0===t)return"()";var i=e.getDimension(),r=new Wl;r.append("(");for(var n=0;n<t;n++){n>0&&r.append(" ");for(var o=0;o<i;o++)o>0&&r.append(","),r.append(Xu.toString(e.getOrdinate(n,o)))}return r.append(")"),r.toString()}},$u.ensureValidRing=function(e,t){var i=t.size();if(0===i)return t;if(i<=3)return $u.createClosedRing(e,t,4);return t.getOrdinate(0,E.X)===t.getOrdinate(i-1,E.X)&&t.getOrdinate(0,E.Y)===t.getOrdinate(i-1,E.Y)?t:$u.createClosedRing(e,t,i+1)},$u.createClosedRing=function(e,t,i){var r=e.create(i,t.getDimension()),n=t.size();$u.copy(t,0,r,0,n);for(var o=n;o<i;o++)$u.copy(t,0,r,o,1);return r},function(n){function t(e,t){n.call(this,t),this._points=null,this.init(e)}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new u:this._points.expandEnvelope(new u)},t.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},t.prototype.getSortIndex=function(){return n.SORTINDEX_LINESTRING},t.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},t.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];if(!this.isEquivalentClass(e))return!1;var i=e;if(this._points.size()!==i._points.size())return!1;for(var r=0;r<this._points.size();r++)if(!this.equal(this._points.getCoordinate(r),i._points.getCoordinate(r),t))return!1;return!0}return n.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var e=0;e<Math.trunc(this._points.size()/2);e++){var t=this._points.size()-1-e;if(!this._points.getCoordinate(e).equals(this._points.getCoordinate(t)))return this._points.getCoordinate(e).compareTo(this._points.getCoordinate(t))>0&&$u.reverse(this._points),null}},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?Gu.FALSE:0},t.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},t.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},t.prototype.getDimension=function(){return 1},t.prototype.getLength=function(){return F.computeLength(this._points)},t.prototype.getNumPoints=function(){return this._points.size()},t.prototype.reverse=function(){var e=this._points.copy();$u.reverse(e);return this.getFactory().createLineString(e)},t.prototype.compareToSameClass=function(){if(1===arguments.length){for(var e=arguments[0],t=0,i=0;t<this._points.size()&&i<e._points.size();){var r=this._points.getCoordinate(t).compareTo(e._points.getCoordinate(i));if(0!==r)return r;t++,i++}return t<this._points.size()?1:i<e._points.size()?-1:0}if(2===arguments.length){var n=arguments[0];return arguments[1].compare(this._points,n._points)}},t.prototype.apply=function(){if(w(arguments[0],_u))for(var e=arguments[0],t=0;t<this._points.size();t++)e.filter(this._points.getCoordinate(t));else if(w(arguments[0],qu)){var i=arguments[0];if(0===this._points.size())return null;for(var r=0;r<this._points.size()&&(i.filter(this._points,r),!i.isDone());r++);i.isGeometryChanged()&&this.geometryChanged()}else if(w(arguments[0],Wu))arguments[0].filter(this);else if(w(arguments[0],gu))arguments[0].filter(this)},t.prototype.getBoundary=function(){return new Zu(this).getBoundary()},t.prototype.isEquivalentClass=function(e){return e instanceof t},t.prototype.clone=function(){var e=n.prototype.clone.call(this);return e._points=this._points.clone(),e},t.prototype.getCoordinateN=function(e){return this._points.getCoordinate(e)},t.prototype.getGeometryType=function(){return"LineString"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._points},t.prototype.isEmpty=function(){return 0===this._points.size()},t.prototype.init=function(e){if(null===e&&(e=this.getFactory().getCoordinateSequenceFactory().create([])),1===e.size())throw new Fl("Invalid number of points in LineString (found "+e.size()+" - must be 0 or >= 2)");this._points=e},t.prototype.isCoordinate=function(e){for(var t=0;t<this._points.size();t++)if(this._points.getCoordinate(t).equals(e))return!0;return!1},t.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},t.prototype.getPointN=function(e){return this.getFactory().createPoint(this._points.getCoordinate(e))},t.prototype.interfaces_=function(){return[Hu]},t.prototype.getClass=function(){return t},e.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(t,e),t}(N)),tc=function(){},ic=(tc.prototype.interfaces_=function(){return[]},tc.prototype.getClass=function(){return tc},function(i){function e(e,t){i.call(this,t),this._coordinates=e||null,this.init(this._coordinates)}i&&(e.__proto__=i),(e.prototype=Object.create(i&&i.prototype)).constructor=e;var t={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new u;var e=new u;return e.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),e},e.prototype.getSortIndex=function(){return i.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return!!this.isEquivalentClass(e)&&(!(!this.isEmpty()||!e.isEmpty())||this.isEmpty()===e.isEmpty()&&this.equal(e.getCoordinate(),this.getCoordinate(),t))}return i.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return Gu.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(1===arguments.length){var e=arguments[0];return this.getCoordinate().compareTo(e.getCoordinate())}if(2===arguments.length){var t=arguments[0];return arguments[1].compare(this._coordinates,t._coordinates)}},e.prototype.apply=function(){if(w(arguments[0],_u)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this.getCoordinate())}else if(w(arguments[0],qu)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this._coordinates,0),t.isGeometryChanged()&&this.geometryChanged()}else if(w(arguments[0],Wu))arguments[0].filter(this);else if(w(arguments[0],gu))arguments[0].filter(this)},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var e=i.prototype.clone.call(this);return e._coordinates=this._coordinates.clone(),e},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return 0===this._coordinates.size()},e.prototype.init=function(e){null===e&&(e=this.getFactory().getCoordinateSequenceFactory().create([])),D.isTrue(e.size()<=1),this._coordinates=e},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[tc]},e.prototype.getClass=function(){return e},t.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(e,t),e}(N)),rc=function(){},nc=(rc.prototype.interfaces_=function(){return[]},rc.prototype.getClass=function(){return rc},function(s){function r(e,t,i){if(s.call(this,i),this._shell=null,this._holes=null,null===e&&(e=this.getFactory().createLinearRing()),null===t&&(t=[]),s.hasNullElements(t))throw new Fl("holes must not contain null elements");if(e.isEmpty()&&s.hasNonEmptyElements(t))throw new Fl("shell is empty but holes are not");this._shell=e,this._holes=t}s&&(r.__proto__=s),(r.prototype=Object.create(s&&s.prototype)).constructor=r;var e={serialVersionUID:{configurable:!0}};return r.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},r.prototype.getSortIndex=function(){return s.SORTINDEX_POLYGON},r.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var e=new Array(this.getNumPoints()).fill(null),t=-1,i=this._shell.getCoordinates(),r=0;r<i.length;r++)e[++t]=i[r];for(var n=0;n<this._holes.length;n++)for(var o=this._holes[n].getCoordinates(),s=0;s<o.length;s++)e[++t]=o[s];return e},r.prototype.getArea=function(){var e=0;e+=Math.abs(F.signedArea(this._shell.getCoordinateSequence()));for(var t=0;t<this._holes.length;t++)e-=Math.abs(F.signedArea(this._holes[t].getCoordinateSequence()));return e},r.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing())return!1;if(null===this._shell)return!1;if(5!==this._shell.getNumPoints())return!1;for(var e=this._shell.getCoordinateSequence(),t=this.getEnvelopeInternal(),i=0;i<5;i++){var r=e.getX(i);if(r!==t.getMinX()&&r!==t.getMaxX())return!1;var n=e.getY(i);if(n!==t.getMinY()&&n!==t.getMaxY())return!1}for(var o=e.getX(0),s=e.getY(0),a=1;a<=4;a++){var l=e.getX(a),u=e.getY(a);if(l!==o===(u!==s))return!1;o=l,s=u}return!0},r.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];if(!this.isEquivalentClass(e))return!1;var i=e,r=this._shell,n=i._shell;if(!r.equalsExact(n,t))return!1;if(this._holes.length!==i._holes.length)return!1;for(var o=0;o<this._holes.length;o++)if(!this._holes[o].equalsExact(i._holes[o],t))return!1;return!0}return s.prototype.equalsExact.apply(this,arguments)},r.prototype.normalize=function(){if(0===arguments.length){this.normalize(this._shell,!0);for(var e=0;e<this._holes.length;e++)this.normalize(this._holes[e],!1);Vu.sort(this._holes)}else if(2===arguments.length){var t=arguments[0],i=arguments[1];if(t.isEmpty())return null;var r=new Array(t.getCoordinates().length-1).fill(null);eu.arraycopy(t.getCoordinates(),0,r,0,r.length);var n=h.minCoordinate(t.getCoordinates());h.scroll(r,n),eu.arraycopy(r,0,t.getCoordinates(),0,r.length),t.getCoordinates()[r.length]=r[0],F.isCCW(t.getCoordinates())===i&&h.reverse(t.getCoordinates())}},r.prototype.getCoordinate=function(){return this._shell.getCoordinate()},r.prototype.getNumInteriorRing=function(){return this._holes.length},r.prototype.getBoundaryDimension=function(){return 1},r.prototype.getDimension=function(){return 2},r.prototype.getLength=function(){var e=0;e+=this._shell.getLength();for(var t=0;t<this._holes.length;t++)e+=this._holes[t].getLength();return e},r.prototype.getNumPoints=function(){for(var e=this._shell.getNumPoints(),t=0;t<this._holes.length;t++)e+=this._holes[t].getNumPoints();return e},r.prototype.reverse=function(){var e=this.copy();e._shell=this._shell.copy().reverse(),e._holes=new Array(this._holes.length).fill(null);for(var t=0;t<this._holes.length;t++)e._holes[t]=this._holes[t].copy().reverse();return e},r.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},r.prototype.compareToSameClass=function(){if(1===arguments.length){var e=arguments[0],t=this._shell,i=e._shell;return t.compareToSameClass(i)}if(2===arguments.length){var r=arguments[0],n=arguments[1],o=r,s=this._shell,a=o._shell,l=s.compareToSameClass(a,n);if(0!==l)return l;for(var u=this.getNumInteriorRing(),c=o.getNumInteriorRing(),h=0;h<u&&h<c;){var A=this.getInteriorRingN(h),p=o.getInteriorRingN(h),f=A.compareToSameClass(p,n);if(0!==f)return f;h++}return h<u?1:h<c?-1:0}},r.prototype.apply=function(e){if(w(e,_u)){this._shell.apply(e);for(var t=0;t<this._holes.length;t++)this._holes[t].apply(e)}else if(w(e,qu)){if(this._shell.apply(e),!e.isDone())for(var i=0;i<this._holes.length&&(this._holes[i].apply(e),!e.isDone());i++);e.isGeometryChanged()&&this.geometryChanged()}else if(w(e,Wu))e.filter(this);else if(w(e,gu)){e.filter(this),this._shell.apply(e);for(var r=0;r<this._holes.length;r++)this._holes[r].apply(e)}},r.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var e=new Array(this._holes.length+1).fill(null);e[0]=this._shell;for(var t=0;t<this._holes.length;t++)e[t+1]=this._holes[t];return e.length<=1?this.getFactory().createLinearRing(e[0].getCoordinateSequence()):this.getFactory().createMultiLineString(e)},r.prototype.clone=function(){var e=s.prototype.clone.call(this);e._shell=this._shell.clone(),e._holes=new Array(this._holes.length).fill(null);for(var t=0;t<this._holes.length;t++)e._holes[t]=this._holes[t].clone();return e},r.prototype.getGeometryType=function(){return"Polygon"},r.prototype.copy=function(){for(var e=this._shell.copy(),t=new Array(this._holes.length).fill(null),i=0;i<t.length;i++)t[i]=this._holes[i].copy();return new r(e,t,this._factory)},r.prototype.getExteriorRing=function(){return this._shell},r.prototype.isEmpty=function(){return this._shell.isEmpty()},r.prototype.getInteriorRingN=function(e){return this._holes[e]},r.prototype.interfaces_=function(){return[rc]},r.prototype.getClass=function(){return r},e.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(r,e),r}(N)),oc=function(i){function r(){i.apply(this,arguments)}i&&(r.__proto__=i),(r.prototype=Object.create(i&&i.prototype)).constructor=r;var e={serialVersionUID:{configurable:!0}};return r.prototype.getSortIndex=function(){return N.SORTINDEX_MULTIPOINT},r.prototype.isValid=function(){return!0},r.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return!!this.isEquivalentClass(e)&&i.prototype.equalsExact.call(this,e,t)}return i.prototype.equalsExact.apply(this,arguments)},r.prototype.getCoordinate=function(){if(1===arguments.length){var e=arguments[0];return this._geometries[e].getCoordinate()}return i.prototype.getCoordinate.apply(this,arguments)},r.prototype.getBoundaryDimension=function(){return Gu.FALSE},r.prototype.getDimension=function(){return 0},r.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},r.prototype.getGeometryType=function(){return"MultiPoint"},r.prototype.copy=function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new r(e,this._factory)},r.prototype.interfaces_=function(){return[tc]},r.prototype.getClass=function(){return r},e.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(r,e),r}(Ku),sc=function(i){function e(e,t){e instanceof C&&t instanceof l&&(e=t.getCoordinateSequenceFactory().create(e)),i.call(this,e,t),this.validateConstruction()}i&&(e.__proto__=i),(e.prototype=Object.create(i&&i.prototype)).constructor=e;var t={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return N.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return Gu.FALSE},e.prototype.isClosed=function(){return!!this.isEmpty()||i.prototype.isClosed.call(this)},e.prototype.reverse=function(){var e=this._points.copy();$u.reverse(e);return this.getFactory().createLinearRing(e)},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!i.prototype.isClosed.call(this))throw new Fl("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new Fl("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},t.MINIMUM_VALID_SIZE.get=function(){return 4},t.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,t),e}(ec),ac=function(i){function r(){i.apply(this,arguments)}i&&(r.__proto__=i),(r.prototype=Object.create(i&&i.prototype)).constructor=r;var e={serialVersionUID:{configurable:!0}};return r.prototype.getSortIndex=function(){return N.SORTINDEX_MULTIPOLYGON},r.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return!!this.isEquivalentClass(e)&&i.prototype.equalsExact.call(this,e,t)}return i.prototype.equalsExact.apply(this,arguments)},r.prototype.getBoundaryDimension=function(){return 1},r.prototype.getDimension=function(){return 2},r.prototype.reverse=function(){for(var e=this._geometries.length,t=new Array(e).fill(null),i=0;i<this._geometries.length;i++)t[i]=this._geometries[i].reverse();return this.getFactory().createMultiPolygon(t)},r.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var e=new O,t=0;t<this._geometries.length;t++)for(var i=this._geometries[t].getBoundary(),r=0;r<i.getNumGeometries();r++)e.add(i.getGeometryN(r));var n=new Array(e.size()).fill(null);return this.getFactory().createMultiLineString(e.toArray(n))},r.prototype.getGeometryType=function(){return"MultiPolygon"},r.prototype.copy=function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new r(e,this._factory)},r.prototype.interfaces_=function(){return[rc]},r.prototype.getClass=function(){return r},e.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(r,e),r}(Ku),lc=function(e){this._factory=e||null,this._isUserDataCopied=!1},uc={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}},cc=(lc.prototype.setCopyUserData=function(e){this._isUserDataCopied=e},lc.prototype.edit=function(e,t){if(null===e)return null;var i=this.editInternal(e,t);return this._isUserDataCopied&&i.setUserData(e.getUserData()),i},lc.prototype.editInternal=function(e,t){return null===this._factory&&(this._factory=e.getFactory()),e instanceof Ku?this.editGeometryCollection(e,t):e instanceof nc?this.editPolygon(e,t):e instanceof ic?t.edit(e,this._factory):e instanceof ec?t.edit(e,this._factory):(D.shouldNeverReachHere("Unsupported Geometry class: "+e.getClass().getName()),null)},lc.prototype.editGeometryCollection=function(e,t){for(var i=t.edit(e,this._factory),r=new O,n=0;n<i.getNumGeometries();n++){var o=this.edit(i.getGeometryN(n),t);null===o||o.isEmpty()||r.add(o)}return i.getClass()===oc?this._factory.createMultiPoint(r.toArray([])):i.getClass()===ju?this._factory.createMultiLineString(r.toArray([])):i.getClass()===ac?this._factory.createMultiPolygon(r.toArray([])):this._factory.createGeometryCollection(r.toArray([]))},lc.prototype.editPolygon=function(e,t){var i=t.edit(e,this._factory);if(null===i&&(i=this._factory.createPolygon(null)),i.isEmpty())return i;var r=this.edit(i.getExteriorRing(),t);if(null===r||r.isEmpty())return this._factory.createPolygon();for(var n=new O,o=0;o<i.getNumInteriorRing();o++){var s=this.edit(i.getInteriorRingN(o),t);null===s||s.isEmpty()||n.add(s)}return this._factory.createPolygon(r,n.toArray([]))},lc.prototype.interfaces_=function(){return[]},lc.prototype.getClass=function(){return lc},lc.GeometryEditorOperation=function(){},uc.NoOpGeometryOperation.get=function(){return cc},uc.CoordinateOperation.get=function(){return hc},uc.CoordinateSequenceOperation.get=function(){return Ac},Object.defineProperties(lc,uc),function(){}),hc=(cc.prototype.edit=function(e,t){return e},cc.prototype.interfaces_=function(){return[lc.GeometryEditorOperation]},cc.prototype.getClass=function(){return cc},function(){}),Ac=(hc.prototype.edit=function(e,t){var i=this.editCoordinates(e.getCoordinates(),e);return null===i?e:e instanceof sc?t.createLinearRing(i):e instanceof ec?t.createLineString(i):e instanceof ic?i.length>0?t.createPoint(i[0]):t.createPoint():e},hc.prototype.interfaces_=function(){return[lc.GeometryEditorOperation]},hc.prototype.getClass=function(){return hc},function(){}),pc=(Ac.prototype.edit=function(e,t){return e instanceof sc?t.createLinearRing(this.edit(e.getCoordinateSequence(),e)):e instanceof ec?t.createLineString(this.edit(e.getCoordinateSequence(),e)):e instanceof ic?t.createPoint(this.edit(e.getCoordinateSequence(),e)):e},Ac.prototype.interfaces_=function(){return[lc.GeometryEditorOperation]},Ac.prototype.getClass=function(){return Ac},function(){if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var e=arguments[0];this._coordinates=new Array(e).fill(null);for(var t=0;t<e;t++)this._coordinates[t]=new C}else if(w(arguments[0],E)){var i=arguments[0];if(null===i)return this._coordinates=new Array(0).fill(null),null;this._dimension=i.getDimension(),this._coordinates=new Array(i.size()).fill(null);for(var r=0;r<this._coordinates.length;r++)this._coordinates[r]=i.getCoordinateCopy(r)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var n=arguments[0],o=arguments[1];this._coordinates=n,this._dimension=o,null===n&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var s=arguments[0],a=arguments[1];this._coordinates=new Array(s).fill(null),this._dimension=a;for(var l=0;l<s;l++)this._coordinates[l]=new C}}),fc={serialVersionUID:{configurable:!0}},dc=(pc.prototype.setOrdinate=function(e,t,i){switch(t){case E.X:this._coordinates[e].x=i;break;case E.Y:this._coordinates[e].y=i;break;case E.Z:this._coordinates[e].z=i;break;default:throw new Fl("invalid ordinateIndex")}},pc.prototype.size=function(){return this._coordinates.length},pc.prototype.getOrdinate=function(e,t){switch(t){case E.X:return this._coordinates[e].x;case E.Y:return this._coordinates[e].y;case E.Z:return this._coordinates[e].z}return _.NaN},pc.prototype.getCoordinate=function(){if(1===arguments.length){var e=arguments[0];return this._coordinates[e]}if(2===arguments.length){var t=arguments[0],i=arguments[1];i.x=this._coordinates[t].x,i.y=this._coordinates[t].y,i.z=this._coordinates[t].z}},pc.prototype.getCoordinateCopy=function(e){return new C(this._coordinates[e])},pc.prototype.getDimension=function(){return this._dimension},pc.prototype.getX=function(e){return this._coordinates[e].x},pc.prototype.clone=function(){for(var e=new Array(this.size()).fill(null),t=0;t<this._coordinates.length;t++)e[t]=this._coordinates[t].clone();return new pc(e,this._dimension)},pc.prototype.expandEnvelope=function(e){for(var t=0;t<this._coordinates.length;t++)e.expandToInclude(this._coordinates[t]);return e},pc.prototype.copy=function(){for(var e=new Array(this.size()).fill(null),t=0;t<this._coordinates.length;t++)e[t]=this._coordinates[t].copy();return new pc(e,this._dimension)},pc.prototype.toString=function(){if(this._coordinates.length>0){var e=new Wl(17*this._coordinates.length);e.append("("),e.append(this._coordinates[0]);for(var t=1;t<this._coordinates.length;t++)e.append(", "),e.append(this._coordinates[t]);return e.append(")"),e.toString()}return"()"},pc.prototype.getY=function(e){return this._coordinates[e].y},pc.prototype.toCoordinateArray=function(){return this._coordinates},pc.prototype.interfaces_=function(){return[E,oo]},pc.prototype.getClass=function(){return pc},fc.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(pc,fc),function(){}),gc={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}},mc=(dc.prototype.readResolve=function(){return dc.instance()},dc.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];return new pc(e)}if(w(arguments[0],E)){var t=arguments[0];return new pc(t)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return r>3&&(r=3),r<2?new pc(i):new pc(i,r)}},dc.prototype.interfaces_=function(){return[Ql,oo]},dc.prototype.getClass=function(){return dc},dc.instance=function(){return dc.instanceObject},gc.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},gc.instanceObject.get=function(){return new dc},Object.defineProperties(dc,gc),function(e){function t(){e.call(this),this.map_=new Map}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(e){return this.map_.get(e)||null},t.prototype.put=function(e,t){return this.map_.set(e,t),t},t.prototype.values=function(){for(var e=new O,t=this.map_.values(),i=t.next();!i.done;)e.add(i.value),i=t.next();return e},t.prototype.entrySet=function(){var t=new Ru;return this.map_.entries().forEach(function(e){return t.add(e)}),t},t.prototype.size=function(){return this.map_.size()},t}(Nu)),yc=function e(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=e.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof vc){var t=arguments[0];this._modelType=t,t===e.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var i=arguments[0];this._modelType=e.FIXED,this.setScale(i)}else if(arguments[0]instanceof e){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}},_c={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}},vc=(yc.prototype.equals=function(e){if(!(e instanceof yc))return!1;var t=e;return this._modelType===t._modelType&&this._scale===t._scale},yc.prototype.compareTo=function(e){var t=e,i=this.getMaximumSignificantDigits(),r=t.getMaximumSignificantDigits();return new ql(i).compareTo(new ql(r))},yc.prototype.getScale=function(){return this._scale},yc.prototype.isFloating=function(){return this._modelType===yc.FLOATING||this._modelType===yc.FLOATING_SINGLE},yc.prototype.getType=function(){return this._modelType},yc.prototype.toString=function(){var e="UNKNOWN";return this._modelType===yc.FLOATING?e="Floating":this._modelType===yc.FLOATING_SINGLE?e="Floating-Single":this._modelType===yc.FIXED&&(e="Fixed (Scale="+this.getScale()+")"),e},yc.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var e=arguments[0];if(_.isNaN(e))return e;if(this._modelType===yc.FLOATING_SINGLE)return e;return this._modelType===yc.FIXED?Math.round(e*this._scale)/this._scale:e}if(arguments[0]instanceof C){var t=arguments[0];if(this._modelType===yc.FLOATING)return null;t.x=this.makePrecise(t.x),t.y=this.makePrecise(t.y)}},yc.prototype.getMaximumSignificantDigits=function(){var e=16;return this._modelType===yc.FLOATING?e=16:this._modelType===yc.FLOATING_SINGLE?e=6:this._modelType===yc.FIXED&&(e=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),e},yc.prototype.setScale=function(e){this._scale=Math.abs(e)},yc.prototype.interfaces_=function(){return[oo,Ol]},yc.prototype.getClass=function(){return yc},yc.mostPrecise=function(e,t){return e.compareTo(t)>=0?e:t},_c.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},_c.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(yc,_c),function e(t){this._name=t||null,e.nameToTypeMap.put(t,this)}),Cc={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}},l=(vc.prototype.readResolve=function(){return vc.nameToTypeMap.get(this._name)},vc.prototype.toString=function(){return this._name},vc.prototype.interfaces_=function(){return[oo]},vc.prototype.getClass=function(){return vc},Cc.serialVersionUID.get=function(){return-552860263173159e4},Cc.nameToTypeMap.get=function(){return new mc},Object.defineProperties(vc,Cc),yc.Type=vc,yc.FIXED=new vc("FIXED"),yc.FLOATING=new vc("FLOATING"),yc.FLOATING_SINGLE=new vc("FLOATING SINGLE"),function e(){this._precisionModel=new yc,this._SRID=0,this._coordinateSequenceFactory=e.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?w(arguments[0],Ql)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof yc&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))}),wc={serialVersionUID:{configurable:!0}},xc=(l.prototype.toGeometry=function(e){return e.isNull()?this.createPoint(null):e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new C(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new C(e.getMinX(),e.getMinY()),new C(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new C(e.getMinX(),e.getMinY()),new C(e.getMinX(),e.getMaxY()),new C(e.getMaxX(),e.getMaxY()),new C(e.getMaxX(),e.getMinY()),new C(e.getMinX(),e.getMinY())]),null)},l.prototype.createLineString=function(e){return e?e instanceof Array?new ec(this.getCoordinateSequenceFactory().create(e),this):w(e,E)?new ec(e,this):void 0:new ec(this.getCoordinateSequenceFactory().create([]),this)},l.prototype.createMultiLineString=function(){if(0===arguments.length)return new ju(null,this);if(1===arguments.length){var e=arguments[0];return new ju(e,this)}},l.prototype.buildGeometry=function(e){for(var t=null,i=!1,r=!1,n=e.iterator();n.hasNext();){var o=n.next(),s=o.getClass();null===t&&(t=s),s!==t&&(i=!0),o.isGeometryCollectionOrDerived()&&(r=!0)}if(null===t)return this.createGeometryCollection();if(i||r)return this.createGeometryCollection(l.toGeometryArray(e));var a=e.iterator().next();if(e.size()>1){if(a instanceof nc)return this.createMultiPolygon(l.toPolygonArray(e));if(a instanceof ec)return this.createMultiLineString(l.toLineStringArray(e));if(a instanceof ic)return this.createMultiPoint(l.toPointArray(e));D.shouldNeverReachHere("Unhandled class: "+a.getClass().getName())}return a},l.prototype.createMultiPointFromCoords=function(e){return this.createMultiPoint(null!==e?this.getCoordinateSequenceFactory().create(e):null)},l.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof C){var e=arguments[0];return this.createPoint(null!==e?this.getCoordinateSequenceFactory().create([e]):null)}if(w(arguments[0],E)){var t=arguments[0];return new ic(t,this)}}},l.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},l.prototype.createPolygon=function(){if(0===arguments.length)return new nc(null,null,this);if(1===arguments.length){if(w(arguments[0],E)){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof Array){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof sc){var i=arguments[0];return this.createPolygon(i,null)}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];return new nc(r,n,this)}},l.prototype.getSRID=function(){return this._SRID},l.prototype.createGeometryCollection=function(){if(0===arguments.length)return new Ku(null,this);if(1===arguments.length){var e=arguments[0];return new Ku(e,this)}},l.prototype.createGeometry=function(e){return new lc(this).edit(e,{edit:function(){if(2===arguments.length){var e=arguments[0];return this._coordinateSequenceFactory.create(e)}}})},l.prototype.getPrecisionModel=function(){return this._precisionModel},l.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(null!==e?this.getCoordinateSequenceFactory().create(e):null)}if(w(arguments[0],E)){var t=arguments[0];return new sc(t,this)}}},l.prototype.createMultiPolygon=function(){if(0===arguments.length)return new ac(null,this);if(1===arguments.length){var e=arguments[0];return new ac(e,this)}},l.prototype.createMultiPoint=function(){if(0===arguments.length)return new oc(null,this);if(1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];return new oc(e,this)}if(arguments[0]instanceof Array){var t=arguments[0];return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(w(arguments[0],E)){var i=arguments[0];if(null===i)return this.createMultiPoint(new Array(0).fill(null));for(var r=new Array(i.size()).fill(null),n=0;n<i.size();n++){var o=this.getCoordinateSequenceFactory().create(1,i.getDimension());$u.copy(i,n,o,0,1),r[n]=this.createPoint(o)}return this.createMultiPoint(r)}}},l.prototype.interfaces_=function(){return[oo]},l.prototype.getClass=function(){return l},l.toMultiPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},l.toGeometryArray=function(e){if(null===e)return null;var t=new Array(e.size()).fill(null);return e.toArray(t)},l.getDefaultCoordinateSequenceFactory=function(){return dc.instance()},l.toMultiLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},l.toLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},l.toMultiPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},l.toLinearRingArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},l.toPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},l.toPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},l.createPointFromInternalCoord=function(e,t){return t.getPrecisionModel().makePrecise(e),t.getFactory().createPoint(e)},wc.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(l,wc),["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"]),bc=function(e){this.geometryFactory=e||new l},Ec=(bc.prototype.read=function(e){var t,i=(t="string"==typeof e?JSON.parse(e):e).type;if(!Ec[i])throw new Error("Unknown GeoJSON type: "+t.type);return-1!==xc.indexOf(i)?Ec[i].apply(this,[t.coordinates]):"GeometryCollection"===i?Ec[i].apply(this,[t.geometries]):Ec[i].apply(this,[t])},bc.prototype.write=function(e){var t=e.getGeometryType();if(!Bc[t])throw new Error("Geometry is not supported");return Bc[t].apply(this,[e])},{Feature:function(e){var t={};for(var i in e)t[i]=e[i];if(e.geometry){var r=e.geometry.type;if(!Ec[r])throw new Error("Unknown GeoJSON type: "+e.type);t.geometry=this.read(e.geometry)}return e.bbox&&(t.bbox=Ec.bbox.apply(this,[e.bbox])),t},FeatureCollection:function(e){var t={};if(e.features){t.features=[];for(var i=0;i<e.features.length;++i)t.features.push(this.read(e.features[i]))}return e.bbox&&(t.bbox=this.parse.bbox.apply(this,[e.bbox])),t},coordinates:function(e){for(var t=[],i=0;i<e.length;++i){var r=e[i];t.push(new C(r[0],r[1]))}return t},bbox:function(e){return this.geometryFactory.createLinearRing([new C(e[0],e[1]),new C(e[2],e[1]),new C(e[2],e[3]),new C(e[0],e[3]),new C(e[0],e[1])])},Point:function(e){var t=new C(e[0],e[1]);return this.geometryFactory.createPoint(t)},MultiPoint:function(e){for(var t=[],i=0;i<e.length;++i)t.push(Ec.Point.apply(this,[e[i]]));return this.geometryFactory.createMultiPoint(t)},LineString:function(e){var t=Ec.coordinates.apply(this,[e]);return this.geometryFactory.createLineString(t)},MultiLineString:function(e){for(var t=[],i=0;i<e.length;++i)t.push(Ec.LineString.apply(this,[e[i]]));return this.geometryFactory.createMultiLineString(t)},Polygon:function(e){for(var t=Ec.coordinates.apply(this,[e[0]]),i=this.geometryFactory.createLinearRing(t),r=[],n=1;n<e.length;++n){var o=e[n],s=Ec.coordinates.apply(this,[o]),a=this.geometryFactory.createLinearRing(s);r.push(a)}return this.geometryFactory.createPolygon(i,r)},MultiPolygon:function(e){for(var t=[],i=0;i<e.length;++i){var r=e[i];t.push(Ec.Polygon.apply(this,[r]))}return this.geometryFactory.createMultiPolygon(t)},GeometryCollection:function(e){for(var t=[],i=0;i<e.length;++i){var r=e[i];t.push(this.read(r))}return this.geometryFactory.createGeometryCollection(t)}}),Bc={coordinate:function(e){return[e.x,e.y]},Point:function(e){return{type:"Point",coordinates:Bc.coordinate.apply(this,[e.getCoordinate()])}},MultiPoint:function(e){for(var t=[],i=0;i<e._geometries.length;++i){var r=e._geometries[i],n=Bc.Point.apply(this,[r]);t.push(n.coordinates)}return{type:"MultiPoint",coordinates:t}},LineString:function(e){for(var t=[],i=e.getCoordinates(),r=0;r<i.length;++r){var n=i[r];t.push(Bc.coordinate.apply(this,[n]))}return{type:"LineString",coordinates:t}},MultiLineString:function(e){for(var t=[],i=0;i<e._geometries.length;++i){var r=e._geometries[i],n=Bc.LineString.apply(this,[r]);t.push(n.coordinates)}return{type:"MultiLineString",coordinates:t}},Polygon:function(e){var t=[],i=Bc.LineString.apply(this,[e._shell]);t.push(i.coordinates);for(var r=0;r<e._holes.length;++r){var n=e._holes[r],o=Bc.LineString.apply(this,[n]);t.push(o.coordinates)}return{type:"Polygon",coordinates:t}},MultiPolygon:function(e){for(var t=[],i=0;i<e._geometries.length;++i){var r=e._geometries[i],n=Bc.Polygon.apply(this,[r]);t.push(n.coordinates)}return{type:"MultiPolygon",coordinates:t}},GeometryCollection:function(e){for(var t=[],i=0;i<e._geometries.length;++i){var r=e._geometries[i],n=r.getGeometryType();t.push(Bc[n].apply(this,[r]))}return{type:"GeometryCollection",geometries:t}}},Mc=function(e){this.geometryFactory=e||new l,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new bc(this.geometryFactory)},Ic=(Mc.prototype.read=function(e){var t=this.parser.read(e);return this.precisionModel.getType()===yc.FIXED&&this.reducePrecision(t),t},Mc.prototype.reducePrecision=function(e){var t,i;if(e.coordinate)this.precisionModel.makePrecise(e.coordinate);else if(e.points)for(t=0,i=e.points.length;t<i;t++)this.precisionModel.makePrecise(e.points[t]);else if(e.geometries)for(t=0,i=e.geometries.length;t<i;t++)this.reducePrecision(e.geometries[t])},function(){this.parser=new bc(this.geometryFactory)}),R=(Ic.prototype.write=function(e){return this.parser.write(e)},function(){}),Sc={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}},Pc=(R.prototype.interfaces_=function(){return[]},R.prototype.getClass=function(){return R},R.opposite=function(e){return e===R.LEFT?R.RIGHT:e===R.RIGHT?R.LEFT:e},Sc.ON.get=function(){return 0},Sc.LEFT.get=function(){return 1},Sc.RIGHT.get=function(){return 2},Object.defineProperties(R,Sc),(_o.prototype=new Error).name="EmptyStackException",(vo.prototype=new Su).add=function(e){return this.array_.push(e),!0},vo.prototype.get=function(e){if(e<0||e>=this.size())throw new Error;return this.array_[e]},vo.prototype.push=function(e){return this.array_.push(e),e},vo.prototype.pop=function(e){if(0===this.array_.length)throw new _o;return this.array_.pop()},vo.prototype.peek=function(){if(0===this.array_.length)throw new _o;return this.array_[this.array_.length-1]},vo.prototype.empty=function(){return 0===this.array_.length},vo.prototype.isEmpty=function(){return this.empty()},vo.prototype.search=function(e){return this.array_.indexOf(e)},vo.prototype.size=function(){return this.array_.length},vo.prototype.toArray=function(){for(var e=[],t=0,i=this.array_.length;t<i;t++)e.push(this.array_[t]);return e},function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}),Tc=(Pc.prototype.getCoordinate=function(){return this._minCoord},Pc.prototype.getRightmostSide=function(e,t){var i=this.getRightmostSideOfSegment(e,t);return i<0&&(i=this.getRightmostSideOfSegment(e,t-1)),i<0&&(this._minCoord=null,this.checkForRightmostCoordinate(e)),i},Pc.prototype.findRightmostEdgeAtVertex=function(){var e=this._minDe.getEdge().getCoordinates();D.isTrue(this._minIndex>0&&this._minIndex<e.length,"rightmost point expected to be interior vertex of edge");var t=e[this._minIndex-1],i=e[this._minIndex+1],r=F.computeOrientation(this._minCoord,i,t),n=!1;t.y<this._minCoord.y&&i.y<this._minCoord.y&&r===F.COUNTERCLOCKWISE?n=!0:t.y>this._minCoord.y&&i.y>this._minCoord.y&&r===F.CLOCKWISE&&(n=!0),n&&(this._minIndex=this._minIndex-1)},Pc.prototype.getRightmostSideOfSegment=function(e,t){var i=e.getEdge().getCoordinates();if(t<0||t+1>=i.length)return-1;if(i[t].y===i[t+1].y)return-1;var r=R.LEFT;return i[t].y<i[t+1].y&&(r=R.RIGHT),r},Pc.prototype.getEdge=function(){return this._orientedDe},Pc.prototype.checkForRightmostCoordinate=function(e){for(var t=e.getEdge().getCoordinates(),i=0;i<t.length-1;i++)(null===this._minCoord||t[i].x>this._minCoord.x)&&(this._minDe=e,this._minIndex=i,this._minCoord=t[i])},Pc.prototype.findRightmostEdgeAtNode=function(){var e=this._minDe.getNode().getEdges();this._minDe=e.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},Pc.prototype.findEdge=function(e){for(var t=e.iterator();t.hasNext();){var i=t.next();i.isForward()&&this.checkForRightmostCoordinate(i)}D.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;this.getRightmostSide(this._minDe,this._minIndex)===R.LEFT&&(this._orientedDe=this._minDe.getSym())},Pc.prototype.interfaces_=function(){return[]},Pc.prototype.getClass=function(){return Pc},function(i){function r(e,t){i.call(this,r.msgWithCoord(e,t)),this.pt=t?new C(t):null,this.name="TopologyException"}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.getCoordinate=function(){return this.pt},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r.msgWithCoord=function(e,t){return t?e:e+" [ "+t+" ]"},r}(lu)),Lc=function(){this.array_=[]},Dc=(Lc.prototype.addLast=function(e){this.array_.push(e)},Lc.prototype.removeFirst=function(){return this.array_.shift()},Lc.prototype.isEmpty=function(){return 0===this.array_.length},function(){this._finder=null,this._dirEdgeList=new O,this._nodes=new O,this._rightMostCoord=null,this._env=null,this._finder=new Pc}),Fc=(Dc.prototype.clearVisitedEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();)e.next().setVisited(!1)},Dc.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},Dc.prototype.computeNodeDepth=function(e){for(var t=null,i=e.getEdges().iterator();i.hasNext();){var r=i.next();if(r.isVisited()||r.getSym().isVisited()){t=r;break}}if(null===t)throw new Tc("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(t);for(var n=e.getEdges().iterator();n.hasNext();){var o=n.next();o.setVisited(!0),this.copySymDepths(o)}},Dc.prototype.computeDepth=function(e){this.clearVisitedEdges();var t=this._finder.getEdge();t.setEdgeDepths(R.RIGHT,e),this.copySymDepths(t),this.computeDepths(t)},Dc.prototype.create=function(e){this.addReachable(e),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},Dc.prototype.findResultEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.getDepth(R.RIGHT)>=1&&t.getDepth(R.LEFT)<=0&&!t.isInteriorAreaEdge()&&t.setInResult(!0)}},Dc.prototype.computeDepths=function(e){var t=new Ru,i=new Lc,r=e.getNode();for(i.addLast(r),t.add(r),e.setVisited(!0);!i.isEmpty();){var n=i.removeFirst();t.add(n),this.computeNodeDepth(n);for(var o=n.getEdges().iterator();o.hasNext();){var s=o.next().getSym();if(!s.isVisited()){var a=s.getNode();t.contains(a)||(i.addLast(a),t.add(a))}}}},Dc.prototype.compareTo=function(e){var t=e;return this._rightMostCoord.x<t._rightMostCoord.x?-1:this._rightMostCoord.x>t._rightMostCoord.x?1:0},Dc.prototype.getEnvelope=function(){if(null===this._env){for(var e=new u,t=this._dirEdgeList.iterator();t.hasNext();)for(var i=t.next().getEdge().getCoordinates(),r=0;r<i.length-1;r++)e.expandToInclude(i[r]);this._env=e}return this._env},Dc.prototype.addReachable=function(e){var t=new vo;for(t.add(e);!t.empty();){var i=t.pop();this.add(i,t)}},Dc.prototype.copySymDepths=function(e){var t=e.getSym();t.setDepth(R.LEFT,e.getDepth(R.RIGHT)),t.setDepth(R.RIGHT,e.getDepth(R.LEFT))},Dc.prototype.add=function(e,t){e.setVisited(!0),this._nodes.add(e);for(var i=e.getEdges().iterator();i.hasNext();){var r=i.next();this._dirEdgeList.add(r);var n=r.getSym().getNode();n.isVisited()||t.push(n)}},Dc.prototype.getNodes=function(){return this._nodes},Dc.prototype.getDirectedEdges=function(){return this._dirEdgeList},Dc.prototype.interfaces_=function(){return[Ol]},Dc.prototype.getClass=function(){return Dc},function e(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];this.init(t.length)}else if(Number.isInteger(arguments[0])){var i=arguments[0];this.init(1),this.location[R.ON]=i}else if(arguments[0]instanceof e){var r=arguments[0];if(this.init(r.location.length),null!==r)for(var n=0;n<this.location.length;n++)this.location[n]=r.location[n]}}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.init(3),this.location[R.ON]=o,this.location[R.LEFT]=s,this.location[R.RIGHT]=a}}),Nc=(Fc.prototype.setAllLocations=function(e){for(var t=0;t<this.location.length;t++)this.location[t]=e},Fc.prototype.isNull=function(){for(var e=0;e<this.location.length;e++)if(this.location[e]!==v.NONE)return!1;return!0},Fc.prototype.setAllLocationsIfNull=function(e){for(var t=0;t<this.location.length;t++)this.location[t]===v.NONE&&(this.location[t]=e)},Fc.prototype.isLine=function(){return 1===this.location.length},Fc.prototype.merge=function(e){if(e.location.length>this.location.length){var t=new Array(3).fill(null);t[R.ON]=this.location[R.ON],t[R.LEFT]=v.NONE,t[R.RIGHT]=v.NONE,this.location=t}for(var i=0;i<this.location.length;i++)this.location[i]===v.NONE&&i<e.location.length&&(this.location[i]=e.location[i])},Fc.prototype.getLocations=function(){return this.location},Fc.prototype.flip=function(){if(this.location.length<=1)return null;var e=this.location[R.LEFT];this.location[R.LEFT]=this.location[R.RIGHT],this.location[R.RIGHT]=e},Fc.prototype.toString=function(){var e=new Wl;return this.location.length>1&&e.append(v.toLocationSymbol(this.location[R.LEFT])),e.append(v.toLocationSymbol(this.location[R.ON])),this.location.length>1&&e.append(v.toLocationSymbol(this.location[R.RIGHT])),e.toString()},Fc.prototype.setLocations=function(e,t,i){this.location[R.ON]=e,this.location[R.LEFT]=t,this.location[R.RIGHT]=i},Fc.prototype.get=function(e){return e<this.location.length?this.location[e]:v.NONE},Fc.prototype.isArea=function(){return this.location.length>1},Fc.prototype.isAnyNull=function(){for(var e=0;e<this.location.length;e++)if(this.location[e]===v.NONE)return!0;return!1},Fc.prototype.setLocation=function(){if(1===arguments.length){var e=arguments[0];this.setLocation(R.ON,e)}else if(2===arguments.length){var t=arguments[0],i=arguments[1];this.location[t]=i}},Fc.prototype.init=function(e){this.location=new Array(e).fill(null),this.setAllLocations(v.NONE)},Fc.prototype.isEqualOnSide=function(e,t){return this.location[t]===e.location[t]},Fc.prototype.allPositionsEqual=function(e){for(var t=0;t<this.location.length;t++)if(this.location[t]!==e)return!1;return!0},Fc.prototype.interfaces_=function(){return[]},Fc.prototype.getClass=function(){return Fc},function e(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new Fc(t),this.elt[1]=new Fc(t)}else if(arguments[0]instanceof e){var i=arguments[0];this.elt[0]=new Fc(i.elt[0]),this.elt[1]=new Fc(i.elt[1])}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this.elt[0]=new Fc(v.NONE),this.elt[1]=new Fc(v.NONE),this.elt[r].setLocation(n)}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.elt[0]=new Fc(o,s,a),this.elt[1]=new Fc(o,s,a)}else if(4===arguments.length){var l=arguments[0],u=arguments[1],c=arguments[2],h=arguments[3];this.elt[0]=new Fc(v.NONE,v.NONE,v.NONE),this.elt[1]=new Fc(v.NONE,v.NONE,v.NONE),this.elt[l].setLocations(u,c,h)}}),Oc=(Nc.prototype.getGeometryCount=function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e},Nc.prototype.setAllLocations=function(e,t){this.elt[e].setAllLocations(t)},Nc.prototype.isNull=function(e){return this.elt[e].isNull()},Nc.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(2===arguments.length){var t=arguments[0],i=arguments[1];this.elt[t].setAllLocationsIfNull(i)}},Nc.prototype.isLine=function(e){return this.elt[e].isLine()},Nc.prototype.merge=function(e){for(var t=0;t<2;t++)null===this.elt[t]&&null!==e.elt[t]?this.elt[t]=new Fc(e.elt[t]):this.elt[t].merge(e.elt[t])},Nc.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},Nc.prototype.getLocation=function(){if(1===arguments.length){var e=arguments[0];return this.elt[e].get(R.ON)}if(2===arguments.length){var t=arguments[0],i=arguments[1];return this.elt[t].get(i)}},Nc.prototype.toString=function(){var e=new Wl;return null!==this.elt[0]&&(e.append("A:"),e.append(this.elt[0].toString())),null!==this.elt[1]&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()},Nc.prototype.isArea=function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var e=arguments[0];return this.elt[e].isArea()}},Nc.prototype.isAnyNull=function(e){return this.elt[e].isAnyNull()},Nc.prototype.setLocation=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];this.elt[e].setLocation(R.ON,t)}else if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2];this.elt[i].setLocation(r,n)}},Nc.prototype.isEqualOnSide=function(e,t){return this.elt[0].isEqualOnSide(e.elt[0],t)&&this.elt[1].isEqualOnSide(e.elt[1],t)},Nc.prototype.allPositionsEqual=function(e,t){return this.elt[e].allPositionsEqual(t)},Nc.prototype.toLine=function(e){this.elt[e].isArea()&&(this.elt[e]=new Fc(this.elt[e].location[0]))},Nc.prototype.interfaces_=function(){return[]},Nc.prototype.getClass=function(){return Nc},Nc.toLineLabel=function(e){for(var t=new Nc(v.NONE),i=0;i<2;i++)t.setLocation(i,e.getLocation(i));return t},function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new O,this._pts=new O,this._label=new Nc(v.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new O,this._geometryFactory=null;var e=arguments[0],t=arguments[1];this._geometryFactory=t,this.computePoints(e),this.computeRing()}),Rc=(Oc.prototype.computeRing=function(){if(null!==this._ring)return null;for(var e=new Array(this._pts.size()).fill(null),t=0;t<this._pts.size();t++)e[t]=this._pts.get(t);this._ring=this._geometryFactory.createLinearRing(e),this._isHole=F.isCCW(this._ring.getCoordinates())},Oc.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},Oc.prototype.computePoints=function(e){this._startDe=e;var t=e,i=!0;do{if(null===t)throw new Tc("Found null DirectedEdge");if(t.getEdgeRing()===this)throw new Tc("Directed Edge visited twice during ring-building at "+t.getCoordinate());this._edges.add(t);var r=t.getLabel();D.isTrue(r.isArea()),this.mergeLabel(r),this.addPoints(t.getEdge(),t.isForward(),i),i=!1,this.setEdgeRing(t,this),t=this.getNext(t)}while(t!==this._startDe)},Oc.prototype.getLinearRing=function(){return this._ring},Oc.prototype.getCoordinate=function(e){return this._pts.get(e)},Oc.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var e=this._startDe;do{var t=e.getNode().getEdges().getOutgoingDegree(this);t>this._maxNodeDegree&&(this._maxNodeDegree=t),e=this.getNext(e)}while(e!==this._startDe);this._maxNodeDegree*=2},Oc.prototype.addPoints=function(e,t,i){var r=e.getCoordinates();if(t){var n=1;i&&(n=0);for(var o=n;o<r.length;o++)this._pts.add(r[o])}else{var s=r.length-2;i&&(s=r.length-1);for(var a=s;a>=0;a--)this._pts.add(r[a])}},Oc.prototype.isHole=function(){return this._isHole},Oc.prototype.setInResult=function(){var e=this._startDe;do{e.getEdge().setInResult(!0),e=e.getNext()}while(e!==this._startDe)},Oc.prototype.containsPoint=function(e){var t=this.getLinearRing();if(!t.getEnvelopeInternal().contains(e))return!1;if(!F.isPointInRing(e,t.getCoordinates()))return!1;for(var i=this._holes.iterator();i.hasNext();)if(i.next().containsPoint(e))return!1;return!0},Oc.prototype.addHole=function(e){this._holes.add(e)},Oc.prototype.isShell=function(){return null===this._shell},Oc.prototype.getLabel=function(){return this._label},Oc.prototype.getEdges=function(){return this._edges},Oc.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},Oc.prototype.getShell=function(){return this._shell},Oc.prototype.mergeLabel=function(){if(1===arguments.length){var e=arguments[0];this.mergeLabel(e,0),this.mergeLabel(e,1)}else if(2===arguments.length){var t=arguments[0],i=arguments[1],r=t.getLocation(i,R.RIGHT);if(r===v.NONE)return null;if(this._label.getLocation(i)===v.NONE)return this._label.setLocation(i,r),null}},Oc.prototype.setShell=function(e){this._shell=e,null!==e&&e.addHole(this)},Oc.prototype.toPolygon=function(e){for(var t=new Array(this._holes.size()).fill(null),i=0;i<this._holes.size();i++)t[i]=this._holes.get(i).getLinearRing();return e.createPolygon(this.getLinearRing(),t)},Oc.prototype.interfaces_=function(){return[]},Oc.prototype.getClass=function(){return Oc},function(i){function e(){var e=arguments[0],t=arguments[1];i.call(this,e,t)}return i&&(e.__proto__=i),e.prototype=Object.create(i&&i.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(e,t){e.setMinEdgeRing(t)},e.prototype.getNext=function(e){return e.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Oc)),Uc=function(i){function e(){var e=arguments[0],t=arguments[1];i.call(this,e,t)}return i&&(e.__proto__=i),e.prototype=Object.create(i&&i.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var e=new O,t=this._startDe;do{if(null===t.getMinEdgeRing()){var i=new Rc(t,this._geometryFactory);e.add(i)}t=t.getNext()}while(t!==this._startDe);return e},e.prototype.setEdgeRing=function(e,t){e.setEdgeRing(t)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var e=this._startDe;do{e.getNode().getEdges().linkMinimalDirectedEdges(this),e=e.getNext()}while(e!==this._startDe)},e.prototype.getNext=function(e){return e.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Oc),kc=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this._label=e}},Hc=(kc.prototype.setVisited=function(e){this._isVisited=e},kc.prototype.setInResult=function(e){this._isInResult=e},kc.prototype.isCovered=function(){return this._isCovered},kc.prototype.isCoveredSet=function(){return this._isCoveredSet},kc.prototype.setLabel=function(e){this._label=e},kc.prototype.getLabel=function(){return this._label},kc.prototype.setCovered=function(e){this._isCovered=e,this._isCoveredSet=!0},kc.prototype.updateIM=function(e){D.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(e)},kc.prototype.isInResult=function(){return this._isInResult},kc.prototype.isVisited=function(){return this._isVisited},kc.prototype.interfaces_=function(){return[]},kc.prototype.getClass=function(){return kc},function(i){function n(){i.call(this),this._coord=null,this._edges=null;var e=arguments[0],t=arguments[1];this._coord=e,this._edges=t,this._label=new Nc(0,v.NONE)}return i&&(n.__proto__=i),n.prototype=Object.create(i&&i.prototype),n.prototype.constructor=n,n.prototype.isIncidentEdgeInResult=function(){for(var e=this.getEdges().getEdges().iterator();e.hasNext();)if(e.next().getEdge().isInResult())return!0;return!1},n.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},n.prototype.getCoordinate=function(){return this._coord},n.prototype.print=function(e){e.println("node "+this._coord+" lbl: "+this._label)},n.prototype.computeIM=function(e){},n.prototype.computeMergedLocation=function(e,t){var i=v.NONE;if(i=this._label.getLocation(t),!e.isNull(t)){var r=e.getLocation(t);i!==v.BOUNDARY&&(i=r)}return i},n.prototype.setLabel=function(){if(2!==arguments.length)return i.prototype.setLabel.apply(this,arguments);var e=arguments[0],t=arguments[1];null===this._label?this._label=new Nc(e,t):this._label.setLocation(e,t)},n.prototype.getEdges=function(){return this._edges},n.prototype.mergeLabel=function(){if(arguments[0]instanceof n){var e=arguments[0];this.mergeLabel(e._label)}else if(arguments[0]instanceof Nc)for(var t=arguments[0],i=0;i<2;i++){var r=this.computeMergedLocation(t,i);this._label.getLocation(i)===v.NONE&&this._label.setLocation(i,r)}},n.prototype.add=function(e){this._edges.insert(e),e.setNode(this)},n.prototype.setLabelBoundary=function(e){if(null===this._label)return null;var t=v.NONE;null!==this._label&&(t=this._label.getLocation(e));var i=null;switch(t){case v.BOUNDARY:i=v.INTERIOR;break;case v.INTERIOR:default:i=v.BOUNDARY}this._label.setLocation(e,i)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(kc)),Qc=function(){this.nodeMap=new fo,this.nodeFact=null;var e=arguments[0];this.nodeFact=e},Vc=(Qc.prototype.find=function(e){return this.nodeMap.get(e)},Qc.prototype.addNode=function(){if(arguments[0]instanceof C){var e=arguments[0],t=this.nodeMap.get(e);return null===t&&(t=this.nodeFact.createNode(e),this.nodeMap.put(e,t)),t}if(arguments[0]instanceof Hc){var i=arguments[0],r=this.nodeMap.get(i.getCoordinate());return null===r?(this.nodeMap.put(i.getCoordinate(),i),i):(r.mergeLabel(i),r)}},Qc.prototype.print=function(e){for(var t=this.iterator();t.hasNext();)t.next().print(e)},Qc.prototype.iterator=function(){return this.nodeMap.values().iterator()},Qc.prototype.values=function(){return this.nodeMap.values()},Qc.prototype.getBoundaryNodes=function(e){for(var t=new O,i=this.iterator();i.hasNext();){var r=i.next();r.getLabel().getLocation(e)===v.BOUNDARY&&t.add(r)}return t},Qc.prototype.add=function(e){var t=e.getCoordinate();this.addNode(t).add(e)},Qc.prototype.interfaces_=function(){return[]},Qc.prototype.getClass=function(){return Qc},function(){}),Gc={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}},zc=(Vc.prototype.interfaces_=function(){return[]},Vc.prototype.getClass=function(){return Vc},Vc.isNorthern=function(e){return e===Vc.NE||e===Vc.NW},Vc.isOpposite=function(e,t){if(e===t)return!1;return 2===(e-t+4)%4},Vc.commonHalfPlane=function(e,t){if(e===t)return e;if(2===(e-t+4)%4)return-1;var i=e<t?e:t;return 0===i&&3===(e>t?e:t)?3:i},Vc.isInHalfPlane=function(e,t){return t===Vc.SE?e===Vc.SE||e===Vc.SW:e===t||e===t+1},Vc.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var e=arguments[0],t=arguments[1];if(0===e&&0===t)throw new Fl("Cannot compute the quadrant for point ( "+e+", "+t+" )");return e>=0?t>=0?Vc.NE:Vc.SE:t>=0?Vc.NW:Vc.SW}if(arguments[0]instanceof C&&arguments[1]instanceof C){var i=arguments[0],r=arguments[1];if(r.x===i.x&&r.y===i.y)throw new Fl("Cannot compute the quadrant for two identical points "+i);return r.x>=i.x?r.y>=i.y?Vc.NE:Vc.SE:r.y>=i.y?Vc.NW:Vc.SW}},Gc.NE.get=function(){return 0},Gc.NW.get=function(){return 1},Gc.SW.get=function(){return 2},Gc.SE.get=function(){return 3},Object.defineProperties(Vc,Gc),function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length){var e=arguments[0];this._edge=e}else if(3===arguments.length){var t=arguments[0],i=arguments[1],r=arguments[2];this._edge=t,this.init(i,r),this._label=null}else if(4===arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];this._edge=n,this.init(o,s),this._label=a}}),Wc=(zc.prototype.compareDirection=function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:F.computeOrientation(e._p0,e._p1,this._p1)},zc.prototype.getDy=function(){return this._dy},zc.prototype.getCoordinate=function(){return this._p0},zc.prototype.setNode=function(e){this._node=e},zc.prototype.print=function(e){var t=Math.atan2(this._dy,this._dx),i=this.getClass().getName(),r=i.lastIndexOf("."),n=i.substring(r+1);e.print("  "+n+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label)},zc.prototype.compareTo=function(e){var t=e;return this.compareDirection(t)},zc.prototype.getDirectedCoordinate=function(){return this._p1},zc.prototype.getDx=function(){return this._dx},zc.prototype.getLabel=function(){return this._label},zc.prototype.getEdge=function(){return this._edge},zc.prototype.getQuadrant=function(){return this._quadrant},zc.prototype.getNode=function(){return this._node},zc.prototype.toString=function(){var e=Math.atan2(this._dy,this._dx),t=this.getClass().getName(),i=t.lastIndexOf(".");return"  "+t.substring(i+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label},zc.prototype.computeLabel=function(e){},zc.prototype.init=function(e,t){this._p0=e,this._p1=t,this._dx=t.x-e.x,this._dy=t.y-e.y,this._quadrant=Vc.quadrant(this._dx,this._dy),D.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},zc.prototype.interfaces_=function(){return[Ol]},zc.prototype.getClass=function(){return zc},function(r){function e(){var e=arguments[0],t=arguments[1];if(r.call(this,e),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=t,t)this.init(e.getCoordinate(0),e.getCoordinate(1));else{var i=e.getNumPoints()-1;this.init(e.getCoordinate(i),e.getCoordinate(i-1))}this.computeDirectedLabel()}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(e){return this._depth[e]},e.prototype.setVisited=function(e){this._isVisited=e},e.prototype.computeDirectedLabel=function(){this._label=new Nc(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(e,t){if(-999!==this._depth[e]&&this._depth[e]!==t)throw new Tc("assigned depths do not match",this.getCoordinate());this._depth[e]=t},e.prototype.isInteriorAreaEdge=function(){for(var e=!0,t=0;t<2;t++)this._label.isArea(t)&&this._label.getLocation(t,R.LEFT)===v.INTERIOR&&this._label.getLocation(t,R.RIGHT)===v.INTERIOR||(e=!1);return e},e.prototype.setNextMin=function(e){this._nextMin=e},e.prototype.print=function(e){r.prototype.print.call(this,e),e.print(" "+this._depth[R.LEFT]+"/"+this._depth[R.RIGHT]),e.print(" ("+this.getDepthDelta()+")"),this._isInResult&&e.print(" inResult")},e.prototype.setMinEdgeRing=function(e){this._minEdgeRing=e},e.prototype.isLineEdge=function(){var e=this._label.isLine(0)||this._label.isLine(1),t=!this._label.isArea(0)||this._label.allPositionsEqual(0,v.EXTERIOR),i=!this._label.isArea(1)||this._label.allPositionsEqual(1,v.EXTERIOR);return e&&t&&i},e.prototype.setEdgeRing=function(e){this._edgeRing=e},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var e=this._edge.getDepthDelta();return this._isForward||(e=-e),e},e.prototype.setInResult=function(e){this._isInResult=e},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(e){this.print(e),e.print(" "),this._isForward?this._edge.print(e):this._edge.printReverse(e)},e.prototype.setSym=function(e){this._sym=e},e.prototype.setVisitedEdge=function(e){this.setVisited(e),this._sym.setVisited(e)},e.prototype.setEdgeDepths=function(e,t){var i=this.getEdge().getDepthDelta();this._isForward||(i=-i);var r=1;e===R.LEFT&&(r=-1);var n=R.opposite(e),o=t+i*r;this.setDepth(e,t),this.setDepth(n,o)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(e){this._next=e},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(e,t){return e===v.EXTERIOR&&t===v.INTERIOR?1:e===v.INTERIOR&&t===v.EXTERIOR?-1:0},e}(zc)),qc=function(){},Kc=(qc.prototype.createNode=function(e){return new Hc(e,null)},qc.prototype.interfaces_=function(){return[]},qc.prototype.getClass=function(){return qc},function(){if(this._edges=new O,this._nodes=null,this._edgeEndList=new O,0===arguments.length)this._nodes=new Qc(new qc);else if(1===arguments.length){var e=arguments[0];this._nodes=new Qc(e)}}),jc=(Kc.prototype.printEdges=function(e){e.println("Edges:");for(var t=0;t<this._edges.size();t++){e.println("edge "+t+":");var i=this._edges.get(t);i.print(e),i.eiList.print(e)}},Kc.prototype.find=function(e){return this._nodes.find(e)},Kc.prototype.addNode=function(){if(arguments[0]instanceof Hc){var e=arguments[0];return this._nodes.addNode(e)}if(arguments[0]instanceof C){var t=arguments[0];return this._nodes.addNode(t)}},Kc.prototype.getNodeIterator=function(){return this._nodes.iterator()},Kc.prototype.linkResultDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()},Kc.prototype.debugPrintln=function(e){eu.out.println(e)},Kc.prototype.isBoundaryNode=function(e,t){var i=this._nodes.find(t);if(null===i)return!1;var r=i.getLabel();return null!==r&&r.getLocation(e)===v.BOUNDARY},Kc.prototype.linkAllDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();)e.next().getEdges().linkAllDirectedEdges()},Kc.prototype.matchInSameDirection=function(e,t,i,r){return!!e.equals(i)&&(F.computeOrientation(e,t,r)===F.COLLINEAR&&Vc.quadrant(e,t)===Vc.quadrant(i,r))},Kc.prototype.getEdgeEnds=function(){return this._edgeEndList},Kc.prototype.debugPrint=function(e){eu.out.print(e)},Kc.prototype.getEdgeIterator=function(){return this._edges.iterator()},Kc.prototype.findEdgeInSameDirection=function(e,t){for(var i=0;i<this._edges.size();i++){var r=this._edges.get(i),n=r.getCoordinates();if(this.matchInSameDirection(e,t,n[0],n[1]))return r;if(this.matchInSameDirection(e,t,n[n.length-1],n[n.length-2]))return r}return null},Kc.prototype.insertEdge=function(e){this._edges.add(e)},Kc.prototype.findEdgeEnd=function(e){for(var t=this.getEdgeEnds().iterator();t.hasNext();){var i=t.next();if(i.getEdge()===e)return i}return null},Kc.prototype.addEdges=function(e){for(var t=e.iterator();t.hasNext();){var i=t.next();this._edges.add(i);var r=new Wc(i,!0),n=new Wc(i,!1);r.setSym(n),n.setSym(r),this.add(r),this.add(n)}},Kc.prototype.add=function(e){this._nodes.add(e),this._edgeEndList.add(e)},Kc.prototype.getNodes=function(){return this._nodes.values()},Kc.prototype.findEdge=function(e,t){for(var i=0;i<this._edges.size();i++){var r=this._edges.get(i),n=r.getCoordinates();if(e.equals(n[0])&&t.equals(n[1]))return r}return null},Kc.prototype.interfaces_=function(){return[]},Kc.prototype.getClass=function(){return Kc},Kc.linkResultDirectedEdges=function(e){for(var t=e.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()},function(){this._geometryFactory=null,this._shellList=new O;var e=arguments[0];this._geometryFactory=e}),Zc=(jc.prototype.sortShellsAndHoles=function(e,t,i){for(var r=e.iterator();r.hasNext();){var n=r.next();n.isHole()?i.add(n):t.add(n)}},jc.prototype.computePolygons=function(e){for(var t=new O,i=e.iterator();i.hasNext();){var r=i.next().toPolygon(this._geometryFactory);t.add(r)}return t},jc.prototype.placeFreeHoles=function(e,t){for(var i=t.iterator();i.hasNext();){var r=i.next();if(null===r.getShell()){var n=this.findEdgeRingContaining(r,e);if(null===n)throw new Tc("unable to assign hole to a shell",r.getCoordinate(0));r.setShell(n)}}},jc.prototype.buildMinimalEdgeRings=function(e,t,i){for(var r=new O,n=e.iterator();n.hasNext();){var o=n.next();if(o.getMaxNodeDegree()>2){o.linkDirectedEdgesForMinimalEdgeRings();var s=o.buildMinimalRings(),a=this.findShell(s);null!==a?(this.placePolygonHoles(a,s),t.add(a)):i.addAll(s)}else r.add(o)}return r},jc.prototype.containsPoint=function(e){for(var t=this._shellList.iterator();t.hasNext();)if(t.next().containsPoint(e))return!0;return!1},jc.prototype.buildMaximalEdgeRings=function(e){for(var t=new O,i=e.iterator();i.hasNext();){var r=i.next();if(r.isInResult()&&r.getLabel().isArea()&&null===r.getEdgeRing()){var n=new Uc(r,this._geometryFactory);t.add(n),n.setInResult()}}return t},jc.prototype.placePolygonHoles=function(e,t){for(var i=t.iterator();i.hasNext();){var r=i.next();r.isHole()&&r.setShell(e)}},jc.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},jc.prototype.findEdgeRingContaining=function(e,t){for(var i=e.getLinearRing(),r=i.getEnvelopeInternal(),n=i.getCoordinateN(0),o=null,s=null,a=t.iterator();a.hasNext();){var l=a.next(),u=l.getLinearRing(),c=u.getEnvelopeInternal();null!==o&&(s=o.getLinearRing().getEnvelopeInternal());var h=!1;c.contains(r)&&F.isPointInRing(n,u.getCoordinates())&&(h=!0),h&&(null===o||s.contains(c))&&(o=l)}return o},jc.prototype.findShell=function(e){for(var t=0,i=null,r=e.iterator();r.hasNext();){var n=r.next();n.isHole()||(i=n,t++)}return D.isTrue(t<=1,"found two shells in MinimalEdgeRing list"),i},jc.prototype.add=function(){if(1===arguments.length){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(2===arguments.length){var t=arguments[0],i=arguments[1];Kc.linkResultDirectedEdges(i);var r=this.buildMaximalEdgeRings(t),n=new O,o=this.buildMinimalEdgeRings(r,this._shellList,n);this.sortShellsAndHoles(o,this._shellList,n),this.placeFreeHoles(this._shellList,n)}},jc.prototype.interfaces_=function(){return[]},jc.prototype.getClass=function(){return jc},function(){}),Yc=(Zc.prototype.getBounds=function(){},Zc.prototype.interfaces_=function(){return[]},Zc.prototype.getClass=function(){return Zc},function(){this._bounds=null,this._item=null;var e=arguments[0],t=arguments[1];this._bounds=e,this._item=t}),Xc=(Yc.prototype.getItem=function(){return this._item},Yc.prototype.getBounds=function(){return this._bounds},Yc.prototype.interfaces_=function(){return[Zc,oo]},Yc.prototype.getClass=function(){return Yc},function(){this._size=null,this._items=null,this._size=0,this._items=new O,this._items.add(null)}),Jc=(Xc.prototype.poll=function(){if(this.isEmpty())return null;var e=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),e},Xc.prototype.size=function(){return this._size},Xc.prototype.reorder=function(e){for(var t=null,i=this._items.get(e);2*e<=this._size&&((t=2*e)!==this._size&&this._items.get(t+1).compareTo(this._items.get(t))<0&&t++,this._items.get(t).compareTo(i)<0);e=t)this._items.set(e,this._items.get(t));this._items.set(e,i)},Xc.prototype.clear=function(){this._size=0,this._items.clear()},Xc.prototype.isEmpty=function(){return 0===this._size},Xc.prototype.add=function(e){this._items.add(null),this._size+=1;var t=this._size;for(this._items.set(0,e);e.compareTo(this._items.get(Math.trunc(t/2)))<0;t/=2)this._items.set(t,this._items.get(Math.trunc(t/2)));this._items.set(t,e)},Xc.prototype.interfaces_=function(){return[]},Xc.prototype.getClass=function(){return Xc},function(){}),$c=(Jc.prototype.visitItem=function(e){},Jc.prototype.interfaces_=function(){return[]},Jc.prototype.getClass=function(){return Jc},function(){}),eh=($c.prototype.insert=function(e,t){},$c.prototype.remove=function(e,t){},$c.prototype.query=function(){},$c.prototype.interfaces_=function(){return[]},$c.prototype.getClass=function(){return $c},function(){if(this._childBoundables=new O,this._bounds=null,this._level=null,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this._level=e}}),th={serialVersionUID:{configurable:!0}},ih=(eh.prototype.getLevel=function(){return this._level},eh.prototype.size=function(){return this._childBoundables.size()},eh.prototype.getChildBoundables=function(){return this._childBoundables},eh.prototype.addChildBoundable=function(e){D.isTrue(null===this._bounds),this._childBoundables.add(e)},eh.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},eh.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},eh.prototype.interfaces_=function(){return[Zc,oo]},eh.prototype.getClass=function(){return eh},th.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(eh,th),function(){}),rh=(ih.reverseOrder=function(){return{compare:function(e,t){return t.compareTo(e)}}},ih.min=function(e){return ih.sort(e),e.get(0)},ih.sort=function(e,t){var i=e.toArray();t?Vu.sort(i,t):Vu.sort(i);for(var r=e.iterator(),n=0,o=i.length;n<o;n++)r.next(),r.set(i[n])},ih.singletonList=function(e){var t=new O;return t.add(e),t},function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var e=arguments[0],t=arguments[1],i=arguments[2];this._boundable1=e,this._boundable2=t,this._itemDistance=i,this._distance=this.distance()}),nh=(rh.prototype.expandToQueue=function(e,t){var i=rh.isComposite(this._boundable1),r=rh.isComposite(this._boundable2);if(i&&r)return rh.area(this._boundable1)>rh.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,e,t),null):(this.expand(this._boundable2,this._boundable1,e,t),null);if(i)return this.expand(this._boundable1,this._boundable2,e,t),null;if(r)return this.expand(this._boundable2,this._boundable1,e,t),null;throw new Fl("neither boundable is composite")},rh.prototype.isLeaves=function(){return!(rh.isComposite(this._boundable1)||rh.isComposite(this._boundable2))},rh.prototype.compareTo=function(e){var t=e;return this._distance<t._distance?-1:this._distance>t._distance?1:0},rh.prototype.expand=function(e,t,i,r){for(var n=e.getChildBoundables().iterator();n.hasNext();){var o=n.next(),s=new rh(o,t,this._itemDistance);s.getDistance()<r&&i.add(s)}},rh.prototype.getBoundable=function(e){return 0===e?this._boundable1:this._boundable2},rh.prototype.getDistance=function(){return this._distance},rh.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},rh.prototype.interfaces_=function(){return[Ol]},rh.prototype.getClass=function(){return rh},rh.area=function(e){return e.getBounds().getArea()},rh.isComposite=function(e){return e instanceof eh},function e(){if(this._root=null,this._built=!1,this._itemBoundables=new O,this._nodeCapacity=null,0===arguments.length){var t=e.DEFAULT_NODE_CAPACITY;this._nodeCapacity=t}else if(1===arguments.length){var i=arguments[0];D.isTrue(i>1,"Node capacity must be greater than 1"),this._nodeCapacity=i}}),oh={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}},sh=(nh.prototype.getNodeCapacity=function(){return this._nodeCapacity},nh.prototype.lastNode=function(e){return e.get(e.size()-1)},nh.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var e=0,t=arguments[0].getChildBoundables().iterator();t.hasNext();){var i=t.next();i instanceof eh?e+=this.size(i):i instanceof Yc&&(e+=1)}return e}},nh.prototype.removeItem=function(e,t){for(var i=null,r=e.getChildBoundables().iterator();r.hasNext();){var n=r.next();n instanceof Yc&&n.getItem()===t&&(i=n)}return null!==i&&(e.getChildBoundables().remove(i),!0)},nh.prototype.itemsTree=function(){if(0===arguments.length){this.build();var e=this.itemsTree(this._root);return null===e?new O:e}if(1===arguments.length){for(var t=arguments[0],i=new O,r=t.getChildBoundables().iterator();r.hasNext();){var n=r.next();if(n instanceof eh){var o=this.itemsTree(n);null!==o&&i.add(o)}else n instanceof Yc?i.add(n.getItem()):D.shouldNeverReachHere()}return i.size()<=0?null:i}},nh.prototype.insert=function(e,t){D.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Yc(e,t))},nh.prototype.boundablesAtLevel=function(){if(1===arguments.length){var e=arguments[0],t=new O;return this.boundablesAtLevel(e,this._root,t),t}if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2];if(D.isTrue(i>-2),r.getLevel()===i)return n.add(r),null;for(var o=r.getChildBoundables().iterator();o.hasNext();){var s=o.next();s instanceof eh?this.boundablesAtLevel(i,s,n):(D.isTrue(s instanceof Yc),-1===i&&n.add(s))}return null}},nh.prototype.query=function(){if(1===arguments.length){var e=arguments[0];this.build();var t=new O;return this.isEmpty()?t:(this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.query(e,this._root,t),t)}if(2===arguments.length){var i=arguments[0],r=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),i)&&this.query(i,this._root,r)}else if(3===arguments.length)if(w(arguments[2],Jc)&&arguments[0]instanceof Object&&arguments[1]instanceof eh)for(var n=arguments[0],o=arguments[1],s=arguments[2],a=o.getChildBoundables(),l=0;l<a.size();l++){var u=a.get(l);this.getIntersectsOp().intersects(u.getBounds(),n)&&(u instanceof eh?this.query(n,u,s):u instanceof Yc?s.visitItem(u.getItem()):D.shouldNeverReachHere())}else if(w(arguments[2],Su)&&arguments[0]instanceof Object&&arguments[1]instanceof eh)for(var c=arguments[0],h=arguments[1],A=arguments[2],p=h.getChildBoundables(),f=0;f<p.size();f++){var d=p.get(f);this.getIntersectsOp().intersects(d.getBounds(),c)&&(d instanceof eh?this.query(c,d,A):d instanceof Yc?A.add(d.getItem()):D.shouldNeverReachHere())}},nh.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},nh.prototype.getRoot=function(){return this.build(),this._root},nh.prototype.remove=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.remove(e,this._root,t)}if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2],o=this.removeItem(r,n);if(o)return!0;for(var s=null,a=r.getChildBoundables().iterator();a.hasNext();){var l=a.next();if(this.getIntersectsOp().intersects(l.getBounds(),i)&&(l instanceof eh&&(o=this.remove(i,l,n)))){s=l;break}}return null!==s&&s.getChildBoundables().isEmpty()&&r.getChildBoundables().remove(s),o}},nh.prototype.createHigherLevels=function(e,t){D.isTrue(!e.isEmpty());var i=this.createParentBoundables(e,t+1);return 1===i.size()?i.get(0):this.createHigherLevels(i,t+1)},nh.prototype.depth=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var e=0,t=arguments[0].getChildBoundables().iterator();t.hasNext();){var i=t.next();if(i instanceof eh){var r=this.depth(i);r>e&&(e=r)}}return e+1}},nh.prototype.createParentBoundables=function(e,t){D.isTrue(!e.isEmpty());var i=new O;i.add(this.createNode(t));var r=new O(e);ih.sort(r,this.getComparator());for(var n=r.iterator();n.hasNext();){var o=n.next();this.lastNode(i).getChildBoundables().size()===this.getNodeCapacity()&&i.add(this.createNode(t)),this.lastNode(i).addChildBoundable(o)}return i},nh.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},nh.prototype.interfaces_=function(){return[oo]},nh.prototype.getClass=function(){return nh},nh.compareDoubles=function(e,t){return e>t?1:e<t?-1:0},oh.IntersectsOp.get=function(){return sh},oh.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},oh.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(nh,oh),function(){}),ah=function(){},lh=(ah.prototype.distance=function(e,t){},ah.prototype.interfaces_=function(){return[]},ah.prototype.getClass=function(){return ah},function(u){function m(e){e=e||m.DEFAULT_NODE_CAPACITY,u.call(this,e)}u&&(m.__proto__=u),(m.prototype=Object.create(u&&u.prototype)).constructor=m;var e={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return m.prototype.createParentBoundablesFromVerticalSlices=function(e,t){D.isTrue(e.length>0);for(var i=new O,r=0;r<e.length;r++)i.addAll(this.createParentBoundablesFromVerticalSlice(e[r],t));return i},m.prototype.createNode=function(e){return new uh(e)},m.prototype.size=function(){return 0===arguments.length?u.prototype.size.call(this):u.prototype.size.apply(this,arguments)},m.prototype.insert=function(){if(2!==arguments.length)return u.prototype.insert.apply(this,arguments);var e=arguments[0],t=arguments[1];if(e.isNull())return null;u.prototype.insert.call(this,e,t)},m.prototype.getIntersectsOp=function(){return m.intersectsOp},m.prototype.verticalSlices=function(e,t){for(var i=Math.trunc(Math.ceil(e.size()/t)),r=new Array(t).fill(null),n=e.iterator(),o=0;o<t;o++){r[o]=new O;for(var s=0;n.hasNext()&&s<i;){var a=n.next();r[o].add(a),s++}}return r},m.prototype.query=function(){if(1===arguments.length){var e=arguments[0];return u.prototype.query.call(this,e)}if(2===arguments.length){var t=arguments[0],i=arguments[1];u.prototype.query.call(this,t,i)}else if(3===arguments.length)if(w(arguments[2],Jc)&&arguments[0]instanceof Object&&arguments[1]instanceof eh){var r=arguments[0],n=arguments[1],o=arguments[2];u.prototype.query.call(this,r,n,o)}else if(w(arguments[2],Su)&&arguments[0]instanceof Object&&arguments[1]instanceof eh){var s=arguments[0],a=arguments[1],l=arguments[2];u.prototype.query.call(this,s,a,l)}},m.prototype.getComparator=function(){return m.yComparator},m.prototype.createParentBoundablesFromVerticalSlice=function(e,t){return u.prototype.createParentBoundables.call(this,e,t)},m.prototype.remove=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return u.prototype.remove.call(this,e,t)}return u.prototype.remove.apply(this,arguments)},m.prototype.depth=function(){return 0===arguments.length?u.prototype.depth.call(this):u.prototype.depth.apply(this,arguments)},m.prototype.createParentBoundables=function(e,t){D.isTrue(!e.isEmpty());var i=Math.trunc(Math.ceil(e.size()/this.getNodeCapacity())),r=new O(e);ih.sort(r,m.xComparator);var n=this.verticalSlices(r,Math.trunc(Math.ceil(Math.sqrt(i))));return this.createParentBoundablesFromVerticalSlices(n,t)},m.prototype.nearestNeighbour=function(){if(1===arguments.length){if(w(arguments[0],ah)){var e=arguments[0],t=new rh(this.getRoot(),this.getRoot(),e);return this.nearestNeighbour(t)}if(arguments[0]instanceof rh){var i=arguments[0];return this.nearestNeighbour(i,_.POSITIVE_INFINITY)}}else if(2===arguments.length){if(arguments[0]instanceof m&&w(arguments[1],ah)){var r=arguments[0],n=arguments[1],o=new rh(this.getRoot(),r.getRoot(),n);return this.nearestNeighbour(o)}if(arguments[0]instanceof rh&&"number"==typeof arguments[1]){var s=arguments[0],a=arguments[1],l=null,u=new Xc;for(u.add(s);!u.isEmpty()&&a>0;){var c=u.poll(),h=c.getDistance();if(h>=a)break;c.isLeaves()?(a=h,l=c):c.expandToQueue(u,a)}return[l.getBoundable(0).getItem(),l.getBoundable(1).getItem()]}}else if(3===arguments.length){var A=arguments[0],p=arguments[1],f=arguments[2],d=new Yc(A,p),g=new rh(this.getRoot(),d,f);return this.nearestNeighbour(g)[0]}},m.prototype.interfaces_=function(){return[$c,oo]},m.prototype.getClass=function(){return m},m.centreX=function(e){return m.avg(e.getMinX(),e.getMaxX())},m.avg=function(e,t){return(e+t)/2},m.centreY=function(e){return m.avg(e.getMinY(),e.getMaxY())},e.STRtreeNode.get=function(){return uh},e.serialVersionUID.get=function(){return 0x39920f7d5f261e0},e.xComparator.get=function(){return{interfaces_:function(){return[Ul]},compare:function(e,t){return u.compareDoubles(m.centreX(e.getBounds()),m.centreX(t.getBounds()))}}},e.yComparator.get=function(){return{interfaces_:function(){return[Ul]},compare:function(e,t){return u.compareDoubles(m.centreY(e.getBounds()),m.centreY(t.getBounds()))}}},e.intersectsOp.get=function(){return{interfaces_:function(){return[u.IntersectsOp]},intersects:function(e,t){return e.intersects(t)}}},e.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(m,e),m}(nh)),uh=function(t){function e(){var e=arguments[0];t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var e=null,t=this.getChildBoundables().iterator();t.hasNext();){var i=t.next();null===e?e=new u(i.getBounds()):e.expandToInclude(i.getBounds())}return e},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(eh),ch=function(){},hh=(ch.prototype.interfaces_=function(){return[]},ch.prototype.getClass=function(){return ch},ch.relativeSign=function(e,t){return e<t?-1:e>t?1:0},ch.compare=function(e,t,i){if(t.equals2D(i))return 0;var r=ch.relativeSign(t.x,i.x),n=ch.relativeSign(t.y,i.y);switch(e){case 0:return ch.compareValue(r,n);case 1:return ch.compareValue(n,r);case 2:return ch.compareValue(n,-r);case 3:return ch.compareValue(-r,n);case 4:return ch.compareValue(-r,-n);case 5:return ch.compareValue(-n,-r);case 6:return ch.compareValue(-n,r);case 7:return ch.compareValue(r,-n)}return D.shouldNeverReachHere("invalid octant value"),0},ch.compareValue=function(e,t){return e<0?-1:e>0?1:t<0?-1:t>0?1:0},function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3];this._segString=e,this.coord=new C(t),this.segmentIndex=i,this._segmentOctant=r,this._isInterior=!t.equals2D(e.getCoordinate(i))}),Ah=(hh.prototype.getCoordinate=function(){return this.coord},hh.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)},hh.prototype.compareTo=function(e){var t=e;return this.segmentIndex<t.segmentIndex?-1:this.segmentIndex>t.segmentIndex?1:this.coord.equals2D(t.coord)?0:ch.compare(this._segmentOctant,this.coord,t.coord)},hh.prototype.isEndPoint=function(e){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===e},hh.prototype.isInterior=function(){return this._isInterior},hh.prototype.interfaces_=function(){return[Ol]},hh.prototype.getClass=function(){return hh},function(){this._nodeMap=new fo,this._edge=null;var e=arguments[0];this._edge=e}),ph=(Ah.prototype.getSplitCoordinates=function(){var e=new Tu;this.addEndpoints();for(var t=this.iterator(),i=t.next();t.hasNext();){var r=t.next();this.addEdgeCoordinates(i,r,e),i=r}return e.toCoordinateArray()},Ah.prototype.addCollapsedNodes=function(){var e=new O;this.findCollapsesFromInsertedNodes(e),this.findCollapsesFromExistingVertices(e);for(var t=e.iterator();t.hasNext();){var i=t.next().intValue();this.add(this._edge.getCoordinate(i),i)}},Ah.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();)t.next().print(e)},Ah.prototype.findCollapsesFromExistingVertices=function(e){for(var t=0;t<this._edge.size()-2;t++){var i=this._edge.getCoordinate(t),r=this._edge.getCoordinate(t+2);i.equals2D(r)&&e.add(new ql(t+1))}},Ah.prototype.addEdgeCoordinates=function(e,t,i){var r=this._edge.getCoordinate(t.segmentIndex),n=t.isInterior()||!t.coord.equals2D(r);i.add(new C(e.coord),!1);for(var o=e.segmentIndex+1;o<=t.segmentIndex;o++)i.add(this._edge.getCoordinate(o));n&&i.add(new C(t.coord))},Ah.prototype.iterator=function(){return this._nodeMap.values().iterator()},Ah.prototype.addSplitEdges=function(e){this.addEndpoints(),this.addCollapsedNodes();for(var t=this.iterator(),i=t.next();t.hasNext();){var r=t.next(),n=this.createSplitEdge(i,r);e.add(n),i=r}},Ah.prototype.findCollapseIndex=function(e,t,i){if(!e.coord.equals2D(t.coord))return!1;var r=t.segmentIndex-e.segmentIndex;return t.isInterior()||r--,1===r&&(i[0]=e.segmentIndex+1,!0)},Ah.prototype.findCollapsesFromInsertedNodes=function(e){for(var t=new Array(1).fill(null),i=this.iterator(),r=i.next();i.hasNext();){var n=i.next();this.findCollapseIndex(r,n,t)&&e.add(new ql(t[0])),r=n}},Ah.prototype.getEdge=function(){return this._edge},Ah.prototype.addEndpoints=function(){var e=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(e),e)},Ah.prototype.createSplitEdge=function(e,t){var i=t.segmentIndex-e.segmentIndex+2,r=this._edge.getCoordinate(t.segmentIndex),n=t.isInterior()||!t.coord.equals2D(r);n||i--;var o=new Array(i).fill(null),s=0;o[s++]=new C(e.coord);for(var a=e.segmentIndex+1;a<=t.segmentIndex;a++)o[s++]=this._edge.getCoordinate(a);return n&&(o[s]=new C(t.coord)),new gh(o,this._edge.getData())},Ah.prototype.add=function(e,t){var i=new hh(this._edge,e,t,this._edge.getSegmentOctant(t)),r=this._nodeMap.get(i);return null!==r?(D.isTrue(r.coord.equals2D(e),"Found equal nodes with different coordinates"),r):(this._nodeMap.put(i,i),i)},Ah.prototype.checkSplitEdgesCorrectness=function(e){var t=this._edge.getCoordinates(),i=e.get(0).getCoordinate(0);if(!i.equals2D(t[0]))throw new lu("bad split edge start point at "+i);var r=e.get(e.size()-1).getCoordinates(),n=r[r.length-1];if(!n.equals2D(t[t.length-1]))throw new lu("bad split edge end point at "+n)},Ah.prototype.interfaces_=function(){return[]},Ah.prototype.getClass=function(){return Ah},function(){}),fh=(ph.prototype.interfaces_=function(){return[]},ph.prototype.getClass=function(){return ph},ph.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var e=arguments[0],t=arguments[1];if(0===e&&0===t)throw new Fl("Cannot compute the octant for point ( "+e+", "+t+" )");var i=Math.abs(e),r=Math.abs(t);return e>=0?t>=0?i>=r?0:1:i>=r?7:6:t>=0?i>=r?3:2:i>=r?4:5}if(arguments[0]instanceof C&&arguments[1]instanceof C){var n=arguments[0],o=arguments[1],s=o.x-n.x,a=o.y-n.y;if(0===s&&0===a)throw new Fl("Cannot compute the octant for two identical points "+n);return ph.octant(s,a)}},function(){}),dh=(fh.prototype.getCoordinates=function(){},fh.prototype.size=function(){},fh.prototype.getCoordinate=function(e){},fh.prototype.isClosed=function(){},fh.prototype.setData=function(e){},fh.prototype.getData=function(){},fh.prototype.interfaces_=function(){return[]},fh.prototype.getClass=function(){return fh},function(){}),gh=(dh.prototype.addIntersection=function(e,t){},dh.prototype.interfaces_=function(){return[fh]},dh.prototype.getClass=function(){return dh},function(){this._nodeList=new Ah(this),this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t}),U=(gh.prototype.getCoordinates=function(){return this._pts},gh.prototype.size=function(){return this._pts.length},gh.prototype.getCoordinate=function(e){return this._pts[e]},gh.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},gh.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))},gh.prototype.setData=function(e){this._data=e},gh.prototype.safeOctant=function(e,t){return e.equals2D(t)?0:ph.octant(e,t)},gh.prototype.getData=function(){return this._data},gh.prototype.addIntersection=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];this.addIntersectionNode(e,t)}else if(4===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[3],o=new C(i.getIntersection(n));this.addIntersection(o,r)}},gh.prototype.toString=function(){return au.toLineString(new pc(this._pts))},gh.prototype.getNodeList=function(){return this._nodeList},gh.prototype.addIntersectionNode=function(e,t){var i=t,r=i+1;if(r<this._pts.length){var n=this._pts[r];e.equals2D(n)&&(i=r)}return this._nodeList.add(e,i)},gh.prototype.addIntersections=function(e,t,i){for(var r=0;r<e.getIntersectionNum();r++)this.addIntersection(e,t,i,r)},gh.prototype.interfaces_=function(){return[dh]},gh.prototype.getClass=function(){return gh},gh.getNodedSubstrings=function(){if(1===arguments.length){var e=arguments[0],t=new O;return gh.getNodedSubstrings(e,t),t}if(2===arguments.length)for(var i=arguments[0],r=arguments[1],n=i.iterator();n.hasNext();)n.next().getNodeList().addSplitEdges(r)},function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new C,this.p1=new C;else if(1===arguments.length){var e=arguments[0];this.p0=new C(e.p0),this.p1=new C(e.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var t=arguments[0],i=arguments[1],r=arguments[2],n=arguments[3];this.p0=new C(t,i),this.p1=new C(r,n)}}),mh={serialVersionUID:{configurable:!0}},yh=(U.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},U.prototype.orientationIndex=function(){if(arguments[0]instanceof U){var e=arguments[0],t=F.orientationIndex(this.p0,this.p1,e.p0),i=F.orientationIndex(this.p0,this.p1,e.p1);return t>=0&&i>=0?Math.max(t,i):t<=0&&i<=0?Math.max(t,i):0}if(arguments[0]instanceof C){var r=arguments[0];return F.orientationIndex(this.p0,this.p1,r)}},U.prototype.toGeometry=function(e){return e.createLineString([this.p0,this.p1])},U.prototype.isVertical=function(){return this.p0.x===this.p1.x},U.prototype.equals=function(e){if(!(e instanceof U))return!1;var t=e;return this.p0.equals(t.p0)&&this.p1.equals(t.p1)},U.prototype.intersection=function(e){var t=new Au;return t.computeIntersection(this.p0,this.p1,e.p0,e.p1),t.hasIntersection()?t.getIntersection(0):null},U.prototype.project=function(){if(arguments[0]instanceof C){var e=arguments[0];if(e.equals(this.p0)||e.equals(this.p1))return new C(e);var t=this.projectionFactor(e),i=new C;return i.x=this.p0.x+t*(this.p1.x-this.p0.x),i.y=this.p0.y+t*(this.p1.y-this.p0.y),i}if(arguments[0]instanceof U){var r=arguments[0],n=this.projectionFactor(r.p0),o=this.projectionFactor(r.p1);if(n>=1&&o>=1)return null;if(n<=0&&o<=0)return null;var s=this.project(r.p0);n<0&&(s=this.p0),n>1&&(s=this.p1);var a=this.project(r.p1);return o<0&&(a=this.p0),o>1&&(a=this.p1),new U(s,a)}},U.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},U.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},U.prototype.getCoordinate=function(e){return 0===e?this.p0:this.p1},U.prototype.distancePerpendicular=function(e){return F.distancePointLinePerpendicular(e,this.p0,this.p1)},U.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},U.prototype.midPoint=function(){return U.midPoint(this.p0,this.p1)},U.prototype.projectionFactor=function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var t=this.p1.x-this.p0.x,i=this.p1.y-this.p0.y,r=t*t+i*i;if(r<=0)return _.NaN;return((e.x-this.p0.x)*t+(e.y-this.p0.y)*i)/r},U.prototype.closestPoints=function(e){var t=this.intersection(e);if(null!==t)return[t,t];var i=new Array(2).fill(null),r=_.MAX_VALUE,n=null,o=this.closestPoint(e.p0);r=o.distance(e.p0),i[0]=o,i[1]=e.p0;var s=this.closestPoint(e.p1);(n=s.distance(e.p1))<r&&(r=n,i[0]=s,i[1]=e.p1);var a=e.closestPoint(this.p0);(n=a.distance(this.p0))<r&&(r=n,i[0]=this.p0,i[1]=a);var l=e.closestPoint(this.p1);return(n=l.distance(this.p1))<r&&(r=n,i[0]=this.p1,i[1]=l),i},U.prototype.closestPoint=function(e){var t=this.projectionFactor(e);if(t>0&&t<1)return this.project(e);return this.p0.distance(e)<this.p1.distance(e)?this.p0:this.p1},U.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},U.prototype.getLength=function(){return this.p0.distance(this.p1)},U.prototype.compareTo=function(e){var t=e,i=this.p0.compareTo(t.p0);return 0!==i?i:this.p1.compareTo(t.p1)},U.prototype.reverse=function(){var e=this.p0;this.p0=this.p1,this.p1=e},U.prototype.equalsTopo=function(e){return this.p0.equals(e.p0)&&(this.p1.equals(e.p1)||this.p0.equals(e.p1))&&this.p1.equals(e.p0)},U.prototype.lineIntersection=function(e){try{return tu.intersection(this.p0,this.p1,e.p0,e.p1)}catch(e){if(!(e instanceof $l))throw e}return null},U.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},U.prototype.pointAlongOffset=function(e,t){var i=this.p0.x+e*(this.p1.x-this.p0.x),r=this.p0.y+e*(this.p1.y-this.p0.y),n=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,s=Math.sqrt(n*n+o*o),a=0,l=0;if(0!==t){if(s<=0)throw new Error("Cannot compute offset from zero-length line segment");a=t*n/s,l=t*o/s}return new C(i-l,r+a)},U.prototype.setCoordinates=function(){if(1===arguments.length){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(2===arguments.length){var t=arguments[0],i=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=i.x,this.p1.y=i.y}},U.prototype.segmentFraction=function(e){var t=this.projectionFactor(e);return t<0?t=0:(t>1||_.isNaN(t))&&(t=1),t},U.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},U.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},U.prototype.distance=function(){if(arguments[0]instanceof U){var e=arguments[0];return F.distanceLineLine(this.p0,this.p1,e.p0,e.p1)}if(arguments[0]instanceof C){var t=arguments[0];return F.distancePointLine(t,this.p0,this.p1)}},U.prototype.pointAlong=function(e){var t=new C;return t.x=this.p0.x+e*(this.p1.x-this.p0.x),t.y=this.p0.y+e*(this.p1.y-this.p0.y),t},U.prototype.hashCode=function(){var e=_.doubleToLongBits(this.p0.x);e^=31*_.doubleToLongBits(this.p0.y);var t=Math.trunc(e)^Math.trunc(e>>32),i=_.doubleToLongBits(this.p1.x);i^=31*_.doubleToLongBits(this.p1.y);return t^(Math.trunc(i)^Math.trunc(i>>32))},U.prototype.interfaces_=function(){return[Ol,oo]},U.prototype.getClass=function(){return U},U.midPoint=function(e,t){return new C((e.x+t.x)/2,(e.y+t.y)/2)},mh.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(U,mh),function(){this.tempEnv1=new u,this.tempEnv2=new u,this._overlapSeg1=new U,this._overlapSeg2=new U}),_h=(yh.prototype.overlap=function(){if(2===arguments.length);else if(4===arguments.length){var e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3];e.getLineSegment(t,this._overlapSeg1),i.getLineSegment(r,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},yh.prototype.interfaces_=function(){return[]},yh.prototype.getClass=function(){return yh},function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3];this._pts=e,this._start=t,this._end=i,this._context=r}),vh=(_h.prototype.getLineSegment=function(e,t){t.p0=this._pts[e],t.p1=this._pts[e+1]},_h.prototype.computeSelect=function(e,t,i,r){var n=this._pts[t],o=this._pts[i];if(r.tempEnv1.init(n,o),i-t==1)return r.select(this,t),null;if(!e.intersects(r.tempEnv1))return null;var s=Math.trunc((t+i)/2);t<s&&this.computeSelect(e,t,s,r),s<i&&this.computeSelect(e,s,i,r)},_h.prototype.getCoordinates=function(){for(var e=new Array(this._end-this._start+1).fill(null),t=0,i=this._start;i<=this._end;i++)e[t++]=this._pts[i];return e},_h.prototype.computeOverlaps=function(e,t){this.computeOverlapsInternal(this._start,this._end,e,e._start,e._end,t)},_h.prototype.setId=function(e){this._id=e},_h.prototype.select=function(e,t){this.computeSelect(e,this._start,this._end,t)},_h.prototype.getEnvelope=function(){if(null===this._env){var e=this._pts[this._start],t=this._pts[this._end];this._env=new u(e,t)}return this._env},_h.prototype.getEndIndex=function(){return this._end},_h.prototype.getStartIndex=function(){return this._start},_h.prototype.getContext=function(){return this._context},_h.prototype.getId=function(){return this._id},_h.prototype.computeOverlapsInternal=function(e,t,i,r,n,o){var s=this._pts[e],a=this._pts[t],l=i._pts[r],u=i._pts[n];if(t-e==1&&n-r==1)return o.overlap(this,e,i,r),null;if(o.tempEnv1.init(s,a),o.tempEnv2.init(l,u),!o.tempEnv1.intersects(o.tempEnv2))return null;var c=Math.trunc((e+t)/2),h=Math.trunc((r+n)/2);e<c&&(r<h&&this.computeOverlapsInternal(e,c,i,r,h,o),h<n&&this.computeOverlapsInternal(e,c,i,h,n,o)),c<t&&(r<h&&this.computeOverlapsInternal(c,t,i,r,h,o),h<n&&this.computeOverlapsInternal(c,t,i,h,n,o))},_h.prototype.interfaces_=function(){return[]},_h.prototype.getClass=function(){return _h},function(){}),Ch=(vh.prototype.interfaces_=function(){return[]},vh.prototype.getClass=function(){return vh},vh.getChainStartIndices=function(e){var t=0,i=new O;i.add(new ql(t));do{var r=vh.findChainEnd(e,t);i.add(new ql(r)),t=r}while(t<e.length-1);return vh.toIntArray(i)},vh.findChainEnd=function(e,t){for(var i=t;i<e.length-1&&e[i].equals2D(e[i+1]);)i++;if(i>=e.length-1)return e.length-1;for(var r=Vc.quadrant(e[i],e[i+1]),n=t+1;n<e.length;){if(!e[n-1].equals2D(e[n]))if(Vc.quadrant(e[n-1],e[n])!==r)break;n++}return n-1},vh.getChains=function(){if(1===arguments.length){var e=arguments[0];return vh.getChains(e,null)}if(2===arguments.length){for(var t=arguments[0],i=arguments[1],r=new O,n=vh.getChainStartIndices(t),o=0;o<n.length-1;o++){var s=new _h(t,n[o],n[o+1],i);r.add(s)}return r}},vh.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),i=0;i<t.length;i++)t[i]=e.get(i).intValue();return t},function(){}),wh=(Ch.prototype.computeNodes=function(e){},Ch.prototype.getNodedSubstrings=function(){},Ch.prototype.interfaces_=function(){return[]},Ch.prototype.getClass=function(){return Ch},function(){if(this._segInt=null,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.setSegmentIntersector(e)}}),xh=(wh.prototype.setSegmentIntersector=function(e){this._segInt=e},wh.prototype.interfaces_=function(){return[Ch]},wh.prototype.getClass=function(){return wh},function(t){function e(e){e?t.call(this,e):t.call(this),this._monoChains=new O,this._index=new lh,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return gh.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(e){for(var t=vh.getChains(e.getCoordinates(),e).iterator();t.hasNext();){var i=t.next();i.setId(this._idCounter++),this._index.insert(i.getEnvelope(),i),this._monoChains.add(i)}},e.prototype.computeNodes=function(e){this._nodedSegStrings=e;for(var t=e.iterator();t.hasNext();)this.add(t.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var e=new bh(this._segInt),t=this._monoChains.iterator();t.hasNext();)for(var i=t.next(),r=this._index.query(i.getEnvelope()).iterator();r.hasNext();){var n=r.next();if(n.getId()>i.getId()&&(i.computeOverlaps(n,e),this._nOverlaps++),this._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},i.SegmentOverlapAction.get=function(){return bh},Object.defineProperties(e,i),e}(wh)),bh=function(s){function e(){s.call(this),this._si=null;var e=arguments[0];this._si=e}return s&&(e.__proto__=s),e.prototype=Object.create(s&&s.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(4!==arguments.length)return s.prototype.overlap.apply(this,arguments);var e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3],n=e.getContext(),o=i.getContext();this._si.processIntersections(n,t,o,r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(yh),Eh=function e(){if(this._quadrantSegments=e.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=e.CAP_ROUND,this._joinStyle=e.JOIN_ROUND,this._mitreLimit=e.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=e.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setQuadrantSegments(t)}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.setQuadrantSegments(i),this.setEndCapStyle(r)}else if(4===arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];this.setQuadrantSegments(n),this.setEndCapStyle(o),this.setJoinStyle(s),this.setMitreLimit(a)}},Bh={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}},Mh=(Eh.prototype.getEndCapStyle=function(){return this._endCapStyle},Eh.prototype.isSingleSided=function(){return this._isSingleSided},Eh.prototype.setQuadrantSegments=function(e){this._quadrantSegments=e,0===this._quadrantSegments&&(this._joinStyle=Eh.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Eh.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),e<=0&&(this._quadrantSegments=1),this._joinStyle!==Eh.JOIN_ROUND&&(this._quadrantSegments=Eh.DEFAULT_QUADRANT_SEGMENTS)},Eh.prototype.getJoinStyle=function(){return this._joinStyle},Eh.prototype.setJoinStyle=function(e){this._joinStyle=e},Eh.prototype.setSimplifyFactor=function(e){this._simplifyFactor=e<0?0:e},Eh.prototype.getSimplifyFactor=function(){return this._simplifyFactor},Eh.prototype.getQuadrantSegments=function(){return this._quadrantSegments},Eh.prototype.setEndCapStyle=function(e){this._endCapStyle=e},Eh.prototype.getMitreLimit=function(){return this._mitreLimit},Eh.prototype.setMitreLimit=function(e){this._mitreLimit=e},Eh.prototype.setSingleSided=function(e){this._isSingleSided=e},Eh.prototype.interfaces_=function(){return[]},Eh.prototype.getClass=function(){return Eh},Eh.bufferDistanceError=function(e){var t=Math.PI/2/e;return 1-Math.cos(t/2)},Bh.CAP_ROUND.get=function(){return 1},Bh.CAP_FLAT.get=function(){return 2},Bh.CAP_SQUARE.get=function(){return 3},Bh.JOIN_ROUND.get=function(){return 1},Bh.JOIN_MITRE.get=function(){return 2},Bh.JOIN_BEVEL.get=function(){return 3},Bh.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},Bh.DEFAULT_MITRE_LIMIT.get=function(){return 5},Bh.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(Eh,Bh),function(e){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=F.COUNTERCLOCKWISE,this._inputLine=e||null}),Ih={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}},Sh=(Mh.prototype.isDeletable=function(e,t,i,r){var n=this._inputLine[e],o=this._inputLine[t],s=this._inputLine[i];return!!this.isConcave(n,o,s)&&(!!this.isShallow(n,o,s,r)&&this.isShallowSampled(n,o,e,i,r))},Mh.prototype.deleteShallowConcavities=function(){for(var e=1,t=this.findNextNonDeletedIndex(e),i=this.findNextNonDeletedIndex(t),r=!1;i<this._inputLine.length;){var n=!1;this.isDeletable(e,t,i,this._distanceTol)&&(this._isDeleted[t]=Mh.DELETE,n=!0,r=!0),e=n?i:t,t=this.findNextNonDeletedIndex(e),i=this.findNextNonDeletedIndex(t)}return r},Mh.prototype.isShallowConcavity=function(e,t,i,r){if(!(F.computeOrientation(e,t,i)===this._angleOrientation))return!1;return F.distancePointLine(t,e,i)<r},Mh.prototype.isShallowSampled=function(e,t,i,r,n){var o=Math.trunc((r-i)/Mh.NUM_PTS_TO_CHECK);o<=0&&(o=1);for(var s=i;s<r;s+=o)if(!this.isShallow(e,t,this._inputLine[s],n))return!1;return!0},Mh.prototype.isConcave=function(e,t,i){var r=F.computeOrientation(e,t,i)===this._angleOrientation;return r},Mh.prototype.simplify=function(e){this._distanceTol=Math.abs(e),e<0&&(this._angleOrientation=F.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var t=!1;do{t=this.deleteShallowConcavities()}while(t);return this.collapseLine()},Mh.prototype.findNextNonDeletedIndex=function(e){for(var t=e+1;t<this._inputLine.length&&this._isDeleted[t]===Mh.DELETE;)t++;return t},Mh.prototype.isShallow=function(e,t,i,r){return F.distancePointLine(t,e,i)<r},Mh.prototype.collapseLine=function(){for(var e=new Tu,t=0;t<this._inputLine.length;t++)this._isDeleted[t]!==Mh.DELETE&&e.add(this._inputLine[t]);return e.toCoordinateArray()},Mh.prototype.interfaces_=function(){return[]},Mh.prototype.getClass=function(){return Mh},Mh.simplify=function(e,t){return new Mh(e).simplify(t)},Ih.INIT.get=function(){return 0},Ih.DELETE.get=function(){return 1},Ih.KEEP.get=function(){return 1},Ih.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(Mh,Ih),function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new O}),Ph={COORDINATE_ARRAY_TYPE:{configurable:!0}},V=(Sh.prototype.getCoordinates=function(){return this._ptList.toArray(Sh.COORDINATE_ARRAY_TYPE)},Sh.prototype.setPrecisionModel=function(e){this._precisionModel=e},Sh.prototype.addPt=function(e){var t=new C(e);if(this._precisionModel.makePrecise(t),this.isRedundant(t))return null;this._ptList.add(t)},Sh.prototype.revere=function(){},Sh.prototype.addPts=function(e,t){if(t)for(var i=0;i<e.length;i++)this.addPt(e[i]);else for(var r=e.length-1;r>=0;r--)this.addPt(e[r])},Sh.prototype.isRedundant=function(e){if(this._ptList.size()<1)return!1;var t=this._ptList.get(this._ptList.size()-1);return e.distance(t)<this._minimimVertexDistance},Sh.prototype.toString=function(){return(new l).createLineString(this.getCoordinates()).toString()},Sh.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var e=new C(this._ptList.get(0)),t=this._ptList.get(this._ptList.size()-1);if(e.equals(t))return null;this._ptList.add(e)},Sh.prototype.setMinimumVertexDistance=function(e){this._minimimVertexDistance=e},Sh.prototype.interfaces_=function(){return[]},Sh.prototype.getClass=function(){return Sh},Ph.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(Sh,Ph),function(){}),Th={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}},Lh=(V.prototype.interfaces_=function(){return[]},V.prototype.getClass=function(){return V},V.toDegrees=function(e){return 180*e/Math.PI},V.normalize=function(e){for(;e>Math.PI;)e-=V.PI_TIMES_2;for(;e<=-Math.PI;)e+=V.PI_TIMES_2;return e},V.angle=function(){if(1===arguments.length){var e=arguments[0];return Math.atan2(e.y,e.x)}if(2===arguments.length){var t=arguments[0],i=arguments[1],r=i.x-t.x,n=i.y-t.y;return Math.atan2(n,r)}},V.isAcute=function(e,t,i){var r=e.x-t.x,n=e.y-t.y;return r*(i.x-t.x)+n*(i.y-t.y)>0},V.isObtuse=function(e,t,i){var r=e.x-t.x,n=e.y-t.y;return r*(i.x-t.x)+n*(i.y-t.y)<0},V.interiorAngle=function(e,t,i){var r=V.angle(t,e),n=V.angle(t,i);return Math.abs(n-r)},V.normalizePositive=function(e){if(e<0){for(;e<0;)e+=V.PI_TIMES_2;e>=V.PI_TIMES_2&&(e=0)}else{for(;e>=V.PI_TIMES_2;)e-=V.PI_TIMES_2;e<0&&(e=0)}return e},V.angleBetween=function(e,t,i){var r=V.angle(t,e),n=V.angle(t,i);return V.diff(r,n)},V.diff=function(e,t){var i=null;return(i=e<t?t-e:e-t)>Math.PI&&(i=2*Math.PI-i),i},V.toRadians=function(e){return e*Math.PI/180},V.getTurn=function(e,t){var i=Math.sin(t-e);return i>0?V.COUNTERCLOCKWISE:i<0?V.CLOCKWISE:V.NONE},V.angleBetweenOriented=function(e,t,i){var r=V.angle(t,e),n=V.angle(t,i)-r;return n<=-Math.PI?n+V.PI_TIMES_2:n>Math.PI?n-V.PI_TIMES_2:n},Th.PI_TIMES_2.get=function(){return 2*Math.PI},Th.PI_OVER_2.get=function(){return Math.PI/2},Th.PI_OVER_4.get=function(){return Math.PI/4},Th.COUNTERCLOCKWISE.get=function(){return F.COUNTERCLOCKWISE},Th.CLOCKWISE.get=function(){return F.CLOCKWISE},Th.NONE.get=function(){return F.COLLINEAR},Object.defineProperties(V,Th),function e(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new U,this._seg1=new U,this._offset0=new U,this._offset1=new U,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],i=arguments[1],r=arguments[2];this._precisionModel=t,this._bufParams=i,this._li=new Au,this._filletAngleQuantum=Math.PI/2/i.getQuadrantSegments(),i.getQuadrantSegments()>=8&&i.getJoinStyle()===Eh.JOIN_ROUND&&(this._closingSegLengthFactor=e.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)}),Dh={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}},Fh=(Lh.prototype.addNextSegment=function(e,t){if(this._s0=this._s1,this._s1=this._s2,this._s2=e,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var i=F.computeOrientation(this._s0,this._s1,this._s2),r=i===F.CLOCKWISE&&this._side===R.LEFT||i===F.COUNTERCLOCKWISE&&this._side===R.RIGHT;0===i?this.addCollinear(t):r?this.addOutsideTurn(i,t):this.addInsideTurn(i,t)},Lh.prototype.addLineEndCap=function(e,t){var i=new U(e,t),r=new U;this.computeOffsetSegment(i,R.LEFT,this._distance,r);var n=new U;this.computeOffsetSegment(i,R.RIGHT,this._distance,n);var o=t.x-e.x,s=t.y-e.y,a=Math.atan2(s,o);switch(this._bufParams.getEndCapStyle()){case Eh.CAP_ROUND:this._segList.addPt(r.p1),this.addFilletArc(t,a+Math.PI/2,a-Math.PI/2,F.CLOCKWISE,this._distance),this._segList.addPt(n.p1);break;case Eh.CAP_FLAT:this._segList.addPt(r.p1),this._segList.addPt(n.p1);break;case Eh.CAP_SQUARE:var l=new C;l.x=Math.abs(this._distance)*Math.cos(a),l.y=Math.abs(this._distance)*Math.sin(a);var u=new C(r.p1.x+l.x,r.p1.y+l.y),c=new C(n.p1.x+l.x,n.p1.y+l.y);this._segList.addPt(u),this._segList.addPt(c)}},Lh.prototype.getCoordinates=function(){return this._segList.getCoordinates()},Lh.prototype.addMitreJoin=function(e,t,i,r){var n=!0,o=null;try{o=tu.intersection(t.p0,t.p1,i.p0,i.p1);(r<=0?1:o.distance(e)/Math.abs(r))>this._bufParams.getMitreLimit()&&(n=!1)}catch(e){if(!(e instanceof $l))throw e;o=new C(0,0),n=!1}n?this._segList.addPt(o):this.addLimitedMitreJoin(t,i,r,this._bufParams.getMitreLimit())},Lh.prototype.addFilletCorner=function(e,t,i,r,n){var o=t.x-e.x,s=t.y-e.y,a=Math.atan2(s,o),l=i.x-e.x,u=i.y-e.y,c=Math.atan2(u,l);r===F.CLOCKWISE?a<=c&&(a+=2*Math.PI):a>=c&&(a-=2*Math.PI),this._segList.addPt(t),this.addFilletArc(e,a,c,r,n),this._segList.addPt(i)},Lh.prototype.addOutsideTurn=function(e,t){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Lh.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Eh.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Eh.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(t&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,e,this._distance),this._segList.addPt(this._offset1.p0))},Lh.prototype.createSquare=function(e){this._segList.addPt(new C(e.x+this._distance,e.y+this._distance)),this._segList.addPt(new C(e.x+this._distance,e.y-this._distance)),this._segList.addPt(new C(e.x-this._distance,e.y-this._distance)),this._segList.addPt(new C(e.x-this._distance,e.y+this._distance)),this._segList.closeRing()},Lh.prototype.addSegments=function(e,t){this._segList.addPts(e,t)},Lh.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},Lh.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},Lh.prototype.initSideSegments=function(e,t,i){this._s1=e,this._s2=t,this._side=i,this._seg1.setCoordinates(e,t),this.computeOffsetSegment(this._seg1,i,this._distance,this._offset1)},Lh.prototype.addLimitedMitreJoin=function(e,t,i,r){var n=this._seg0.p1,o=V.angle(n,this._seg0.p0),s=V.angleBetweenOriented(this._seg0.p0,n,this._seg1.p1)/2,a=V.normalize(o+s),l=V.normalize(a+Math.PI),u=r*i,c=i-u*Math.abs(Math.sin(s)),h=n.x+u*Math.cos(l),A=n.y+u*Math.sin(l),p=new C(h,A),f=new U(n,p),d=f.pointAlongOffset(1,c),g=f.pointAlongOffset(1,-c);this._side===R.LEFT?(this._segList.addPt(d),this._segList.addPt(g)):(this._segList.addPt(g),this._segList.addPt(d))},Lh.prototype.computeOffsetSegment=function(e,t,i,r){var n=t===R.LEFT?1:-1,o=e.p1.x-e.p0.x,s=e.p1.y-e.p0.y,a=Math.sqrt(o*o+s*s),l=n*i*o/a,u=n*i*s/a;r.p0.x=e.p0.x-u,r.p0.y=e.p0.y+l,r.p1.x=e.p1.x-u,r.p1.y=e.p1.y+l},Lh.prototype.addFilletArc=function(e,t,i,r,n){var o=r===F.CLOCKWISE?-1:1,s=Math.abs(t-i),a=Math.trunc(s/this._filletAngleQuantum+.5);if(a<1)return null;for(var l=s/a,u=0,c=new C;u<s;){var h=t+o*u;c.x=e.x+n*Math.cos(h),c.y=e.y+n*Math.sin(h),this._segList.addPt(c),u+=l}},Lh.prototype.addInsideTurn=function(e,t){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Lh.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var i=new C((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(i);var r=new C((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},Lh.prototype.createCircle=function(e){var t=new C(e.x+this._distance,e.y);this._segList.addPt(t),this.addFilletArc(e,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},Lh.prototype.addBevelJoin=function(e,t){this._segList.addPt(e.p1),this._segList.addPt(t.p0)},Lh.prototype.init=function(e){this._distance=e,this._maxCurveSegmentError=e*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Sh,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(e*Lh.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},Lh.prototype.addCollinear=function(e){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===Eh.JOIN_BEVEL||this._bufParams.getJoinStyle()===Eh.JOIN_MITRE?(e&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,F.CLOCKWISE,this._distance))},Lh.prototype.closeRing=function(){this._segList.closeRing()},Lh.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},Lh.prototype.interfaces_=function(){return[]},Lh.prototype.getClass=function(){return Lh},Dh.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},Dh.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},Dh.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},Dh.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(Lh,Dh),function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var e=arguments[0],t=arguments[1];this._precisionModel=e,this._bufParams=t}),Nh=(Fh.prototype.getOffsetCurve=function(e,t){if(this._distance=t,0===t)return null;var i=t<0,r=Math.abs(t),n=this.getSegGen(r);e.length<=1?this.computePointCurve(e[0],n):this.computeOffsetCurve(e,i,n);var o=n.getCoordinates();return i&&h.reverse(o),o},Fh.prototype.computeSingleSidedBufferCurve=function(e,t,i){var r=this.simplifyTolerance(this._distance);if(t){i.addSegments(e,!0);var n=Mh.simplify(e,-r),o=n.length-1;i.initSideSegments(n[o],n[o-1],R.LEFT),i.addFirstSegment();for(var s=o-2;s>=0;s--)i.addNextSegment(n[s],!0)}else{i.addSegments(e,!1);var a=Mh.simplify(e,r),l=a.length-1;i.initSideSegments(a[0],a[1],R.LEFT),i.addFirstSegment();for(var u=2;u<=l;u++)i.addNextSegment(a[u],!0)}i.addLastSegment(),i.closeRing()},Fh.prototype.computeRingBufferCurve=function(e,t,i){var r=this.simplifyTolerance(this._distance);t===R.RIGHT&&(r=-r);var n=Mh.simplify(e,r),o=n.length-1;i.initSideSegments(n[o-1],n[0],t);for(var s=1;s<=o;s++){var a=1!==s;i.addNextSegment(n[s],a)}i.closeRing()},Fh.prototype.computeLineBufferCurve=function(e,t){var i=this.simplifyTolerance(this._distance),r=Mh.simplify(e,i),n=r.length-1;t.initSideSegments(r[0],r[1],R.LEFT);for(var o=2;o<=n;o++)t.addNextSegment(r[o],!0);t.addLastSegment(),t.addLineEndCap(r[n-1],r[n]);var s=Mh.simplify(e,-i),a=s.length-1;t.initSideSegments(s[a],s[a-1],R.LEFT);for(var l=a-2;l>=0;l--)t.addNextSegment(s[l],!0);t.addLastSegment(),t.addLineEndCap(s[1],s[0]),t.closeRing()},Fh.prototype.computePointCurve=function(e,t){switch(this._bufParams.getEndCapStyle()){case Eh.CAP_ROUND:t.createCircle(e);break;case Eh.CAP_SQUARE:t.createSquare(e)}},Fh.prototype.getLineCurve=function(e,t){if(this._distance=t,t<0&&!this._bufParams.isSingleSided())return null;if(0===t)return null;var i=Math.abs(t),r=this.getSegGen(i);if(e.length<=1)this.computePointCurve(e[0],r);else if(this._bufParams.isSingleSided()){var n=t<0;this.computeSingleSidedBufferCurve(e,n,r)}else this.computeLineBufferCurve(e,r);return r.getCoordinates()},Fh.prototype.getBufferParameters=function(){return this._bufParams},Fh.prototype.simplifyTolerance=function(e){return e*this._bufParams.getSimplifyFactor()},Fh.prototype.getRingCurve=function(e,t,i){if(this._distance=i,e.length<=2)return this.getLineCurve(e,i);if(0===i)return Fh.copyCoordinates(e);var r=this.getSegGen(i);return this.computeRingBufferCurve(e,t,r),r.getCoordinates()},Fh.prototype.computeOffsetCurve=function(e,t,i){var r=this.simplifyTolerance(this._distance);if(t){var n=Mh.simplify(e,-r),o=n.length-1;i.initSideSegments(n[o],n[o-1],R.LEFT),i.addFirstSegment();for(var s=o-2;s>=0;s--)i.addNextSegment(n[s],!0)}else{var a=Mh.simplify(e,r),l=a.length-1;i.initSideSegments(a[0],a[1],R.LEFT),i.addFirstSegment();for(var u=2;u<=l;u++)i.addNextSegment(a[u],!0)}i.addLastSegment()},Fh.prototype.getSegGen=function(e){return new Lh(this._precisionModel,this._bufParams,e)},Fh.prototype.interfaces_=function(){return[]},Fh.prototype.getClass=function(){return Fh},Fh.copyCoordinates=function(e){for(var t=new Array(e.length).fill(null),i=0;i<t.length;i++)t[i]=new C(e[i]);return t},function(){this._subgraphs=null,this._seg=new U,this._cga=new F;var e=arguments[0];this._subgraphs=e}),Oh={DepthSegment:{configurable:!0}},Rh=(Nh.prototype.findStabbedSegments=function(){if(1===arguments.length){for(var e=arguments[0],t=new O,i=this._subgraphs.iterator();i.hasNext();){var r=i.next(),n=r.getEnvelope();e.y<n.getMinY()||e.y>n.getMaxY()||this.findStabbedSegments(e,r.getDirectedEdges(),t)}return t}if(3===arguments.length)if(w(arguments[2],Su)&&arguments[0]instanceof C&&arguments[1]instanceof Wc)for(var o=arguments[0],s=arguments[1],a=arguments[2],l=s.getEdge().getCoordinates(),u=0;u<l.length-1;u++){this._seg.p0=l[u],this._seg.p1=l[u+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse();if(!(Math.max(this._seg.p0.x,this._seg.p1.x)<o.x)&&!(this._seg.isHorizontal()||o.y<this._seg.p0.y||o.y>this._seg.p1.y||F.computeOrientation(this._seg.p0,this._seg.p1,o)===F.RIGHT)){var c=s.getDepth(R.LEFT);this._seg.p0.equals(l[u])||(c=s.getDepth(R.RIGHT));var h=new Rh(this._seg,c);a.add(h)}}else if(w(arguments[2],Su)&&arguments[0]instanceof C&&w(arguments[1],Su))for(var A=arguments[0],p=arguments[1],f=arguments[2],d=p.iterator();d.hasNext();){var g=d.next();g.isForward()&&this.findStabbedSegments(A,g,f)}},Nh.prototype.getDepth=function(e){var t=this.findStabbedSegments(e);if(0===t.size())return 0;return ih.min(t)._leftDepth},Nh.prototype.interfaces_=function(){return[]},Nh.prototype.getClass=function(){return Nh},Oh.DepthSegment.get=function(){return Rh},Object.defineProperties(Nh,Oh),function(){this._upwardSeg=null,this._leftDepth=null;var e=arguments[0],t=arguments[1];this._upwardSeg=new U(e),this._leftDepth=t}),Uh=(Rh.prototype.compareTo=function(e){var t=e;if(this._upwardSeg.minX()>=t._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=t._upwardSeg.minX())return-1;var i=this._upwardSeg.orientationIndex(t._upwardSeg);return 0!==i?i:0!=(i=-1*t._upwardSeg.orientationIndex(this._upwardSeg))?i:this._upwardSeg.compareTo(t._upwardSeg)},Rh.prototype.compareX=function(e,t){var i=e.p0.compareTo(t.p0);return 0!==i?i:e.p1.compareTo(t.p1)},Rh.prototype.toString=function(){return this._upwardSeg.toString()},Rh.prototype.interfaces_=function(){return[Ol]},Rh.prototype.getClass=function(){return Rh},function(e,t,i){this.p0=e||null,this.p1=t||null,this.p2=i||null}),kh=(Uh.prototype.area=function(){return Uh.area(this.p0,this.p1,this.p2)},Uh.prototype.signedArea=function(){return Uh.signedArea(this.p0,this.p1,this.p2)},Uh.prototype.interpolateZ=function(e){if(null===e)throw new Fl("Supplied point is null.");return Uh.interpolateZ(e,this.p0,this.p1,this.p2)},Uh.prototype.longestSideLength=function(){return Uh.longestSideLength(this.p0,this.p1,this.p2)},Uh.prototype.isAcute=function(){return Uh.isAcute(this.p0,this.p1,this.p2)},Uh.prototype.circumcentre=function(){return Uh.circumcentre(this.p0,this.p1,this.p2)},Uh.prototype.area3D=function(){return Uh.area3D(this.p0,this.p1,this.p2)},Uh.prototype.centroid=function(){return Uh.centroid(this.p0,this.p1,this.p2)},Uh.prototype.inCentre=function(){return Uh.inCentre(this.p0,this.p1,this.p2)},Uh.prototype.interfaces_=function(){return[]},Uh.prototype.getClass=function(){return Uh},Uh.area=function(e,t,i){return Math.abs(((i.x-e.x)*(t.y-e.y)-(t.x-e.x)*(i.y-e.y))/2)},Uh.signedArea=function(e,t,i){return((i.x-e.x)*(t.y-e.y)-(t.x-e.x)*(i.y-e.y))/2},Uh.det=function(e,t,i,r){return e*r-t*i},Uh.interpolateZ=function(e,t,i,r){var n=t.x,o=t.y,s=i.x-n,a=r.x-n,l=i.y-o,u=r.y-o,c=s*u-a*l,h=e.x-n,A=e.y-o,p=(u*h-a*A)/c,f=(-l*h+s*A)/c;return t.z+p*(i.z-t.z)+f*(r.z-t.z)},Uh.longestSideLength=function(e,t,i){var r=e.distance(t),n=t.distance(i),o=i.distance(e),s=r;return n>s&&(s=n),o>s&&(s=o),s},Uh.isAcute=function(e,t,i){return!!V.isAcute(e,t,i)&&(!!V.isAcute(t,i,e)&&!!V.isAcute(i,e,t))},Uh.circumcentre=function(e,t,i){var r=i.x,n=i.y,o=e.x-r,s=e.y-n,a=t.x-r,l=t.y-n,u=2*Uh.det(o,s,a,l),c=Uh.det(s,o*o+s*s,l,a*a+l*l),h=Uh.det(o,o*o+s*s,a,a*a+l*l);return new C(r-c/u,n+h/u)},Uh.perpendicularBisector=function(e,t){var i=t.x-e.x,r=t.y-e.y,n=new tu(e.x+i/2,e.y+r/2,1),o=new tu(e.x-r+i/2,e.y+i+r/2,1);return new tu(n,o)},Uh.angleBisector=function(e,t,i){var r=t.distance(e),n=r/(r+t.distance(i)),o=i.x-e.x,s=i.y-e.y;return new C(e.x+n*o,e.y+n*s)},Uh.area3D=function(e,t,i){var r=t.x-e.x,n=t.y-e.y,o=t.z-e.z,s=i.x-e.x,a=i.y-e.y,l=i.z-e.z,u=n*l-o*a,c=o*s-r*l,h=r*a-n*s,A=u*u+c*c+h*h,p=Math.sqrt(A)/2;return p},Uh.centroid=function(e,t,i){var r=(e.x+t.x+i.x)/3,n=(e.y+t.y+i.y)/3;return new C(r,n)},Uh.inCentre=function(e,t,i){var r=t.distance(i),n=e.distance(i),o=e.distance(t),s=r+n+o,a=(r*e.x+n*t.x+o*i.x)/s,l=(r*e.y+n*t.y+o*i.y)/s;return new C(a,l)},function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new O;var e=arguments[0],t=arguments[1],i=arguments[2];this._inputGeom=e,this._distance=t,this._curveBuilder=i}),Hh=(kh.prototype.addPoint=function(e){if(this._distance<=0)return null;var t=e.getCoordinates(),i=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(i,v.EXTERIOR,v.INTERIOR)},kh.prototype.addPolygon=function(e){var t=this._distance,i=R.LEFT;this._distance<0&&(t=-this._distance,i=R.RIGHT);var r=e.getExteriorRing(),n=h.removeRepeatedPoints(r.getCoordinates());if(this._distance<0&&this.isErodedCompletely(r,this._distance))return null;if(this._distance<=0&&n.length<3)return null;this.addPolygonRing(n,t,i,v.EXTERIOR,v.INTERIOR);for(var o=0;o<e.getNumInteriorRing();o++){var s=e.getInteriorRingN(o),a=h.removeRepeatedPoints(s.getCoordinates());this._distance>0&&this.isErodedCompletely(s,-this._distance)||this.addPolygonRing(a,t,R.opposite(i),v.INTERIOR,v.EXTERIOR)}},kh.prototype.isTriangleErodedCompletely=function(e,t){var i=new Uh(e[0],e[1],e[2]),r=i.inCentre();return F.distancePointLine(r,i.p0,i.p1)<Math.abs(t)},kh.prototype.addLineString=function(e){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var t=h.removeRepeatedPoints(e.getCoordinates()),i=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(i,v.EXTERIOR,v.INTERIOR)},kh.prototype.addCurve=function(e,t,i){if(null===e||e.length<2)return null;var r=new gh(e,new Nc(0,v.BOUNDARY,t,i));this._curveList.add(r)},kh.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},kh.prototype.addPolygonRing=function(e,t,i,r,n){if(0===t&&e.length<sc.MINIMUM_VALID_SIZE)return null;var o=r,s=n;e.length>=sc.MINIMUM_VALID_SIZE&&F.isCCW(e)&&(o=n,s=r,i=R.opposite(i));var a=this._curveBuilder.getRingCurve(e,i,t);this.addCurve(a,o,s)},kh.prototype.add=function(e){if(e.isEmpty())return null;e instanceof nc?this.addPolygon(e):e instanceof ec?this.addLineString(e):e instanceof ic?this.addPoint(e):e instanceof oc?this.addCollection(e):e instanceof ju?this.addCollection(e):e instanceof ac?this.addCollection(e):e instanceof Ku&&this.addCollection(e)},kh.prototype.isErodedCompletely=function(e,t){var i=e.getCoordinates();if(i.length<4)return t<0;if(4===i.length)return this.isTriangleErodedCompletely(i,t);var r=e.getEnvelopeInternal(),n=Math.min(r.getHeight(),r.getWidth());return t<0&&2*Math.abs(t)>n},kh.prototype.addCollection=function(e){for(var t=0;t<e.getNumGeometries();t++){var i=e.getGeometryN(t);this.add(i)}},kh.prototype.interfaces_=function(){return[]},kh.prototype.getClass=function(){return kh},function(){}),Qh=(Hh.prototype.locate=function(e){},Hh.prototype.interfaces_=function(){return[]},Hh.prototype.getClass=function(){return Hh},function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var e=arguments[0];this._parent=e,this._atStart=!0,this._index=0,this._max=e.getNumGeometries()}),Vh=(Qh.prototype.next=function(){if(this._atStart)return this._atStart=!1,Qh.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new so;var e=this._parent.getGeometryN(this._index++);return e instanceof Ku?(this._subcollectionIterator=new Qh(e),this._subcollectionIterator.next()):e},Qh.prototype.remove=function(){throw new Error(this.getClass().getName())},Qh.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},Qh.prototype.interfaces_=function(){return[Iu]},Qh.prototype.getClass=function(){return Qh},Qh.isAtomic=function(e){return!(e instanceof Ku)},function(){this._geom=null;var e=arguments[0];this._geom=e}),Gh=(Vh.prototype.locate=function(e){return Vh.locate(e,this._geom)},Vh.prototype.interfaces_=function(){return[Hh]},Vh.prototype.getClass=function(){return Vh},Vh.isPointInRing=function(e,t){return!!t.getEnvelopeInternal().intersects(e)&&F.isPointInRing(e,t.getCoordinates())},Vh.containsPointInPolygon=function(e,t){if(t.isEmpty())return!1;var i=t.getExteriorRing();if(!Vh.isPointInRing(e,i))return!1;for(var r=0;r<t.getNumInteriorRing();r++){var n=t.getInteriorRingN(r);if(Vh.isPointInRing(e,n))return!1}return!0},Vh.containsPoint=function(e,t){if(t instanceof nc)return Vh.containsPointInPolygon(e,t);if(t instanceof Ku)for(var i=new Qh(t);i.hasNext();){var r=i.next();if(r!==t&&Vh.containsPoint(e,r))return!0}return!1},Vh.locate=function(e,t){return t.isEmpty()?v.EXTERIOR:Vh.containsPoint(e,t)?v.INTERIOR:v.EXTERIOR},function(){this._edgeMap=new fo,this._edgeList=null,this._ptInAreaLocation=[v.NONE,v.NONE]}),zh=(Gh.prototype.getNextCW=function(e){this.getEdges();var t=this._edgeList.indexOf(e),i=t-1;return 0===t&&(i=this._edgeList.size()-1),this._edgeList.get(i)},Gh.prototype.propagateSideLabels=function(e){for(var t=v.NONE,i=this.iterator();i.hasNext();){var r=i.next().getLabel();r.isArea(e)&&r.getLocation(e,R.LEFT)!==v.NONE&&(t=r.getLocation(e,R.LEFT))}if(t===v.NONE)return null;for(var n=t,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getLabel();if(a.getLocation(e,R.ON)===v.NONE&&a.setLocation(e,R.ON,n),a.isArea(e)){var l=a.getLocation(e,R.LEFT),u=a.getLocation(e,R.RIGHT);if(u!==v.NONE){if(u!==n)throw new Tc("side location conflict",s.getCoordinate());l===v.NONE&&D.shouldNeverReachHere("found single null side (at "+s.getCoordinate()+")"),n=l}else D.isTrue(a.getLocation(e,R.LEFT)===v.NONE,"found single null side"),a.setLocation(e,R.RIGHT,n),a.setLocation(e,R.LEFT,n)}}},Gh.prototype.getCoordinate=function(){var e=this.iterator();if(!e.hasNext())return null;return e.next().getCoordinate()},Gh.prototype.print=function(e){eu.out.println("EdgeEndStar:   "+this.getCoordinate());for(var t=this.iterator();t.hasNext();)t.next().print(e)},Gh.prototype.isAreaLabelsConsistent=function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},Gh.prototype.checkAreaLabelsConsistent=function(e){var t=this.getEdges();if(t.size()<=0)return!0;var i=t.size()-1,r=t.get(i).getLabel().getLocation(e,R.LEFT);D.isTrue(r!==v.NONE,"Found unlabelled area edge");for(var n=r,o=this.iterator();o.hasNext();){var s=o.next().getLabel();D.isTrue(s.isArea(e),"Found non-area edge");var a=s.getLocation(e,R.LEFT),l=s.getLocation(e,R.RIGHT);if(a===l)return!1;if(l!==n)return!1;n=a}return!0},Gh.prototype.findIndex=function(e){this.iterator();for(var t=0;t<this._edgeList.size();t++)if(this._edgeList.get(t)===e)return t;return-1},Gh.prototype.iterator=function(){return this.getEdges().iterator()},Gh.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new O(this._edgeMap.values())),this._edgeList},Gh.prototype.getLocation=function(e,t,i){return this._ptInAreaLocation[e]===v.NONE&&(this._ptInAreaLocation[e]=Vh.locate(t,i[e].getGeometry())),this._ptInAreaLocation[e]},Gh.prototype.toString=function(){var e=new Wl;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append("\n");for(var t=this.iterator();t.hasNext();){var i=t.next();e.append(i),e.append("\n")}return e.toString()},Gh.prototype.computeEdgeEndLabels=function(e){for(var t=this.iterator();t.hasNext();)t.next().computeLabel(e)},Gh.prototype.computeLabelling=function(e){this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var t=[!1,!1],i=this.iterator();i.hasNext();)for(var r=i.next().getLabel(),n=0;n<2;n++)r.isLine(n)&&r.getLocation(n)===v.BOUNDARY&&(t[n]=!0);for(var o=this.iterator();o.hasNext();)for(var s=o.next(),a=s.getLabel(),l=0;l<2;l++)if(a.isAnyNull(l)){var u=v.NONE;if(t[l])u=v.EXTERIOR;else{var c=s.getCoordinate();u=this.getLocation(l,c,e)}a.setAllLocationsIfNull(l,u)}},Gh.prototype.getDegree=function(){return this._edgeMap.size()},Gh.prototype.insertEdgeEnd=function(e,t){this._edgeMap.put(e,t),this._edgeList=null},Gh.prototype.interfaces_=function(){return[]},Gh.prototype.getClass=function(){return Gh},function(o){function e(){o.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var e=null,t=null,i=this._SCANNING_FOR_INCOMING,r=0;r<this._resultAreaEdgeList.size();r++){var n=this._resultAreaEdgeList.get(r),o=n.getSym();if(n.getLabel().isArea())switch(null===e&&n.isInResult()&&(e=n),i){case this._SCANNING_FOR_INCOMING:if(!o.isInResult())continue;t=o,i=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!n.isInResult())continue;t.setNext(n),i=this._SCANNING_FOR_INCOMING}}if(i===this._LINKING_TO_OUTGOING){if(null===e)throw new Tc("no outgoing dirEdge found",this.getCoordinate());D.isTrue(e.isInResult(),"unable to link last incoming dirEdge"),t.setNext(e)}},e.prototype.insert=function(e){var t=e;this.insertEdgeEnd(t,t)},e.prototype.getRightmostEdge=function(){var e=this.getEdges(),t=e.size();if(t<1)return null;var i=e.get(0);if(1===t)return i;var r=e.get(t-1),n=i.getQuadrant(),o=r.getQuadrant();return Vc.isNorthern(n)&&Vc.isNorthern(o)?i:Vc.isNorthern(n)||Vc.isNorthern(o)?0!==i.getDy()?i:0!==r.getDy()?r:(D.shouldNeverReachHere("found two horizontal edges incident on node"),null):r},e.prototype.print=function(e){eu.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var t=this.iterator();t.hasNext();){var i=t.next();e.print("out "),i.print(e),e.println(),e.print("in "),i.getSym().print(e),e.println()}},e.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new O;for(var e=this.iterator();e.hasNext();){var t=e.next();(t.isInResult()||t.getSym().isInResult())&&this._resultAreaEdgeList.add(t)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(e){for(var t=this.iterator();t.hasNext();){var i=t.next().getLabel();i.setAllLocationsIfNull(0,e.getLocation(0)),i.setAllLocationsIfNull(1,e.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var e=null,t=null,i=this._edgeList.size()-1;i>=0;i--){var r=this._edgeList.get(i),n=r.getSym();null===t&&(t=n),null!==e&&n.setNext(e),e=r}t.setNext(e)},e.prototype.computeDepths=function(){if(1===arguments.length){var e=arguments[0],t=this.findIndex(e),i=e.getDepth(R.LEFT),r=e.getDepth(R.RIGHT),n=this.computeDepths(t+1,this._edgeList.size(),i);if(this.computeDepths(0,t,n)!==r)throw new Tc("depth mismatch at "+e.getCoordinate())}else if(3===arguments.length){for(var o=arguments[0],s=arguments[1],a=arguments[2],l=o;l<s;l++){var u=this._edgeList.get(l);u.setEdgeDepths(R.RIGHT,a),a=u.getDepth(R.LEFT)}return a}},e.prototype.mergeSymLabels=function(){for(var e=this.iterator();e.hasNext();){var t=e.next();t.getLabel().merge(t.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(e){for(var t=null,i=null,r=this._SCANNING_FOR_INCOMING,n=this._resultAreaEdgeList.size()-1;n>=0;n--){var o=this._resultAreaEdgeList.get(n),s=o.getSym();switch(null===t&&o.getEdgeRing()===e&&(t=o),r){case this._SCANNING_FOR_INCOMING:if(s.getEdgeRing()!==e)continue;i=s,r=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(o.getEdgeRing()!==e)continue;i.setNextMin(o),r=this._SCANNING_FOR_INCOMING}}r===this._LINKING_TO_OUTGOING&&(D.isTrue(null!==t,"found null for first outgoing dirEdge"),D.isTrue(t.getEdgeRing()===e,"unable to link last incoming dirEdge"),i.setNextMin(t))},e.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var e=0,t=this.iterator();t.hasNext();)t.next().isInResult()&&e++;return e}if(1===arguments.length){for(var i=arguments[0],r=0,n=this.iterator();n.hasNext();)n.next().getEdgeRing()===i&&r++;return r}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var e=v.NONE,t=this.iterator();t.hasNext();){var i=t.next(),r=i.getSym();if(!i.isLineEdge()){if(i.isInResult()){e=v.INTERIOR;break}if(r.isInResult()){e=v.EXTERIOR;break}}}if(e===v.NONE)return null;for(var n=e,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getSym();s.isLineEdge()?s.getEdge().setCovered(n===v.INTERIOR):(s.isInResult()&&(n=v.EXTERIOR),a.isInResult()&&(n=v.INTERIOR))}},e.prototype.computeLabelling=function(e){o.prototype.computeLabelling.call(this,e),this._label=new Nc(v.NONE);for(var t=this.iterator();t.hasNext();)for(var i=t.next().getEdge().getLabel(),r=0;r<2;r++){var n=i.getLocation(r);n!==v.INTERIOR&&n!==v.BOUNDARY||this._label.setLocation(r,v.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Gh)),Wh=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createNode=function(e){return new Hc(e,new zh)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(qc),qh=function e(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=e.orientation(t)},Kh=(qh.prototype.compareTo=function(e){var t=e;return qh.compareOriented(this._pts,this._orientation,t._pts,t._orientation)},qh.prototype.interfaces_=function(){return[Ol]},qh.prototype.getClass=function(){return qh},qh.orientation=function(e){return 1===h.increasingDirection(e)},qh.compareOriented=function(e,t,i,r){for(var n=t?1:-1,o=r?1:-1,s=t?e.length:-1,a=r?i.length:-1,l=t?0:e.length-1,u=r?0:i.length-1;;){var c=e[l].compareTo(i[u]);if(0!==c)return c;var h=(l+=n)===s,A=(u+=o)===a;if(h&&!A)return-1;if(!h&&A)return 1;if(h&&A)return 0}},function(){this._edges=new O,this._ocaMap=new fo}),jh=(Kh.prototype.print=function(e){e.print("MULTILINESTRING ( ");for(var t=0;t<this._edges.size();t++){var i=this._edges.get(t);t>0&&e.print(","),e.print("(");for(var r=i.getCoordinates(),n=0;n<r.length;n++)n>0&&e.print(","),e.print(r[n].x+" "+r[n].y);e.println(")")}e.print(")  ")},Kh.prototype.addAll=function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next())},Kh.prototype.findEdgeIndex=function(e){for(var t=0;t<this._edges.size();t++)if(this._edges.get(t).equals(e))return t;return-1},Kh.prototype.iterator=function(){return this._edges.iterator()},Kh.prototype.getEdges=function(){return this._edges},Kh.prototype.get=function(e){return this._edges.get(e)},Kh.prototype.findEqualEdge=function(e){var t=new qh(e.getCoordinates());return this._ocaMap.get(t)},Kh.prototype.add=function(e){this._edges.add(e);var t=new qh(e.getCoordinates());this._ocaMap.put(t,e)},Kh.prototype.interfaces_=function(){return[]},Kh.prototype.getClass=function(){return Kh},function(){}),Zh=(jh.prototype.processIntersections=function(e,t,i,r){},jh.prototype.isDone=function(){},jh.prototype.interfaces_=function(){return[]},jh.prototype.getClass=function(){return jh},function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var e=arguments[0];this._li=e}),Yh=(Zh.prototype.isTrivialIntersection=function(e,t,i,r){if(e===i&&1===this._li.getIntersectionNum()){if(Zh.isAdjacentSegments(t,r))return!0;if(e.isClosed()){var n=e.size()-1;if(0===t&&r===n||0===r&&t===n)return!0}}return!1},Zh.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Zh.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Zh.prototype.getLineIntersector=function(){return this._li},Zh.prototype.hasProperIntersection=function(){return this._hasProper},Zh.prototype.processIntersections=function(e,t,i,r){if(e===i&&t===r)return null;this.numTests++;var n=e.getCoordinates()[t],o=e.getCoordinates()[t+1],s=i.getCoordinates()[r],a=i.getCoordinates()[r+1];this._li.computeIntersection(n,o,s,a),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e,t,i,r)||(this._hasIntersection=!0,e.addIntersections(this._li,t,0),i.addIntersections(this._li,r,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},Zh.prototype.hasIntersection=function(){return this._hasIntersection},Zh.prototype.isDone=function(){return!1},Zh.prototype.hasInteriorIntersection=function(){return this._hasInterior},Zh.prototype.interfaces_=function(){return[jh]},Zh.prototype.getClass=function(){return Zh},Zh.isAdjacentSegments=function(e,t){return 1===Math.abs(e-t)},function(){this.coord=null,this.segmentIndex=null,this.dist=null;var e=arguments[0],t=arguments[1],i=arguments[2];this.coord=new C(e),this.segmentIndex=t,this.dist=i}),Xh=(Yh.prototype.getSegmentIndex=function(){return this.segmentIndex},Yh.prototype.getCoordinate=function(){return this.coord},Yh.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)},Yh.prototype.compareTo=function(e){var t=e;return this.compare(t.segmentIndex,t.dist)},Yh.prototype.isEndPoint=function(e){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===e},Yh.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},Yh.prototype.getDistance=function(){return this.dist},Yh.prototype.compare=function(e,t){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<t?-1:this.dist>t?1:0},Yh.prototype.interfaces_=function(){return[Ol]},Yh.prototype.getClass=function(){return Yh},function(){this._nodeMap=new fo,this.edge=null;var e=arguments[0];this.edge=e}),Jh=(Xh.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();)t.next().print(e)},Xh.prototype.iterator=function(){return this._nodeMap.values().iterator()},Xh.prototype.addSplitEdges=function(e){this.addEndpoints();for(var t=this.iterator(),i=t.next();t.hasNext();){var r=t.next(),n=this.createSplitEdge(i,r);e.add(n),i=r}},Xh.prototype.addEndpoints=function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)},Xh.prototype.createSplitEdge=function(e,t){var i=t.segmentIndex-e.segmentIndex+2,r=this.edge.pts[t.segmentIndex],n=t.dist>0||!t.coord.equals2D(r);n||i--;var o=new Array(i).fill(null),s=0;o[s++]=new C(e.coord);for(var a=e.segmentIndex+1;a<=t.segmentIndex;a++)o[s++]=this.edge.pts[a];return n&&(o[s]=t.coord),new iA(o,new Nc(this.edge._label))},Xh.prototype.add=function(e,t,i){var r=new Yh(e,t,i),n=this._nodeMap.get(r);return null!==n?n:(this._nodeMap.put(r,r),r)},Xh.prototype.isIntersection=function(e){for(var t=this.iterator();t.hasNext();)if(t.next().coord.equals(e))return!0;return!1},Xh.prototype.interfaces_=function(){return[]},Xh.prototype.getClass=function(){return Xh},function(){}),$h=(Jh.prototype.getChainStartIndices=function(e){var t=0,i=new O;i.add(new ql(t));do{var r=this.findChainEnd(e,t);i.add(new ql(r)),t=r}while(t<e.length-1);return Jh.toIntArray(i)},Jh.prototype.findChainEnd=function(e,t){for(var i=Vc.quadrant(e[t],e[t+1]),r=t+1;r<e.length;){if(Vc.quadrant(e[r-1],e[r])!==i)break;r++}return r-1},Jh.prototype.interfaces_=function(){return[]},Jh.prototype.getClass=function(){return Jh},Jh.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),i=0;i<t.length;i++)t[i]=e.get(i).intValue();return t},function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new u,this.env2=new u;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var t=new Jh;this.startIndex=t.getChainStartIndices(this.pts)}),eA=($h.prototype.getCoordinates=function(){return this.pts},$h.prototype.getMaxX=function(e){var t=this.pts[this.startIndex[e]].x,i=this.pts[this.startIndex[e+1]].x;return t>i?t:i},$h.prototype.getMinX=function(e){var t=this.pts[this.startIndex[e]].x,i=this.pts[this.startIndex[e+1]].x;return t<i?t:i},$h.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3];this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],t,t.startIndex[i],t.startIndex[i+1],r)}else if(6===arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3],l=arguments[4],u=arguments[5],c=this.pts[n],h=this.pts[o],A=s.pts[a],p=s.pts[l];if(o-n==1&&l-a==1)return u.addIntersections(this.e,n,s.e,a),null;if(this.env1.init(c,h),this.env2.init(A,p),!this.env1.intersects(this.env2))return null;var f=Math.trunc((n+o)/2),d=Math.trunc((a+l)/2);n<f&&(a<d&&this.computeIntersectsForChain(n,f,s,a,d,u),d<l&&this.computeIntersectsForChain(n,f,s,d,l,u)),f<o&&(a<d&&this.computeIntersectsForChain(f,o,s,a,d,u),d<l&&this.computeIntersectsForChain(f,o,s,d,l,u))}},$h.prototype.getStartIndexes=function(){return this.startIndex},$h.prototype.computeIntersects=function(e,t){for(var i=0;i<this.startIndex.length-1;i++)for(var r=0;r<e.startIndex.length-1;r++)this.computeIntersectsForChain(i,e,r,t)},$h.prototype.interfaces_=function(){return[]},$h.prototype.getClass=function(){return $h},function e(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var t=0;t<2;t++)for(var i=0;i<3;i++)this._depth[t][i]=e.NULL_VALUE}),tA={NULL_VALUE:{configurable:!0}},iA=(eA.prototype.getDepth=function(e,t){return this._depth[e][t]},eA.prototype.setDepth=function(e,t,i){this._depth[e][t]=i},eA.prototype.isNull=function(){if(0===arguments.length){for(var e=0;e<2;e++)for(var t=0;t<3;t++)if(this._depth[e][t]!==eA.NULL_VALUE)return!1;return!0}if(1===arguments.length){var i=arguments[0];return this._depth[i][1]===eA.NULL_VALUE}if(2===arguments.length){var r=arguments[0],n=arguments[1];return this._depth[r][n]===eA.NULL_VALUE}},eA.prototype.normalize=function(){for(var e=0;e<2;e++)if(!this.isNull(e)){var t=this._depth[e][1];this._depth[e][2]<t&&(t=this._depth[e][2]),t<0&&(t=0);for(var i=1;i<3;i++){var r=0;this._depth[e][i]>t&&(r=1),this._depth[e][i]=r}}},eA.prototype.getDelta=function(e){return this._depth[e][R.RIGHT]-this._depth[e][R.LEFT]},eA.prototype.getLocation=function(e,t){return this._depth[e][t]<=0?v.EXTERIOR:v.INTERIOR},eA.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},eA.prototype.add=function(){if(1===arguments.length)for(var e=arguments[0],t=0;t<2;t++)for(var i=1;i<3;i++){var r=e.getLocation(t,i);r!==v.EXTERIOR&&r!==v.INTERIOR||(this.isNull(t,i)?this._depth[t][i]=eA.depthAtLocation(r):this._depth[t][i]+=eA.depthAtLocation(r))}else if(3===arguments.length){var n=arguments[0],o=arguments[1];arguments[2]===v.INTERIOR&&this._depth[n][o]++}},eA.prototype.interfaces_=function(){return[]},eA.prototype.getClass=function(){return eA},eA.depthAtLocation=function(e){return e===v.EXTERIOR?0:e===v.INTERIOR?1:eA.NULL_VALUE},tA.NULL_VALUE.get=function(){return-1},Object.defineProperties(eA,tA),function(r){function s(){if(r.call(this),this.pts=null,this._env=null,this.eiList=new Xh(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new eA,this._depthDelta=0,1===arguments.length){var e=arguments[0];s.call(this,e,null)}else if(2===arguments.length){var t=arguments[0],i=arguments[1];this.pts=t,this._label=i}}return r&&(s.__proto__=r),s.prototype=Object.create(r&&r.prototype),s.prototype.constructor=s,s.prototype.getDepth=function(){return this._depth},s.prototype.getCollapsedEdge=function(){var e=new Array(2).fill(null);e[0]=this.pts[0],e[1]=this.pts[1];return new s(e,Nc.toLineLabel(this._label))},s.prototype.isIsolated=function(){return this._isIsolated},s.prototype.getCoordinates=function(){return this.pts},s.prototype.setIsolated=function(e){this._isIsolated=e},s.prototype.setName=function(e){this._name=e},s.prototype.equals=function(e){if(!(e instanceof s))return!1;var t=e;if(this.pts.length!==t.pts.length)return!1;for(var i=!0,r=!0,n=this.pts.length,o=0;o<this.pts.length;o++)if(this.pts[o].equals2D(t.pts[o])||(i=!1),this.pts[o].equals2D(t.pts[--n])||(r=!1),!i&&!r)return!1;return!0},s.prototype.getCoordinate=function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var e=arguments[0];return this.pts[e]}},s.prototype.print=function(e){e.print("edge "+this._name+": "),e.print("LINESTRING (");for(var t=0;t<this.pts.length;t++)t>0&&e.print(","),e.print(this.pts[t].x+" "+this.pts[t].y);e.print(")  "+this._label+" "+this._depthDelta)},s.prototype.computeIM=function(e){s.updateIM(this._label,e)},s.prototype.isCollapsed=function(){return!!this._label.isArea()&&(3===this.pts.length&&!!this.pts[0].equals(this.pts[2]))},s.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},s.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},s.prototype.getDepthDelta=function(){return this._depthDelta},s.prototype.getNumPoints=function(){return this.pts.length},s.prototype.printReverse=function(e){e.print("edge "+this._name+": ");for(var t=this.pts.length-1;t>=0;t--)e.print(this.pts[t]+" ");e.println("")},s.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new $h(this)),this._mce},s.prototype.getEnvelope=function(){if(null===this._env){this._env=new u;for(var e=0;e<this.pts.length;e++)this._env.expandToInclude(this.pts[e])}return this._env},s.prototype.addIntersection=function(e,t,i,r){var n=new C(e.getIntersection(r)),o=t,s=e.getEdgeDistance(i,r),a=o+1;if(a<this.pts.length){var l=this.pts[a];n.equals2D(l)&&(o=a,s=0)}this.eiList.add(n,o,s)},s.prototype.toString=function(){var e=new Wl;e.append("edge "+this._name+": "),e.append("LINESTRING (");for(var t=0;t<this.pts.length;t++)t>0&&e.append(","),e.append(this.pts[t].x+" "+this.pts[t].y);return e.append(")  "+this._label+" "+this._depthDelta),e.toString()},s.prototype.isPointwiseEqual=function(e){if(this.pts.length!==e.pts.length)return!1;for(var t=0;t<this.pts.length;t++)if(!this.pts[t].equals2D(e.pts[t]))return!1;return!0},s.prototype.setDepthDelta=function(e){this._depthDelta=e},s.prototype.getEdgeIntersectionList=function(){return this.eiList},s.prototype.addIntersections=function(e,t,i){for(var r=0;r<e.getIntersectionNum();r++)this.addIntersection(e,t,i,r)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s.updateIM=function(){if(2!==arguments.length)return r.prototype.updateIM.apply(this,arguments);var e=arguments[0],t=arguments[1];t.setAtLeastIfValid(e.getLocation(0,R.ON),e.getLocation(1,R.ON),1),e.isArea()&&(t.setAtLeastIfValid(e.getLocation(0,R.LEFT),e.getLocation(1,R.LEFT),2),t.setAtLeastIfValid(e.getLocation(0,R.RIGHT),e.getLocation(1,R.RIGHT),2))},s}(kc)),rA=function(e){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Kh,this._bufParams=e||null},nA=(rA.prototype.setWorkingPrecisionModel=function(e){this._workingPrecisionModel=e},rA.prototype.insertUniqueEdge=function(e){var t=this._edgeList.findEqualEdge(e);if(null!==t){var i=t.getLabel(),r=e.getLabel();t.isPointwiseEqual(e)||(r=new Nc(e.getLabel())).flip(),i.merge(r);var n=rA.depthDelta(r),o=t.getDepthDelta()+n;t.setDepthDelta(o)}else this._edgeList.add(e),e.setDepthDelta(rA.depthDelta(e.getLabel()))},rA.prototype.buildSubgraphs=function(e,t){for(var i=new O,r=e.iterator();r.hasNext();){var n=r.next(),o=n.getRightmostCoordinate(),s=new Nh(i).getDepth(o);n.computeDepth(s),n.findResultEdges(),i.add(n),t.add(n.getDirectedEdges(),n.getNodes())}},rA.prototype.createSubgraphs=function(e){for(var t=new O,i=e.getNodes().iterator();i.hasNext();){var r=i.next();if(!r.isVisited()){var n=new Dc;n.create(r),t.add(n)}}return ih.sort(t,ih.reverseOrder()),t},rA.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},rA.prototype.getNoder=function(e){if(null!==this._workingNoder)return this._workingNoder;var t=new xh,i=new Au;return i.setPrecisionModel(e),t.setSegmentIntersector(new Zh(i)),t},rA.prototype.buffer=function(e,t){var i=this._workingPrecisionModel;null===i&&(i=e.getPrecisionModel()),this._geomFact=e.getFactory();var r=new Fh(i,this._bufParams),n=new kh(e,t,r).getCurves();if(n.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(n,i),this._graph=new Kc(new Wh),this._graph.addEdges(this._edgeList.getEdges());var o=this.createSubgraphs(this._graph),s=new jc(this._geomFact);this.buildSubgraphs(o,s);var a=s.getPolygons();if(a.size()<=0)return this.createEmptyResultGeometry();return this._geomFact.buildGeometry(a)},rA.prototype.computeNodedEdges=function(e,t){var i=this.getNoder(t);i.computeNodes(e);for(var r=i.getNodedSubstrings().iterator();r.hasNext();){var n=r.next(),o=n.getCoordinates();if(2!==o.length||!o[0].equals2D(o[1])){var s=n.getData(),a=new iA(n.getCoordinates(),new Nc(s));this.insertUniqueEdge(a)}}},rA.prototype.setNoder=function(e){this._workingNoder=e},rA.prototype.interfaces_=function(){return[]},rA.prototype.getClass=function(){return rA},rA.depthDelta=function(e){var t=e.getLocation(0,R.LEFT),i=e.getLocation(0,R.RIGHT);return t===v.INTERIOR&&i===v.EXTERIOR?1:t===v.EXTERIOR&&i===v.INTERIOR?-1:0},rA.convertSegStrings=function(e){for(var t=new l,i=new O;e.hasNext();){var r=e.next(),n=t.createLineString(r.getCoordinates());i.add(n)}return t.buildGeometry(i)},function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var e=arguments[0],t=arguments[1];this._noder=e,this._scaleFactor=t,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2],o=arguments[3];this._noder=i,this._scaleFactor=r,this._offsetX=n,this._offsetY=o,this._isScaled=!this.isIntegerPrecision()}}),oA=(nA.prototype.rescale=function(){if(w(arguments[0],Bu))for(var e=arguments[0].iterator();e.hasNext();){var t=e.next();this.rescale(t.getCoordinates())}else if(arguments[0]instanceof Array){for(var i=arguments[0],r=0;r<i.length;r++)i[r].x=i[r].x/this._scaleFactor+this._offsetX,i[r].y=i[r].y/this._scaleFactor+this._offsetY;2===i.length&&i[0].equals2D(i[1])&&eu.out.println(i)}},nA.prototype.scale=function(){if(w(arguments[0],Bu)){for(var e=arguments[0],t=new O,i=e.iterator();i.hasNext();){var r=i.next();t.add(new gh(this.scale(r.getCoordinates()),r.getData()))}return t}if(arguments[0]instanceof Array){for(var n=arguments[0],o=new Array(n.length).fill(null),s=0;s<n.length;s++)o[s]=new C(Math.round((n[s].x-this._offsetX)*this._scaleFactor),Math.round((n[s].y-this._offsetY)*this._scaleFactor),n[s].z);return h.removeRepeatedPoints(o)}},nA.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},nA.prototype.getNodedSubstrings=function(){var e=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(e),e},nA.prototype.computeNodes=function(e){var t=e;this._isScaled&&(t=this.scale(e)),this._noder.computeNodes(t)},nA.prototype.interfaces_=function(){return[Ch]},nA.prototype.getClass=function(){return nA},function(){this._li=new Au,this._segStrings=null;var e=arguments[0];this._segStrings=e}),sA={fact:{configurable:!0}},aA=(oA.prototype.checkEndPtVertexIntersections=function(){if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var t=e.next().getCoordinates();this.checkEndPtVertexIntersections(t[0],this._segStrings),this.checkEndPtVertexIntersections(t[t.length-1],this._segStrings)}else if(2===arguments.length)for(var i=arguments[0],r=arguments[1].iterator();r.hasNext();)for(var n=r.next().getCoordinates(),o=1;o<n.length-1;o++)if(n[o].equals(i))throw new lu("found endpt/interior pt intersection at index "+o+" :pt "+i)},oA.prototype.checkInteriorIntersections=function(){if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();)for(var t=e.next(),i=this._segStrings.iterator();i.hasNext();){var r=i.next();this.checkInteriorIntersections(t,r)}else if(2===arguments.length)for(var n=arguments[0],o=arguments[1],s=n.getCoordinates(),a=o.getCoordinates(),l=0;l<s.length-1;l++)for(var u=0;u<a.length-1;u++)this.checkInteriorIntersections(n,l,o,u);else if(4===arguments.length){var c=arguments[0],h=arguments[1],A=arguments[2],p=arguments[3];if(c===A&&h===p)return null;var f=c.getCoordinates()[h],d=c.getCoordinates()[h+1],g=A.getCoordinates()[p],m=A.getCoordinates()[p+1];if(this._li.computeIntersection(f,d,g,m),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,f,d)||this.hasInteriorIntersection(this._li,g,m)))throw new lu("found non-noded intersection at "+f+"-"+d+" and "+g+"-"+m)}},oA.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},oA.prototype.checkCollapses=function(){if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var t=e.next();this.checkCollapses(t)}else if(1===arguments.length)for(var i=arguments[0].getCoordinates(),r=0;r<i.length-2;r++)this.checkCollapse(i[r],i[r+1],i[r+2])},oA.prototype.hasInteriorIntersection=function(e,t,i){for(var r=0;r<e.getIntersectionNum();r++){var n=e.getIntersection(r);if(!n.equals(t)&&!n.equals(i))return!0}return!1},oA.prototype.checkCollapse=function(e,t,i){if(e.equals(i))throw new lu("found non-noded collapse at "+oA.fact.createLineString([e,t,i]))},oA.prototype.interfaces_=function(){return[]},oA.prototype.getClass=function(){return oA},sA.fact.get=function(){return new l},Object.defineProperties(oA,sA),function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var e=arguments[0],t=arguments[1],i=arguments[2];if(this._originalPt=e,this._pt=e,this._scaleFactor=t,this._li=i,t<=0)throw new Fl("Scale factor must be non-zero");1!==t&&(this._pt=new C(this.scale(e.x),this.scale(e.y)),this._p0Scaled=new C,this._p1Scaled=new C),this.initCorners(this._pt)}),lA={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}},uA=(aA.prototype.intersectsScaled=function(e,t){var i=Math.min(e.x,t.x),r=Math.max(e.x,t.x),n=Math.min(e.y,t.y),o=Math.max(e.y,t.y),s=this._maxx<i||this._minx>r||this._maxy<n||this._miny>o;if(s)return!1;var a=this.intersectsToleranceSquare(e,t);return D.isTrue(!(s&&a),"Found bad envelope test"),a},aA.prototype.initCorners=function(e){this._minx=e.x-.5,this._maxx=e.x+.5,this._miny=e.y-.5,this._maxy=e.y+.5,this._corner[0]=new C(this._maxx,this._maxy),this._corner[1]=new C(this._minx,this._maxy),this._corner[2]=new C(this._minx,this._miny),this._corner[3]=new C(this._maxx,this._miny)},aA.prototype.intersects=function(e,t){return 1===this._scaleFactor?this.intersectsScaled(e,t):(this.copyScaled(e,this._p0Scaled),this.copyScaled(t,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},aA.prototype.scale=function(e){return Math.round(e*this._scaleFactor)},aA.prototype.getCoordinate=function(){return this._originalPt},aA.prototype.copyScaled=function(e,t){t.x=this.scale(e.x),t.y=this.scale(e.y)},aA.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var e=aA.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new u(this._originalPt.x-e,this._originalPt.x+e,this._originalPt.y-e,this._originalPt.y+e)}return this._safeEnv},aA.prototype.intersectsPixelClosure=function(e,t){return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))},aA.prototype.intersectsToleranceSquare=function(e,t){var i=!1,r=!1;return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(i=!0),this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),!!this._li.isProper()||(!(!i||!r)||(!!e.equals(this._pt)||!!t.equals(this._pt))))))},aA.prototype.addSnappedNode=function(e,t){var i=e.getCoordinate(t),r=e.getCoordinate(t+1);return!!this.intersects(i,r)&&(e.addIntersection(this.getCoordinate(),t),!0)},aA.prototype.interfaces_=function(){return[]},aA.prototype.getClass=function(){return aA},lA.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(aA,lA),function(){this.tempEnv1=new u,this.selectedSegment=new U}),cA=(uA.prototype.select=function(){if(1===arguments.length);else if(2===arguments.length){var e=arguments[0],t=arguments[1];e.getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}},uA.prototype.interfaces_=function(){return[]},uA.prototype.getClass=function(){return uA},function(){this._index=null;var e=arguments[0];this._index=e}),hA={HotPixelSnapAction:{configurable:!0}},AA=(cA.prototype.snap=function(){if(1===arguments.length){var e=arguments[0];return this.snap(e,null,-1)}if(3===arguments.length){var t=arguments[0],i=arguments[1],r=arguments[2],n=t.getSafeEnvelope(),o=new AA(t,i,r);return this._index.query(n,{interfaces_:function(){return[Jc]},visitItem:function(e){e.select(n,o)}}),o.isNodeAdded()}},cA.prototype.interfaces_=function(){return[]},cA.prototype.getClass=function(){return cA},hA.HotPixelSnapAction.get=function(){return AA},Object.defineProperties(cA,hA),function(r){function e(){r.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var e=arguments[0],t=arguments[1],i=arguments[2];this._hotPixel=e,this._parentEdge=t,this._hotPixelVertexIndex=i}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(2!==arguments.length)return r.prototype.select.apply(this,arguments);var e=arguments[0],t=arguments[1],i=e.getContext();if(null!==this._parentEdge&&i===this._parentEdge&&t===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(i,t)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(uA)),pA=function(){this._li=null,this._interiorIntersections=null;var e=arguments[0];this._li=e,this._interiorIntersections=new O},fA=(pA.prototype.processIntersections=function(e,t,i,r){if(e===i&&t===r)return null;var n=e.getCoordinates()[t],o=e.getCoordinates()[t+1],s=i.getCoordinates()[r],a=i.getCoordinates()[r+1];if(this._li.computeIntersection(n,o,s,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var l=0;l<this._li.getIntersectionNum();l++)this._interiorIntersections.add(this._li.getIntersection(l));e.addIntersections(this._li,t,0),i.addIntersections(this._li,r,1)}},pA.prototype.isDone=function(){return!1},pA.prototype.getInteriorIntersections=function(){return this._interiorIntersections},pA.prototype.interfaces_=function(){return[jh]},pA.prototype.getClass=function(){return pA},function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var e=arguments[0];this._pm=e,this._li=new Au,this._li.setPrecisionModel(e),this._scaleFactor=e.getScale()}),dA=(fA.prototype.checkCorrectness=function(e){var t=gh.getNodedSubstrings(e),i=new oA(t);try{i.checkValid()}catch(e){if(!(e instanceof Jl))throw e;e.printStackTrace()}},fA.prototype.getNodedSubstrings=function(){return gh.getNodedSubstrings(this._nodedSegStrings)},fA.prototype.snapRound=function(e,t){var i=this.findInteriorIntersections(e,t);this.computeIntersectionSnaps(i),this.computeVertexSnaps(e)},fA.prototype.findInteriorIntersections=function(e,t){var i=new pA(t);return this._noder.setSegmentIntersector(i),this._noder.computeNodes(e),i.getInteriorIntersections()},fA.prototype.computeVertexSnaps=function(){if(w(arguments[0],Bu))for(var e=arguments[0].iterator();e.hasNext();){var t=e.next();this.computeVertexSnaps(t)}else if(arguments[0]instanceof gh)for(var i=arguments[0],r=i.getCoordinates(),n=0;n<r.length;n++){var o=new aA(r[n],this._scaleFactor,this._li);this._pointSnapper.snap(o,i,n)&&i.addIntersection(r[n],n)}},fA.prototype.computeNodes=function(e){this._nodedSegStrings=e,this._noder=new xh,this._pointSnapper=new cA(this._noder.getIndex()),this.snapRound(e,this._li)},fA.prototype.computeIntersectionSnaps=function(e){for(var t=e.iterator();t.hasNext();){var i=t.next(),r=new aA(i,this._scaleFactor,this._li);this._pointSnapper.snap(r)}},fA.prototype.interfaces_=function(){return[Ch]},fA.prototype.getClass=function(){return fA},function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Eh,this._resultGeometry=null,this._saveException=null,1===arguments.length){var e=arguments[0];this._argGeom=e}else if(2===arguments.length){var t=arguments[0],i=arguments[1];this._argGeom=t,this._bufParams=i}}),gA={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}},mA=(dA.prototype.bufferFixedPrecision=function(e){var t=new nA(new fA(new yc(1)),e.getScale()),i=new rA(this._bufParams);i.setWorkingPrecisionModel(e),i.setNoder(t),this._resultGeometry=i.buffer(this._argGeom,this._distance)},dA.prototype.bufferReducedPrecision=function(){var e=this;if(0===arguments.length){for(var t=dA.MAX_PRECISION_DIGITS;t>=0;t--){try{e.bufferReducedPrecision(t)}catch(t){if(!(t instanceof Tc))throw t;e._saveException=t}if(null!==e._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var i=arguments[0],r=dA.precisionScaleFactor(this._argGeom,this._distance,i),n=new yc(r);this.bufferFixedPrecision(n)}},dA.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var e=this._argGeom.getFactory().getPrecisionModel();e.getType()===yc.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()},dA.prototype.setQuadrantSegments=function(e){this._bufParams.setQuadrantSegments(e)},dA.prototype.bufferOriginalPrecision=function(){try{var e=new rA(this._bufParams);this._resultGeometry=e.buffer(this._argGeom,this._distance)}catch(e){if(!(e instanceof lu))throw e;this._saveException=e}},dA.prototype.getResultGeometry=function(e){return this._distance=e,this.computeGeometry(),this._resultGeometry},dA.prototype.setEndCapStyle=function(e){this._bufParams.setEndCapStyle(e)},dA.prototype.interfaces_=function(){return[]},dA.prototype.getClass=function(){return dA},dA.bufferOp=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return new dA(e).getResultGeometry(t)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof N&&"number"==typeof arguments[1]){var i=arguments[0],r=arguments[1],n=arguments[2],o=new dA(i);o.setQuadrantSegments(n);return o.getResultGeometry(r)}if(arguments[2]instanceof Eh&&arguments[0]instanceof N&&"number"==typeof arguments[1]){var s=arguments[0],a=arguments[1],l=arguments[2];return new dA(s,l).getResultGeometry(a)}}else if(4===arguments.length){var u=arguments[0],c=arguments[1],h=arguments[2],A=arguments[3],p=new dA(u);p.setQuadrantSegments(h),p.setEndCapStyle(A);return p.getResultGeometry(c)}},dA.precisionScaleFactor=function(e,t,i){var r=e.getEnvelopeInternal(),n=Gl.max(Math.abs(r.getMaxX()),Math.abs(r.getMaxY()),Math.abs(r.getMinX()),Math.abs(r.getMinY()))+2*(t>0?t:0),o=i-Math.trunc(Math.log(n)/Math.log(10)+1);return Math.pow(10,o)},gA.CAP_ROUND.get=function(){return Eh.CAP_ROUND},gA.CAP_BUTT.get=function(){return Eh.CAP_FLAT},gA.CAP_FLAT.get=function(){return Eh.CAP_FLAT},gA.CAP_SQUARE.get=function(){return Eh.CAP_SQUARE},gA.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(dA,gA),function(){this._pt=[new C,new C],this._distance=_.NaN,this._isNull=!0}),yA=(mA.prototype.getCoordinates=function(){return this._pt},mA.prototype.getCoordinate=function(e){return this._pt[e]},mA.prototype.setMinimum=function(){if(1===arguments.length){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(2===arguments.length){var t=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(t,i),null;var r=t.distance(i);r<this._distance&&this.initialize(t,i,r)}},mA.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2];this._pt[0].setCoordinate(i),this._pt[1].setCoordinate(r),this._distance=n,this._isNull=!1}},mA.prototype.getDistance=function(){return this._distance},mA.prototype.setMaximum=function(){if(1===arguments.length){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(2===arguments.length){var t=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(t,i),null;var r=t.distance(i);r>this._distance&&this.initialize(t,i,r)}},mA.prototype.interfaces_=function(){return[]},mA.prototype.getClass=function(){return mA},function(){}),_A=(yA.prototype.interfaces_=function(){return[]},yA.prototype.getClass=function(){return yA},yA.computeDistance=function(){if(arguments[2]instanceof mA&&arguments[0]instanceof ec&&arguments[1]instanceof C)for(var e=arguments[0],t=arguments[1],i=arguments[2],r=e.getCoordinates(),n=new U,o=0;o<r.length-1;o++){n.setCoordinates(r[o],r[o+1]);var s=n.closestPoint(t);i.setMinimum(s,t)}else if(arguments[2]instanceof mA&&arguments[0]instanceof nc&&arguments[1]instanceof C){var a=arguments[0],l=arguments[1],u=arguments[2];yA.computeDistance(a.getExteriorRing(),l,u);for(var c=0;c<a.getNumInteriorRing();c++)yA.computeDistance(a.getInteriorRingN(c),l,u)}else if(arguments[2]instanceof mA&&arguments[0]instanceof N&&arguments[1]instanceof C){var h=arguments[0],A=arguments[1],p=arguments[2];if(h instanceof ec)yA.computeDistance(h,A,p);else if(h instanceof nc)yA.computeDistance(h,A,p);else if(h instanceof Ku)for(var f=h,d=0;d<f.getNumGeometries();d++){var g=f.getGeometryN(d);yA.computeDistance(g,A,p)}else p.setMinimum(h.getCoordinate(),A)}else if(arguments[2]instanceof mA&&arguments[0]instanceof U&&arguments[1]instanceof C){var m=arguments[0],y=arguments[1],_=arguments[2],v=m.closestPoint(y);_.setMinimum(v,y)}},function(e){this._maxPtDist=new mA,this._inputGeom=e||null}),vA={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}},CA=(_A.prototype.computeMaxMidpointDistance=function(e){var t=new wA(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())},_A.prototype.computeMaxVertexDistance=function(e){var t=new CA(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())},_A.prototype.findDistance=function(e){return this.computeMaxVertexDistance(e),this.computeMaxMidpointDistance(e),this._maxPtDist.getDistance()},_A.prototype.getDistancePoints=function(){return this._maxPtDist},_A.prototype.interfaces_=function(){return[]},_A.prototype.getClass=function(){return _A},vA.MaxPointDistanceFilter.get=function(){return CA},vA.MaxMidpointDistanceFilter.get=function(){return wA},Object.defineProperties(_A,vA),function(e){this._maxPtDist=new mA,this._minPtDist=new mA,this._geom=e||null}),wA=(CA.prototype.filter=function(e){this._minPtDist.initialize(),yA.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},CA.prototype.getMaxPointDistance=function(){return this._maxPtDist},CA.prototype.interfaces_=function(){return[_u]},CA.prototype.getClass=function(){return CA},function(e){this._maxPtDist=new mA,this._minPtDist=new mA,this._geom=e||null}),xA=(wA.prototype.filter=function(e,t){if(0===t)return null;var i=e.getCoordinate(t-1),r=e.getCoordinate(t),n=new C((i.x+r.x)/2,(i.y+r.y)/2);this._minPtDist.initialize(),yA.computeDistance(this._geom,n,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},wA.prototype.isDone=function(){return!1},wA.prototype.isGeometryChanged=function(){return!1},wA.prototype.getMaxPointDistance=function(){return this._maxPtDist},wA.prototype.interfaces_=function(){return[qu]},wA.prototype.getClass=function(){return wA},function(e){this._comps=e||null}),bA=(xA.prototype.filter=function(e){e instanceof nc&&this._comps.add(e)},xA.prototype.interfaces_=function(){return[Wu]},xA.prototype.getClass=function(){return xA},xA.getPolygons=function(){if(1===arguments.length){var e=arguments[0];return xA.getPolygons(e,new O)}if(2===arguments.length){var t=arguments[0],i=arguments[1];return t instanceof nc?i.add(t):t instanceof Ku&&t.apply(new xA(i)),i}},function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length){var e=arguments[0];this._lines=e}else if(2===arguments.length){var t=arguments[0],i=arguments[1];this._lines=t,this._isForcedToLineString=i}}),EA=(bA.prototype.filter=function(e){if(this._isForcedToLineString&&e instanceof sc){var t=e.getFactory().createLineString(e.getCoordinateSequence());return this._lines.add(t),null}e instanceof ec&&this._lines.add(e)},bA.prototype.setForceToLineString=function(e){this._isForcedToLineString=e},bA.prototype.interfaces_=function(){return[gu]},bA.prototype.getClass=function(){return bA},bA.getGeometry=function(){if(1===arguments.length){var e=arguments[0];return e.getFactory().buildGeometry(bA.getLines(e))}if(2===arguments.length){var t=arguments[0],i=arguments[1];return t.getFactory().buildGeometry(bA.getLines(t,i))}},bA.getLines=function(){if(1===arguments.length){var e=arguments[0];return bA.getLines(e,!1)}if(2===arguments.length){if(w(arguments[0],Bu)&&w(arguments[1],Bu)){for(var t=arguments[0],i=arguments[1],r=t.iterator();r.hasNext();){var n=r.next();bA.getLines(n,i)}return i}if(arguments[0]instanceof N&&"boolean"==typeof arguments[1]){var o=arguments[0],s=arguments[1],a=new O;return o.apply(new bA(a,s)),a}if(arguments[0]instanceof N&&w(arguments[1],Bu)){var l=arguments[0],u=arguments[1];return l instanceof ec?u.add(l):l.apply(new bA(u)),u}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&w(arguments[0],Bu)&&w(arguments[1],Bu)){for(var c=arguments[0],h=arguments[1],A=arguments[2],p=c.iterator();p.hasNext();){var f=p.next();bA.getLines(f,h,A)}return h}if("boolean"==typeof arguments[2]&&arguments[0]instanceof N&&w(arguments[1],Bu)){var d=arguments[0],g=arguments[1],m=arguments[2];return d.apply(new bA(g,m)),g}}},function(){if(this._boundaryRule=vu.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0===arguments.length);else if(1===arguments.length){var e=arguments[0];if(null===e)throw new Fl("Rule must be non-null");this._boundaryRule=e}}),BA=(EA.prototype.locateInternal=function(){if(arguments[0]instanceof C&&arguments[1]instanceof nc){var e=arguments[0],t=arguments[1];if(t.isEmpty())return v.EXTERIOR;var i=t.getExteriorRing(),r=this.locateInPolygonRing(e,i);if(r===v.EXTERIOR)return v.EXTERIOR;if(r===v.BOUNDARY)return v.BOUNDARY;for(var n=0;n<t.getNumInteriorRing();n++){var o=t.getInteriorRingN(n),s=this.locateInPolygonRing(e,o);if(s===v.INTERIOR)return v.EXTERIOR;if(s===v.BOUNDARY)return v.BOUNDARY}return v.INTERIOR}if(arguments[0]instanceof C&&arguments[1]instanceof ec){var a=arguments[0],l=arguments[1];if(!l.getEnvelopeInternal().intersects(a))return v.EXTERIOR;var u=l.getCoordinates();return l.isClosed()||!a.equals(u[0])&&!a.equals(u[u.length-1])?F.isOnLine(a,u)?v.INTERIOR:v.EXTERIOR:v.BOUNDARY}if(arguments[0]instanceof C&&arguments[1]instanceof ic){var c=arguments[0];return arguments[1].getCoordinate().equals2D(c)?v.INTERIOR:v.EXTERIOR}},EA.prototype.locateInPolygonRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?F.locatePointInRing(e,t.getCoordinates()):v.EXTERIOR},EA.prototype.intersects=function(e,t){return this.locate(e,t)!==v.EXTERIOR},EA.prototype.updateLocationInfo=function(e){e===v.INTERIOR&&(this._isIn=!0),e===v.BOUNDARY&&this._numBoundaries++},EA.prototype.computeLocation=function(e,t){if(t instanceof ic&&this.updateLocationInfo(this.locateInternal(e,t)),t instanceof ec)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof nc)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof ju)for(var i=t,r=0;r<i.getNumGeometries();r++){var n=i.getGeometryN(r);this.updateLocationInfo(this.locateInternal(e,n))}else if(t instanceof ac)for(var o=t,s=0;s<o.getNumGeometries();s++){var a=o.getGeometryN(s);this.updateLocationInfo(this.locateInternal(e,a))}else if(t instanceof Ku)for(var l=new Qh(t);l.hasNext();){var u=l.next();u!==t&&this.computeLocation(e,u)}},EA.prototype.locate=function(e,t){return t.isEmpty()?v.EXTERIOR:t instanceof ec?this.locateInternal(e,t):t instanceof nc?this.locateInternal(e,t):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(e,t),this._boundaryRule.isInBoundary(this._numBoundaries)?v.BOUNDARY:this._numBoundaries>0||this._isIn?v.INTERIOR:v.EXTERIOR)},EA.prototype.interfaces_=function(){return[]},EA.prototype.getClass=function(){return EA},function e(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length){var t=arguments[0],i=arguments[1];e.call(this,t,e.INSIDE_AREA,i)}else if(3===arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2];this._component=r,this._segIndex=n,this._pt=o}}),MA={INSIDE_AREA:{configurable:!0}},IA=(BA.prototype.isInsideArea=function(){return this._segIndex===BA.INSIDE_AREA},BA.prototype.getCoordinate=function(){return this._pt},BA.prototype.getGeometryComponent=function(){return this._component},BA.prototype.getSegmentIndex=function(){return this._segIndex},BA.prototype.interfaces_=function(){return[]},BA.prototype.getClass=function(){return BA},MA.INSIDE_AREA.get=function(){return-1},Object.defineProperties(BA,MA),function(e){this._pts=e||null}),SA=(IA.prototype.filter=function(e){e instanceof ic&&this._pts.add(e)},IA.prototype.interfaces_=function(){return[Wu]},IA.prototype.getClass=function(){return IA},IA.getPoints=function(){if(1===arguments.length){var e=arguments[0];return e instanceof ic?ih.singletonList(e):IA.getPoints(e,new O)}if(2===arguments.length){var t=arguments[0],i=arguments[1];return t instanceof ic?i.add(t):t instanceof Ku&&t.apply(new IA(i)),i}},function(){this._locations=null;var e=arguments[0];this._locations=e}),PA=(SA.prototype.filter=function(e){(e instanceof ic||e instanceof ec||e instanceof nc)&&this._locations.add(new BA(e,0,e.getCoordinate()))},SA.prototype.interfaces_=function(){return[Wu]},SA.prototype.getClass=function(){return SA},SA.getLocations=function(e){var t=new O;return e.apply(new SA(t)),t},function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new EA,this._minDistanceLocation=null,this._minDistance=_.MAX_VALUE,2===arguments.length){var e=arguments[0],t=arguments[1];this._geom=[e,t],this._terminateDistance=0}else if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=i,this._geom[1]=r,this._terminateDistance=n}}),TA=(PA.prototype.computeContainmentDistance=function(){if(0===arguments.length){var e=new Array(2).fill(null);if(this.computeContainmentDistance(0,e),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,e)}else if(2===arguments.length){var t=arguments[0],i=arguments[1],r=1-t,n=xA.getPolygons(this._geom[t]);if(n.size()>0){var o=SA.getLocations(this._geom[r]);if(this.computeContainmentDistance(o,n,i),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[r]=i[0],this._minDistanceLocation[t]=i[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&w(arguments[0],Su)&&w(arguments[1],Su)){for(var s=arguments[0],a=arguments[1],l=arguments[2],u=0;u<s.size();u++)for(var c=s.get(u),h=0;h<a.size();h++)if(this.computeContainmentDistance(c,a.get(h),l),this._minDistance<=this._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof BA&&arguments[1]instanceof nc){var A=arguments[0],p=arguments[1],f=arguments[2],d=A.getCoordinate();if(v.EXTERIOR!==this._ptLocator.locate(d,p))return this._minDistance=0,f[0]=A,f[1]=new BA(p,d),null}},PA.prototype.computeMinDistanceLinesPoints=function(e,t,i){for(var r=0;r<e.size();r++)for(var n=e.get(r),o=0;o<t.size();o++){var s=t.get(o);if(this.computeMinDistance(n,s,i),this._minDistance<=this._terminateDistance)return null}},PA.prototype.computeFacetDistance=function(){var e=new Array(2).fill(null),t=bA.getLines(this._geom[0]),i=bA.getLines(this._geom[1]),r=IA.getPoints(this._geom[0]),n=IA.getPoints(this._geom[1]);return this.computeMinDistanceLines(t,i,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance?null:(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(t,n,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance?null:(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(i,r,e),this.updateMinDistance(e,!0),this._minDistance<=this._terminateDistance?null:(e[0]=null,e[1]=null,this.computeMinDistancePoints(r,n,e),void this.updateMinDistance(e,!1))))},PA.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},PA.prototype.updateMinDistance=function(e,t){if(null===e[0])return null;t?(this._minDistanceLocation[0]=e[1],this._minDistanceLocation[1]=e[0]):(this._minDistanceLocation[0]=e[0],this._minDistanceLocation[1]=e[1])},PA.prototype.nearestPoints=function(){this.computeMinDistance();return[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},PA.prototype.computeMinDistance=function(){if(0===arguments.length){if(null!==this._minDistanceLocation)return null;if(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof ec&&arguments[1]instanceof ic){var e=arguments[0],t=arguments[1],i=arguments[2];if(e.getEnvelopeInternal().distance(t.getEnvelopeInternal())>this._minDistance)return null;for(var r=e.getCoordinates(),n=t.getCoordinate(),o=0;o<r.length-1;o++){var s=F.distancePointLine(n,r[o],r[o+1]);if(s<this._minDistance){this._minDistance=s;var a=new U(r[o],r[o+1]).closestPoint(n);i[0]=new BA(e,o,a),i[1]=new BA(t,0,n)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof ec&&arguments[1]instanceof ec){var l=arguments[0],u=arguments[1],c=arguments[2];if(l.getEnvelopeInternal().distance(u.getEnvelopeInternal())>this._minDistance)return null;for(var h=l.getCoordinates(),A=u.getCoordinates(),p=0;p<h.length-1;p++)for(var f=0;f<A.length-1;f++){var d=F.distanceLineLine(h[p],h[p+1],A[f],A[f+1]);if(d<this._minDistance){this._minDistance=d;var g=new U(h[p],h[p+1]),m=new U(A[f],A[f+1]),y=g.closestPoints(m);c[0]=new BA(l,p,y[0]),c[1]=new BA(u,f,y[1])}if(this._minDistance<=this._terminateDistance)return null}}},PA.prototype.computeMinDistancePoints=function(e,t,i){for(var r=0;r<e.size();r++)for(var n=e.get(r),o=0;o<t.size();o++){var s=t.get(o),a=n.getCoordinate().distance(s.getCoordinate());if(a<this._minDistance&&(this._minDistance=a,i[0]=new BA(n,0,n.getCoordinate()),i[1]=new BA(s,0,s.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},PA.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new Fl("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},PA.prototype.computeMinDistanceLines=function(e,t,i){for(var r=0;r<e.size();r++)for(var n=e.get(r),o=0;o<t.size();o++){var s=t.get(o);if(this.computeMinDistance(n,s,i),this._minDistance<=this._terminateDistance)return null}},PA.prototype.interfaces_=function(){return[]},PA.prototype.getClass=function(){return PA},PA.distance=function(e,t){return new PA(e,t).distance()},PA.isWithinDistance=function(e,t,i){return new PA(e,t,i).distance()<=i},PA.nearestPoints=function(e,t){return new PA(e,t).nearestPoints()},function(){this._pt=[new C,new C],this._distance=_.NaN,this._isNull=!0}),LA=(TA.prototype.getCoordinates=function(){return this._pt},TA.prototype.getCoordinate=function(e){return this._pt[e]},TA.prototype.setMinimum=function(){if(1===arguments.length){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(2===arguments.length){var t=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(t,i),null;var r=t.distance(i);r<this._distance&&this.initialize(t,i,r)}},TA.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2];this._pt[0].setCoordinate(i),this._pt[1].setCoordinate(r),this._distance=n,this._isNull=!1}},TA.prototype.toString=function(){return au.toLineString(this._pt[0],this._pt[1])},TA.prototype.getDistance=function(){return this._distance},TA.prototype.setMaximum=function(){if(1===arguments.length){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(2===arguments.length){var t=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(t,i),null;var r=t.distance(i);r>this._distance&&this.initialize(t,i,r)}},TA.prototype.interfaces_=function(){return[]},TA.prototype.getClass=function(){return TA},function(){}),DA=(LA.prototype.interfaces_=function(){return[]},LA.prototype.getClass=function(){return LA},LA.computeDistance=function(){if(arguments[2]instanceof TA&&arguments[0]instanceof ec&&arguments[1]instanceof C)for(var e=arguments[0],t=arguments[1],i=arguments[2],r=new U,n=e.getCoordinates(),o=0;o<n.length-1;o++){r.setCoordinates(n[o],n[o+1]);var s=r.closestPoint(t);i.setMinimum(s,t)}else if(arguments[2]instanceof TA&&arguments[0]instanceof nc&&arguments[1]instanceof C){var a=arguments[0],l=arguments[1],u=arguments[2];LA.computeDistance(a.getExteriorRing(),l,u);for(var c=0;c<a.getNumInteriorRing();c++)LA.computeDistance(a.getInteriorRingN(c),l,u)}else if(arguments[2]instanceof TA&&arguments[0]instanceof N&&arguments[1]instanceof C){var h=arguments[0],A=arguments[1],p=arguments[2];if(h instanceof ec)LA.computeDistance(h,A,p);else if(h instanceof nc)LA.computeDistance(h,A,p);else if(h instanceof Ku)for(var f=h,d=0;d<f.getNumGeometries();d++){var g=f.getGeometryN(d);LA.computeDistance(g,A,p)}else p.setMinimum(h.getCoordinate(),A)}else if(arguments[2]instanceof TA&&arguments[0]instanceof U&&arguments[1]instanceof C){var m=arguments[0],y=arguments[1],_=arguments[2],v=m.closestPoint(y);_.setMinimum(v,y)}},function(){this._g0=null,this._g1=null,this._ptDist=new TA,this._densifyFrac=0;var e=arguments[0],t=arguments[1];this._g0=e,this._g1=t}),FA={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}},NA=(DA.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},DA.prototype.setDensifyFraction=function(e){if(e>1||e<=0)throw new Fl("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=e},DA.prototype.compute=function(e,t){this.computeOrientedDistance(e,t,this._ptDist),this.computeOrientedDistance(t,e,this._ptDist)},DA.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},DA.prototype.computeOrientedDistance=function(e,t,i){var r=new NA(t);if(e.apply(r),i.setMaximum(r.getMaxPointDistance()),this._densifyFrac>0){var n=new OA(t,this._densifyFrac);e.apply(n),i.setMaximum(n.getMaxPointDistance())}},DA.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},DA.prototype.interfaces_=function(){return[]},DA.prototype.getClass=function(){return DA},DA.distance=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return new DA(e,t).distance()}if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2],o=new DA(i,r);return o.setDensifyFraction(n),o.distance()}},FA.MaxPointDistanceFilter.get=function(){return NA},FA.MaxDensifiedByFractionDistanceFilter.get=function(){return OA},Object.defineProperties(DA,FA),function(){this._maxPtDist=new TA,this._minPtDist=new TA,this._euclideanDist=new LA,this._geom=null;var e=arguments[0];this._geom=e}),OA=(NA.prototype.filter=function(e){this._minPtDist.initialize(),LA.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},NA.prototype.getMaxPointDistance=function(){return this._maxPtDist},NA.prototype.interfaces_=function(){return[_u]},NA.prototype.getClass=function(){return NA},function(){this._maxPtDist=new TA,this._minPtDist=new TA,this._geom=null,this._numSubSegs=0;var e=arguments[0],t=arguments[1];this._geom=e,this._numSubSegs=Math.trunc(Math.round(1/t))}),RA=(OA.prototype.filter=function(e,t){if(0===t)return null;for(var i=e.getCoordinate(t-1),r=e.getCoordinate(t),n=(r.x-i.x)/this._numSubSegs,o=(r.y-i.y)/this._numSubSegs,s=0;s<this._numSubSegs;s++){var a=i.x+s*n,l=i.y+s*o,u=new C(a,l);this._minPtDist.initialize(),LA.computeDistance(this._geom,u,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},OA.prototype.isDone=function(){return!1},OA.prototype.isGeometryChanged=function(){return!1},OA.prototype.getMaxPointDistance=function(){return this._maxPtDist},OA.prototype.interfaces_=function(){return[qu]},OA.prototype.getClass=function(){return OA},function(e,t,i){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._bufDistance=t||null,this._result=i||null}),UA={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}},kA=(RA.prototype.checkMaximumDistance=function(e,t,i){var r=new DA(t,e);if(r.setDensifyFraction(.25),this._maxDistanceFound=r.orientedDistance(),this._maxDistanceFound>i){this._isValid=!1;var n=r.getCoordinates();this._errorLocation=n[1],this._errorIndicator=e.getFactory().createLineString(n),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+au.toLineString(n[0],n[1])+")"}},RA.prototype.isValid=function(){var e=Math.abs(this._bufDistance),t=RA.MAX_DISTANCE_DIFF_FRAC*e;return this._minValidDistance=e-t,this._maxValidDistance=e+t,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),RA.VERBOSE&&eu.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},RA.prototype.checkNegativeValid=function(){if(!(this._input instanceof nc||this._input instanceof ac||this._input instanceof Ku))return null;var e=this.getPolygonLines(this._input);if(this.checkMinimumDistance(e,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(e,this._result,this._maxValidDistance)},RA.prototype.getErrorIndicator=function(){return this._errorIndicator},RA.prototype.checkMinimumDistance=function(e,t,i){var r=new PA(e,t,i);if(this._minDistanceFound=r.distance(),this._minDistanceFound<i){this._isValid=!1;var n=r.nearestPoints();this._errorLocation=r.nearestPoints()[1],this._errorIndicator=e.getFactory().createLineString(n),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+au.toLineString(n[0],n[1])+" )"}},RA.prototype.checkPositiveValid=function(){var e=this._result.getBoundary();if(this.checkMinimumDistance(this._input,e,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,e,this._maxValidDistance)},RA.prototype.getErrorLocation=function(){return this._errorLocation},RA.prototype.getPolygonLines=function(e){for(var t=new O,i=new bA(t),r=xA.getPolygons(e).iterator();r.hasNext();)r.next().apply(i);return e.getFactory().buildGeometry(t)},RA.prototype.getErrorMessage=function(){return this._errMsg},RA.prototype.interfaces_=function(){return[]},RA.prototype.getClass=function(){return RA},UA.VERBOSE.get=function(){return!1},UA.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(RA,UA),function(e,t,i){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._distance=t||null,this._result=i||null}),HA={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}},QA=(kA.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},kA.prototype.checkEnvelope=function(){if(this._distance<0)return null;var e=this._distance*kA.MAX_ENV_DIFF_FRAC;0===e&&(e=.001);var t=new u(this._input.getEnvelopeInternal());t.expandBy(this._distance);var i=new u(this._result.getEnvelopeInternal());i.expandBy(e),i.contains(t)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(i)),this.report("Envelope")},kA.prototype.checkDistance=function(){var e=new RA(this._input,this._distance,this._result);e.isValid()||(this._isValid=!1,this._errorMsg=e.getErrorMessage(),this._errorLocation=e.getErrorLocation(),this._errorIndicator=e.getErrorIndicator()),this.report("Distance")},kA.prototype.checkArea=function(){var e=this._input.getArea(),t=this._result.getArea();this._distance>0&&e>t&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&e<t&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},kA.prototype.checkPolygonal=function(){this._result instanceof nc||this._result instanceof ac||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},kA.prototype.getErrorIndicator=function(){return this._errorIndicator},kA.prototype.getErrorLocation=function(){return this._errorLocation},kA.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2?null:this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},kA.prototype.report=function(e){if(!kA.VERBOSE)return null;eu.out.println("Check "+e+": "+(this._isValid?"passed":"FAILED"))},kA.prototype.getErrorMessage=function(){return this._errorMsg},kA.prototype.interfaces_=function(){return[]},kA.prototype.getClass=function(){return kA},kA.isValidMsg=function(e,t,i){var r=new kA(e,t,i);return r.isValid()?null:r.getErrorMessage()},kA.isValid=function(e,t,i){return!!new kA(e,t,i).isValid()},HA.VERBOSE.get=function(){return!1},HA.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(kA,HA),function(){this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t}),VA=(QA.prototype.getCoordinates=function(){return this._pts},QA.prototype.size=function(){return this._pts.length},QA.prototype.getCoordinate=function(e){return this._pts[e]},QA.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},QA.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:ph.octant(this.getCoordinate(e),this.getCoordinate(e+1))},QA.prototype.setData=function(e){this._data=e},QA.prototype.getData=function(){return this._data},QA.prototype.toString=function(){return au.toLineString(new pc(this._pts))},QA.prototype.interfaces_=function(){return[fh]},QA.prototype.getClass=function(){return QA},function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new O,this._intersectionCount=0,this._keepIntersections=!0;var e=arguments[0];this._li=e,this._interiorIntersection=null}),GA=(VA.prototype.getInteriorIntersection=function(){return this._interiorIntersection},VA.prototype.setCheckEndSegmentsOnly=function(e){this._isCheckEndSegmentsOnly=e},VA.prototype.getIntersectionSegments=function(){return this._intSegments},VA.prototype.count=function(){return this._intersectionCount},VA.prototype.getIntersections=function(){return this._intersections},VA.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e},VA.prototype.setKeepIntersections=function(e){this._keepIntersections=e},VA.prototype.processIntersections=function(e,t,i,r){if(!this._findAllIntersections&&this.hasIntersection())return null;if(e===i&&t===r)return null;if(this._isCheckEndSegmentsOnly)if(!(this.isEndSegment(e,t)||this.isEndSegment(i,r)))return null;var n=e.getCoordinates()[t],o=e.getCoordinates()[t+1],s=i.getCoordinates()[r],a=i.getCoordinates()[r+1];this._li.computeIntersection(n,o,s,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=n,this._intSegments[1]=o,this._intSegments[2]=s,this._intSegments[3]=a,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},VA.prototype.isEndSegment=function(e,t){return 0===t||t>=e.size()-2},VA.prototype.hasIntersection=function(){return null!==this._interiorIntersection},VA.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},VA.prototype.interfaces_=function(){return[jh]},VA.prototype.getClass=function(){return VA},VA.createAllIntersectionsFinder=function(e){var t=new VA(e);return t.setFindAllIntersections(!0),t},VA.createAnyIntersectionFinder=function(e){return new VA(e)},VA.createIntersectionCounter=function(e){var t=new VA(e);return t.setFindAllIntersections(!0),t.setKeepIntersections(!1),t},function(){this._li=new Au,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var e=arguments[0];this._segStrings=e}),zA=(GA.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},GA.prototype.getIntersections=function(){return this._segInt.getIntersections()},GA.prototype.isValid=function(){return this.execute(),this._isValid},GA.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e},GA.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new VA(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var e=new xh;if(e.setSegmentIntersector(this._segInt),e.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},GA.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Tc(this.getErrorMessage(),this._segInt.getInteriorIntersection())},GA.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var e=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+au.toLineString(e[0],e[1])+" and "+au.toLineString(e[2],e[3])},GA.prototype.interfaces_=function(){return[]},GA.prototype.getClass=function(){return GA},GA.computeIntersections=function(e){var t=new GA(e);return t.setFindAllIntersections(!0),t.isValid(),t.getIntersections()},function e(){this._nv=null;var t=arguments[0];this._nv=new GA(e.toSegmentStrings(t))}),WA=(zA.prototype.checkValid=function(){this._nv.checkValid()},zA.prototype.interfaces_=function(){return[]},zA.prototype.getClass=function(){return zA},zA.toSegmentStrings=function(e){for(var t=new O,i=e.iterator();i.hasNext();){var r=i.next();t.add(new QA(r.getCoordinates(),r))}return t},zA.checkValid=function(e){new zA(e).checkValid()},function(e){this._mapOp=e}),qA=(WA.prototype.map=function(e){for(var t=new O,i=0;i<e.getNumGeometries();i++){var r=this._mapOp.map(e.getGeometryN(i));r.isEmpty()||t.add(r)}return e.getFactory().createGeometryCollection(l.toGeometryArray(t))},WA.prototype.interfaces_=function(){return[]},WA.prototype.getClass=function(){return WA},WA.map=function(e,t){return new WA(t).map(e)},function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new O,this._resultLineList=new O;var e=arguments[0],t=arguments[1],i=arguments[2];this._op=e,this._geometryFactory=t,this._ptLocator=i}),KA=(qA.prototype.collectLines=function(e){for(var t=this._op.getGraph().getEdgeEnds().iterator();t.hasNext();){var i=t.next();this.collectLineEdge(i,e,this._lineEdgesList),this.collectBoundaryTouchEdge(i,e,this._lineEdgesList)}},qA.prototype.labelIsolatedLine=function(e,t){var i=this._ptLocator.locate(e.getCoordinate(),this._op.getArgGeometry(t));e.getLabel().setLocation(t,i)},qA.prototype.build=function(e){return this.findCoveredLineEdges(),this.collectLines(e),this.buildLines(e),this._resultLineList},qA.prototype.collectLineEdge=function(e,t,i){var r=e.getLabel(),n=e.getEdge();e.isLineEdge()&&(e.isVisited()||!A.isResultOfOp(r,t)||n.isCovered()||(i.add(n),e.setVisitedEdge(!0)))},qA.prototype.findCoveredLineEdges=function(){for(var e=this._op.getGraph().getNodes().iterator();e.hasNext();)e.next().getEdges().findCoveredLineEdges();for(var t=this._op.getGraph().getEdgeEnds().iterator();t.hasNext();){var i=t.next(),r=i.getEdge();if(i.isLineEdge()&&!r.isCoveredSet()){var n=this._op.isCoveredByA(i.getCoordinate());r.setCovered(n)}}},qA.prototype.labelIsolatedLines=function(e){for(var t=e.iterator();t.hasNext();){var i=t.next(),r=i.getLabel();i.isIsolated()&&(r.isNull(0)?this.labelIsolatedLine(i,0):this.labelIsolatedLine(i,1))}},qA.prototype.buildLines=function(e){for(var t=this._lineEdgesList.iterator();t.hasNext();){var i=t.next(),r=this._geometryFactory.createLineString(i.getCoordinates());this._resultLineList.add(r),i.setInResult(!0)}},qA.prototype.collectBoundaryTouchEdge=function(e,t,i){var r=e.getLabel();return e.isLineEdge()?null:e.isVisited()?null:e.isInteriorAreaEdge()?null:e.getEdge().isInResult()?null:(D.isTrue(!(e.isInResult()||e.getSym().isInResult())||!e.getEdge().isInResult()),void(A.isResultOfOp(r,t)&&t===A.INTERSECTION&&(i.add(e.getEdge()),e.setVisitedEdge(!0))))},qA.prototype.interfaces_=function(){return[]},qA.prototype.getClass=function(){return qA},function(){this._op=null,this._geometryFactory=null,this._resultPointList=new O;var e=arguments[0],t=arguments[1];this._op=e,this._geometryFactory=t}),jA=(KA.prototype.filterCoveredNodeToPoint=function(e){var t=e.getCoordinate();if(!this._op.isCoveredByLA(t)){var i=this._geometryFactory.createPoint(t);this._resultPointList.add(i)}},KA.prototype.extractNonCoveredResultNodes=function(e){for(var t=this._op.getGraph().getNodes().iterator();t.hasNext();){var i=t.next();if(!i.isInResult()&&(!i.isIncidentEdgeInResult()&&(0===i.getEdges().getDegree()||e===A.INTERSECTION))){var r=i.getLabel();A.isResultOfOp(r,e)&&this.filterCoveredNodeToPoint(i)}}},KA.prototype.build=function(e){return this.extractNonCoveredResultNodes(e),this._resultPointList},KA.prototype.interfaces_=function(){return[]},KA.prototype.getClass=function(){return KA},function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1}),ZA=(jA.prototype.transformPoint=function(e,t){return this._factory.createPoint(this.transformCoordinates(e.getCoordinateSequence(),e))},jA.prototype.transformPolygon=function(e,t){var i=!0,r=this.transformLinearRing(e.getExteriorRing(),e);null!==r&&r instanceof sc&&!r.isEmpty()||(i=!1);for(var n=new O,o=0;o<e.getNumInteriorRing();o++){var s=this.transformLinearRing(e.getInteriorRingN(o),e);null===s||s.isEmpty()||(s instanceof sc||(i=!1),n.add(s))}if(i)return this._factory.createPolygon(r,n.toArray([]));var a=new O;return null!==r&&a.add(r),a.addAll(n),this._factory.buildGeometry(a)},jA.prototype.createCoordinateSequence=function(e){return this._factory.getCoordinateSequenceFactory().create(e)},jA.prototype.getInputGeometry=function(){return this._inputGeom},jA.prototype.transformMultiLineString=function(e,t){for(var i=new O,r=0;r<e.getNumGeometries();r++){var n=this.transformLineString(e.getGeometryN(r),e);null!==n&&(n.isEmpty()||i.add(n))}return this._factory.buildGeometry(i)},jA.prototype.transformCoordinates=function(e,t){return this.copy(e)},jA.prototype.transformLineString=function(e,t){return this._factory.createLineString(this.transformCoordinates(e.getCoordinateSequence(),e))},jA.prototype.transformMultiPoint=function(e,t){for(var i=new O,r=0;r<e.getNumGeometries();r++){var n=this.transformPoint(e.getGeometryN(r),e);null!==n&&(n.isEmpty()||i.add(n))}return this._factory.buildGeometry(i)},jA.prototype.transformMultiPolygon=function(e,t){for(var i=new O,r=0;r<e.getNumGeometries();r++){var n=this.transformPolygon(e.getGeometryN(r),e);null!==n&&(n.isEmpty()||i.add(n))}return this._factory.buildGeometry(i)},jA.prototype.copy=function(e){return e.copy()},jA.prototype.transformGeometryCollection=function(e,t){for(var i=new O,r=0;r<e.getNumGeometries();r++){var n=this.transform(e.getGeometryN(r));null!==n&&(this._pruneEmptyGeometry&&n.isEmpty()||i.add(n))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(l.toGeometryArray(i)):this._factory.buildGeometry(i)},jA.prototype.transform=function(e){if(this._inputGeom=e,this._factory=e.getFactory(),e instanceof ic)return this.transformPoint(e,null);if(e instanceof oc)return this.transformMultiPoint(e,null);if(e instanceof sc)return this.transformLinearRing(e,null);if(e instanceof ec)return this.transformLineString(e,null);if(e instanceof ju)return this.transformMultiLineString(e,null);if(e instanceof nc)return this.transformPolygon(e,null);if(e instanceof ac)return this.transformMultiPolygon(e,null);if(e instanceof Ku)return this.transformGeometryCollection(e,null);throw new Fl("Unknown Geometry subtype: "+e.getClass().getName())},jA.prototype.transformLinearRing=function(e,t){var i=this.transformCoordinates(e.getCoordinateSequence(),e);if(null===i)return this._factory.createLinearRing(null);var r=i.size();return r>0&&r<4&&!this._preserveType?this._factory.createLineString(i):this._factory.createLinearRing(i)},jA.prototype.interfaces_=function(){return[]},jA.prototype.getClass=function(){return jA},function e(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new U,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof ec&&"number"==typeof arguments[1]){var t=arguments[0],i=arguments[1];e.call(this,t.getCoordinates(),i)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var r=arguments[0],n=arguments[1];this._srcPts=r,this._isClosed=e.isClosed(r),this._snapTolerance=n}}),YA=(ZA.prototype.snapVertices=function(e,t){for(var i=this._isClosed?e.size()-1:e.size(),r=0;r<i;r++){var n=e.get(r),o=this.findSnapForVertex(n,t);null!==o&&(e.set(r,new C(o)),0===r&&this._isClosed&&e.set(e.size()-1,new C(o)))}},ZA.prototype.findSnapForVertex=function(e,t){for(var i=0;i<t.length;i++){if(e.equals2D(t[i]))return null;if(e.distance(t[i])<this._snapTolerance)return t[i]}return null},ZA.prototype.snapTo=function(e){var t=new Tu(this._srcPts);this.snapVertices(t,e),this.snapSegments(t,e);return t.toCoordinateArray()},ZA.prototype.snapSegments=function(e,t){if(0===t.length)return null;var i=t.length;t[0].equals2D(t[t.length-1])&&(i=t.length-1);for(var r=0;r<i;r++){var n=t[r],o=this.findSegmentIndexToSnap(n,e);o>=0&&e.add(o+1,new C(n),!1)}},ZA.prototype.findSegmentIndexToSnap=function(e,t){for(var i=_.MAX_VALUE,r=-1,n=0;n<t.size()-1;n++){if(this._seg.p0=t.get(n),this._seg.p1=t.get(n+1),this._seg.p0.equals2D(e)||this._seg.p1.equals2D(e)){if(this._allowSnappingToSourceVertices)continue;return-1}var o=this._seg.distance(e);o<this._snapTolerance&&o<i&&(i=o,r=n)}return r},ZA.prototype.setAllowSnappingToSourceVertices=function(e){this._allowSnappingToSourceVertices=e},ZA.prototype.interfaces_=function(){return[]},ZA.prototype.getClass=function(){return ZA},ZA.isClosed=function(e){return!(e.length<=1)&&e[0].equals2D(e[e.length-1])},function(e){this._srcGeom=e||null}),XA={SNAP_PRECISION_FACTOR:{configurable:!0}},JA=(YA.prototype.snapTo=function(e,t){var i=this.extractTargetCoordinates(e);return new JA(t,i).transform(this._srcGeom)},YA.prototype.snapToSelf=function(e,t){var i=this.extractTargetCoordinates(this._srcGeom),r=new JA(e,i,!0).transform(this._srcGeom),n=r;return t&&w(n,rc)&&(n=r.buffer(0)),n},YA.prototype.computeSnapTolerance=function(e){return this.computeMinimumSegmentLength(e)/10},YA.prototype.extractTargetCoordinates=function(e){for(var t=new mo,i=e.getCoordinates(),r=0;r<i.length;r++)t.add(i[r]);return t.toArray(new Array(0).fill(null))},YA.prototype.computeMinimumSegmentLength=function(e){for(var t=_.MAX_VALUE,i=0;i<e.length-1;i++){var r=e[i].distance(e[i+1]);r<t&&(t=r)}return t},YA.prototype.interfaces_=function(){return[]},YA.prototype.getClass=function(){return YA},YA.snap=function(e,t,i){var r=new Array(2).fill(null),n=new YA(e);r[0]=n.snapTo(t,i);var o=new YA(t);return r[1]=o.snapTo(r[0],i),r},YA.computeOverlaySnapTolerance=function(){if(1===arguments.length){var e=arguments[0],t=YA.computeSizeBasedSnapTolerance(e),i=e.getPrecisionModel();if(i.getType()===yc.FIXED){var r=1/i.getScale()*2/1.415;r>t&&(t=r)}return t}if(2===arguments.length){var n=arguments[0],o=arguments[1];return Math.min(YA.computeOverlaySnapTolerance(n),YA.computeOverlaySnapTolerance(o))}},YA.computeSizeBasedSnapTolerance=function(e){var t=e.getEnvelopeInternal();return Math.min(t.getHeight(),t.getWidth())*YA.SNAP_PRECISION_FACTOR},YA.snapToSelf=function(e,t,i){return new YA(e).snapToSelf(t,i)},XA.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(YA,XA),function(r){function e(e,t,i){r.call(this),this._snapTolerance=e||null,this._snapPts=t||null,this._isSelfSnap=void 0!==i&&i}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(e,t){var i=new ZA(e,this._snapTolerance);return i.setAllowSnappingToSourceVertices(this._isSelfSnap),i.snapTo(t)},e.prototype.transformCoordinates=function(e,t){var i=e.toCoordinateArray(),r=this.snapLine(i,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(jA)),$A=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null},ep=($A.prototype.getCommon=function(){return _.longBitsToDouble(this._commonBits)},$A.prototype.add=function(e){var t=_.doubleToLongBits(e);if(this._isFirst)return this._commonBits=t,this._commonSignExp=$A.signExpBits(this._commonBits),this._isFirst=!1,null;if($A.signExpBits(t)!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=$A.numCommonMostSigMantissaBits(this._commonBits,t),this._commonBits=$A.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))},$A.prototype.toString=function(){if(1===arguments.length){var e=arguments[0],t=_.longBitsToDouble(e),i="0000000000000000000000000000000000000000000000000000000000000000"+_.toBinaryString(e),r=i.substring(i.length-64);return r.substring(0,1)+"  "+r.substring(1,12)+"(exp) "+r.substring(12)+" [ "+t+" ]"}},$A.prototype.interfaces_=function(){return[]},$A.prototype.getClass=function(){return $A},$A.getBit=function(e,t){return 0!=(e&1<<t)?1:0},$A.signExpBits=function(e){return e>>52},$A.zeroLowerBits=function(e,t){return e&~((1<<t)-1)},$A.numCommonMostSigMantissaBits=function(e,t){for(var i=0,r=52;r>=0;r--){if($A.getBit(e,r)!==$A.getBit(t,r))return i;i++}return 52},function(){this._commonCoord=null,this._ccFilter=new ip}),tp={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}},ip=(ep.prototype.addCommonBits=function(e){var t=new rp(this._commonCoord);e.apply(t),e.geometryChanged()},ep.prototype.removeCommonBits=function(e){if(0===this._commonCoord.x&&0===this._commonCoord.y)return e;var t=new C(this._commonCoord);t.x=-t.x,t.y=-t.y;var i=new rp(t);return e.apply(i),e.geometryChanged(),e},ep.prototype.getCommonCoordinate=function(){return this._commonCoord},ep.prototype.add=function(e){e.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},ep.prototype.interfaces_=function(){return[]},ep.prototype.getClass=function(){return ep},tp.CommonCoordinateFilter.get=function(){return ip},tp.Translater.get=function(){return rp},Object.defineProperties(ep,tp),function(){this._commonBitsX=new $A,this._commonBitsY=new $A}),rp=(ip.prototype.filter=function(e){this._commonBitsX.add(e.x),this._commonBitsY.add(e.y)},ip.prototype.getCommonCoordinate=function(){return new C(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},ip.prototype.interfaces_=function(){return[_u]},ip.prototype.getClass=function(){return ip},function(){this.trans=null;var e=arguments[0];this.trans=e}),np=(rp.prototype.filter=function(e,t){var i=e.getOrdinate(t,0)+this.trans.x,r=e.getOrdinate(t,1)+this.trans.y;e.setOrdinate(t,0,i),e.setOrdinate(t,1,r)},rp.prototype.isDone=function(){return!1},rp.prototype.isGeometryChanged=function(){return!0},rp.prototype.interfaces_=function(){return[qu]},rp.prototype.getClass=function(){return rp},function(e,t){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=e,this._geom[1]=t,this.computeSnapTolerance()}),op=(np.prototype.selfSnap=function(e){return new YA(e).snapTo(e,this._snapTolerance)},np.prototype.removeCommonBits=function(e){this._cbr=new ep,this._cbr.add(e[0]),this._cbr.add(e[1]);var t=new Array(2).fill(null);return t[0]=this._cbr.removeCommonBits(e[0].copy()),t[1]=this._cbr.removeCommonBits(e[1].copy()),t},np.prototype.prepareResult=function(e){return this._cbr.addCommonBits(e),e},np.prototype.getResultGeometry=function(e){var t=this.snap(this._geom),i=A.overlayOp(t[0],t[1],e);return this.prepareResult(i)},np.prototype.checkValid=function(e){e.isValid()||eu.out.println("Snapped geometry is invalid")},np.prototype.computeSnapTolerance=function(){this._snapTolerance=YA.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},np.prototype.snap=function(e){var t=this.removeCommonBits(e);return YA.snap(t[0],t[1],this._snapTolerance)},np.prototype.interfaces_=function(){return[]},np.prototype.getClass=function(){return np},np.overlayOp=function(e,t,i){return new np(e,t).getResultGeometry(i)},np.union=function(e,t){return np.overlayOp(e,t,A.UNION)},np.intersection=function(e,t){return np.overlayOp(e,t,A.INTERSECTION)},np.symDifference=function(e,t){return np.overlayOp(e,t,A.SYMDIFFERENCE)},np.difference=function(e,t){return np.overlayOp(e,t,A.DIFFERENCE)},function(e,t){this._geom=new Array(2).fill(null),this._geom[0]=e,this._geom[1]=t}),sp=(op.prototype.getResultGeometry=function(e){var t=null,i=!1,r=null;try{t=A.overlayOp(this._geom[0],this._geom[1],e);i=!0}catch(e){if(!(e instanceof lu))throw e;r=e}if(!i)try{t=np.overlayOp(this._geom[0],this._geom[1],e)}catch(e){throw e instanceof lu?r:e}return t},op.prototype.interfaces_=function(){return[]},op.prototype.getClass=function(){return op},op.overlayOp=function(e,t,i){return new op(e,t).getResultGeometry(i)},op.union=function(e,t){return op.overlayOp(e,t,A.UNION)},op.intersection=function(e,t){return op.overlayOp(e,t,A.INTERSECTION)},op.symDifference=function(e,t){return op.overlayOp(e,t,A.SYMDIFFERENCE)},op.difference=function(e,t){return op.overlayOp(e,t,A.DIFFERENCE)},function(){this.mce=null,this.chainIndex=null;var e=arguments[0],t=arguments[1];this.mce=e,this.chainIndex=t}),ap=(sp.prototype.computeIntersections=function(e,t){this.mce.computeIntersectsForChain(this.chainIndex,e.mce,e.chainIndex,t)},sp.prototype.interfaces_=function(){return[]},sp.prototype.getClass=function(){return sp},function e(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var t=arguments[0],i=arguments[1];this._eventType=e.DELETE,this._xValue=t,this._insertEvent=i}else if(3===arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2];this._eventType=e.INSERT,this._label=r,this._xValue=n,this._obj=o}}),lp={INSERT:{configurable:!0},DELETE:{configurable:!0}},up=(ap.prototype.isDelete=function(){return this._eventType===ap.DELETE},ap.prototype.setDeleteEventIndex=function(e){this._deleteEventIndex=e},ap.prototype.getObject=function(){return this._obj},ap.prototype.compareTo=function(e){var t=e;return this._xValue<t._xValue?-1:this._xValue>t._xValue?1:this._eventType<t._eventType?-1:this._eventType>t._eventType?1:0},ap.prototype.getInsertEvent=function(){return this._insertEvent},ap.prototype.isInsert=function(){return this._eventType===ap.INSERT},ap.prototype.isSameLabel=function(e){return null!==this._label&&this._label===e._label},ap.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},ap.prototype.interfaces_=function(){return[Ol]},ap.prototype.getClass=function(){return ap},lp.INSERT.get=function(){return 1},lp.DELETE.get=function(){return 2},Object.defineProperties(ap,lp),function(){}),cp=(up.prototype.interfaces_=function(){return[]},up.prototype.getClass=function(){return up},function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var e=arguments[0],t=arguments[1],i=arguments[2];this._li=e,this._includeProper=t,this._recordIsolated=i}),hp=(cp.prototype.isTrivialIntersection=function(e,t,i,r){if(e===i&&1===this._li.getIntersectionNum()){if(cp.isAdjacentSegments(t,r))return!0;if(e.isClosed()){var n=e.getNumPoints()-1;if(0===t&&r===n||0===r&&t===n)return!0}}return!1},cp.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},cp.prototype.setIsDoneIfProperInt=function(e){this._isDoneWhenProperInt=e},cp.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},cp.prototype.isBoundaryPointInternal=function(e,t){for(var i=t.iterator();i.hasNext();){var r=i.next().getCoordinate();if(e.isIntersection(r))return!0}return!1},cp.prototype.hasProperIntersection=function(){return this._hasProper},cp.prototype.hasIntersection=function(){return this._hasIntersection},cp.prototype.isDone=function(){return this._isDone},cp.prototype.isBoundaryPoint=function(e,t){return null!==t&&(!!this.isBoundaryPointInternal(e,t[0])||!!this.isBoundaryPointInternal(e,t[1]))},cp.prototype.setBoundaryNodes=function(e,t){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=e,this._bdyNodes[1]=t},cp.prototype.addIntersections=function(e,t,i,r){if(e===i&&t===r)return null;this.numTests++;var n=e.getCoordinates()[t],o=e.getCoordinates()[t+1],s=i.getCoordinates()[r],a=i.getCoordinates()[r+1];this._li.computeIntersection(n,o,s,a),this._li.hasIntersection()&&(this._recordIsolated&&(e.setIsolated(!1),i.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(e,t,i,r)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(e.addIntersections(this._li,t,0),i.addIntersections(this._li,r,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},cp.prototype.interfaces_=function(){return[]},cp.prototype.getClass=function(){return cp},cp.isAdjacentSegments=function(e,t){return 1===Math.abs(e-t)},function(e){function t(){e.call(this),this.events=new O,this.nOverlaps=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.prepareEvents=function(){ih.sort(this.events);for(var e=0;e<this.events.size();e++){var t=this.events.get(e);t.isDelete()&&t.getInsertEvent().setDeleteEventIndex(e)}},t.prototype.computeIntersections=function(){if(1===arguments.length){var e=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var t=0;t<this.events.size();t++){var i=this.events.get(t);if(i.isInsert()&&this.processOverlaps(t,i.getDeleteEventIndex(),i,e),e.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof cp&&w(arguments[0],Su)&&w(arguments[1],Su)){var r=arguments[0],n=arguments[1],o=arguments[2];this.addEdges(r,r),this.addEdges(n,n),this.computeIntersections(o)}else if("boolean"==typeof arguments[2]&&w(arguments[0],Su)&&arguments[1]instanceof cp){var s=arguments[0],a=arguments[1];arguments[2]?this.addEdges(s,null):this.addEdges(s),this.computeIntersections(a)}},t.prototype.addEdge=function(e,t){for(var i=e.getMonotoneChainEdge(),r=i.getStartIndexes(),n=0;n<r.length-1;n++){var o=new sp(i,n),s=new ap(t,i.getMinX(n),o);this.events.add(s),this.events.add(new ap(i.getMaxX(n),s))}},t.prototype.processOverlaps=function(e,t,i,r){for(var n=i.getObject(),o=e;o<t;o++){var s=this.events.get(o);if(s.isInsert()){var a=s.getObject();i.isSameLabel(s)||(n.computeIntersections(a,r),this.nOverlaps++)}}},t.prototype.addEdges=function(){if(1===arguments.length)for(var e=arguments[0].iterator();e.hasNext();){var t=e.next();this.addEdge(t,t)}else if(2===arguments.length)for(var i=arguments[0],r=arguments[1],n=i.iterator();n.hasNext();){var o=n.next();this.addEdge(o,r)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(up)),Ap=function(){this._min=_.POSITIVE_INFINITY,this._max=_.NEGATIVE_INFINITY},pp={NodeComparator:{configurable:!0}},fp=(Ap.prototype.getMin=function(){return this._min},Ap.prototype.intersects=function(e,t){return!(this._min>t||this._max<e)},Ap.prototype.getMax=function(){return this._max},Ap.prototype.toString=function(){return au.toLineString(new C(this._min,0),new C(this._max,0))},Ap.prototype.interfaces_=function(){return[]},Ap.prototype.getClass=function(){return Ap},pp.NodeComparator.get=function(){return fp},Object.defineProperties(Ap,pp),function(){}),dp=(fp.prototype.compare=function(e,t){var i=e,r=t,n=(i._min+i._max)/2,o=(r._min+r._max)/2;return n<o?-1:n>o?1:0},fp.prototype.interfaces_=function(){return[Ul]},fp.prototype.getClass=function(){return fp},function(r){function e(){r.call(this),this._item=null;var e=arguments[0],t=arguments[1],i=arguments[2];this._min=e,this._max=t,this._item=i}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.query=function(e,t,i){if(!this.intersects(e,t))return null;i.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ap)),gp=function(i){function e(){i.call(this),this._node1=null,this._node2=null;var e=arguments[0],t=arguments[1];this._node1=e,this._node2=t,this.buildExtent(this._node1,this._node2)}return i&&(e.__proto__=i),e.prototype=Object.create(i&&i.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(e,t){this._min=Math.min(e._min,t._min),this._max=Math.max(e._max,t._max)},e.prototype.query=function(e,t,i){if(!this.intersects(e,t))return null;null!==this._node1&&this._node1.query(e,t,i),null!==this._node2&&this._node2.query(e,t,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ap),mp=function(){this._leaves=new O,this._root=null,this._level=0},yp=(mp.prototype.buildTree=function(){ih.sort(this._leaves,new Ap.NodeComparator);for(var e=this._leaves,t=null,i=new O;;){if(this.buildLevel(e,i),1===i.size())return i.get(0);t=e,e=i,i=t}},mp.prototype.insert=function(e,t,i){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new dp(e,t,i))},mp.prototype.query=function(e,t,i){this.init(),this._root.query(e,t,i)},mp.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},mp.prototype.printNode=function(e){eu.out.println(au.toLineString(new C(e._min,this._level),new C(e._max,this._level)))},mp.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},mp.prototype.buildLevel=function(e,t){this._level++,t.clear();for(var i=0;i<e.size();i+=2){var r=e.get(i);if(null===(i+1<e.size()?e.get(i):null))t.add(r);else{var n=new gp(e.get(i),e.get(i+1));t.add(n)}}},mp.prototype.interfaces_=function(){return[]},mp.prototype.getClass=function(){return mp},function(){this._items=new O}),_p=(yp.prototype.visitItem=function(e){this._items.add(e)},yp.prototype.getItems=function(){return this._items},yp.prototype.interfaces_=function(){return[Jc]},yp.prototype.getClass=function(){return yp},function(){this._index=null;var e=arguments[0];if(!w(e,rc))throw new Fl("Argument must be Polygonal");this._index=new wp(e)}),vp={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}},Cp=(_p.prototype.locate=function(e){var t=new fu(e),i=new Cp(t);return this._index.query(e.y,e.y,i),t.getLocation()},_p.prototype.interfaces_=function(){return[Hh]},_p.prototype.getClass=function(){return _p},vp.SegmentVisitor.get=function(){return Cp},vp.IntervalIndexedGeometry.get=function(){return wp},Object.defineProperties(_p,vp),function(){this._counter=null;var e=arguments[0];this._counter=e}),wp=(Cp.prototype.visitItem=function(e){var t=e;this._counter.countSegment(t.getCoordinate(0),t.getCoordinate(1))},Cp.prototype.interfaces_=function(){return[Jc]},Cp.prototype.getClass=function(){return Cp},function(){this._index=new mp;var e=arguments[0];this.init(e)}),xp=(wp.prototype.init=function(e){for(var t=bA.getLines(e).iterator();t.hasNext();){var i=t.next().getCoordinates();this.addLine(i)}},wp.prototype.addLine=function(e){for(var t=1;t<e.length;t++){var i=new U(e[t-1],e[t]),r=Math.min(i.p0.y,i.p1.y),n=Math.max(i.p0.y,i.p1.y);this._index.insert(r,n,i)}},wp.prototype.query=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1],i=new yp;return this._index.query(e,t,i),i.getItems()}if(3===arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2];this._index.query(r,n,o)}},wp.prototype.interfaces_=function(){return[]},wp.prototype.getClass=function(){return wp},function(s){function o(){if(s.call(this),this._parentGeom=null,this._lineEdgeMap=new mc,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new EA,2===arguments.length){var e=arguments[0],t=arguments[1],i=vu.OGC_SFS_BOUNDARY_RULE;this._argIndex=e,this._parentGeom=t,this._boundaryNodeRule=i,null!==t&&this.add(t)}else if(3===arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2];this._argIndex=r,this._parentGeom=n,this._boundaryNodeRule=o,null!==n&&this.add(n)}}return s&&(o.__proto__=s),o.prototype=Object.create(s&&s.prototype),o.prototype.constructor=o,o.prototype.insertBoundaryPoint=function(e,t){var i=this._nodes.addNode(t).getLabel(),r=1;v.NONE;i.getLocation(e,R.ON)===v.BOUNDARY&&r++;var n=o.determineBoundary(this._boundaryNodeRule,r);i.setLocation(e,n)},o.prototype.computeSelfNodes=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return this.computeSelfNodes(e,t,!1)}if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2],o=new cp(i,!0,!1);o.setIsDoneIfProperInt(n);var s=this.createEdgeSetIntersector(),a=this._parentGeom instanceof sc||this._parentGeom instanceof nc||this._parentGeom instanceof ac,l=r||!a;return s.computeIntersections(this._edges,o,l),this.addSelfIntersectionNodes(this._argIndex),o}},o.prototype.computeSplitEdges=function(e){for(var t=this._edges.iterator();t.hasNext();)t.next().eiList.addSplitEdges(e)},o.prototype.computeEdgeIntersections=function(e,t,i){var r=new cp(t,i,!0);r.setBoundaryNodes(this.getBoundaryNodes(),e.getBoundaryNodes());return this.createEdgeSetIntersector().computeIntersections(this._edges,e._edges,r),r},o.prototype.getGeometry=function(){return this._parentGeom},o.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},o.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},o.prototype.addPoint=function(){if(arguments[0]instanceof ic){var e=arguments[0].getCoordinate();this.insertPoint(this._argIndex,e,v.INTERIOR)}else if(arguments[0]instanceof C){var t=arguments[0];this.insertPoint(this._argIndex,t,v.INTERIOR)}},o.prototype.addPolygon=function(e){this.addPolygonRing(e.getExteriorRing(),v.EXTERIOR,v.INTERIOR);for(var t=0;t<e.getNumInteriorRing();t++){var i=e.getInteriorRingN(t);this.addPolygonRing(i,v.INTERIOR,v.EXTERIOR)}},o.prototype.addEdge=function(e){this.insertEdge(e);var t=e.getCoordinates();this.insertPoint(this._argIndex,t[0],v.BOUNDARY),this.insertPoint(this._argIndex,t[t.length-1],v.BOUNDARY)},o.prototype.addLineString=function(e){var t=h.removeRepeatedPoints(e.getCoordinates());if(t.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=t[0],null;var i=new iA(t,new Nc(this._argIndex,v.INTERIOR));this._lineEdgeMap.put(e,i),this.insertEdge(i),D.isTrue(t.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,t[0]),this.insertBoundaryPoint(this._argIndex,t[t.length-1])},o.prototype.getInvalidPoint=function(){return this._invalidPoint},o.prototype.getBoundaryPoints=function(){for(var e=this.getBoundaryNodes(),t=new Array(e.size()).fill(null),i=0,r=e.iterator();r.hasNext();){var n=r.next();t[i++]=n.getCoordinate().copy()}return t},o.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},o.prototype.addSelfIntersectionNode=function(e,t,i){if(this.isBoundaryNode(e,t))return null;i===v.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(e,t):this.insertPoint(e,t,i)},o.prototype.addPolygonRing=function(e,t,i){if(e.isEmpty())return null;var r=h.removeRepeatedPoints(e.getCoordinates());if(r.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=r[0],null;var n=t,o=i;F.isCCW(r)&&(n=i,o=t);var s=new iA(r,new Nc(this._argIndex,v.BOUNDARY,n,o));this._lineEdgeMap.put(e,s),this.insertEdge(s),this.insertPoint(this._argIndex,r[0],v.BOUNDARY)},o.prototype.insertPoint=function(e,t,i){var r=this._nodes.addNode(t),n=r.getLabel();null===n?r._label=new Nc(e,i):n.setLocation(e,i)},o.prototype.createEdgeSetIntersector=function(){return new hp},o.prototype.addSelfIntersectionNodes=function(e){for(var t=this._edges.iterator();t.hasNext();)for(var i=t.next(),r=i.getLabel().getLocation(e),n=i.eiList.iterator();n.hasNext();){var o=n.next();this.addSelfIntersectionNode(e,o.coord,r)}},o.prototype.add=function(){if(1!==arguments.length)return s.prototype.add.apply(this,arguments);var e=arguments[0];if(e.isEmpty())return null;if(e instanceof ac&&(this._useBoundaryDeterminationRule=!1),e instanceof nc)this.addPolygon(e);else if(e instanceof ec)this.addLineString(e);else if(e instanceof ic)this.addPoint(e);else if(e instanceof oc)this.addCollection(e);else if(e instanceof ju)this.addCollection(e);else if(e instanceof ac)this.addCollection(e);else{if(!(e instanceof Ku))throw new Error(e.getClass().getName());this.addCollection(e)}},o.prototype.addCollection=function(e){for(var t=0;t<e.getNumGeometries();t++){var i=e.getGeometryN(t);this.add(i)}},o.prototype.locate=function(e){return w(this._parentGeom,rc)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new _p(this._parentGeom)),this._areaPtLocator.locate(e)):this._ptLocator.locate(e,this._parentGeom)},o.prototype.findEdge=function(){if(1===arguments.length){var e=arguments[0];return this._lineEdgeMap.get(e)}return s.prototype.findEdge.apply(this,arguments)},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o.determineBoundary=function(e,t){return e.isInBoundary(t)?v.BOUNDARY:v.INTERIOR},o}(Kc)),bp=function(){if(this._li=new Au,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var e=arguments[0];this.setComputationPrecision(e.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new xp(0,e)}else if(2===arguments.length){var t=arguments[0],i=arguments[1],r=vu.OGC_SFS_BOUNDARY_RULE;t.getPrecisionModel().compareTo(i.getPrecisionModel())>=0?this.setComputationPrecision(t.getPrecisionModel()):this.setComputationPrecision(i.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new xp(0,t,r),this._arg[1]=new xp(1,i,r)}else if(3===arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2];n.getPrecisionModel().compareTo(o.getPrecisionModel())>=0?this.setComputationPrecision(n.getPrecisionModel()):this.setComputationPrecision(o.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new xp(0,n,s),this._arg[1]=new xp(1,o,s)}},Ep=(bp.prototype.getArgGeometry=function(e){return this._arg[e].getGeometry()},bp.prototype.setComputationPrecision=function(e){this._resultPrecisionModel=e,this._li.setPrecisionModel(this._resultPrecisionModel)},bp.prototype.interfaces_=function(){return[]},bp.prototype.getClass=function(){return bp},function(){}),A=(Ep.prototype.interfaces_=function(){return[]},Ep.prototype.getClass=function(){return Ep},Ep.map=function(){if(arguments[0]instanceof N&&w(arguments[1],Ep.MapOp)){for(var e=arguments[0],t=arguments[1],i=new O,r=0;r<e.getNumGeometries();r++){var n=t.map(e.getGeometryN(r));null!==n&&i.add(n)}return e.getFactory().buildGeometry(i)}if(w(arguments[0],Bu)&&w(arguments[1],Ep.MapOp)){for(var o=arguments[0],s=arguments[1],a=new O,l=o.iterator();l.hasNext();){var u=l.next(),c=s.map(u);null!==c&&a.add(c)}return a}},Ep.MapOp=function(){},function(i){function o(){var e=arguments[0],t=arguments[1];i.call(this,e,t),this._ptLocator=new EA,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Kh,this._resultPolyList=new O,this._resultLineList=new O,this._resultPointList=new O,this._graph=new Kc(new Wh),this._geomFact=e.getFactory()}return i&&(o.__proto__=i),o.prototype=Object.create(i&&i.prototype),o.prototype.constructor=o,o.prototype.insertUniqueEdge=function(e){var t=this._edgeList.findEqualEdge(e);if(null!==t){var i=t.getLabel(),r=e.getLabel();t.isPointwiseEqual(e)||(r=new Nc(e.getLabel())).flip();var n=t.getDepth();n.isNull()&&n.add(i),n.add(r),i.merge(r)}else this._edgeList.add(e)},o.prototype.getGraph=function(){return this._graph},o.prototype.cancelDuplicateResultEdges=function(){for(var e=this._graph.getEdgeEnds().iterator();e.hasNext();){var t=e.next(),i=t.getSym();t.isInResult()&&i.isInResult()&&(t.setInResult(!1),i.setInResult(!1))}},o.prototype.isCoveredByLA=function(e){return!!this.isCovered(e,this._resultLineList)||!!this.isCovered(e,this._resultPolyList)},o.prototype.computeGeometry=function(e,t,i,r){var n=new O;return n.addAll(e),n.addAll(t),n.addAll(i),n.isEmpty()?o.createEmptyResult(r,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(n)},o.prototype.mergeSymLabels=function(){for(var e=this._graph.getNodes().iterator();e.hasNext();)e.next().getEdges().mergeSymLabels()},o.prototype.isCovered=function(e,t){for(var i=t.iterator();i.hasNext();){var r=i.next();if(this._ptLocator.locate(e,r)!==v.EXTERIOR)return!0}return!1},o.prototype.replaceCollapsedEdges=function(){for(var e=new O,t=this._edgeList.iterator();t.hasNext();){var i=t.next();i.isCollapsed()&&(t.remove(),e.add(i.getCollapsedEdge()))}this._edgeList.addAll(e)},o.prototype.updateNodeLabelling=function(){for(var e=this._graph.getNodes().iterator();e.hasNext();){var t=e.next(),i=t.getEdges().getLabel();t.getLabel().merge(i)}},o.prototype.getResultGeometry=function(e){return this.computeOverlay(e),this._resultGeom},o.prototype.insertUniqueEdges=function(e){for(var t=e.iterator();t.hasNext();){var i=t.next();this.insertUniqueEdge(i)}},o.prototype.computeOverlay=function(e){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var t=new O;this._arg[0].computeSplitEdges(t),this._arg[1].computeSplitEdges(t),this.insertUniqueEdges(t),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),zA.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(e),this.cancelDuplicateResultEdges();var i=new jc(this._geomFact);i.add(this._graph),this._resultPolyList=i.getPolygons();var r=new qA(this,this._geomFact,this._ptLocator);this._resultLineList=r.build(e);var n=new KA(this,this._geomFact,this._ptLocator);this._resultPointList=n.build(e),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,e)},o.prototype.labelIncompleteNode=function(e,t){var i=this._ptLocator.locate(e.getCoordinate(),this._arg[t].getGeometry());e.getLabel().setLocation(t,i)},o.prototype.copyPoints=function(e){for(var t=this._arg[e].getNodeIterator();t.hasNext();){var i=t.next();this._graph.addNode(i.getCoordinate()).setLabel(e,i.getLabel().getLocation(e))}},o.prototype.findResultAreaEdges=function(e){for(var t=this._graph.getEdgeEnds().iterator();t.hasNext();){var i=t.next(),r=i.getLabel();r.isArea()&&!i.isInteriorAreaEdge()&&o.isResultOfOp(r.getLocation(0,R.RIGHT),r.getLocation(1,R.RIGHT),e)&&i.setInResult(!0)}},o.prototype.computeLabelsFromDepths=function(){for(var e=this._edgeList.iterator();e.hasNext();){var t=e.next(),i=t.getLabel(),r=t.getDepth();if(!r.isNull()){r.normalize();for(var n=0;n<2;n++)i.isNull(n)||!i.isArea()||r.isNull(n)||(0===r.getDelta(n)?i.toLine(n):(D.isTrue(!r.isNull(n,R.LEFT),"depth of LEFT side has not been initialized"),i.setLocation(n,R.LEFT,r.getLocation(n,R.LEFT)),D.isTrue(!r.isNull(n,R.RIGHT),"depth of RIGHT side has not been initialized"),i.setLocation(n,R.RIGHT,r.getLocation(n,R.RIGHT))))}}},o.prototype.computeLabelling=function(){for(var e=this._graph.getNodes().iterator();e.hasNext();)e.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},o.prototype.labelIncompleteNodes=function(){for(var e=this._graph.getNodes().iterator();e.hasNext();){var t=e.next(),i=t.getLabel();t.isIsolated()&&(i.isNull(0)?this.labelIncompleteNode(t,0):this.labelIncompleteNode(t,1)),t.getEdges().updateLabelling(i)}},o.prototype.isCoveredByA=function(e){return!!this.isCovered(e,this._resultPolyList)},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o}(bp)),Bp=(A.overlayOp=function(e,t,i){return new A(e,t).getResultGeometry(i)},A.intersection=function(e,t){if(e.isEmpty()||t.isEmpty())return A.createEmptyResult(A.INTERSECTION,e,t,e.getFactory());if(e.isGeometryCollection()){var i=t;return WA.map(e,{interfaces_:function(){return[Ep.MapOp]},map:function(e){return e.intersection(i)}})}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),op.overlayOp(e,t,A.INTERSECTION)},A.symDifference=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return A.createEmptyResult(A.SYMDIFFERENCE,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),op.overlayOp(e,t,A.SYMDIFFERENCE)},A.resultDimension=function(e,t,i){var r=t.getDimension(),n=i.getDimension(),o=-1;switch(e){case A.INTERSECTION:o=Math.min(r,n);break;case A.UNION:o=Math.max(r,n);break;case A.DIFFERENCE:o=r;break;case A.SYMDIFFERENCE:o=Math.max(r,n)}return o},A.createEmptyResult=function(e,t,i,r){var n=null;switch(A.resultDimension(e,t,i)){case-1:n=r.createGeometryCollection(new Array(0).fill(null));break;case 0:n=r.createPoint();break;case 1:n=r.createLineString();break;case 2:n=r.createPolygon()}return n},A.difference=function(e,t){return e.isEmpty()?A.createEmptyResult(A.DIFFERENCE,e,t,e.getFactory()):t.isEmpty()?e.copy():(e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),op.overlayOp(e,t,A.DIFFERENCE))},A.isResultOfOp=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1],i=e.getLocation(0),r=e.getLocation(1);return A.isResultOfOp(i,r,t)}if(3===arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2];switch(n===v.BOUNDARY&&(n=v.INTERIOR),o===v.BOUNDARY&&(o=v.INTERIOR),s){case A.INTERSECTION:return n===v.INTERIOR&&o===v.INTERIOR;case A.UNION:return n===v.INTERIOR||o===v.INTERIOR;case A.DIFFERENCE:return n===v.INTERIOR&&o!==v.INTERIOR;case A.SYMDIFFERENCE:return n===v.INTERIOR&&o!==v.INTERIOR||n!==v.INTERIOR&&o===v.INTERIOR}return!1}},A.INTERSECTION=1,A.UNION=2,A.DIFFERENCE=3,A.SYMDIFFERENCE=4,function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new EA,this._seg=new U;var e=arguments[0],t=arguments[1];this._g=e,this._boundaryDistanceTolerance=t,this._linework=this.extractLinework(e)}),Mp=(Bp.prototype.isWithinToleranceOfBoundary=function(e){for(var t=0;t<this._linework.getNumGeometries();t++)for(var i=this._linework.getGeometryN(t).getCoordinateSequence(),r=0;r<i.size()-1;r++){i.getCoordinate(r,this._seg.p0),i.getCoordinate(r+1,this._seg.p1);if(this._seg.distance(e)<=this._boundaryDistanceTolerance)return!0}return!1},Bp.prototype.getLocation=function(e){return this.isWithinToleranceOfBoundary(e)?v.BOUNDARY:this._ptLocator.locate(e,this._g)},Bp.prototype.extractLinework=function(e){var t=new Mp;e.apply(t);var i=t.getLinework(),r=l.toLineStringArray(i);return e.getFactory().createMultiLineString(r)},Bp.prototype.interfaces_=function(){return[]},Bp.prototype.getClass=function(){return Bp},function(){this._linework=null,this._linework=new O}),Ip=(Mp.prototype.getLinework=function(){return this._linework},Mp.prototype.filter=function(e){if(e instanceof nc){var t=e;this._linework.add(t.getExteriorRing());for(var i=0;i<t.getNumInteriorRing();i++)this._linework.add(t.getInteriorRingN(i))}},Mp.prototype.interfaces_=function(){return[Wu]},Mp.prototype.getClass=function(){return Mp},function(){this._g=null,this._doLeft=!0,this._doRight=!0;var e=arguments[0];this._g=e}),Sp=(Ip.prototype.extractPoints=function(e,t,i){for(var r=e.getCoordinates(),n=0;n<r.length-1;n++)this.computeOffsetPoints(r[n],r[n+1],t,i)},Ip.prototype.setSidesToGenerate=function(e,t){this._doLeft=e,this._doRight=t},Ip.prototype.getPoints=function(e){for(var t=new O,i=bA.getLines(this._g).iterator();i.hasNext();){var r=i.next();this.extractPoints(r,e,t)}return t},Ip.prototype.computeOffsetPoints=function(e,t,i,r){var n=t.x-e.x,o=t.y-e.y,s=Math.sqrt(n*n+o*o),a=i*n/s,l=i*o/s,u=(t.x+e.x)/2,c=(t.y+e.y)/2;if(this._doLeft){var h=new C(u-l,c+a);r.add(h)}if(this._doRight){var A=new C(u+l,c-a);r.add(A)}},Ip.prototype.interfaces_=function(){return[]},Ip.prototype.getClass=function(){return Ip},function e(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=e.TOLERANCE,this._testCoords=new O;var t=arguments[0],i=arguments[1],r=arguments[2];this._boundaryDistanceTolerance=e.computeBoundaryDistanceTolerance(t,i),this._geom=[t,i,r],this._locFinder=[new Bp(this._geom[0],this._boundaryDistanceTolerance),new Bp(this._geom[1],this._boundaryDistanceTolerance),new Bp(this._geom[2],this._boundaryDistanceTolerance)]}),Pp={TOLERANCE:{configurable:!0}},Tp=(Sp.prototype.reportResult=function(e,t,i){eu.out.println("Overlay result invalid - A:"+v.toLocationSymbol(t[0])+" B:"+v.toLocationSymbol(t[1])+" expected:"+(i?"i":"e")+" actual:"+v.toLocationSymbol(t[2]))},Sp.prototype.isValid=function(e){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var t=this.checkValid(e);return t},Sp.prototype.checkValid=function(){if(1===arguments.length){for(var e=arguments[0],t=0;t<this._testCoords.size();t++){var i=this._testCoords.get(t);if(!this.checkValid(e,i))return this._invalidLocation=i,!1}return!0}if(2===arguments.length){var r=arguments[0],n=arguments[1];return this._location[0]=this._locFinder[0].getLocation(n),this._location[1]=this._locFinder[1].getLocation(n),this._location[2]=this._locFinder[2].getLocation(n),!!Sp.hasLocation(this._location,v.BOUNDARY)||this.isValidResult(r,this._location)}},Sp.prototype.addTestPts=function(e){var t=new Ip(e);this._testCoords.addAll(t.getPoints(5*this._boundaryDistanceTolerance))},Sp.prototype.isValidResult=function(e,t){var i=A.isResultOfOp(t[0],t[1],e),r=!(i^t[2]===v.INTERIOR);return r||this.reportResult(e,t,i),r},Sp.prototype.getInvalidLocation=function(){return this._invalidLocation},Sp.prototype.interfaces_=function(){return[]},Sp.prototype.getClass=function(){return Sp},Sp.hasLocation=function(e,t){for(var i=0;i<3;i++)if(e[i]===t)return!0;return!1},Sp.computeBoundaryDistanceTolerance=function(e,t){return Math.min(YA.computeSizeBasedSnapTolerance(e),YA.computeSizeBasedSnapTolerance(t))},Sp.isValid=function(e,t,i,r){return new Sp(e,t,r).isValid(i)},Pp.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(Sp,Pp),function e(t){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=e.extractFactory(t),this._inputGeoms=t}),Lp=(Tp.prototype.extractElements=function(e,t){if(null===e)return null;for(var i=0;i<e.getNumGeometries();i++){var r=e.getGeometryN(i);this._skipEmpty&&r.isEmpty()||t.add(r)}},Tp.prototype.combine=function(){for(var e=new O,t=this._inputGeoms.iterator();t.hasNext();){var i=t.next();this.extractElements(i,e)}return 0===e.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(e)},Tp.prototype.interfaces_=function(){return[]},Tp.prototype.getClass=function(){return Tp},Tp.combine=function(){if(1===arguments.length){var e=arguments[0];return new Tp(e).combine()}if(2===arguments.length){var t=arguments[0],i=arguments[1];return new Tp(Tp.createList(t,i)).combine()}if(3===arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2];return new Tp(Tp.createList(r,n,o)).combine()}},Tp.extractFactory=function(e){return e.isEmpty()?null:e.iterator().next().getFactory()},Tp.createList=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1],i=new O;return i.add(e),i.add(t),i}if(3===arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2],s=new O;return s.add(r),s.add(n),s.add(o),s}},function(){this._inputPolys=null,this._geomFactory=null;var e=arguments[0];this._inputPolys=e,null===this._inputPolys&&(this._inputPolys=new O)}),Dp={STRTREE_NODE_CAPACITY:{configurable:!0}},Fp=(Lp.prototype.reduceToGeometries=function(e){for(var t=new O,i=e.iterator();i.hasNext();){var r=i.next(),n=null;w(r,Su)?n=this.unionTree(r):r instanceof N&&(n=r),t.add(n)}return t},Lp.prototype.extractByEnvelope=function(e,t,i){for(var r=new O,n=0;n<t.getNumGeometries();n++){var o=t.getGeometryN(n);o.getEnvelopeInternal().intersects(e)?r.add(o):i.add(o)}return this._geomFactory.buildGeometry(r)},Lp.prototype.unionOptimized=function(e,t){var i=e.getEnvelopeInternal(),r=t.getEnvelopeInternal();if(!i.intersects(r))return Tp.combine(e,t);if(e.getNumGeometries()<=1&&t.getNumGeometries()<=1)return this.unionActual(e,t);var n=i.intersection(r);return this.unionUsingEnvelopeIntersection(e,t,n)},Lp.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var e=new lh(Lp.STRTREE_NODE_CAPACITY),t=this._inputPolys.iterator();t.hasNext();){var i=t.next();e.insert(i.getEnvelopeInternal(),i)}this._inputPolys=null;var r=e.itemsTree();return this.unionTree(r)},Lp.prototype.binaryUnion=function(){if(1===arguments.length){var e=arguments[0];return this.binaryUnion(e,0,e.size())}if(3===arguments.length){var t=arguments[0],i=arguments[1],r=arguments[2];if(r-i<=1){var n=Lp.getGeometry(t,i);return this.unionSafe(n,null)}if(r-i==2)return this.unionSafe(Lp.getGeometry(t,i),Lp.getGeometry(t,i+1));var o=Math.trunc((r+i)/2),s=this.binaryUnion(t,i,o),a=this.binaryUnion(t,o,r);return this.unionSafe(s,a)}},Lp.prototype.repeatedUnion=function(e){for(var t=null,i=e.iterator();i.hasNext();){var r=i.next();t=null===t?r.copy():t.union(r)}return t},Lp.prototype.unionSafe=function(e,t){return null===e&&null===t?null:null===e?t.copy():null===t?e.copy():this.unionOptimized(e,t)},Lp.prototype.unionActual=function(e,t){return Lp.restrictToPolygons(e.union(t))},Lp.prototype.unionTree=function(e){var t=this.reduceToGeometries(e);return this.binaryUnion(t)},Lp.prototype.unionUsingEnvelopeIntersection=function(e,t,i){var r=new O,n=this.extractByEnvelope(i,e,r),o=this.extractByEnvelope(i,t,r),s=this.unionActual(n,o);r.add(s);return Tp.combine(r)},Lp.prototype.bufferUnion=function(){if(1===arguments.length){var e=arguments[0];return e.get(0).getFactory().buildGeometry(e).buffer(0)}if(2===arguments.length){var t=arguments[0],i=arguments[1];return t.getFactory().createGeometryCollection([t,i]).buffer(0)}},Lp.prototype.interfaces_=function(){return[]},Lp.prototype.getClass=function(){return Lp},Lp.restrictToPolygons=function(e){if(w(e,rc))return e;var t=xA.getPolygons(e);return 1===t.size()?t.get(0):e.getFactory().createMultiPolygon(l.toPolygonArray(t))},Lp.getGeometry=function(e,t){return t>=e.size()?null:e.get(t)},Lp.union=function(e){return new Lp(e).union()},Dp.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(Lp,Dp),function(){}),Np=(Fp.prototype.interfaces_=function(){return[]},Fp.prototype.getClass=function(){return Fp},Fp.union=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return A.createEmptyResult(A.UNION,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),op.overlayOp(e,t,A.UNION)},function(){return new wo}),Op=(wo.prototype={constructor:wo,reset:function(){this.s=this.t=0},add:function(e){xo(Op,e,this.t),xo(this,Op.s,this.s),this.s?this.t+=Op.t:this.s=Op.t},valueOf:function(){return this.s}},new wo),Rp=1e-6,Up=Math.PI,kp=Up/2,Hp=Up/4,Qp=2*Up,Vp=180/Up,Gp=Up/180,zp=Math.abs,Wp=Math.atan,qp=Math.atan2,Kp=Math.cos,jp=Math.exp,Zp=Math.log,Yp=Math.sin,Xp=Math.sqrt,Jp=Math.tan,$p={Feature:function(e,t){Bo(e.geometry,t)},FeatureCollection:function(e,t){for(var i=e.features,r=-1,n=i.length;++r<n;)Bo(i[r].geometry,t)}},ef={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var i=e.coordinates,r=-1,n=i.length;++r<n;)e=i[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){Mo(e.coordinates,t,0)},MultiLineString:function(e,t){for(var i=e.coordinates,r=-1,n=i.length;++r<n;)Mo(i[r],t,0)},Polygon:function(e,t){Io(e.coordinates,t)},MultiPolygon:function(e,t){for(var i=e.coordinates,r=-1,n=i.length;++r<n;)Io(i[r],t)},GeometryCollection:function(e,t){for(var i=e.geometries,r=-1,n=i.length;++r<n;)Bo(i[r],t)}},tf=function(e,t){e&&$p.hasOwnProperty(e.type)?$p[e.type](e,t):Bo(e,t)},rf=(Np(),Np(),Np(),function(i,r){function e(e,t){return e=i(e,t),r(e[0],e[1])}return i.invert&&r.invert&&(e.invert=function(e,t){return(e=r.invert(e,t))&&i.invert(e[0],e[1])}),e}),nf=(Oo.invert=Oo,function(t){function e(e){return e=t(e[0]*Gp,e[1]*Gp),e[0]*=Vp,e[1]*=Vp,e}return t=Ro(t[0]*Gp,t[1]*Gp,t.length>2?t[2]*Gp:0),e.invert=function(e){return e=t.invert(e[0]*Gp,e[1]*Gp),e[0]*=Vp,e[1]*=Vp,e},e}),of=function(){var i,t=[];return{point:function(e,t){i.push([e,t])},lineStart:function(){t.push(i=[])},lineEnd:Eo,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var e=t;return t=[],i=null,e}}},sf=function(e,t,i,r,n,o){var s,a=e[0],l=e[1],u=0,c=1,h=t[0]-a,A=t[1]-l;if(s=i-a,h||!(s>0)){if(s/=h,h<0){if(s<u)return;s<c&&(c=s)}else if(h>0){if(s>c)return;s>u&&(u=s)}if(s=n-a,h||!(s<0)){if(s/=h,h<0){if(s>c)return;s>u&&(u=s)}else if(h>0){if(s<u)return;s<c&&(c=s)}if(s=r-l,A||!(s>0)){if(s/=A,A<0){if(s<u)return;s<c&&(c=s)}else if(A>0){if(s>c)return;s>u&&(u=s)}if(s=o-l,A||!(s<0)){if(s/=A,A<0){if(s>c)return;s>u&&(u=s)}else if(A>0){if(s<u)return;s<c&&(c=s)}return u>0&&(e[0]=a+u*h,e[1]=l+u*A),c<1&&(t[0]=a+c*h,t[1]=l+c*A),!0}}}}},af=function(e,t){return zp(e[0]-t[0])<Rp&&zp(e[1]-t[1])<Rp},lf=function(e,t,i,r,o){var s,n,a=[],l=[];if(e.forEach(function(e){if(!((t=e.length-1)<=0)){var t,i,r=e[0],n=e[t];if(af(r,n)){for(o.lineStart(),s=0;s<t;++s)o.point((r=e[s])[0],r[1]);o.lineEnd()}else a.push(i=new Vo(r,e,null,!0)),l.push(i.o=new Vo(r,null,i,!1)),a.push(i=new Vo(n,e,null,!1)),l.push(i.o=new Vo(n,null,i,!0))}}),a.length){for(l.sort(t),Go(a),Go(l),s=0,n=l.length;s<n;++s)l[s].e=i=!i;for(var u,c,h=a[0];;){for(var A=h,p=!0;A.v;)if((A=A.n)===h)return;u=A.z,o.lineStart();do{if(A.v=A.o.v=!0,A.e){if(p)for(s=0,n=u.length;s<n;++s)o.point((c=u[s])[0],c[1]);else r(A.x,A.n.x,1,o);A=A.n}else{if(p)for(u=A.p.z,s=u.length-1;s>=0;--s)o.point((c=u[s])[0],c[1]);else r(A.x,A.p.x,-1,o);A=A.p}u=(A=A.o).z,p=!p}while(!A.v);o.lineEnd()}}},uf=function(e,t){return e<t?-1:e>t?1:e>=t?0:NaN},cf=(function(e){1===e.length&&(e=function(i){return function(e,t){return uf(i(e),t)}}(e))}(uf),function(e){for(var t,i,r,n=e.length,o=-1,s=0;++o<n;)s+=e[o].length;for(i=new Array(s);--n>=0;)for(t=(r=e[n]).length;--t>=0;)i[--s]=r[t];return i}),hf=1e9,Af=-hf,pf=Np(),ff=(Np(),function(e){return e}),df=(Np(),Np(),1/0),gf=df,mf=-df,yf=mf,_f={point:function(e,t){e<df&&(df=e),e>mf&&(mf=e),t<gf&&(gf=t),t>yf&&(yf=t)},lineStart:Eo,lineEnd:Eo,polygonStart:Eo,polygonEnd:Eo,result:function(){var e=[[df,gf],[mf,yf]];return mf=yf=-(gf=df=1/0),e}},vf=(Np(),function(y,_,v,C){return function(r,a){function t(e,t){var i=r(e,t);y(e=i[0],t=i[1])&&a.point(e,t)}function e(e,t){var i=r(e,t);A.point(i[0],i[1])}function i(){m.point=e,A.lineStart()}function n(){m.point=t,A.lineEnd()}function l(e,t){h.push([e,t]);var i=r(e,t);d.point(i[0],i[1])}function o(){d.lineStart(),h=[]}function s(){l(h[0][0],h[0][1]),d.lineEnd();var e,t,i,r,n=d.clean(),o=f.result(),s=o.length;if(h.pop(),u.push(h),h=null,s)if(1&n){if(i=o[0],(t=i.length-1)>0){for(g||(a.polygonStart(),g=!0),a.lineStart(),e=0;e<t;++e)a.point((r=i[e])[0],r[1]);a.lineEnd()}}else s>1&&2&n&&o.push(o.pop().concat(o.shift())),c.push(o.filter(Wo))}var u,c,h,A=_(a),p=r.invert(C[0],C[1]),f=of(),d=_(f),g=!1,m={point:t,lineStart:i,lineEnd:n,polygonStart:function(){m.point=l,m.lineStart=o,m.lineEnd=s,c=[],u=[]},polygonEnd:function(){m.point=t,m.lineStart=i,m.lineEnd=n,c=cf(c);var e=function(e,t){var i=t[0],r=t[1],n=[Yp(i),-Kp(i),0],o=0,s=0;pf.reset();for(var a=0,l=e.length;a<l;++a)if(c=(u=e[a]).length)for(var u,c,h=u[c-1],A=h[0],p=h[1]/2+Hp,f=Yp(p),d=Kp(p),g=0;g<c;++g,A=y,f=v,d=C,h=m){var m=u[g],y=m[0],_=m[1]/2+Hp,v=Yp(_),C=Kp(_),w=y-A,x=w>=0?1:-1,b=x*w,E=b>Up,B=f*v;if(pf.add(qp(B*x*Yp(b),d*C+B*Kp(b))),o+=E?w+x*Qp:w,E^A>=i^y>=i){var M=Lo(Po(h),Po(m));No(M);var I=Lo(n,M);No(I);var S=(E^w>=0?-1:1)*bo(I[2]);(r>S||r===S&&(M[0]||M[1]))&&(s+=E^w>=0?1:-1)}}return(o<-Rp||o<Rp&&pf<-Rp)^1&s}(u,p);c.length?(g||(a.polygonStart(),g=!0),lf(c,qo,e,v,a)):e&&(g||(a.polygonStart(),g=!0),a.lineStart(),v(null,null,1,a),a.lineEnd()),g&&(a.polygonEnd(),g=!1),c=u=null},sphere:function(){a.polygonStart(),a.lineStart(),v(null,null,1,a),a.lineEnd(),a.polygonEnd()}};return m}}),Cf=vf(function(){return!0},function(n){var o,s=NaN,a=NaN,l=NaN;return{lineStart:function(){n.lineStart(),o=1},point:function(e,t){var i=e>0?Up:-Up,r=zp(e-s);zp(r-Up)<Rp?(n.point(s,a=(a+t)/2>0?kp:-kp),n.point(l,a),n.lineEnd(),n.lineStart(),n.point(i,a),n.point(e,a),o=0):l!==i&&r>=Up&&(zp(s-l)<Rp&&(s-=l*Rp),zp(e-i)<Rp&&(e-=i*Rp),a=function(e,t,i,r){var n,o,s=Yp(e-i);return zp(s)>Rp?Wp((Yp(t)*(o=Kp(r))*Yp(i)-Yp(r)*(n=Kp(t))*Yp(e))/(n*o*s)):(t+r)/2}(s,a,e,t),n.point(l,a),n.lineEnd(),n.lineStart(),n.point(i,a),o=0),n.point(s=e,a=t),l=i},lineEnd:function(){n.lineEnd(),s=a=NaN},clean:function(){return 2-o}}},function(e,t,i,r){var n;if(null==e)n=i*kp,r.point(-Up,n),r.point(0,n),r.point(Up,n),r.point(Up,0),r.point(Up,-n),r.point(0,-n),r.point(-Up,-n),r.point(-Up,0),r.point(-Up,n);else if(zp(e[0]-t[0])>Rp){var o=e[0]<t[0]?Up:-Up;n=i*o/2,r.point(-o,n),r.point(0,n),r.point(o,n)}else r.point(t[0],t[1])},[-Up,-kp]),wf=function(n,o){function p(e,t){return Kp(e)*Kp(t)>B}function f(e,t,i){var r=[1,0,0],n=Lo(Po(e),Po(t)),o=To(n,n),s=n[0],a=o-s*s;if(!a)return!i&&e;var l=B*o/a,u=-B*s/a,c=Lo(r,n),h=Fo(r,l);Do(h,Fo(n,u));var A=c,p=To(h,A),f=To(A,A),d=p*p-f*(To(h,h)-1);if(!(d<0)){var g=Xp(d),m=Fo(A,(-p-g)/f);if(Do(m,h),m=So(m),!i)return m;var y,_=e[0],v=t[0],C=e[1],w=t[1];v<_&&(y=_,_=v,v=y);var x=v-_,b=zp(x-Up)<Rp;if(!b&&w<C&&(y=C,C=w,w=y),b||x<Rp?b?C+w>0^m[1]<(zp(m[0]-_)<Rp?C:w):C<=m[1]&&m[1]<=w:x>Up^(_<=m[0]&&m[0]<=v)){var E=Fo(A,(-p+g)/f);return Do(E,h),[m,So(E)]}}}function d(e,t){var i=g?n:Up-n,r=0;return e<-i?r|=1:e>i&&(r|=2),t<-i?r|=4:t>i&&(r|=8),r}var B=Kp(n),g=B>0,m=zp(B)>Rp;return vf(p,function(a){var l,u,c,h,A;return{lineStart:function(){h=c=!1,A=1},point:function(e,t){var i,r=[e,t],n=p(e,t),o=g?n?0:d(e,t):n?d(e+(e<0?Up:-Up),t):0;if(!l&&(h=c=n)&&a.lineStart(),n!==c&&(!(i=f(l,r))||af(l,i)||af(r,i))&&(r[0]+=Rp,r[1]+=Rp,n=p(r[0],r[1])),n!==c)A=0,n?(a.lineStart(),i=f(r,l),a.point(i[0],i[1])):(i=f(l,r),a.point(i[0],i[1]),a.lineEnd()),l=i;else if(m&&l&&g^n){var s;o&u||!(s=f(r,l,!0))||(A=0,g?(a.lineStart(),a.point(s[0][0],s[0][1]),a.point(s[1][0],s[1][1]),a.lineEnd()):(a.point(s[1][0],s[1][1]),a.lineEnd(),a.lineStart(),a.point(s[0][0],s[0][1])))}!n||l&&af(l,r)||a.point(r[0],r[1]),l=r,c=n,u=o},lineEnd:function(){c&&a.lineEnd(),l=null},clean:function(){return A|(h&&c)<<1}}},function(e,t,i,r){!function(e,t,i,r,n,o){if(i){var s=Kp(t),a=Yp(t),l=r*i;null==n?(n=t+r*Qp,o=t-l/2):(n=Qo(s,n),o=Qo(s,o),(r>0?n<o:n>o)&&(n+=r*Qp));for(var u,c=n;r>0?c>o:c<o;c-=l)u=So([s,-a*Kp(c),-a*Yp(c)]),e.point(u[0],u[1])}}(r,n,o,i,e,t)},g?[0,-n]:[-Up,n-Up])},xf=(jo.prototype={constructor:jo,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},16),bf=Kp(30*Gp),Ef=function(e,t){return+t?function(S,P){function T(e,t,i,r,n,o,s,a,l,u,c,h,A,p){var f=s-e,d=a-t,g=f*f+d*d;if(g>4*P&&A--){var m=r+u,y=n+c,_=o+h,v=Xp(m*m+y*y+_*_),C=bo(_/=v),w=zp(zp(_)-1)<Rp||zp(i-l)<Rp?(i+l)/2:qp(y,m),x=S(w,C),b=x[0],E=x[1],B=b-e,M=E-t,I=d*B-f*M;(I*I/g>P||zp((f*B+d*M)/g-.5)>.3||r*u+n*c+o*h<bf)&&(T(e,t,i,r,n,o,b,E,w,m/=v,y/=v,_,A,p),p.point(b,E),T(b,E,w,m,y,_,s,a,l,u,c,h,A,p))}}return function(n){function e(e,t){e=S(e,t),n.point(e[0],e[1])}function t(){d=NaN,v.point=i,n.lineStart()}function i(e,t){var i=Po([e,t]),r=S(e,t);T(d,g,f,m,y,_,d=r[0],g=r[1],f=e,m=i[0],y=i[1],_=i[2],xf,n),n.point(d,g)}function r(){v.point=e,n.lineEnd()}function o(){t(),v.point=s,v.lineEnd=a}function s(e,t){i(l=e,t),u=d,c=g,h=m,A=y,p=_,v.point=i}function a(){T(d,g,f,m,y,_,u,c,l,h,A,p,xf,n),v.lineEnd=r,r()}var l,u,c,h,A,p,f,d,g,m,y,_,v={point:e,lineStart:t,lineEnd:r,polygonStart:function(){n.polygonStart(),v.lineStart=o},polygonEnd:function(){n.polygonEnd(),v.lineStart=t}};return v}}(e,t):function(i){return Ko({point:function(e,t){e=i(e,t),this.stream.point(e[0],e[1])}})}(e)},Bf=Ko({point:function(e,t){this.stream.point(e*Gp,t*Gp)}}),Mf=(Xo.invert=function(e,t){return[e,2*Wp(jp(t))-kp]},Jo.invert=function(e,t){return[-t,2*Wp(jp(e))-kp]},function(){var e=function(i){function t(){var e=Up*l(),t=s(nf(s.rotate()).invert([0,0]));return c(null==h?[[t[0]-e,t[1]-e],[t[0]+e,t[1]+e]]:i===Xo?[[Math.max(t[0]-e,h),r],[Math.min(t[0]+e,n),o]]:[[h,Math.max(t[1]-e,r)],[n,Math.min(t[1]+e,o)]])}var r,n,o,s=Yo(i),a=s.center,l=s.scale,u=s.translate,c=s.clipExtent,h=null;return s.scale=function(e){return arguments.length?(l(e),t()):l()},s.translate=function(e){return arguments.length?(u(e),t()):u()},s.center=function(e){return arguments.length?(a(e),t()):a()},s.clipExtent=function(e){return arguments.length?(null==e?h=r=n=o=null:(h=+e[0][0],r=+e[0][1],n=+e[1][0],o=+e[1][1]),t()):null==h?null:[[h,r],[n,o]]},t()}(Jo),t=e.center,i=e.rotate;return e.center=function(e){return arguments.length?t([-e[1],e[0]]):(e=t(),[e[1],-e[0]])},e.rotate=function(e){return arguments.length?i([e[0],e[1],e.length>2?e[2]+90:90]):(e=i(),[e[0],e[1],e[2]-90])},i([0,0,90]).scale(159.155)});e.projection=ia,e.random=Tl,e.clusters=Ll,e.helpers=gs,e.invariant=ys,e.meta=ms,e.isolines=function(e,t,i){if(i=i||{},!Q(i))throw new Error("options is invalid");var r=i.zProperty||"elevation",n=i.commonProperties||{},o=i.breaksProperties||[];if(Ee(e,"Point","Input must contain Points"),!t)throw new Error("breaks is required");if(!Array.isArray(t))throw new Error("breaks must be an Array");if(!Q(n))throw new Error("commonProperties must be an Object");if(!Array.isArray(o))throw new Error("breaksProperties must be an Array");var s=Fe(e,{zProperty:r,flip:!0});return H(function(e,t,i){var r=ve(i),n=r[2]-r[0],o=r[3]-r[1],s=r[0],a=r[1],l=t[0].length-1,u=t.length-1,c=n/l,h=o/u,A=function(e){e[0]=e[0]*c+s,e[1]=e[1]*h+a};return e.forEach(function(e){oe(e,A)}),e}(function(e,t,i,r,n){for(var o=[],s=1;s<t.length;s++){var a=+t[s],l=Object.assign({},r,n[s]);l[i]=a;var u=q(Se(e,a),l);o.push(u)}return o}(s,t,r,n,o),s,e))},e.convex=st,e.pointsWithinPolygon=ut,e.concave=function(e,a){if(a=a||{},!Q(a))throw new Error("options is invalid");if(!e)throw new Error("points is required");var l=a.maxEdge||1/0;if(!ie(l))throw new Error("maxEdge is invalid");var t=ct(function(e){var i=[],r={};return ue(e,function(e){if(e.geometry){var t=e.geometry.coordinates.join("-");r.hasOwnProperty(t)||(i.push(e),r[t]=!0)}}),H(i)}(e));if(t.features=t.features.filter(function(e){var t=e.geometry.coordinates[0][0],i=e.geometry.coordinates[0][1],r=e.geometry.coordinates[0][2],n=ft(t,i,a),o=ft(i,r,a),s=ft(t,r,a);return n<=l&&o<=l&&s<=l}),t.features.length<1)return null;var i=Pt(t,a);return 1===i.coordinates.length&&(i.coordinates=i.coordinates[0],i.type="Polygon"),G(i)},e.collect=function(e,t,i,r){var n=ws(6),o=t.features.map(function(e){return{minX:e.geometry.coordinates[0],minY:e.geometry.coordinates[1],maxX:e.geometry.coordinates[0],maxY:e.geometry.coordinates[1],property:e.properties[i]}});return n.load(o),e.features.forEach(function(t){t.properties||(t.properties={});var e=ve(t),i=[];n.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}).forEach(function(e){at([e.minX,e.minY],t)&&i.push(e.property)}),t.properties[r]=i}),e},e.flip=function(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=t.mutate;if(!e)throw new Error("geojson is required");return!1!==i&&void 0!==i||(e=dt(e)),oe(e,function(e){var t=e[0],i=e[1];e[0]=i,e[1]=t}),e},e.simplify=function(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=void 0!==t.tolerance?t.tolerance:1,r=t.highQuality||!1,n=t.mutate||!1;if(!e)throw new Error("geojson is required");if(i&&i<0)throw new Error("invalid tolerance");return!0!==n&&(e=dt(e)),Ae(e,function(e){!function(e,t,i){var r=e.type;if("Point"===r||"MultiPoint"===r)return e;Tt(e,!0);var n=e.coordinates;switch(r){case"LineString":e.coordinates=Rt(n,t,i);break;case"MultiLineString":e.coordinates=n.map(function(e){return Rt(e,t,i)});break;case"Polygon":e.coordinates=Ut(n,t,i);break;case"MultiPolygon":e.coordinates=n.map(function(e){return Ut(e,t,i)})}}(e,i,r)}),e},e.bezierSpline=kt,e.tag=function(e,i,r,n){return e=dt(e),i=dt(i),ue(e,function(t){t.properties||(t.properties={}),ue(i,function(e){void 0===t.properties[n]&&at(t,e)&&(t.properties[n]=e.properties[r])})}),e},e.sample=function(e,t){if(!e)throw new Error("featurecollection is required");if(null===t||void 0===t)throw new Error("num is required");if("number"!=typeof t)throw new Error("num must be a number");return H(function(e,t){for(var i,r,n=e.slice(0),o=e.length,s=o-t;o-- >s;)r=Math.floor((o+1)*Math.random()),i=n[r],n[r]=n[o],n[o]=i;return n.slice(s)}(e.features,t))},e.envelope=Qt,e.square=Vt,e.circle=zt,e.midpoint=function(e,t){return Gt(e,ft(e,t)/2,Wt(e,t))},e.center=qt,e.centerOfMass=jt,e.centroid=Kt,e.combine=function(e){function t(e,t,i){i?r[t].coordinates=r[t].coordinates.concat(e.geometry.coordinates):r[t].coordinates.push(e.geometry.coordinates),r[t].properties.push(e.properties)}var r={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}},i=Object.keys(r).reduce(function(e,t){return e[t.replace("Multi","")]=t,e},{});return ue(e,function(e){e.geometry&&(r[e.geometry.type]?t(e,e.geometry.type,!0):i[e.geometry.type]&&t(e,i[e.geometry.type],!1))}),H(Object.keys(r).filter(function(e){return r[e].coordinates.length}).sort().map(function(e){return G({type:e,coordinates:r[e].coordinates},{collectedProperties:r[e].properties})}))},e.distance=ft,e.explode=Zt,e.bbox=ve,e.tesselate=function(e){if(!e.geometry||"Polygon"!==e.geometry.type&&"MultiPolygon"!==e.geometry.type)throw new Error("input must be a Polygon or MultiPolygon");var t={type:"FeatureCollection",features:[]};return"Polygon"===e.geometry.type?t.features=Ai(e.geometry.coordinates):e.geometry.coordinates.forEach(function(e){t.features=t.features.concat(Ai(e))}),t},e.bboxPolygon=Ht,e.booleanPointInPolygon=at,e.nearestPoint=pi,e.nearestPointOnLine=Ni,e.nearestPointToLine=function(e,i,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var r=t.units,n=t.properties||{};if(!e)throw new Error("points is required");if(!(e=function(e){var t=[];switch(e.geometry?e.geometry.type:e.type){case"GeometryCollection":return Ae(e,function(e){"Point"===e.type&&t.push({type:"Feature",properties:{},geometry:e})}),{type:"FeatureCollection",features:t};case"FeatureCollection":return e.features=e.features.filter(function(e){return"Point"===e.geometry.type}),e;default:throw new Error("points must be a Point Collection")}}(e)).features.length)throw new Error("points must contain features");if(!i)throw new Error("line is required");if("LineString"!==Ie(i))throw new Error("line must be a LineString");var o=1/0,s=null;return ue(e,function(e){var t=zi(e,i,{units:r});t<o&&(o=t,s=e)}),s&&(s.properties=Object.assign({dist:o},s.properties,n)),s},e.planepoint=function(e,t){var i=Ce(e),r=Be(t).coordinates[0];if(r.length<4)throw new Error("OuterRing of a Polygon must have 4 or more Positions.");var n=t.properties||{},o=n.a,s=n.b,a=n.c,l=i[0],u=i[1],c=r[0][0],h=r[0][1],A=void 0!==o?o:r[0][2],p=r[1][0],f=r[1][1],d=void 0!==s?s:r[1][2],g=r[2][0],m=r[2][1],y=void 0!==a?a:r[2][2];return(y*(l-c)*(u-f)+A*(l-p)*(u-m)+d*(l-g)*(u-h)-d*(l-c)*(u-m)-y*(l-p)*(u-h)-A*(l-g)*(u-f))/((l-c)*(u-f)+(l-p)*(u-m)+(l-g)*(u-h)-(l-c)*(u-m)-(l-p)*(u-h)-(l-g)*(u-f))},e.tin=ct,e.bearing=Wt,e.destination=Gt,e.kinks=function(e){var t,i,o={type:"FeatureCollection",features:[]};if("LineString"===(i="Feature"===e.type?e.geometry:e).type)t=[i.coordinates];else if("MultiLineString"===i.type)t=i.coordinates;else if("MultiPolygon"===i.type)t=[].concat.apply([],i.coordinates);else{if("Polygon"!==i.type)throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");t=i.coordinates}return t.forEach(function(n){t.forEach(function(e){for(var t=0;t<n.length-1;t++)for(var i=t;i<e.length-1;i++){if(n===e){if(1===Math.abs(t-i))continue;if(0===t&&i===n.length-2&&n[t][0]===n[n.length-1][0]&&n[t][1]===n[n.length-1][1])continue}var r=function(e,t,i,r,n,o,s,a){var l,u,c,h,A,p={x:null,y:null,onLine1:!1,onLine2:!1};return 0==(l=(a-o)*(i-e)-(s-n)*(r-t))?null!==p.x&&null!==p.y&&p:(u=t-o,c=e-n,h=(s-n)*u-(a-o)*c,A=(i-e)*u-(r-t)*c,u=h/l,c=A/l,p.x=e+u*(i-e),p.y=t+u*(r-t),u>=0&&u<=1&&(p.onLine1=!0),c>=0&&c<=1&&(p.onLine2=!0),!(!p.onLine1||!p.onLine2)&&[p.x,p.y])}(n[t][0],n[t][1],n[t+1][0],n[t+1][1],e[i][0],e[i][1],e[i+1][0],e[i+1][1]);r&&o.features.push(z([r[0],r[1]]))}})}),o},e.pointOnFeature=qi,e.area=ji,e.along=function(e,t,i){if(i=i||{},!Q(i))throw new Error("options is invalid");var r;if("Feature"===e.type)r=e.geometry.coordinates;else{if("LineString"!==e.type)throw new Error("input must be a LineString Feature or Geometry");r=e.coordinates}if(!ie(t))throw new Error("distance must be a number");for(var n=0,o=0;o<r.length&&!(t>=n&&o===r.length-1);o++){if(n>=t){var s=t-n;if(s){var a=Wt(r[o],r[o-1])-180;return Gt(r[o],s,a,i)}return z(r[o])}n+=ft(r[o],r[o+1],i)}return z(r[r.length-1])},e.length=$i,e.lineSlice=function(e,t,i){var r=x(i);if("LineString"!==Ie(i))throw new Error("line must be a LineString");for(var n,o=Ni(i,e),s=Ni(i,t),a=[(n=o.properties.index<=s.properties.index?[o,s]:[s,o])[0].geometry.coordinates],l=n[0].properties.index+1;l<n[1].properties.index+1;l++)a.push(r[l]);return a.push(n[1].geometry.coordinates),W(a,i.properties)},e.lineSliceAlong=er,e.pointGrid=or,e.truncate=sr,e.flatten=function(e){if(!e)throw new Error("geojson is required");var t=[];return fe(e,function(e){t.push(e)}),H(t)},e.lineIntersect=Di,e.lineChunk=function(e,t,i){if(i=i||{},!Q(i))throw new Error("options is invalid");var r=i.units,n=i.reverse;if(!e)throw new Error("geojson is required");if(t<=0)throw new Error("segmentLength must be greater than 0");var o=[];return fe(e,function(e){n&&(e.geometry.coordinates=e.geometry.coordinates.reverse()),function(e,t,i,r){var n=$i(e,{units:i});if(n<=t)return r(e);var o=n/t;Number.isInteger(o)||(o=Math.floor(o)+1);for(var s=0;s<o;s++){var a=er(e,t*s,t*(s+1),{units:i});r(a,s)}}(e,t,r,function(e){o.push(e)})}),H(o)},e.unkinkPolygon=function(e){var i=[];return fe(e,function(t){"Polygon"===t.geometry.type&&ue(oa(t),function(e){i.push(k(e.geometry.coordinates,t.properties))})}),H(i)},e.greatCircle=function(e,t,i){if("object"!=typeof(i=i||{}))throw new Error("options is invalid");var r=i.properties,n=i.npoints,o=i.offset;return e=Ce(e),t=Ce(t),r=r||{},n=n||100,o=o||10,new pa({x:e[0],y:e[1]},{x:t[0],y:t[1]},r).Arc(n,{offset:o}).json()},e.lineSegment=Li,e.lineSplit=function(e,t){if(!e)throw new Error("line is required");if(!t)throw new Error("splitter is required");var i=Ie(e),r=Ie(t);if("LineString"!==i)throw new Error("line must be LineString");if("FeatureCollection"===r)throw new Error("splitter cannot be a FeatureCollection");if("GeometryCollection"===r)throw new Error("splitter cannot be a GeometryCollection");var n=sr(t,{precision:7});switch(r){case"Point":return hr(e,n);case"MultiPoint":return cr(e,n);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return cr(e,Di(e,n))}},e.lineArc=fr,e.polygonToLine=gr,e.lineToPolygon=yr,e.bboxClip=function(e,t){var i=function(e){return e.geometry?e.geometry.type:e.type}(e),r=x(e),n=e.properties;switch(i){case"LineString":case"MultiLineString":var o=[];return"LineString"===i&&(r=[r]),r.forEach(function(e){fa(e,t,o)}),1===o.length?W(o[0],n):q(o,n);case"Polygon":return k(br(r,t),n);case"MultiPolygon":return K(r.map(function(e){return br(e,t)}),n);default:throw new Error("geometry "+i+" not supported")}},e.lineOverlap=Sr,e.sector=function(e,t,i,r,n){if(n=n||{},!Q(n))throw new Error("options is invalid");if(!e)throw new Error("center is required");if(void 0===i||null===i)throw new Error("bearing1 is required");if(void 0===r||null===r)throw new Error("bearing2 is required");if(!t)throw new Error("radius is required");if("object"!=typeof n)throw new Error("options must be an object");if(Tr(i)===Tr(r))return zt(e,t,n);var o=x(e),s=[[o]];return oe(fr(e,t,i,r,n),function(e){s[0].push(e)}),s[0].push(o),k(s)},e.rhumbBearing=Oi,e.rhumbDistance=Ui,e.rhumbDestination=Lr,e.polygonTangents=function(e,t){var i,r,n,o=x(e),s=x(t);switch(Ie(t)){case"Polygon":i=s[0][0],r=s[0][0],n=Fr(s[0][0],s[0][s[0].length-1],o);var a=Dr(s[0],o,n,void 0,i,r);i=a[0],r=a[1];break;case"MultiPolygon":i=s[0][0][0],r=s[0][0][0],n=Fr(s[0][0][0],s[0][0][s[0][0].length-1],o),s.forEach(function(e){var t=Dr(e[0],o,n,void 0,i,r);i=t[0],r=t[1]})}return H([z(i),z(r)])},e.rewind=function(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=t.reverse||!1,r=t.mutate||!1;if(!e)throw new Error("<geojson> is required");if("boolean"!=typeof i)throw new Error("<reverse> must be a boolean");if("boolean"!=typeof r)throw new Error("<mutate> must be a boolean");!1===r&&(e=dt(e));var n=[];switch(e.type){case"GeometryCollection":return Ae(e,function(e){Or(e,i)}),e;case"FeatureCollection":return ue(e,function(e){ue(Or(e,i),function(e){n.push(e)})}),H(n)}return Or(e,i)},e.isobands=function(e,t,i){if(i=i||{},!Q(i))throw new Error("options is invalid");var r=i.zProperty||"elevation",n=i.commonProperties||{},o=i.breaksProperties||[];if(Ee(e,"Point","Input must contain Points"),!t)throw new Error("breaks is required");if(!Array.isArray(t))throw new Error("breaks is not an Array");if(!Q(n))throw new Error("commonProperties is not an Object");if(!Array.isArray(o))throw new Error("breaksProperties is not an Array");var s=kr(e,{zProperty:r,flip:!0}),a=function(e,t,i){for(var r=[],n=1;n<t.length;n++){var o=+t[n-1],s=+t[n],a=Hr(e,o,s-o),l=function(e){var i=[],r=[];e.forEach(function(e){var t=ji(k([e]));r.push(t),i.push({ring:e,area:t})}),r.sort(function(e,t){return t-e});var n=[];return r.forEach(function(e){for(var t=0;t<i.length;t++)if(i[t].area===e){n.push(i[t].ring),i.splice(t,1);break}}),n}(a),u=function(e){for(var t=e.map(function(e){return{lrCoordinates:e,grouped:!1}}),i=[];!function(e){for(var t=0;t<e.length;t++)if(!1===e[t].grouped)return!1;return!0}(t);)for(var r=0;r<t.length;r++)if(!t[r].grouped){var n=[];n.push(t[r].lrCoordinates),t[r].grouped=!0;for(var o=k([t[r].lrCoordinates]),s=r+1;s<t.length;s++)if(!t[s].grouped){var a=k([t[s].lrCoordinates]);(function(e,t){for(var i=Zt(e),r=0;r<i.features.length;r++)if(!at(i.features[r],t))return!1;return!0})(a,o)&&(n.push(t[s].lrCoordinates),t[s].grouped=!0)}i.push(n)}return i}(l),c={};c.groupedRings=u,c[i]=o+"-"+s,r.push(c)}return r}(s,t,r);return H((a=function(e,t,i){var r=ve(i),n=r[2]-r[0],o=r[3]-r[1],s=r[0],a=r[1],l=t[0].length-1,u=t.length-1,c=n/l,h=o/u,A=function(e){e[0]=e[0]*c+s,e[1]=e[1]*h+a};return e.forEach(function(e){e.groupedRings.forEach(function(e){e.forEach(function(e){e.forEach(A)})})}),e}(a,s,e)).map(function(e,t){if(o[t]&&!Q(o[t]))throw new Error("Each mappedProperty is required to be an Object");var i=Object.assign({},n,o[t]);return i[r]=e[r],K(e.groupedRings,i)}))},e.transformRotate=Vr,e.transformScale=Gr,e.transformTranslate=function(e,i,r,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var n=t.units,o=t.zTranslation,s=t.mutate;if(!e)throw new Error("geojson is required");if(void 0===i||null===i||isNaN(i))throw new Error("distance is required");if(o&&"number"!=typeof o&&isNaN(o))throw new Error("zTranslation is not a number");if(o=void 0!==o?o:0,0===i&&0===o)return e;if(void 0===r||null===r||isNaN(r))throw new Error("direction is required");return i<0&&(i=-i,r=-r),!1!==s&&void 0!==s||(e=dt(e)),oe(e,function(e){var t=x(Lr(e,i,r,{units:n}));e[0]=t[0],e[1]=t[1],o&&3===e.length&&(e[2]+=o)}),e},e.lineOffset=function(e,t,i){if(i=i||{},!Q(i))throw new Error("options is invalid");var r=i.units;if(!e)throw new Error("geojson is required");if(void 0===t||null===t||isNaN(t))throw new Error("distance is required");var n=Ie(e),o=e.properties;switch(n){case"LineString":return jr(e,t,r);case"MultiLineString":var s=[];return fe(e,function(e){s.push(jr(e,t,r).geometry.coordinates)}),q(s,o);default:throw new Error("geometry "+n+" is not supported")}},e.polygonize=function(e){var t=el.fromGeoJson(e);t.deleteDangles(),t.deleteCutEdges();var i=[],r=[];return t.getEdgeRings().filter(function(e){return e.isValid()}).forEach(function(e){e.isHole()?i.push(e):r.push(e)}),i.forEach(function(e){Ja.findEdgeRingContaining(e,r)&&r.push(e)}),H(r.map(function(e){return e.toPolygon()}))},e.booleanDisjoint=function(e,i){var r;return fe(e,function(t){fe(i,function(e){if(!1===r)return!1;r=function(e,t){switch(e.type){case"Point":switch(t.type){case"Point":return!function(e,t){return e[0]===t[0]&&e[1]===t[1]}(e.coordinates,t.coordinates);case"LineString":return!Xr(t,e);case"Polygon":return!at(e,t)}break;case"LineString":switch(t.type){case"Point":return!Xr(e,t);case"LineString":return!function(e,t){return Di(e,t).features.length>0}(e,t);case"Polygon":return!Jr(t,e)}break;case"Polygon":switch(t.type){case"Point":return!at(t,e);case"LineString":return!Jr(e,t);case"Polygon":return!function(e,t){for(var i=0;i<e.coordinates[0].length;i++)if(at(e.coordinates[0][i],t))return!0;for(var r=0;r<t.coordinates[0].length;r++)if(at(t.coordinates[0][r],e))return!0;return!1}(t,e)}}}(t.geometry,e.geometry)})}),r},e.booleanContains=function(e,t){var i=Ie(e),r=Ie(t),n=Be(e),o=Be(t),s=x(e),a=x(t);switch(i){case"Point":switch(r){case"Point":return en(s,a);default:throw new Error("feature2 "+r+" geometry not supported")}case"MultiPoint":switch(r){case"Point":return function(e,t){var i,r=!1;for(i=0;i<e.coordinates.length;i++)if(en(e.coordinates[i],t.coordinates)){r=!0;break}return r}(n,o);case"MultiPoint":return function(e,t){for(var i=0;i<t.coordinates.length;i++){for(var r=!1,n=0;n<e.coordinates.length;n++)if(en(t.coordinates[i],e.coordinates[n])){r=!0;break}if(!r)return!1}return!0}(n,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"LineString":switch(r){case"Point":return tr(o,n,{ignoreEndVertices:!0});case"LineString":return function(e,t){for(var i=!1,r=0;r<t.coordinates.length;r++)if(tr({type:"Point",coordinates:t.coordinates[r]},e,{ignoreEndVertices:!0})&&(i=!0),!tr({type:"Point",coordinates:t.coordinates[r]},e,{ignoreEndVertices:!1}))return!1;return i}(n,o);case"MultiPoint":return function(e,t){for(var i=!1,r=0;r<t.coordinates.length;r++)if(tr(t.coordinates[r],e,{ignoreEndVertices:!0})&&(i=!0),!tr(t.coordinates[r],e))return!1;return!!i}(n,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"Polygon":switch(r){case"Point":return at(o,n,{ignoreBoundary:!0});case"LineString":return function(e,t){var i=!1,r=0,n=ve(e),o=ve(t);if(!$r(n,o))return!1;for(;r<t.coordinates.length-1;r++){var s=function(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}(t.coordinates[r],t.coordinates[r+1]);if(at({type:"Point",coordinates:s},e,{ignoreBoundary:!0})){i=!0;break}}return i}(n,o);case"Polygon":return function(e,t){var i=ve(e),r=ve(t);if(!$r(i,r))return!1;for(var n=0;n<t.coordinates[0].length;n++)if(!at(t.coordinates[0][n],e))return!1;return!0}(n,o);case"MultiPoint":return function(e,t){for(var i=0;i<t.coordinates.length;i++)if(!at(t.coordinates[i],e,{ignoreBoundary:!0}))return!1;return!0}(n,o);default:throw new Error("feature2 "+r+" geometry not supported")}default:throw new Error("feature1 "+i+" geometry not supported")}},e.booleanCrosses=function(e,t){var i=Ie(e),r=Ie(t),n=Be(e),o=Be(t);switch(i){case"MultiPoint":switch(r){case"LineString":return tn(n,o);case"Polygon":return nn(n,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"LineString":switch(r){case"MultiPoint":return tn(o,n);case"LineString":return function(e,t){if(Di(e,t).features.length>0)for(var i=0;i<e.coordinates.length-1;i++)for(var r=0;r<t.coordinates.length-1;r++){var n=!0;if(0!==r&&r!==t.coordinates.length-2||(n=!1),on(e.coordinates[i],e.coordinates[i+1],t.coordinates[r],n))return!0}return!1}(n,o);case"Polygon":return rn(n,o);default:throw new Error("feature2 "+r+" geometry not supported")}case"Polygon":switch(r){case"MultiPoint":return nn(o,n);case"LineString":return rn(o,n);default:throw new Error("feature2 "+r+" geometry not supported")}default:throw new Error("feature1 "+i+" geometry not supported")}},e.booleanClockwise=Nr,e.booleanOverlap=un,e.booleanPointOnLine=tr,e.booleanEqual=function(e,t){if(!e)throw new Error("feature1 is required");if(!t)throw new Error("feature2 is required");return Ie(e)===Ie(t)&&new ol({precision:6}).compare(Tt(e),Tt(t))},e.booleanWithin=ir,e.clone=dt,e.cleanCoords=Tt,e.clustersDbscan=function(i,e,t){if("object"!=typeof(t=t||{}))throw new Error("options is invalid");var r=t.minPoints,n=t.units;if(Ee(i,"Point","Input must contain Points"),null===e||void 0===e)throw new Error("maxDistance is required");if(!(Math.sign(e)>0))throw new Error("Invalid maxDistance");if(!(void 0===r||null===r||Math.sign(r)>0))throw new Error("Invalid minPoints");i=dt(i),r=r||3;var o=new cl.DBSCAN,s=-1;return o.run(he(i),ee(e,n),r,ft).forEach(function(e){s++,e.forEach(function(e){var t=i.features[e];t.properties||(t.properties={}),t.properties.cluster=s,t.properties.dbscan="core"})}),o.noise.forEach(function(e){var t=i.features[e];t.properties||(t.properties={}),t.properties.cluster?t.properties.dbscan="edge":t.properties.dbscan="noise"}),i},e.clustersKmeans=function(e,t){if("object"!=typeof(t=t||{}))throw new Error("options is invalid");var i=t.numberOfClusters,r=t.mutate;Ee(e,"Point","Input must contain Points");var n=e.features.length;(i=i||Math.round(Math.sqrt(n/2)))>n&&(i=n),!1!==r&&void 0!==r||(e=dt(e));var o=he(e),s=o.slice(0,i),a=yl(o,i,s),l={};return a.centroids.forEach(function(e,t){l[t]=e}),ue(e,function(e,t){var i=a.idxs[t];e.properties.cluster=i,e.properties.centroid=l[i]}),e},e.pointToLineDistance=zi,e.booleanParallel=function(e,t){if(!e)throw new Error("line1 is required");if(!t)throw new Error("line2 is required");if("LineString"!==hn(e,"line1"))throw new Error("line1 must be a LineString");if("LineString"!==hn(t,"line2"))throw new Error("line2 must be a LineString");for(var i=Li(Tt(e)).features,r=Li(Tt(t)).features,n=0;n<i.length;n++){var o=i[n].geometry.coordinates;if(!r[n])break;if(!function(e,t){var i=X(Oi(e[0],e[1])),r=X(Oi(t[0],t[1]));return i===r}(o,r[n].geometry.coordinates))return!1}return!0},e.shortestPath=function(e,t,i){if(i=i||{},!Q(i))throw new Error("options is invalid");var r=i.resolution,n=i.minDistance,o=i.obstacles||H([]);if(!e)throw new Error("start is required");if(!t)throw new Error("end is required");if(r&&!ie(r)||r<=0)throw new Error("options.resolution must be a number, greater than 0");if(n)throw new Error("options.minDistance is not yet implemented");var s=Ce(e),a=Ce(t);switch(e=z(s),t=z(a),Ie(o)){case"FeatureCollection":if(0===o.features.length)return W([s,a]);break;case"Polygon":o=H([G(Be(o))]);break;default:throw new Error("invalid obstacles")}var l=o;l.features.push(e),l.features.push(t);var u=ve(Gr(Ht(ve(l)),1.15));r||(r=ft([u[0],u[1]],[u[2],u[1]],i)/100);l.features.pop(),l.features.pop();for(var c=u[0],h=u[1],A=u[2],p=u[3],f=r/ft([c,h],[A,h],i)*(A-c),d=r/ft([c,h],[c,p],i)*(p-h),g=A-c,m=p-h,O=(g-Math.floor(g/f)*f)/2,y=[],_=[],v=[],C=[],w=1/0,x=1/0,b=p-(m-Math.floor(m/d)*d)/2,E=0;b>=h;){for(var B=[],M=[],I=c+O,S=0;I<=A;){var P=z([I,b]),T=function(e,t){for(var i=0;i<t.features.length;i++)if(at(e,t.features[i]))return!0;return!1}(P,o);B.push(T?0:1),M.push(I+"|"+b);var L=ft(P,e);!T&&L<w&&(w=L,v={x:S,y:E});var D=ft(P,t);!T&&D<x&&(x=D,C={x:S,y:E}),I+=f,S++}_.push(B),y.push(M),b-=d,E++}var F=new pn(_,{diagonal:!0}),R=F.grid[v.y][v.x],U=F.grid[C.y][C.x],N=[s];return _l.search(F,R,U).forEach(function(e){var t=y[e.x][e.y].split("|");N.push([+t[0],+t[1]])}),N.push(a),Tt(W(N))},e.voronoi=function(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=t.bbox||[-180,-85,180,85];if(!e)throw new Error("points is required");if(!Array.isArray(i))throw new Error("bbox is invalid");return Ee(e,"Point","points"),H(Pl().x(function(e){return e.geometry.coordinates[0]}).y(function(e){return e.geometry.coordinates[1]}).extent([[i[0],i[1]],[i[2],i[3]]]).polygons(e.features).map(Qn))},e.ellipse=Vn,e.centerMean=zn,e.centerMedian=function(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=t.counter||10;if(!ie(i))throw new Error("counter must be a number");var r=t.weight,n=zn(e,{weight:t.weight}),o=H([]);return ue(e,function(e){o.features.push(Kt(e,{weight:e.properties[r]}))}),o.properties={tolerance:t.tolerance,medianCandidates:[]},Wn(n.geometry.coordinates,[0,0],o,i)},e.standardDeviationalEllipse=function(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var i=t.steps||64,r=t.weight,n=t.properties||{};if(!ie(i))throw new Error("steps must be a number");if(!Q(n))throw new Error("properties must be a number");var o=he(e).length,s=zn(e,{weight:r}),a=0,l=0,u=0;ue(e,function(e){var t=e.properties[r]||1,i=qn(x(e),x(s));a+=Math.pow(i.x,2)*t,l+=Math.pow(i.y,2)*t,u+=i.x*i.y*t});var c=a-l,h=Math.sqrt(Math.pow(c,2)+4*Math.pow(u,2)),A=2*u,p=Math.atan((c+h)/A),f=180*p/Math.PI,d=0,g=0,m=0;ue(e,function(e){var t=e.properties[r]||1,i=qn(x(e),x(s));d+=Math.pow(i.x*Math.cos(p)-i.y*Math.sin(p),2)*t,g+=Math.pow(i.x*Math.sin(p)+i.y*Math.cos(p),2)*t,m+=t});var y=Math.sqrt(2*d/m),_=Math.sqrt(2*g/m),v=Vn(s,y,_,{units:"degrees",angle:f,steps:i,properties:n}),C=ut(e,H([v])),w={meanCenterCoordinates:x(s),semiMajorAxis:y,semiMinorAxis:_,numberOfFeatures:o,angle:f,percentageWithinEllipse:100*he(C).length/o};return v.properties.standardDeviationalEllipse=w,v},e.difference=function(e,t){var i=Be(e),r=Be(t),n=e.properties||{};if(i=Co(i),r=Co(r),!i)return null;if(!r)return G(i,n);var o=new Mc,s=o.read(i),a=o.read(r),l=A.difference(s,a);return l.isEmpty()?null:G((new Ic).write(l),n)},e.buffer=function(e,i,t){var r=(t=t||{}).units,n=t.steps||64;if(!e)throw new Error("geojson is required");if("object"!=typeof t)throw new Error("options must be an object");if("number"!=typeof n)throw new Error("steps must be an number");if(void 0===i)throw new Error("radius is required");if(n<=0)throw new Error("steps must be greater than 0");n=n||64,r=r||"kilometers";var o=[];switch(e.type){case"GeometryCollection":return Ae(e,function(e){var t=$o(e,i,r,n);t&&o.push(t)}),H(o);case"FeatureCollection":return ue(e,function(e){var t=$o(e,i,r,n);t&&ue(t,function(e){e&&o.push(e)})}),H(o)}return $o(e,i,r,n)},e.union=ns,e.intersect=os,e.dissolve=function(e,t){if(t=t||{},!Q(t))throw new Error("options is invalid");var n=t.propertyName;Ee(e,"Polygon","dissolve");var i=dt(e),o=i.features,s=[];o.forEach(function(e,t){e.properties.origIndexPosition=t});var a=Si();a.load(i);for(var l in o){var u=o[l],c=!1;if(a.search(u).features.forEach(function(e){u=o[l];var t=e.properties.origIndexPosition;if(s.length>0&&0!==t)if(t>s[s.length-1])t-=s.length;else{var i=ss(t,s);0!==i&&(t-=i)}if(t!==+l){var r=o[t];r&&u&&(void 0!==n&&r.properties[n]!==u.properties[n]||un(u,r)&&function(e,t){var i=W(he(e)),r=W(he(t));return Di(i,r).features.length>0}(u,r)&&(o[l]=ns(u,r),s.push(e.properties.origIndexPosition),s.sort(function(e,t){return e-t}),a.remove(e),o.splice(t,1),u.properties.origIndexPosition=l,a.remove(u,function(e,t){return e.properties.origIndexPosition===t.properties.origIndexPosition}),c=!0))}}),c){if(!u)continue;u.properties.origIndexPosition=l,a.insert(u),l--}}return o.forEach(function(e){delete e.properties.origIndexPosition,delete e.bbox}),i},e.hexGrid=as,e.mask=function(e,t){var i=function(e){return k(e&&e.geometry.coordinates||[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]])}(t),r=function(e){var n=[],o=[];return fe(e,function(e){var t=e.geometry.coordinates,i=t[0],r=t.slice(1);n.push(k([i])),r.forEach(function(e){o.push(k([e]))})}),[H(n),H(o)]}(e),n=r[0],o=r[1];return function(e,t,i){var r=[];return r.push(e.geometry.coordinates[0]),fe(t,function(e){r.push(e.geometry.coordinates[0])}),fe(i,function(e){r.push(e.geometry.coordinates[0])}),k(r)}(i,n=ls(n),o=ls(o))},e.squareGrid=cs,e.triangleGrid=hs,e.interpolate=function(t,e,a){if("object"!=typeof(a=a||{}))throw new Error("options is invalid");var l=a.gridType,u=a.property,c=a.weight;if(!t)throw new Error("points is required");if(Ee(t,"Point","input must contain Points"),!e)throw new Error("cellSize is required");if(void 0!==c&&"number"!=typeof c)throw new Error("weight must be a number");u=u||"elevation",l=l||"square",c=c||1;var i,r=ve(t);switch(l){case"point":case"points":i=or(r,e,a);break;case"square":case"squares":i=cs(r,e,a);break;case"hex":case"hexes":i=as(r,e,a);break;case"triangle":case"triangles":i=hs(r,e,a);break;default:throw new Error("invalid gridType")}var h=[];return ue(i,function(n){var o=0,s=0;ue(t,function(e){var t,i=ft("point"===l?n:Kt(n),e,a);if(void 0!==u&&(t=e.properties[u]),void 0===t&&(t=e.geometry.coordinates[2]),void 0===t)throw new Error("zValue is missing");0===i&&(o=t);var r=1/Math.pow(i,c);s+=r,o+=r*t});var e=dt(n);e.properties[u]=o/s,h.push(e)}),H(h)},e.pointOnSurface=qi,e.polygonToLineString=gr,e.lineStringToPolygon=yr,e.inside=at,e.within=ut,e.bezier=kt,e.nearest=pi,e.pointOnLine=Ni,e.lineDistance=$i,e.radians2degrees=J,e.degrees2radians=$,e.distanceToDegrees=Y,e.distanceToRadians=Z,e.radiansToDistance=j,e.bearingToAngle=X,e.convertDistance=ee,e.toMercator=ki,e.toWgs84=Hi,e.randomPosition=Kn,e.randomPoint=jn,e.randomPolygon=Zn,e.randomLineString=Yn,e.getCluster=Jn,e.clusterEach=$n,e.clusterReduce=eo,e.createBins=to,e.applyFilter=io,e.propertiesContainsFilter=ro,e.filterProperties=no,e.earthRadius=As,e.factors=ps,e.unitsFactors=fs,e.areaFactors=ds,e.feature=G,e.geometry=t,e.point=z,e.points=i,e.polygon=k,e.polygons=r,e.lineString=W,e.lineStrings=n,e.featureCollection=H,e.multiLineString=q,e.multiPoint=o,e.multiPolygon=K,e.geometryCollection=s,e.round=a,e.radiansToLength=j,e.lengthToRadians=Z,e.lengthToDegrees=Y,e.bearingToAzimuth=X,e.radiansToDegrees=J,e.degreesToRadians=$,e.convertLength=ee,e.convertArea=te,e.isNumber=ie,e.isObject=Q,e.validateBBox=re,e.validateId=ne,e.getCoord=Ce,e.getCoords=x,e.containsNumber=we,e.geojsonType=xe,e.featureOf=be,e.collectionOf=Ee,e.getGeom=Be,e.getGeomType=Me,e.getType=Ie,e.coordEach=oe,e.coordReduce=se,e.propEach=ae,e.propReduce=le,e.featureEach=ue,e.featureReduce=ce,e.coordAll=he,e.geomEach=Ae,e.geomReduce=pe,e.flattenEach=fe,e.flattenReduce=de,e.segmentEach=ge,e.segmentReduce=me,e.lineEach=ye,e.lineReduce=_e,Object.defineProperty(e,"__esModule",{value:!0})}(t)},9644:function(e,t,i){e.exports=i(5644)},353:function(e,t,i){"use strict";var c=i(3044),h=i(6955),A=i(2233),p=i(8030),f=i(7948),d=i(1875),g=i(842),m=i(8618);e.exports=function(u){return new Promise(function(t,i){var e,r=u.data,n=u.headers,o=u.responseType,s=(c.isFormData(r)&&delete n["Content-Type"],new XMLHttpRequest),a=(u.auth&&(a=u.auth.username||"",e=u.auth.password?unescape(encodeURIComponent(u.auth.password)):"",n.Authorization="Basic "+btoa(a+":"+e)),f(u.baseURL,u.url));function l(){var e;s&&(e="getAllResponseHeaders"in s?d(s.getAllResponseHeaders()):null,e={data:o&&"text"!==o&&"json"!==o?s.response:s.responseText,status:s.status,statusText:s.statusText,headers:e,config:u,request:s},h(t,i,e),s=null)}s.open(u.method.toUpperCase(),p(a,u.params,u.paramsSerializer),!0),s.timeout=u.timeout,"onloadend"in s?s.onloadend=l:s.onreadystatechange=function(){s&&4===s.readyState&&(0!==s.status||s.responseURL&&0===s.responseURL.indexOf("file:"))&&setTimeout(l)},s.onabort=function(){s&&(i(m("Request aborted",u,"ECONNABORTED",s)),s=null)},s.onerror=function(){i(m("Network Error",u,null,s)),s=null},s.ontimeout=function(){var e="timeout of "+u.timeout+"ms exceeded";u.timeoutErrorMessage&&(e=u.timeoutErrorMessage),i(m(e,u,u.transitional&&u.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",s)),s=null},c.isStandardBrowserEnv()&&(e=(u.withCredentials||g(a))&&u.xsrfCookieName?A.read(u.xsrfCookieName):void 0)&&(n[u.xsrfHeaderName]=e),"setRequestHeader"in s&&c.forEach(n,function(e,t){void 0===r&&"content-type"===t.toLowerCase()?delete n[t]:s.setRequestHeader(t,e)}),c.isUndefined(u.withCredentials)||(s.withCredentials=!!u.withCredentials),o&&"json"!==o&&(s.responseType=u.responseType),"function"==typeof u.onDownloadProgress&&s.addEventListener("progress",u.onDownloadProgress),"function"==typeof u.onUploadProgress&&s.upload&&s.upload.addEventListener("progress",u.onUploadProgress),u.cancelToken&&u.cancelToken.promise.then(function(e){s&&(s.abort(),i(e),s=null)}),r=r||null,s.send(r)})}},5644:function(e,t,i){"use strict";var r=i(3044),n=i(3644),o=i(2215),s=i(2937);function a(e){var e=new o(e),t=n(o.prototype.request,e);return r.extend(t,o.prototype,e),r.extend(t,e),t}var l=a(i(1439));l.Axios=o,l.create=function(e){return a(s(l.defaults,e))},l.Cancel=i(6714),l.CancelToken=i(4089),l.isCancel=i(8041),l.all=function(e){return Promise.all(e)},l.spread=i(783),l.isAxiosError=i(5587),e.exports=l,e.exports.default=l},6714:function(e){"use strict";function t(e){this.message=e}t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,e.exports=t},4089:function(e,t,i){"use strict";var r=i(6714);function n(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");this.promise=new Promise(function(e){t=e});var t,i=this;e(function(e){i.reason||(i.reason=new r(e),t(i.reason))})}n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.source=function(){var t;return{token:new n(function(e){t=e}),cancel:t}},e.exports=n},8041:function(e){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},2215:function(e,t,i){"use strict";var r=i(3044),n=i(8030),o=i(946),c=i(6895),h=i(2937),A=i(7525),p=A.validators;function s(e){this.defaults=e,this.interceptors={request:new o,response:new o}}s.prototype.request=function(t){"string"==typeof t?(t=arguments[1]||{}).url=arguments[0]:t=t||{},(t=h(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var e,i=t.transitional,r=(void 0!==i&&A.assertOptions(i,{silentJSONParsing:p.transitional(p.boolean,"1.0.0"),forcedJSONParsing:p.transitional(p.boolean,"1.0.0"),clarifyTimeoutError:p.transitional(p.boolean,"1.0.0")},!1),[]),n=!0,o=(this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(n=n&&e.synchronous,r.unshift(e.fulfilled,e.rejected))}),[]);if(this.interceptors.response.forEach(function(e){o.push(e.fulfilled,e.rejected)}),n){for(var s=t;r.length;){var a=r.shift(),l=r.shift();try{s=a(s)}catch(e){l(e);break}}try{e=c(s)}catch(e){return Promise.reject(e)}for(;o.length;)e=e.then(o.shift(),o.shift())}else{var u=[c,void 0];for(Array.prototype.unshift.apply(u,r),u=u.concat(o),e=Promise.resolve(t);u.length;)e=e.then(u.shift(),u.shift())}return e},s.prototype.getUri=function(e){return e=h(this.defaults,e),n(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},r.forEach(["delete","get","head","options"],function(i){s.prototype[i]=function(e,t){return this.request(h(t||{},{method:i,url:e,data:(t||{}).data}))}}),r.forEach(["post","put","patch"],function(r){s.prototype[r]=function(e,t,i){return this.request(h(i||{},{method:r,url:e,data:t}))}}),e.exports=s},946:function(e,t,i){"use strict";var r=i(3044);function n(){this.handlers=[]}n.prototype.use=function(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1},n.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},n.prototype.forEach=function(t){r.forEach(this.handlers,function(e){null!==e&&t(e)})},e.exports=n},7948:function(e,t,i){"use strict";var r=i(9192),n=i(8762);e.exports=function(e,t){return e&&!r(t)?n(e,t):t}},8618:function(e,t,i){"use strict";var o=i(1935);e.exports=function(e,t,i,r,n){e=new Error(e);return o(e,t,i,r,n)}},6895:function(e,t,i){"use strict";var r=i(3044),n=i(8556),o=i(8041),s=i(1439);function a(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(t){return a(t),t.headers=t.headers||{},t.data=n.call(t,t.data,t.headers,t.transformRequest),t.headers=r.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),r.forEach(["delete","get","head","post","put","patch","common"],function(e){delete t.headers[e]}),(t.adapter||s.adapter)(t).then(function(e){return a(t),e.data=n.call(t,e.data,e.headers,t.transformResponse),e},function(e){return o(e)||(a(t),e&&e.response&&(e.response.data=n.call(t,e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)})}},1935:function(e){"use strict";e.exports=function(e,t,i,r,n){return e.config=t,i&&(e.code=i),e.request=r,e.response=n,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},2937:function(e,t,i){"use strict";var c=i(3044);e.exports=function(t,i){i=i||{};var r={},e=["url","method","data"],n=["headers","auth","proxy","params"],o=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],s=["validateStatus"];function a(e,t){return c.isPlainObject(e)&&c.isPlainObject(t)?c.merge(e,t):c.isPlainObject(t)?c.merge({},t):c.isArray(t)?t.slice():t}function l(e){c.isUndefined(i[e])?c.isUndefined(t[e])||(r[e]=a(void 0,t[e])):r[e]=a(t[e],i[e])}c.forEach(e,function(e){c.isUndefined(i[e])||(r[e]=a(void 0,i[e]))}),c.forEach(n,l),c.forEach(o,function(e){c.isUndefined(i[e])?c.isUndefined(t[e])||(r[e]=a(void 0,t[e])):r[e]=a(void 0,i[e])}),c.forEach(s,function(e){e in i?r[e]=a(t[e],i[e]):e in t&&(r[e]=a(void 0,t[e]))});var u=e.concat(n).concat(o).concat(s),e=Object.keys(t).concat(Object.keys(i)).filter(function(e){return-1===u.indexOf(e)});return c.forEach(e,l),r}},6955:function(e,t,i){"use strict";var n=i(8618);e.exports=function(e,t,i){var r=i.config.validateStatus;i.status&&r&&!r(i.status)?t(n("Request failed with status code "+i.status,i.config,null,i.request,i)):e(i)}},8556:function(e,t,i){"use strict";var n=i(3044),o=i(1439);e.exports=function(t,i,e){var r=this||o;return n.forEach(e,function(e){t=e.call(r,t,i)}),t}},1439:function(e,t,i){"use strict";var n=i(3044),o=i(8868),r=i(1935),s={"Content-Type":"application/x-www-form-urlencoded"};function a(e,t){!n.isUndefined(e)&&n.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var l,u={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:l="undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process)?i(353):l,transformRequest:[function(e,t){if(o(t,"Accept"),o(t,"Content-Type"),!(n.isFormData(e)||n.isArrayBuffer(e)||n.isBuffer(e)||n.isStream(e)||n.isFile(e)||n.isBlob(e))){if(n.isArrayBufferView(e))return e.buffer;if(n.isURLSearchParams(e))return a(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();if(n.isObject(e)||t&&"application/json"===t["Content-Type"]){a(t,"application/json");var t=e,i=void 0,r=void 0;if(n.isString(t))try{return(i||JSON.parse)(t),n.trim(t)}catch(e){if("SyntaxError"!==e.name)throw e}return(r||JSON.stringify)(t)}}return e}],transformResponse:[function(e){var t=this.transitional,i=t&&t.silentJSONParsing,t=t&&t.forcedJSONParsing,i=!i&&"json"===this.responseType;if(i||t&&n.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(i){if("SyntaxError"===e.name)throw r(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return 200<=e&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};n.forEach(["delete","get","head"],function(e){u.headers[e]={}}),n.forEach(["post","put","patch"],function(e){u.headers[e]=n.merge(s)}),e.exports=u},3644:function(e){"use strict";e.exports=function(i,r){return function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];return i.apply(r,e)}}},8030:function(e,t,i){"use strict";var n=i(3044);function o(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,i){var r;return t&&(i=i?i(t):n.isURLSearchParams(t)?t.toString():(r=[],n.forEach(t,function(e,t){null!=e&&(n.isArray(e)?t+="[]":e=[e],n.forEach(e,function(e){n.isDate(e)?e=e.toISOString():n.isObject(e)&&(e=JSON.stringify(e)),r.push(o(t)+"="+o(e))}))}),r.join("&")))&&(-1!==(t=e.indexOf("#"))&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+i),e}},8762:function(e){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},2233:function(e,t,i){"use strict";var a=i(3044);e.exports=a.isStandardBrowserEnv()?{write:function(e,t,i,r,n,o){var s=[];s.push(e+"="+encodeURIComponent(t)),a.isNumber(i)&&s.push("expires="+new Date(i).toGMTString()),a.isString(r)&&s.push("path="+r),a.isString(n)&&s.push("domain="+n),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){e=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},9192:function(e){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},5587:function(e){"use strict";e.exports=function(e){return"object"==typeof e&&!0===e.isAxiosError}},842:function(e,t,i){"use strict";var r,n,o,s=i(3044);function a(e){return n&&(o.setAttribute("href",e),e=o.href),o.setAttribute("href",e),{href:o.href,protocol:o.protocol?o.protocol.replace(/:$/,""):"",host:o.host,search:o.search?o.search.replace(/^\?/,""):"",hash:o.hash?o.hash.replace(/^#/,""):"",hostname:o.hostname,port:o.port,pathname:"/"===o.pathname.charAt(0)?o.pathname:"/"+o.pathname}}e.exports=s.isStandardBrowserEnv()?(n=/(msie|trident)/i.test(navigator.userAgent),o=document.createElement("a"),r=a(window.location.href),function(e){e=s.isString(e)?a(e):e;return e.protocol===r.protocol&&e.host===r.host}):function(){return!0}},8868:function(e,t,i){"use strict";var n=i(3044);e.exports=function(i,r){n.forEach(i,function(e,t){t!==r&&t.toUpperCase()===r.toUpperCase()&&(i[r]=e,delete i[t])})}},1875:function(e,t,i){"use strict";var n=i(3044),o=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,i,r={};return e&&n.forEach(e.split("\n"),function(e){i=e.indexOf(":"),t=n.trim(e.substr(0,i)).toLowerCase(),i=n.trim(e.substr(i+1)),!t||r[t]&&0<=o.indexOf(t)||(r[t]="set-cookie"===t?(r[t]||[]).concat([i]):r[t]?r[t]+", "+i:i)}),r}},783:function(e){"use strict";e.exports=function(t){return function(e){return t.apply(null,e)}}},7525:function(e,t,i){"use strict";var a=i(9521),r={},l=(["object","boolean","number","function","string","symbol"].forEach(function(t,i){r[t]=function(e){return typeof e===t||"a"+(i<1?"n ":" ")+t}}),{}),o=a.version.split(".");function u(e,t){for(var i=t?t.split("."):o,r=e.split("."),n=0;n<3;n++){if(i[n]>r[n])return!0;if(i[n]<r[n])return!1}return!1}r.transitional=function(r,n,i){var o=n&&u(n);function s(e,t){return"[Axios v"+a.version+"] Transitional option '"+e+"'"+t+(i?". "+i:"")}return function(e,t,i){if(!1===r)throw new Error(s(t," has been removed in "+n));return o&&!l[t]&&(l[t]=!0,console.warn(s(t," has been deprecated since v"+n+" and will be removed in the near future"))),!r||r(e,t,i)}},e.exports={isOlderVersion:u,assertOptions:function(e,t,i){if("object"!=typeof e)throw new TypeError("options must be an object");for(var r=Object.keys(e),n=r.length;0<n--;){var o=r[n],s=t[o];if(s){var a=e[o],s=void 0===a||s(a,o,e);if(!0!==s)throw new TypeError("option "+o+" must be "+s)}else if(!0!==i)throw Error("Unknown option "+o)}},validators:r}},3044:function(e,t,i){"use strict";var n=i(3644),r=Object.prototype.toString;function o(e){return"[object Array]"===r.call(e)}function s(e){return void 0===e}function a(e){return null!==e&&"object"==typeof e}function l(e){return"[object Object]"===r.call(e)&&(null===(e=Object.getPrototypeOf(e))||e===Object.prototype)}function u(e){return"[object Function]"===r.call(e)}function c(e,t){if(null!=e)if(o(e="object"!=typeof e?[e]:e))for(var i=0,r=e.length;i<r;i++)t.call(null,e[i],i,e);else for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.call(null,e[n],n,e)}e.exports={isArray:o,isArrayBuffer:function(e){return"[object ArrayBuffer]"===r.call(e)},isBuffer:function(e){return null!==e&&!s(e)&&null!==e.constructor&&!s(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return e="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:a,isPlainObject:l,isUndefined:s,isDate:function(e){return"[object Date]"===r.call(e)},isFile:function(e){return"[object File]"===r.call(e)},isBlob:function(e){return"[object Blob]"===r.call(e)},isFunction:u,isStream:function(e){return a(e)&&u(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:c,merge:function i(){var r={};function e(e,t){l(r[t])&&l(e)?r[t]=i(r[t],e):l(e)?r[t]=i({},e):o(e)?r[t]=e.slice():r[t]=e}for(var t=0,n=arguments.length;t<n;t++)c(arguments[t],e);return r},extend:function(i,e,r){return c(e,function(e,t){i[t]=r&&"function"==typeof e?n(e,r):e}),i},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return e=65279===e.charCodeAt(0)?e.slice(1):e}}},2680:function(e,t,i){"use strict";var r=i(7286),n=i(9429),o=n(r("String.prototype.indexOf"));e.exports=function(e,t){t=r(e,!!t);return"function"==typeof t&&-1<o(e,".prototype.")?n(t):t}},9429:function(e,t,i){"use strict";var r=i(4090),i=i(7286),n=i("%Function.prototype.apply%"),o=i("%Function.prototype.call%"),s=i("%Reflect.apply%",!0)||r.call(o,n),a=i("%Object.getOwnPropertyDescriptor%",!0),l=i("%Object.defineProperty%",!0),u=i("%Math.max%");if(l)try{l({},"a",{value:1})}catch(e){l=null}e.exports=function(e){var t=s(r,o,arguments);return a&&l&&a(t,"length").configurable&&l(t,"length",{value:1+u(0,e.length-(arguments.length-1))}),t};function c(){return s(r,n,arguments)}l?l(e.exports,"apply",{value:c}):e.exports.apply=c},7795:function(e){"use strict";var l=Array.prototype.slice,u=Object.prototype.toString;e.exports=function(t){var i=this;if("function"!=typeof i||"[object Function]"!==u.call(i))throw new TypeError("Function.prototype.bind called on incompatible "+i);for(var r,e,n=l.call(arguments,1),o=Math.max(0,i.length-n.length),s=[],a=0;a<o;a++)s.push("$"+a);return r=Function("binder","return function ("+s.join(",")+"){ return binder.apply(this,arguments); }")(function(){var e;return this instanceof r?(e=i.apply(this,n.concat(l.call(arguments))),Object(e)===e?e:this):i.apply(t,n.concat(l.call(arguments)))}),i.prototype&&((e=function(){}).prototype=i.prototype,r.prototype=new e,e.prototype=null),r}},4090:function(e,t,i){"use strict";i=i(7795);e.exports=Function.prototype.bind||i},7286:function(e,t,i){"use strict";var r,A=SyntaxError,n=Function,p=TypeError,o=function(e){try{return n('"use strict"; return ('+e+").constructor;")()}catch(e){}},f=Object.getOwnPropertyDescriptor;if(f)try{f({},"")}catch(e){f=null}function s(){throw new p}function d(e){var t,i;return"%AsyncFunction%"===e?t=o("async function () {}"):"%GeneratorFunction%"===e?t=o("function* () {}"):"%AsyncGeneratorFunction%"===e?t=o("async function* () {}"):"%AsyncGenerator%"===e?(i=d("%AsyncGeneratorFunction%"))&&(t=i.prototype):"%AsyncIteratorPrototype%"===e&&(i=d("%AsyncGenerator%"))&&(t=u(i.prototype)),m[e]=t}var a=f?function(){try{return s}catch(e){try{return f(arguments,"callee").get}catch(e){return s}}}():s,l=i(2636)(),u=Object.getPrototypeOf||function(e){return e.__proto__},g={},c="undefined"==typeof Uint8Array?r:u(Uint8Array),m={"%AggregateError%":"undefined"==typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":l?u([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":g,"%AsyncGenerator%":g,"%AsyncGeneratorFunction%":g,"%AsyncIteratorPrototype%":g,"%Atomics%":"undefined"==typeof Atomics?r:Atomics,"%BigInt%":"undefined"==typeof BigInt?r:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":n,"%GeneratorFunction%":g,"%Int8Array%":"undefined"==typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":l?u(u([][Symbol.iterator]())):r,"%JSON%":"object"==typeof JSON?JSON:r,"%Map%":"undefined"==typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&l?u((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?r:Promise,"%Proxy%":"undefined"==typeof Proxy?r:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&l?u((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":l?u(""[Symbol.iterator]()):r,"%Symbol%":l?Symbol:r,"%SyntaxError%":A,"%ThrowTypeError%":a,"%TypedArray%":c,"%TypeError%":p,"%Uint8Array%":"undefined"==typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?r:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?r:WeakSet},y={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},l=i(4090),_=i(3198),v=l.call(Function.call,Array.prototype.concat),C=l.call(Function.apply,Array.prototype.splice),w=l.call(Function.call,String.prototype.replace),x=l.call(Function.call,String.prototype.slice),b=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,E=/\\(\\)?/g;e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new p("intrinsic name must be a non-empty string");if(1<arguments.length&&"boolean"!=typeof t)throw new p('"allowMissing" argument must be a boolean');var i=function(e){var t=x(e,0,1),i=x(e,-1);if("%"===t&&"%"!==i)throw new A("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==t)throw new A("invalid intrinsic syntax, expected opening `%`");var n=[];return w(e,b,function(e,t,i,r){n[n.length]=i?w(r,E,"$1"):t||e}),n}(e),r=0<i.length?i[0]:"",n=function(e,t){var i,r=e;if(_(y,r)&&(r="%"+(i=y[r])[0]+"%"),_(m,r)){var n=m[r];if(void 0!==(n=n===g?d(r):n)||t)return{alias:i,name:r,value:n};throw new p("intrinsic "+e+" exists, but is not available. Please file an issue!")}throw new A("intrinsic "+e+" does not exist!")}("%"+r+"%",t),o=(n.name,n.value),s=!1,n=n.alias;n&&(r=n[0],C(i,v([0,1],n)));for(var a=1,l=!0;a<i.length;a+=1){var u=i[a],c=x(u,0,1),h=x(u,-1);if(('"'===c||"'"===c||"`"===c||'"'===h||"'"===h||"`"===h)&&c!==h)throw new A("property names with quotes must have matching quotes");if("constructor"!==u&&l||(s=!0),_(m,c="%"+(r+="."+u)+"%"))o=m[c];else if(null!=o){if(!(u in o)){if(t)return;throw new p("base intrinsic for "+e+" exists, but the property is not available.")}o=f&&a+1>=i.length?(l=!!(h=f(o,u)))&&"get"in h&&!("originalValue"in h.get)?h.get:o[u]:(l=_(o,u),o[u]),l&&!s&&(m[c]=o)}}return o}},2636:function(e,t,i){"use strict";var r="undefined"!=typeof Symbol&&Symbol,n=i(6679);e.exports=function(){return"function"==typeof r&&"function"==typeof Symbol&&"symbol"==typeof r("foo")&&"symbol"==typeof Symbol("bar")&&n()}},6679:function(e){"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"!=typeof Symbol.iterator){var e={},t=Symbol("test"),i=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;i=Object.getOwnPropertySymbols(e);if(1!==i.length||i[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){i=Object.getOwnPropertyDescriptor(e,t);if(42!==i.value||!0!==i.enumerable)return!1}}return!0}},3198:function(e,t,i){"use strict";i=i(4090);e.exports=i.call(Function.call,Object.prototype.hasOwnProperty)},1763:function(e){
/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 */
e.exports=function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]};return n(e,t)};function t(e,t){if(typeof t!=="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}var W=function(){W=Object.assign||function e(t){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var o in i)if(Object.prototype.hasOwnProperty.call(i,o))t[o]=i[o]}return t};return W.apply(this,arguments)};function u(e,s,i,a){function l(t){return t instanceof i?t:new i(function(e){e(t)})}return new(i||(i=Promise))(function(t,i){function r(e){try{o(a.next(e))}catch(e){i(e)}}function n(e){try{o(a["throw"](e))}catch(e){i(e)}}function o(e){e.done?t(e.value):l(e.value).then(r,n)}o((a=a.apply(e,s||[])).next())})}function V(e,i){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,t;return t={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(t[Symbol.iterator]=function(){return this}),t;function a(t){return function(e){return l([t,e])}}function l(t){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(s=t[0]&2?o["return"]:t[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;if(o=0,s)t=[t[0]&2,s.value];switch(t[0]){case 0:case 1:s=t;break;case 4:r.label++;return{value:t[1],done:false};case 5:r.label++;o=t[1];t=[0];continue;case 7:t=r.ops.pop();r.trys.pop();continue;default:if(!(s=r.trys,s=s.length>0&&s[s.length-1])&&(t[0]===6||t[0]===2)){r=0;continue}if(t[0]===3&&(!s||t[1]>s[0]&&t[1]<s[3])){r.label=t[1];break}if(t[0]===6&&r.label<s[1]){r.label=s[1];s=t;break}if(s&&r.label<s[2]){r.label=s[2];r.ops.push(t);break}if(s[2])r.ops.pop();r.trys.pop();continue}t=i.call(e,r)}catch(e){t=[6,e];o=0}finally{n=s=0}if(t[0]&5)throw t[1];return{value:t[0]?t[1]:void 0,done:true}}}function s(e,t,i){if(i||arguments.length===2)for(var r=0,n=t.length,o;r<n;r++)if(o||!(r in t)){if(!o)o=Array.prototype.slice.call(t,0,r);o[r]=t[r]}return e.concat(o||t)}for(var G=function(){function n(e,t,i,r){this.left=e;this.top=t;this.width=i;this.height=r}n.prototype.add=function(e,t,i,r){return new n(this.left+e,this.top+t,this.width+i,this.height+r)};n.fromClientRect=function(e,t){return new n(t.left+e.windowBounds.left,t.top+e.windowBounds.top,t.width,t.height)};n.fromDOMRectList=function(e,t){var i=Array.from(t).find(function(e){return e.width!==0});return i?new n(i.left+e.windowBounds.left,i.top+e.windowBounds.top,i.width,i.height):n.EMPTY};n.EMPTY=new n(0,0,0,0);return n}(),q=function(e,t){return G.fromClientRect(e,t.getBoundingClientRect())},K=function(e){var t=e.body;var i=e.documentElement;if(!t||!i)throw new Error("Unable to get document size");var r=Math.max(Math.max(t.scrollWidth,i.scrollWidth),Math.max(t.offsetWidth,i.offsetWidth),Math.max(t.clientWidth,i.clientWidth));var n=Math.max(Math.max(t.scrollHeight,i.scrollHeight),Math.max(t.offsetHeight,i.offsetHeight),Math.max(t.clientHeight,i.clientHeight));return new G(0,0,r,n)},N=function(e){var t=[];var i=0;var r=e.length;while(i<r){var n=e.charCodeAt(i++);if(n>=55296&&n<=56319&&i<r){var o=e.charCodeAt(i++);if((o&64512)===56320)t.push(((n&1023)<<10)+(o&1023)+65536);else{t.push(n);i--}}else t.push(n)}return t},d=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var i=e.length;if(!i)return"";var r=[];var n=-1;var o="";while(++n<i){var s=e[n];if(s<=65535)r.push(s);else{s-=65536;r.push((s>>10)+55296,s%1024+56320)}if(n+1===i||r.length>16384){o+=String.fromCharCode.apply(String,r);r.length=0}}return o},e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=typeof Uint8Array==="undefined"?[]:new Uint8Array(256),U=0;U<e.length;U++)a[e.charCodeAt(U)]=U;for(var k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",H=typeof Uint8Array==="undefined"?[]:new Uint8Array(256),Q=0;Q<k.length;Q++)H[k.charCodeAt(Q)]=Q;for(var j=function(e){var t=e.length*.75,i=e.length,r,n=0,o,s,a,l;if(e[e.length-1]==="="){t--;if(e[e.length-2]==="=")t--}var u=typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined"&&typeof Uint8Array.prototype.slice!=="undefined"?new ArrayBuffer(t):new Array(t);var c=Array.isArray(u)?u:new Uint8Array(u);for(r=0;r<i;r+=4){o=H[e.charCodeAt(r)];s=H[e.charCodeAt(r+1)];a=H[e.charCodeAt(r+2)];l=H[e.charCodeAt(r+3)];c[n++]=o<<2|s>>4;c[n++]=(s&15)<<4|a>>2;c[n++]=(a&3)<<6|l&63}return u},Z=function(e){var t=e.length;var i=[];for(var r=0;r<t;r+=2)i.push(e[r+1]<<8|e[r]);return i},Y=function(e){var t=e.length;var i=[];for(var r=0;r<t;r+=4)i.push(e[r+3]<<24|e[r+2]<<16|e[r+1]<<8|e[r]);return i},X=5,J=6+5,$=2,ee,te=65536>>X,ie,re=(1<<X)-1,ne,oe,se,ae,le=te+(1024>>X)+(2048>>6),ue=65536>>J,ce,he=(1<<J-X)-1,Ae=function(e,t,i){if(e.slice)return e.slice(t,i);return new Uint16Array(Array.prototype.slice.call(e,t,i))},pe=function(e,t,i){if(e.slice)return e.slice(t,i);return new Uint32Array(Array.prototype.slice.call(e,t,i))},fe=function(e,t){var i=j(e);var r=Array.isArray(i)?Y(i):new Uint32Array(i);var n=Array.isArray(i)?Z(i):new Uint16Array(i);var o=24;var s=Ae(n,o/2,r[4]/2);var a=r[5]===2?Ae(n,(o+r[4])/2):pe(r,Math.ceil((o+r[4])/4));return new de(r[0],r[1],r[2],r[3],s,a)},de=function(){function e(e,t,i,r,n,o){this.initialValue=e;this.errorValue=t;this.highStart=i;this.highValueIndex=r;this.index=n;this.data=o}e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535){t=this.index[e>>X];t=(t<<$)+(e&re);return this.data[t]}if(e<=65535){t=this.index[te+(e-55296>>X)];t=(t<<$)+(e&re);return this.data[t]}if(e<this.highStart){t=le-ue+(e>>J);t=this.index[t];t+=e>>X&he;t=this.index[t];t=(t<<$)+(e&re);return this.data[t]}if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue};return e}(),ge="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",me=typeof Uint8Array==="undefined"?[]:new Uint8Array(256),ye=0;ye<ge.length;ye++)me[ge.charCodeAt(ye)]=ye;var _e,ve=50,Ce=1,we=2,xe=3,be=4,Ee=5,Be=7,Me=8,Ie=9,g=10,Se=11,Pe=12,Te=13,Le=14,De=15,Fe=16,Ne=17,Oe=18,Re=19,Ue=20,ke=21,He=22,Qe=23,Ve=24,m=25,Ge=26,ze=27,We=28,qe=29,Ke=30,je=31,Ze=32,Ye=33,Xe=34,Je=35,$e=36,et=37,tt=38,it=39,rt=40,nt=41,ot=42,st=43,at=[9001,65288],lt="!",y="×",ut="÷",ct=fe("KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA=="),_=[Ke,$e],ht=[Ce,we,xe,Ee],At=[g,Me],pt=[ze,Ge],ft=ht.concat(At),dt=[tt,it,rt,Xe,Je],gt=[De,Te],mt=function(e,n){if(n===void 0)n="strict";var o=[];var s=[];var a=[];e.forEach(function(e,t){var i=ct.get(e);if(i>ve){a.push(true);i-=ve}else a.push(false);if(["normal","auto","loose"].indexOf(n)!==-1)if([8208,8211,12316,12448].indexOf(e)!==-1){s.push(t);return o.push(Fe)}if(i===be||i===Se){if(t===0){s.push(t);return o.push(Ke)}var r=o[t-1];if(ft.indexOf(r)===-1){s.push(s[t-1]);return o.push(r)}s.push(t);return o.push(Ke)}s.push(t);if(i===je)return o.push(n==="strict"?ke:et);if(i===ot)return o.push(Ke);if(i===qe)return o.push(Ke);if(i===st)if(e>=131072&&e<=196605||e>=196608&&e<=262141)return o.push(et);else return o.push(Ke);o.push(i)});return[s,o,a]},yt=function(e,t,i,r){var n=r[i];if(Array.isArray(e)?e.indexOf(n)!==-1:e===n){var o=i;while(o<=r.length){o++;var s=r[o];if(s===t)return true;if(s!==g)break}}if(n===g){var o=i;while(o>0){o--;var a=r[o];if(Array.isArray(e)?e.indexOf(a)!==-1:e===a){var l=i;while(l<=r.length){l++;var s=r[l];if(s===t)return true;if(s!==g)break}}if(a!==g)break}}return false},_t=function(e,t){var i=e;while(i>=0){var r=t[i];if(r===g)i--;else return r}return 0},vt=function(e,t,i,r,n){if(i[r]===0)return y;var o=r-1;if(Array.isArray(n)&&n[o]===true)return y;var s=o-1;var a=o+1;var l=t[o];var u=s>=0?t[s]:0;var c=t[a];if(l===we&&c===xe)return y;if(ht.indexOf(l)!==-1)return lt;if(ht.indexOf(c)!==-1)return y;if(At.indexOf(c)!==-1)return y;if(_t(o,t)===Me)return ut;if(ct.get(e[o])===Se)return y;if((l===Ze||l===Ye)&&ct.get(e[a])===Se)return y;if(l===Be||c===Be)return y;if(l===Ie)return y;if([g,Te,De].indexOf(l)===-1&&c===Ie)return y;if([Ne,Oe,Re,Ve,We].indexOf(c)!==-1)return y;if(_t(o,t)===He)return y;if(yt(Qe,He,o,t))return y;if(yt([Ne,Oe],ke,o,t))return y;if(yt(Pe,Pe,o,t))return y;if(l===g)return ut;if(l===Qe||c===Qe)return y;if(c===Fe||l===Fe)return ut;if([Te,De,ke].indexOf(c)!==-1||l===Le)return y;if(u===$e&&gt.indexOf(l)!==-1)return y;if(l===We&&c===$e)return y;if(c===Ue)return y;if(_.indexOf(c)!==-1&&l===m||_.indexOf(l)!==-1&&c===m)return y;if(l===ze&&[et,Ze,Ye].indexOf(c)!==-1||[et,Ze,Ye].indexOf(l)!==-1&&c===Ge)return y;if(_.indexOf(l)!==-1&&pt.indexOf(c)!==-1||pt.indexOf(l)!==-1&&_.indexOf(c)!==-1)return y;if([ze,Ge].indexOf(l)!==-1&&(c===m||[He,De].indexOf(c)!==-1&&t[a+1]===m)||[He,De].indexOf(l)!==-1&&c===m||l===m&&[m,We,Ve].indexOf(c)!==-1)return y;if([m,We,Ve,Ne,Oe].indexOf(c)!==-1){var h=o;while(h>=0){var A=t[h];if(A===m)return y;else if([We,Ve].indexOf(A)!==-1)h--;else break}}if([ze,Ge].indexOf(c)!==-1){var h=[Ne,Oe].indexOf(l)!==-1?s:o;while(h>=0){var A=t[h];if(A===m)return y;else if([We,Ve].indexOf(A)!==-1)h--;else break}}if(tt===l&&[tt,it,Xe,Je].indexOf(c)!==-1||[it,Xe].indexOf(l)!==-1&&[it,rt].indexOf(c)!==-1||[rt,Je].indexOf(l)!==-1&&c===rt)return y;if(dt.indexOf(l)!==-1&&[Ue,Ge].indexOf(c)!==-1||dt.indexOf(c)!==-1&&l===ze)return y;if(_.indexOf(l)!==-1&&_.indexOf(c)!==-1)return y;if(l===Ve&&_.indexOf(c)!==-1)return y;if(_.concat(m).indexOf(l)!==-1&&c===He&&at.indexOf(e[a])===-1||_.concat(m).indexOf(c)!==-1&&l===Oe)return y;if(l===nt&&c===nt){var p=i[o];var f=1;while(p>0){p--;if(t[p]===nt)f++;else break}if(f%2!==0)return y}if(l===Ze&&c===Ye)return y;return ut},Ct=function(i,e){if(!e)e={lineBreak:"normal",wordBreak:"normal"};var t=mt(i,e.lineBreak),r=t[0],n=t[1],o=t[2];if(e.wordBreak==="break-all"||e.wordBreak==="break-word")n=n.map(function(e){return[m,Ke,ot].indexOf(e)!==-1?et:e});var s=e.wordBreak==="keep-all"?o.map(function(e,t){return e&&i[t]>=19968&&i[t]<=40959}):undefined;return[r,n,s]},wt=function(){function e(e,t,i,r){this.codePoints=e;this.required=t===lt;this.start=i;this.end=r}e.prototype.slice=function(){return d.apply(void 0,this.codePoints.slice(this.start,this.end))};return e}(),xt=function(e,t){var i=N(e);var r=Ct(i,t),n=r[0],o=r[1],s=r[2];var a=i.length;var l=0;var u=0;return{next:function(){if(u>=a)return{done:true,value:null};var e=y;while(u<a&&(e=vt(i,o,n,++u,s))===y);if(e!==y||u===a){var t=new wt(i,e,l,u);l=u;return{value:t,done:false}}return{done:true,value:null}}}},bt=1<<0,Et=1<<1,Bt=1<<2,Mt=1<<3,It=10,St=47,Pt=92,Tt=9,Lt=32,Dt=34,Ft=61,Nt=35,Ot=36,Rt=37,Ut=39,kt=40,Ht=41,Qt=95,v=45,Vt=33,Gt=60,zt=62,Wt=64,qt=91,Kt=93,jt=61,Zt=123,Yt=63,Xt=125,Jt=124,$t=126,ei=128,ti=65533,ii=42,ri=43,ni=44,oi=58,si=59,ai=46,li=0,ui=8,ci=11,hi=14,Ai=31,pi=127,C=-1,fi=48,di=97,gi=101,mi=102,yi=117,_i=122,vi=65,Ci=69,wi=70,xi=85,bi=90,w=function(e){return e>=fi&&e<=57},Ei=function(e){return e>=55296&&e<=57343},Bi=function(e){return w(e)||e>=vi&&e<=wi||e>=di&&e<=mi},Mi=function(e){return e>=di&&e<=_i},Ii=function(e){return e>=vi&&e<=bi},Si=function(e){return Mi(e)||Ii(e)},Pi=function(e){return e>=ei},Ti=function(e){return e===It||e===Tt||e===Lt},Li=function(e){return Si(e)||Pi(e)||e===Qt},Di=function(e){return Li(e)||w(e)||e===v},Fi=function(e){return e>=li&&e<=ui||e===ci||e>=hi&&e<=Ai||e===pi},x=function(e,t){if(e!==Pt)return false;return t!==It},Ni=function(e,t,i){if(e===v)return Li(t)||x(t,i);else if(Li(e))return true;else if(e===Pt&&x(e,t))return true;return false},Oi=function(e,t,i){if(e===ri||e===v){if(w(t))return true;return t===ai&&w(i)}if(e===ai)return w(t);return w(e)},Ri=function(e){var t=0;var i=1;if(e[t]===ri||e[t]===v){if(e[t]===v)i=-1;t++}var r=[];while(w(e[t]))r.push(e[t++]);var n=r.length?parseInt(d.apply(void 0,r),10):0;if(e[t]===ai)t++;var o=[];while(w(e[t]))o.push(e[t++]);var s=o.length;var a=s?parseInt(d.apply(void 0,o),10):0;if(e[t]===Ci||e[t]===gi)t++;var l=1;if(e[t]===ri||e[t]===v){if(e[t]===v)l=-1;t++}var u=[];while(w(e[t]))u.push(e[t++]);var c=u.length?parseInt(d.apply(void 0,u),10):0;return i*(n+a*Math.pow(10,-s))*Math.pow(10,l*c)},Ui={type:2},ki={type:3},Hi={type:4},Qi={type:13},Vi={type:8},Gi={type:21},zi={type:9},Wi={type:10},qi={type:11},Ki={type:12},ji={type:14},Zi={type:23},Yi={type:1},Xi={type:25},Ji={type:24},$i={type:26},er={type:27},tr={type:28},ir={type:29},rr={type:31},nr={type:32},or=function(){function e(){this._value=[]}e.prototype.write=function(e){this._value=this._value.concat(N(e))};e.prototype.read=function(){var e=[];var t=this.consumeToken();while(t!==nr){e.push(t);t=this.consumeToken()}return e};e.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case Dt:return this.consumeStringToken(Dt);case Nt:var t=this.peekCodePoint(0);var i=this.peekCodePoint(1);var r=this.peekCodePoint(2);if(Di(t)||x(i,r)){var n=Ni(t,i,r)?Et:bt;var o=this.consumeName();return{type:5,value:o,flags:n}}break;case Ot:if(this.peekCodePoint(0)===Ft){this.consumeCodePoint();return Qi}break;case Ut:return this.consumeStringToken(Ut);case kt:return Ui;case Ht:return ki;case ii:if(this.peekCodePoint(0)===Ft){this.consumeCodePoint();return ji}break;case ri:if(Oi(e,this.peekCodePoint(0),this.peekCodePoint(1))){this.reconsumeCodePoint(e);return this.consumeNumericToken()}break;case ni:return Hi;case v:var s=e;var a=this.peekCodePoint(0);var l=this.peekCodePoint(1);if(Oi(s,a,l)){this.reconsumeCodePoint(e);return this.consumeNumericToken()}if(Ni(s,a,l)){this.reconsumeCodePoint(e);return this.consumeIdentLikeToken()}if(a===v&&l===zt){this.consumeCodePoint();this.consumeCodePoint();return Ji}break;case ai:if(Oi(e,this.peekCodePoint(0),this.peekCodePoint(1))){this.reconsumeCodePoint(e);return this.consumeNumericToken()}break;case St:if(this.peekCodePoint(0)===ii){this.consumeCodePoint();while(true){var u=this.consumeCodePoint();if(u===ii){u=this.consumeCodePoint();if(u===St)return this.consumeToken()}if(u===C)return this.consumeToken()}}break;case oi:return $i;case si:return er;case Gt:if(this.peekCodePoint(0)===Vt&&this.peekCodePoint(1)===v&&this.peekCodePoint(2)===v){this.consumeCodePoint();this.consumeCodePoint();return Xi}break;case Wt:var c=this.peekCodePoint(0);var h=this.peekCodePoint(1);var A=this.peekCodePoint(2);if(Ni(c,h,A)){var o=this.consumeName();return{type:7,value:o}}break;case qt:return tr;case Pt:if(x(e,this.peekCodePoint(0))){this.reconsumeCodePoint(e);return this.consumeIdentLikeToken()}break;case Kt:return ir;case jt:if(this.peekCodePoint(0)===Ft){this.consumeCodePoint();return Vi}break;case Zt:return qi;case Xt:return Ki;case yi:case xi:var p=this.peekCodePoint(0);var f=this.peekCodePoint(1);if(p===ri&&(Bi(f)||f===Yt)){this.consumeCodePoint();this.consumeUnicodeRangeToken()}this.reconsumeCodePoint(e);return this.consumeIdentLikeToken();case Jt:if(this.peekCodePoint(0)===Ft){this.consumeCodePoint();return zi}if(this.peekCodePoint(0)===Jt){this.consumeCodePoint();return Gi}break;case $t:if(this.peekCodePoint(0)===Ft){this.consumeCodePoint();return Wi}break;case C:return nr}if(Ti(e)){this.consumeWhiteSpace();return rr}if(w(e)){this.reconsumeCodePoint(e);return this.consumeNumericToken()}if(Li(e)){this.reconsumeCodePoint(e);return this.consumeIdentLikeToken()}return{type:6,value:d(e)}};e.prototype.consumeCodePoint=function(){var e=this._value.shift();return typeof e==="undefined"?-1:e};e.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)};e.prototype.peekCodePoint=function(e){if(e>=this._value.length)return-1;return this._value[e]};e.prototype.consumeUnicodeRangeToken=function(){var e=[];var t=this.consumeCodePoint();while(Bi(t)&&e.length<6){e.push(t);t=this.consumeCodePoint()}var i=false;while(t===Yt&&e.length<6){e.push(t);t=this.consumeCodePoint();i=true}if(i){var r=parseInt(d.apply(void 0,e.map(function(e){return e===Yt?fi:e})),16);var n=parseInt(d.apply(void 0,e.map(function(e){return e===Yt?wi:e})),16);return{type:30,start:r,end:n}}var o=parseInt(d.apply(void 0,e),16);if(this.peekCodePoint(0)===v&&Bi(this.peekCodePoint(1))){this.consumeCodePoint();t=this.consumeCodePoint();var s=[];while(Bi(t)&&s.length<6){s.push(t);t=this.consumeCodePoint()}var n=parseInt(d.apply(void 0,s),16);return{type:30,start:o,end:n}}else return{type:30,start:o,end:o}};e.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();if(e.toLowerCase()==="url"&&this.peekCodePoint(0)===kt){this.consumeCodePoint();return this.consumeUrlToken()}else if(this.peekCodePoint(0)===kt){this.consumeCodePoint();return{type:19,value:e}}return{type:20,value:e}};e.prototype.consumeUrlToken=function(){var e=[];this.consumeWhiteSpace();if(this.peekCodePoint(0)===C)return{type:22,value:""};var t=this.peekCodePoint(0);if(t===Ut||t===Dt){var i=this.consumeStringToken(this.consumeCodePoint());if(i.type===0){this.consumeWhiteSpace();if(this.peekCodePoint(0)===C||this.peekCodePoint(0)===Ht){this.consumeCodePoint();return{type:22,value:i.value}}}this.consumeBadUrlRemnants();return Zi}while(true){var r=this.consumeCodePoint();if(r===C||r===Ht)return{type:22,value:d.apply(void 0,e)};else if(Ti(r)){this.consumeWhiteSpace();if(this.peekCodePoint(0)===C||this.peekCodePoint(0)===Ht){this.consumeCodePoint();return{type:22,value:d.apply(void 0,e)}}this.consumeBadUrlRemnants();return Zi}else if(r===Dt||r===Ut||r===kt||Fi(r)){this.consumeBadUrlRemnants();return Zi}else if(r===Pt)if(x(r,this.peekCodePoint(0)))e.push(this.consumeEscapedCodePoint());else{this.consumeBadUrlRemnants();return Zi}else e.push(r)}};e.prototype.consumeWhiteSpace=function(){while(Ti(this.peekCodePoint(0)))this.consumeCodePoint()};e.prototype.consumeBadUrlRemnants=function(){while(true){var e=this.consumeCodePoint();if(e===Ht||e===C)return;if(x(e,this.peekCodePoint(0)))this.consumeEscapedCodePoint()}};e.prototype.consumeStringSlice=function(e){var t=5e4;var i="";while(e>0){var r=Math.min(t,e);i+=d.apply(void 0,this._value.splice(0,r));e-=r}this._value.shift();return i};e.prototype.consumeStringToken=function(e){var t="";var i=0;do{var r=this._value[i];if(r===C||r===undefined||r===e){t+=this.consumeStringSlice(i);return{type:0,value:t}}if(r===It){this._value.splice(0,i);return Yi}if(r===Pt){var n=this._value[i+1];if(n!==C&&n!==undefined)if(n===It){t+=this.consumeStringSlice(i);i=-1;this._value.shift()}else if(x(r,n)){t+=this.consumeStringSlice(i);t+=d(this.consumeEscapedCodePoint());i=-1}}i++}while(true)};e.prototype.consumeNumber=function(){var e=[];var t=Bt;var i=this.peekCodePoint(0);if(i===ri||i===v)e.push(this.consumeCodePoint());while(w(this.peekCodePoint(0)))e.push(this.consumeCodePoint());i=this.peekCodePoint(0);var r=this.peekCodePoint(1);if(i===ai&&w(r)){e.push(this.consumeCodePoint(),this.consumeCodePoint());t=Mt;while(w(this.peekCodePoint(0)))e.push(this.consumeCodePoint())}i=this.peekCodePoint(0);r=this.peekCodePoint(1);var n=this.peekCodePoint(2);if((i===Ci||i===gi)&&((r===ri||r===v)&&w(n)||w(r))){e.push(this.consumeCodePoint(),this.consumeCodePoint());t=Mt;while(w(this.peekCodePoint(0)))e.push(this.consumeCodePoint())}return[Ri(e),t]};e.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],i=e[1];var r=this.peekCodePoint(0);var n=this.peekCodePoint(1);var o=this.peekCodePoint(2);if(Ni(r,n,o)){var s=this.consumeName();return{type:15,number:t,flags:i,unit:s}}if(r===Rt){this.consumeCodePoint();return{type:16,number:t,flags:i}}return{type:17,number:t,flags:i}};e.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(Bi(e)){var t=d(e);while(Bi(this.peekCodePoint(0))&&t.length<6)t+=d(this.consumeCodePoint());if(Ti(this.peekCodePoint(0)))this.consumeCodePoint();var i=parseInt(t,16);if(i===0||Ei(i)||i>1114111)return ti;return i}if(e===C)return ti;return e};e.prototype.consumeName=function(){var e="";while(true){var t=this.consumeCodePoint();if(Di(t))e+=d(t);else if(x(t,this.peekCodePoint(0)))e+=d(this.consumeEscapedCodePoint());else{this.reconsumeCodePoint(t);return e}}};return e}(),sr=function(){function i(e){this._tokens=e}i.create=function(e){var t=new or;t.write(e);return new i(t.read())};i.parseValue=function(e){return i.create(e).parseComponentValue()};i.parseValues=function(e){return i.create(e).parseComponentValues()};i.prototype.parseComponentValue=function(){var e=this.consumeToken();while(e.type===31)e=this.consumeToken();if(e.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do{e=this.consumeToken()}while(e.type===31);if(e.type===32)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")};i.prototype.parseComponentValues=function(){var e=[];while(true){var t=this.consumeComponentValue();if(t.type===32)return e;e.push(t);e.push()}};i.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e};i.prototype.consumeSimpleBlock=function(e){var t={type:e,values:[]};var i=this.consumeToken();while(true){if(i.type===32||pr(i,e))return t;this.reconsumeToken(i);t.values.push(this.consumeComponentValue());i=this.consumeToken()}};i.prototype.consumeFunction=function(e){var t={name:e.value,values:[],type:18};while(true){var i=this.consumeToken();if(i.type===32||i.type===3)return t;this.reconsumeToken(i);t.values.push(this.consumeComponentValue())}};i.prototype.consumeToken=function(){var e=this._tokens.shift();return typeof e==="undefined"?nr:e};i.prototype.reconsumeToken=function(e){this._tokens.unshift(e)};return i}(),ar=function(e){return e.type===15},lr=function(e){return e.type===17},b=function(e){return e.type===20},ur=function(e){return e.type===0},cr=function(e,t){return b(e)&&e.value===t},hr=function(e){return e.type!==31},Ar=function(e){return e.type!==31&&e.type!==4},c=function(e){var t=[];var i=[];e.forEach(function(e){if(e.type===4){if(i.length===0)throw new Error("Error parsing function args, zero tokens for arg");t.push(i);i=[];return}if(e.type!==31)i.push(e)});if(i.length)t.push(i);return t},pr=function(e,t){if(t===11&&e.type===12)return true;if(t===28&&e.type===29)return true;return t===2&&e.type===3},h=function(e){return e.type===17||e.type===15},E=function(e){return e.type===16||h(e)},fr=function(e){return e.length>1?[e[0],e[1]]:[e[0]]},B={type:17,number:0,flags:Bt},dr={type:16,number:50,flags:Bt},M={type:16,number:100,flags:Bt},gr=function(e,t,i){var r=e[0],n=e[1];return[O(r,t),O(typeof n!=="undefined"?n:r,i)]},O=function(e,t){if(e.type===16)return e.number/100*t;if(ar(e))switch(e.unit){case"rem":case"em":return 16*e.number;case"px":default:return e.number}return e.number},mr="deg",yr="grad",_r="rad",vr="turn",Cr={name:"angle",parse:function(e,t){if(t.type===15)switch(t.unit){case mr:return Math.PI*t.number/180;case yr:return Math.PI/200*t.number;case _r:return t.number;case vr:return Math.PI*2*t.number}throw new Error("Unsupported angle type")}},wr=function(e){if(e.type===15)if(e.unit===mr||e.unit===yr||e.unit===_r||e.unit===vr)return true;return false},xr=function(e){var t=e.filter(b).map(function(e){return e.value}).join(" ");switch(t){case"to bottom right":case"to right bottom":case"left top":case"top left":return[B,B];case"to top":case"bottom":return I(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[B,M];case"to right":case"left":return I(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[M,M];case"to bottom":case"top":return I(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[M,B];case"to left":case"right":return I(270)}return 0},I=function(e){return Math.PI*e/180},br={name:"color",parse:function(e,t){if(t.type===18){var i=Tr[t.name];if(typeof i==="undefined")throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return i(e,t.values)}if(t.type===5){if(t.value.length===3){var r=t.value.substring(0,1);var n=t.value.substring(1,2);var o=t.value.substring(2,3);return Br(parseInt(r+r,16),parseInt(n+n,16),parseInt(o+o,16),1)}if(t.value.length===4){var r=t.value.substring(0,1);var n=t.value.substring(1,2);var o=t.value.substring(2,3);var s=t.value.substring(3,4);return Br(parseInt(r+r,16),parseInt(n+n,16),parseInt(o+o,16),parseInt(s+s,16)/255)}if(t.value.length===6){var r=t.value.substring(0,2);var n=t.value.substring(2,4);var o=t.value.substring(4,6);return Br(parseInt(r,16),parseInt(n,16),parseInt(o,16),1)}if(t.value.length===8){var r=t.value.substring(0,2);var n=t.value.substring(2,4);var o=t.value.substring(4,6);var s=t.value.substring(6,8);return Br(parseInt(r,16),parseInt(n,16),parseInt(o,16),parseInt(s,16)/255)}}if(t.type===20){var a=z[t.value.toUpperCase()];if(typeof a!=="undefined")return a}return z.TRANSPARENT}},Er=function(e){return(255&e)===0},R=function(e){var t=255&e;var i=255&e>>8;var r=255&e>>16;var n=255&e>>24;return t<255?"rgba("+n+","+r+","+i+","+t/255+")":"rgb("+n+","+r+","+i+")"},Br=function(e,t,i,r){return(e<<24|t<<16|i<<8|Math.round(r*255)<<0)>>>0},Mr=function(e,t){if(e.type===17)return e.number;if(e.type===16){var i=t===3?1:255;return t===3?e.number/100*i:Math.round(e.number/100*i)}return 0},Ir=function(e,t){var i=t.filter(Ar);if(i.length===3){var r=i.map(Mr),n=r[0],o=r[1],s=r[2];return Br(n,o,s,1)}if(i.length===4){var a=i.map(Mr),n=a[0],o=a[1],s=a[2],l=a[3];return Br(n,o,s,l)}return 0};function Sr(e,t,i){if(i<0)i+=1;if(i>=1)i-=1;if(i<1/6)return(t-e)*i*6+e;else if(i<1/2)return t;else if(i<2/3)return(t-e)*6*(2/3-i)+e;else return e}var Pr=function(e,t){var i=t.filter(Ar);var r=i[0],n=i[1],o=i[2],s=i[3];var a=(r.type===17?I(r.number):Cr.parse(e,r))/(Math.PI*2);var l=E(n)?n.number/100:0;var u=E(o)?o.number/100:0;var c=typeof s!=="undefined"&&E(s)?O(s,1):1;if(l===0)return Br(u*255,u*255,u*255,1);var h=u<=.5?u*(l+1):u+l-u*l;var A=u*2-h;var p=Sr(A,h,a+1/3);var f=Sr(A,h,a);var d=Sr(A,h,a-1/3);return Br(p*255,f*255,d*255,c)},Tr={hsl:Pr,hsla:Pr,rgb:Ir,rgba:Ir},Lr=function(e,t){return br.parse(e,sr.create(t).parseComponentValue())},z={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},Dr={name:"background-clip",initialValue:"border-box",prefix:false,type:1,parse:function(e,t){return t.map(function(e){if(b(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Fr={name:"background-color",initialValue:"transparent",prefix:false,type:3,format:"color"},Nr=function(e,t){var i=br.parse(e,t[0]);var r=t[1];return r&&E(r)?{color:i,stop:r}:{color:i,stop:null}},Or=function(e,r){var t=e[0];var i=e[e.length-1];if(t.stop===null)t.stop=B;if(i.stop===null)i.stop=M;var n=[];var o=0;for(var s=0;s<e.length;s++){var a=e[s].stop;if(a!==null){var l=O(a,r);if(l>o)n.push(l);else n.push(o);o=l}else n.push(null)}var u=null;for(var s=0;s<n.length;s++){var c=n[s];if(c===null){if(u===null)u=s}else if(u!==null){var h=s-u;var A=n[u-1];var p=(c-A)/(h+1);for(var f=1;f<=h;f++)n[u+f-1]=p*f;u=null}}return e.map(function(e,t){var i=e.color;return{color:i,stop:Math.max(Math.min(1,n[t]/r),0)}})},Rr=function(e,t,i){var r=t/2;var n=i/2;var o=O(e[0],t)-r;var s=n-O(e[1],i);return(Math.atan2(s,o)+Math.PI*2)%(Math.PI*2)},Ur=function(e,t,i){var r=typeof e==="number"?e:Rr(e,t,i);var n=Math.abs(t*Math.sin(r))+Math.abs(i*Math.cos(r));var o=t/2;var s=i/2;var a=n/2;var l=Math.sin(r-Math.PI/2)*a;var u=Math.cos(r-Math.PI/2)*a;return[n,o-u,o+u,s-l,s+l]},A=function(e,t){return Math.sqrt(e*e+t*t)},kr=function(e,t,o,s,a){var i=[[0,0],[0,t],[e,0],[e,t]];return i.reduce(function(e,t){var i=t[0],r=t[1];var n=A(o-i,s-r);if(a?n<e.optimumDistance:n>e.optimumDistance)return{optimumCorner:t,optimumDistance:n};return e},{optimumDistance:a?Infinity:-Infinity,optimumCorner:null}).optimumCorner},Hr=function(e,t,i,r,n){var o=0;var s=0;switch(e.size){case 0:if(e.shape===0)o=s=Math.min(Math.abs(t),Math.abs(t-r),Math.abs(i),Math.abs(i-n));else if(e.shape===1){o=Math.min(Math.abs(t),Math.abs(t-r));s=Math.min(Math.abs(i),Math.abs(i-n))}break;case 2:if(e.shape===0)o=s=Math.min(A(t,i),A(t,i-n),A(t-r,i),A(t-r,i-n));else if(e.shape===1){var a=Math.min(Math.abs(i),Math.abs(i-n))/Math.min(Math.abs(t),Math.abs(t-r));var l=kr(r,n,t,i,true),u=l[0],c=l[1];o=A(u-t,(c-i)/a);s=a*o}break;case 1:if(e.shape===0)o=s=Math.max(Math.abs(t),Math.abs(t-r),Math.abs(i),Math.abs(i-n));else if(e.shape===1){o=Math.max(Math.abs(t),Math.abs(t-r));s=Math.max(Math.abs(i),Math.abs(i-n))}break;case 3:if(e.shape===0)o=s=Math.max(A(t,i),A(t,i-n),A(t-r,i),A(t-r,i-n));else if(e.shape===1){var a=Math.max(Math.abs(i),Math.abs(i-n))/Math.max(Math.abs(t),Math.abs(t-r));var h=kr(r,n,t,i,false),u=h[0],c=h[1];o=A(u-t,(c-i)/a);s=a*o}break}if(Array.isArray(e.size)){o=O(e.size[0],r);s=e.size.length===2?O(e.size[1],n):o}return[o,s]},Qr,Vr=function(n,e){var o=I(180);var s=[];c(e).forEach(function(e,t){if(t===0){var i=e[0];if(i.type===20&&["top","left","right","bottom"].indexOf(i.value)!==-1){o=xr(e);return}else if(wr(i)){o=(Cr.parse(n,i)+I(270))%I(360);return}}var r=Nr(n,e);s.push(r)});return{angle:o,stops:s,type:1}},Gr,zr="closest-side",Wr="farthest-side",qr="closest-corner",Kr="farthest-corner",jr="circle",Zr="ellipse",Yr="cover",Xr="contain",Jr,$r=function(n,e){var o=0;var s=3;var a=[];var l=[];c(e).forEach(function(e,t){var i=true;if(t===0)i=e.reduce(function(e,t){if(b(t))switch(t.value){case"center":l.push(dr);return false;case"top":case"left":l.push(B);return false;case"right":case"bottom":l.push(M);return false}else if(E(t)||h(t)){l.push(t);return false}return e},i);else if(t===1)i=e.reduce(function(e,t){if(b(t))switch(t.value){case jr:o=0;return false;case Zr:o=1;return false;case Xr:case zr:s=0;return false;case Wr:s=1;return false;case qr:s=2;return false;case Yr:case Kr:s=3;return false}else if(h(t)||E(t)){if(!Array.isArray(s))s=[];s.push(t);return false}return e},i);if(i){var r=Nr(n,e);a.push(r)}});return{size:s,shape:o,stops:a,position:l,type:2}},en=function(e){return e.type===1},tn=function(e){return e.type===2},rn={name:"image",parse:function(e,t){if(t.type===22){var i={url:t.value,type:0};e.cache.addImage(t.value);return i}if(t.type===18){var r=on[t.name];if(typeof r==="undefined")throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return r(e,t.values)}throw new Error("Unsupported image type "+t.type)}};function nn(e){return!(e.type===20&&e.value==="none")&&(e.type!==18||!!on[e.name])}var on={"linear-gradient":function(n,e){var o=I(180);var s=[];c(e).forEach(function(e,t){if(t===0){var i=e[0];if(i.type===20&&i.value==="to"){o=xr(e);return}else if(wr(i)){o=Cr.parse(n,i);return}}var r=Nr(n,e);s.push(r)});return{angle:o,stops:s,type:1}},"-moz-linear-gradient":Vr,"-ms-linear-gradient":Vr,"-o-linear-gradient":Vr,"-webkit-linear-gradient":Vr,"radial-gradient":function(o,e){var s=0;var a=3;var l=[];var u=[];c(e).forEach(function(e,t){var i=true;if(t===0){var r=false;i=e.reduce(function(e,t){if(r){if(b(t))switch(t.value){case"center":u.push(dr);return e;case"top":case"left":u.push(B);return e;case"right":case"bottom":u.push(M);return e}else if(E(t)||h(t))u.push(t)}else if(b(t))switch(t.value){case jr:s=0;return false;case Zr:s=1;return false;case"at":r=true;return false;case zr:a=0;return false;case Yr:case Wr:a=1;return false;case Xr:case qr:a=2;return false;case Kr:a=3;return false}else if(h(t)||E(t)){if(!Array.isArray(a))a=[];a.push(t);return false}return e},i)}if(i){var n=Nr(o,e);l.push(n)}});return{size:a,shape:s,stops:l,position:u,type:2}},"-moz-radial-gradient":$r,"-ms-radial-gradient":$r,"-o-radial-gradient":$r,"-webkit-radial-gradient":$r,"-webkit-gradient":function(s,e){var t=I(180);var a=[];var l=1;var i=0;var r=3;var n=[];c(e).forEach(function(e,t){var i=e[0];if(t===0)if(b(i)&&i.value==="linear"){l=1;return}else if(b(i)&&i.value==="radial"){l=2;return}if(i.type===18)if(i.name==="from"){var r=br.parse(s,i.values[0]);a.push({stop:B,color:r})}else if(i.name==="to"){var r=br.parse(s,i.values[0]);a.push({stop:M,color:r})}else if(i.name==="color-stop"){var n=i.values.filter(Ar);if(n.length===2){var r=br.parse(s,n[1]);var o=n[0];if(lr(o))a.push({stop:{type:16,number:o.number*100,flags:o.flags},color:r})}}});return l===1?{angle:(t+I(180))%I(360),stops:a,type:l}:{size:r,shape:i,stops:a,position:n,type:l}}},sn={name:"background-image",initialValue:"none",type:1,prefix:false,parse:function(t,e){if(e.length===0)return[];var i=e[0];if(i.type===20&&i.value==="none")return[];return e.filter(function(e){return Ar(e)&&nn(e)}).map(function(e){return rn.parse(t,e)})}},an={name:"background-origin",initialValue:"border-box",prefix:false,type:1,parse:function(e,t){return t.map(function(e){if(b(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},ln={name:"background-position",initialValue:"0% 0%",type:1,prefix:false,parse:function(e,t){return c(t).map(function(e){return e.filter(E)}).map(fr)}},un={name:"background-repeat",initialValue:"repeat",prefix:false,type:1,parse:function(e,t){return c(t).map(function(e){return e.filter(b).map(function(e){return e.value}).join(" ")}).map(cn)}},cn=function(e){switch(e){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},hn,An=hn||(hn={}),pn=(An["AUTO"]="auto",An["CONTAIN"]="contain",An["COVER"]="cover",{name:"background-size",initialValue:"0",prefix:false,type:1,parse:function(e,t){return c(t).map(function(e){return e.filter(fn)})}}),fn=function(e){return b(e)||E(e)},dn=function(e){return{name:"border-"+e+"-color",initialValue:"transparent",prefix:false,type:3,format:"color"}},gn=dn("top"),mn=dn("right"),yn=dn("bottom"),_n=dn("left"),vn=function(e){return{name:"border-radius-"+e,initialValue:"0 0",prefix:false,type:1,parse:function(e,t){return fr(t.filter(E))}}},Cn=vn("top-left"),wn=vn("top-right"),xn=vn("bottom-right"),bn=vn("bottom-left"),En=function(e){return{name:"border-"+e+"-style",initialValue:"solid",prefix:false,type:2,parse:function(e,t){switch(t){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},Bn=En("top"),Mn=En("right"),In=En("bottom"),Sn=En("left"),Pn=function(e){return{name:"border-"+e+"-width",initialValue:"0",type:0,prefix:false,parse:function(e,t){if(ar(t))return t.number;return 0}}},Tn=Pn("top"),Ln=Pn("right"),Dn=Pn("bottom"),Fn=Pn("left"),Nn={name:"color",initialValue:"transparent",prefix:false,type:3,format:"color"},On={name:"direction",initialValue:"ltr",prefix:false,type:2,parse:function(e,t){switch(t){case"rtl":return 1;case"ltr":default:return 0}}},Rn={name:"display",initialValue:"inline-block",prefix:false,type:1,parse:function(e,t){return t.filter(b).reduce(function(e,t){return e|Un(t.value)},0)}},Un=function(e){switch(e){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},kn={name:"float",initialValue:"none",prefix:false,type:2,parse:function(e,t){switch(t){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},Hn={name:"letter-spacing",initialValue:"0",prefix:false,type:0,parse:function(e,t){if(t.type===20&&t.value==="normal")return 0;if(t.type===17)return t.number;if(t.type===15)return t.number;return 0}},Qn,Vn=Qn||(Qn={}),Gn=(Vn["NORMAL"]="normal",Vn["STRICT"]="strict",{name:"line-break",initialValue:"normal",prefix:false,type:2,parse:function(e,t){switch(t){case"strict":return Qn.STRICT;case"normal":default:return Qn.NORMAL}}}),zn={name:"line-height",initialValue:"normal",prefix:false,type:4},Wn=function(e,t){if(b(e)&&e.value==="normal")return 1.2*t;else if(e.type===17)return t*e.number;else if(E(e))return O(e,t);return t},qn={name:"list-style-image",initialValue:"none",type:0,prefix:false,parse:function(e,t){if(t.type===20&&t.value==="none")return null;return rn.parse(e,t)}},Kn={name:"list-style-position",initialValue:"outside",prefix:false,type:2,parse:function(e,t){switch(t){case"inside":return 0;case"outside":default:return 1}}},jn={name:"list-style-type",initialValue:"none",prefix:false,type:2,parse:function(e,t){switch(t){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},Zn=function(e){return{name:"margin-"+e,initialValue:"0",prefix:false,type:4}},Yn=Zn("top"),Xn=Zn("right"),Jn=Zn("bottom"),$n=Zn("left"),eo={name:"overflow",initialValue:"visible",prefix:false,type:1,parse:function(e,t){return t.filter(b).map(function(e){switch(e.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},to={name:"overflow-wrap",initialValue:"normal",prefix:false,type:2,parse:function(e,t){switch(t){case"break-word":return"break-word";case"normal":default:return"normal"}}},io=function(e){return{name:"padding-"+e,initialValue:"0",prefix:false,type:3,format:"length-percentage"}},ro=io("top"),no=io("right"),oo=io("bottom"),so=io("left"),ao={name:"text-align",initialValue:"left",prefix:false,type:2,parse:function(e,t){switch(t){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},lo={name:"position",initialValue:"static",prefix:false,type:2,parse:function(e,t){switch(t){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},uo={name:"text-shadow",initialValue:"none",type:1,prefix:false,parse:function(o,e){if(e.length===1&&cr(e[0],"none"))return[];return c(e).map(function(e){var t={color:z.TRANSPARENT,offsetX:B,offsetY:B,blur:B};var i=0;for(var r=0;r<e.length;r++){var n=e[r];if(h(n)){if(i===0)t.offsetX=n;else if(i===1)t.offsetY=n;else t.blur=n;i++}else t.color=br.parse(o,n)}return t})}},co={name:"text-transform",initialValue:"none",prefix:false,type:2,parse:function(e,t){switch(t){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},ho={name:"transform",initialValue:"none",prefix:true,type:0,parse:function(e,t){if(t.type===20&&t.value==="none")return null;if(t.type===18){var i=fo[t.name];if(typeof i==="undefined")throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return i(t.values)}return null}},Ao,po,fo={matrix:function(e){var t=e.filter(function(e){return e.type===17}).map(function(e){return e.number});return t.length===6?t:null},matrix3d:function(e){var t=e.filter(function(e){return e.type===17}).map(function(e){return e.number});var i=t[0],r=t[1];t[2];t[3];var n=t[4],o=t[5];t[6];t[7];t[8];t[9];t[10];t[11];var s=t[12],a=t[13];t[14];t[15];return t.length===16?[i,r,n,o,s,a]:null}},go={type:16,number:50,flags:Bt},mo=[go,go],yo={name:"transform-origin",initialValue:"50% 50%",prefix:true,type:1,parse:function(e,t){var i=t.filter(E);if(i.length!==2)return mo;return[i[0],i[1]]}},_o={name:"visible",initialValue:"none",prefix:false,type:2,parse:function(e,t){switch(t){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},vo,Co=vo||(vo={});Co["NORMAL"]="normal",Co["BREAK_ALL"]="break-all",Co["KEEP_ALL"]="keep-all";for(var wo={name:"word-break",initialValue:"normal",prefix:false,type:2,parse:function(e,t){switch(t){case"break-all":return vo.BREAK_ALL;case"keep-all":return vo.KEEP_ALL;case"normal":default:return vo.NORMAL}}},xo={name:"z-index",initialValue:"auto",prefix:false,type:0,parse:function(e,t){if(t.type===20)return{auto:true,order:0};if(lr(t))return{auto:false,order:t.number};throw new Error("Invalid z-index number parsed")}},bo={name:"time",parse:function(e,t){if(t.type===15)switch(t.unit.toLowerCase()){case"s":return 1e3*t.number;case"ms":return t.number}throw new Error("Unsupported time type")}},Eo={name:"opacity",initialValue:"1",type:0,prefix:false,parse:function(e,t){if(lr(t))return t.number;return 1}},Bo={name:"text-decoration-color",initialValue:"transparent",prefix:false,type:3,format:"color"},Mo={name:"text-decoration-line",initialValue:"none",prefix:false,type:1,parse:function(e,t){return t.filter(b).map(function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(e){return e!==0})}},Io={name:"font-family",initialValue:"",prefix:false,type:1,parse:function(e,t){var i=[];var r=[];t.forEach(function(e){switch(e.type){case 20:case 0:i.push(e.value);break;case 17:i.push(e.number.toString());break;case 4:r.push(i.join(" "));i.length=0;break}});if(i.length)r.push(i.join(" "));return r.map(function(e){return e.indexOf(" ")===-1?e:"'"+e+"'"})}},So={name:"font-size",initialValue:"0",prefix:false,type:3,format:"length"},Po={name:"font-weight",initialValue:"normal",type:0,prefix:false,parse:function(e,t){if(lr(t))return t.number;if(b(t))switch(t.value){case"bold":return 700;case"normal":default:return 400}return 400}},To={name:"font-variant",initialValue:"none",type:1,prefix:false,parse:function(e,t){return t.filter(b).map(function(e){return e.value})}},Lo={name:"font-style",initialValue:"normal",prefix:false,type:2,parse:function(e,t){switch(t){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},S=function(e,t){return(e&t)!==0},Do={name:"content",initialValue:"none",type:1,prefix:false,parse:function(e,t){if(t.length===0)return[];var i=t[0];if(i.type===20&&i.value==="none")return[];return t}},Fo={name:"counter-increment",initialValue:"none",prefix:true,type:1,parse:function(e,t){if(t.length===0)return null;var i=t[0];if(i.type===20&&i.value==="none")return null;var r=[];var n=t.filter(hr);for(var o=0;o<n.length;o++){var s=n[o];var a=n[o+1];if(s.type===20){var l=a&&lr(a)?a.number:1;r.push({counter:s.value,increment:l})}}return r}},No={name:"counter-reset",initialValue:"none",prefix:true,type:1,parse:function(e,t){if(t.length===0)return[];var i=[];var r=t.filter(hr);for(var n=0;n<r.length;n++){var o=r[n];var s=r[n+1];if(b(o)&&o.value!=="none"){var a=s&&lr(s)?s.number:0;i.push({counter:o.value,reset:a})}}return i}},Oo={name:"duration",initialValue:"0s",prefix:false,type:1,parse:function(t,e){return e.filter(ar).map(function(e){return bo.parse(t,e)})}},Ro={name:"quotes",initialValue:"none",prefix:true,type:1,parse:function(e,t){if(t.length===0)return null;var i=t[0];if(i.type===20&&i.value==="none")return null;var r=[];var n=t.filter(ur);if(n.length%2!==0)return null;for(var o=0;o<n.length;o+=2){var s=n[o].value;var a=n[o+1].value;r.push({open:s,close:a})}return r}},Uo=function(e,t,i){if(!e)return"";var r=e[Math.min(t,e.length-1)];if(!r)return"";return i?r.open:r.close},ko={name:"box-shadow",initialValue:"none",type:1,prefix:false,parse:function(o,e){if(e.length===1&&cr(e[0],"none"))return[];return c(e).map(function(e){var t={color:255,offsetX:B,offsetY:B,blur:B,spread:B,inset:false};var i=0;for(var r=0;r<e.length;r++){var n=e[r];if(cr(n,"inset"))t.inset=true;else if(h(n)){if(i===0)t.offsetX=n;else if(i===1)t.offsetY=n;else if(i===2)t.blur=n;else t.spread=n;i++}else t.color=br.parse(o,n)}return t})}},Ho={name:"paint-order",initialValue:"normal",prefix:false,type:1,parse:function(e,t){var i=[0,1,2];var r=[];t.filter(b).forEach(function(e){switch(e.value){case"stroke":r.push(1);break;case"fill":r.push(0);break;case"markers":r.push(2);break}});i.forEach(function(e){if(r.indexOf(e)===-1)r.push(e)});return r}},Qo={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:false,type:3,format:"color"},Vo={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:false,parse:function(e,t){if(ar(t))return t.number;return 0}},Go=function(){function e(e,t){var i,r;this.animationDuration=o(e,Oo,t.animationDuration);this.backgroundClip=o(e,Dr,t.backgroundClip);this.backgroundColor=o(e,Fr,t.backgroundColor);this.backgroundImage=o(e,sn,t.backgroundImage);this.backgroundOrigin=o(e,an,t.backgroundOrigin);this.backgroundPosition=o(e,ln,t.backgroundPosition);this.backgroundRepeat=o(e,un,t.backgroundRepeat);this.backgroundSize=o(e,pn,t.backgroundSize);this.borderTopColor=o(e,gn,t.borderTopColor);this.borderRightColor=o(e,mn,t.borderRightColor);this.borderBottomColor=o(e,yn,t.borderBottomColor);this.borderLeftColor=o(e,_n,t.borderLeftColor);this.borderTopLeftRadius=o(e,Cn,t.borderTopLeftRadius);this.borderTopRightRadius=o(e,wn,t.borderTopRightRadius);this.borderBottomRightRadius=o(e,xn,t.borderBottomRightRadius);this.borderBottomLeftRadius=o(e,bn,t.borderBottomLeftRadius);this.borderTopStyle=o(e,Bn,t.borderTopStyle);this.borderRightStyle=o(e,Mn,t.borderRightStyle);this.borderBottomStyle=o(e,In,t.borderBottomStyle);this.borderLeftStyle=o(e,Sn,t.borderLeftStyle);this.borderTopWidth=o(e,Tn,t.borderTopWidth);this.borderRightWidth=o(e,Ln,t.borderRightWidth);this.borderBottomWidth=o(e,Dn,t.borderBottomWidth);this.borderLeftWidth=o(e,Fn,t.borderLeftWidth);this.boxShadow=o(e,ko,t.boxShadow);this.color=o(e,Nn,t.color);this.direction=o(e,On,t.direction);this.display=o(e,Rn,t.display);this.float=o(e,kn,t.cssFloat);this.fontFamily=o(e,Io,t.fontFamily);this.fontSize=o(e,So,t.fontSize);this.fontStyle=o(e,Lo,t.fontStyle);this.fontVariant=o(e,To,t.fontVariant);this.fontWeight=o(e,Po,t.fontWeight);this.letterSpacing=o(e,Hn,t.letterSpacing);this.lineBreak=o(e,Gn,t.lineBreak);this.lineHeight=o(e,zn,t.lineHeight);this.listStyleImage=o(e,qn,t.listStyleImage);this.listStylePosition=o(e,Kn,t.listStylePosition);this.listStyleType=o(e,jn,t.listStyleType);this.marginTop=o(e,Yn,t.marginTop);this.marginRight=o(e,Xn,t.marginRight);this.marginBottom=o(e,Jn,t.marginBottom);this.marginLeft=o(e,$n,t.marginLeft);this.opacity=o(e,Eo,t.opacity);var n=o(e,eo,t.overflow);this.overflowX=n[0];this.overflowY=n[n.length>1?1:0];this.overflowWrap=o(e,to,t.overflowWrap);this.paddingTop=o(e,ro,t.paddingTop);this.paddingRight=o(e,no,t.paddingRight);this.paddingBottom=o(e,oo,t.paddingBottom);this.paddingLeft=o(e,so,t.paddingLeft);this.paintOrder=o(e,Ho,t.paintOrder);this.position=o(e,lo,t.position);this.textAlign=o(e,ao,t.textAlign);this.textDecorationColor=o(e,Bo,(i=t.textDecorationColor)!==null&&i!==void 0?i:t.color);this.textDecorationLine=o(e,Mo,(r=t.textDecorationLine)!==null&&r!==void 0?r:t.textDecoration);this.textShadow=o(e,uo,t.textShadow);this.textTransform=o(e,co,t.textTransform);this.transform=o(e,ho,t.transform);this.transformOrigin=o(e,yo,t.transformOrigin);this.visibility=o(e,_o,t.visibility);this.webkitTextStrokeColor=o(e,Qo,t.webkitTextStrokeColor);this.webkitTextStrokeWidth=o(e,Vo,t.webkitTextStrokeWidth);this.wordBreak=o(e,wo,t.wordBreak);this.zIndex=o(e,xo,t.zIndex)}e.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0};e.prototype.isTransparent=function(){return Er(this.backgroundColor)};e.prototype.isTransformed=function(){return this.transform!==null};e.prototype.isPositioned=function(){return this.position!==0};e.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto};e.prototype.isFloating=function(){return this.float!==0};e.prototype.isInlineLevel=function(){return S(this.display,4)||S(this.display,33554432)||S(this.display,268435456)||S(this.display,536870912)||S(this.display,67108864)||S(this.display,134217728)};return e}(),zo=function(){function e(e,t){this.content=o(e,Do,t.content);this.quotes=o(e,Ro,t.quotes)}return e}(),Wo=function(){function e(e,t){this.counterIncrement=o(e,Fo,t.counterIncrement);this.counterReset=o(e,No,t.counterReset)}return e}(),o=function(e,t,i){var r=new or;var n=i!==null&&typeof i!=="undefined"?i.toString():t.initialValue;r.write(n);var o=new sr(r.read());switch(t.type){case 2:var s=o.parseComponentValue();return t.parse(e,b(s)?s.value:t.initialValue);case 0:return t.parse(e,o.parseComponentValue());case 1:return t.parse(e,o.parseComponentValues());case 4:return o.parseComponentValue();case 3:switch(t.format){case"angle":return Cr.parse(e,o.parseComponentValue());case"color":return br.parse(e,o.parseComponentValue());case"image":return rn.parse(e,o.parseComponentValue());case"length":var a=o.parseComponentValue();return h(a)?a:B;case"length-percentage":var l=o.parseComponentValue();return E(l)?l:B;case"time":return bo.parse(e,o.parseComponentValue())}break}},qo="data-html2canvas-debug",Ko=function(e){var t=e.getAttribute(qo);switch(t){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},jo=function(e,t){var i=Ko(e);return i===1||t===i},i=function(){function e(e,t){this.context=e;this.textNodes=[];this.elements=[];this.flags=0;if(jo(t,3))debugger;this.styles=new Go(e,window.getComputedStyle(t,null));if(ka(t)){if(this.styles.animationDuration.some(function(e){return e>0}))t.style.animationDuration="0s";if(this.styles.transform!==null)t.style.transform="none"}this.bounds=q(this.context,t);if(jo(t,4))this.flags|=16}return e}(),Zo="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",Yo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Xo=typeof Uint8Array==="undefined"?[]:new Uint8Array(256),Jo=0;Jo<Yo.length;Jo++)Xo[Yo.charCodeAt(Jo)]=Jo;for(var $o=function(e){var t=e.length*.75,i=e.length,r,n=0,o,s,a,l;if(e[e.length-1]==="="){t--;if(e[e.length-2]==="=")t--}var u=typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined"&&typeof Uint8Array.prototype.slice!=="undefined"?new ArrayBuffer(t):new Array(t);var c=Array.isArray(u)?u:new Uint8Array(u);for(r=0;r<i;r+=4){o=Xo[e.charCodeAt(r)];s=Xo[e.charCodeAt(r+1)];a=Xo[e.charCodeAt(r+2)];l=Xo[e.charCodeAt(r+3)];c[n++]=o<<2|s>>4;c[n++]=(s&15)<<4|a>>2;c[n++]=(a&3)<<6|l&63}return u},es=function(e){var t=e.length;var i=[];for(var r=0;r<t;r+=2)i.push(e[r+1]<<8|e[r]);return i},ts=function(e){var t=e.length;var i=[];for(var r=0;r<t;r+=4)i.push(e[r+3]<<24|e[r+2]<<16|e[r+1]<<8|e[r]);return i},is=5,rs=6+5,ns=2,os,ss=65536>>is,as,ls=(1<<is)-1,us,cs,hs,As,ps=ss+(1024>>is)+(2048>>6),fs=65536>>rs,ds,gs=(1<<rs-is)-1,ms=function(e,t,i){if(e.slice)return e.slice(t,i);return new Uint16Array(Array.prototype.slice.call(e,t,i))},ys=function(e,t,i){if(e.slice)return e.slice(t,i);return new Uint32Array(Array.prototype.slice.call(e,t,i))},_s=function(e,t){var i=$o(e);var r=Array.isArray(i)?ts(i):new Uint32Array(i);var n=Array.isArray(i)?es(i):new Uint16Array(i);var o=24;var s=ms(n,o/2,r[4]/2);var a=r[5]===2?ms(n,(o+r[4])/2):ys(r,Math.ceil((o+r[4])/4));return new vs(r[0],r[1],r[2],r[3],s,a)},vs=function(){function e(e,t,i,r,n,o){this.initialValue=e;this.errorValue=t;this.highStart=i;this.highValueIndex=r;this.index=n;this.data=o}e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535){t=this.index[e>>is];t=(t<<ns)+(e&ls);return this.data[t]}if(e<=65535){t=this.index[ss+(e-55296>>is)];t=(t<<ns)+(e&ls);return this.data[t]}if(e<this.highStart){t=ps-fs+(e>>rs);t=this.index[t];t+=e>>is&gs;t=this.index[t];t=(t<<ns)+(e&ls);return this.data[t]}if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue};return e}(),Cs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ws=typeof Uint8Array==="undefined"?[]:new Uint8Array(256),xs=0;xs<Cs.length;xs++)ws[Cs.charCodeAt(xs)]=xs;var bs=1,Es=2,Bs=3,Ms=4,Is=5,Ss=7,Ps=8,Ts=9,Ls=10,Ds=11,Fs=12,Ns=13,Os=14,Rs=15,Us=function(e){var t=[];var i=0;var r=e.length;while(i<r){var n=e.charCodeAt(i++);if(n>=55296&&n<=56319&&i<r){var o=e.charCodeAt(i++);if((o&64512)===56320)t.push(((n&1023)<<10)+(o&1023)+65536);else{t.push(n);i--}}else t.push(n)}return t},ks=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var i=e.length;if(!i)return"";var r=[];var n=-1;var o="";while(++n<i){var s=e[n];if(s<=65535)r.push(s);else{s-=65536;r.push((s>>10)+55296,s%1024+56320)}if(n+1===i||r.length>16384){o+=String.fromCharCode.apply(String,r);r.length=0}}return o},Hs=_s(Zo),l="×",Qs="÷",Vs=function(e){return Hs.get(e)},Gs=function(e,t,i){var r=i-2;var n=t[r];var o=t[i-1];var s=t[i];if(o===Es&&s===Bs)return l;if(o===Es||o===Bs||o===Ms)return Qs;if(s===Es||s===Bs||s===Ms)return Qs;if(o===Ps&&[Ps,Ts,Ds,Fs].indexOf(s)!==-1)return l;if((o===Ds||o===Ts)&&(s===Ts||s===Ls))return l;if((o===Fs||o===Ls)&&s===Ls)return l;if(s===Ns||s===Is)return l;if(s===Ss)return l;if(o===bs)return l;if(o===Ns&&s===Os){while(n===Is)n=t[--r];if(n===Os)return l}if(o===Rs&&s===Rs){var a=0;while(n===Rs){a++;n=t[--r]}if(a%2===0)return l}return Qs},zs=function(e){var i=Us(e);var r=i.length;var n=0;var o=0;var s=i.map(Vs);return{next:function(){if(n>=r)return{done:true,value:null};var e=l;while(n<r&&(e=Gs(i,s,++n))===l);if(e!==l||n===r){var t=ks.apply(null,i.slice(o,n));o=n;return{value:t,done:false}}return{done:true,value:null}}}},Ws=function(e){var t=zs(e);var i=[];var r;while(!(r=t.next()).done)if(r.value)i.push(r.value.slice());return i},qs=function(e){var t=123;if(e.createRange){var i=e.createRange();if(i.getBoundingClientRect){var r=e.createElement("boundtest");r.style.height=t+"px";r.style.display="block";e.body.appendChild(r);i.selectNode(r);var n=i.getBoundingClientRect();var o=Math.round(n.height);e.body.removeChild(r);if(o===t)return true}}return false},Ks=function(e){var t=e.createElement("boundtest");t.style.width="50px";t.style.display="block";t.style.fontSize="12px";t.style.letterSpacing="0px";t.style.wordSpacing="0px";e.body.appendChild(t);var n=e.createRange();t.innerHTML=typeof"".repeat==="function"?"&#128104;".repeat(10):"";var o=t.firstChild;var i=N(o.data).map(function(e){return d(e)});var s=0;var a={};var r=i.every(function(e,t){n.setStart(o,s);n.setEnd(o,s+e.length);var i=n.getBoundingClientRect();s+=e.length;var r=i.x>a.x||i.y>a.y;a=i;if(t===0)return true;return r});e.body.removeChild(t);return r},js=function(){return typeof(new Image).crossOrigin!=="undefined"},Zs=function(){return typeof(new XMLHttpRequest).responseType==="string"},Ys=function(e){var t=new Image;var i=e.createElement("canvas");var r=i.getContext("2d");if(!r)return false;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(t,0,0);i.toDataURL()}catch(e){return false}return true},Xs=function(e){return e[0]===0&&e[1]===255&&e[2]===0&&e[3]===255},Js=function(r){var e=r.createElement("canvas");var n=100;e.width=n;e.height=n;var o=e.getContext("2d");if(!o)return Promise.reject(false);o.fillStyle="rgb(0, 255, 0)";o.fillRect(0,0,n,n);var t=new Image;var s=e.toDataURL();t.src=s;var i=$s(n,n,0,0,t);o.fillStyle="red";o.fillRect(0,0,n,n);return ea(i).then(function(e){o.drawImage(e,0,0);var t=o.getImageData(0,0,n,n).data;o.fillStyle="red";o.fillRect(0,0,n,n);var i=r.createElement("div");i.style.backgroundImage="url("+s+")";i.style.height=n+"px";return Xs(t)?ea($s(n,n,0,0,i)):Promise.reject(false)}).then(function(e){o.drawImage(e,0,0);return Xs(o.getImageData(0,0,n,n).data)}).catch(function(){return false})},$s=function(e,t,i,r,n){var o="http://www.w3.org/2000/svg";var s=document.createElementNS(o,"svg");var a=document.createElementNS(o,"foreignObject");s.setAttributeNS(null,"width",e.toString());s.setAttributeNS(null,"height",t.toString());a.setAttributeNS(null,"width","100%");a.setAttributeNS(null,"height","100%");a.setAttributeNS(null,"x",i.toString());a.setAttributeNS(null,"y",r.toString());a.setAttributeNS(null,"externalResourcesRequired","true");s.appendChild(a);a.appendChild(n);return s},ea=function(r){return new Promise(function(e,t){var i=new Image;i.onload=function(){return e(i)};i.onerror=t;i.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(r))})},p={get SUPPORT_RANGE_BOUNDS(){var e=qs(document);Object.defineProperty(p,"SUPPORT_RANGE_BOUNDS",{value:e});return e},get SUPPORT_WORD_BREAKING(){var e=p.SUPPORT_RANGE_BOUNDS&&Ks(document);Object.defineProperty(p,"SUPPORT_WORD_BREAKING",{value:e});return e},get SUPPORT_SVG_DRAWING(){var e=Ys(document);Object.defineProperty(p,"SUPPORT_SVG_DRAWING",{value:e});return e},get SUPPORT_FOREIGNOBJECT_DRAWING(){var e=typeof Array.from==="function"&&typeof window.fetch==="function"?Js(document):Promise.resolve(false);Object.defineProperty(p,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:e});return e},get SUPPORT_CORS_IMAGES(){var e=js();Object.defineProperty(p,"SUPPORT_CORS_IMAGES",{value:e});return e},get SUPPORT_RESPONSE_TYPE(){var e=Zs();Object.defineProperty(p,"SUPPORT_RESPONSE_TYPE",{value:e});return e},get SUPPORT_CORS_XHR(){var e="withCredentials"in new XMLHttpRequest;Object.defineProperty(p,"SUPPORT_CORS_XHR",{value:e});return e},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var e=!!(typeof Intl!=="undefined"&&Intl.Segmenter);Object.defineProperty(p,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:e});return e}},ta=function(){function e(e,t){this.text=e;this.bounds=t}return e}(),ia=function(o,e,s,a){var t=aa(e,s);var l=[];var u=0;t.forEach(function(e){if(s.textDecorationLine.length||e.trim().length>0)if(p.SUPPORT_RANGE_BOUNDS){var t=na(a,u,e.length).getClientRects();if(t.length>1){var i=oa(e);var r=0;i.forEach(function(e){l.push(new ta(e,G.fromDOMRectList(o,na(a,r+u,e.length).getClientRects())));r+=e.length})}else l.push(new ta(e,G.fromDOMRectList(o,t)))}else{var n=a.splitText(e.length);l.push(new ta(e,ra(o,a)));a=n}else if(!p.SUPPORT_RANGE_BOUNDS)a=a.splitText(e.length);u+=e.length});return l},ra=function(e,t){var i=t.ownerDocument;if(i){var r=i.createElement("html2canvaswrapper");r.appendChild(t.cloneNode(true));var n=t.parentNode;if(n){n.replaceChild(r,t);var o=q(e,r);if(r.firstChild)n.replaceChild(r.firstChild,r);return o}}return G.EMPTY},na=function(e,t,i){var r=e.ownerDocument;if(!r)throw new Error("Node has no owner document");var n=r.createRange();n.setStart(e,t);n.setEnd(e,t+i);return n},oa=function(e){if(p.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(t.segment(e)).map(function(e){return e.segment})}return Ws(e)},sa=function(e,t){if(p.SUPPORT_NATIVE_TEXT_SEGMENTATION){var i=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(i.segment(e)).map(function(e){return e.segment})}return ua(e,t)},aa=function(e,t){return t.letterSpacing!==0?oa(e):sa(e,t)},la=[32,160,4961,65792,65793,4153,4241],ua=function(e,t){var i=xt(e,{lineBreak:t.lineBreak,wordBreak:t.overflowWrap==="break-word"?"break-word":t.wordBreak});var r=[];var n;var o=function(){if(n.value){var e=n.value.slice();var t=N(e);var i="";t.forEach(function(e){if(la.indexOf(e)===-1)i+=d(e);else{if(i.length)r.push(i);r.push(d(e));i=""}});if(i.length)r.push(i)}};while(!(n=i.next()).done)o();return r},ca=function(){function e(e,t,i){this.text=ha(t.data,i.textTransform);this.textBounds=ia(e,this.text,i,t)}return e}(),ha=function(e,t){switch(t){case 1:return e.toLowerCase();case 3:return e.replace(Aa,pa);case 2:return e.toUpperCase();default:return e}},Aa=/(^|\s|:|-|\(|\))([a-z])/g,pa=function(e,t,i){if(e.length>0)return t+i.toUpperCase();return e},fa=function(r){t(e,r);function e(e,t){var i=r.call(this,e,t)||this;i.src=t.currentSrc||t.src;i.intrinsicWidth=t.naturalWidth;i.intrinsicHeight=t.naturalHeight;i.context.cache.addImage(i.src);return i}return e}(i),da=function(r){t(e,r);function e(e,t){var i=r.call(this,e,t)||this;i.canvas=t;i.intrinsicWidth=t.width;i.intrinsicHeight=t.height;return i}return e}(i),ga=function(o){t(e,o);function e(e,t){var i=o.call(this,e,t)||this;var r=new XMLSerializer;var n=q(e,t);t.setAttribute("width",n.width+"px");t.setAttribute("height",n.height+"px");i.svg="data:image/svg+xml,"+encodeURIComponent(r.serializeToString(t));i.intrinsicWidth=t.width.baseVal.value;i.intrinsicHeight=t.height.baseVal.value;i.context.cache.addImage(i.svg);return i}return e}(i),ma=function(r){t(e,r);function e(e,t){var i=r.call(this,e,t)||this;i.value=t.value;return i}return e}(i),ya=function(r){t(e,r);function e(e,t){var i=r.call(this,e,t)||this;i.start=t.start;i.reversed=typeof t.reversed==="boolean"&&t.reversed===true;return i}return e}(i),_a=[{type:15,flags:0,unit:"px",number:3}],va=[{type:16,flags:0,number:50}],Ca=function(e){if(e.width>e.height)return new G(e.left+(e.width-e.height)/2,e.top,e.height,e.height);else if(e.width<e.height)return new G(e.left,e.top+(e.height-e.width)/2,e.width,e.width);return e},wa=function(e){var t=e.type===Ea?new Array(e.value.length+1).join("•"):e.value;return t.length===0?e.placeholder||"":t},xa="checkbox",ba="radio",Ea="password",Ba=707406591,Ma=function(r){t(e,r);function e(e,t){var i=r.call(this,e,t)||this;i.type=t.type.toLowerCase();i.checked=t.checked;i.value=wa(t);if(i.type===xa||i.type===ba){i.styles.backgroundColor=3739148031;i.styles.borderTopColor=i.styles.borderRightColor=i.styles.borderBottomColor=i.styles.borderLeftColor=2779096575;i.styles.borderTopWidth=i.styles.borderRightWidth=i.styles.borderBottomWidth=i.styles.borderLeftWidth=1;i.styles.borderTopStyle=i.styles.borderRightStyle=i.styles.borderBottomStyle=i.styles.borderLeftStyle=1;i.styles.backgroundClip=[0];i.styles.backgroundOrigin=[0];i.bounds=Ca(i.bounds)}switch(i.type){case xa:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=_a;break;case ba:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=va;break}return i}return e}(i),Ia=function(n){t(e,n);function e(e,t){var i=n.call(this,e,t)||this;var r=t.options[t.selectedIndex||0];i.value=r?r.text||"":"";return i}return e}(i),Sa=function(r){t(e,r);function e(e,t){var i=r.call(this,e,t)||this;i.value=t.value;return i}return e}(i),Pa=function(o){t(e,o);function e(e,t){var i=o.call(this,e,t)||this;i.src=t.src;i.width=parseInt(t.width,10)||0;i.height=parseInt(t.height,10)||0;i.backgroundColor=i.styles.backgroundColor;try{if(t.contentWindow&&t.contentWindow.document&&t.contentWindow.document.documentElement){i.tree=Fa(e,t.contentWindow.document.documentElement);var r=t.contentWindow.document.documentElement?Lr(e,getComputedStyle(t.contentWindow.document.documentElement).backgroundColor):z.TRANSPARENT;var n=t.contentWindow.document.body?Lr(e,getComputedStyle(t.contentWindow.document.body).backgroundColor):z.TRANSPARENT;i.backgroundColor=Er(r)?Er(n)?i.styles.backgroundColor:n:r}}catch(e){}return i}return e}(i),Ta=["OL","UL","MENU"],La=function(t,e,i,r){for(var n=e.firstChild,o=void 0;n;n=o){o=n.nextSibling;if(Ra(n)&&n.data.trim().length>0)i.textNodes.push(new ca(t,n,i.styles));else if(Ua(n))if(tl(n)&&n.assignedNodes)n.assignedNodes().forEach(function(e){return La(t,e,i,r)});else{var s=Da(t,n);if(s.styles.isVisible()){if(Na(n,s,r))s.flags|=4;else if(Oa(s.styles))s.flags|=2;if(Ta.indexOf(n.tagName)!==-1)s.flags|=8;i.elements.push(s);n.slot;if(n.shadowRoot)La(t,n.shadowRoot,s,r);else if(!$a(n)&&!Wa(n)&&!el(n))La(t,n,s,r)}}}},Da=function(e,t){if(Za(t))return new fa(e,t);if(Ka(t))return new da(e,t);if(Wa(t))return new ga(e,t);if(Qa(t))return new ma(e,t);if(Va(t))return new ya(e,t);if(Ga(t))return new Ma(e,t);if(el(t))return new Ia(e,t);if($a(t))return new Sa(e,t);if(Ya(t))return new Pa(e,t);return new i(e,t)},Fa=function(e,t){var i=Da(e,t);i.flags|=4;La(e,t,i,i);return i},Na=function(e,t,i){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||qa(e)&&i.styles.isTransparent()},Oa=function(e){return e.isPositioned()||e.isFloating()},Ra=function(e){return e.nodeType===Node.TEXT_NODE},Ua=function(e){return e.nodeType===Node.ELEMENT_NODE},ka=function(e){return Ua(e)&&typeof e.style!=="undefined"&&!Ha(e)},Ha=function(e){return typeof e.className==="object"},Qa=function(e){return e.tagName==="LI"},Va=function(e){return e.tagName==="OL"},Ga=function(e){return e.tagName==="INPUT"},za=function(e){return e.tagName==="HTML"},Wa=function(e){return e.tagName==="svg"},qa=function(e){return e.tagName==="BODY"},Ka=function(e){return e.tagName==="CANVAS"},ja=function(e){return e.tagName==="VIDEO"},Za=function(e){return e.tagName==="IMG"},Ya=function(e){return e.tagName==="IFRAME"},Xa=function(e){return e.tagName==="STYLE"},Ja=function(e){return e.tagName==="SCRIPT"},$a=function(e){return e.tagName==="TEXTAREA"},el=function(e){return e.tagName==="SELECT"},tl=function(e){return e.tagName==="SLOT"},il=function(e){return e.tagName.indexOf("-")>0},rl=function(){function e(){this.counters={}}e.prototype.getCounterValue=function(e){var t=this.counters[e];if(t&&t.length)return t[t.length-1];return 1};e.prototype.getCounterValues=function(e){var t=this.counters[e];return t?t:[]};e.prototype.pop=function(e){var t=this;e.forEach(function(e){return t.counters[e].pop()})};e.prototype.parse=function(e){var i=this;var t=e.counterIncrement;var r=e.counterReset;var n=true;if(t!==null)t.forEach(function(e){var t=i.counters[e.counter];if(t&&e.increment!==0){n=false;if(!t.length)t.push(1);t[Math.max(0,t.length-1)]+=e.increment}});var o=[];if(n)r.forEach(function(e){var t=i.counters[e.counter];o.push(e.counter);if(!t)t=i.counters[e.counter]=[];t.push(e.reset)});return o};return e}(),nl={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},ol={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["Ք","Փ","Ւ","Ց","Ր","Տ","Վ","Ս","Ռ","Ջ","Պ","Չ","Ո","Շ","Ն","Յ","Մ","Ճ","Ղ","Ձ","Հ","Կ","Ծ","Խ","Լ","Ի","Ժ","Թ","Ը","Է","Զ","Ե","Դ","Գ","Բ","Ա"]},sl={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["י׳","ט׳","ח׳","ז׳","ו׳","ה׳","ד׳","ג׳","ב׳","א׳","ת","ש","ר","ק","צ","פ","ע","ס","נ","מ","ל","כ","יט","יח","יז","טז","טו","י","ט","ח","ז","ו","ה","ד","ג","ב","א"]},al={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["ჵ","ჰ","ჯ","ჴ","ხ","ჭ","წ","ძ","ც","ჩ","შ","ყ","ღ","ქ","ფ","ჳ","ტ","ს","რ","ჟ","პ","ო","ჲ","ნ","მ","ლ","კ","ი","თ","ჱ","ზ","ვ","ე","დ","გ","ბ","ა"]},ll=function(r,e,t,n,i,o){if(r<e||r>t)return _l(r,i,o.length>0);return n.integers.reduce(function(e,t,i){while(r>=t){r-=t;e+=n.values[i]}return e},"")+o},ul=function(e,t,i,r){var n="";do{if(!i)e--;n=r(e)+n;e/=t}while(e*t>=t);return n},f=function(e,t,i,r,n){var o=i-t+1;return(e<0?"-":"")+(ul(Math.abs(e),o,r,function(e){return d(Math.floor(e%o)+t)})+n)},cl=function(e,t,i){if(i===void 0)i=". ";var r=t.length;return ul(Math.abs(e),r,false,function(e){return t[Math.floor(e%r)]})+i},hl=1<<0,Al=1<<1,pl=1<<2,fl=1<<3,P=function(e,t,i,r,n,o){if(e<-9999||e>9999)return _l(e,4,n.length>0);var s=Math.abs(e);var a=n;if(s===0)return t[0]+a;for(var l=0;s>0&&l<=4;l++){var u=s%10;if(u===0&&S(o,hl)&&a!=="")a=t[u]+a;else if(u>1||u===1&&l===0||u===1&&l===1&&S(o,Al)||u===1&&l===1&&S(o,pl)&&e>100||u===1&&l>1&&S(o,fl))a=t[u]+(l>0?i[l-1]:"")+a;else if(u===1&&l>0)a=i[l-1]+a;s=Math.floor(s/10)}return(e<0?r:"")+a},dl="十百千萬",gl="拾佰仟萬",ml="マイナス",yl="마이너스",_l=function(e,t,i){var r=i?". ":"";var n=i?"、":"";var o=i?", ":"";var s=i?" ":"";switch(t){case 0:return"•"+s;case 1:return"◦"+s;case 2:return"◾"+s;case 5:var a=f(e,48,57,true,r);return a.length<4?"0"+a:a;case 4:return cl(e,"〇一二三四五六七八九",n);case 6:return ll(e,1,3999,nl,3,r).toLowerCase();case 7:return ll(e,1,3999,nl,3,r);case 8:return f(e,945,969,false,r);case 9:return f(e,97,122,false,r);case 10:return f(e,65,90,false,r);case 11:return f(e,1632,1641,true,r);case 12:case 49:return ll(e,1,9999,ol,3,r);case 35:return ll(e,1,9999,ol,3,r).toLowerCase();case 13:return f(e,2534,2543,true,r);case 14:case 30:return f(e,6112,6121,true,r);case 15:return cl(e,"子丑寅卯辰巳午未申酉戌亥",n);case 16:return cl(e,"甲乙丙丁戊己庚辛壬癸",n);case 17:case 48:return P(e,"零一二三四五六七八九",dl,"負",n,Al|pl|fl);case 47:return P(e,"零壹貳參肆伍陸柒捌玖",gl,"負",n,hl|Al|pl|fl);case 42:return P(e,"零一二三四五六七八九",dl,"负",n,Al|pl|fl);case 41:return P(e,"零壹贰叁肆伍陆柒捌玖",gl,"负",n,hl|Al|pl|fl);case 26:return P(e,"〇一二三四五六七八九","十百千万",ml,n,0);case 25:return P(e,"零壱弐参四伍六七八九","拾百千万",ml,n,hl|Al|pl);case 31:return P(e,"영일이삼사오육칠팔구","십백천만",yl,o,hl|Al|pl);case 33:return P(e,"零一二三四五六七八九","十百千萬",yl,o,0);case 32:return P(e,"零壹貳參四五六七八九","拾百千",yl,o,hl|Al|pl);case 18:return f(e,2406,2415,true,r);case 20:return ll(e,1,19999,al,3,r);case 21:return f(e,2790,2799,true,r);case 22:return f(e,2662,2671,true,r);case 22:return ll(e,1,10999,sl,3,r);case 23:return cl(e,"あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわゐゑをん");case 24:return cl(e,"いろはにほへとちりぬるをわかよたれそつねならむうゐのおくやまけふこえてあさきゆめみしゑひもせす");case 27:return f(e,3302,3311,true,r);case 28:return cl(e,"アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヰヱヲン",n);case 29:return cl(e,"イロハニホヘトチリヌルヲワカヨタレソツネナラムウヰノオクヤマケフコエテアサキユメミシヱヒモセス",n);case 34:return f(e,3792,3801,true,r);case 37:return f(e,6160,6169,true,r);case 38:return f(e,4160,4169,true,r);case 39:return f(e,2918,2927,true,r);case 40:return f(e,1776,1785,true,r);case 43:return f(e,3046,3055,true,r);case 44:return f(e,3174,3183,true,r);case 45:return f(e,3664,3673,true,r);case 46:return f(e,3872,3881,true,r);case 3:default:return f(e,48,57,true,r)}},vl="data-html2canvas-ignore",Cl=function(){function e(e,t,i){this.context=e;this.options=i;this.scrolledElements=[];this.referenceElement=t;this.counters=new rl;this.quoteDepth=0;if(!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement,false)}e.prototype.toIFrame=function(e,r){var t=this;var n=bl(e,r);if(!n.contentWindow)return Promise.reject("Unable to find iframe window");var i=e.defaultView.pageXOffset;var o=e.defaultView.pageYOffset;var s=n.contentWindow;var a=s.document;var l=Ml(n).then(function(){return u(t,void 0,void 0,function(){var t,i;return V(this,function(e){switch(e.label){case 0:this.scrolledElements.forEach(Ll);if(s){s.scrollTo(r.left,r.top);if(/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(s.scrollY!==r.top||s.scrollX!==r.left)){this.context.logger.warn("Unable to restore scroll position for cloned document");this.context.windowBounds=this.context.windowBounds.add(s.scrollX-r.left,s.scrollY-r.top,0,0)}}t=this.options.onclone;i=this.clonedReferenceElement;if(typeof i==="undefined")return[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")];if(!(a.fonts&&a.fonts.ready))return[3,2];return[4,a.fonts.ready];case 1:e.sent();e.label=2;case 2:if(!/(AppleWebKit)/g.test(navigator.userAgent))return[3,4];return[4,Bl(a)];case 3:e.sent();e.label=4;case 4:if(typeof t==="function")return[2,Promise.resolve().then(function(){return t(a,i)}).then(function(){return n})];return[2,n]}})})});a.open();a.write(Pl(document.doctype)+"<html></html>");Tl(this.referenceElement.ownerDocument,i,o);a.replaceChild(a.adoptNode(this.documentElement),a.documentElement);a.close();return l};e.prototype.createElementClone=function(e){if(jo(e,2))debugger;if(Ka(e))return this.createCanvasClone(e);if(ja(e))return this.createVideoClone(e);if(Xa(e))return this.createStyleClone(e);var t=e.cloneNode(false);if(Za(t)){if(Za(e)&&e.currentSrc&&e.currentSrc!==e.src){t.src=e.currentSrc;t.srcset=""}if(t.loading==="lazy")t.loading="eager"}if(il(t))return this.createCustomElementClone(t);return t};e.prototype.createCustomElementClone=function(e){var t=document.createElement("html2canvascustomelement");Sl(e.style,t);return t};e.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var i=[].slice.call(t.cssRules,0).reduce(function(e,t){if(t&&typeof t.cssText==="string")return e+t.cssText;return e},"");var r=e.cloneNode(false);r.textContent=i;return r}}catch(e){this.context.logger.error("Unable to access cssRules property",e);if(e.name!=="SecurityError")throw e}return e.cloneNode(false)};e.prototype.createCanvasClone=function(t){var e;if(this.options.inlineImages&&t.ownerDocument){var i=t.ownerDocument.createElement("img");try{i.src=t.toDataURL();return i}catch(e){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",t)}}var r=t.cloneNode(false);try{r.width=t.width;r.height=t.height;var n=t.getContext("2d");var o=r.getContext("2d");if(o)if(!this.options.allowTaint&&n)o.putImageData(n.getImageData(0,0,t.width,t.height),0,0);else{var s=(e=t.getContext("webgl2"))!==null&&e!==void 0?e:t.getContext("webgl");if(s){var a=s.getContextAttributes();if((a===null||a===void 0?void 0:a.preserveDrawingBuffer)===false)this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",t)}o.drawImage(t,0,0)}return r}catch(e){this.context.logger.info("Unable to clone canvas as it is tainted",t)}return r};e.prototype.createVideoClone=function(t){var e=t.ownerDocument.createElement("canvas");e.width=t.offsetWidth;e.height=t.offsetHeight;var i=e.getContext("2d");try{if(i){i.drawImage(t,0,0,e.width,e.height);if(!this.options.allowTaint)i.getImageData(0,0,e.width,e.height)}return e}catch(e){this.context.logger.info("Unable to clone video as it is tainted",t)}var r=t.ownerDocument.createElement("canvas");r.width=t.offsetWidth;r.height=t.offsetHeight;return r};e.prototype.appendChildNode=function(e,t,i){if(!Ua(t)||!Ja(t)&&!t.hasAttribute(vl)&&(typeof this.options.ignoreElements!=="function"||!this.options.ignoreElements(t)))if(!this.options.copyStyles||!Ua(t)||!Xa(t))e.appendChild(this.cloneNode(t,i))};e.prototype.cloneChildNodes=function(e,t,i){var r=this;for(var n=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;n;n=n.nextSibling)if(Ua(n)&&tl(n)&&typeof n.assignedNodes==="function"){var o=n.assignedNodes();if(o.length)o.forEach(function(e){return r.appendChildNode(t,e,i)})}else this.appendChildNode(t,n,i)};e.prototype.cloneNode=function(e,t){if(Ra(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(false);var i=e.ownerDocument.defaultView;if(i&&Ua(e)&&(ka(e)||Ha(e))){var r=this.createElementClone(e);r.style.transitionProperty="none";var n=i.getComputedStyle(e);var o=i.getComputedStyle(e,":before");var s=i.getComputedStyle(e,":after");if(this.referenceElement===e&&ka(r))this.clonedReferenceElement=r;if(qa(r))Ul(r);var a=this.counters.parse(new Wo(this.context,n));var l=this.resolvePseudoContent(e,r,o,wl.BEFORE);if(il(e))t=true;if(!ja(e))this.cloneChildNodes(e,r,t);if(l)r.insertBefore(l,r.firstChild);var u=this.resolvePseudoContent(e,r,s,wl.AFTER);if(u)r.appendChild(u);this.counters.pop(a);if(n&&(this.options.copyStyles||Ha(e))&&!Ya(e)||t)Sl(n,r);if(e.scrollTop!==0||e.scrollLeft!==0)this.scrolledElements.push([r,e.scrollLeft,e.scrollTop]);if(($a(e)||el(e))&&($a(r)||el(r)))r.value=e.value;return r}return e.cloneNode(false)};e.prototype.resolvePseudoContent=function(f,e,t,i){var d=this;if(!t)return;var r=t.content;var g=e.ownerDocument;if(!g||!r||r==="none"||r==="-moz-alt-content"||t.display==="none")return;this.counters.parse(new Wo(this.context,t));var m=new zo(this.context,t);var y=g.createElement("html2canvaspseudoelement");Sl(t,y);m.content.forEach(function(e){if(e.type===0)y.appendChild(g.createTextNode(e.value));else if(e.type===22){var t=g.createElement("img");t.src=e.value;t.style.opacity="1";y.appendChild(t)}else if(e.type===18)if(e.name==="attr"){var i=e.values.filter(b);if(i.length)y.appendChild(g.createTextNode(f.getAttribute(i[0].value)||""))}else if(e.name==="counter"){var r=e.values.filter(Ar),n=r[0],o=r[1];if(n&&b(n)){var s=d.counters.getCounterValue(n.value);var a=o&&b(o)?jn.parse(d.context,o.value):3;y.appendChild(g.createTextNode(_l(s,a,false)))}}else if(e.name==="counters"){var l=e.values.filter(Ar),n=l[0],u=l[1],o=l[2];if(n&&b(n)){var c=d.counters.getCounterValues(n.value);var h=o&&b(o)?jn.parse(d.context,o.value):3;var A=u&&u.type===0?u.value:"";var p=c.map(function(e){return _l(e,h,false)}).join(A);y.appendChild(g.createTextNode(p))}}else;else if(e.type===20)switch(e.value){case"open-quote":y.appendChild(g.createTextNode(Uo(m.quotes,d.quoteDepth++,true)));break;case"close-quote":y.appendChild(g.createTextNode(Uo(m.quotes,--d.quoteDepth,false)));break;default:y.appendChild(g.createTextNode(e.value))}});y.className=Nl+" "+Ol;var n=i===wl.BEFORE?" "+Nl:" "+Ol;if(Ha(e))e.className.baseValue+=n;else e.className+=n;return y};e.destroy=function(e){if(e.parentNode){e.parentNode.removeChild(e);return true}return false};return e}(),wl,xl=wl||(wl={}),bl=(xl[xl["BEFORE"]=0]="BEFORE",xl[xl["AFTER"]=1]="AFTER",function(e,t){var i=e.createElement("iframe");i.className="html2canvas-container";i.style.visibility="hidden";i.style.position="fixed";i.style.left="-10000px";i.style.top="0px";i.style.border="0";i.width=t.width.toString();i.height=t.height.toString();i.scrolling="no";i.setAttribute(vl,"true");e.body.appendChild(i);return i}),El=function(t){return new Promise(function(e){if(t.complete){e();return}if(!t.src){e();return}t.onload=e;t.onerror=e})},Bl=function(e){return Promise.all([].slice.call(e.images,0).map(El))},Ml=function(n){return new Promise(function(t,e){var i=n.contentWindow;if(!i)return e("No window assigned for iframe");var r=i.document;i.onload=n.onload=function(){i.onload=n.onload=null;var e=setInterval(function(){if(r.body.childNodes.length>0&&r.readyState==="complete"){clearInterval(e);t(n)}},50)}})},Il=["all","d","content"],Sl=function(e,t){for(var i=e.length-1;i>=0;i--){var r=e.item(i);if(Il.indexOf(r)===-1)t.style.setProperty(r,e.getPropertyValue(r))}return t},Pl=function(e){var t="";if(e){t+="<!DOCTYPE ";if(e.name)t+=e.name;if(e.internalSubset)t+=e.internalSubset;if(e.publicId)t+='"'+e.publicId+'"';if(e.systemId)t+='"'+e.systemId+'"';t+=">"}return t},Tl=function(e,t,i){if(e&&e.defaultView&&(t!==e.defaultView.pageXOffset||i!==e.defaultView.pageYOffset))e.defaultView.scrollTo(t,i)},Ll=function(e){var t=e[0],i=e[1],r=e[2];t.scrollLeft=i;t.scrollTop=r},Dl=":before",Fl=":after",Nl="___html2canvas___pseudoelement_before",Ol="___html2canvas___pseudoelement_after",Rl='{\n    content: "" !important;\n    display: none !important;\n}',Ul=function(e){kl(e,"."+Nl+Dl+Rl+"\n         ."+Ol+Fl+Rl)},kl=function(e,t){var i=e.ownerDocument;if(i){var r=i.createElement("style");r.textContent=t;e.appendChild(r)}},Hl=function(){function i(){}i.getOrigin=function(e){var t=i._link;if(!t)return"about:blank";t.href=e;t.href=t.href;return t.protocol+t.hostname+t.port};i.isSameOrigin=function(e){return i.getOrigin(e)===i._origin};i.setContext=function(e){i._link=e.document.createElement("a");i._origin=i.getOrigin(e.location.href)};i._origin="about:blank";return i}(),Ql=function(){function e(e,t){this.context=e;this._options=t;this._cache={}}e.prototype.addImage=function(e){var t=Promise.resolve();if(this.has(e))return t;if(jl(e)||Wl(e)){(this._cache[e]=this.loadImage(e)).catch(function(){});return t}return t};e.prototype.match=function(e){return this._cache[e]};e.prototype.loadImage=function(s){return u(this,void 0,void 0,function(){var t,r,i,n;var o=this;return V(this,function(e){switch(e.label){case 0:t=Hl.isSameOrigin(s);r=!ql(s)&&this._options.useCORS===true&&p.SUPPORT_CORS_IMAGES&&!t;i=!ql(s)&&!t&&!jl(s)&&typeof this._options.proxy==="string"&&p.SUPPORT_CORS_XHR&&!r;if(!t&&this._options.allowTaint===false&&!ql(s)&&!jl(s)&&!i&&!r)return[2];n=s;if(!i)return[3,2];return[4,this.proxy(n)];case 1:n=e.sent();e.label=2;case 2:this.context.logger.debug("Added image "+s.substring(0,256));return[4,new Promise(function(e,t){var i=new Image;i.onload=function(){return e(i)};i.onerror=t;if(Kl(n)||r)i.crossOrigin="anonymous";i.src=n;if(i.complete===true)setTimeout(function(){return e(i)},500);if(o._options.imageTimeout>0)setTimeout(function(){return t("Timed out ("+o._options.imageTimeout+"ms) loading image")},o._options.imageTimeout)})];case 3:return[2,e.sent()]}})})};e.prototype.has=function(e){return typeof this._cache[e]!=="undefined"};e.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))};e.prototype.proxy=function(s){var a=this;var l=this._options.proxy;if(!l)throw new Error("No proxy defined");var u=s.substring(0,256);return new Promise(function(t,i){var r=p.SUPPORT_RESPONSE_TYPE?"blob":"text";var n=new XMLHttpRequest;n.onload=function(){if(n.status===200)if(r==="text")t(n.response);else{var e=new FileReader;e.addEventListener("load",function(){return t(e.result)},false);e.addEventListener("error",function(e){return i(e)},false);e.readAsDataURL(n.response)}else i("Failed to proxy resource "+u+" with status code "+n.status)};n.onerror=i;var e=l.indexOf("?")>-1?"&":"?";n.open("GET",""+l+e+"url="+encodeURIComponent(s)+"&responseType="+r);if(r!=="text"&&n instanceof XMLHttpRequest)n.responseType=r;if(a._options.imageTimeout){var o=a._options.imageTimeout;n.timeout=o;n.ontimeout=function(){return i("Timed out ("+o+"ms) proxying "+u)}}n.send()})};return e}(),Vl=/^data:image\/svg\+xml/i,Gl=/^data:image\/.*;base64,/i,zl=/^data:image\/.*/i,Wl=function(e){return p.SUPPORT_SVG_DRAWING||!Zl(e)},ql=function(e){return zl.test(e)},Kl=function(e){return Gl.test(e)},jl=function(e){return e.substr(0,4)==="blob"},Zl=function(e){return e.substr(-3).toLowerCase()==="svg"||Vl.test(e)},T=function(){function i(e,t){this.type=0;this.x=e;this.y=t}i.prototype.add=function(e,t){return new i(this.x+e,this.y+t)};return i}(),Yl=function(e,t,i){return new T(e.x+(t.x-e.x)*i,e.y+(t.y-e.y)*i)},Xl=function(){function l(e,t,i,r){this.type=1;this.start=e;this.startControl=t;this.endControl=i;this.end=r}l.prototype.subdivide=function(e,t){var i=Yl(this.start,this.startControl,e);var r=Yl(this.startControl,this.endControl,e);var n=Yl(this.endControl,this.end,e);var o=Yl(i,r,e);var s=Yl(r,n,e);var a=Yl(o,s,e);return t?new l(this.start,i,o,a):new l(a,s,n,this.end)};l.prototype.add=function(e,t){return new l(this.start.add(e,t),this.startControl.add(e,t),this.endControl.add(e,t),this.end.add(e,t))};l.prototype.reverse=function(){return new l(this.end,this.endControl,this.startControl,this.start)};return l}(),L=function(e){return e.type===1},Jl=function(){function e(e){var t=e.styles;var i=e.bounds;var r=gr(t.borderTopLeftRadius,i.width,i.height),n=r[0],o=r[1];var s=gr(t.borderTopRightRadius,i.width,i.height),a=s[0],l=s[1];var u=gr(t.borderBottomRightRadius,i.width,i.height),c=u[0],h=u[1];var A=gr(t.borderBottomLeftRadius,i.width,i.height),p=A[0],f=A[1];var d=[];d.push((n+a)/i.width);d.push((p+c)/i.width);d.push((o+f)/i.height);d.push((l+h)/i.height);var g=Math.max.apply(Math,d);if(g>1){n/=g;o/=g;a/=g;l/=g;c/=g;h/=g;p/=g;f/=g}var m=i.width-a;var y=i.height-h;var _=i.width-c;var v=i.height-f;var C=t.borderTopWidth;var w=t.borderRightWidth;var x=t.borderBottomWidth;var b=t.borderLeftWidth;var E=O(t.paddingTop,e.bounds.width);var B=O(t.paddingRight,e.bounds.width);var M=O(t.paddingBottom,e.bounds.width);var I=O(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=n>0||o>0?F(i.left+b/3,i.top+C/3,n-b/3,o-C/3,D.TOP_LEFT):new T(i.left+b/3,i.top+C/3);this.topRightBorderDoubleOuterBox=n>0||o>0?F(i.left+m,i.top+C/3,a-w/3,l-C/3,D.TOP_RIGHT):new T(i.left+i.width-w/3,i.top+C/3);this.bottomRightBorderDoubleOuterBox=c>0||h>0?F(i.left+_,i.top+y,c-w/3,h-x/3,D.BOTTOM_RIGHT):new T(i.left+i.width-w/3,i.top+i.height-x/3);this.bottomLeftBorderDoubleOuterBox=p>0||f>0?F(i.left+b/3,i.top+v,p-b/3,f-x/3,D.BOTTOM_LEFT):new T(i.left+b/3,i.top+i.height-x/3);this.topLeftBorderDoubleInnerBox=n>0||o>0?F(i.left+b*2/3,i.top+C*2/3,n-b*2/3,o-C*2/3,D.TOP_LEFT):new T(i.left+b*2/3,i.top+C*2/3);this.topRightBorderDoubleInnerBox=n>0||o>0?F(i.left+m,i.top+C*2/3,a-w*2/3,l-C*2/3,D.TOP_RIGHT):new T(i.left+i.width-w*2/3,i.top+C*2/3);this.bottomRightBorderDoubleInnerBox=c>0||h>0?F(i.left+_,i.top+y,c-w*2/3,h-x*2/3,D.BOTTOM_RIGHT):new T(i.left+i.width-w*2/3,i.top+i.height-x*2/3);this.bottomLeftBorderDoubleInnerBox=p>0||f>0?F(i.left+b*2/3,i.top+v,p-b*2/3,f-x*2/3,D.BOTTOM_LEFT):new T(i.left+b*2/3,i.top+i.height-x*2/3);this.topLeftBorderStroke=n>0||o>0?F(i.left+b/2,i.top+C/2,n-b/2,o-C/2,D.TOP_LEFT):new T(i.left+b/2,i.top+C/2);this.topRightBorderStroke=n>0||o>0?F(i.left+m,i.top+C/2,a-w/2,l-C/2,D.TOP_RIGHT):new T(i.left+i.width-w/2,i.top+C/2);this.bottomRightBorderStroke=c>0||h>0?F(i.left+_,i.top+y,c-w/2,h-x/2,D.BOTTOM_RIGHT):new T(i.left+i.width-w/2,i.top+i.height-x/2);this.bottomLeftBorderStroke=p>0||f>0?F(i.left+b/2,i.top+v,p-b/2,f-x/2,D.BOTTOM_LEFT):new T(i.left+b/2,i.top+i.height-x/2);this.topLeftBorderBox=n>0||o>0?F(i.left,i.top,n,o,D.TOP_LEFT):new T(i.left,i.top);this.topRightBorderBox=a>0||l>0?F(i.left+m,i.top,a,l,D.TOP_RIGHT):new T(i.left+i.width,i.top);this.bottomRightBorderBox=c>0||h>0?F(i.left+_,i.top+y,c,h,D.BOTTOM_RIGHT):new T(i.left+i.width,i.top+i.height);this.bottomLeftBorderBox=p>0||f>0?F(i.left,i.top+v,p,f,D.BOTTOM_LEFT):new T(i.left,i.top+i.height);this.topLeftPaddingBox=n>0||o>0?F(i.left+b,i.top+C,Math.max(0,n-b),Math.max(0,o-C),D.TOP_LEFT):new T(i.left+b,i.top+C);this.topRightPaddingBox=a>0||l>0?F(i.left+Math.min(m,i.width-w),i.top+C,m>i.width+w?0:Math.max(0,a-w),Math.max(0,l-C),D.TOP_RIGHT):new T(i.left+i.width-w,i.top+C);this.bottomRightPaddingBox=c>0||h>0?F(i.left+Math.min(_,i.width-b),i.top+Math.min(y,i.height-x),Math.max(0,c-w),Math.max(0,h-x),D.BOTTOM_RIGHT):new T(i.left+i.width-w,i.top+i.height-x);this.bottomLeftPaddingBox=p>0||f>0?F(i.left+b,i.top+Math.min(v,i.height-x),Math.max(0,p-b),Math.max(0,f-x),D.BOTTOM_LEFT):new T(i.left+b,i.top+i.height-x);this.topLeftContentBox=n>0||o>0?F(i.left+b+I,i.top+C+E,Math.max(0,n-(b+I)),Math.max(0,o-(C+E)),D.TOP_LEFT):new T(i.left+b+I,i.top+C+E);this.topRightContentBox=a>0||l>0?F(i.left+Math.min(m,i.width+b+I),i.top+C+E,m>i.width+b+I?0:a-b+I,l-(C+E),D.TOP_RIGHT):new T(i.left+i.width-(w+B),i.top+C+E);this.bottomRightContentBox=c>0||h>0?F(i.left+Math.min(_,i.width-(b+I)),i.top+Math.min(y,i.height+C+E),Math.max(0,c-(w+B)),h-(x+M),D.BOTTOM_RIGHT):new T(i.left+i.width-(w+B),i.top+i.height-(x+M));this.bottomLeftContentBox=p>0||f>0?F(i.left+b+I,i.top+v,Math.max(0,p-(b+I)),f-(x+M),D.BOTTOM_LEFT):new T(i.left+b+I,i.top+i.height-(x+M))}return e}(),D,$l=D||(D={}),F=($l[$l["TOP_LEFT"]=0]="TOP_LEFT",$l[$l["TOP_RIGHT"]=1]="TOP_RIGHT",$l[$l["BOTTOM_RIGHT"]=2]="BOTTOM_RIGHT",$l[$l["BOTTOM_LEFT"]=3]="BOTTOM_LEFT",function(e,t,i,r,n){var o=4*((Math.sqrt(2)-1)/3);var s=i*o;var a=r*o;var l=e+i;var u=t+r;switch(n){case D.TOP_LEFT:return new Xl(new T(e,u),new T(e,u-a),new T(l-s,t),new T(l,t));case D.TOP_RIGHT:return new Xl(new T(e,t),new T(e+s,t),new T(l,u-a),new T(l,u));case D.BOTTOM_RIGHT:return new Xl(new T(l,t),new T(l,t+a),new T(e+s,u),new T(e,u));case D.BOTTOM_LEFT:default:return new Xl(new T(l,u),new T(l-s,u),new T(e,t+a),new T(e,t))}}),eu=function(e){return[e.topLeftBorderBox,e.topRightBorderBox,e.bottomRightBorderBox,e.bottomLeftBorderBox]},tu=function(e){return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox]},iu=function(e){return[e.topLeftPaddingBox,e.topRightPaddingBox,e.bottomRightPaddingBox,e.bottomLeftPaddingBox]},ru=function(){function e(e,t,i){this.offsetX=e;this.offsetY=t;this.matrix=i;this.type=0;this.target=2|4}return e}(),nu=function(){function e(e,t){this.path=e;this.target=t;this.type=1}return e}(),ou=function(){function e(e){this.opacity=e;this.type=2;this.target=2|4}return e}(),su=function(e){return e.type===0},au=function(e){return e.type===1},lu=function(e){return e.type===2},uu=function(e,i){if(e.length===i.length)return e.some(function(e,t){return e===i[t]});return false},cu=function(e,i,r,n,o){return e.map(function(e,t){switch(t){case 0:return e.add(i,r);case 1:return e.add(i+n,r);case 2:return e.add(i+n,r+o);case 3:return e.add(i,r+o)}return e})},hu=function(){function e(e){this.element=e;this.inlineLevel=[];this.nonInlineLevel=[];this.negativeZIndex=[];this.zeroOrAutoZIndexOrTransformedOrOpacity=[];this.positiveZIndex=[];this.nonPositionedFloats=[];this.nonPositionedInlineLevel=[]}return e}(),Au=function(){function e(e,t){this.container=e;this.parent=t;this.effects=[];this.curves=new Jl(this.container);if(this.container.styles.opacity<1)this.effects.push(new ou(this.container.styles.opacity));if(this.container.styles.transform!==null){var i=this.container.bounds.left+this.container.styles.transformOrigin[0].number;var r=this.container.bounds.top+this.container.styles.transformOrigin[1].number;var n=this.container.styles.transform;this.effects.push(new ru(i,r,n))}if(this.container.styles.overflowX!==0){var o=eu(this.curves);var s=iu(this.curves);if(uu(o,s))this.effects.push(new nu(o,2|4));else{this.effects.push(new nu(o,2));this.effects.push(new nu(s,4))}}}e.prototype.getEffects=function(t){var e=[2,3].indexOf(this.container.styles.position)===-1;var i=this.parent;var r=this.effects.slice(0);while(i){var n=i.effects.filter(function(e){return!au(e)});if(e||i.container.styles.position!==0||!i.parent){r.unshift.apply(r,n);e=[2,3].indexOf(i.container.styles.position)===-1;if(i.container.styles.overflowX!==0){var o=eu(i.curves);var s=iu(i.curves);if(!uu(o,s))r.unshift(new nu(s,2|4))}}else r.unshift.apply(r,n);i=i.parent}return r.filter(function(e){return S(e.target,t)})};return e}(),pu=function(c,h,A,p){c.container.elements.forEach(function(e){var t=S(e.flags,4);var i=S(e.flags,2);var r=new Au(e,c);if(S(e.styles.display,2048))p.push(r);var n=S(e.flags,8)?[]:p;if(t||i){var o=t||e.styles.isPositioned()?A:h;var s=new hu(r);if(e.styles.isPositioned()||e.styles.opacity<1||e.styles.isTransformed()){var a=e.styles.zIndex.order;if(a<0){var l=0;o.negativeZIndex.some(function(e,t){if(a>e.element.container.styles.zIndex.order){l=t;return false}else if(l>0)return true;return false});o.negativeZIndex.splice(l,0,s)}else if(a>0){var u=0;o.positiveZIndex.some(function(e,t){if(a>=e.element.container.styles.zIndex.order){u=t+1;return false}else if(u>0)return true;return false});o.positiveZIndex.splice(u,0,s)}else o.zeroOrAutoZIndexOrTransformedOrOpacity.push(s)}else if(e.styles.isFloating())o.nonPositionedFloats.push(s);else o.nonPositionedInlineLevel.push(s);pu(r,s,t?s:A,n)}else{if(e.styles.isInlineLevel())h.inlineLevel.push(r);else h.nonInlineLevel.push(r);pu(r,h,A,n)}if(S(e.flags,8))fu(e,n)})},fu=function(e,t){var i=e instanceof ya?e.start:1;var r=e instanceof ya?e.reversed:false;for(var n=0;n<t.length;n++){var o=t[n];if(o.container instanceof ma&&typeof o.container.value==="number"&&o.container.value!==0)i=o.container.value;o.listValue=_l(i,o.container.styles.listStyleType,true);i+=r?-1:1}},du=function(e){var t=new Au(e,null);var i=new hu(t);var r=[];pu(t,i,i,r);fu(t.container,r);return i},gu=function(e,t){switch(t){case 0:return r(e.topLeftBorderBox,e.topLeftPaddingBox,e.topRightBorderBox,e.topRightPaddingBox);case 1:return r(e.topRightBorderBox,e.topRightPaddingBox,e.bottomRightBorderBox,e.bottomRightPaddingBox);case 2:return r(e.bottomRightBorderBox,e.bottomRightPaddingBox,e.bottomLeftBorderBox,e.bottomLeftPaddingBox);case 3:default:return r(e.bottomLeftBorderBox,e.bottomLeftPaddingBox,e.topLeftBorderBox,e.topLeftPaddingBox)}},mu=function(e,t){switch(t){case 0:return r(e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox,e.topRightBorderBox,e.topRightBorderDoubleOuterBox);case 1:return r(e.topRightBorderBox,e.topRightBorderDoubleOuterBox,e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox);case 2:return r(e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox,e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox);case 3:default:return r(e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox,e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox)}},yu=function(e,t){switch(t){case 0:return r(e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox,e.topRightBorderDoubleInnerBox,e.topRightPaddingBox);case 1:return r(e.topRightBorderDoubleInnerBox,e.topRightPaddingBox,e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox);case 2:return r(e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox,e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox);case 3:default:return r(e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox,e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox)}},_u=function(e,t){switch(t){case 0:return vu(e.topLeftBorderStroke,e.topRightBorderStroke);case 1:return vu(e.topRightBorderStroke,e.bottomRightBorderStroke);case 2:return vu(e.bottomRightBorderStroke,e.bottomLeftBorderStroke);case 3:default:return vu(e.bottomLeftBorderStroke,e.topLeftBorderStroke)}},vu=function(e,t){var i=[];if(L(e))i.push(e.subdivide(.5,false));else i.push(e);if(L(t))i.push(t.subdivide(.5,true));else i.push(t);return i},r=function(e,t,i,r){var n=[];if(L(e))n.push(e.subdivide(.5,false));else n.push(e);if(L(i))n.push(i.subdivide(.5,true));else n.push(i);if(L(r))n.push(r.subdivide(.5,true).reverse());else n.push(r);if(L(t))n.push(t.subdivide(.5,false).reverse());else n.push(t);return n},Cu=function(e){var t=e.bounds;var i=e.styles;return t.add(i.borderLeftWidth,i.borderTopWidth,-(i.borderRightWidth+i.borderLeftWidth),-(i.borderTopWidth+i.borderBottomWidth))},wu=function(e){var t=e.styles;var i=e.bounds;var r=O(t.paddingLeft,i.width);var n=O(t.paddingRight,i.width);var o=O(t.paddingTop,i.width);var s=O(t.paddingBottom,i.width);return i.add(r+t.borderLeftWidth,o+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+r+n),-(t.borderTopWidth+t.borderBottomWidth+o+s))},xu=function(e,t){if(e===0)return t.bounds;if(e===2)return wu(t);return Cu(t)},bu=function(e,t){if(e===0)return t.bounds;if(e===2)return wu(t);return Cu(t)},Eu=function(e,t,i){var r=xu(Su(e.styles.backgroundOrigin,t),e);var n=bu(Su(e.styles.backgroundClip,t),e);var o=Iu(Su(e.styles.backgroundSize,t),i,r);var s=o[0],a=o[1];var l=gr(Su(e.styles.backgroundPosition,t),r.width-s,r.height-a);var u=Pu(Su(e.styles.backgroundRepeat,t),l,o,r,n);var c=Math.round(r.left+l[0]);var h=Math.round(r.top+l[1]);return[u,c,h,s,a]},Bu=function(e){return b(e)&&e.value===hn.AUTO},Mu=function(e){return typeof e==="number"},Iu=function(e,t,i){var r=t[0],n=t[1],o=t[2];var s=e[0],a=e[1];if(!s)return[0,0];if(E(s)&&a&&E(a))return[O(s,i.width),O(a,i.height)];var l=Mu(o);if(b(s)&&(s.value===hn.CONTAIN||s.value===hn.COVER)){if(Mu(o)){var u=i.width/i.height;return u<o!==(s.value===hn.COVER)?[i.width,i.width/o]:[i.height*o,i.height]}return[i.width,i.height]}var c=Mu(r);var h=Mu(n);var A=c||h;if(Bu(s)&&(!a||Bu(a))){if(c&&h)return[r,n];if(!l&&!A)return[i.width,i.height];if(A&&l){var p=c?r:n*o;var f=h?n:r/o;return[p,f]}var d=c?r:i.width;var g=h?n:i.height;return[d,g]}if(l){var m=0;var y=0;if(E(s))m=O(s,i.width);else if(E(a))y=O(a,i.height);if(Bu(s))m=y*o;else if(!a||Bu(a))y=m/o;return[m,y]}var _=null;var v=null;if(E(s))_=O(s,i.width);else if(a&&E(a))v=O(a,i.height);if(_!==null&&(!a||Bu(a)))v=c&&h?_/r*n:i.height;if(v!==null&&Bu(s))_=c&&h?v/n*r:i.width;if(_!==null&&v!==null)return[_,v];throw new Error("Unable to calculate background-size for element")},Su=function(e,t){var i=e[t];if(typeof i==="undefined")return e[0];return i},Pu=function(e,t,i,r,n){var o=t[0],s=t[1];var a=i[0],l=i[1];switch(e){case 2:return[new T(Math.round(r.left),Math.round(r.top+s)),new T(Math.round(r.left+r.width),Math.round(r.top+s)),new T(Math.round(r.left+r.width),Math.round(l+r.top+s)),new T(Math.round(r.left),Math.round(l+r.top+s))];case 3:return[new T(Math.round(r.left+o),Math.round(r.top)),new T(Math.round(r.left+o+a),Math.round(r.top)),new T(Math.round(r.left+o+a),Math.round(r.height+r.top)),new T(Math.round(r.left+o),Math.round(r.height+r.top))];case 1:return[new T(Math.round(r.left+o),Math.round(r.top+s)),new T(Math.round(r.left+o+a),Math.round(r.top+s)),new T(Math.round(r.left+o+a),Math.round(r.top+s+l)),new T(Math.round(r.left+o),Math.round(r.top+s+l))];default:return[new T(Math.round(n.left),Math.round(n.top)),new T(Math.round(n.left+n.width),Math.round(n.top)),new T(Math.round(n.left+n.width),Math.round(n.height+n.top)),new T(Math.round(n.left),Math.round(n.height+n.top))]}},Tu="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",Lu="Hidden Text",Du=function(){function e(e){this._data={};this._document=e}e.prototype.parseMetrics=function(e,t){var i=this._document.createElement("div");var r=this._document.createElement("img");var n=this._document.createElement("span");var o=this._document.body;i.style.visibility="hidden";i.style.fontFamily=e;i.style.fontSize=t;i.style.margin="0";i.style.padding="0";i.style.whiteSpace="nowrap";o.appendChild(i);r.src=Tu;r.width=1;r.height=1;r.style.margin="0";r.style.padding="0";r.style.verticalAlign="baseline";n.style.fontFamily=e;n.style.fontSize=t;n.style.margin="0";n.style.padding="0";n.appendChild(this._document.createTextNode(Lu));i.appendChild(n);i.appendChild(r);var s=r.offsetTop-n.offsetTop+2;i.removeChild(n);i.appendChild(this._document.createTextNode(Lu));i.style.lineHeight="normal";r.style.verticalAlign="super";var a=r.offsetTop-i.offsetTop+2;o.removeChild(i);return{baseline:s,middle:a}};e.prototype.getMetrics=function(e,t){var i=e+" "+t;if(typeof this._data[i]==="undefined")this._data[i]=this.parseMetrics(e,t);return this._data[i]};return e}(),Fu=function(){function e(e,t){this.context=e;this.options=t}return e}(),Nu=1e4,Ou=function(r){t(C,r);function C(e,t){var i=r.call(this,e,t)||this;i._activeEffects=[];i.canvas=t.canvas?t.canvas:document.createElement("canvas");i.ctx=i.canvas.getContext("2d");if(!t.canvas){i.canvas.width=Math.floor(t.width*t.scale);i.canvas.height=Math.floor(t.height*t.scale);i.canvas.style.width=t.width+"px";i.canvas.style.height=t.height+"px"}i.fontMetrics=new Du(document);i.ctx.scale(i.options.scale,i.options.scale);i.ctx.translate(-t.x,-t.y);i.ctx.textBaseline="bottom";i._activeEffects=[];i.context.logger.debug("Canvas renderer initialized ("+t.width+"x"+t.height+") with scale "+t.scale);return i}C.prototype.applyEffects=function(e){var t=this;while(this._activeEffects.length)this.popEffect();e.forEach(function(e){return t.applyEffect(e)})};C.prototype.applyEffect=function(e){this.ctx.save();if(lu(e))this.ctx.globalAlpha=e.opacity;if(su(e)){this.ctx.translate(e.offsetX,e.offsetY);this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]);this.ctx.translate(-e.offsetX,-e.offsetY)}if(au(e)){this.path(e.path);this.ctx.clip()}this._activeEffects.push(e)};C.prototype.popEffect=function(){this._activeEffects.pop();this.ctx.restore()};C.prototype.renderStack=function(i){return u(this,void 0,void 0,function(){var t;return V(this,function(e){switch(e.label){case 0:t=i.element.container.styles;if(!t.isVisible())return[3,2];return[4,this.renderStackContent(i)];case 1:e.sent();e.label=2;case 2:return[2]}})})};C.prototype.renderNode=function(t){return u(this,void 0,void 0,function(){return V(this,function(e){switch(e.label){case 0:if(S(t.container.flags,16))debugger;if(!t.container.styles.isVisible())return[3,3];return[4,this.renderNodeBackgroundAndBorders(t)];case 1:e.sent();return[4,this.renderNodeContent(t)];case 2:e.sent();e.label=3;case 3:return[2]}})})};C.prototype.renderTextWithLetterSpacing=function(i,e,r){var n=this;if(e===0)this.ctx.fillText(i.text,i.bounds.left,i.bounds.top+r);else{var t=oa(i.text);t.reduce(function(e,t){n.ctx.fillText(t,e,i.bounds.top+r);return e+n.ctx.measureText(t).width},i.bounds.left)}};C.prototype.createFontStyle=function(e){var t=e.fontVariant.filter(function(e){return e==="normal"||e==="small-caps"}).join("");var i=Qu(e.fontFamily).join(", ");var r=ar(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,t,e.fontWeight,r,i].join(" "),i,r]};C.prototype.renderTextNode=function(c,h){return u(this,void 0,void 0,function(){var t,i,r,n,o,s,a,l;var u=this;return V(this,function(e){t=this.createFontStyle(h),i=t[0],r=t[1],n=t[2];this.ctx.font=i;this.ctx.direction=h.direction===1?"rtl":"ltr";this.ctx.textAlign="left";this.ctx.textBaseline="alphabetic";o=this.fontMetrics.getMetrics(r,n),s=o.baseline,a=o.middle;l=h.paintOrder;c.textBounds.forEach(function(i){l.forEach(function(e){switch(e){case 0:u.ctx.fillStyle=R(h.color);u.renderTextWithLetterSpacing(i,h.letterSpacing,s);var t=h.textShadow;if(t.length&&i.text.trim().length){t.slice(0).reverse().forEach(function(e){u.ctx.shadowColor=R(e.color);u.ctx.shadowOffsetX=e.offsetX.number*u.options.scale;u.ctx.shadowOffsetY=e.offsetY.number*u.options.scale;u.ctx.shadowBlur=e.blur.number;u.renderTextWithLetterSpacing(i,h.letterSpacing,s)});u.ctx.shadowColor="";u.ctx.shadowOffsetX=0;u.ctx.shadowOffsetY=0;u.ctx.shadowBlur=0}if(h.textDecorationLine.length){u.ctx.fillStyle=R(h.textDecorationColor||h.color);h.textDecorationLine.forEach(function(e){switch(e){case 1:u.ctx.fillRect(i.bounds.left,Math.round(i.bounds.top+s),i.bounds.width,1);break;case 2:u.ctx.fillRect(i.bounds.left,Math.round(i.bounds.top),i.bounds.width,1);break;case 3:u.ctx.fillRect(i.bounds.left,Math.ceil(i.bounds.top+a),i.bounds.width,1);break}})}break;case 1:if(h.webkitTextStrokeWidth&&i.text.trim().length){u.ctx.strokeStyle=R(h.webkitTextStrokeColor);u.ctx.lineWidth=h.webkitTextStrokeWidth;u.ctx.lineJoin=!!window.chrome?"miter":"round";u.ctx.strokeText(i.text,i.bounds.left,i.bounds.top+s)}u.ctx.strokeStyle="";u.ctx.lineWidth=0;u.ctx.lineJoin="miter";break}})});return[2]})})};C.prototype.renderReplacedElement=function(e,t,i){if(i&&e.intrinsicWidth>0&&e.intrinsicHeight>0){var r=wu(e);var n=iu(t);this.path(n);this.ctx.save();this.ctx.clip();this.ctx.drawImage(i,0,0,e.intrinsicWidth,e.intrinsicHeight,r.left,r.top,r.width,r.height);this.ctx.restore()}};C.prototype.renderNodeContent=function(v){return u(this,void 0,void 0,function(){var t,i,r,n,o,s,a,a,l,u,c,h,A,p,f,d,g,m,y,a,_,A,d;return V(this,function(e){switch(e.label){case 0:this.applyEffects(v.getEffects(4));t=v.container;i=v.curves;r=t.styles;n=0,o=t.textNodes;e.label=1;case 1:if(!(n<o.length))return[3,4];s=o[n];return[4,this.renderTextNode(s,r)];case 2:e.sent();e.label=3;case 3:n++;return[3,1];case 4:if(!(t instanceof fa))return[3,8];e.label=5;case 5:e.trys.push([5,7,,8]);return[4,this.context.cache.match(t.src)];case 6:a=e.sent();this.renderReplacedElement(t,i,a);return[3,8];case 7:e.sent();this.context.logger.error("Error loading image "+t.src);return[3,8];case 8:if(t instanceof da)this.renderReplacedElement(t,i,t.canvas);if(!(t instanceof ga))return[3,12];e.label=9;case 9:e.trys.push([9,11,,12]);return[4,this.context.cache.match(t.svg)];case 10:a=e.sent();this.renderReplacedElement(t,i,a);return[3,12];case 11:e.sent();this.context.logger.error("Error loading svg "+t.svg.substring(0,255));return[3,12];case 12:if(!(t instanceof Pa&&t.tree))return[3,14];l=new C(this.context,{scale:this.options.scale,backgroundColor:t.backgroundColor,x:0,y:0,width:t.width,height:t.height});return[4,l.render(t.tree)];case 13:u=e.sent();if(t.width&&t.height)this.ctx.drawImage(u,0,0,t.width,t.height,t.bounds.left,t.bounds.top,t.bounds.width,t.bounds.height);e.label=14;case 14:if(t instanceof Ma){c=Math.min(t.bounds.width,t.bounds.height);if(t.type===xa){if(t.checked){this.ctx.save();this.path([new T(t.bounds.left+c*.39363,t.bounds.top+c*.79),new T(t.bounds.left+c*.16,t.bounds.top+c*.5549),new T(t.bounds.left+c*.27347,t.bounds.top+c*.44071),new T(t.bounds.left+c*.39694,t.bounds.top+c*.5649),new T(t.bounds.left+c*.72983,t.bounds.top+c*.23),new T(t.bounds.left+c*.84,t.bounds.top+c*.34085),new T(t.bounds.left+c*.39363,t.bounds.top+c*.79)]);this.ctx.fillStyle=R(Ba);this.ctx.fill();this.ctx.restore()}}else if(t.type===ba)if(t.checked){this.ctx.save();this.ctx.beginPath();this.ctx.arc(t.bounds.left+c/2,t.bounds.top+c/2,c/4,0,Math.PI*2,true);this.ctx.fillStyle=R(Ba);this.ctx.fill();this.ctx.restore()}}if(Ru(t)&&t.value.length){h=this.createFontStyle(r),A=h[0],p=h[1];f=this.fontMetrics.getMetrics(A,p).baseline;this.ctx.font=A;this.ctx.fillStyle=R(r.color);this.ctx.textBaseline="alphabetic";this.ctx.textAlign=ku(t.styles.textAlign);d=wu(t);g=0;switch(t.styles.textAlign){case 1:g+=d.width/2;break;case 2:g+=d.width;break}m=d.add(g,0,0,-d.height/2+1);this.ctx.save();this.path([new T(d.left,d.top),new T(d.left+d.width,d.top),new T(d.left+d.width,d.top+d.height),new T(d.left,d.top+d.height)]);this.ctx.clip();this.renderTextWithLetterSpacing(new ta(t.value,m),r.letterSpacing,f);this.ctx.restore();this.ctx.textBaseline="alphabetic";this.ctx.textAlign="left"}if(!S(t.styles.display,2048))return[3,20];if(!(t.styles.listStyleImage!==null))return[3,19];y=t.styles.listStyleImage;if(!(y.type===0))return[3,18];a=void 0;_=y.url;e.label=15;case 15:e.trys.push([15,17,,18]);return[4,this.context.cache.match(_)];case 16:a=e.sent();this.ctx.drawImage(a,t.bounds.left-(a.width+10),t.bounds.top);return[3,18];case 17:e.sent();this.context.logger.error("Error loading list-style-image "+_);return[3,18];case 18:return[3,20];case 19:if(v.listValue&&t.styles.listStyleType!==-1){A=this.createFontStyle(r)[0];this.ctx.font=A;this.ctx.fillStyle=R(r.color);this.ctx.textBaseline="middle";this.ctx.textAlign="right";d=new G(t.bounds.left,t.bounds.top+O(t.styles.paddingTop,t.bounds.width),t.bounds.width,Wn(r.lineHeight,r.fontSize.number)/2+1);this.renderTextWithLetterSpacing(new ta(v.listValue,d),r.letterSpacing,Wn(r.lineHeight,r.fontSize.number)/2+2);this.ctx.textBaseline="bottom";this.ctx.textAlign="left"}e.label=20;case 20:return[2]}})})};C.prototype.renderStackContent=function(g){return u(this,void 0,void 0,function(){var t,i,r,n,o,r,s,a,r,l,u,r,c,h,r,A,p,r,f,d,r;return V(this,function(e){switch(e.label){case 0:if(S(g.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(g.element)];case 1:e.sent();t=0,i=g.negativeZIndex;e.label=2;case 2:if(!(t<i.length))return[3,5];r=i[t];return[4,this.renderStack(r)];case 3:e.sent();e.label=4;case 4:t++;return[3,2];case 5:return[4,this.renderNodeContent(g.element)];case 6:e.sent();n=0,o=g.nonInlineLevel;e.label=7;case 7:if(!(n<o.length))return[3,10];r=o[n];return[4,this.renderNode(r)];case 8:e.sent();e.label=9;case 9:n++;return[3,7];case 10:s=0,a=g.nonPositionedFloats;e.label=11;case 11:if(!(s<a.length))return[3,14];r=a[s];return[4,this.renderStack(r)];case 12:e.sent();e.label=13;case 13:s++;return[3,11];case 14:l=0,u=g.nonPositionedInlineLevel;e.label=15;case 15:if(!(l<u.length))return[3,18];r=u[l];return[4,this.renderStack(r)];case 16:e.sent();e.label=17;case 17:l++;return[3,15];case 18:c=0,h=g.inlineLevel;e.label=19;case 19:if(!(c<h.length))return[3,22];r=h[c];return[4,this.renderNode(r)];case 20:e.sent();e.label=21;case 21:c++;return[3,19];case 22:A=0,p=g.zeroOrAutoZIndexOrTransformedOrOpacity;e.label=23;case 23:if(!(A<p.length))return[3,26];r=p[A];return[4,this.renderStack(r)];case 24:e.sent();e.label=25;case 25:A++;return[3,23];case 26:f=0,d=g.positiveZIndex;e.label=27;case 27:if(!(f<d.length))return[3,30];r=d[f];return[4,this.renderStack(r)];case 28:e.sent();e.label=29;case 29:f++;return[3,27];case 30:return[2]}})})};C.prototype.mask=function(e){this.ctx.beginPath();this.ctx.moveTo(0,0);this.ctx.lineTo(this.canvas.width,0);this.ctx.lineTo(this.canvas.width,this.canvas.height);this.ctx.lineTo(0,this.canvas.height);this.ctx.lineTo(0,0);this.formatPath(e.slice(0).reverse());this.ctx.closePath()};C.prototype.path=function(e){this.ctx.beginPath();this.formatPath(e);this.ctx.closePath()};C.prototype.formatPath=function(e){var r=this;e.forEach(function(e,t){var i=L(e)?e.start:e;if(t===0)r.ctx.moveTo(i.x,i.y);else r.ctx.lineTo(i.x,i.y);if(L(e))r.ctx.bezierCurveTo(e.startControl.x,e.startControl.y,e.endControl.x,e.endControl.y,e.end.x,e.end.y)})};C.prototype.renderRepeat=function(e,t,i,r){this.path(e);this.ctx.fillStyle=t;this.ctx.translate(i,r);this.ctx.fill();this.ctx.translate(-i,-r)};C.prototype.resizeImage=function(e,t,i){var r;if(e.width===t&&e.height===i)return e;var n=(r=this.canvas.ownerDocument)!==null&&r!==void 0?r:document;var o=n.createElement("canvas");o.width=Math.max(1,t);o.height=Math.max(1,i);var s=o.getContext("2d");s.drawImage(e,0,0,e.width,e.height,0,0,t,i);return o};C.prototype.renderBackgroundImage=function(N){return u(this,void 0,void 0,function(){var D,t,F,i,r,n;return V(this,function(e){switch(e.label){case 0:D=N.styles.backgroundImage.length-1;t=function(t){var i,r,n,o,s,a,l,u,c,h,o,s,a,l,u,A,p,f,d,g,m,y,_,v,c,C,o,w,x,l,u,b,s,a,E,B,M,I,S,P,T,L;return V(this,function(e){switch(e.label){case 0:if(!(t.type===0))return[3,5];i=void 0;r=t.url;e.label=1;case 1:e.trys.push([1,3,,4]);return[4,F.context.cache.match(r)];case 2:i=e.sent();return[3,4];case 3:e.sent();F.context.logger.error("Error loading background-image "+r);return[3,4];case 4:if(i){n=Eu(N,D,[i.width,i.height,i.width/i.height]),o=n[0],s=n[1],a=n[2],l=n[3],u=n[4];c=F.ctx.createPattern(F.resizeImage(i,l,u),"repeat");F.renderRepeat(o,c,s,a)}return[3,6];case 5:if(en(t)){h=Eu(N,D,[null,null,null]),o=h[0],s=h[1],a=h[2],l=h[3],u=h[4];A=Ur(t.angle,l,u),p=A[0],f=A[1],d=A[2],g=A[3],m=A[4];y=document.createElement("canvas");y.width=l;y.height=u;_=y.getContext("2d");v=_.createLinearGradient(f,g,d,m);Or(t.stops,p).forEach(function(e){return v.addColorStop(e.stop,R(e.color))});_.fillStyle=v;_.fillRect(0,0,l,u);if(l>0&&u>0){c=F.ctx.createPattern(y,"repeat");F.renderRepeat(o,c,s,a)}}else if(tn(t)){C=Eu(N,D,[null,null,null]),o=C[0],w=C[1],x=C[2],l=C[3],u=C[4];b=t.position.length===0?[dr]:t.position;s=O(b[0],l);a=O(b[b.length-1],u);E=Hr(t,s,a,l,u),B=E[0],M=E[1];if(B>0&&M>0){I=F.ctx.createRadialGradient(w+s,x+a,0,w+s,x+a,B);Or(t.stops,B*2).forEach(function(e){return I.addColorStop(e.stop,R(e.color))});F.path(o);F.ctx.fillStyle=I;if(B!==M){S=N.bounds.left+.5*N.bounds.width;P=N.bounds.top+.5*N.bounds.height;T=M/B;L=1/T;F.ctx.save();F.ctx.translate(S,P);F.ctx.transform(1,0,0,T,0,0);F.ctx.translate(-S,-P);F.ctx.fillRect(w,L*(x-P)+P,l,u*L);F.ctx.restore()}else F.ctx.fill()}}e.label=6;case 6:D--;return[2]}})};F=this;i=0,r=N.styles.backgroundImage.slice(0).reverse();e.label=1;case 1:if(!(i<r.length))return[3,4];n=r[i];return[5,t(n)];case 2:e.sent();e.label=3;case 3:i++;return[3,1];case 4:return[2]}})})};C.prototype.renderSolidBorder=function(t,i,r){return u(this,void 0,void 0,function(){return V(this,function(e){this.path(gu(r,i));this.ctx.fillStyle=R(t);this.ctx.fill();return[2]})})};C.prototype.renderDoubleBorder=function(r,n,o,s){return u(this,void 0,void 0,function(){var t,i;return V(this,function(e){switch(e.label){case 0:if(!(n<3))return[3,2];return[4,this.renderSolidBorder(r,o,s)];case 1:e.sent();return[2];case 2:t=mu(s,o);this.path(t);this.ctx.fillStyle=R(r);this.ctx.fill();i=yu(s,o);this.path(i);this.ctx.fill();return[2]}})})};C.prototype.renderNodeBackgroundAndBorders=function(c){return u(this,void 0,void 0,function(){var t,i,r,n,o,s,a,l;var u=this;return V(this,function(e){switch(e.label){case 0:this.applyEffects(c.getEffects(2));t=c.container.styles;i=!Er(t.backgroundColor)||t.backgroundImage.length;r=[{style:t.borderTopStyle,color:t.borderTopColor,width:t.borderTopWidth},{style:t.borderRightStyle,color:t.borderRightColor,width:t.borderRightWidth},{style:t.borderBottomStyle,color:t.borderBottomColor,width:t.borderBottomWidth},{style:t.borderLeftStyle,color:t.borderLeftColor,width:t.borderLeftWidth}];n=Uu(Su(t.backgroundClip,0),c.curves);if(!(i||t.boxShadow.length))return[3,2];this.ctx.save();this.path(n);this.ctx.clip();if(!Er(t.backgroundColor)){this.ctx.fillStyle=R(t.backgroundColor);this.ctx.fill()}return[4,this.renderBackgroundImage(c.container)];case 1:e.sent();this.ctx.restore();t.boxShadow.slice(0).reverse().forEach(function(e){u.ctx.save();var t=eu(c.curves);var i=e.inset?0:Nu;var r=cu(t,-i+(e.inset?1:-1)*e.spread.number,(e.inset?1:-1)*e.spread.number,e.spread.number*(e.inset?-2:2),e.spread.number*(e.inset?-2:2));if(e.inset){u.path(t);u.ctx.clip();u.mask(r)}else{u.mask(t);u.ctx.clip();u.path(r)}u.ctx.shadowOffsetX=e.offsetX.number+i;u.ctx.shadowOffsetY=e.offsetY.number;u.ctx.shadowColor=R(e.color);u.ctx.shadowBlur=e.blur.number;u.ctx.fillStyle=e.inset?R(e.color):"rgba(0,0,0,1)";u.ctx.fill();u.ctx.restore()});e.label=2;case 2:o=0;s=0,a=r;e.label=3;case 3:if(!(s<a.length))return[3,13];l=a[s];if(!(l.style!==0&&!Er(l.color)&&l.width>0))return[3,11];if(!(l.style===2))return[3,5];return[4,this.renderDashedDottedBorder(l.color,l.width,o,c.curves,2)];case 4:e.sent();return[3,11];case 5:if(!(l.style===3))return[3,7];return[4,this.renderDashedDottedBorder(l.color,l.width,o,c.curves,3)];case 6:e.sent();return[3,11];case 7:if(!(l.style===4))return[3,9];return[4,this.renderDoubleBorder(l.color,l.width,o,c.curves)];case 8:e.sent();return[3,11];case 9:return[4,this.renderSolidBorder(l.color,o,c.curves)];case 10:e.sent();e.label=11;case 11:o++;e.label=12;case 12:s++;return[3,3];case 13:return[2]}})})};C.prototype.renderDashedDottedBorder=function(m,y,_,v,C){return u(this,void 0,void 0,function(){var t,i,r,n,o,s,a,l,u,c,h,A,p,f,d,g,d,g;return V(this,function(e){this.ctx.save();t=_u(v,_);i=gu(v,_);if(C===2){this.path(i);this.ctx.clip()}if(L(i[0])){r=i[0].start.x;n=i[0].start.y}else{r=i[0].x;n=i[0].y}if(L(i[1])){o=i[1].end.x;s=i[1].end.y}else{o=i[1].x;s=i[1].y}if(_===0||_===2)a=Math.abs(r-o);else a=Math.abs(n-s);this.ctx.beginPath();if(C===3)this.formatPath(t);else this.formatPath(i.slice(0,2));l=y<3?y*3:y*2;u=y<3?y*2:y;if(C===3){l=y;u=y}c=true;if(a<=l*2)c=false;else if(a<=l*2+u){h=a/(2*l+u);l*=h;u*=h}else{A=Math.floor((a+u)/(l+u));p=(a-A*l)/(A-1);f=(a-(A+1)*l)/A;u=f<=0||Math.abs(u-p)<Math.abs(u-f)?p:f}if(c)if(C===3)this.ctx.setLineDash([0,l+u]);else this.ctx.setLineDash([l,u]);if(C===3){this.ctx.lineCap="round";this.ctx.lineWidth=y}else this.ctx.lineWidth=y*2+1.1;this.ctx.strokeStyle=R(m);this.ctx.stroke();this.ctx.setLineDash([]);if(C===2){if(L(i[0])){d=i[3];g=i[0];this.ctx.beginPath();this.formatPath([new T(d.end.x,d.end.y),new T(g.start.x,g.start.y)]);this.ctx.stroke()}if(L(i[1])){d=i[1];g=i[2];this.ctx.beginPath();this.formatPath([new T(d.end.x,d.end.y),new T(g.start.x,g.start.y)]);this.ctx.stroke()}}this.ctx.restore();return[2]})})};C.prototype.render=function(i){return u(this,void 0,void 0,function(){var t;return V(this,function(e){switch(e.label){case 0:if(this.options.backgroundColor){this.ctx.fillStyle=R(this.options.backgroundColor);this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)}t=du(i);return[4,this.renderStack(t)];case 1:e.sent();this.applyEffects([]);return[2,this.canvas]}})})};return C}(Fu),Ru=function(e){if(e instanceof Sa)return true;else if(e instanceof Ia)return true;else if(e instanceof Ma&&e.type!==ba&&e.type!==xa)return true;return false},Uu=function(e,t){switch(e){case 0:return eu(t);case 2:return tu(t);case 1:default:return iu(t)}},ku=function(e){switch(e){case 1:return"center";case 2:return"right";case 0:default:return"left"}},Hu=["-apple-system","system-ui"],Qu=function(e){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?e.filter(function(e){return Hu.indexOf(e)===-1}):e},Vu=function(r){t(e,r);function e(e,t){var i=r.call(this,e,t)||this;i.canvas=t.canvas?t.canvas:document.createElement("canvas");i.ctx=i.canvas.getContext("2d");i.options=t;i.canvas.width=Math.floor(t.width*t.scale);i.canvas.height=Math.floor(t.height*t.scale);i.canvas.style.width=t.width+"px";i.canvas.style.height=t.height+"px";i.ctx.scale(i.options.scale,i.options.scale);i.ctx.translate(-t.x,-t.y);i.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+t.width+"x"+t.height+" at "+t.x+","+t.y+") with scale "+t.scale);return i}e.prototype.render=function(r){return u(this,void 0,void 0,function(){var t,i;return V(this,function(e){switch(e.label){case 0:t=$s(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,r);return[4,Gu(t)];case 1:i=e.sent();if(this.options.backgroundColor){this.ctx.fillStyle=R(this.options.backgroundColor);this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)}this.ctx.drawImage(i,-this.options.x*this.options.scale,-this.options.y*this.options.scale);return[2,this.canvas]}})})};return e}(Fu),Gu=function(r){return new Promise(function(e,t){var i=new Image;i.onload=function(){e(i)};i.onerror=t;i.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(r))})},zu=function(){function e(e){var t=e.id,i=e.enabled;this.id=t;this.enabled=i;this.start=Date.now()}e.prototype.debug=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];if(this.enabled)if(typeof window!=="undefined"&&window.console&&typeof console.debug==="function")console.debug.apply(console,s([this.id,this.getTime()+"ms"],e));else this.info.apply(this,e)};e.prototype.getTime=function(){return Date.now()-this.start};e.prototype.info=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];if(this.enabled)if(typeof window!=="undefined"&&window.console&&typeof console.info==="function")console.info.apply(console,s([this.id,this.getTime()+"ms"],e))};e.prototype.warn=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];if(this.enabled)if(typeof window!=="undefined"&&window.console&&typeof console.warn==="function")console.warn.apply(console,s([this.id,this.getTime()+"ms"],e));else this.info.apply(this,e)};e.prototype.error=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];if(this.enabled)if(typeof window!=="undefined"&&window.console&&typeof console.error==="function")console.error.apply(console,s([this.id,this.getTime()+"ms"],e));else this.info.apply(this,e)};e.instances={};return e}(),Wu=function(){function r(e,t){var i;this.windowBounds=t;this.instanceName="#"+r.instanceCount++;this.logger=new zu({id:this.instanceName,enabled:e.logging});this.cache=(i=e.cache)!==null&&i!==void 0?i:new Ql(this,e)}r.instanceCount=1;return r}(),qu=function(e,t){if(t===void 0)t={};return Ku(e,t)};if(typeof window!=="undefined")Hl.setContext(window);var Ku=function(H,Q){return u(void 0,void 0,void 0,function(){var t,i,r,R,n,o,s,a,U,l,u,k,c,h,A,p,f,d,g,m,y,_,y;var v,C,w,x,b,E,B,M,I,S,P,T,L,D,F,N,O;return V(this,function(e){switch(e.label){case 0:if(!H||typeof H!=="object")return[2,Promise.reject("Invalid element provided as first argument")];t=H.ownerDocument;if(!t)throw new Error("Element is not attached to a Document");i=t.defaultView;if(!i)throw new Error("Document is not attached to a Window");r={allowTaint:(v=Q.allowTaint)!==null&&v!==void 0?v:false,imageTimeout:(C=Q.imageTimeout)!==null&&C!==void 0?C:15e3,proxy:Q.proxy,useCORS:(w=Q.useCORS)!==null&&w!==void 0?w:false};R=W({logging:(x=Q.logging)!==null&&x!==void 0?x:true,cache:Q.cache},r);n={windowWidth:(b=Q.windowWidth)!==null&&b!==void 0?b:i.innerWidth,windowHeight:(E=Q.windowHeight)!==null&&E!==void 0?E:i.innerHeight,scrollX:(B=Q.scrollX)!==null&&B!==void 0?B:i.pageXOffset,scrollY:(M=Q.scrollY)!==null&&M!==void 0?M:i.pageYOffset};o=new G(n.scrollX,n.scrollY,n.windowWidth,n.windowHeight);s=new Wu(R,o);a=(I=Q.foreignObjectRendering)!==null&&I!==void 0?I:false;U={allowTaint:(S=Q.allowTaint)!==null&&S!==void 0?S:false,onclone:Q.onclone,ignoreElements:Q.ignoreElements,inlineImages:a,copyStyles:a};s.logger.debug("Starting document clone with size "+o.width+"x"+o.height+" scrolled to "+-o.left+","+-o.top);l=new Cl(s,H,U);u=l.clonedReferenceElement;if(!u)return[2,Promise.reject("Unable to find element in cloned iframe")];return[4,l.toIFrame(t,o)];case 1:k=e.sent();c=qa(u)||za(u)?K(u.ownerDocument):q(s,u),h=c.width,A=c.height,p=c.left,f=c.top;d=ju(s,u,Q.backgroundColor);g={canvas:Q.canvas,backgroundColor:d,scale:(T=(P=Q.scale)!==null&&P!==void 0?P:i.devicePixelRatio)!==null&&T!==void 0?T:1,x:((L=Q.x)!==null&&L!==void 0?L:0)+p,y:((D=Q.y)!==null&&D!==void 0?D:0)+f,width:(F=Q.width)!==null&&F!==void 0?F:Math.ceil(h),height:(N=Q.height)!==null&&N!==void 0?N:Math.ceil(A)};if(!a)return[3,3];s.logger.debug("Document cloned, using foreign object rendering");y=new Vu(s,g);return[4,y.render(u)];case 2:m=e.sent();return[3,5];case 3:s.logger.debug("Document cloned, element located at "+p+","+f+" with size "+h+"x"+A+" using computed rendering");s.logger.debug("Starting DOM parsing");_=Fa(s,u);if(d===_.styles.backgroundColor)_.styles.backgroundColor=z.TRANSPARENT;s.logger.debug("Starting renderer for element at "+g.x+","+g.y+" with size "+g.width+"x"+g.height);y=new Ou(s,g);return[4,y.render(_)];case 4:m=e.sent();e.label=5;case 5:if((O=Q.removeContainer)!==null&&O!==void 0?O:true)if(!Cl.destroy(k))s.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore");s.logger.debug("Finished rendering");return[2,m]}})})},ju=function(e,t,i){var r=t.ownerDocument;var n=r.documentElement?Lr(e,getComputedStyle(r.documentElement).backgroundColor):z.TRANSPARENT;var o=r.body?Lr(e,getComputedStyle(r.body).backgroundColor):z.TRANSPARENT;var s=typeof i==="string"?Lr(e,i):i===null?z.TRANSPARENT:4294967295;return t===r.documentElement?Er(n)?Er(o)?s:o:n:s};return qu}()},2333:function(e,t){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
t.read=function(e,t,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,u=l>>1,c=-7,h=i?n-1:0,A=i?-1:1,n=e[t+h];for(h+=A,o=n&(1<<-c)-1,n>>=-c,c+=a;0<c;o=256*o+e[t+h],h+=A,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=r;0<c;s=256*s+e[t+h],h+=A,c-=8);if(0===o)o=1-u;else{if(o===l)return s?NaN:1/0*(n?-1:1);s+=Math.pow(2,r),o-=u}return(n?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,i,r,n,o){var s,a,l=8*o-n-1,u=(1<<l)-1,c=u>>1,h=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,A=r?0:o-1,p=r?1:-1,o=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(r=Math.pow(2,-s))<1&&(s--,r*=2),2<=(t+=1<=s+c?h/r:h*Math.pow(2,1-c))*r&&(s++,r/=2),u<=s+c?(a=0,s=u):1<=s+c?(a=(t*r-1)*Math.pow(2,n),s+=c):(a=t*Math.pow(2,c-1)*Math.pow(2,n),s=0));8<=n;e[i+A]=255&a,A+=p,a/=256,n-=8);for(s=s<<n|a,l+=n;0<l;e[i+A]=255&s,A+=p,s/=256,l-=8);e[i+A-p]|=128*o}},5014:function(){"use strict";function e(e="utf-8"){if("utf-8"!==e)throw new RangeError(`Failed to construct 'TextEncoder': The encoding label provided ('${e}') is invalid.`)}function t(e="utf-8",t={fatal:!1}){if("utf-8"!==e)throw new RangeError(`Failed to construct 'TextDecoder': The encoding label provided ('${e}') is invalid.`);if(t.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}var i;(i="undefined"!=typeof window?window:"undefined"!=typeof self?self:this).TextEncoder&&i.TextDecoder||(Object.defineProperty(e.prototype,"encoding",{value:"utf-8"}),e.prototype.encode=function(t,e={stream:!1}){if(e.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");let i=0;var r,n=t.length;let o=0,s=Math.max(32,n+(n>>1)+7),a=new Uint8Array(s>>3<<3);for(;i<n;){let e=t.charCodeAt(i++);if(55296<=e&&e<=56319)if(i<n&&56320==(64512&(r=t.charCodeAt(i)))&&(++i,e=((1023&e)<<10)+(1023&r)+65536),55296<=e&&e<=56319)continue;if(o+4>a.length&&(s=(s=(s+=8)*(1+i/t.length*2))>>3<<3,(r=new Uint8Array(s)).set(a),a=r),0==(4294967168&e))a[o++]=e;else{if(0==(4294965248&e))a[o++]=e>>6&31|192;else{if(0==(4294901760&e))a[o++]=e>>12&15|224;else{if(0!=(4292870144&e))continue;a[o++]=e>>18&7|240,a[o++]=e>>12&63|128}a[o++]=e>>6&63|128}a[o++]=63&e|128}}return a.slice(0,o)},Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(t.prototype,"fatal",{value:!1}),Object.defineProperty(t.prototype,"ignoreBOM",{value:!1}),t.prototype.decode=function(e,t={stream:!1}){if(t.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");var i=new Uint8Array(e);let r=0;for(var n=i.length,o=[];r<n;){var s=i[r++];if(0===s)break;if(0==(128&s))o.push(s);else if(192==(224&s)){var a=63&i[r++];o.push((31&s)<<6|a)}else if(224==(240&s)){var a=63&i[r++],l=63&i[r++];o.push((31&s)<<12|a<<6|l)}else if(240==(248&s)){let e=(7&s)<<18|(63&i[r++])<<12|(63&i[r++])<<6|63&i[r++];65535<e&&(e-=65536,o.push(e>>>10&1023|55296),e=56320|1023&e),o.push(e)}}return String.fromCharCode.apply(null,o)},i.TextEncoder=e,i.TextDecoder=t)},9500:function(e,o,t){var i="function"==typeof Map&&Map.prototype,r=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,m=i&&r&&"function"==typeof r.get?r.get:null,q=i&&Map.prototype.forEach,r="function"==typeof Set&&Set.prototype,i=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,y=r&&i&&"function"==typeof i.get?i.get:null,K=r&&Set.prototype.forEach,_="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,v="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,C="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,j=Boolean.prototype.valueOf,s=Object.prototype.toString,Z=Function.prototype.toString,Y=String.prototype.match,w=String.prototype.slice,x=String.prototype.replace,a=String.prototype.toUpperCase,b=String.prototype.toLowerCase,c=RegExp.prototype.test,E=Array.prototype.concat,B=Array.prototype.join,X=Array.prototype.slice,n=Math.floor,M="function"==typeof BigInt?BigInt.prototype.valueOf:null,h=Object.getOwnPropertySymbols,I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,S="function"==typeof Symbol&&"object"==typeof Symbol.iterator,P="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,T=Object.prototype.propertyIsEnumerable,L=("function"==typeof Reflect?Reflect:Object).getPrototypeOf||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function D(e,t){if(e===1/0||e===-1/0||e!=e||e&&-1e3<e&&e<1e3||c.call(/e/,t))return t;var i=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var r=e<0?-n(-e):n(e);if(r!==e)return e=String(r),r=w.call(t,e.length+1),x.call(e,i,"$&_")+"."+x.call(x.call(r,/([0-9]{3})/g,"$&_"),/_$/,"")}return x.call(t,i,"$&_")}var i=t(3260).custom,F=i&&R(i)?i:null;function N(e,t,i){i="double"===(i.quoteStyle||t)?'"':"'";return i+e+i}function O(e){return!("[object Array]"!==k(e)||P&&"object"==typeof e&&P in e)}function R(e){if(S)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return 1;if(e&&"object"==typeof e&&I)try{return I.call(e),1}catch(e){}}e.exports=function r(i,e,n,o){var s=e||{};if(U(s,"quoteStyle")&&"single"!==s.quoteStyle&&"double"!==s.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(U(s,"maxStringLength")&&("number"==typeof s.maxStringLength?s.maxStringLength<0&&s.maxStringLength!==1/0:null!==s.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');e=!U(s,"customInspect")||s.customInspect;if("boolean"!=typeof e&&"symbol"!==e)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(U(s,"indent")&&null!==s.indent&&"\t"!==s.indent&&!(parseInt(s.indent,10)===s.indent&&0<s.indent))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(U(s,"numericSeparator")&&"boolean"!=typeof s.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var t=s.numericSeparator;if(void 0===i)return"undefined";if(null===i)return"null";if("boolean"==typeof i)return i?"true":"false";if("string"==typeof i)return function e(t,i){if(t.length>i.maxStringLength)return r=t.length-i.maxStringLength,r="... "+r+" more character"+(1<r?"s":""),e(w.call(t,0,i.maxStringLength),i)+r;var r=x.call(x.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,J);return N(r,"single",i)}(i,s);if("number"==typeof i)return 0===i?0<1/0/i?"0":"-0":(A=String(i),t?D(i,A):A);if("bigint"==typeof i)return A=String(i)+"n",t?D(i,A):A;t=void 0===s.depth?5:s.depth;if(t<=(n=void 0===n?0:n)&&0<t&&"object"==typeof i)return O(i)?"[Array]":"[Object]";var a,l,u,c,h,A=function(e,t){var i;if("\t"===e.indent)i="\t";else{if(!("number"==typeof e.indent&&0<e.indent))return null;i=B.call(Array(e.indent+1)," ")}return{base:i,prev:B.call(Array(t+1),i)}}(s,n);if(void 0===o)o=[];else if(0<=H(o,i))return"[Circular]";function p(e,t,i){return t&&(o=X.call(o)).push(t),i?(t={depth:s.depth},U(s,"quoteStyle")&&(t.quoteStyle=s.quoteStyle),r(e,t,n+1,o)):r(e,s,n+1,o)}if("function"==typeof i)return"[Function"+((t=function(e){if(e.name)return e.name;e=Y.call(Z.call(e),/^function\s*([\w$]+)/);if(e)return e[1];return null}(i))?": "+t:" (anonymous)")+"]"+(0<(t=W(i,p)).length?" { "+B.call(t,", ")+" }":"");if(R(i))return t=S?x.call(String(i),/^(Symbol\(.*\))_[^)]*$/,"$1"):I.call(i),"object"!=typeof i||S?t:Q(t);if(function(e){if(!e||"object"!=typeof e)return;if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return 1;return"string"==typeof e.nodeName&&"function"==typeof e.getAttribute}(i)){for(var f="<"+b.call(String(i.nodeName)),d=i.attributes||[],g=0;g<d.length;g++)f+=" "+d[g].name+"="+N((a=d[g].value,x.call(String(a),/"/g,"&quot;")),"double",s);return f+=">",i.childNodes&&i.childNodes.length&&(f+="..."),f+="</"+b.call(String(i.nodeName))+">"}if(O(i))return 0===i.length?"[]":(t=W(i,p),A&&!function(e){for(var t=0;t<e.length;t++)if(0<=H(e[t],"\n"))return;return 1}(t)?"["+z(t,A)+"]":"[ "+B.call(t,", ")+" ]");if(!("[object Error]"!==k(t=i)||P&&"object"==typeof t&&P in t))return t=W(i,p),"cause"in i&&!T.call(i,"cause")?"{ ["+String(i)+"] "+B.call(E.call("[cause]: "+p(i.cause),t),", ")+" }":0===t.length?"["+String(i)+"]":"{ ["+String(i)+"] "+B.call(t,", ")+" }";if("object"==typeof i&&e){if(F&&"function"==typeof i[F])return i[F]();if("symbol"!==e&&"function"==typeof i.inspect)return i.inspect()}return function(e){if(m&&e&&"object"==typeof e)try{m.call(e);try{y.call(e)}catch(e){return 1}return e instanceof Map}catch(e){}return}(i)?(l=[],q.call(i,function(e,t){l.push(p(t,i,!0)+" => "+p(e,i))}),G("Map",m.call(i),l,A)):function(e){if(y&&e&&"object"==typeof e)try{y.call(e);try{m.call(e)}catch(e){return 1}return e instanceof Set}catch(e){}return}(i)?(u=[],K.call(i,function(e){u.push(p(e,i))}),G("Set",y.call(i),u,A)):function(e){if(_&&e&&"object"==typeof e)try{_.call(e,_);try{v.call(e,v)}catch(e){return 1}return e instanceof WeakMap}catch(e){}return}(i)?V("WeakMap"):function(e){if(v&&e&&"object"==typeof e)try{v.call(e,v);try{_.call(e,_)}catch(e){return 1}return e instanceof WeakSet}catch(e){}return}(i)?V("WeakSet"):function(e){if(C&&e&&"object"==typeof e)try{return C.call(e),1}catch(e){}return}(i)?V("WeakRef"):"[object Number]"!==k(t=i)||P&&"object"==typeof t&&P in t?function(e){if(e&&"object"==typeof e&&M)try{return M.call(e),1}catch(e){}return}(i)?Q(p(M.call(i))):"[object Boolean]"!==k(e=i)||P&&"object"==typeof e&&P in e?"[object String]"!==k(t=i)||P&&"object"==typeof t&&P in t?("[object Date]"!==k(e=i)||P&&"object"==typeof e&&P in e)&&("[object RegExp]"!==k(t=i)||P&&"object"==typeof t&&P in t)?(e=W(i,p),t=L?L(i)===Object.prototype:i instanceof Object||i.constructor===Object,c=i instanceof Object?"":"null prototype",h=!t&&P&&Object(i)===i&&P in i?w.call(k(i),8,-1):c?"Object":"",t=(!t&&"function"==typeof i.constructor&&i.constructor.name?i.constructor.name+" ":"")+(h||c?"["+B.call(E.call([],h||[],c||[]),": ")+"] ":""),0===e.length?t+"{}":A?t+"{"+z(e,A)+"}":t+"{ "+B.call(e,", ")+" }"):String(i):Q(p(String(i))):Q(j.call(i)):Q(p(Number(i)))};var l=Object.prototype.hasOwnProperty||function(e){return e in this};function U(e,t){return l.call(e,t)}function k(e){return s.call(e)}function H(e,t){if(e.indexOf)return e.indexOf(t);for(var i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1}function J(e){var e=e.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+a.call(e.toString(16))}function Q(e){return"Object("+e+")"}function V(e){return e+" { ? }"}function G(e,t,i,r){return e+" ("+t+") {"+(r?z(i,r):B.call(i,", "))+"}"}function z(e,t){var i;return 0===e.length?"":(i="\n"+t.prev+t.base)+B.call(e,","+i)+"\n"+t.prev}function W(e,t){var i=O(e),r=[];if(i){r.length=e.length;for(var n=0;n<e.length;n++)r[n]=U(e,n)?t(e[n],e):""}var o,s="function"==typeof h?h(e):[];if(S)for(var a={},l=0;l<s.length;l++)a["$"+s[l]]=s[l];for(o in e)!U(e,o)||i&&String(Number(o))===o&&o<e.length||S&&a["$"+o]instanceof Symbol||(c.call(/[^\w$]/,o)?r.push(t(o,e)+": "+t(e[o],e)):r.push(o+": "+t(e[o],e)));if("function"==typeof h)for(var u=0;u<s.length;u++)T.call(e,s[u])&&r.push("["+t(s[u])+"]: "+t(e[s[u]],e));return r}},9612:function(e,t,i){"use strict";e.exports=a;var r,n,o,s=i(2333);function a(e){e&&e.length&&(e=(t=e).length);var t,e=new Uint8Array(e||0);return t&&e.set(t),e.readUInt32LE=r.readUInt32LE,e.writeUInt32LE=r.writeUInt32LE,e.readInt32LE=r.readInt32LE,e.writeInt32LE=r.writeInt32LE,e.readFloatLE=r.readFloatLE,e.writeFloatLE=r.writeFloatLE,e.readDoubleLE=r.readDoubleLE,e.writeDoubleLE=r.writeDoubleLE,e.toString=r.toString,e.write=r.write,e.slice=r.slice,e.copy=r.copy,e._isBuffer=!0,e}function l(e){for(var t,i,r=e.length,n=[],o=0;o<r;o++){if(55295<(t=e.charCodeAt(o))&&t<57344){if(!i){56319<t||o+1===r?n.push(239,191,189):i=t;continue}if(t<56320){n.push(239,191,189),i=t;continue}t=i-55296<<10|t-56320|65536,i=null}else i&&(n.push(239,191,189),i=null);t<128?n.push(t):t<2048?n.push(t>>6|192,63&t|128):t<65536?n.push(t>>12|224,t>>6&63|128,63&t|128):n.push(t>>18|240,t>>12&63|128,t>>6&63|128,63&t|128)}return n}(r={readUInt32LE:function(e){return(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},writeUInt32LE:function(e,t){this[t]=e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24},readInt32LE:function(e){return(this[e]|this[e+1]<<8|this[e+2]<<16)+(this[e+3]<<24)},readFloatLE:function(e){return s.read(this,e,!0,23,4)},readDoubleLE:function(e){return s.read(this,e,!0,52,8)},writeFloatLE:function(e,t){return s.write(this,e,t,!0,23,4)},writeDoubleLE:function(e,t){return s.write(this,e,t,!0,52,8)},toString:function(e,t,i){var r="",n="";t=t||0,i=Math.min(this.length,i||this.length);for(var o=t;o<i;o++){var s=this[o];s<=127?(r+=decodeURIComponent(n)+String.fromCharCode(s),n=""):n+="%"+s.toString(16)}return r+=decodeURIComponent(n)},write:function(e,t){for(var i=e===n?o:l(e),r=0;r<i.length;r++)this[t+r]=i[r]},slice:function(e,t){return this.subarray(e,t)},copy:function(e,t){t=t||0;for(var i=0;i<this.length;i++)e[t+i]=this[i]}}).writeInt32LE=r.writeUInt32LE,a.byteLength=function(e){return(o=l(n=e)).length},a.isBuffer=function(e){return!(!e||!e._isBuffer)}},6642:function(e,t,i){"use strict";e.exports=n;var r=i.g.Buffer||i(9612);function n(e){this.buf=r.isBuffer(e)?e:new r(e||0),this.pos=0,this.length=this.buf.length}n.Varint=0,n.Fixed64=1,n.Bytes=2,n.Fixed32=5;var o=4294967296,s=1/o,a=Math.pow(2,63);function l(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function u(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function c(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function h(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function A(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function p(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function f(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function d(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function g(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}n.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=this.pos;e(r>>3,t,this),this.pos===n&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=this.buf.readUInt32LE(this.pos);return this.pos+=4,e},readSFixed32:function(){var e=this.buf.readInt32LE(this.pos);return this.pos+=4,e},readFixed64:function(){var e=this.buf.readUInt32LE(this.pos)+this.buf.readUInt32LE(this.pos+4)*o;return this.pos+=8,e},readSFixed64:function(){var e=this.buf.readUInt32LE(this.pos)+this.buf.readInt32LE(this.pos+4)*o;return this.pos+=8,e},readFloat:function(){var e=this.buf.readFloatLE(this.pos);return this.pos+=4,e},readDouble:function(){var e=this.buf.readDoubleLE(this.pos);return this.pos+=8,e},readVarint:function(){var e=this.buf,t=e[this.pos++],i=127&t;if(t<128)return i;if(i|=(127&(t=e[this.pos++]))<<7,t<128)return i;if(i|=(127&(t=e[this.pos++]))<<14,t<128)return i;if(i|=(127&(t=e[this.pos++]))<<21,t<128)return i;var r,e=i,t=this,i=t.buf;if(r=i[t.pos++],e+=268435456*(127&r),r<128)return e;if(r=i[t.pos++],e+=34359738368*(127&r),r<128)return e;if(r=i[t.pos++],e+=4398046511104*(127&r),r<128)return e;if(r=i[t.pos++],e+=562949953421312*(127&r),r<128)return e;if(r=i[t.pos++],e+=72057594037927940*(127&r),r<128)return e;if(r=i[t.pos++],e+=0x8000000000000000*(127&r),r<128)return e;throw new Error("Expected varint not more than 10 bytes")},readVarint64:function(){var e=this.pos;if((i=this.readVarint())<a)return i;for(var t=this.pos-2;255===this.buf[t];)t--;t<e&&(t=e);for(var i=0,r=0;r<t-e+1;r++){var n=127&~this.buf[e+r];i+=r<4?n<<7*r:n*Math.pow(2,7*r)}return-i-1},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.buf.toString("utf8",this.pos,e);return this.pos=e,t},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.slice(this.pos,e);return this.pos=e,t},readPackedVarint:function(){for(var e=this.readVarint()+this.pos,t=[];this.pos<e;)t.push(this.readVarint());return t},readPackedSVarint:function(){for(var e=this.readVarint()+this.pos,t=[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(){for(var e=this.readVarint()+this.pos,t=[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(){for(var e=this.readVarint()+this.pos,t=[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(){for(var e=this.readVarint()+this.pos,t=[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(){for(var e=this.readVarint()+this.pos,t=[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(){for(var e=this.readVarint()+this.pos,t=[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(){for(var e=this.readVarint()+this.pos,t=[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(){for(var e=this.readVarint()+this.pos,t=[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(e){e&=7;if(e===n.Varint)for(;127<this.buf[this.pos++];);else if(e===n.Bytes)this.pos=this.readVarint()+this.pos;else if(e===n.Fixed32)this.pos+=4;else{if(e!==n.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t,i=this.length||16;i<this.pos+e;)i*=2;i!==this.length&&(t=new r(i),this.buf.copy(t),this.buf=t,this.length=i)},finish:function(){return this.length=this.pos,this.pos=0,this.buf.slice(0,this.length)},writeFixed32:function(e){this.realloc(4),this.buf.writeUInt32LE(e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),this.buf.writeInt32LE(e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),this.buf.writeInt32LE(-1&e,this.pos),this.buf.writeUInt32LE(Math.floor(e*s),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),this.buf.writeInt32LE(-1&e,this.pos),this.buf.writeInt32LE(Math.floor(e*s),this.pos+4),this.pos+=8},writeVarint:function(e){if(268435455<(e=+e))for(var t=e,i=this,r=(i.realloc(10),i.pos+10);1<=t;){if(i.pos>=r)throw new Error("Given varint doesn't fit into 10 bytes");var n=255&t;i.buf[i.pos++]=n|(128<=t?128:0),t/=128}else this.realloc(4),this.buf[this.pos++]=127&e|(127<e?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(127<e?128:0),e<=127)||(this.buf[this.pos++]=127&(e>>>=7)|(127<e?128:0),e<=127)||(this.buf[this.pos++]=e>>>7&127)},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e);var t=r.byteLength(e);this.writeVarint(t),this.realloc(t),this.buf.write(e,this.pos),this.pos+=t},writeFloat:function(e){this.realloc(4),this.buf.writeFloatLE(e,this.pos),this.pos+=4},writeDouble:function(e){this.realloc(8),this.buf.writeDoubleLE(e,this.pos),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos,e=(e(t,this),this.pos-i);if(128<=e){var r=i,t=e,n=this,o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.ceil(Math.log(t)/(7*Math.LN2));n.realloc(o);for(var s=n.pos-1;r<=s;s--)n.buf[s+o]=n.buf[s]}this.pos=i-1,this.writeVarint(e),this.pos+=e},writeMessage:function(e,t,i){this.writeTag(e,n.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){this.writeMessage(e,l,t)},writePackedSVarint:function(e,t){this.writeMessage(e,u,t)},writePackedBoolean:function(e,t){this.writeMessage(e,A,t)},writePackedFloat:function(e,t){this.writeMessage(e,c,t)},writePackedDouble:function(e,t){this.writeMessage(e,h,t)},writePackedFixed32:function(e,t){this.writeMessage(e,p,t)},writePackedSFixed32:function(e,t){this.writeMessage(e,f,t)},writePackedFixed64:function(e,t){this.writeMessage(e,d,t)},writePackedSFixed64:function(e,t){this.writeMessage(e,g,t)},writeBytesField:function(e,t){this.writeTag(e,n.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,n.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,n.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,n.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,n.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,n.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,n.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,n.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,n.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,n.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}}},4492:function(e){"use strict";function t(e,t){this.x=e,this.y=t}(e.exports=t).prototype={clone:function(){return new t(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,e=e.y-this.y;return t*t+e*e},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,e=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=e,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),e=Math.sin(e),i=t*this.x-e*this.y,e=e*this.x+t*this.y;return this.x=i,this.y=e,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},t.convert=function(e){return!(e instanceof t)&&Array.isArray(e)?new t(e[0],e[1]):e}},5527:function(e){"use strict";var t=String.prototype.replace,i=/%20/g,r="RFC1738",n="RFC3986";e.exports={default:n,formatters:{RFC1738:function(e){return t.call(e,i,"+")},RFC3986:function(e){return String(e)}},RFC1738:r,RFC3986:n}},9126:function(e,t,i){"use strict";var r=i(6845),n=i(9166),i=i(5527);e.exports={formats:i,parse:n,stringify:r}},9166:function(e,t,i){"use strict";function l(e,t){var i,r,n,o,s={},e=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,a=t.parameterLimit===1/0?void 0:t.parameterLimit,l=e.split(t.delimiter,a),u=-1,c=t.charset;if(t.charsetSentinel)for(i=0;i<l.length;++i)0===l[i].indexOf("utf8=")&&("utf8=%E2%9C%93"===l[i]?c="utf-8":"utf8=%26%2310003%3B"===l[i]&&(c="iso-8859-1"),u=i,i=l.length);for(i=0;i<l.length;++i)i!==u&&((o=-1===(o=-1===(o=(r=l[i]).indexOf("]="))?r.indexOf("="):o+1)?(n=t.decoder(r,p.decoder,c,"key"),t.strictNullHandling?null:""):(n=t.decoder(r.slice(0,o),p.decoder,c,"key"),h.maybeMap(y(r.slice(o+1),t),function(e){return t.decoder(e,p.decoder,c,"value")})))&&t.interpretNumericEntities&&"iso-8859-1"===c&&(o=o.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})),-1<r.indexOf("[]=")&&(o=A(o)?[o]:o),m.call(s,n)?s[n]=h.combine(s[n],o):s[n]=o);return s}function u(e,t,i,r){if(e){var n=i.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,s=0<i.depth&&/(\[[^[\]]*])/.exec(n),e=s?n.slice(0,s.index):n,a=[];if(e){if(!i.plainObjects&&m.call(Object.prototype,e)&&!i.allowPrototypes)return;a.push(e)}for(var l=0;0<i.depth&&null!==(s=o.exec(n))&&l<i.depth;){if(l+=1,!i.plainObjects&&m.call(Object.prototype,s[1].slice(1,-1))&&!i.allowPrototypes)return;a.push(s[1])}s&&a.push("["+n.slice(s.index)+"]");for(var u=a,e=t,c=i,h=r?e:y(e,c),A=u.length-1;0<=A;--A){var p,f,d,g=u[A];"[]"===g&&c.parseArrays?p=[].concat(h):(p=c.plainObjects?Object.create(null):{},f="["===g.charAt(0)&&"]"===g.charAt(g.length-1)?g.slice(1,-1):g,d=parseInt(f,10),c.parseArrays||""!==f?!isNaN(d)&&g!==f&&String(d)===f&&0<=d&&c.parseArrays&&d<=c.arrayLimit?(p=[])[d]=h:"__proto__"!==f&&(p[f]=h):p={0:h}),h=p}return h}}var h=i(2493),m=Object.prototype.hasOwnProperty,A=Array.isArray,p={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:h.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},y=function(e,t){return e&&"string"==typeof e&&t.comma&&-1<e.indexOf(",")?e.split(","):e};e.exports=function(e,t){var i=function(e){if(!e)return p;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=(void 0===e.charset?p:e).charset;return{allowDots:void 0===e.allowDots?p.allowDots:!!e.allowDots,allowPrototypes:("boolean"==typeof e.allowPrototypes?e:p).allowPrototypes,allowSparse:("boolean"==typeof e.allowSparse?e:p).allowSparse,arrayLimit:("number"==typeof e.arrayLimit?e:p).arrayLimit,charset:t,charsetSentinel:("boolean"==typeof e.charsetSentinel?e:p).charsetSentinel,comma:("boolean"==typeof e.comma?e:p).comma,decoder:("function"==typeof e.decoder?e:p).decoder,delimiter:("string"==typeof e.delimiter||h.isRegExp(e.delimiter)?e:p).delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:p.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:("boolean"==typeof e.interpretNumericEntities?e:p).interpretNumericEntities,parameterLimit:("number"==typeof e.parameterLimit?e:p).parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:("boolean"==typeof e.plainObjects?e:p).plainObjects,strictNullHandling:("boolean"==typeof e.strictNullHandling?e:p).strictNullHandling}}(t);if(""===e||null==e)return i.plainObjects?Object.create(null):{};for(var r="string"==typeof e?l(e,i):e,n=i.plainObjects?Object.create(null):{},o=Object.keys(r),s=0;s<o.length;++s)var a=o[s],a=u(a,r[a],i,"string"==typeof e),n=h.merge(n,a,i);return!0===i.allowSparse?n:h.compact(n)}},6845:function(e,t,i){"use strict";function P(e,t){r.apply(e,F(t)?t:[t])}function T(e,t,i,r,n,o,s,a,l,u,c,h,A,p,f){for(var d=e,g=f,m=0,y=!1;void 0!==(g=g.get(R))&&!y;){var _=g.get(e);if(m+=1,void 0!==_){if(_===m)throw new RangeError("Cyclic object value");y=!0}void 0===g.get(R)&&(m=0)}if("function"==typeof s?d=s(t,d):d instanceof Date?d=u(d):"comma"===i&&F(d)&&(d=D.maybeMap(d,function(e){return e instanceof Date?u(e):e})),null===d){if(r)return o&&!A?o(t,O.encoder,p,"key",c):t;d=""}if("string"==typeof(v=d)||"number"==typeof v||"boolean"==typeof v||"symbol"==typeof v||"bigint"==typeof v||D.isBuffer(d)){if(o){var v=A?t:o(t,O.encoder,p,"key",c);if("comma"===i&&A){for(var C=N.call(String(d),","),w="",x=0;x<C.length;++x)w+=(0===x?"":",")+h(o(C[x],O.encoder,p,"value",c));return[h(v)+"="+w]}return[h(v)+"="+h(o(d,O.encoder,p,"value",c))]}return[h(t)+"="+h(String(d))]}var b,E=[];if(void 0!==d){b="comma"===i&&F(d)?[{value:0<d.length?d.join(",")||null:void 0}]:F(s)?s:(v=Object.keys(d),a?v.sort(a):v);for(var B=0;B<b.length;++B){var M,I=b[B],S="object"==typeof I&&void 0!==I.value?I.value:d[I];n&&null===S||(I=F(d)?"function"==typeof i?i(t,I):t:t+(l?"."+I:"["+I+"]"),f.set(e,m),(M=L()).set(R,f),P(E,T(S,I,i,r,n,o,s,a,l,u,c,h,A,p,M)))}}return E}var L=i(4294),D=i(2493),c=i(5527),h=Object.prototype.hasOwnProperty,A={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},F=Array.isArray,N=String.prototype.split,r=Array.prototype.push,n=Date.prototype.toISOString,i=c.default,O={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:D.encode,encodeValuesOnly:!1,format:i,formatter:c.formatters[i],indices:!1,serializeDate:function(e){return n.call(e)},skipNulls:!1,strictNullHandling:!1},R={};e.exports=function(e,t){var i=e,r=function(e){if(!e)return O;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||O.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=c.default;if(void 0!==e.format){if(!h.call(c.formatters,e.format))throw new TypeError("Unknown format option provided.");i=e.format}var r=c.formatters[i],n=O.filter;return"function"!=typeof e.filter&&!F(e.filter)||(n=e.filter),{addQueryPrefix:("boolean"==typeof e.addQueryPrefix?e:O).addQueryPrefix,allowDots:void 0===e.allowDots?O.allowDots:!!e.allowDots,charset:t,charsetSentinel:("boolean"==typeof e.charsetSentinel?e:O).charsetSentinel,delimiter:(void 0===e.delimiter?O:e).delimiter,encode:("boolean"==typeof e.encode?e:O).encode,encoder:("function"==typeof e.encoder?e:O).encoder,encodeValuesOnly:("boolean"==typeof e.encodeValuesOnly?e:O).encodeValuesOnly,filter:n,format:i,formatter:r,serializeDate:("function"==typeof e.serializeDate?e:O).serializeDate,skipNulls:("boolean"==typeof e.skipNulls?e:O).skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:("boolean"==typeof e.strictNullHandling?e:O).strictNullHandling}}(t),n=("function"==typeof r.filter?i=(0,r.filter)("",i):F(r.filter)&&(s=r.filter),[]);if("object"!=typeof i||null===i)return"";var e=t&&t.arrayFormat in A?t.arrayFormat:!(t&&"indices"in t)||t.indices?"indices":"repeat",o=A[e],s=s||Object.keys(i);r.sort&&s.sort(r.sort);for(var a=L(),l=0;l<s.length;++l){var u=s[l];r.skipNulls&&null===i[u]||P(n,T(i[u],u,o,r.strictNullHandling,r.skipNulls,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,a))}t=n.join(r.delimiter),e=!0===r.addQueryPrefix?"?":"";return r.charsetSentinel&&("iso-8859-1"===r.charset?e+="utf8=%26%2310003%3B&":e+="utf8=%E2%9C%93&"),0<t.length?e+t:""}},2493:function(e,t,i){"use strict";function a(e,t){for(var i=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)void 0!==e[r]&&(i[r]=e[r]);return i}var u=i(5527),l=Object.prototype.hasOwnProperty,d=Array.isArray,c=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}();e.exports={arrayToObject:a,assign:function(e,i){return Object.keys(i).reduce(function(e,t){return e[t]=i[t],e},e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],i=[],r=0;r<t.length;++r)for(var n=t[r],o=n.obj[n.prop],s=Object.keys(o),a=0;a<s.length;++a){var l=s[a],u=o[l];"object"==typeof u&&null!==u&&-1===i.indexOf(u)&&(t.push({obj:o,prop:l}),i.push(u))}for(var c=t;1<c.length;){var h=c.pop(),A=h.obj[h.prop];if(d(A)){for(var p=[],f=0;f<A.length;++f)void 0!==A[f]&&p.push(A[f]);h.obj[h.prop]=p}}return e},decode:function(t,e,i){t=t.replace(/\+/g," ");if("iso-8859-1"===i)return t.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(t)}catch(e){return t}},encode:function(e,t,i,r,n){if(0===e.length)return e;var o=e;if("symbol"==typeof e?o=Symbol.prototype.toString.call(e):"string"!=typeof e&&(o=String(e)),"iso-8859-1"===i)return escape(o).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});for(var s="",a=0;a<o.length;++a){var l=o.charCodeAt(a);45===l||46===l||95===l||126===l||48<=l&&l<=57||65<=l&&l<=90||97<=l&&l<=122||n===u.RFC1738&&(40===l||41===l)?s+=o.charAt(a):l<128?s+=c[l]:l<2048?s+=c[192|l>>6]+c[128|63&l]:l<55296||57344<=l?s+=c[224|l>>12]+c[128|l>>6&63]+c[128|63&l]:(a+=1,l=65536+((1023&l)<<10|1023&o.charCodeAt(a)),s+=c[240|l>>18]+c[128|l>>12&63]+c[128|l>>6&63]+c[128|63&l])}return s},isBuffer:function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(d(e)){for(var i=[],r=0;r<e.length;r+=1)i.push(t(e[r]));return i}return t(e)},merge:function r(n,o,s){if(!o)return n;if("object"!=typeof o){if(d(n))n.push(o);else{if(!n||"object"!=typeof n)return[n,o];(s&&(s.plainObjects||s.allowPrototypes)||!l.call(Object.prototype,o))&&(n[o]=!0)}return n}var e;return n&&"object"==typeof n?(d(e=n)&&!d(o)&&(e=a(n,s)),d(n)&&d(o)?(o.forEach(function(e,t){var i;l.call(n,t)?(i=n[t])&&"object"==typeof i&&e&&"object"==typeof e?n[t]=r(i,e,s):n.push(e):n[t]=e}),n):Object.keys(o).reduce(function(e,t){var i=o[t];return l.call(e,t)?e[t]=r(e[t],i,s):e[t]=i,e},e)):[n].concat(o)}}},3006:function(e,t,n){e.exports=function r(n,o,s){function a(t,e){if(!o[t]){var i;if(!n[t])throw(i=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",i;i=o[t]={exports:{}},n[t][0].call(i.exports,function(e){return a(n[t][1][e]||e)},i,i.exports,r,n,o,s)}return o[t].exports}for(var e=0;e<s.length;e++)a(s[e]);return a}({1:[function(e,t,i){"use strict";const r=e("lie"),s=e("./combine"),a=e("buffer").Buffer;t.exports=function(n,o){return new r(function(e,t){var i=s(n,o);const r=new XMLHttpRequest;r.open("GET",i,!0),"prj"!==o&&"cpg"!==o&&(r.responseType="arraybuffer"),r.addEventListener("load",function(){return 399<r.status?"prj"===o||"cpg"===o?e(!1):t(new Error(r.status)):e("prj"!==o&&"cpg"!==o?a.from(r.response):r.response)},!1),r.send()})}},{"./combine":3,buffer:8,lie:12}],2:[function(e,t,i){!function(l){!function(){"use strict";const o=e("./binaryajax-browser"),s=e("./combine"),a=e("buffer").Buffer;t.exports=async function(e,t){if(!l.fetch)return o(e,t);var e=s(e,t),i="prj"===t||"cpg"===t;try{var r,n=await fetch(e);if(399<n.status)throw new Error(n.statusText);return i?n.text():(r=await n.arrayBuffer(),a.from(r))}catch(e){if(console.log("ERROR",e,t),i||"dbf"===t)return!1;throw e}}}.call(this)}.call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./binaryajax-browser":1,"./combine":3,buffer:8}],3:[function(e,t,i){!function(e){!function(){const r=e.URL;t.exports=(e,t)=>{var i;return t?((i=new r(e)).pathname=i.pathname+"."+t,i.href):e}}.call(this)}.call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(e,t,i){"use strict";function r(e,t){return!function(e){let t=0,i=1;var r=e.length;let n,o;for(;i<r;)n=o||e[0],o=e[i],t+=(o[0]-n[0])*(o[1]+n[1]),i++;return 0<t}(t)&&e.length?e[e.length-1].push(t):e.push([t]),e}o.prototype.parsePoint=function(e){return{type:"Point",coordinates:this.parseCoord(e,0)}},o.prototype.parseZPoint=function(e){var t=this.parsePoint(e);return t.coordinates.push(e.readDoubleLE(16)),t},o.prototype.parsePointArray=function(e,t,i){var r=[];let n=0;for(;n<i;)r.push(this.parseCoord(e,t)),t+=16,n++;return r},o.prototype.parseZPointArray=function(e,t,i,r){let n=0;for(;n<i;)r[n].push(e.readDoubleLE(t)),n++,t+=8;return r},o.prototype.parseArrayGroup=function(e,t,i,r,n){var o,s=[];let a=0,l=0;for(;a<r;)a++,i+=4,o=l,(o=(l=a===r?n:e.readInt32LE(i))-o)&&(s.push(this.parsePointArray(e,t,o)),t+=o<<4);return s},o.prototype.parseZArrayGroup=function(e,t,i,r){let n=0;for(;n<i;)r[n]=this.parseZPointArray(e,t,r[n].length,r[n]),t+=r[n].length<<3,n++;return r},o.prototype.parseMultiPoint=function(e){var t,i,r={},n=e.readInt32LE(32,!0);return n?(t=this.parseCoord(e,0),i=this.parseCoord(e,16),r.bbox=[t[0],t[1],i[0],i[1]],1===n?(r.type="Point",r.coordinates=this.parseCoord(e,36)):(r.type="MultiPoint",r.coordinates=this.parsePointArray(e,36,n)),r):null},o.prototype.parseZMultiPoint=function(e){var t,i=this.parseMultiPoint(e);if(!i)return null;let r;return"Point"===i.type?i.coordinates.push(e.readDoubleLE(72)):(t=52+((r=i.coordinates.length)<<4),i.coordinates=this.parseZPointArray(e,t,r,i.coordinates)),i},o.prototype.parsePolyline=function(e){var t={},i=e.readInt32LE(32);if(!i)return null;var r=this.parseCoord(e,0),n=this.parseCoord(e,16),r=(t.bbox=[r[0],r[1],n[0],n[1]],e.readInt32LE(36));let o;return 1===i?(t.type="LineString",o=44,t.coordinates=this.parsePointArray(e,o,r)):(t.type="MultiLineString",o=40+(i<<2),t.coordinates=this.parseArrayGroup(e,o,40,i,r)),t},o.prototype.parseZPolyline=function(e){var t=this.parsePolyline(e);if(!t)return null;var i,r=t.coordinates.length;let n;return"LineString"===t.type?(n=60+(r<<4),t.coordinates=this.parseZPointArray(e,n,r,t.coordinates)):(i=t.coordinates.reduce(function(e,t){return e+t.length},0),n=56+(i<<4)+(r<<2),t.coordinates=this.parseZArrayGroup(e,n,r,t.coordinates)),t},o.prototype.polyFuncs=function(e){return e&&("LineString"===e.type?(e.type="Polygon",e.coordinates=[e.coordinates]):(e.coordinates=e.coordinates.reduce(r,[]),1===e.coordinates.length?(e.type="Polygon",e.coordinates=e.coordinates[0]):e.type="MultiPolygon")),e},o.prototype.parsePolygon=function(e){return this.polyFuncs(this.parsePolyline(e))},o.prototype.parseZPolygon=function(e){return this.polyFuncs(this.parseZPolyline(e))};const n={1:"parsePoint",3:"parsePolyline",5:"parsePolygon",8:"parseMultiPoint",11:"parseZPoint",13:"parseZPolyline",15:"parseZPolygon",18:"parseZMultiPoint"};function o(e,t){if(!(this instanceof o))return new o(e,t);this.buffer=e,this.headers=this.parseHeader(),this.headers.length<this.buffer.byteLength&&(this.buffer=this.buffer.slice(0,this.headers.length)),this.shpFuncs(t),this.rows=this.getRows()}o.prototype.shpFuncs=function(e){let t=this.headers.shpCode;if(20<t&&(t-=20),!(t in n))throw new Error("I don't know that shp type");var i;this.parseFunc=this[n[t]],this.parseCoord=(i=e)?function(e,t){e=[e.readDoubleLE(t),e.readDoubleLE(t+8)];return i.inverse(e)}:function(e,t){return[e.readDoubleLE(t),e.readDoubleLE(t+8)]}},o.prototype.getShpCode=function(){return this.parseHeader().shpCode},o.prototype.parseHeader=function(){var e=this.buffer.slice(0,100);return{length:e.readInt32BE(24)<<1,version:e.readInt32LE(28),shpCode:e.readInt32LE(32),bbox:[e.readDoubleLE(36),e.readDoubleLE(44),e.readDoubleLE(52),e.readDoubleLE(52)]}},o.prototype.getRows=function(){let e=100;for(var t,i=this.buffer.byteLength,r=[];e<i&&(t=this.getRow(e));)e=(e+=8)+t.len,t.type?r.push(this.parseFunc(t.data)):r.push(null);return r},o.prototype.getRow=function(e){var t=this.buffer.slice(e,e+12),i=t.readInt32BE(4)<<1,r=t.readInt32BE(0);return 0==i?{id:r,len:i,type:0}:{id:r,len:i,data:this.buffer.slice(e+12,e+i+8),type:t.readInt32LE(8)}},t.exports=function(e,t){return new o(e,t).rows}},{}],5:[function(e,t,i){"use strict";const r=e("jszip");t.exports=async e=>{var t=new r,e=(await t.loadAsync(e),t.file(/.+/));const i={};return await Promise.all(e.map(async e=>{let t;t="shp"===e.name.slice(-3).toLowerCase()||"dbf"===e.name.slice(-3).toLowerCase()?await e.async("nodebuffer"):await e.async("text"),i[e.name]=t})),i}},{jszip:11}],6:[function(e,t,i){"use strict";i.byteLength=function(e){var e=c(e),t=e[0],e=e[1];return 3*(t+e)/4-e},i.toByteArray=function(e){var t,i,r=c(e),n=r[0],r=r[1],o=new u(function(e,t){return 3*(e+t)/4-t}(n,r)),s=0,a=0<r?n-4:n;for(i=0;i<a;i+=4)t=l[e.charCodeAt(i)]<<18|l[e.charCodeAt(i+1)]<<12|l[e.charCodeAt(i+2)]<<6|l[e.charCodeAt(i+3)],o[s++]=t>>16&255,o[s++]=t>>8&255,o[s++]=255&t;2===r&&(t=l[e.charCodeAt(i)]<<2|l[e.charCodeAt(i+1)]>>4,o[s++]=255&t);1===r&&(t=l[e.charCodeAt(i)]<<10|l[e.charCodeAt(i+1)]<<4|l[e.charCodeAt(i+2)]>>2,o[s++]=t>>8&255,o[s++]=255&t);return o},i.fromByteArray=function(e){for(var t,i=e.length,r=i%3,n=[],o=0,s=i-r;o<s;o+=16383)n.push(function(e,t,i){for(var r,n=[],o=t;o<i;o+=3)r=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),n.push(function(e){return a[e>>18&63]+a[e>>12&63]+a[e>>6&63]+a[63&e]}(r));return n.join("")}(e,o,s<o+16383?s:o+16383));1==r?(t=e[i-1],n.push(a[t>>2]+a[t<<4&63]+"==")):2==r&&(t=(e[i-2]<<8)+e[i-1],n.push(a[t>>10]+a[t>>4&63]+a[t<<2&63]+"="));return n.join("")};for(var a=[],l=[],u="undefined"!=typeof Uint8Array?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,o=r.length;n<o;++n)a[n]=r[n],l[r.charCodeAt(n)]=n;function c(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");e=e.indexOf("="),t=(e=-1===e?t:e)===t?0:4-e%4;return[e,t]}l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},{}],7:[function(e,t,i){},{}],8:[function(T,e,L){!function(e){!function(){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
"use strict";var b=T("base64-js"),o=T("ieee754"),t=(L.Buffer=h,L.SlowBuffer=function(e){+e!=e&&(e=0);return h.alloc(+e)},L.INSPECT_MAX_BYTES=50,2147483647);function l(e){if(t<e)throw new RangeError('The value "'+e+'" is invalid for option "size"');e=new Uint8Array(e);return e.__proto__=h.prototype,e}function h(e,t,i){if("number"!=typeof e)return r(e,t,i);if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return s(e)}function r(e,t,i){if("string"==typeof e){var r=e,n=t;if(h.isEncoding(n="string"==typeof n&&""!==n?n:"utf8"))return o=0|A(r,n),s=l(o),s=(r=s.write(r,n))!==o?s.slice(0,r):s;throw new TypeError("Unknown encoding: "+n)}if(ArrayBuffer.isView(e))return u(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(S(e,ArrayBuffer)||e&&S(e.buffer,ArrayBuffer)){var o=e,r=t,s=i;if(r<0||o.byteLength<r)throw new RangeError('"offset" is outside of buffer bounds');if(o.byteLength<r+(s||0))throw new RangeError('"length" is outside of buffer bounds');return(o=void 0===r&&void 0===s?new Uint8Array(o):void 0===s?new Uint8Array(o,r):new Uint8Array(o,r,s)).__proto__=h.prototype,o}if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return h.from(n,t,i);var a=function(e){{var t,i;if(h.isBuffer(e))return t=0|c(e.length),0!==(i=l(t)).length&&e.copy(i,0,0,t),i}if(void 0!==e.length)return"number"!=typeof e.length||P(e.length)?l(0):u(e);if("Buffer"===e.type&&Array.isArray(e.data))return u(e.data)}(e);if(a)return a;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return h.from(e[Symbol.toPrimitive]("string"),t,i);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function n(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function s(e){return n(e),l(e<0?0:0|c(e))}function u(e){for(var t=e.length<0?0:0|c(e.length),i=l(t),r=0;r<t;r+=1)i[r]=255&e[r];return i}function c(e){if(t<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+t.toString(16)+" bytes");return 0|e}function A(e,t){if(h.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||S(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var i=e.length,r=2<arguments.length&&!0===arguments[2];if(!r&&0===i)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return M(e).length;default:if(n)return r?-1:B(e).length;t=(""+t).toLowerCase(),n=!0}}function i(e,t,i){var r,n=!1;if((t=void 0===t||t<0?0:t)>this.length)return"";if((i=void 0===i||i>this.length?this.length:i)<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":var o=this,s=t,a=i,l=o.length;(!a||a<0||l<a)&&(a=l);for(var u="",c=s=!s||s<0?0:s;c<a;++c)u+=function(e){return e<16?"0"+e.toString(16):e.toString(16)}(o[c]);return u;case"utf8":case"utf-8":return E(this,t,i);case"ascii":var h=this,l=t,A=i,p="";A=Math.min(h.length,A);for(var f=l;f<A;++f)p+=String.fromCharCode(127&h[f]);return p;case"latin1":case"binary":var d=this,s=t,g=i,m="";g=Math.min(d.length,g);for(var y=s;y<g;++y)m+=String.fromCharCode(d[y]);return m;case"base64":return _=this,r=i,0===(v=t)&&r===_.length?b.fromByteArray(_):b.fromByteArray(_.slice(v,r));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":for(var _=t,v=i,C=this.slice(_,v),w="",x=0;x<C.length;x+=2)w+=String.fromCharCode(C[x]+256*C[x+1]);return w;default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function a(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function p(e,t,i,r,n){if(0===e.length)return-1;if("string"==typeof i?(r=i,i=0):2147483647<i?i=2147483647:i<-2147483648&&(i=-2147483648),(i=(i=P(i=+i)?n?0:e.length-1:i)<0?e.length+i:i)>=e.length){if(n)return-1;i=e.length-1}else if(i<0){if(!n)return-1;i=0}if("string"==typeof t&&(t=h.from(t,r)),h.isBuffer(t))return 0===t.length?-1:f(e,t,i,r,n);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?(n?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,t,i):f(e,[t],i,r,n);throw new TypeError("val must be string, number or Buffer")}function f(e,t,i,r,n){var o=1,s=e.length,a=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s/=o=2,a/=2,i/=2}function l(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(n)for(var u=-1,c=i;c<s;c++)if(l(e,c)===l(t,-1===u?0:c-u)){if(c-(u=-1===u?c:u)+1===a)return u*o}else-1!==u&&(c-=c-u),u=-1;else for(c=i=s<i+a?s-a:i;0<=c;c--){for(var h=!0,A=0;A<a;A++)if(l(e,c+A)!==l(t,A)){h=!1;break}if(h)return c}return-1}function g(e,t,i,r){return I(function(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,r)}function m(e,t,i,r){return I(function(e,t){for(var i,r,n=[],o=0;o<e.length&&!((t-=2)<0);++o)i=e.charCodeAt(o),r=i>>8,n.push(i%256),n.push(r);return n}(t,e.length-i),e,i,r)}function E(e,t,i){i=Math.min(e.length,i);for(var r=[],n=t;n<i;){var o,s,a,l,u=e[n],c=null,h=239<u?4:223<u?3:191<u?2:1;if(n+h<=i)switch(h){case 1:u<128&&(c=u);break;case 2:128==(192&(o=e[n+1]))&&127<(l=(31&u)<<6|63&o)&&(c=l);break;case 3:o=e[n+1],s=e[n+2],128==(192&o)&&128==(192&s)&&2047<(l=(15&u)<<12|(63&o)<<6|63&s)&&(l<55296||57343<l)&&(c=l);break;case 4:o=e[n+1],s=e[n+2],a=e[n+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&65535<(l=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)&&l<1114112&&(c=l)}null===c?(c=65533,h=1):65535<c&&(r.push((c-=65536)>>>10&1023|55296),c=56320|1023&c),r.push(c),n+=h}var A=r,p=A.length;if(p<=y)return String.fromCharCode.apply(String,A);for(var f="",d=0;d<p;)f+=String.fromCharCode.apply(String,A.slice(d,d+=y));return f}L.kMaxLength=t,(h.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(h.prototype,"parent",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.buffer}}),Object.defineProperty(h.prototype,"offset",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),h.poolSize=8192,h.from=r,h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,h.alloc=function(e,t,i){return t=t,i=i,n(e=e),!(e<=0)&&void 0!==t?"string"==typeof i?l(e).fill(t,i):l(e).fill(t):l(e)},h.allocUnsafe=s,h.allocUnsafeSlow=s,h.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==h.prototype},h.compare=function(e,t){if(S(e,Uint8Array)&&(e=h.from(e,e.offset,e.byteLength)),S(t,Uint8Array)&&(t=h.from(t,t.offset,t.byteLength)),!h.isBuffer(e)||!h.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var i=e.length,r=t.length,n=0,o=Math.min(i,r);n<o;++n)if(e[n]!==t[n]){i=e[n],r=t[n];break}return i<r?-1:r<i?1:0},h.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return h.alloc(0);if(void 0===t)for(n=t=0;n<e.length;++n)t+=e[n].length;for(var i=h.allocUnsafe(t),r=0,n=0;n<e.length;++n){var o=e[n];if(S(o,Uint8Array)&&(o=h.from(o)),!h.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,r),r+=o.length}return i},h.byteLength=A,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)a(this,t,t+1);return this},h.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)a(this,t,t+3),a(this,t+1,t+2);return this},h.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)a(this,t,t+7),a(this,t+1,t+6),a(this,t+2,t+5),a(this,t+3,t+4);return this},h.prototype.toLocaleString=h.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?E(this,0,e):i.apply(this,arguments)},h.prototype.equals=function(e){if(h.isBuffer(e))return this===e||0===h.compare(this,e);throw new TypeError("Argument must be a Buffer")},h.prototype.inspect=function(){var e="",t=L.INSPECT_MAX_BYTES,e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim();return this.length>t&&(e+=" ... "),"<Buffer "+e+">"},h.prototype.compare=function(e,t,i,r,n){if(S(e,Uint8Array)&&(e=h.from(e,e.offset,e.byteLength)),!h.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===i&&(i=e?e.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),(t=void 0===t?0:t)<0||i>e.length||r<0||n>this.length)throw new RangeError("out of range index");if(n<=r&&i<=t)return 0;if(n<=r)return-1;if(i<=t)return 1;if(this===e)return 0;for(var o=(n>>>=0)-(r>>>=0),s=(i>>>=0)-(t>>>=0),a=Math.min(o,s),l=this.slice(r,n),u=e.slice(t,i),c=0;c<a;++c)if(l[c]!==u[c]){o=l[c],s=u[c];break}return o<s?-1:s<o?1:0},h.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},h.prototype.indexOf=function(e,t,i){return p(this,e,t,i,!0)},h.prototype.lastIndexOf=function(e,t,i){return p(this,e,t,i,!1)},h.prototype.write=function(e,t,i,r){if(void 0===t)r="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)r=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(i)?(i>>>=0,void 0===r&&(r="utf8")):(r=i,i=void 0)}var n=this.length-t;if((void 0===i||n<i)&&(i=n),0<e.length&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r=r||"utf8";for(var o,s,a,l=!1;;)switch(r){case"hex":var u=this,c=e,h=t,A=i,p=(h=Number(h)||0,u.length-h);(!A||p<(A=Number(A)))&&(A=p),(p=c.length)/2<A&&(A=p/2);for(var f=0;f<A;++f){var d=parseInt(c.substr(2*f,2),16);if(P(d))return f;u[h+f]=d}return f;case"utf8":case"utf-8":return p=t,a=i,I(B(e,(s=this).length-p),s,p,a);case"ascii":return g(this,e,t,i);case"latin1":case"binary":return g(this,e,t,i);case"base64":return s=this,a=t,o=i,I(M(e),s,a,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return m(this,e,t,i);default:if(l)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),l=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var y=4096;function d(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(i<e+t)throw new RangeError("Trying to access beyond buffer length")}function _(e,t,i,r,n,o){if(!h.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(n<t||t<o)throw new RangeError('"value" argument is out of bounds');if(i+r>e.length)throw new RangeError("Index out of range")}function v(e,t,i,r){if(i+r>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function C(e,t,i,r,n){return t=+t,i>>>=0,n||v(e,0,i,4),o.write(e,t,i,r,23,4),i+4}function w(e,t,i,r,n){return t=+t,i>>>=0,n||v(e,0,i,8),o.write(e,t,i,r,52,8),i+8}h.prototype.slice=function(e,t){var i=this.length,i=((e=~~e)<0?(e+=i)<0&&(e=0):i<e&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):i<t&&(t=i),t<e&&(t=e),this.subarray(e,t));return i.__proto__=h.prototype,i},h.prototype.readUIntLE=function(e,t,i){e>>>=0,t>>>=0,i||d(e,t,this.length);for(var r=this[e],n=1,o=0;++o<t&&(n*=256);)r+=this[e+o]*n;return r},h.prototype.readUIntBE=function(e,t,i){e>>>=0,t>>>=0,i||d(e,t,this.length);for(var r=this[e+--t],n=1;0<t&&(n*=256);)r+=this[e+--t]*n;return r},h.prototype.readUInt8=function(e,t){return e>>>=0,t||d(e,1,this.length),this[e]},h.prototype.readUInt16LE=function(e,t){return e>>>=0,t||d(e,2,this.length),this[e]|this[e+1]<<8},h.prototype.readUInt16BE=function(e,t){return e>>>=0,t||d(e,2,this.length),this[e]<<8|this[e+1]},h.prototype.readUInt32LE=function(e,t){return e>>>=0,t||d(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},h.prototype.readUInt32BE=function(e,t){return e>>>=0,t||d(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},h.prototype.readIntLE=function(e,t,i){e>>>=0,t>>>=0,i||d(e,t,this.length);for(var r=this[e],n=1,o=0;++o<t&&(n*=256);)r+=this[e+o]*n;return(n*=128)<=r&&(r-=Math.pow(2,8*t)),r},h.prototype.readIntBE=function(e,t,i){e>>>=0,t>>>=0,i||d(e,t,this.length);for(var r=t,n=1,o=this[e+--r];0<r&&(n*=256);)o+=this[e+--r]*n;return(n*=128)<=o&&(o-=Math.pow(2,8*t)),o},h.prototype.readInt8=function(e,t){return e>>>=0,t||d(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},h.prototype.readInt16LE=function(e,t){e>>>=0,t||d(e,2,this.length);t=this[e]|this[e+1]<<8;return 32768&t?4294901760|t:t},h.prototype.readInt16BE=function(e,t){e>>>=0,t||d(e,2,this.length);t=this[e+1]|this[e]<<8;return 32768&t?4294901760|t:t},h.prototype.readInt32LE=function(e,t){return e>>>=0,t||d(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},h.prototype.readInt32BE=function(e,t){return e>>>=0,t||d(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},h.prototype.readFloatLE=function(e,t){return e>>>=0,t||d(e,4,this.length),o.read(this,e,!0,23,4)},h.prototype.readFloatBE=function(e,t){return e>>>=0,t||d(e,4,this.length),o.read(this,e,!1,23,4)},h.prototype.readDoubleLE=function(e,t){return e>>>=0,t||d(e,8,this.length),o.read(this,e,!0,52,8)},h.prototype.readDoubleBE=function(e,t){return e>>>=0,t||d(e,8,this.length),o.read(this,e,!1,52,8)},h.prototype.writeUIntLE=function(e,t,i,r){e=+e,t>>>=0,i>>>=0,r||_(this,e,t,i,Math.pow(2,8*i)-1,0);var n=1,o=0;for(this[t]=255&e;++o<i&&(n*=256);)this[t+o]=e/n&255;return t+i},h.prototype.writeUIntBE=function(e,t,i,r){e=+e,t>>>=0,i>>>=0,r||_(this,e,t,i,Math.pow(2,8*i)-1,0);var n=i-1,o=1;for(this[t+n]=255&e;0<=--n&&(o*=256);)this[t+n]=e/o&255;return t+i},h.prototype.writeUInt8=function(e,t,i){return e=+e,t>>>=0,i||_(this,e,t,1,255,0),this[t]=255&e,t+1},h.prototype.writeUInt16LE=function(e,t,i){return e=+e,t>>>=0,i||_(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},h.prototype.writeUInt16BE=function(e,t,i){return e=+e,t>>>=0,i||_(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},h.prototype.writeUInt32LE=function(e,t,i){return e=+e,t>>>=0,i||_(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},h.prototype.writeUInt32BE=function(e,t,i){return e=+e,t>>>=0,i||_(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},h.prototype.writeIntLE=function(e,t,i,r){e=+e,t>>>=0,r||_(this,e,t,i,(r=Math.pow(2,8*i-1))-1,-r);var n=0,o=1,s=0;for(this[t]=255&e;++n<i&&(o*=256);)e<0&&0===s&&0!==this[t+n-1]&&(s=1),this[t+n]=(e/o>>0)-s&255;return t+i},h.prototype.writeIntBE=function(e,t,i,r){e=+e,t>>>=0,r||_(this,e,t,i,(r=Math.pow(2,8*i-1))-1,-r);var n=i-1,o=1,s=0;for(this[t+n]=255&e;0<=--n&&(o*=256);)e<0&&0===s&&0!==this[t+n+1]&&(s=1),this[t+n]=(e/o>>0)-s&255;return t+i},h.prototype.writeInt8=function(e,t,i){return e=+e,t>>>=0,i||_(this,e,t,1,127,-128),this[t]=255&(e=e<0?255+e+1:e),t+1},h.prototype.writeInt16LE=function(e,t,i){return e=+e,t>>>=0,i||_(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},h.prototype.writeInt16BE=function(e,t,i){return e=+e,t>>>=0,i||_(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},h.prototype.writeInt32LE=function(e,t,i){return e=+e,t>>>=0,i||_(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},h.prototype.writeInt32BE=function(e,t,i){return e=+e,t>>>=0,i||_(this,e,t,4,2147483647,-2147483648),this[t]=(e=e<0?4294967295+e+1:e)>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},h.prototype.writeFloatLE=function(e,t,i){return C(this,e,t,!0,i)},h.prototype.writeFloatBE=function(e,t,i){return C(this,e,t,!1,i)},h.prototype.writeDoubleLE=function(e,t,i){return w(this,e,t,!0,i)},h.prototype.writeDoubleBE=function(e,t,i){return w(this,e,t,!1,i)},h.prototype.copy=function(e,t,i,r){if(!h.isBuffer(e))throw new TypeError("argument should be a Buffer");if(i=i||0,r||0===r||(r=this.length),t>=e.length&&(t=e.length),(r=0<r&&r<i?i:r)===i)return 0;if(0===e.length||0===this.length)return 0;if((t=t||0)<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length);var n=(r=e.length-t<r-i?e.length-t+i:r)-i;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,i,r);else if(this===e&&i<t&&t<r)for(var o=n-1;0<=o;--o)e[o+t]=this[o+i];else Uint8Array.prototype.set.call(e,this.subarray(i,r),t);return n},h.prototype.fill=function(e,t,i,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,i=this.length):"string"==typeof i&&(r=i,i=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!h.isEncoding(r))throw new TypeError("Unknown encoding: "+r);var n;1===e.length&&(n=e.charCodeAt(0),"utf8"===r&&n<128||"latin1"===r)&&(e=n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");var o;if(!(i<=t))if(t>>>=0,i=void 0===i?this.length:i>>>0,"number"==typeof(e=e||0))for(o=t;o<i;++o)this[o]=e;else{var s=h.isBuffer(e)?e:h.from(e,r),a=s.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<i-t;++o)this[o+t]=s[o%a]}return this};var x=/[^+/0-9A-Za-z-_]/g;function B(e,t){t=t||1/0;for(var i,r=e.length,n=null,o=[],s=0;s<r;++s){if(55295<(i=e.charCodeAt(s))&&i<57344){if(!n){if(56319<i){-1<(t-=3)&&o.push(239,191,189);continue}if(s+1===r){-1<(t-=3)&&o.push(239,191,189);continue}n=i;continue}if(i<56320){-1<(t-=3)&&o.push(239,191,189),n=i;continue}i=65536+(n-55296<<10|i-56320)}else n&&-1<(t-=3)&&o.push(239,191,189);if(n=null,i<128){if(--t<0)break;o.push(i)}else if(i<2048){if((t-=2)<0)break;o.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;o.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return o}function M(e){return b.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(x,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function I(e,t,i,r){for(var n=0;n<r&&!(n+i>=t.length||n>=e.length);++n)t[n+i]=e[n];return n}function S(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function P(e){return e!=e}}.call(this)}.call(this,T("buffer").Buffer)},{"base64-js":6,buffer:8,ieee754:9}],9:[function(e,t,i){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
i.read=function(e,t,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,u=l>>1,c=-7,h=i?n-1:0,A=i?-1:1,n=e[t+h];for(h+=A,o=n&(1<<-c)-1,n>>=-c,c+=a;0<c;o=256*o+e[t+h],h+=A,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=r;0<c;s=256*s+e[t+h],h+=A,c-=8);if(0===o)o=1-u;else{if(o===l)return s?NaN:1/0*(n?-1:1);s+=Math.pow(2,r),o-=u}return(n?-1:1)*s*Math.pow(2,o-r)},i.write=function(e,t,i,r,n,o){var s,a,l=8*o-n-1,u=(1<<l)-1,c=u>>1,h=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,A=r?0:o-1,p=r?1:-1,o=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(r=Math.pow(2,-s))<1&&(s--,r*=2),2<=(t+=1<=s+c?h/r:h*Math.pow(2,1-c))*r&&(s++,r/=2),u<=s+c?(a=0,s=u):1<=s+c?(a=(t*r-1)*Math.pow(2,n),s+=c):(a=t*Math.pow(2,c-1)*Math.pow(2,n),s=0));8<=n;e[i+A]=255&a,A+=p,a/=256,n-=8);for(s=s<<n|a,l+=n;0<l;e[i+A]=255&s,A+=p,s/=256,l-=8);e[i+A-p]|=128*o}},{}],10:[function(e,u,t){!function(l){!function(){"use strict";var e,t,i,r,n=l.MutationObserver||l.WebKitMutationObserver,o=n?(e=0,n=new n(a),t=l.document.createTextNode(""),n.observe(t,{characterData:!0}),function(){t.data=e=++e%2}):l.setImmediate||void 0===l.MessageChannel?"document"in l&&"onreadystatechange"in l.document.createElement("script")?function(){var e=l.document.createElement("script");e.onreadystatechange=function(){a(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},l.document.documentElement.appendChild(e)}:function(){setTimeout(a,0)}:((i=new l.MessageChannel).port1.onmessage=a,function(){i.port2.postMessage(0)}),s=[];function a(){r=!0;for(var e,t,i=s.length;i;){for(t=s,s=[],e=-1;++e<i;)t[e]();i=s.length}r=!1}u.exports=function(e){1!==s.push(e)||r||o()}}.call(this)}.call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],11:[function(u,t,r){!function(i,h,n){!function(){
/*!

JSZip v3.6.0 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/master/LICENSE
*/
!function(e){"object"==typeof r&&void 0!==t?t.exports=e():("undefined"!=typeof window?window:void 0!==i?i:"undefined"!=typeof self?self:this).JSZip=e()}(function(){return function r(n,o,s){function a(t,e){if(!o[t]){if(!n[t]){var i="function"==typeof u&&u;if(!e&&i)return i(t,!0);if(l)return l(t,!0);e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}i=o[t]={exports:{}};n[t][0].call(i.exports,function(e){return a(n[t][1][e]||e)},i,i.exports,r,n,o,s)}return o[t].exports}for(var l="function"==typeof u&&u,e=0;e<s.length;e++)a(s[e]);return a}({1:[function(u,t,r){!function(i){!function(e){"object"==typeof r&&void 0!==t?t.exports=e():("undefined"!=typeof window?window:void 0!==i?i:"undefined"!=typeof self?self:this).JSZip=e()}(function(){return function r(n,o,s){function a(t,e){if(!o[t]){if(!n[t]){var i="function"==typeof u&&u;if(!e&&i)return i(t,!0);if(l)return l(t,!0);e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}i=o[t]={exports:{}};n[t][0].call(i.exports,function(e){return a(n[t][1][e]||e)},i,i.exports,r,n,o,s)}return o[t].exports}for(var l="function"==typeof u&&u,e=0;e<s.length;e++)a(s[e]);return a}({1:[function(u,t,r){!function(i){!function(e){"object"==typeof r&&void 0!==t?t.exports=e():("undefined"!=typeof window?window:void 0!==i?i:"undefined"!=typeof self?self:this).JSZip=e()}(function(){return function r(n,o,s){function a(t,e){if(!o[t]){if(!n[t]){var i="function"==typeof u&&u;if(!e&&i)return i(t,!0);if(l)return l(t,!0);e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}i=o[t]={exports:{}};n[t][0].call(i.exports,function(e){return a(n[t][1][e]||e)},i,i.exports,r,n,o,s)}return o[t].exports}for(var l="function"==typeof u&&u,e=0;e<s.length;e++)a(s[e]);return a}({1:[function(u,t,r){!function(i){!function(e){"object"==typeof r&&void 0!==t?t.exports=e():("undefined"!=typeof window?window:void 0!==i?i:"undefined"!=typeof self?self:this).JSZip=e()}(function(){return function r(n,o,s){function a(t,e){if(!o[t]){if(!n[t]){var i="function"==typeof u&&u;if(!e&&i)return i(t,!0);if(l)return l(t,!0);e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}i=o[t]={exports:{}};n[t][0].call(i.exports,function(e){return a(n[t][1][e]||e)},i,i.exports,r,n,o,s)}return o[t].exports}for(var l="function"==typeof u&&u,e=0;e<s.length;e++)a(s[e]);return a}({1:[function(u,t,r){!function(i){!function(e){"object"==typeof r&&void 0!==t?t.exports=e():("undefined"!=typeof window?window:void 0!==i?i:"undefined"!=typeof self?self:this).JSZip=e()}(function(){return function r(n,o,s){function a(t,e){if(!o[t]){if(!n[t]){var i="function"==typeof u&&u;if(!e&&i)return i(t,!0);if(l)return l(t,!0);e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}i=o[t]={exports:{}};n[t][0].call(i.exports,function(e){return a(n[t][1][e]||e)},i,i.exports,r,n,o,s)}return o[t].exports}for(var l="function"==typeof u&&u,e=0;e<s.length;e++)a(s[e]);return a}({1:[function(u,t,r){!function(i){!function(e){"object"==typeof r&&void 0!==t?t.exports=e():("undefined"!=typeof window?window:void 0!==i?i:"undefined"!=typeof self?self:this).JSZip=e()}(function(){return function r(n,o,s){function a(t,e){if(!o[t]){if(!n[t]){var i="function"==typeof u&&u;if(!e&&i)return i(t,!0);if(l)return l(t,!0);e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}i=o[t]={exports:{}};n[t][0].call(i.exports,function(e){return a(n[t][1][e]||e)},i,i.exports,r,n,o,s)}return o[t].exports}for(var l="function"==typeof u&&u,e=0;e<s.length;e++)a(s[e]);return a}({1:[function(e,t,i){"use strict";var h=e("./utils"),c=e("./support"),A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(e){for(var t,i,r,n,o,s,a=[],l=0,u=e.length,c="string"!==h.getTypeOf(e);l<e.length;)s=u-l,r=c?(t=e[l++],i=l<u?e[l++]:0,l<u?e[l++]:0):(t=e.charCodeAt(l++),i=l<u?e.charCodeAt(l++):0,l<u?e.charCodeAt(l++):0),n=(3&t)<<4|i>>4,o=1<s?(15&i)<<2|r>>6:64,s=2<s?63&r:64,a.push(A.charAt(t>>2)+A.charAt(n)+A.charAt(o)+A.charAt(s));return a.join("")},i.decode=function(e){var t,i,r,n,o,s=0,a=0;if("data:"===e.substr(0,"data:".length))throw new Error("Invalid base64 input, it looks like a data url.");var l,u=3*(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(e.charAt(e.length-1)===A.charAt(64)&&u--,e.charAt(e.length-2)===A.charAt(64)&&u--,u%1!=0)throw new Error("Invalid base64 input, bad content length.");for(l=new(c.uint8array?Uint8Array:Array)(0|u);s<e.length;)t=A.indexOf(e.charAt(s++))<<2|(n=A.indexOf(e.charAt(s++)))>>4,i=(15&n)<<4|(n=A.indexOf(e.charAt(s++)))>>2,r=(3&n)<<6|(o=A.indexOf(e.charAt(s++))),l[a++]=t,64!==n&&(l[a++]=i),64!==o&&(l[a++]=r);return l}},{"./support":30,"./utils":32}],2:[function(e,t,i){"use strict";var r=e("./external"),n=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),s=e("./stream/DataLengthProbe");function a(e,t,i,r,n){this.compressedSize=e,this.uncompressedSize=t,this.crc32=i,this.compression=r,this.compressedContent=n}a.prototype={getContentWorker:function(){var e=new n(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new s("data_length")),t=this;return e.on("end",function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),e},getCompressedWorker:function(){return new n(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},a.createWorkerFrom=function(e,t,i){return e.pipe(new o).pipe(new s("uncompressedSize")).pipe(t.compressWorker(i)).pipe(new s("compressedSize")).withStreamInfo("compression",t)},t.exports=a},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,i){"use strict";var r=e("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(e){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},i.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,i){"use strict";var r=e("./utils"),s=function(){for(var e=[],t=0;t<256;t++){for(var i=t,r=0;r<8;r++)i=1&i?3988292384^i>>>1:i>>>1;e[t]=i}return e}();t.exports=function(e,t){return void 0!==e&&e.length?("string"!==r.getTypeOf(e)?function(e,t,i){var r=s,n=0+i;e^=-1;for(var o=0;o<n;o++)e=e>>>8^r[255&(e^t[o])];return-1^e}:function(e,t,i){var r=s,n=0+i;e^=-1;for(var o=0;o<n;o++)e=e>>>8^r[255&(e^t.charCodeAt(o))];return-1^e})(0|t,e,e.length):0}},{"./utils":32}],5:[function(e,t,i){"use strict";i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(e,t,i){"use strict";e="undefined"!=typeof Promise?Promise:e("lie");t.exports={Promise:e}},{lie:37}],7:[function(e,t,i){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,n=e("pako"),o=e("./utils"),s=e("./stream/GenericWorker"),a=r?"uint8array":"array";function l(e,t){s.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}i.magic="\b\0",o.inherits(l,s),l.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(o.transformTo(a,e.data),!1)},l.prototype.flush=function(){s.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new n[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},i.compressWorker=function(e){return new l("Deflate",e)},i.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,i){"use strict";function y(e,t){for(var i="",r=0;r<t;r++)i+=String.fromCharCode(255&e),e>>>=8;return i}function r(e,t,i,r,n,o){var s=e.file,a=e.compression,l=o!==v.utf8encode,u=_.transformTo("string",o(s.name)),c=_.transformTo("string",v.utf8encode(s.name)),h=s.comment,o=_.transformTo("string",o(h)),A=_.transformTo("string",v.utf8encode(h)),p=c.length!==s.name.length,h=A.length!==h.length,f="",d=s.dir,g=s.date,m={crc32:0,compressedSize:0,uncompressedSize:0},i=(t&&!i||(m.crc32=e.crc32,m.compressedSize=e.compressedSize,m.uncompressedSize=e.uncompressedSize),0);t&&(i|=8),l||!p&&!h||(i|=2048);e=0,t=0,d&&(e|=16),"UNIX"===n?(t=798,e|=(65535&(s.unixPermissions||(d?16893:33204)))<<16):(t=20,e|=63&(s.dosPermissions||0)),l=g.getUTCHours(),l=(l=((l<<=6)|g.getUTCMinutes())<<5)|g.getUTCSeconds()/2,n=g.getUTCFullYear()-1980,n=(n=((n<<=4)|g.getUTCMonth()+1)<<5)|g.getUTCDate(),p&&(f+="up"+y((d=y(1,1)+y(C(u),4)+c).length,2)+d),h&&(f+="uc"+y((s=y(1,1)+y(C(o),4)+A).length,2)+s),g="",g=(g=(g=(g=(g=(g=(g=(g=(g=(g+="\n\0")+y(i,2))+a.magic)+y(l,2))+y(n,2))+y(m.crc32,4))+y(m.compressedSize,4))+y(m.uncompressedSize,4))+y(u.length,2))+y(f.length,2);return{fileRecord:w.LOCAL_FILE_HEADER+g+u+f,dirRecord:w.CENTRAL_FILE_HEADER+y(t,2)+g+y(o.length,2)+"\0\0\0\0"+y(e,4)+y(r,4)+u+f+o}}var _=e("../utils"),n=e("../stream/GenericWorker"),v=e("../utf8"),C=e("../crc32"),w=e("../signature");function o(e,t,i,r){n.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=i,this.encodeFileName=r,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}_.inherits(o,n),o.prototype.push=function(e){var t=e.meta.percent||0,i=this.entriesCount,r=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,n.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:i?(t+100*(i-r-1))/i:100}}))},o.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;t?(e=r(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName),this.push({data:e.fileRecord,meta:{percent:0}})):this.accumulate=!0},o.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,i=r(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(i.dirRecord),t)this.push({data:w.DATA_DESCRIPTOR+y((t=e).crc32,4)+y(t.compressedSize,4)+y(t.uncompressedSize,4),meta:{percent:100}});else for(this.push({data:i.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},o.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var i,r,n=this.bytesWritten-e,o=(i=this.dirRecords.length,n=n,e=e,o=this.zipComment,r=this.encodeFileName,r=_.transformTo("string",r(o)),w.CENTRAL_DIRECTORY_END+"\0\0\0\0"+y(i,2)+y(i,2)+y(n,4)+y(e,4)+y(r.length,2)+r);this.push({data:o,meta:{percent:100}})},o.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},o.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()}),e.on("error",function(e){t.error(e)}),this},o.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},o.prototype.error=function(e){var t=this._sources;if(!n.prototype.error.call(this,e))return!1;for(var i=0;i<t.length;i++)try{t[i].error(e)}catch(e){}return!0},o.prototype.lock=function(){n.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=o},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,i){"use strict";var u=e("../compressions"),r=e("./ZipFileWorker");i.generateWorker=function(e,s,t){var a=new r(s.streamFiles,t,s.platform,s.encodeFileName),l=0;try{e.forEach(function(e,t){l++;var i=function(e,t){e=e||t,t=u[e];if(t)return t;throw new Error(e+" is not a valid compression method !")}(t.options.compression,s.compression),r=t.options.compressionOptions||s.compressionOptions||{},n=t.dir,o=t.date;t._compressWorker(i,r).withStreamInfo("file",{name:e,dir:n,date:o,comment:t.comment||"",unixPermissions:t.unixPermissions,dosPermissions:t.dosPermissions}).pipe(a)}),a.entriesCount=l}catch(e){a.error(e)}return a}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,i){"use strict";function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var e,t=new r;for(e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(r.prototype=e("./object")).loadAsync=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.version="3.5.0",r.loadAsync=function(e,t){return(new r).loadAsync(e,t)},r.external=e("./external"),t.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,i){"use strict";var r=e("./utils"),s=e("./external"),a=e("./utf8"),l=e("./zipEntries"),u=e("./stream/Crc32Probe"),c=e("./nodejsUtils");t.exports=function(e,n){var o=this;return n=r.extend(n||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),c.isNode&&c.isStream(e)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",e,!0,n.optimizedBinaryString,n.base64).then(function(e){var t=new l(n);return t.load(e),t}).then(function(e){var t=[s.Promise.resolve(e)],i=e.files;if(n.checkCRC32)for(var r=0;r<i.length;r++)t.push(function(r){return new s.Promise(function(e,t){var i=r.decompressed.getContentWorker().pipe(new u);i.on("error",function(e){t(e)}).on("end",function(){i.streamInfo.crc32!==r.decompressed.crc32?t(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()})}(i[r]));return s.Promise.all(t)}).then(function(e){for(var e=e.shift(),t=e.files,i=0;i<t.length;i++){var r=t[i];o.file(r.fileNameStr,r.decompressed,{binary:!0,optimizedBinaryString:!0,date:r.date,dir:r.dir,comment:r.fileCommentStr.length?r.fileCommentStr:null,unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions,createFolders:n.createFolders})}return e.zipComment.length&&(o.comment=e.zipComment),o})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,i){"use strict";var r=e("../utils"),n=e("../stream/GenericWorker");function o(e,t){n.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}r.inherits(o,n),o.prototype._bindStream=function(e){var t=this;(this._stream=e).pause(),e.on("data",function(e){t.push({data:e,meta:{percent:0}})}).on("error",function(e){t.isPaused?this.generatedError=e:t.error(e)}).on("end",function(){t.isPaused?t._upstreamEnded=!0:t.end()})},o.prototype.pause=function(){return!!n.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,i){"use strict";var n=e("readable-stream").Readable;function r(e,t,i){n.call(this,t),this._helper=e;var r=this;e.on("data",function(e,t){r.push(e)||r._helper.pause(),i&&i(t)}).on("error",function(e){r.emit("error",e)}).on("end",function(){r.push(null)})}e("../utils").inherits(r,n),r.prototype._read=function(){this._helper.resume()},t.exports=r},{"../utils":32,"readable-stream":16}],14:[function(e,t,i){"use strict";t.exports={isNode:void 0!==h,newBufferFrom:function(e,t){if(h.from&&h.from!==Uint8Array.from)return h.from(e,t);if("number"==typeof e)throw new Error('The "data" argument must not be a number');return new h(e,t)},allocBuffer:function(e){return h.alloc?h.alloc(e):((e=new h(e)).fill(0),e)},isBuffer:function(e){return h.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,i){"use strict";function n(e,t,i){var r=u.getTypeOf(t),n=u.extend(i||{},h);n.date=n.date||new Date,null!==n.compression&&(n.compression=n.compression.toUpperCase()),"string"==typeof n.unixPermissions&&(n.unixPermissions=parseInt(n.unixPermissions,8)),n.unixPermissions&&16384&n.unixPermissions&&(n.dir=!0),n.dosPermissions&&16&n.dosPermissions&&(n.dir=!0),n.dir&&(e=a(e)),n.createFolders&&(o=0<(s=(o="/"===(o=e).slice(-1)?o.substring(0,o.length-1):o).lastIndexOf("/"))?o.substring(0,s):"")&&l.call(this,o,!0);var o,s="string"===r&&!1===n.binary&&!1===n.base64,r=(i&&void 0!==i.binary||(n.binary=!s),(t instanceof A&&0===t.uncompressedSize||n.dir||!t||0===t.length)&&(n.base64=!1,n.binary=!0,t="",n.compression="STORE"),o=t instanceof A||t instanceof c?t:d.isNode&&d.isStream(t)?new g(e,t):u.prepareContent(e,t,n.binary,n.optimizedBinaryString,n.base64),new p(e,o,n));this.files[e]=r}function a(e){return"/"!==e.slice(-1)&&(e+="/"),e}function l(e,t){return t=void 0!==t?t:h.createFolders,e=a(e),this.files[e]||n.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]}var o=e("./utf8"),u=e("./utils"),c=e("./stream/GenericWorker"),s=e("./stream/StreamHelper"),h=e("./defaults"),A=e("./compressedObject"),p=e("./zipObject"),f=e("./generate"),d=e("./nodejsUtils"),g=e("./nodejs/NodejsStreamInputAdapter");function m(e){return"[object RegExp]"===Object.prototype.toString.call(e)}t.exports={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,i,r;for(t in this.files)this.files.hasOwnProperty(t)&&(r=this.files[t],i=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(i,r)},filter:function(i){var r=[];return this.forEach(function(e,t){i(e,t)&&r.push(t)}),r},file:function(e,t,i){var r;return 1!==arguments.length?(e=this.root+e,n.call(this,e,t,i),this):m(e)?(r=e,this.filter(function(e,t){return!t.dir&&r.test(e)})):(t=this.files[this.root+e])&&!t.dir?t:null},folder:function(i){var e,t;return i?m(i)?this.filter(function(e,t){return t.dir&&i.test(e)}):(e=this.root+i,e=l.call(this,e),(t=this.clone()).root=e.name,t):this},remove:function(i){i=this.root+i;var e=this.files[i];if(e||("/"!==i.slice(-1)&&(i+="/"),e=this.files[i]),e&&!e.dir)delete this.files[i];else for(var t=this.filter(function(e,t){return t.name.slice(0,i.length)===i}),r=0;r<t.length;r++)delete this.files[t[r].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t={};try{if((t=u.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=t.type.toLowerCase(),t.compression=t.compression.toUpperCase(),"binarystring"===t.type&&(t.type="string"),!t.type)throw new Error("No output type specified.");u.checkSupport(t.type),"darwin"!==t.platform&&"freebsd"!==t.platform&&"linux"!==t.platform&&"sunos"!==t.platform||(t.platform="UNIX"),"win32"===t.platform&&(t.platform="DOS");var i=t.comment||this.comment||"",r=f.generateWorker(this,t,i)}catch(e){(r=new c("error")).error(e)}return new s(r,t.type||"string",t.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}}},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,i){t.exports=e("stream")},{stream:void 0}],17:[function(e,t,i){"use strict";var r=e("./DataReader");function n(e){r.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}e("../utils").inherits(n,r),n.prototype.byteAt=function(e){return this.data[this.zero+e]},n.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),i=e.charCodeAt(1),r=e.charCodeAt(2),n=e.charCodeAt(3),o=this.length-4;0<=o;--o)if(this.data[o]===t&&this.data[o+1]===i&&this.data[o+2]===r&&this.data[o+3]===n)return o-this.zero;return-1},n.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),i=e.charCodeAt(1),r=e.charCodeAt(2),e=e.charCodeAt(3),n=this.readData(4);return t===n[0]&&i===n[1]&&r===n[2]&&e===n[3]},n.prototype.readData=function(e){var t;return this.checkOffset(e),0===e?[]:(t=this.data.slice(this.zero+this.index,this.zero+this.index+e),this.index+=e,t)},t.exports=n},{"../utils":32,"./DataReader":18}],18:[function(e,t,i){"use strict";var r=e("../utils");function n(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}n.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,i=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)i=(i<<8)+this.byteAt(t);return this.index+=e,i},readString:function(e){return r.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=n},{"../utils":32}],19:[function(e,t,i){"use strict";var r=e("./Uint8ArrayReader");function n(e){r.call(this,e)}e("../utils").inherits(n,r),n.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=n},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,i){"use strict";var r=e("./DataReader");function n(e){r.call(this,e)}e("../utils").inherits(n,r),n.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},n.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},n.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},n.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=n},{"../utils":32,"./DataReader":18}],21:[function(e,t,i){"use strict";var r=e("./ArrayReader");function n(e){r.call(this,e)}e("../utils").inherits(n,r),n.prototype.readData=function(e){var t;return this.checkOffset(e),0===e?new Uint8Array(0):(t=this.data.subarray(this.zero+this.index,this.zero+this.index+e),this.index+=e,t)},t.exports=n},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,i){"use strict";var r=e("../utils"),n=e("../support"),o=e("./ArrayReader"),s=e("./StringReader"),a=e("./NodeBufferReader"),l=e("./Uint8ArrayReader");t.exports=function(e){var t=r.getTypeOf(e);return r.checkSupport(t),"string"!==t||n.uint8array?"nodebuffer"===t?new a(e):n.uint8array?new l(r.transformTo("uint8array",e)):new o(r.transformTo("array",e)):new s(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,i){"use strict";i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,i){"use strict";var r=e("./GenericWorker"),n=e("../utils");function o(e){r.call(this,"ConvertWorker to "+e),this.destType=e}n.inherits(o,r),o.prototype.processChunk=function(e){this.push({data:n.transformTo(this.destType,e.data),meta:e.meta})},t.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,i){"use strict";var r=e("./GenericWorker"),n=e("../crc32");function o(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,r),o.prototype.processChunk=function(e){this.streamInfo.crc32=n(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,i){"use strict";var r=e("../utils"),n=e("./GenericWorker");function o(e){n.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}r.inherits(o,n),o.prototype.processChunk=function(e){var t;e&&(t=this.streamInfo[this.propName]||0,this.streamInfo[this.propName]=t+e.data.length),n.prototype.processChunk.call(this,e)},t.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,i){"use strict";var r=e("../utils"),n=e("./GenericWorker");function o(e){n.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then(function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=r.getTypeOf(e),t.isPaused||t._tickAndRepeat()},function(e){t.error(e)})}r.inherits(o,n),o.prototype.cleanUp=function(){n.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished)||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0)},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,i){"use strict";function r(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var i=0;i<this._listeners[e].length;i++)this._listeners[e][i].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.end()}),e.on("error",function(e){t.error(e)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){var e;return!(!this.isPaused||this.isFinished||(e=this.isPaused=!1,this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),e))},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=r},{}],29:[function(e,t,i){"use strict";var u=e("../utils"),n=e("./ConvertWorker"),o=e("./GenericWorker"),c=e("../base64"),r=e("../support"),s=e("../external"),a=null;if(r.nodestream)try{a=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}function l(e,t,i){var r=t;switch(t){case"blob":case"arraybuffer":r="uint8array";break;case"base64":r="string"}try{this._internalType=r,this._outputType=t,this._mimeType=i,u.checkSupport(r),this._worker=e.pipe(new n(r)),e.lock()}catch(e){this._worker=new o("error"),this._worker.error(e)}}l.prototype={accumulate:function(e){return a=this,l=e,new s.Promise(function(t,i){var r=[],n=a._internalType,o=a._outputType,s=a._mimeType;a.on("data",function(e,t){r.push(e),l&&l(t)}).on("error",function(e){r=[],i(e)}).on("end",function(){try{var e=function(e,t,i){switch(e){case"blob":return u.newBlob(u.transformTo("arraybuffer",t),i);case"base64":return c.encode(t);default:return u.transformTo(e,t)}}(o,function(e,t){for(var i=0,r=null,n=0,o=0;o<t.length;o++)n+=t[o].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(r=new Uint8Array(n),o=0;o<t.length;o++)r.set(t[o],i),i+=t[o].length;return r;case"nodebuffer":return h.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(n,r),s);t(e)}catch(e){i(e)}r=[]}).resume()});var a,l},on:function(e,t){var i=this;return"data"===e?this._worker.on(e,function(e){t.call(i,e.data,e.meta)}):this._worker.on(e,function(){u.delay(t,arguments,i)}),this},resume:function(){return u.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(u.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new a(this,{objectMode:"nodebuffer"!==this._outputType},e)}},t.exports=l},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,i){"use strict";if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer=void 0!==h,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{var r=new ArrayBuffer(0);try{i.blob=0===new Blob([r],{type:"application/zip"}).size}catch(e){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);n.append(r),i.blob=0===n.getBlob("application/zip").size}catch(e){i.blob=!1}}}try{i.nodestream=!!e("readable-stream").Readable}catch(e){i.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,n){"use strict";for(var l=e("./utils"),u=e("./support"),c=e("./nodejsUtils"),i=e("./stream/GenericWorker"),h=new Array(256),r=0;r<256;r++)h[r]=252<=r?6:248<=r?5:240<=r?4:224<=r?3:192<=r?2:1;function o(){i.call(this,"utf-8 decode"),this.leftOver=null}function s(){i.call(this,"utf-8 encode")}h[254]=h[254]=1,n.utf8encode=function(e){if(u.nodebuffer)return c.newBufferFrom(e,"utf-8");for(var t,i,r,n,o=e,s=o.length,a=0,l=0;l<s;l++)55296==(64512&(i=o.charCodeAt(l)))&&l+1<s&&56320==(64512&(r=o.charCodeAt(l+1)))&&(i=65536+(i-55296<<10)+(r-56320),l++),a+=i<128?1:i<2048?2:i<65536?3:4;for(t=new(u.uint8array?Uint8Array:Array)(a),l=n=0;n<a;l++)55296==(64512&(i=o.charCodeAt(l)))&&l+1<s&&56320==(64512&(r=o.charCodeAt(l+1)))&&(i=65536+(i-55296<<10)+(r-56320),l++),i<128?t[n++]=i:(i<2048?t[n++]=192|i>>>6:(i<65536?t[n++]=224|i>>>12:(t[n++]=240|i>>>18,t[n++]=128|i>>>12&63),t[n++]=128|i>>>6&63),t[n++]=128|63&i);return t},n.utf8decode=function(e){if(u.nodebuffer)return l.transformTo("nodebuffer",e).toString("utf-8");for(var t,i,r,n=e=l.transformTo(u.uint8array?"uint8array":"array",e),o=n.length,s=new Array(2*o),a=t=0;a<o;)if((i=n[a++])<128)s[t++]=i;else if(4<(r=h[i]))s[t++]=65533,a+=r-1;else{for(i&=2===r?31:3===r?15:7;1<r&&a<o;)i=i<<6|63&n[a++],r--;1<r?s[t++]=65533:i<65536?s[t++]=i:(i-=65536,s[t++]=55296|i>>10&1023,s[t++]=56320|1023&i)}return s.length!==t&&(s.subarray?s=s.subarray(0,t):s.length=t),l.applyFromCharCode(s)},l.inherits(o,i),o.prototype.processChunk=function(e){var t=l.transformTo(u.uint8array?"uint8array":"array",e.data),i=(this.leftOver&&this.leftOver.length&&(u.uint8array?(i=t,(t=new Uint8Array(i.length+this.leftOver.length)).set(this.leftOver,0),t.set(i,this.leftOver.length)):t=this.leftOver.concat(t),this.leftOver=null),function(e,t){for(var i=(t=(t=t||e.length)>e.length?e.length:t)-1;0<=i&&128==(192&e[i]);)i--;return!(i<0)&&0!==i&&i+h[e[i]]>t?i:t}(t)),r=t;i!==t.length&&(u.uint8array?(r=t.subarray(0,i),this.leftOver=t.subarray(i,t.length)):(r=t.slice(0,i),this.leftOver=t.slice(i,t.length))),this.push({data:n.utf8decode(r),meta:e.meta})},o.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=o,l.inherits(s,i),s.prototype.processChunk=function(e){this.push({data:n.utf8encode(e.data),meta:e.meta})},n.Utf8EncodeWorker=s},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,s){"use strict";var a=e("./support"),l=e("./base64"),i=e("./nodejsUtils"),r=e("set-immediate-shim"),u=e("./external");function n(e){return e}function c(e,t){for(var i=0;i<e.length;++i)t[i]=255&e.charCodeAt(i);return t}s.newBlob=function(t,i){s.checkSupport("blob");try{return new Blob([t],{type:i})}catch(e){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return r.append(t),r.getBlob(i)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var o={stringifyByChunk:function(e,t,i){var r=[],n=0,o=e.length;if(o<=i)return String.fromCharCode.apply(null,e);for(;n<o;)r.push("array"===t||"nodebuffer"===t?String.fromCharCode.apply(null,e.slice(n,Math.min(n+i,o))):String.fromCharCode.apply(null,e.subarray(n,Math.min(n+i,o)))),n+=i;return r.join("")},stringifyByChar:function(e){for(var t="",i=0;i<e.length;i++)t+=String.fromCharCode(e[i]);return t},applyCanBeUsed:{uint8array:function(){try{return a.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return a.nodebuffer&&1===String.fromCharCode.apply(null,i.allocBuffer(1)).length}catch(e){return!1}}()}};function h(e){var t=65536,i=s.getTypeOf(e),r=!0;if("uint8array"===i?r=o.applyCanBeUsed.uint8array:"nodebuffer"===i&&(r=o.applyCanBeUsed.nodebuffer),r)for(;1<t;)try{return o.stringifyByChunk(e,i,t)}catch(e){t=Math.floor(t/2)}return o.stringifyByChar(e)}function A(e,t){for(var i=0;i<e.length;i++)t[i]=e[i];return t}s.applyFromCharCode=h;var p={};p.string={string:n,array:function(e){return c(e,new Array(e.length))},arraybuffer:function(e){return p.string.uint8array(e).buffer},uint8array:function(e){return c(e,new Uint8Array(e.length))},nodebuffer:function(e){return c(e,i.allocBuffer(e.length))}},p.array={string:h,array:n,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return i.newBufferFrom(e)}},p.arraybuffer={string:function(e){return h(new Uint8Array(e))},array:function(e){return A(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:n,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return i.newBufferFrom(new Uint8Array(e))}},p.uint8array={string:h,array:function(e){return A(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:n,nodebuffer:function(e){return i.newBufferFrom(e)}},p.nodebuffer={string:h,array:function(e){return A(e,new Array(e.length))},arraybuffer:function(e){return p.nodebuffer.uint8array(e).buffer},uint8array:function(e){return A(e,new Uint8Array(e.length))},nodebuffer:n},s.transformTo=function(e,t){if(t=t||"",!e)return t;s.checkSupport(e);var i=s.getTypeOf(t);return p[i][e](t)},s.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":a.nodebuffer&&i.isBuffer(e)?"nodebuffer":a.uint8array&&e instanceof Uint8Array?"uint8array":a.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(e){if(!a[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(e){for(var t,i="",r=0;r<(e||"").length;r++)i+="\\x"+((t=e.charCodeAt(r))<16?"0":"")+t.toString(16).toUpperCase();return i},s.delay=function(e,t,i){r(function(){e.apply(i||null,t||[])})},s.inherits=function(e,t){function i(){}i.prototype=t.prototype,e.prototype=new i},s.extend=function(){for(var e,t={},i=0;i<arguments.length;i++)for(e in arguments[i])arguments[i].hasOwnProperty(e)&&void 0===t[e]&&(t[e]=arguments[i][e]);return t},s.prepareContent=function(i,e,r,n,o){return u.Promise.resolve(e).then(function(r){return a.blob&&(r instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(r)))&&"undefined"!=typeof FileReader?new u.Promise(function(t,i){var e=new FileReader;e.onload=function(e){t(e.target.result)},e.onerror=function(e){i(e.target.error)},e.readAsArrayBuffer(r)}):r}).then(function(e){var t=s.getTypeOf(e);return t?("arraybuffer"===t?e=s.transformTo("uint8array",e):"string"===t&&(o?e=l.decode(e):r&&!0!==n&&(e=c(t=e,new(a.uint8array?Uint8Array:Array)(t.length)))),e):u.Promise.reject(new Error("Can't read the data of '"+i+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(e,t,i){"use strict";var r=e("./reader/readerFor"),n=e("./utils"),o=e("./signature"),s=e("./zipEntry"),a=(e("./utf8"),e("./support"));function l(e){this.files=[],this.loadOptions=e}l.prototype={checkSignature:function(e){var t;if(!this.reader.readAndCheckSignature(e))throw this.reader.index-=4,t=this.reader.readString(4),new Error("Corrupted zip or bug: unexpected signature ("+n.pretty(t)+", expected "+n.pretty(e)+")")},isSignature:function(e,t){var i=this.reader.index,e=(this.reader.setIndex(e),this.reader.readString(4)===t);return this.reader.setIndex(i),e},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=a.uint8array?"uint8array":"array",t=n.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(t)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,i,r=this.zip64EndOfCentralSize-44;0<r;)e=this.reader.readInt(2),t=this.reader.readInt(4),i=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){for(var e,t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(e=new s({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(e<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(e);var t=e;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===n.MAX_VALUE_16BITS||this.diskWithCentralDirStart===n.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===n.MAX_VALUE_16BITS||this.centralDirRecords===n.MAX_VALUE_16BITS||this.centralDirSize===n.MAX_VALUE_32BITS||this.centralDirOffset===n.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}e=this.centralDirOffset+this.centralDirSize,e=t-(e=this.zip64?e+20+(12+this.zip64EndOfCentralSize):e);if(0<e)this.isSignature(t,o.CENTRAL_FILE_HEADER)||(this.reader.zero=e);else if(e<0)throw new Error("Corrupted zip: missing "+Math.abs(e)+" bytes.")},prepareReader:function(e){this.reader=r(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(e,t,i){"use strict";var r=e("./reader/readerFor"),n=e("./utils"),o=e("./compressedObject"),s=e("./crc32"),a=e("./utf8"),l=e("./compressions"),u=e("./support");function c(e,t){this.options=e,this.loadOptions=t}c.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t;if(e.skip(22),this.fileNameLength=e.readInt(2),t=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(t),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in l)if(l.hasOwnProperty(t)&&l[t].magic===e)return l[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+n.pretty(this.compressionMethod)+" unknown (inner file : "+n.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==e&&(this.dosPermissions=63&this.externalFileAttributes),3==e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){var t;this.extraFields[1]&&(t=r(this.extraFields[1].value),this.uncompressedSize===n.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===n.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===n.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===n.MAX_VALUE_32BITS)&&(this.diskNumberStart=t.readInt(4))},readExtraFields:function(e){var t,i,r,n=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index+4<n;)t=e.readInt(2),i=e.readInt(2),r=e.readData(i),this.extraFields[t]={id:t,length:i,value:r};e.setIndex(n)},handleUTF8:function(){var e,t=u.uint8array?"uint8array":"array";this.useUTF8()?(this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment)):(null!==(e=this.findExtraFieldUnicodePath())?this.fileNameStr=e:(e=n.transformTo(t,this.fileName),this.fileNameStr=this.loadOptions.decodeFileName(e)),null!==(e=this.findExtraFieldUnicodeComment())?this.fileCommentStr=e:(e=n.transformTo(t,this.fileComment),this.fileCommentStr=this.loadOptions.decodeFileName(e)))},findExtraFieldUnicodePath:function(){var e,t=this.extraFields[28789];return!t||1!==(e=r(t.value)).readInt(1)||s(this.fileName)!==e.readInt(4)?null:a.utf8decode(e.readData(t.length-5))},findExtraFieldUnicodeComment:function(){var e,t=this.extraFields[25461];return!t||1!==(e=r(t.value)).readInt(1)||s(this.fileComment)!==e.readInt(4)?null:a.utf8decode(e.readData(t.length-5))}},t.exports=c},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,i){"use strict";function r(e,t,i){this.name=e,this.dir=i.dir,this.date=i.date,this.comment=i.comment,this.unixPermissions=i.unixPermissions,this.dosPermissions=i.dosPermissions,this._data=t,this._dataBinary=i.binary,this.options={compression:i.compression,compressionOptions:i.compressionOptions}}var o=e("./stream/StreamHelper"),n=e("./stream/DataWorker"),s=e("./utf8"),a=e("./compressedObject"),l=e("./stream/GenericWorker");r.prototype={internalStream:function(e){var t=null,i="string";try{if(!e)throw new Error("No output type specified.");var r="string"===(i=e.toLowerCase())||"text"===i,n=("binarystring"!==i&&"text"!==i||(i="string"),t=this._decompressWorker(),!this._dataBinary);n&&!r&&(t=t.pipe(new s.Utf8EncodeWorker)),!n&&r&&(t=t.pipe(new s.Utf8DecodeWorker))}catch(e){(t=new l("error")).error(e)}return new o(t,i,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){var i;return this._data instanceof a&&this._data.compression.magic===e.magic?this._data.getCompressedWorker():(i=this._decompressWorker(),this._dataBinary||(i=i.pipe(new s.Utf8EncodeWorker)),a.createWorkerFrom(i,e,t))},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof l?this._data:new n(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],c=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<u.length;h++)r.prototype[u[h]]=c;t.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,u,t){!function(t){"use strict";var r,e,i,n,o=t.MutationObserver||t.WebKitMutationObserver,s=o?(e=0,o=new o(l),i=t.document.createTextNode(""),o.observe(i,{characterData:!0}),function(){i.data=e=++e%2}):t.setImmediate||void 0===t.MessageChannel?"document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){l(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(l,0)}:((n=new t.MessageChannel).port1.onmessage=l,function(){n.port2.postMessage(0)}),a=[];function l(){var e,t;r=!0;for(var i=a.length;i;){for(t=a,a=[],e=-1;++e<i;)t[e]();i=a.length}r=!1}u.exports=function(e){1!==a.push(e)||r||s()}}.call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(e,t,i){"use strict";var n=e("immediate");function l(){}var u={},o=["REJECTED"],s=["FULFILLED"],r=["PENDING"];function a(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=r,this.queue=[],this.outcome=void 0,e!==l&&p(this,e)}function c(e,t,i){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function h(t,i,r){n(function(){var e;try{e=i(r)}catch(e){return u.reject(t,e)}e===t?u.reject(t,new TypeError("Cannot resolve promise with itself")):u.resolve(t,e)})}function A(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function p(t,e){var i=!1;function r(e){i||(i=!0,u.reject(t,e))}function n(e){i||(i=!0,u.resolve(t,e))}var o=f(function(){e(n,r)});"error"===o.status&&r(o.value)}function f(e,t){var i={};try{i.value=e(t),i.status="success"}catch(e){i.status="error",i.value=e}return i}(t.exports=a).prototype.finally=function(t){var i;return"function"!=typeof t?this:(i=this.constructor,this.then(function(e){return i.resolve(t()).then(function(){return e})},function(e){return i.resolve(t()).then(function(){throw e})}))},a.prototype.catch=function(e){return this.then(null,e)},a.prototype.then=function(e,t){var i;return"function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===o?this:(i=new this.constructor(l),this.state!==r?h(i,this.state===s?e:t,this.outcome):this.queue.push(new c(i,e,t)),i)},c.prototype.callFulfilled=function(e){u.resolve(this.promise,e)},c.prototype.otherCallFulfilled=function(e){h(this.promise,this.onFulfilled,e)},c.prototype.callRejected=function(e){u.reject(this.promise,e)},c.prototype.otherCallRejected=function(e){h(this.promise,this.onRejected,e)},u.resolve=function(e,t){var i=f(A,t);if("error"===i.status)return u.reject(e,i.value);i=i.value;if(i)p(e,i);else{e.state=s,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callFulfilled(t)}return e},u.reject=function(e,t){e.state=o,e.outcome=t;for(var i=-1,r=e.queue.length;++i<r;)e.queue[i].callRejected(t);return e},a.resolve=function(e){return e instanceof this?e:u.resolve(new this(l),e)},a.reject=function(e){var t=new this(l);return u.reject(t,e)},a.all=function(e){var i=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var o=new Array(r),s=0,t=-1,a=new this(l);++t<r;)!function(e,t){i.resolve(e).then(function(e){o[t]=e,++s!==r||n||(n=!0,u.resolve(a,o))},function(e){n||(n=!0,u.reject(a,e))})}(e[t],t);return a},a.race=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,i=!1;if(!t)return this.resolve([]);for(var r,n=-1,o=new this(l);++n<t;)r=e[n],this.resolve(r).then(function(e){i||(i=!0,u.resolve(o,e))},function(e){i||(i=!0,u.reject(o,e))});return o}},{immediate:36}],38:[function(e,t,i){"use strict";var r={};(0,e("./lib/utils/common").assign)(r,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,i){"use strict";var s=e("./zlib/deflate"),a=e("./utils/common"),l=e("./utils/strings"),r=e("./zlib/messages"),n=e("./zlib/zstream"),u=Object.prototype.toString;function o(e){if(!(this instanceof o))return new o(e);this.options=a.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var e=this.options,t=(e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new n,this.strm.avail_out=0,s.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy));if(0!==t)throw new Error(r[t]);if(e.header&&s.deflateSetHeader(this.strm,e.header),e.dictionary){e="string"==typeof e.dictionary?l.string2buf(e.dictionary):"[object ArrayBuffer]"===u.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary;if(0!==(t=s.deflateSetDictionary(this.strm,e)))throw new Error(r[t]);this._dict_set=!0}}function c(e,t){t=new o(t);if(t.push(e,!0),t.err)throw t.msg||r[t.err];return t.result}o.prototype.push=function(e,t){var i,r,n=this.strm,o=this.options.chunkSize;if(this.ended)return!1;r=t===~~t?t:!0===t?4:0,"string"==typeof e?n.input=l.string2buf(e):"[object ArrayBuffer]"===u.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;do{if(0===n.avail_out&&(n.output=new a.Buf8(o),n.next_out=0,n.avail_out=o),1!==(i=s.deflate(n,r))&&0!==i)return this.onEnd(i),!(this.ended=!0)}while(0!==n.avail_out&&(0!==n.avail_in||4!==r&&2!==r)||("string"===this.options.to?this.onData(l.buf2binstring(a.shrinkBuf(n.output,n.next_out))):this.onData(a.shrinkBuf(n.output,n.next_out))),(0<n.avail_in||0===n.avail_out)&&1!==i);return 4===r?(i=s.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,0===i):2!==r||(this.onEnd(0),!(n.avail_out=0))},o.prototype.onData=function(e){this.chunks.push(e)},o.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Deflate=o,i.deflate=c,i.deflateRaw=function(e,t){return(t=t||{}).raw=!0,c(e,t)},i.gzip=function(e,t){return(t=t||{}).gzip=!0,c(e,t)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,i){"use strict";var h=e("./zlib/inflate"),A=e("./utils/common"),p=e("./utils/strings"),f=e("./zlib/constants"),r=e("./zlib/messages"),n=e("./zlib/zstream"),o=e("./zlib/gzheader"),d=Object.prototype.toString;function s(e){if(!(this instanceof s))return new s(e);this.options=A.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options,e=(t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits)&&(t.windowBits=-15),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new n,this.strm.avail_out=0,h.inflateInit2(this.strm,t.windowBits));if(e!==f.Z_OK)throw new Error(r[e]);this.header=new o,h.inflateGetHeader(this.strm,this.header)}function a(e,t){t=new s(t);if(t.push(e,!0),t.err)throw t.msg||r[t.err];return t.result}s.prototype.push=function(e,t){var i,r,n,o,s,a=this.strm,l=this.options.chunkSize,u=this.options.dictionary,c=!1;if(this.ended)return!1;r=t===~~t?t:!0===t?f.Z_FINISH:f.Z_NO_FLUSH,"string"==typeof e?a.input=p.binstring2buf(e):"[object ArrayBuffer]"===d.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new A.Buf8(l),a.next_out=0,a.avail_out=l),(i=h.inflate(a,f.Z_NO_FLUSH))===f.Z_NEED_DICT&&u&&(s="string"==typeof u?p.string2buf(u):"[object ArrayBuffer]"===d.call(u)?new Uint8Array(u):u,i=h.inflateSetDictionary(this.strm,s)),i===f.Z_BUF_ERROR&&!0===c&&(i=f.Z_OK,c=!1),i!==f.Z_STREAM_END&&i!==f.Z_OK)return this.onEnd(i),!(this.ended=!0)}while(!a.next_out||0!==a.avail_out&&i!==f.Z_STREAM_END&&(0!==a.avail_in||r!==f.Z_FINISH&&r!==f.Z_SYNC_FLUSH)||("string"===this.options.to?(s=p.utf8border(a.output,a.next_out),n=a.next_out-s,o=p.buf2string(a.output,s),a.next_out=n,a.avail_out=l-n,n&&A.arraySet(a.output,a.output,s,n,0),this.onData(o)):this.onData(A.shrinkBuf(a.output,a.next_out))),0===a.avail_in&&0===a.avail_out&&(c=!0),(0<a.avail_in||0===a.avail_out)&&i!==f.Z_STREAM_END);return(r=i===f.Z_STREAM_END?f.Z_FINISH:r)===f.Z_FINISH?(i=h.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===f.Z_OK):r!==f.Z_SYNC_FLUSH||(this.onEnd(f.Z_OK),!(a.avail_out=0))},s.prototype.onData=function(e){this.chunks.push(e)},s.prototype.onEnd=function(e){e===f.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=A.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Inflate=s,i.inflate=a,i.inflateRaw=function(e,t){return(t=t||{}).raw=!0,a(e,t)},i.ungzip=a},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,i){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array,n=(i.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])}}return e},i.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)},{arraySet:function(e,t,i,r,n){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+r),n);else for(var o=0;o<r;o++)e[n+o]=t[i+o]},flattenChunks:function(e){for(var t,i,r,n,o=t=0,s=e.length;o<s;o++)t+=e[o].length;for(n=new Uint8Array(t),o=i=0,s=e.length;o<s;o++)r=e[o],n.set(r,i),i+=r.length;return n}}),o={arraySet:function(e,t,i,r,n){for(var o=0;o<r;o++)e[n+o]=t[i+o]},flattenChunks:function(e){return[].concat.apply([],e)}};i.setTyped=function(e){e?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,n)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(r)},{}],42:[function(e,t,i){"use strict";var l=e("./common"),n=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var u=new l.Buf8(256),r=0;r<256;r++)u[r]=252<=r?6:248<=r?5:240<=r?4:224<=r?3:192<=r?2:1;function c(e,t){if(t<65537&&(e.subarray&&o||!e.subarray&&n))return String.fromCharCode.apply(null,l.shrinkBuf(e,t));for(var i="",r=0;r<t;r++)i+=String.fromCharCode(e[r]);return i}u[254]=u[254]=1,i.string2buf=function(e){for(var t,i,r,n,o=e.length,s=0,a=0;a<o;a++)55296==(64512&(i=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=e.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(r-56320),a++),s+=i<128?1:i<2048?2:i<65536?3:4;for(t=new l.Buf8(s),a=n=0;n<s;a++)55296==(64512&(i=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=e.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(r-56320),a++),i<128?t[n++]=i:(i<2048?t[n++]=192|i>>>6:(i<65536?t[n++]=224|i>>>12:(t[n++]=240|i>>>18,t[n++]=128|i>>>12&63),t[n++]=128|i>>>6&63),t[n++]=128|63&i);return t},i.buf2binstring=function(e){return c(e,e.length)},i.binstring2buf=function(e){for(var t=new l.Buf8(e.length),i=0,r=t.length;i<r;i++)t[i]=e.charCodeAt(i);return t},i.buf2string=function(e,t){for(var i,r,n,o=t||e.length,s=new Array(2*o),a=i=0;a<o;)if((r=e[a++])<128)s[i++]=r;else if(4<(n=u[r]))s[i++]=65533,a+=n-1;else{for(r&=2===n?31:3===n?15:7;1<n&&a<o;)r=r<<6|63&e[a++],n--;1<n?s[i++]=65533:r<65536?s[i++]=r:(r-=65536,s[i++]=55296|r>>10&1023,s[i++]=56320|1023&r)}return c(s,i)},i.utf8border=function(e,t){for(var i=(t=(t=t||e.length)>e.length?e.length:t)-1;0<=i&&128==(192&e[i]);)i--;return!(i<0)&&0!==i&&i+u[e[i]]>t?i:t}},{"./common":41}],43:[function(e,t,i){"use strict";t.exports=function(e,t,i,r){for(var n=65535&e|0,o=e>>>16&65535|0,s=0;0!==i;){for(i-=s=2e3<i?2e3:i;o=o+(n=n+t[r++]|0)|0,--s;);n%=65521,o%=65521}return n|o<<16|0}},{}],44:[function(e,t,i){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,i){"use strict";var a=function(){for(var e=[],t=0;t<256;t++){for(var i=t,r=0;r<8;r++)i=1&i?3988292384^i>>>1:i>>>1;e[t]=i}return e}();t.exports=function(e,t,i,r){var n=a,o=r+i;e^=-1;for(var s=r;s<o;s++)e=e>>>8^n[255&(e^t[s])];return-1^e}},{}],46:[function(e,O,t){"use strict";var a,h=e("../utils/common"),l=e("./trees"),A=e("./adler32"),p=e("./crc32"),i=e("./messages"),u=0,c=0,f=-2,r=2,d=8,n=286,o=30,s=19,R=2*n+1,U=15,g=3,m=258,y=m+g+1,_=42,v=113;function C(e,t){return e.msg=i[t],t}function w(e){return(e<<1)-(4<e?9:0)}function x(e){for(var t=e.length;0<=--t;)e[t]=0}function b(e){var t=e.state,i=t.pending;0!==(i=i>e.avail_out?e.avail_out:i)&&(h.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending)&&(t.pending_out=0)}function E(e,t){l._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,b(e.strm)}function B(e,t){e.pending_buf[e.pending++]=t}function M(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function I(e,t){var i,r,n=e.max_chain_length,o=e.strstart,s=e.prev_length,a=e.nice_match,l=e.strstart>e.w_size-y?e.strstart-(e.w_size-y):0,u=e.window,c=e.w_mask,h=e.prev,A=e.strstart+m,p=u[o+s-1],f=u[o+s];e.prev_length>=e.good_match&&(n>>=2),a>e.lookahead&&(a=e.lookahead);do{if(u[(i=t)+s]===f&&u[i+s-1]===p&&u[i]===u[o]&&u[++i]===u[o+1]){for(o+=2,i++;u[++o]===u[++i]&&u[++o]===u[++i]&&u[++o]===u[++i]&&u[++o]===u[++i]&&u[++o]===u[++i]&&u[++o]===u[++i]&&u[++o]===u[++i]&&u[++o]===u[++i]&&o<A;);if(r=m-(A-o),o=A-m,s<r){if(e.match_start=t,a<=(s=r))break;p=u[o+s-1],f=u[o+s]}}}while((t=h[t&c])>l&&0!=--n);return s<=e.lookahead?s:e.lookahead}function S(e){var t,i,r,n,o,s,a,l,u,c=e.w_size;do{if(l=e.window_size-e.lookahead-e.strstart,e.strstart>=c+(c-y)){for(h.arraySet(e.window,e.window,c,c,0),e.match_start-=c,e.strstart-=c,e.block_start-=c,t=i=e.hash_size;r=e.head[--t],e.head[t]=c<=r?r-c:0,--i;);for(t=i=c;r=e.prev[--t],e.prev[t]=c<=r?r-c:0,--i;);l+=c}if(0===e.strm.avail_in)break;if(o=e.strm,s=e.window,a=e.strstart+e.lookahead,u=void 0,i=0===(u=(l=l)<(u=o.avail_in)?l:u)?0:(o.avail_in-=u,h.arraySet(s,o.input,o.next_in,u,a),1===o.state.wrap?o.adler=A(o.adler,s,u,a):2===o.state.wrap&&(o.adler=p(o.adler,s,u,a)),o.next_in+=u,o.total_in+=u,u),e.lookahead+=i,e.lookahead+e.insert>=g)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=(e.ins_h<<e.hash_shift^e.window[n+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[n+g-1])&e.hash_mask,e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<g)););}while(e.lookahead<y&&0!==e.strm.avail_in)}function P(e,t){for(var i,r;;){if(e.lookahead<y){if(S(e),e.lookahead<y&&t===u)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=g&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+g-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-y&&(e.match_length=I(e,i)),e.match_length>=g)if(r=l._tr_tally(e,e.strstart-e.match_start,e.match_length-g),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=g){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+g-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=l._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(E(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<g-1?e.strstart:g-1,4===t?(E(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(E(e,!1),0===e.strm.avail_out)?1:2}function T(e,t){for(var i,r,n;;){if(e.lookahead<y){if(S(e),e.lookahead<y&&t===u)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=g&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+g-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=g-1,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-y&&(e.match_length=I(e,i),e.match_length<=5)&&(1===e.strategy||e.match_length===g&&4096<e.strstart-e.match_start)&&(e.match_length=g-1),e.prev_length>=g&&e.match_length<=e.prev_length){for(n=e.strstart+e.lookahead-g,r=l._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-g),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=n&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+g-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=g-1,e.strstart++,r&&(E(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=l._tr_tally(e,0,e.window[e.strstart-1]))&&E(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=l._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<g-1?e.strstart:g-1,4===t?(E(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(E(e,!1),0===e.strm.avail_out)?1:2}function L(e,t,i,r,n){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=r,this.func=n}function k(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=d,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new h.Buf16(2*R),this.dyn_dtree=new h.Buf16(2*(2*o+1)),this.bl_tree=new h.Buf16(2*(2*s+1)),x(this.dyn_ltree),x(this.dyn_dtree),x(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new h.Buf16(U+1),this.heap=new h.Buf16(2*n+1),x(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new h.Buf16(2*n+1),x(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function D(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=r,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?_:v,e.adler=2===t.wrap?0:1,t.last_flush=u,l._tr_init(t),c):C(e,f)}function F(e){var t=D(e);return t===c&&((e=e.state).window_size=2*e.w_size,x(e.head),e.max_lazy_match=a[e.level].max_lazy,e.good_match=a[e.level].good_length,e.nice_match=a[e.level].nice_length,e.max_chain_length=a[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=g-1,e.match_available=0,e.ins_h=0),t}function N(e,t,i,r,n,o){if(!e)return f;var s=1;if(-1===t&&(t=6),r<0?(s=0,r=-r):15<r&&(s=2,r-=16),n<1||9<n||i!==d||r<8||15<r||t<0||9<t||o<0||4<o)return C(e,f);8===r&&(r=9);var a=new k;return(e.state=a).strm=e,a.wrap=s,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=n+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+g-1)/g),a.window=new h.Buf8(2*a.w_size),a.head=new h.Buf16(a.hash_size),a.prev=new h.Buf16(a.w_size),a.lit_bufsize=1<<n+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new h.Buf8(a.pending_buf_size),a.d_buf=+a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=t,a.strategy=o,a.method=i,F(e)}a=[new L(0,0,0,0,function(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(S(e),0===e.lookahead&&t===u)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+i;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,E(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-y&&(E(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(E(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(E(e,!1),e.strm.avail_out),1)}),new L(4,4,8,4,P),new L(4,5,16,8,P),new L(4,6,32,32,P),new L(4,4,16,16,T),new L(8,16,32,32,T),new L(8,16,128,128,T),new L(8,32,128,256,T),new L(32,128,258,1024,T),new L(32,258,258,4096,T)],t.deflateInit=function(e,t){return N(e,t,d,15,8,0)},t.deflateInit2=N,t.deflateReset=F,t.deflateResetKeep=D,t.deflateSetHeader=function(e,t){return!e||!e.state||2!==e.state.wrap?f:(e.state.gzhead=t,c)},t.deflate=function(e,t){var i,r,n,o;if(!e||!e.state||5<t||t<0)return e?C(e,f):f;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||666===r.status&&4!==t)return C(e,0===e.avail_out?-5:f);if(r.strm=e,i=r.last_flush,r.last_flush=t,r.status===_&&(2===r.wrap?(e.adler=0,B(r,31),B(r,139),B(r,8),r.gzhead?(B(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),B(r,255&r.gzhead.time),B(r,r.gzhead.time>>8&255),B(r,r.gzhead.time>>16&255),B(r,r.gzhead.time>>24&255),B(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),B(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(B(r,255&r.gzhead.extra.length),B(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=p(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(B(r,0),B(r,0),B(r,0),B(r,0),B(r,0),B(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),B(r,3),r.status=v)):(s=d+(r.w_bits-8<<4)<<8,s|=(2<=r.strategy||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(s|=32),s+=31-s%31,r.status=v,M(r,s),0!==r.strstart&&(M(r,e.adler>>>16),M(r,65535&e.adler)),e.adler=1)),69===r.status)if(r.gzhead.extra){for(n=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>n&&(e.adler=p(e.adler,r.pending_buf,r.pending-n,n)),b(e),n=r.pending,r.pending!==r.pending_buf_size));)B(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>n&&(e.adler=p(e.adler,r.pending_buf,r.pending-n,n)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(e.adler=p(e.adler,r.pending_buf,r.pending-n,n)),b(e),n=r.pending,r.pending===r.pending_buf_size)){o=1;break}}while(o=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,B(r,o),0!==o);r.gzhead.hcrc&&r.pending>n&&(e.adler=p(e.adler,r.pending_buf,r.pending-n,n)),0===o&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(e.adler=p(e.adler,r.pending_buf,r.pending-n,n)),b(e),n=r.pending,r.pending===r.pending_buf_size)){o=1;break}}while(o=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,B(r,o),0!==o);r.gzhead.hcrc&&r.pending>n&&(e.adler=p(e.adler,r.pending_buf,r.pending-n,n)),0===o&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&b(e),r.pending+2<=r.pending_buf_size&&(B(r,255&e.adler),B(r,e.adler>>8&255),e.adler=0,r.status=v)):r.status=v),0!==r.pending){if(b(e),0===e.avail_out)return r.last_flush=-1,c}else if(0===e.avail_in&&w(t)<=w(i)&&4!==t)return C(e,-5);if(666===r.status&&0!==e.avail_in)return C(e,-5);if(0!==e.avail_in||0!==r.lookahead||t!==u&&666!==r.status){var s=2===r.strategy?function(e,t){for(var i;;){if(0===e.lookahead&&(S(e),0===e.lookahead)){if(t===u)return 1;break}if(e.match_length=0,i=l._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(E(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(E(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(E(e,!1),0===e.strm.avail_out)?1:2}(r,t):3===r.strategy?function(e,t){for(var i,r,n,o,s=e.window;;){if(e.lookahead<=m){if(S(e),e.lookahead<=m&&t===u)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=g&&0<e.strstart&&(r=s[n=e.strstart-1])===s[++n]&&r===s[++n]&&r===s[++n]){for(o=e.strstart+m;r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&n<o;);e.match_length=m-(o-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=g?(i=l._tr_tally(e,1,e.match_length-g),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=l._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(E(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(E(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(E(e,!1),0===e.strm.avail_out)?1:2}(r,t):a[r.level].func(r,t);if(3!==s&&4!==s||(r.status=666),1===s||3===s)return 0===e.avail_out&&(r.last_flush=-1),c;if(2===s&&(1===t?l._tr_align(r):5!==t&&(l._tr_stored_block(r,0,0,!1),3===t)&&(x(r.head),0===r.lookahead)&&(r.strstart=0,r.block_start=0,r.insert=0),b(e),0===e.avail_out))return r.last_flush=-1,c}return 4!==t||!(r.wrap<=0)&&(2===r.wrap?(B(r,255&e.adler),B(r,e.adler>>8&255),B(r,e.adler>>16&255),B(r,e.adler>>24&255),B(r,255&e.total_in),B(r,e.total_in>>8&255),B(r,e.total_in>>16&255),B(r,e.total_in>>24&255)):(M(r,e.adler>>>16),M(r,65535&e.adler)),b(e),0<r.wrap&&(r.wrap=-r.wrap),0!==r.pending)?c:1},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==_&&69!==t&&73!==t&&91!==t&&103!==t&&t!==v&&666!==t?C(e,f):(e.state=null,t===v?C(e,-3):c):f},t.deflateSetDictionary=function(e,t){var i,r,n,o,s,a,l,u=t.length;if(!e||!e.state)return f;if(2===(o=(i=e.state).wrap)||1===o&&i.status!==_||i.lookahead)return f;for(1===o&&(e.adler=A(e.adler,t,u,0)),i.wrap=0,u>=i.w_size&&(0===o&&(x(i.head),i.strstart=0,i.block_start=0,i.insert=0),l=new h.Buf8(i.w_size),h.arraySet(l,t,u-i.w_size,i.w_size,0),t=l,u=i.w_size),l=e.avail_in,s=e.next_in,a=e.input,e.avail_in=u,e.next_in=0,e.input=t,S(i);i.lookahead>=g;){for(r=i.strstart,n=i.lookahead-(g-1);i.ins_h=(i.ins_h<<i.hash_shift^i.window[r+g-1])&i.hash_mask,i.prev[r&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=r,r++,--n;);i.strstart=r,i.lookahead=g-1,S(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=g-1,i.match_available=0,e.next_in=s,e.input=a,e.avail_in=l,i.wrap=o,c},t.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,i){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,i){"use strict";t.exports=function(e,t){var i,r,n,o,s,a,l=e.state,u=e.next_in,c=e.input,h=u+(e.avail_in-5),A=e.next_out,p=e.output,f=A-(t-e.avail_out),d=A+(e.avail_out-257),g=l.dmax,m=l.wsize,y=l.whave,_=l.wnext,v=l.window,C=l.hold,w=l.bits,x=l.lencode,b=l.distcode,E=(1<<l.lenbits)-1,B=(1<<l.distbits)-1;e:do{for(w<15&&(C+=c[u++]<<w,w+=8,C+=c[u++]<<w,w+=8),i=x[C&E];;){if(C>>>=r=i>>>24,w-=r,0==(r=i>>>16&255))p[A++]=65535&i;else{if(!(16&r)){if(0==(64&r)){i=x[(65535&i)+(C&(1<<r)-1)];continue}if(32&r){l.mode=12;break e}e.msg="invalid literal/length code",l.mode=30;break e}for(n=65535&i,(r&=15)&&(w<r&&(C+=c[u++]<<w,w+=8),n+=C&(1<<r)-1,C>>>=r,w-=r),w<15&&(C+=c[u++]<<w,w+=8,C+=c[u++]<<w,w+=8),i=b[C&B];;){if(C>>>=r=i>>>24,w-=r,!(16&(r=i>>>16&255))){if(0==(64&r)){i=b[(65535&i)+(C&(1<<r)-1)];continue}e.msg="invalid distance code",l.mode=30;break e}if(o=65535&i,w<(r&=15)&&(C+=c[u++]<<w,(w+=8)<r)&&(C+=c[u++]<<w,w+=8),g<(o+=C&(1<<r)-1)){e.msg="invalid distance too far back",l.mode=30;break e}if(C>>>=r,w-=r,(r=A-f)<o){if(y<(r=o-r)&&l.sane){e.msg="invalid distance too far back",l.mode=30;break e}if(a=v,(s=0)===_){if(s+=m-r,r<n){for(n-=r;p[A++]=v[s++],--r;);s=A-o,a=p}}else if(_<r){if(s+=m+_-r,(r-=_)<n){for(n-=r;p[A++]=v[s++],--r;);if(s=0,_<n){for(n-=r=_;p[A++]=v[s++],--r;);s=A-o,a=p}}}else if(s+=_-r,r<n){for(n-=r;p[A++]=v[s++],--r;);s=A-o,a=p}for(;2<n;)p[A++]=a[s++],p[A++]=a[s++],p[A++]=a[s++],n-=3;n&&(p[A++]=a[s++],1<n)&&(p[A++]=a[s++])}else{for(s=A-o;p[A++]=p[s++],p[A++]=p[s++],p[A++]=p[s++],2<(n-=3););n&&(p[A++]=p[s++],1<n)&&(p[A++]=p[s++])}break}}break}}while(u<h&&A<d);u-=n=w>>3,C&=(1<<(w-=n<<3))-1,e.next_in=u,e.next_out=A,e.avail_in=u<h?h-u+5:5-(u-h),e.avail_out=A<d?d-A+257:257-(A-d),l.hold=C,l.bits=w}},{}],49:[function(e,t,i){"use strict";var T=e("../utils/common"),L=e("./adler32"),D=e("./crc32"),F=e("./inffast"),N=e("./inftrees"),O=0,R=-2,U=1,r=852,n=592;function k(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function o(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new T.Buf16(320),this.work=new T.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function s(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=U,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new T.Buf32(r),t.distcode=t.distdyn=new T.Buf32(n),t.sane=1,t.back=-1,O):R}function a(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,s(e)):R}function l(e,t){var i,r;return!e||!e.state||(r=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t))?R:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=i,r.wbits=t,a(e))}function u(e,t){var i;return e?(i=new o,(e.state=i).window=null,(i=l(e,t))!==O&&(e.state=null),i):R}var H,Q,V=!0;function G(e,t,i,r){var n,e=e.state;return null===e.window&&(e.wsize=1<<e.wbits,e.wnext=0,e.whave=0,e.window=new T.Buf8(e.wsize)),r>=e.wsize?(T.arraySet(e.window,t,i-e.wsize,e.wsize,0),e.wnext=0,e.whave=e.wsize):(r<(n=e.wsize-e.wnext)&&(n=r),T.arraySet(e.window,t,i-r,n,e.wnext),(r-=n)?(T.arraySet(e.window,t,i-r,r,0),e.wnext=r,e.whave=e.wsize):(e.wnext+=n,e.wnext===e.wsize&&(e.wnext=0),e.whave<e.wsize&&(e.whave+=n))),0}i.inflateReset=a,i.inflateReset2=l,i.inflateResetKeep=s,i.inflateInit=function(e){return u(e,15)},i.inflateInit2=u,i.inflate=function(e,t){var i,r,n,o,s,a,l,u,c,h,A,p,f,d,g,m,y,_,v,C,w,x,b,E,B=0,M=new T.Buf8(4),I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return R;12===(i=e.state).mode&&(i.mode=13),s=e.next_out,n=e.output,l=e.avail_out,o=e.next_in,r=e.input,a=e.avail_in,u=i.hold,c=i.bits,h=a,A=l,x=O;e:for(;;)switch(i.mode){case U:if(0===i.wrap)i.mode=13;else{for(;c<16;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}if(2&i.wrap&&35615===u)M[i.check=0]=255&u,M[1]=u>>>8&255,i.check=D(i.check,M,2,0),c=u=0,i.mode=2;else if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&u)<<8)+(u>>8))%31)e.msg="incorrect header check",i.mode=30;else if(8!=(15&u))e.msg="unknown compression method",i.mode=30;else{if(c-=4,w=8+(15&(u>>>=4)),0===i.wbits)i.wbits=w;else if(w>i.wbits){e.msg="invalid window size",i.mode=30;break}i.dmax=1<<w,e.adler=i.check=1,i.mode=512&u?10:12,c=u=0}}break;case 2:for(;c<16;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}if(i.flags=u,8!=(255&i.flags)){e.msg="unknown compression method",i.mode=30;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=30;break}i.head&&(i.head.text=u>>8&1),512&i.flags&&(M[0]=255&u,M[1]=u>>>8&255,i.check=D(i.check,M,2,0)),c=u=0,i.mode=3;case 3:for(;c<32;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}i.head&&(i.head.time=u),512&i.flags&&(M[0]=255&u,M[1]=u>>>8&255,M[2]=u>>>16&255,M[3]=u>>>24&255,i.check=D(i.check,M,4,0)),c=u=0,i.mode=4;case 4:for(;c<16;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}i.head&&(i.head.xflags=255&u,i.head.os=u>>8),512&i.flags&&(M[0]=255&u,M[1]=u>>>8&255,i.check=D(i.check,M,2,0)),c=u=0,i.mode=5;case 5:if(1024&i.flags){for(;c<16;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}i.length=u,i.head&&(i.head.extra_len=u),512&i.flags&&(M[0]=255&u,M[1]=u>>>8&255,i.check=D(i.check,M,2,0)),c=u=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&((p=a<(p=i.length)?a:p)&&(i.head&&(w=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),T.arraySet(i.head.extra,r,o,p,w)),512&i.flags&&(i.check=D(i.check,r,p,o)),a-=p,o+=p,i.length-=p),i.length))break e;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===a)break e;for(p=0;w=r[o+p++],i.head&&w&&i.length<65536&&(i.head.name+=String.fromCharCode(w)),w&&p<a;);if(512&i.flags&&(i.check=D(i.check,r,p,o)),a-=p,o+=p,w)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===a)break e;for(p=0;w=r[o+p++],i.head&&w&&i.length<65536&&(i.head.comment+=String.fromCharCode(w)),w&&p<a;);if(512&i.flags&&(i.check=D(i.check,r,p,o)),a-=p,o+=p,w)break e}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;c<16;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}if(u!==(65535&i.check)){e.msg="header crc mismatch",i.mode=30;break}c=u=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=12;break;case 10:for(;c<32;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}e.adler=i.check=k(u),c=u=0,i.mode=11;case 11:if(0===i.havedict)return e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=a,i.hold=u,i.bits=c,2;e.adler=i.check=1,i.mode=12;case 12:if(5===t||6===t)break e;case 13:if(i.last)u>>>=7&c,c-=7&c,i.mode=27;else{for(;c<3;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}switch(i.last=1&u,--c,3&(u>>>=1)){case 0:i.mode=14;break;case 1:S=P=void 0;var S,P=i;if(V){for(H=new T.Buf32(512),Q=new T.Buf32(32),S=0;S<144;)P.lens[S++]=8;for(;S<256;)P.lens[S++]=9;for(;S<280;)P.lens[S++]=7;for(;S<288;)P.lens[S++]=8;for(N(1,P.lens,0,288,H,0,P.work,{bits:9}),S=0;S<32;)P.lens[S++]=5;N(2,P.lens,0,32,Q,0,P.work,{bits:5}),V=!1}if(P.lencode=H,P.lenbits=9,P.distcode=Q,P.distbits=5,i.mode=20,6!==t)break;u>>>=2,c-=2;break e;case 2:i.mode=17;break;case 3:e.msg="invalid block type",i.mode=30}u>>>=2,c-=2}break;case 14:for(u>>>=7&c,c-=7&c;c<32;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",i.mode=30;break}if(i.length=65535&u,c=u=0,i.mode=15,6===t)break e;case 15:i.mode=16;case 16:if(p=i.length){if(0===(p=l<(p=a<p?a:p)?l:p))break e;T.arraySet(n,r,o,p,s),a-=p,o+=p,l-=p,s+=p,i.length-=p}else i.mode=12;break;case 17:for(;c<14;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}if(i.nlen=257+(31&u),u>>>=5,c-=5,i.ndist=1+(31&u),u>>>=5,c-=5,i.ncode=4+(15&u),u>>>=4,c-=4,286<i.nlen||30<i.ndist){e.msg="too many length or distance symbols",i.mode=30;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;c<3;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}i.lens[I[i.have++]]=7&u,u>>>=3,c-=3}for(;i.have<19;)i.lens[I[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,b={bits:i.lenbits},x=N(0,i.lens,0,19,i.lencode,0,i.work,b),i.lenbits=b.bits,x){e.msg="invalid code lengths set",i.mode=30;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;m=(B=i.lencode[u&(1<<i.lenbits)-1])>>>16&255,y=65535&B,!((g=B>>>24)<=c);){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}if(y<16)u>>>=g,c-=g,i.lens[i.have++]=y;else{if(16===y){for(E=g+2;c<E;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}if(u>>>=g,c-=g,0===i.have){e.msg="invalid bit length repeat",i.mode=30;break}w=i.lens[i.have-1],p=3+(3&u),u>>>=2,c-=2}else if(17===y){for(E=g+3;c<E;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}w=0,p=3+(7&(u>>>=g)),u>>>=3,c=c-g-3}else{for(E=g+7;c<E;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}w=0,p=11+(127&(u>>>=g)),u>>>=7,c=c-g-7}if(i.have+p>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=30;break}for(;p--;)i.lens[i.have++]=w}}if(30===i.mode)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=30;break}if(i.lenbits=9,b={bits:i.lenbits},x=N(1,i.lens,0,i.nlen,i.lencode,0,i.work,b),i.lenbits=b.bits,x){e.msg="invalid literal/lengths set",i.mode=30;break}if(i.distbits=6,i.distcode=i.distdyn,b={bits:i.distbits},x=N(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,b),i.distbits=b.bits,x){e.msg="invalid distances set",i.mode=30;break}if(i.mode=20,6===t)break e;case 20:i.mode=21;case 21:if(6<=a&&258<=l){e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=a,i.hold=u,i.bits=c,F(e,A),s=e.next_out,n=e.output,l=e.avail_out,o=e.next_in,r=e.input,a=e.avail_in,u=i.hold,c=i.bits,12===i.mode&&(i.back=-1);break}for(i.back=0;m=(B=i.lencode[u&(1<<i.lenbits)-1])>>>16&255,y=65535&B,!((g=B>>>24)<=c);){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}if(m&&0==(240&m)){for(_=g,v=m,C=y;m=(B=i.lencode[C+((u&(1<<_+v)-1)>>_)])>>>16&255,y=65535&B,!(_+(g=B>>>24)<=c);){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}u>>>=_,c-=_,i.back+=_}if(u>>>=g,c-=g,i.back+=g,i.length=y,0===m){i.mode=26;break}if(32&m){i.back=-1,i.mode=12;break}if(64&m){e.msg="invalid literal/length code",i.mode=30;break}i.extra=15&m,i.mode=22;case 22:if(i.extra){for(E=i.extra;c<E;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}i.length+=u&(1<<i.extra)-1,u>>>=i.extra,c-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;m=(B=i.distcode[u&(1<<i.distbits)-1])>>>16&255,y=65535&B,!((g=B>>>24)<=c);){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}if(0==(240&m)){for(_=g,v=m,C=y;m=(B=i.distcode[C+((u&(1<<_+v)-1)>>_)])>>>16&255,y=65535&B,!(_+(g=B>>>24)<=c);){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}u>>>=_,c-=_,i.back+=_}if(u>>>=g,c-=g,i.back+=g,64&m){e.msg="invalid distance code",i.mode=30;break}i.offset=y,i.extra=15&m,i.mode=24;case 24:if(i.extra){for(E=i.extra;c<E;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}i.offset+=u&(1<<i.extra)-1,u>>>=i.extra,c-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=30;break}i.mode=25;case 25:if(0===l)break e;if(i.offset>(p=A-l)){if((p=i.offset-p)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=30;break}f=p>i.wnext?(p-=i.wnext,i.wsize-p):i.wnext-p,p>i.length&&(p=i.length),d=i.window}else d=n,f=s-i.offset,p=i.length;for(l-=p=l<p?l:p,i.length-=p;n[s++]=d[f++],--p;);0===i.length&&(i.mode=21);break;case 26:if(0===l)break e;n[s++]=i.length,l--,i.mode=21;break;case 27:if(i.wrap){for(;c<32;){if(0===a)break e;a--,u|=r[o++]<<c,c+=8}if(A-=l,e.total_out+=A,i.total+=A,A&&(e.adler=i.check=(i.flags?D:L)(i.check,n,A,s-A)),A=l,(i.flags?u:k(u))!==i.check){e.msg="incorrect data check",i.mode=30;break}c=u=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;c<32;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}if(u!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=30;break}c=u=0}i.mode=29;case 29:x=1;break e;case 30:x=-3;break e;case 31:return-4;default:return R}return e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=a,i.hold=u,i.bits=c,(i.wsize||A!==e.avail_out&&i.mode<30&&(i.mode<27||4!==t))&&G(e,e.output,e.next_out,A-e.avail_out)?(i.mode=31,-4):(h-=e.avail_in,A-=e.avail_out,e.total_in+=h,e.total_out+=A,i.total+=A,i.wrap&&A&&(e.adler=i.check=(i.flags?D:L)(i.check,n,A,e.next_out-A)),e.data_type=i.bits+(i.last?64:0)+(12===i.mode?128:0)+(20===i.mode||15===i.mode?256:0),x=(0==h&&0===A||4===t)&&x===O?-5:x)},i.inflateEnd=function(e){var t;return e&&e.state?((t=e.state).window&&(t.window=null),e.state=null,O):R},i.inflateGetHeader=function(e,t){return!e||!e.state||0==(2&(e=e.state).wrap)?R:((e.head=t).done=!1,O)},i.inflateSetDictionary=function(e,t){var i,r=t.length;return!e||!e.state||0!==(i=e.state).wrap&&11!==i.mode?R:11===i.mode&&L(1,t,r,0)!==i.check?-3:G(e,t,r,r)?(i.mode=31,-4):(i.havedict=1,O)},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,i){"use strict";var F=e("../utils/common"),N=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],O=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],R=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],U=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,i,r,n,o,s,a){for(var l,u,c,h,A,p,f,d,g,m=a.bits,y=0,_=0,v=0,C=0,w=0,x=0,b=0,E=0,B=0,M=0,I=null,S=0,P=new F.Buf16(16),T=new F.Buf16(16),L=null,D=0,y=0;y<=15;y++)P[y]=0;for(_=0;_<r;_++)P[t[i+_]]++;for(w=m,C=15;1<=C&&0===P[C];C--);if(C<w&&(w=C),0===C)n[o++]=20971520,n[o++]=20971520,a.bits=1;else{for(v=1;v<C&&0===P[v];v++);for(w<v&&(w=v),y=E=1;y<=15;y++)if((E=(E<<1)-P[y])<0)return-1;if(0<E&&(0===e||1!==C))return-1;for(T[1]=0,y=1;y<15;y++)T[y+1]=T[y]+P[y];for(_=0;_<r;_++)0!==t[i+_]&&(s[T[t[i+_]]++]=_);if(p=0===e?(I=L=s,19):1===e?(I=N,S-=257,L=O,D-=257,256):(I=R,L=U,-1),y=v,A=o,b=_=M=0,c=-1,h=(B=1<<(x=w))-1,1===e&&852<B||2===e&&592<B)return 1;for(;;){for(g=s[_]<p?(d=0,s[_]):s[_]>p?(d=L[D+s[_]],I[S+s[_]]):(d=96,0),l=1<<(f=y-b),v=u=1<<x;n[A+(M>>b)+(u-=l)]=f<<24|d<<16|g|0,0!==u;);for(l=1<<y-1;M&l;)l>>=1;if(0!==l?M=(M&l-1)+l:M=0,_++,0==--P[y]){if(y===C)break;y=t[i+s[_]]}if(w<y&&(M&h)!==c){for(A+=v,E=1<<(x=y-(b=0===b?w:b));x+b<C&&!((E-=P[x+b])<=0);)x++,E<<=1;if(B+=1<<x,1===e&&852<B||2===e&&592<B)return 1;n[c=M&h]=w<<24|x<<16|A-o|0}}0!==M&&(n[A+M]=y-b<<24|64<<16|0),a.bits=w}return 0}},{"../utils/common":41}],51:[function(e,t,i){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,O,t){"use strict";var n=e("../utils/common");function i(e){for(var t=e.length;0<=--t;)e[t]=0}var r=16,l=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],u=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],c=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],h=new Array(576),A=(i(h),new Array(60)),p=(i(A),new Array(512)),f=(i(p),new Array(256)),d=(i(f),new Array(29));i(d);var g,m,y,_=new Array(30);function v(e,t,i,r,n){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=r,this.max_length=n,this.has_stree=e&&e.length}function C(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function w(e){return e<256?p[e]:p[256+(e>>>7)]}function o(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function x(e,t,i){e.bi_valid>r-i?(e.bi_buf|=t<<e.bi_valid&65535,o(e,e.bi_buf),e.bi_buf=t>>r-e.bi_valid,e.bi_valid+=i-r):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function b(e,t,i){x(e,i[2*t],i[2*t+1])}function E(e,t){for(var i=0;i|=1&e,e>>>=1,i<<=1,0<--t;);return i>>>1}function B(e,t,i){for(var r,n=new Array(16),o=0,s=1;s<=15;s++)n[s]=o=o+i[s-1]<<1;for(r=0;r<=t;r++){var a=e[2*r+1];0!==a&&(e[2*r]=E(n[a]++,a))}}function M(e){for(var t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function I(e){8<e.bi_valid?o(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function s(e,t,i,r){var n=2*t,o=2*i;return e[n]<e[o]||e[n]===e[o]&&r[t]<=r[i]}function S(e,t,i){for(var r=e.heap[i],n=i<<1;n<=e.heap_len&&(n<e.heap_len&&s(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!s(t,r,e.heap[n],e.depth));)e.heap[i]=e.heap[n],i=n,n<<=1;e.heap[i]=r}function P(e,t,i){var r,n,o,s,a=0;if(0!==e.last_lit)for(;r=e.pending_buf[e.d_buf+2*a]<<8|e.pending_buf[e.d_buf+2*a+1],n=e.pending_buf[e.l_buf+a],a++,0==r?b(e,n,t):(b(e,(o=f[n])+256+1,t),0!==(s=l[o])&&x(e,n-=d[o],s),b(e,o=w(--r),i),0!==(s=u[o])&&x(e,r-=_[o],s)),a<e.last_lit;);b(e,256,t)}function T(e,t){var i,r,n,o=t.dyn_tree,s=t.stat_desc.static_tree,a=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=573,i=0;i<l;i++)0!==o[2*i]?(e.heap[++e.heap_len]=u=i,e.depth[i]=0):o[2*i+1]=0;for(;e.heap_len<2;)o[2*(n=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[n]=0,e.opt_len--,a&&(e.static_len-=s[2*n+1]);for(t.max_code=u,i=e.heap_len>>1;1<=i;i--)S(e,o,i);for(n=l;i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],S(e,o,1),r=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=r,o[2*n]=o[2*i]+o[2*r],e.depth[n]=(e.depth[i]>=e.depth[r]?e.depth[i]:e.depth[r])+1,o[2*i+1]=o[2*r+1]=n,e.heap[1]=n++,S(e,o,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1];for(var c,h,A,p,f,d=e,g=t.dyn_tree,m=t.max_code,y=t.stat_desc.static_tree,_=t.stat_desc.has_stree,v=t.stat_desc.extra_bits,C=t.stat_desc.extra_base,w=t.stat_desc.max_length,x=0,b=0;b<=15;b++)d.bl_count[b]=0;for(g[2*d.heap[d.heap_max]+1]=0,c=d.heap_max+1;c<573;c++)w<(b=g[2*g[2*(h=d.heap[c])+1]+1]+1)&&(b=w,x++),g[2*h+1]=b,m<h||(d.bl_count[b]++,p=0,C<=h&&(p=v[h-C]),f=g[2*h],d.opt_len+=f*(b+p),_&&(d.static_len+=f*(y[2*h+1]+p)));if(0!==x){do{for(b=w-1;0===d.bl_count[b];)b--}while(d.bl_count[b]--,d.bl_count[b+1]+=2,d.bl_count[w]--,0<(x-=2));for(b=w;0!==b;b--)for(h=d.bl_count[b];0!==h;)m<(A=d.heap[--c])||(g[2*A+1]!==b&&(d.opt_len+=(b-g[2*A+1])*g[2*A],g[2*A+1]=b),h--)}B(o,u,e.bl_count)}function L(e,t,i){var r,n,o=-1,s=t[1],a=0,l=7,u=4;for(0===s&&(l=138,u=3),t[2*(i+1)+1]=65535,r=0;r<=i;r++)n=s,s=t[2*(r+1)+1],++a<l&&n===s||(a<u?e.bl_tree[2*n]+=a:0!==n?(n!==o&&e.bl_tree[2*n]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=n,u=(a=0)===s?(l=138,3):n===s?(l=6,3):(l=7,4))}function D(e,t,i){var r,n,o=-1,s=t[1],a=0,l=7,u=4;for(0===s&&(l=138,u=3),r=0;r<=i;r++)if(n=s,s=t[2*(r+1)+1],!(++a<l&&n===s)){if(a<u)for(;b(e,n,e.bl_tree),0!=--a;);else 0!==n?(n!==o&&(b(e,n,e.bl_tree),a--),b(e,16,e.bl_tree),x(e,a-3,2)):a<=10?(b(e,17,e.bl_tree),x(e,a-3,3)):(b(e,18,e.bl_tree),x(e,a-11,7));o=n,u=(a=0)===s?(l=138,3):n===s?(l=6,3):(l=7,4)}}i(_);var F=!1;function N(e,t,i,r){x(e,0+(r?1:0),3),r=t,t=i,I(i=e),o(i,t),o(i,~t),n.arraySet(i.pending_buf,i.window,r,t,i.pending),i.pending+=t}t._tr_init=function(e){if(!F){for(var t,i,r,n,o=new Array(16),s=r=0;s<28;s++)for(d[s]=r,t=0;t<1<<l[s];t++)f[r++]=s;for(f[r-1]=s,s=n=0;s<16;s++)for(_[s]=n,t=0;t<1<<u[s];t++)p[n++]=s;for(n>>=7;s<30;s++)for(_[s]=n<<7,t=0;t<1<<u[s]-7;t++)p[256+n++]=s;for(i=0;i<=15;i++)o[i]=0;for(t=0;t<=143;)h[2*t+1]=8,t++,o[8]++;for(;t<=255;)h[2*t+1]=9,t++,o[9]++;for(;t<=279;)h[2*t+1]=7,t++,o[7]++;for(;t<=287;)h[2*t+1]=8,t++,o[8]++;for(B(h,287,o),t=0;t<30;t++)A[2*t+1]=5,A[2*t]=E(t,5);g=new v(h,l,257,286,15),m=new v(A,u,0,30,15),y=new v(new Array(0),a,0,19,7),F=!0}e.l_desc=new C(e.dyn_ltree,g),e.d_desc=new C(e.dyn_dtree,m),e.bl_desc=new C(e.bl_tree,y),e.bi_buf=0,e.bi_valid=0,M(e)},t._tr_stored_block=N,t._tr_flush_block=function(e,t,i,r){var n,o,s,a=0;if(0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){for(var t=4093624447,i=0;i<=31;i++,t>>>=1)if(1&t&&0!==e.dyn_ltree[2*i])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(i=32;i<256;i++)if(0!==e.dyn_ltree[2*i])return 1;return 0}(e)),T(e,e.l_desc),T(e,e.d_desc),a=function(e){var t;for(L(e,e.dyn_ltree,e.l_desc.max_code),L(e,e.dyn_dtree,e.d_desc.max_code),T(e,e.bl_desc),t=18;3<=t&&0===e.bl_tree[2*c[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),n=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=n&&(n=o)):n=o=i+5,i+4<=n&&-1!==t)N(e,t,i,r);else if(4===e.strategy||o===n)x(e,2+(r?1:0),3),P(e,h,A);else{x(e,4+(r?1:0),3);var l=e,u=(t=e.l_desc.max_code+1,i=e.d_desc.max_code+1,a+1);for(x(l,t-257,5),x(l,i-1,5),x(l,u-4,4),s=0;s<u;s++)x(l,l.bl_tree[2*c[s]+1],3);D(l,l.dyn_ltree,t-1),D(l,l.dyn_dtree,i-1),P(e,e.dyn_ltree,e.dyn_dtree)}M(e),r&&I(e)},t._tr_tally=function(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(f[i]+256+1)]++,e.dyn_dtree[2*w(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){x(e,2,3),b(e,256,h),16===(e=e).bi_valid?(o(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}},{"../utils/common":41}],53:[function(e,t,i){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,i){"use strict";t.exports="function"==typeof n?n:function(){var e=[].slice.apply(arguments);e.splice(1,0,0),setTimeout.apply(null,e)}},{}]},{},[10])(10)})}.call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)})}.call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)})}.call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)})}.call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)})}.call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)})}.call(this)}.call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},u("buffer").Buffer,u("timers").setImmediate)},{buffer:8,timers:22}],12:[function(e,t,i){"use strict";var n=e("immediate");function l(){}var u={},o=["REJECTED"],s=["FULFILLED"],r=["PENDING"];function a(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=r,this.queue=[],this.outcome=void 0,e!==l&&p(this,e)}function c(e,t,i){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function h(t,i,r){n(function(){var e;try{e=i(r)}catch(e){return u.reject(t,e)}e===t?u.reject(t,new TypeError("Cannot resolve promise with itself")):u.resolve(t,e)})}function A(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function p(t,e){var i=!1;function r(e){i||(i=!0,u.reject(t,e))}function n(e){i||(i=!0,u.resolve(t,e))}var o=f(function(){e(n,r)});"error"===o.status&&r(o.value)}function f(e,t){var i={};try{i.value=e(t),i.status="success"}catch(e){i.status="error",i.value=e}return i}(t.exports=a).prototype.finally=function(t){var i;return"function"!=typeof t?this:(i=this.constructor,this.then(function(e){return i.resolve(t()).then(function(){return e})},function(e){return i.resolve(t()).then(function(){throw e})}))},a.prototype.catch=function(e){return this.then(null,e)},a.prototype.then=function(e,t){var i;return"function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===o?this:(i=new this.constructor(l),this.state!==r?h(i,this.state===s?e:t,this.outcome):this.queue.push(new c(i,e,t)),i)},c.prototype.callFulfilled=function(e){u.resolve(this.promise,e)},c.prototype.otherCallFulfilled=function(e){h(this.promise,this.onFulfilled,e)},c.prototype.callRejected=function(e){u.reject(this.promise,e)},c.prototype.otherCallRejected=function(e){h(this.promise,this.onRejected,e)},u.resolve=function(e,t){var i=f(A,t);if("error"===i.status)return u.reject(e,i.value);i=i.value;if(i)p(e,i);else{e.state=s,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callFulfilled(t)}return e},u.reject=function(e,t){e.state=o,e.outcome=t;for(var i=-1,r=e.queue.length;++i<r;)e.queue[i].callRejected(t);return e},a.resolve=function(e){if(e instanceof this)return e;return u.resolve(new this(l),e)},a.reject=function(e){var t=new this(l);return u.reject(t,e)},a.all=function(e){var i=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);var o=new Array(r),s=0,t=-1,a=new this(l);for(;++t<r;)!function(e,t){i.resolve(e).then(function(e){o[t]=e,++s!==r||n||(n=!0,u.resolve(a,o))},function(e){n||(n=!0,u.reject(a,e))})}(e[t],t);return a},a.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var i=e.length,r=!1;if(!i)return this.resolve([]);var n=-1,o=new this(l);for(;++n<i;)!function(e){t.resolve(e).then(function(e){r||(r=!0,u.resolve(o,e))},function(e){r||(r=!0,u.reject(o,e))})}(e[n]);return o}},{immediate:10}],13:[function(e,A,t){!function(){function o(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function i(){return 1}"object"==typeof A&&A.exports?A.exports=r:this.LRUCache=r;var t=!1;function s(e){t||"string"==typeof e||"number"==typeof e||(t=!0,console.error(new TypeError("LRU: key must be a string or number. Almost certainly a bug! "+typeof e).stack))}function r(e){if(!(this instanceof r))return new r(e);this._max=(e=(e="number"==typeof e?{max:e}:e)||{}).max,(!this._max||"number"!=typeof this._max||this._max<=0)&&(this._max=1/0),this._lengthCalculator=e.length||i,"function"!=typeof this._lengthCalculator&&(this._lengthCalculator=i),this._allowStale=e.stale||!1,this._maxAge=e.maxAge||null,this._dispose=e.dispose,this.reset()}function n(e,t,i){s(t);t=e._cache[t];return t&&(a(e,t)?(c(e,t),e._allowStale||(t=void 0)):i&&(u(i=e,e=t),e.lu=i._mru++,i._lruList[e.lu]=e),t=t&&t.value),t}function a(e,t){var i;if(t&&(t.maxAge||e._maxAge))return i=Date.now()-t.now,t.maxAge?i>t.maxAge:e._maxAge&&i>e._maxAge}function l(e){for(;e._lru<e._mru&&e._length>e._max;)c(e,e._lruList[e._lru])}function u(e,t){for(delete e._lruList[t.lu];e._lru<e._mru&&!e._lruList[e._lru];)e._lru++}function c(e,t){t&&(e._dispose&&e._dispose(t.key,t.value),e._length-=t.length,e._itemCount--,delete e._cache[t.key],u(e,t))}function h(e,t,i,r,n,o){this.key=e,this.value=t,this.lu=i,this.length=r,this.now=n,o&&(this.maxAge=o)}Object.defineProperty(r.prototype,"max",{set:function(e){this._max=e=!e||"number"!=typeof e||e<=0?1/0:e,this._length>this._max&&l(this)},get:function(){return this._max},enumerable:!0}),Object.defineProperty(r.prototype,"lengthCalculator",{set:function(e){if("function"!=typeof e)for(var t in this._lengthCalculator=i,this._length=this._itemCount,this._cache)this._cache[t].length=1;else for(var t in this._lengthCalculator=e,this._length=0,this._cache)this._cache[t].length=this._lengthCalculator(this._cache[t].value),this._length+=this._cache[t].length;this._length>this._max&&l(this)},get:function(){return this._lengthCalculator},enumerable:!0}),Object.defineProperty(r.prototype,"length",{get:function(){return this._length},enumerable:!0}),Object.defineProperty(r.prototype,"itemCount",{get:function(){return this._itemCount},enumerable:!0}),r.prototype.forEach=function(e,t){t=t||this;for(var i,r=0,n=this._itemCount,o=this._mru-1;0<=o&&r<n;o--)this._lruList[o]&&(r++,a(this,i=this._lruList[o])&&(c(this,i),this._allowStale||(i=void 0)),i)&&e.call(t,i.value,i.key,this)},r.prototype.keys=function(){for(var e,t=new Array(this._itemCount),i=0,r=this._mru-1;0<=r&&i<this._itemCount;r--)this._lruList[r]&&(e=this._lruList[r],t[i++]=e.key);return t},r.prototype.values=function(){for(var e,t=new Array(this._itemCount),i=0,r=this._mru-1;0<=r&&i<this._itemCount;r--)this._lruList[r]&&(e=this._lruList[r],t[i++]=e.value);return t},r.prototype.reset=function(){if(this._dispose&&this._cache)for(var e in this._cache)this._dispose(e,this._cache[e].value);this._cache=Object.create(null),this._lruList=Object.create(null),this._mru=0,this._lru=0,this._length=0,this._itemCount=0},r.prototype.dump=function(){for(var e,t=[],i=0,r=this._mru-1;0<=r&&i<this._itemCount;r--)!this._lruList[r]||a(this,e=this._lruList[r])||(++i,t.push({k:e.key,v:e.value,e:e.now+(e.maxAge||0)}));return t},r.prototype.dumpLru=function(){return this._lruList},r.prototype.set=function(e,t,i){i=i||this._maxAge,s(e);var r=i?Date.now():0,n=this._lengthCalculator(t);return o(this._cache,e)?n>this._max?(c(this,this._cache[e]),!1):(this._dispose&&this._dispose(e,this._cache[e].value),this._cache[e].now=r,this._cache[e].maxAge=i,this._cache[e].value=t,this._length+=n-this._cache[e].length,this._cache[e].length=n,this.get(e),this._length>this._max&&l(this),!0):(n=new h(e,t,this._mru++,n,r,i)).length>this._max?(this._dispose&&this._dispose(e,t),!1):(this._length+=n.length,this._lruList[n.lu]=this._cache[e]=n,this._itemCount++,this._length>this._max&&l(this),!0)},r.prototype.has=function(e){return s(e),!!o(this._cache,e)&&!a(this,this._cache[e])},r.prototype.get=function(e){return s(e),n(this,e,!0)},r.prototype.peek=function(e){return s(e),n(this,e,!1)},r.prototype.pop=function(){var e=this._lruList[this._lru];return c(this,e),e||null},r.prototype.del=function(e){s(e),c(this,this._cache[e])},r.prototype.load=function(e){this.reset();for(var t=Date.now(),i=e.length-1;0<=i;i--){var r=e[i],n=(s(r.k),r.e||0);0===n?this.set(r.k,r.v):0<(n=n-t)&&this.set(r.k,r.v,n)}}}()},{}],14:[function(e,t,i){e("text-encoding-polyfill");var r=e("string_decoder").StringDecoder;function o(e){var t=new r;return(t.write(e)+t.end()).replace(/\0/g,"").trim()}t.exports=function t(i,r){if(!i)return o;try{new TextDecoder(i.trim())}catch(e){var n=s.exec(i);return n&&!r?t("windows-"+n[1],!0):o}return e;function e(e){var t=new TextDecoder(i),e=t.decode(e,{stream:!0})+t.decode();return e.replace(/\0/g,"").trim()}};var s=/^(?:ANSI\s)?(\d+)$/m},{string_decoder:19,"text-encoding-polyfill":20}],15:[function(e,t,i){var u=e("./decoder");function c(e,t,i,r){for(var n,o,s={},a=0,l=i.length;a<l;)n=function(e,t,i,r,n){var o=n(e.slice(t,t+i));switch(r){case"N":case"F":case"O":return parseFloat(o,10);case"D":return new Date(o.slice(0,4),parseInt(o.slice(4,6),10)-1,o.slice(6,8));case"L":return"y"===o.toLowerCase()||"t"===o.toLowerCase();default:return o}}(e,t,(o=i[a]).len,o.dataType,r),t+=o.len,void 0!==n&&(s[o.name]=n),a++;return s}t.exports=function(e,t){for(var i,r=u(t),t=(t=e,(i={}).lastUpdated=new Date(t.readUInt8(1)+1900,t.readUInt8(2),t.readUInt8(3)),i.records=t.readUInt32LE(4),i.headerLen=t.readUInt16LE(8),i.recLen=t.readUInt16LE(10),i),n=function(e,t,i){for(var r=[],n=32;n<t&&(r.push({name:i(e.slice(n,n+11)),dataType:String.fromCharCode(e.readUInt8(n+11)),len:e.readUInt8(n+16),decimal:e.readUInt8(n+17)}),13!==e.readUInt8(n+32));)n+=32;return r}(e,t.headerLen-1,r),o=2+(n.length+1<<5),s=t.recLen,a=t.records,l=[];a;)l.push(c(e,o,n,r)),o+=s,a--;return l}},{"./decoder":14}],16:[function(e,t,i){var r,n,t=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}function a(t){if(r===setTimeout)return setTimeout(t,0);if((r===o||!r)&&setTimeout)return(r=setTimeout)(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}var l,u=[],c=!1,h=-1;function A(){c&&l&&(c=!1,l.length?u=l.concat(u):h=-1,u.length)&&p()}function p(){if(!c){for(var e=a(A),t=(c=!0,u.length);t;){for(l=u,u=[];++h<t;)l&&l[h].run();h=-1,t=u.length}l=null,c=!1,!function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return(n=clearTimeout)(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function d(){}t.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];u.push(new f(e,t)),1!==u.length||c||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={},t.on=d,t.addListener=d,t.once=d,t.off=d,t.removeListener=d,t.removeAllListeners=d,t.emit=d,t.prependListener=d,t.prependOnceListener=d,t.listeners=function(e){return[]},t.binding=function(e){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(e){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}},{}],17:[function(e,t,i){var r,n;r=this,n=function(){"use strict";var d=1,g=2,R=3,U=4,k=5,H=6378137,Q=6356752.314,V=.0066943799901413165,x=484813681109536e-20,m=Math.PI/2,G=.16666666666666666,z=.04722222222222222,W=.022156084656084655,y=1e-10,_=.017453292519943295,A=57.29577951308232,v=Math.PI/4,C=2*Math.PI,u=3.14159265359,q={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},K={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},j=/[\s_\-\/\(\)]/g;function w(e,t){if(e[t])return e[t];for(var i,r=Object.keys(e),n=t.toLowerCase().replace(j,""),o=-1;++o<r.length;)if((i=r[o]).toLowerCase().replace(j,"")===n)return e[i]}var Z=function(e){var t,i,r,n={},o=e.split("+").map(function(e){return e.trim()}).filter(function(e){return e}).reduce(function(e,t){t=t.split("=");return t.push(!0),e[t[0].toLowerCase()]=t[1],e},{}),s={proj:"projName",datum:"datumCode",rf:function(e){n.rf=parseFloat(e)},lat_0:function(e){n.lat0=e*_},lat_1:function(e){n.lat1=e*_},lat_2:function(e){n.lat2=e*_},lat_ts:function(e){n.lat_ts=e*_},lon_0:function(e){n.long0=e*_},lon_1:function(e){n.long1=e*_},lon_2:function(e){n.long2=e*_},alpha:function(e){n.alpha=parseFloat(e)*_},gamma:function(e){n.rectified_grid_angle=parseFloat(e)},lonc:function(e){n.longc=e*_},x_0:function(e){n.x0=parseFloat(e)},y_0:function(e){n.y0=parseFloat(e)},k_0:function(e){n.k0=parseFloat(e)},k:function(e){n.k0=parseFloat(e)},a:function(e){n.a=parseFloat(e)},b:function(e){n.b=parseFloat(e)},r_a:function(){n.R_A=!0},zone:function(e){n.zone=parseInt(e,10)},south:function(){n.utmSouth=!0},towgs84:function(e){n.datum_params=e.split(",").map(function(e){return parseFloat(e)})},to_meter:function(e){n.to_meter=parseFloat(e)},units:function(e){e=w(K,n.units=e);e&&(n.to_meter=e.to_meter)},from_greenwich:function(e){n.from_greenwich=e*_},pm:function(e){var t=w(q,e);n.from_greenwich=(t||parseFloat(e))*_},nadgrids:function(e){"@null"===e?n.datumCode="none":n.nadgrids=e},axis:function(e){var t="ewnsud";3===e.length&&-1!==t.indexOf(e.substr(0,1))&&-1!==t.indexOf(e.substr(1,1))&&-1!==t.indexOf(e.substr(2,1))&&(n.axis=e)},approx:function(){n.approx=!0}};for(t in o)i=o[t],t in s?"function"==typeof(r=s[t])?r(i):n[r]=i:n[t]=i;return"string"==typeof n.datumCode&&"WGS84"!==n.datumCode&&(n.datumCode=n.datumCode.toLowerCase()),n},i=/\s/,Y=/[A-Za-z]/,X=/[A-Za-z84]/,J=/[,\]]/,$=/[\d\.E\-\+]/;function r(e){if("string"!=typeof e)throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=1}function ee(e,t,i){Array.isArray(t)&&(i.unshift(t),t=null);i=i.reduce(function(e,t){return n(t,e),e},t?{}:e);t&&(e[t]=i)}function n(e,t){if(Array.isArray(e)){var i,r=e.shift();if("PARAMETER"===r&&(r=e.shift()),1===e.length)return Array.isArray(e[0])?(t[r]={},void n(e[0],t[r])):void(t[r]=e[0]);if(e.length)if("TOWGS84"===r)t[r]=e;else if("AXIS"===r)r in t||(t[r]=[]),t[r].push(e);else switch(Array.isArray(r)||(t[r]={}),r){case"UNIT":case"PRIMEM":case"VERT_DATUM":return t[r]={name:e[0].toLowerCase(),convert:e[1]},void(3===e.length&&n(e[2],t[r]));case"SPHEROID":case"ELLIPSOID":return t[r]={name:e[0],a:e[1],rf:e[2]},void(4===e.length&&n(e[3],t[r]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return e[0]=["name",e[0]],void ee(t,r,e);default:for(i=-1;++i<e.length;)if(!Array.isArray(e[i]))return n(e,t[r]);return ee(t,r,e)}else t[r]=!0}else t[e]=!0}r.prototype.readCharicter=function(){var e=this.text[this.place++];if(4!==this.state)for(;i.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case 1:return this.neutral(e);case 2:return this.keyword(e);case 4:return this.quoted(e);case 5:return this.afterquote(e);case 3:return this.number(e);case-1:return}},r.prototype.afterquote=function(e){if('"'===e)this.word+='"',this.state=4;else{if(!J.test(e))throw new Error("havn't handled \""+e+'" in afterquote yet, index '+this.place);this.word=this.word.trim(),this.afterItem(e)}},r.prototype.afterItem=function(e){","===e?(null!==this.word&&this.currentObject.push(this.word),this.word=null,this.state=1):"]"===e&&(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=1,this.currentObject=this.stack.pop(),this.currentObject||(this.state=-1))},r.prototype.number=function(e){if($.test(e))this.word+=e;else{if(!J.test(e))throw new Error("havn't handled \""+e+'" in number yet, index '+this.place);this.word=parseFloat(this.word),this.afterItem(e)}},r.prototype.quoted=function(e){'"'===e?this.state=5:this.word+=e},r.prototype.keyword=function(e){var t;if(X.test(e))this.word+=e;else if("["===e)(t=[]).push(this.word),this.level++,null===this.root?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,this.state=1;else{if(!J.test(e))throw new Error("havn't handled \""+e+'" in keyword yet, index '+this.place);this.afterItem(e)}},r.prototype.neutral=function(e){if(Y.test(e))this.word=e,this.state=2;else if('"'===e)this.word="",this.state=4;else if($.test(e))this.word=e,this.state=3;else{if(!J.test(e))throw new Error("havn't handled \""+e+'" in neutral yet, index '+this.place);this.afterItem(e)}},r.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function a(e){return.017453292519943295*e}function te(n){if("GEOGCS"===n.type?n.projName="longlat":"LOCAL_CS"===n.type?(n.projName="identity",n.local=!0):"object"==typeof n.PROJECTION?n.projName=Object.keys(n.PROJECTION)[0]:n.projName=n.PROJECTION,n.AXIS){for(var e="",t=0,i=n.AXIS.length;t<i;++t){var r=[n.AXIS[t][0].toLowerCase(),n.AXIS[t][1].toLowerCase()];-1!==r[0].indexOf("north")||("y"===r[0]||"lat"===r[0])&&"north"===r[1]?e+="n":-1!==r[0].indexOf("south")||("y"===r[0]||"lat"===r[0])&&"south"===r[1]?e+="s":-1!==r[0].indexOf("east")||("x"===r[0]||"lon"===r[0])&&"east"===r[1]?e+="e":-1===r[0].indexOf("west")&&("x"!==r[0]&&"lon"!==r[0]||"west"!==r[1])||(e+="w")}2===e.length&&(e+="u"),3===e.length&&(n.axis=e)}n.UNIT&&(n.units=n.UNIT.name.toLowerCase(),"metre"===n.units&&(n.units="meter"),n.UNIT.convert)&&("GEOGCS"===n.type?n.DATUM&&n.DATUM.SPHEROID&&(n.to_meter=n.UNIT.convert*n.DATUM.SPHEROID.a):n.to_meter=n.UNIT.convert);var o=n.GEOGCS;function s(e){return e*(n.to_meter||1)}(o="GEOGCS"===n.type?n:o)&&(o.DATUM?n.datumCode=o.DATUM.name.toLowerCase():n.datumCode=o.name.toLowerCase(),"d_"===n.datumCode.slice(0,2)&&(n.datumCode=n.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==n.datumCode&&"new_zealand_1949"!==n.datumCode||(n.datumCode="nzgd49"),"wgs_1984"!==n.datumCode&&"world_geodetic_system_1984"!==n.datumCode||("Mercator_Auxiliary_Sphere"===n.PROJECTION&&(n.sphere=!0),n.datumCode="wgs84"),"_ferro"===n.datumCode.slice(-6)&&(n.datumCode=n.datumCode.slice(0,-6)),"_jakarta"===n.datumCode.slice(-8)&&(n.datumCode=n.datumCode.slice(0,-8)),~n.datumCode.indexOf("belge")&&(n.datumCode="rnb72"),o.DATUM&&o.DATUM.SPHEROID&&(n.ellps=o.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===n.ellps.toLowerCase().slice(0,13)&&(n.ellps="intl"),n.a=o.DATUM.SPHEROID.a,n.rf=parseFloat(o.DATUM.SPHEROID.rf,10)),o.DATUM&&o.DATUM.TOWGS84&&(n.datum_params=o.DATUM.TOWGS84),~n.datumCode.indexOf("osgb_1936")&&(n.datumCode="osgb36"),~n.datumCode.indexOf("osni_1952")&&(n.datumCode="osni52"),(~n.datumCode.indexOf("tm65")||~n.datumCode.indexOf("geodetic_datum_of_1965"))&&(n.datumCode="ire65"),"ch1903+"===n.datumCode&&(n.datumCode="ch1903"),~n.datumCode.indexOf("israel"))&&(n.datumCode="isr93"),n.b&&!isFinite(n.b)&&(n.b=n.a);[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",a],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",a],["x0","false_easting",s],["y0","false_northing",s],["long0","central_meridian",a],["lat0","latitude_of_origin",a],["lat0","standard_parallel_1",a],["lat1","standard_parallel_1",a],["lat2","standard_parallel_2",a],["azimuth","Azimuth"],["alpha","azimuth",a],["srsCode","name"]].forEach(function(e){var t,i,r;t=n,i=(e=e)[0],r=e[1],!(i in t)&&r in t&&(t[i]=t[r],3===e.length)&&(t[i]=e[2](t[i]))}),n.long0||!n.longc||"Albers_Conic_Equal_Area"!==n.projName&&"Lambert_Azimuthal_Equal_Area"!==n.projName||(n.long0=n.longc),n.lat_ts||!n.lat1||"Stereographic_South_Pole"!==n.projName&&"Polar Stereographic (variant B)"!==n.projName||(n.lat0=a(0<n.lat1?90:-90),n.lat_ts=n.lat1)}var ie=function(e){var e=new r(e).output(),t=e.shift(),i=e.shift(),i=(e.unshift(["name",i]),e.unshift(["type",t]),{});return n(e,i),te(i),i};function o(e){var t=this;if(2===arguments.length){var i=arguments[1];"string"==typeof i?"+"===i.charAt(0)?o[e]=Z(arguments[1]):o[e]=ie(arguments[1]):o[e]=i}else if(1===arguments.length){if(Array.isArray(e))return e.map(function(e){Array.isArray(e)?o.apply(t,e):o(e)});if("string"==typeof e){if(e in o)return o[e]}else"EPSG"in e?o["EPSG:"+e.EPSG]=e:"ESRI"in e?o["ESRI:"+e.ESRI]=e:"IAU2000"in e?o["IAU2000:"+e.IAU2000]=e:console.log(e)}}(e=o)("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"];var re=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];var ne=["3857","900913","3785","102113"];function oe(e){var t,i,r;return"string"==typeof e?e in o?o[e]:(r=e,re.some(function(e){return-1<r.indexOf(e)})?function(e){if(e=w(e,"authority"))return(e=w(e,"epsg"))&&-1<ne.indexOf(e)}(t=ie(e))?o["EPSG:3857"]:(i=function(e){if(e=w(e,"extension"))return w(e,"proj4")}(t))?Z(i):t:"+"===e[0]?Z(e):void 0):e}function se(e,t){var i,r;if(e=e||{},t)for(r in t)void 0!==(i=t[r])&&(e[r]=i)}function s(e,t,i){return e*=t,i/Math.sqrt(1-e*e)}function b(e,t,i){return i*=e,i=Math.pow((1-i)/(1+i),.5*e),Math.tan(.5*(m-t))/i}function l(e,t){for(var i,r=.5*e,n=m-2*Math.atan(t),o=0;o<=15;o++)if(i=e*Math.sin(n),n+=i=m-2*Math.atan(t*Math.pow((1-i)/(1+i),r))-n,Math.abs(i)<=1e-10)return n;return-9999}var p=function(e){return e<0?-1:1},E=function(e){return Math.abs(e)<=u?e:e-p(e)*C};function ae(e){return e}var le=[{init:function(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=s(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(e){var t,i,r=e.x,n=e.y;return 90<n*A&&n*A<-90&&180<r*A&&r*A<-180||Math.abs(Math.abs(n)-m)<=y?null:(i=this.sphere?(t=this.x0+this.a*this.k0*E(r-this.long0),this.y0+this.a*this.k0*Math.log(Math.tan(v+.5*n))):(i=Math.sin(n),n=b(this.e,n,i),t=this.x0+this.a*this.k0*E(r-this.long0),this.y0-this.a*this.k0*Math.log(n)),e.x=t,e.y=i,e)},inverse:function(e){var t=e.x-this.x0,i=e.y-this.y0;if(this.sphere)r=m-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var r,i=Math.exp(-i/(this.a*this.k0));if(-9999===(r=l(this.e,i)))return null}return i=E(this.long0+t/(this.a*this.k0)),e.x=i,e.y=r,e},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:ae,inverse:ae,names:["longlat","identity"]}],ue={},ce=[];function he(e,t){var i=ce.length;return e.names?((ce[i]=e).names.forEach(function(e){ue[e.toLowerCase()]=i}),this):(console.log(t),!0)}var e={start:function(){le.forEach(he)},add:he,get:function(e){return!!e&&(e=e.toLowerCase(),void 0!==ue[e]&&ce[ue[e]]?ce[ue[e]]:void 0)}},Ae={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},pe=Ae.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};Ae.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var B={};B.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},B.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},B.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},B.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},B.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},B.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},B.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},B.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},B.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},B.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},B.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},B.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},B.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},B.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},B.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},B.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},B.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};var fe={};function de(e){var t;return 0===e.length?null:"null"===(e=(t="@"===e[0])?e.slice(1):e)?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:e,mandatory:!t,grid:fe[e]||null,isNull:!1}}function c(e){return e/3600*Math.PI/180}function ge(e,t,i){return String.fromCharCode.apply(null,new Uint8Array(e.buffer.slice(t,i)))}function M(e,t){if(!(this instanceof M))return new M(e);t=t||function(e){if(e)throw e};var i,r,n,o,s,a,l,u,c,h,A,p,f=oe(e);"object"==typeof f&&(i=M.projections.get(f.projName))?(f.datumCode&&"none"!==f.datumCode&&(r=w(B,f.datumCode))&&(f.datum_params=f.datum_params||(r.towgs84?r.towgs84.split(","):null),f.ellps=r.ellipse,f.datumName=r.datumName||f.datumCode),f.k0=f.k0||1,f.axis=f.axis||"enu",f.ellps=f.ellps||"wgs84",f.lat1=f.lat1||f.lat0,r=f.a,o=f.b,a=f.rf,n=f.ellps,l=f.sphere,r||(r=(n=(n=w(Ae,n))||pe).a,o=n.b,a=n.rf),a&&!o&&(o=(1-1/a)*r),(0===a||Math.abs(r-o)<y)&&(l=!0,o=r),o=(n={a:r,b:o,rf:a,sphere:l}).a,a=n.b,l=f.R_A,u=((s=o*o)-(a=a*a))/s,A=0,l?(s=(o*=1-u*(G+u*(z+u*W)))*o,u=0):A=Math.sqrt(u),o={es:u,e:A,ep2:l=(s-a)/a},A=void 0===(u=f.nadgrids)?null:u.split(",").map(de),s=f.datum||(s=f.datumCode,a=f.datum_params,l=n.a,u=n.b,c=o.es,h=o.ep2,A=A,(p={}).datum_type=void 0===s||"none"===s?k:U,a&&(p.datum_params=a.map(parseFloat),0===p.datum_params[0]&&0===p.datum_params[1]&&0===p.datum_params[2]||(p.datum_type=d),3<p.datum_params.length)&&(0===p.datum_params[3]&&0===p.datum_params[4]&&0===p.datum_params[5]&&0===p.datum_params[6]||(p.datum_type=g,p.datum_params[3]*=x,p.datum_params[4]*=x,p.datum_params[5]*=x,p.datum_params[6]=p.datum_params[6]/1e6+1)),A&&(p.datum_type=R,p.grids=A),p.a=l,p.b=u,p.es=c,p.ep2=h,p),se(this,f),se(this,i),this.a=n.a,this.b=n.b,this.rf=n.rf,this.sphere=n.sphere,this.es=o.es,this.e=o.e,this.ep2=o.ep2,this.datum=s,this.init(),t(null,this)):t(e)}function me(e,t,i){var r=e.x,n=e.y,o=e.z||0;if(n<-m&&-1.001*m<n)n=-m;else if(m<n&&n<1.001*m)n=m;else{if(n<-m)return{x:-1/0,y:-1/0,z:e.z};if(m<n)return{x:1/0,y:1/0,z:e.z}}return r>Math.PI&&(r-=2*Math.PI),e=Math.sin(n),n=Math.cos(n),{x:((i=i/Math.sqrt(1-t*(e*e)))+o)*n*Math.cos(r),y:(i+o)*n*Math.sin(r),z:(i*(1-t)+o)*e}}function ye(e,t,i,r){var n,o,s,a,l,u,c,h,A,p,f,d=e.x,g=e.y,m=e.z||0,y=Math.sqrt(d*d+g*g),_=Math.sqrt(d*d+g*g+m*m);if(y/i<1e-12){if(p=0,_/i<1e-12)return f=-r,{x:e.x,y:e.y,z:e.z}}else p=Math.atan2(g,d);for(n=m/_,a=(o=y/_)*(1-t)*(s=1/Math.sqrt(1-t*(2-t)*o*o)),l=n*s,A=0;A++,h=t*(h=i/Math.sqrt(1-t*l*l))/(h+(f=y*a+m*l-h*(1-t*l*l))),h=(c=n*(s=1/Math.sqrt(1-h*(2-h)*o*o)))*a-(u=o*(1-h)*s)*l,a=u,l=c,1e-24<h*h&&A<30;);return{x:p,y:Math.atan(c/Math.abs(u)),z:f}}function _e(e){return e===d||e===g}(M.projections=e).start();function ve(e,t,i){if(n=t,((r=e).datum_type!==n.datum_type||r.a!==n.a||5e-11<Math.abs(r.es-n.es)||(r.datum_type===d?r.datum_params[0]!==n.datum_params[0]||r.datum_params[1]!==n.datum_params[1]||r.datum_params[2]!==n.datum_params[2]:r.datum_type===g&&(r.datum_params[0]!==n.datum_params[0]||r.datum_params[1]!==n.datum_params[1]||r.datum_params[2]!==n.datum_params[2]||r.datum_params[3]!==n.datum_params[3]||r.datum_params[4]!==n.datum_params[4]||r.datum_params[5]!==n.datum_params[5]||r.datum_params[6]!==n.datum_params[6])))&&e.datum_type!==k&&t.datum_type!==k){var r=e.a,n=e.es;if(e.datum_type===R){if(0!==Ce(e,!1,i))return;r=H,n=V}var o,s,a,l,u,c=t.a,h=t.b,A=t.es;if(t.datum_type===R&&(c=H,h=Q,A=V),n!==A||r!==c||_e(e.datum_type)||_e(t.datum_type))if(i=me(i,n,r),_e(e.datum_type)&&(n=i,r=e.datum_type,e=e.datum_params,i=r===d?{x:n.x+e[0],y:n.y+e[1],z:n.z+e[2]}:r===g?(r=e[0],s=e[1],u=e[2],l=e[3],a=e[4],o=e[5],{x:(e=e[6])*(n.x-o*n.y+a*n.z)+r,y:e*(o*n.x+n.y-l*n.z)+s,z:e*(-a*n.x+l*n.y+n.z)+u}):void 0),_e(t.datum_type)&&(r=i,o=t.datum_type,s=t.datum_params,i=o===d?{x:r.x-s[0],y:r.y-s[1],z:r.z-s[2]}:o===g?(o=s[0],e=s[1],a=s[2],l=s[3],n=s[4],u=s[5],s=s[6],{x:(o=(r.x-o)/s)+u*(e=(r.y-e)/s)-n*(r=(r.z-a)/s),y:-u*o+e+l*r,z:n*o-l*e+r}):void 0),i=ye(i,A,c,h),t.datum_type===R)if(0!==Ce(t,!0,i))return}return i}function Ce(e,t,i){if(null===e.grids||0===e.grids.length)return console.log("Grid shift grids not found"),-1;for(var r={x:-i.x,y:i.y},n={x:Number.NaN,y:Number.NaN},o=[],s=0;s<e.grids.length;s++){var a=e.grids[s];if(o.push(a.name),a.isNull){n=r;break}if(null===a.grid){if(a.mandatory)return console.log("Unable to find mandatory grid '"+a.name+"'"),-1}else{var a=a.grid.subgrids[0],l=(Math.abs(a.del[1])+Math.abs(a.del[0]))/1e4,u=a.ll[0]-l,c=a.ll[1]-l,h=a.ll[0]+(a.lim[0]-1)*a.del[0]+l,l=a.ll[1]+(a.lim[1]-1)*a.del[1]+l;if(!(r.y<c||r.x<u||l<r.y||h<r.x||(n=function(e,t,i){var r={x:Number.NaN,y:Number.NaN};if(!isNaN(e.x)){var n={x:e.x,y:e.y},o=(n.x-=i.ll[0],n.y-=i.ll[1],n.x=E(n.x-Math.PI)+Math.PI,we(n,i));if(t){if(isNaN(o.x))return r;o.x=n.x-o.x,o.y=n.y-o.y;var s,a=9;do{if(s=we(o,i),isNaN(s.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}}while(s={x:n.x-(s.x+o.x),y:n.y-(s.y+o.y)},o.x+=s.x,o.y+=s.y,a--&&1e-12<Math.abs(s.x)&&1e-12<Math.abs(s.y));if(a<0)return console.log("Inverse grid shift iterator failed to converge."),r;r.x=E(o.x+i.ll[0]),r.y=o.y+i.ll[1]}else isNaN(o.x)||(r.x=e.x+o.x,r.y=e.y+o.y)}return r}(r,t,a),isNaN(n.x))))break}}return isNaN(n.x)?(console.log("Failed to find a grid shift table for location '"+-r.x*A+" "+r.y*A+" tried: '"+o+"'"),-1):(i.x=-n.x,i.y=n.y,0)}function we(e,t){var i,r,n,o,s,a,e={x:e.x/t.del[0],y:e.y/t.del[1]},l=Math.floor(e.x),u=Math.floor(e.y),c=e.x-+l,e=e.y-+u,h={x:Number.NaN,y:Number.NaN};return l<0||l>=t.lim[0]||u<0||u>=t.lim[1]||(u=u*t.lim[0]+l,l=t.cvs[u][0],i=t.cvs[u][1],a=t.cvs[++u][0],r=t.cvs[u][1],u+=t.lim[0],n=t.cvs[u][0],o=t.cvs[u][1],s=t.cvs[--u][0],t=t.cvs[u][1],h.x=(u=(1-c)*(1-e))*l+(l=c*(1-e))*a+(a=(1-c)*e)*s+(s=c*e)*n,h.y=u*i+l*r+a*t+s*o),h}function xe(e,t,i){for(var r,n,o=i.x,s=i.y,a=i.z||0,l={},u=0;u<3;u++)if(!t||2!==u||void 0!==i.z)switch(n=0===u?(r=o,-1!=="ew".indexOf(e.axis[u])?"x":"y"):1===u?(r=s,-1!=="ns".indexOf(e.axis[u])?"y":"x"):(r=a,"z"),e.axis[u]){case"e":l[n]=r;break;case"w":l[n]=-r;break;case"n":l[n]=r;break;case"s":l[n]=-r;break;case"u":void 0!==i[n]&&(l.z=r);break;case"d":void 0!==i[n]&&(l.z=-r);break;default:return null}return l}function be(e){var t={x:e[0],y:e[1]};return 2<e.length&&(t.z=e[2]),3<e.length&&(t.m=e[3]),t}function Ee(e){Be(e.x),Be(e.y)}function Be(e){if("function"==typeof Number.isFinite){if(Number.isFinite(e))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof e||e!=e||!isFinite(e))throw new TypeError("coordinates must be finite numbers")}function Me(e,t,i){var r,n;if(Array.isArray(i)&&(i=be(i)),Ee(i),e.datum&&t.datum&&(n=t,((r=e).datum.datum_type===d||r.datum.datum_type===g)&&"WGS84"!==n.datumCode||(n.datum.datum_type===d||n.datum.datum_type===g)&&"WGS84"!==r.datumCode)&&(i=Me(e,n=new M("WGS84"),i),e=n),"enu"!==e.axis&&(i=xe(e,!1,i)),"longlat"===e.projName)i={x:i.x*_,y:i.y*_,z:i.z||0};else if(e.to_meter&&(i={x:i.x*e.to_meter,y:i.y*e.to_meter,z:i.z||0}),!(i=e.inverse(i)))return;if(e.from_greenwich&&(i.x+=e.from_greenwich),i=ve(e.datum,t.datum,i))return t.from_greenwich&&(i={x:i.x-t.from_greenwich,y:i.y,z:i.z||0}),"longlat"===t.projName?i={x:i.x*A,y:i.y*A,z:i.z||0}:(i=t.forward(i),t.to_meter&&(i={x:i.x/t.to_meter,y:i.y/t.to_meter,z:i.z||0})),"enu"!==t.axis?xe(t,!0,i):i}var Ie=M("WGS84");function Se(t,i,r){var n,e;return Array.isArray(r)?(e=Me(t,i,r)||{x:NaN,y:NaN},2<r.length?void 0!==t.name&&"geocent"===t.name||void 0!==i.name&&"geocent"===i.name?("number"==typeof e.z?[e.x,e.y,e.z]:[e.x,e.y,r[2]]).concat(r.splice(3)):[e.x,e.y].concat(r.splice(2)):[e.x,e.y]):(n=Me(t,i,r),2!==(e=Object.keys(r)).length&&e.forEach(function(e){if(void 0!==t.name&&"geocent"===t.name||void 0!==i.name&&"geocent"===i.name){if("x"===e||"y"===e||"z"===e)return}else if("x"===e||"y"===e)return;n[e]=r[e]}),n)}function Pe(e){return e instanceof M?e:e.oProj||M(e)}function t(t,i,e){t=Pe(t);var r=!1;return void 0===i?(i=t,t=Ie,r=!0):void 0===i.x&&!Array.isArray(i)||(e=i,i=t,t=Ie,r=!0),i=Pe(i),e?Se(t,i,e):(e={forward:function(e){return Se(t,i,e)},inverse:function(e){return Se(i,t,e)}},r&&(e.oProj=i),e)}var Te=6,Le="AJSAJS",De="AFAFAF",f=65,I=73,S=79,Fe=86,Ne=90,e={forward:Oe,inverse:function(e){e=He(Ve(e.toUpperCase()));if(e.lat&&e.lon)return[e.lon,e.lat,e.lon,e.lat];return[e.left,e.bottom,e.right,e.top]},toPoint:Re};function Oe(e,t){return t=t||5,e=function(e){var t,i,r,n,o,s=e.lat,e=e.lon,a=.00669438,l=Ue(s),u=Ue(e);o=Math.floor((e+180)/6)+1,180===e&&(o=60);56<=s&&s<64&&3<=e&&e<12&&(o=32);72<=s&&s<84&&(0<=e&&e<9?o=31:9<=e&&e<21?o=33:21<=e&&e<33?o=35:33<=e&&e<42&&(o=37));e=Ue(6*(o-1)-180+3),t=a/(1-a),i=6378137/Math.sqrt(1-a*Math.sin(l)*Math.sin(l)),r=Math.tan(l)*Math.tan(l),n=t*Math.cos(l)*Math.cos(l),u=Math.cos(l)*(u-e),e=6378137*(.9983242984503243*l-.002514607064228144*Math.sin(2*l)+2639046602129982e-21*Math.sin(4*l)-35*a*a*a/3072*Math.sin(6*l));a=.9996*i*(u+(1-r+n)*u*u*u/6+(5-18*r+r*r+72*n-58*t)*u*u*u*u*u/120)+5e5,e=.9996*(e+i*Math.tan(l)*(u*u/2+(5-r+9*n+4*n*n)*u*u*u*u/24+(61-58*r+r*r+600*n-330*t)*u*u*u*u*u*u/720));s<0&&(e+=1e7);return{northing:Math.round(e),easting:Math.round(a),zoneNumber:o,zoneLetter:function(e){var t="Z";e<=84&&72<=e?t="X":e<72&&64<=e?t="W":e<64&&56<=e?t="V":e<56&&48<=e?t="U":e<48&&40<=e?t="T":e<40&&32<=e?t="S":e<32&&24<=e?t="R":e<24&&16<=e?t="Q":e<16&&8<=e?t="P":e<8&&0<=e?t="N":e<0&&-8<=e?t="M":e<-8&&-16<=e?t="L":e<-16&&-24<=e?t="K":e<-24&&-32<=e?t="J":e<-32&&-40<=e?t="H":e<-40&&-48<=e?t="G":e<-48&&-56<=e?t="F":e<-56&&-64<=e?t="E":e<-64&&-72<=e?t="D":e<-72&&-80<=e&&(t="C");return t}(s)}}({lat:e[1],lon:e[0]}),t=t,i="00000"+e.easting,r="00000"+e.northing,e.zoneNumber+e.zoneLetter+function(e,t,i){i=Qe(i),e=Math.floor(e/1e5),t=Math.floor(t/1e5)%20;return function(e,t,i){var i=i-1,r=Le.charCodeAt(i),i=De.charCodeAt(i),e=r+e-1,t=i+t,n=!1;Ne<e&&(e=e-Ne+f-1,n=!0);(e===I||r<I&&I<e||(I<e||r<I)&&n)&&e++;(e===S||r<S&&S<e||(S<e||r<S)&&n)&&++e===I&&e++;Ne<e&&(e=e-Ne+f-1);n=Fe<t&&(t=t-Fe+f-1,!0);(t===I||i<I&&I<t||(I<t||i<I)&&n)&&t++;(t===S||i<S&&S<t||(S<t||i<S)&&n)&&++t===I&&t++;Fe<t&&(t=t-Fe+f-1);return String.fromCharCode(e)+String.fromCharCode(t)}(e,t,i)}(e.easting,e.northing,e.zoneNumber)+i.substr(i.length-5,t)+r.substr(r.length-5,t);var i,r}function Re(e){e=He(Ve(e.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function Ue(e){return e*(Math.PI/180)}function ke(e){return e/Math.PI*180}function He(e){var t,i,r,n,o=e.northing,s=e.easting,a=e.zoneLetter,l=e.zoneNumber;return l<0||60<l?null:(s=s-5e5,o=o,a<"N"&&(o-=1e7),a=6*(l-1)-180+3,t=(l=.00669438)/(1-l),i=(o=o/.9996/6367449.145945056)+(3*(i=(1-Math.sqrt(1-l))/(1+Math.sqrt(1-l)))/2-27*i*i*i/32)*Math.sin(2*o)+(21*i*i/16-55*i*i*i*i/32)*Math.sin(4*o)+151*i*i*i/96*Math.sin(6*o),o=6378137/Math.sqrt(1-l*Math.sin(i)*Math.sin(i)),r=Math.tan(i)*Math.tan(i),n=t*Math.cos(i)*Math.cos(i),l=6378137*(1-l)/Math.pow(1-l*Math.sin(i)*Math.sin(i),1.5),s=s/(.9996*o),o=ke(o=i-o*Math.tan(i)/l*(s*s/2-(5+3*r+10*n-4*n*n-9*t)*s*s*s*s/24+(61+90*r+298*n+45*r*r-252*t-3*n*n)*s*s*s*s*s*s/720)),l=a+ke(l=(s-(1+2*r+n)*s*s*s/6+(5-2*n+28*r-3*n*n+8*t+24*r*r)*s*s*s*s*s/120)/Math.cos(i)),e.accuracy?{top:(a=He({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber})).lat,right:a.lon,bottom:o,left:l}:{lat:o,lon:l})}function Qe(e){e%=Te;return e=0===e?Te:e}function Ve(e){if(e&&0===e.length)throw"MGRSPoint coverting from nothing";for(var t,i=e.length,r=null,n="",o=0;!/[A-Z]/.test(t=e.charAt(o));){if(2<=o)throw"MGRSPoint bad conversion from: "+e;n+=t,o++}var s=parseInt(n,10);if(0===o||i<o+3)throw"MGRSPoint bad conversion from: "+e;var a=e.charAt(o++);if(a<="A"||"B"===a||"Y"===a||"Z"<=a||"I"===a||"O"===a)throw"MGRSPoint zone letter "+a+" not handled: "+e;for(var r=e.substring(o,o+=2),l=Qe(s),u=function(e,t){var i=Le.charCodeAt(t-1),r=1e5,n=!1;for(;i!==e.charCodeAt(0);){if(++i===I&&i++,i===S&&i++,Ne<i){if(n)throw"Bad character: "+e;i=f,n=!0}r+=1e5}return r}(r.charAt(0),l),c=function(e,t){if("V"<e)throw"MGRSPoint given invalid Northing "+e;var i=De.charCodeAt(t-1),r=0,n=!1;for(;i!==e.charCodeAt(0);){if(++i===I&&i++,i===S&&i++,Fe<i){if(n)throw"Bad character: "+e;i=f,n=!0}r+=1e5}return r}(r.charAt(1),l);c<function(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}{if(0<=t)return t;throw"Invalid zone letter: "+e}}(a);)c+=2e6;r=i-o;if(r%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+e;var h,A,l=r/2,i=0,r=0;return 0<l&&(h=1e5/Math.pow(10,l),A=e.substring(o,o+l),i=parseFloat(A)*h,A=e.substring(o+l),r=parseFloat(A)*h),{easting:i+u,northing:r+c,zoneLetter:a,zoneNumber:s,accuracy:h}}function h(e,t,i){if(!(this instanceof h))return new h(e,t,i);var r;Array.isArray(e)?(this.x=e[0],this.y=e[1],this.z=e[2]||0):"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z||0):"string"==typeof e&&void 0===t?(r=e.split(","),this.x=parseFloat(r[0],10),this.y=parseFloat(r[1],10),this.z=parseFloat(r[2],10)||0):(this.x=e,this.y=t,this.z=i||0),console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}h.fromMGRS=function(e){return new h(Re(e))},h.prototype.toMGRS=function(e){return Oe([this.x,this.y],e)};function Ge(e){var t=[],i=(t[0]=We-e*(qe+e*(Ke+e*(je+e*Ze))),t[1]=e*(Ye-e*(Ke+e*(je+e*Ze))),e*e);return t[2]=i*(Xe-e*(Je+e*$e)),t[3]=(i*=e)*(et-e*tt),t[4]=i*e*it,t}function ze(e,t,i){for(var r=1/(1-t),n=e,o=nt;o;--o){var s=Math.sin(n),a=1-t*s*s;if(n-=a=(rt(n,s,Math.cos(n),i)-e)*(a*Math.sqrt(a))*r,Math.abs(a)<y)return n}return n}var We=1,qe=.25,Ke=.046875,je=.01953125,Ze=.01068115234375,Ye=.75,Xe=.46875,Je=.013020833333333334,$e=.007120768229166667,et=.3645833333333333,tt=.005696614583333333,it=.3076171875,rt=function(e,t,i,r){return r[0]*e-(i*=t)*(r[1]+(t*=t)*(r[2]+t*(r[3]+t*r[4])))},nt=20;function ot(e,t){for(var i,r=2*Math.cos(2*t),n=e.length-1,o=e[n],s=0;0<=--n;)i=r*o-s+e[n],s=o,o=i;return t+i*Math.sin(2*t)}function st(e,t,i){for(var r,n,o=Math.sin(t),t=Math.cos(t),s=lt(i),i=ht(i),a=2*t*i,l=-2*o*s,u=e.length-1,c=e[u],h=0,A=0,p=0;0<=--u;)r=A,n=h,c=a*(A=c)-r-l*(h=p)+e[u],p=l*A-n+a*h;return[(a=o*i)*c-(l=t*s)*p,a*p+l*c]}var at={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=Ge(this.es),this.ml0=rt(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(e){var t=e.x,i=e.y,t=E(t-this.long0),r=Math.sin(i),n=Math.cos(i);if(this.es)var o=n*t,s=Math.pow(o,2),a=this.ep2*Math.pow(n,2),l=Math.pow(a,2),u=Math.abs(n)>y?Math.tan(i):0,u=Math.pow(u,2),c=Math.pow(u,2),h=1-this.es*Math.pow(r,2),h=(o/=Math.sqrt(h),rt(i,r,n,this.en)),A=this.a*(this.k0*o*(1+s/6*(1-u+a+s/20*(5-18*u+c+14*a-58*u*a+s/42*(61+179*c-c*u-479*u)))))+this.x0,h=this.a*(this.k0*(h-this.ml0+r*t*o/2*(1+s/12*(5-u+9*a+4*l+s/30*(61+c-58*u+270*a-330*u*a+s/56*(1385+543*c-c*u-3111*u))))))+this.y0;else{r=n*Math.sin(t);if(Math.abs(Math.abs(r)-1)<y)return 93;if(A=.5*this.a*this.k0*Math.log((1+r)/(1-r))+this.x0,h=n*Math.cos(t)/Math.sqrt(1-Math.pow(r,2)),1<=(r=Math.abs(h))){if(y<r-1)return 93;h=0}else h=Math.acos(h);h=this.a*this.k0*((h=i<0?-h:h)-this.lat0)+this.y0}return e.x=A,e.y=h,e},inverse:function(e){var t,i,r,n,o,s,a,l,u=(e.x-this.x0)*(1/this.a),c=(e.y-this.y0)*(1/this.a),h=this.es?(a=this.ml0+c/this.k0,s=ze(a,this.es,this.en),Math.abs(s)<m?(n=Math.sin(s),t=Math.cos(s),l=Math.abs(t)>y?Math.tan(s):0,o=this.ep2*Math.pow(t,2),r=Math.pow(o,2),i=Math.pow(l,2),h=Math.pow(i,2),a=1-this.es*Math.pow(n,2),n=u*Math.sqrt(a)/this.k0,l=s-(a*=l)*(s=Math.pow(n,2))/(1-this.es)*.5*(1-s/12*(5+3*i-9*o*i+o-4*r-s/30*(61+90*i-252*o*i+45*h+46*o-s/56*(1385+3633*i+4095*h+1574*h*i)))),E(this.long0+n*(1-s/6*(1+2*i+o-s/20*(5+28*i+24*h+8*o*i+6*o-s/42*(61+662*i+1320*h+720*h*i))))/t)):(l=m*p(c),0)):(n=.5*((r=Math.exp(u/this.k0))-1/r),o=this.lat0+c/this.k0,s=Math.cos(o),a=Math.sqrt((1-Math.pow(s,2))/(1+Math.pow(n,2))),l=Math.asin(a),c<0&&(l=-l),0==n&&0===s?0:E(Math.atan2(n,s)+this.long0));return e.x=h,e.y=l,e},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]},lt=function(e){e=Math.exp(e);return(e-1/e)/2},ut=function(e,t){e=Math.abs(e),t=Math.abs(t);var i=Math.max(e,t),e=Math.min(e,t)/(i||1);return i*Math.sqrt(1+Math.pow(e,2))},ct=function(e){var t=1+e,i=t-1;return 0==i?e:e*Math.log(t)/i},ht=function(e){e=Math.exp(e);return(e+1/e)/2};var At={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(at.init.apply(this),this.forward=at.forward,this.inverse=at.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=t=(t=this.es/(1+Math.sqrt(1-this.es)))/(2-t),t=(this.cgb[0]=t*(2+t*(-2/3+t*(t*(116/45+t*(26/45+-2854/675*t))-2))),this.cbg[0]=t*(t*(2/3+t*(4/3+t*(-82/45+t*(32/45+4642/4725*t))))-2),this.cgb[1]=(e*=t)*(7/3+t*(t*(-227/45+t*(2704/315+2323/945*t))-1.6)),this.cbg[1]=e*(5/3+t*(-16/15+t*(-13/9+t*(904/315+-1522/945*t)))),this.cgb[2]=(e*=t)*(56/15+t*(-136/35+t*(-1262/105+73814/2835*t))),this.cbg[2]=e*(-26/15+t*(34/21+t*(1.6+-12686/2835*t))),this.cgb[3]=(e*=t)*(4279/630+t*(-332/35+-399572/14175*t)),this.cbg[3]=e*(1237/630+t*(-24832/14175*t-2.4)),this.cgb[4]=(e*=t)*(4174/315+-144838/6237*t),this.cbg[4]=e*(-734/315+109598/31185*t),this.cgb[5]=601676/22275*(e*=t),this.cbg[5]=444337/155925*e,e=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+e*(.25+e*(1/64+e/256))),this.utg[0]=t*(t*(2/3+t*(-37/96+t*(1/360+t*(81/512+-96199/604800*t))))-.5),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+7891/37800*t))))),this.utg[1]=e*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+1118711/3870720*t)))),this.gtu[1]=e*(13/48+t*(t*(557/1440+t*(281/630+-1983433/1935360*t))-.6)),this.utg[2]=(e*=t)*(-17/480+t*(37/840+t*(209/4480+-5569/90720*t))),this.gtu[2]=e*(61/240+t*(-103/140+t*(15061/26880+167603/181440*t))),this.utg[3]=(e*=t)*(-4397/161280+t*(11/504+830251/7257600*t)),this.gtu[3]=e*(49561/161280+t*(-179/168+6601661/7257600*t)),this.utg[4]=(e*=t)*(-4583/161280+108847/3991680*t),this.gtu[4]=e*(34729/80640+-3418889/1995840*t),this.utg[5]=-.03233083094085698*(e*=t),this.gtu[5]=.6650675310896665*e,ot(this.cbg,this.lat0));this.Zb=-this.Qn*(t+function(e,t){for(var i,r=2*Math.cos(t),n=e.length-1,o=e[n],s=0;0<=--n;)i=r*o-s+e[n],s=o,o=i;return Math.sin(t)*i}(this.gtu,2*t))},forward:function(e){var t,i=E(e.x-this.long0),r=e.y,r=ot(this.cbg,r),n=Math.sin(r),o=Math.cos(r),s=Math.sin(i),a=Math.cos(i),o=(r=Math.atan2(n,a*o),i=Math.atan2(s*o,ut(n,o*a)),s=Math.tan(i),n=Math.abs(s),n=ct(n*(1+n/(ut(1,n)+1))),st(this.gtu,2*r,2*(i=s<0?-n:n)));return r+=o[0],i+=o[1],a=Math.abs(i)<=2.623395162778?(t=this.a*(this.Qn*i)+this.x0,this.a*(this.Qn*r+this.Zb)+this.y0):t=1/0,e.x=t,e.y=a,e},inverse:function(e){var t,i,r,n,o=(e.x-this.x0)*(1/this.a),s=(e.y-this.y0)*(1/this.a);return s=(s-this.Zb)/this.Qn,o/=this.Qn,n=Math.abs(o)<=2.623395162778?(s+=(r=st(this.utg,2*s,2*o))[0],o+=r[1],o=Math.atan(lt(o)),r=Math.sin(s),t=Math.cos(s),n=Math.sin(o),i=Math.cos(o),s=Math.atan2(r*i,ut(n,i*t)),o=Math.atan2(n,i*t),r=E(o+this.long0),ot(this.cgb,s)):r=1/0,e.x=r,e.y=n,e},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"]};function pt(e,t){return Math.pow((1-e)/(1+e),t)}var ft={init:function(){var e=function(e,t){if(void 0===e){if((e=Math.floor(30*(E(t)+Math.PI)/Math.PI)+1)<0)return 0;if(60<e)return 60}return e}(this.zone,this.long0);if(void 0===e)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*_,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,At.init.apply(this),this.forward=At.forward,this.inverse=At.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};var dt={init:function(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+v)/(Math.pow(Math.tan(.5*this.lat0+v),this.C)*pt(this.e*e,this.ratexp))},forward:function(e){var t=e.x,i=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+v),this.C)*pt(this.e*Math.sin(i),this.ratexp))-m,e.x=this.C*t,e},inverse:function(e){for(var t=e.x/this.C,i=e.y,r=Math.pow(Math.tan(.5*i+v)/this.K,1/this.C),n=20;0<n&&(i=2*Math.atan(r*pt(this.e*Math.sin(e.y),-.5*this.e))-m,!(Math.abs(i-e.y)<1e-14));--n)e.y=i;return n?(e.x=t,e.y=i,e):null},names:["gauss"]};var gt={init:function(){dt.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(e){var t,i,r,n;return e.x=E(e.x-this.long0),dt.forward.apply(this,[e]),t=Math.sin(e.y),i=Math.cos(e.y),r=Math.cos(e.x),n=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*i*r),e.x=n*i*Math.sin(e.x),e.y=n*(this.cosc0*t-this.sinc0*i*r),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e},inverse:function(e){var t,i,r,n;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,n=(n=Math.sqrt(e.x*e.x+e.y*e.y))?(i=2*Math.atan2(n,this.R2),t=Math.sin(i),i=Math.cos(i),r=Math.asin(i*this.sinc0+e.y*t*this.cosc0/n),Math.atan2(e.x*t,n*this.cosc0*i-e.y*this.sinc0*t)):(r=this.phic0,0),e.x=n,e.y=r,dt.inverse.apply(this,[e]),e.x=E(e.x+this.long0),e},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]};var mt={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=y&&(this.k0=.5*(1+p(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=y&&(0<this.lat0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=y&&(this.k0=.5*this.cons*s(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/b(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=s(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-m,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(e){var t,i,r=e.x,n=e.y,o=Math.sin(n),s=Math.cos(n),a=E(r-this.long0);return Math.abs(Math.abs(r-this.long0)-Math.PI)<=y&&Math.abs(n+this.lat0)<=y?(e.x=NaN,e.y=NaN):this.sphere?(t=2*this.k0/(1+this.sinlat0*o+this.coslat0*s*Math.cos(a)),e.x=this.a*t*s*Math.sin(a)+this.x0,e.y=this.a*t*(this.coslat0*o-this.sinlat0*s*Math.cos(a))+this.y0):(s=2*Math.atan(this.ssfn_(n,o,this.e))-m,i=Math.cos(s),s=Math.sin(s),Math.abs(this.coslat0)<=y?(n=b(this.e,n*this.con,this.con*o),o=2*this.a*this.k0*n/this.cons,e.x=this.x0+o*Math.sin(r-this.long0),e.y=this.y0-this.con*o*Math.cos(r-this.long0)):(Math.abs(this.sinlat0)<y?(t=2*this.a*this.k0/(1+i*Math.cos(a)),e.y=t*s):(t=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*s+this.cosX0*i*Math.cos(a))),e.y=t*(this.cosX0*s-this.sinX0*i*Math.cos(a))+this.y0),e.x=t*i*Math.sin(a)+this.x0)),e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,i,r,n,o=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere)i=2*Math.atan(o/(2*this.a*this.k0)),r=this.long0,n=this.lat0,o<=y||(n=Math.asin(Math.cos(i)*this.sinlat0+e.y*Math.sin(i)*this.coslat0/o),r=Math.abs(this.coslat0)<y?0<this.lat0?E(this.long0+Math.atan2(e.x,-1*e.y)):E(this.long0+Math.atan2(e.x,e.y)):E(this.long0+Math.atan2(e.x*Math.sin(i),o*this.coslat0*Math.cos(i)-e.y*this.sinlat0*Math.sin(i))));else if(Math.abs(this.coslat0)<=y){if(o<=y)return n=this.lat0,r=this.long0,e.x=r,e.y=n,e;e.x*=this.con,e.y*=this.con,i=o*this.cons/(2*this.a*this.k0),n=this.con*l(this.e,i),r=this.con*E(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else i=2*Math.atan(o*this.cosX0/(2*this.a*this.k0*this.ms1)),r=this.long0,o<=y?t=this.X0:(t=Math.asin(Math.cos(i)*this.sinX0+e.y*Math.sin(i)*this.cosX0/o),r=E(this.long0+Math.atan2(e.x*Math.sin(i),o*this.cosX0*Math.cos(i)-e.y*this.sinX0*Math.sin(i)))),n=-1*l(this.e,Math.tan(.5*(m+t)));return e.x=r,e.y=n,e},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(e,t,i){return t*=i,Math.tan(.5*(m+e))*Math.pow((1-t)/(1+t),.5*i)}};var yt={init:function(){var e=this.lat0,t=(this.lambda0=this.long0,Math.sin(e)),i=this.a,r=2*(r=1/this.rf)-Math.pow(r,2),n=this.e=Math.sqrt(r),i=(this.R=this.k0*i*Math.sqrt(1-r)/(1-r*Math.pow(t,2)),this.alpha=Math.sqrt(1+r/(1-r)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha),Math.log(Math.tan(Math.PI/4+this.b0/2))),r=Math.log(Math.tan(Math.PI/4+e/2)),e=Math.log((1+n*t)/(1-n*t));this.K=i-this.alpha*r+this.alpha*n/2*e},forward:function(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),t=-this.alpha*(t+i)+this.K,i=2*(Math.atan(Math.exp(t))-Math.PI/4),t=this.alpha*(e.x-this.lambda0),r=Math.atan(Math.sin(t)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(t))),i=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(t));return e.y=this.R/2*Math.log((1+Math.sin(i))/(1-Math.sin(i)))+this.y0,e.x=this.R*r+this.x0,e},inverse:function(e){for(var t,i=e.x-this.x0,r=e.y-this.y0,i=i/this.R,r=2*(Math.atan(Math.exp(r/this.R))-Math.PI/4),n=Math.asin(Math.cos(this.b0)*Math.sin(r)+Math.sin(this.b0)*Math.cos(r)*Math.cos(i)),i=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(r))),r=this.lambda0+i/this.alpha,o=n,s=-1e3,a=0;1e-7<Math.abs(o-s);){if(20<++a)return;t=1/this.alpha*(Math.log(Math.tan(Math.PI/4+n/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(o))/2)),s=o,o=2*Math.atan(Math.exp(t))-Math.PI/2}return e.x=r,e.y=o,e},names:["somerc"]};var _t={init:function(){var e,t,i,r,n,o=0,s=0,a=0,l=0,u=0,c=0,h=0,A=(this.no_off=(p="object"==typeof(A=this).PROJECTION?Object.keys(A.PROJECTION)[0]:A.PROJECTION,"no_uoff"in A||"no_off"in A||-1!==["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(p)),this.no_rot="no_rot"in this,!1),p=("alpha"in this&&(A=!0),!1);if("rectified_grid_angle"in this&&(p=!0),A&&(h=this.alpha),p&&(o=this.rectified_grid_angle*_),A||p)s=this.longc;else if(a=this.long1,u=this.lat1,l=this.long2,c=this.lat2,Math.abs(u-c)<=1e-7||(e=Math.abs(u))<=1e-7||Math.abs(e-m)<=1e-7||Math.abs(Math.abs(this.lat0)-m)<=1e-7||Math.abs(Math.abs(c)-m)<=1e-7)throw new Error;var f=1-this.es,d=Math.sqrt(f);Math.abs(this.lat0)>y?(r=Math.sin(this.lat0),t=Math.cos(this.lat0),e=1-this.es*r*r,this.B=t*t,this.B=Math.sqrt(1+this.es*this.B*this.B/f),this.A=this.B*this.k0*d/e,(i=(t=this.B*d/(t*Math.sqrt(e)))*t-1)<=0?i=0:(i=Math.sqrt(i),this.lat0<0&&(i=-i)),this.E=i+=t,this.E*=Math.pow(b(this.e,this.lat0,r),this.B)):(this.B=1/d,this.A=this.k0,this.E=t=i=1),A||p?(A?(n=Math.asin(Math.sin(h)/t),p||(o=h)):(n=o,h=Math.asin(t*Math.sin(n))),this.lam0=s-Math.asin(.5*(i-1/i)*Math.tan(n))/this.B):(f=Math.pow(b(this.e,u,Math.sin(u)),this.B),r=Math.pow(b(this.e,c,Math.sin(c)),this.B),i=this.E/f,d=(r-f)/(r+f),A=this.E*this.E,(e=a-l)<-Math.pi?l-=C:e>Math.pi&&(l+=C),this.lam0=E(.5*(a+l)-Math.atan((A-r*f)/(A+r*f)*Math.tan(.5*this.B*(a-l))/d)/this.B),n=Math.atan(2*Math.sin(this.B*E(a-this.lam0))/(i-1/i)),o=h=Math.asin(t*Math.sin(n))),this.singam=Math.sin(n),this.cosgam=Math.cos(n),this.sinrot=Math.sin(o),this.cosrot=Math.cos(o),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(t*t-1)/Math.cos(h))),this.lat0<0&&(this.u_0=-this.u_0)),i=.5*n,this.v_pole_n=this.ArB*Math.log(Math.tan(v-i)),this.v_pole_s=this.ArB*Math.log(Math.tan(v+i))},forward:function(e){var t,i,r,n,o={};if(e.x=e.x-this.lam0,Math.abs(Math.abs(e.y)-m)>y){if(r=.5*((n=this.E/Math.pow(b(this.e,e.y,Math.sin(e.y)),this.B))-(i=1/n)),n=.5*(n+i),t=Math.sin(this.B*e.x),n=(r*this.singam-t*this.cosgam)/n,Math.abs(Math.abs(n)-1)<y)throw new Error;n=.5*this.ArB*Math.log((1-n)/(1+n)),i=Math.cos(this.B*e.x),r=Math.abs(i)<1e-7?this.A*e.x:this.ArB*Math.atan2(r*this.cosgam+t*this.singam,i)}else n=0<e.y?this.v_pole_n:this.v_pole_s,r=this.ArB*e.y;return this.no_rot?(o.x=r,o.y=n):(r-=this.u_0,o.x=n*this.cosrot+r*this.sinrot,o.y=r*this.cosrot-n*this.sinrot),o.x=this.a*o.x+this.x0,o.y=this.a*o.y+this.y0,o},inverse:function(e){var t,i,r,n={};if(e.x=(e.x-this.x0)*(1/this.a),e.y=(e.y-this.y0)*(1/this.a),e=this.no_rot?(r=e.y,e.x):(r=e.x*this.cosrot-e.y*this.sinrot,e.y*this.cosrot+e.x*this.sinrot+this.u_0),t=.5*((r=Math.exp(-this.BrA*r))-1/r),r=.5*(r+1/r),r=((i=Math.sin(this.BrA*e))*this.cosgam+t*this.singam)/r,Math.abs(Math.abs(r)-1)<y)n.x=0,n.y=r<0?-m:m;else{if(n.y=this.E/Math.sqrt((1+r)/(1-r)),n.y=l(this.e,Math.pow(n.y,1/this.B)),n.y===1/0)throw new Error;n.x=-this.rB*Math.atan2(t*this.cosgam-i*this.singam,Math.cos(this.BrA*e))}return n.x+=this.lam0,n},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]};var vt={init:function(){var e,t,i,r,n,o;this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,Math.abs(this.lat1+this.lat2)<y||(e=this.b/this.a,this.e=Math.sqrt(1-e*e),e=Math.sin(this.lat1),t=Math.cos(this.lat1),t=s(this.e,e,t),i=b(this.e,this.lat1,e),n=Math.sin(this.lat2),r=Math.cos(this.lat2),r=s(this.e,n,r),n=b(this.e,this.lat2,n),o=b(this.e,this.lat0,Math.sin(this.lat0)),Math.abs(this.lat1-this.lat2)>y?this.ns=Math.log(t/r)/Math.log(i/n):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=t/(this.ns*Math.pow(i,this.ns)),this.rh=this.a*this.f0*Math.pow(o,this.ns),this.title)||(this.title="Lambert Conformal Conic")},forward:function(e){var t,i=e.x,r=e.y,n=(Math.abs(2*Math.abs(r)-Math.PI)<=y&&(r=p(r)*(m-2*y)),Math.abs(Math.abs(r)-m));if(y<n)n=b(this.e,r,Math.sin(r)),t=this.a*this.f0*Math.pow(n,this.ns);else{if(r*this.ns<=0)return null;t=0}return n=this.ns*E(i-this.long0),e.x=this.k0*(t*Math.sin(n))+this.x0,e.y=this.k0*(this.rh-t*Math.cos(n))+this.y0,e},inverse:function(e){var t,i,r=(e.x-this.x0)/this.k0,n=this.rh-(e.y-this.y0)/this.k0,o=0<this.ns?(t=Math.sqrt(r*r+n*n),1):(t=-Math.sqrt(r*r+n*n),-1),s=0;if(0!==t&&(s=Math.atan2(o*r,o*n)),0!==t||0<this.ns){if(o=1/this.ns,r=Math.pow(t/(this.a*this.f0),o),-9999===(i=l(this.e,r)))return null}else i=-m;return n=E(s/this.ns+this.long0),e.x=n,e.y=i,e},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc"]};function P(e,t,i,r,n){return e*n-t*Math.sin(2*n)+i*Math.sin(4*n)-r*Math.sin(6*n)}function Ct(e){return 1-.25*e*(1+e/16*(3+1.25*e))}function wt(e){return.375*e*(1+.25*e*(1+.46875*e))}function xt(e){return.05859375*e*e*(1+.75*e)}function bt(e){return e*e*e*(35/3072)}function T(e,t,i){return t*=i,e/Math.sqrt(1-t*t)}function L(e){return Math.abs(e)<m?e:e-p(e)*Math.PI}function Et(e,t,i,r,n){for(var o,s=e/t,a=0;a<15;a++)if(s+=o=(e-(t*s-i*Math.sin(2*s)+r*Math.sin(4*s)-n*Math.sin(6*s)))/(t-2*i*Math.cos(2*s)+4*r*Math.cos(4*s)-6*n*Math.cos(6*s)),Math.abs(o)<=1e-10)return s;return NaN}var Bt={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(e){var t=e.x,i=e.y,t=E(t-this.long0),r=Math.pow((1+this.e*Math.sin(i))/(1-this.e*Math.sin(i)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(i/2+this.s45),this.alfa)/r)-this.s45),r=-t*this.alfa,t=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(r)),i=Math.asin(Math.cos(i)*Math.sin(r)/Math.cos(t)),r=this.n*i,i=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(t/2+this.s45),this.n);return e.y=i*Math.cos(r),e.x=i*Math.sin(r),this.czech||(e.y*=-1,e.x*=-1),e},inverse:function(e){for(var t,i,r,n,o=e.x,s=(e.x=e.y,e.y=o,this.czech||(e.y*=-1,e.x*=-1),o=Math.sqrt(e.x*e.x+e.y*e.y),i=Math.atan2(e.y,e.x)/Math.sin(this.s0),o=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(o)-Math.sin(this.ad)*Math.cos(o)*Math.cos(i)),o=Math.asin(Math.cos(o)*Math.sin(i)/Math.cos(t)),e.x=this.long0-o/this.alfa,r=t,n=0);e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(r))/(1-this.e*Math.sin(r)),this.e/2))-this.s45),Math.abs(r-e.y)<1e-10&&(n=1),r=e.y,s+=1,0===n&&s<15;);return 15<=s?null:e},names:["Krovak","krovak"]};function D(e,t){var i;return 1e-7<e?(1-e*e)*(t/(1-(i=e*t)*i)-.5/e*Math.log((1-i)/(1+i))):2*t}var Mt={init:function(){this.sphere||(this.e0=Ct(this.es),this.e1=wt(this.es),this.e2=xt(this.es),this.e3=bt(this.es),this.ml0=this.a*P(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(e){var t,i,r,n,o,s,a=e.x,l=e.y,a=E(a-this.long0);return l=this.sphere?(s=this.a*Math.asin(Math.cos(l)*Math.sin(a)),this.a*(Math.atan2(Math.tan(l),Math.cos(a))-this.lat0)):(t=Math.sin(l),i=Math.cos(l),r=T(this.a,this.e,t),n=Math.tan(l)*Math.tan(l),s=r*(a=a*Math.cos(l))*(1-(a=a*a)*n*(1/6-(8-n+8*(o=this.es*i*i/(1-this.es)))*a/120)),this.a*P(this.e0,this.e1,this.e2,this.e3,l)-this.ml0+r*t/i*a*(.5+(5-n+6*o)*a/24)),e.x=s+this.x0,e.y=l+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=e.x/this.a,i=e.y/this.a;if(this.sphere)var r=i+this.lat0,n=Math.asin(Math.sin(r)*Math.cos(t)),r=Math.atan2(Math.tan(t),Math.cos(r));else{var o=this.ml0/this.a+i,o=Et(o,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-m)<=y)return e.x=this.long0,e.y=m,i<0&&(e.y*=-1),e;var i=T(this.a,this.e,Math.sin(o)),s=i*i*i/this.a/this.a*(1-this.es),a=Math.pow(Math.tan(o),2),t=t*this.a/i,l=t*t;n=o-i*Math.tan(o)/s*t*t*(.5-(1+3*a)*t*t/24),r=t*(1-l*(a/3+(1+3*a)*a*l/15))/Math.cos(o)}return e.x=E(r+this.long0),e.y=L(n),e},names:["Cassini","Cassini_Soldner","cass"]};var It=.3333333333333333,St=.17222222222222222,Pt=.10257936507936508,Tt=.06388888888888888,Lt=.0664021164021164,Dt=.016415012942191543;function F(e){return 1<Math.abs(e)&&(e=1<e?1:-1),Math.asin(e)}var Ft={init:function(){var e,t,i,r=Math.abs(this.lat0);if(Math.abs(r-m)<y?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(r)<y?this.mode=this.EQUIT:this.mode=this.OBLIQ,0<this.es)switch(this.qp=D(this.e,1),this.mmf=.5/(1-this.es),this.apa=(r=this.es,(i=[])[0]=r*It,i[0]+=(t=r*r)*St,i[1]=t*Tt,i[0]+=(t*=r)*Pt,i[1]+=t*Lt,i[2]=t*Dt,i),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=D(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(e){var t,i,r,n,o,s,a,l,u,c,h=e.x,A=e.y,h=E(h-this.long0);if(this.sphere){if(o=Math.sin(A),c=Math.cos(A),r=Math.cos(h),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((i=this.mode===this.EQUIT?1+c*r:1+this.sinph0*o+this.cosph0*c*r)<=y)return null;t=(i=Math.sqrt(2/i))*c*Math.sin(h),i*=this.mode===this.EQUIT?o:this.cosph0*o-this.sinph0*c*r}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(r=-r),Math.abs(A+this.lat0)<y)return null;i=v-.5*A,t=(i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)))*Math.sin(h),i*=r}}else{switch(u=l=a=0,r=Math.cos(h),n=Math.sin(h),o=Math.sin(A),s=D(this.e,o),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(a=s/this.qp,l=Math.sqrt(1-a*a)),this.mode){case this.OBLIQ:u=1+this.sinb1*a+this.cosb1*l*r;break;case this.EQUIT:u=1+l*r;break;case this.N_POLE:u=m+A,s=this.qp-s;break;case this.S_POLE:u=A-m,s=this.qp+s}if(Math.abs(u)<y)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:u=Math.sqrt(2/u),i=this.mode===this.OBLIQ?this.ymf*u*(this.cosb1*a-this.sinb1*l*r):(u=Math.sqrt(2/(1+l*r)))*a*this.ymf,t=this.xmf*u*l*n;break;case this.N_POLE:case this.S_POLE:0<=s?(t=(u=Math.sqrt(s))*n,i=r*(this.mode===this.S_POLE?u:-u)):t=i=0}}return e.x=this.a*t+this.x0,e.y=this.a*i+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,i,r,n,o,s,a=e.x/this.a,l=e.y/this.a;if(this.sphere){var u,c=0,h=0,A=Math.sqrt(a*a+l*l);if(1<(u=.5*A))return null;switch(u=2*Math.asin(u),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(h=Math.sin(u),c=Math.cos(u)),this.mode){case this.EQUIT:u=Math.abs(A)<=y?0:Math.asin(l*h/A),a*=h,l=c*A;break;case this.OBLIQ:u=Math.abs(A)<=y?this.lat0:Math.asin(c*this.sinph0+l*h*this.cosph0/A),a*=h*this.cosph0,l=(c-Math.sin(u)*this.sinph0)*A;break;case this.N_POLE:l=-l,u=m-u;break;case this.S_POLE:u-=m}t=0!==l||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(a,l):0}else{if(r=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(a/=this.dd,l*=this.dd,(o=Math.sqrt(a*a+l*l))<y)return e.x=this.long0,e.y=this.lat0,e;n=2*Math.asin(.5*o/this.rq),s=Math.cos(n),a*=n=Math.sin(n),l=this.mode===this.OBLIQ?(r=s*this.sinb1+l*n*this.cosb1/o,i=this.qp*r,o*this.cosb1*s-l*this.sinb1*n):(i=this.qp*(r=l*n/o),o*s)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(!(i=a*a+(l=this.mode===this.N_POLE?-l:l)*l))return e.x=this.long0,e.y=this.lat0,e;r=1-i/this.qp,this.mode===this.S_POLE&&(r=-r)}t=Math.atan2(a,l),n=Math.asin(r),o=this.apa,s=n+n,u=n+o[0]*Math.sin(s)+o[1]*Math.sin(s+s)+o[2]*Math.sin(s+s+s)}return e.x=E(this.long0+t),e.y=u,e},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};var Nt={init:function(){Math.abs(this.lat1+this.lat2)<y||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=s(this.e3,this.sin_po,this.cos_po),this.qs1=D(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=s(this.e3,this.sin_po,this.cos_po),this.qs2=D(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=D(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>y?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(e){var t=e.x,i=e.y,i=(this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i),D(this.e3,this.sin_phi,this.cos_phi)),i=this.a*Math.sqrt(this.c-this.ns0*i)/this.ns0,t=this.ns0*E(t-this.long0),r=i*Math.sin(t)+this.x0,i=this.rh-i*Math.cos(t)+this.y0;return e.x=r,e.y=i,e},inverse:function(e){var t,i,r;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,r=0<=this.ns0?(i=Math.sqrt(e.x*e.x+e.y*e.y),1):(i=-Math.sqrt(e.x*e.x+e.y*e.y),-1),(t=0)!==i&&(t=Math.atan2(r*e.x,r*e.y)),r=i*this.ns0/this.a,r=this.sphere?Math.asin((this.c-r*r)/(2*this.ns0)):(i=(this.c-r*r)/this.ns0,this.phi1z(this.e3,i)),i=E(t/this.ns0+this.long0),e.x=i,e.y=r,e},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(e,t){var i,r,n,o=F(.5*t);if(e<y)return o;for(var s=e*e,a=1;a<=25;a++)if(o+=n=.5*(r=1-(i=e*(n=Math.sin(o)))*i)*r/Math.cos(o)*(t/(1-s)-n/r+.5/e*Math.log((1-i)/(1+i))),Math.abs(n)<=1e-7)return o;return null}};var Ot={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(e){var t,i=e.x,r=e.y,i=E(i-this.long0),n=Math.sin(r),r=Math.cos(r),o=Math.cos(i),s=0<(s=this.sin_p14*n+this.cos_p14*r*o)||Math.abs(s)<=y?(t=this.x0+ +this.a*r*Math.sin(i)/s,this.y0+ +this.a*(this.cos_p14*n-this.sin_p14*r*o)/s):(t=this.x0+this.infinity_dist*r*Math.sin(i),this.y0+this.infinity_dist*(this.cos_p14*n-this.sin_p14*r*o));return e.x=t,e.y=s,e},inverse:function(e){var t,i,r,n;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,r=(t=Math.sqrt(e.x*e.x+e.y*e.y))?(r=Math.atan2(t,this.rc),i=Math.sin(r),r=Math.cos(r),n=F(r*this.sin_p14+e.y*i*this.cos_p14/t),r=Math.atan2(e.x*i,t*this.cos_p14*r-e.y*this.sin_p14*i),E(this.long0+r)):(n=this.phic0,0),e.x=r,e.y=n,e},names:["gnom"]};var Rt={init:function(){this.sphere||(this.k0=s(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(e){var t,i=e.x,r=e.y,i=E(i-this.long0);return i=this.sphere?(t=this.x0+this.a*i*Math.cos(this.lat_ts),this.y0+this.a*Math.sin(r)/Math.cos(this.lat_ts)):(r=D(this.e,Math.sin(r)),t=this.x0+this.a*this.k0*i,this.y0+this.a*r*.5/this.k0),e.x=t,e.y=i,e},inverse:function(e){var t,i;return e.x-=this.x0,e.y-=this.y0,this.sphere?(t=E(this.long0+e.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(i=function(e,t){var i=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(t)-i)<1e-6)return t<0?-1*m:m;for(var r,n,o,s=Math.asin(.5*t),a=0;a<30;a++)if(r=Math.sin(s),n=Math.cos(s),o=e*r,s+=n=Math.pow(1-o*o,2)/(2*n)*(t/(1-e*e)-r/(1-o*o)+.5/e*Math.log((1-o)/(1+o))),Math.abs(n)<=1e-10)return s;return NaN}(this.e,2*e.y*this.k0/this.a),t=E(this.long0+e.x/(this.a*this.k0))),e.x=t,e.y=i,e},names:["cea"]};var Ut={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(e){var t=e.x,i=e.y,t=E(t-this.long0),i=L(i-this.lat0);return e.x=this.x0+this.a*t*this.rc,e.y=this.y0+this.a*i,e},inverse:function(e){var t=e.x,i=e.y;return e.x=E(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=L(this.lat0+(i-this.y0)/this.a),e},names:["Equirectangular","Equidistant_Cylindrical","eqc"]};var kt={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Ct(this.es),this.e1=wt(this.es),this.e2=xt(this.es),this.e3=bt(this.es),this.ml0=this.a*P(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,i=e.x,r=e.y,n=(i=E(i-this.long0))*Math.sin(r);return r=this.sphere?Math.abs(r)<=y?(t=this.a*i,-1*this.a*this.lat0):(t=this.a*Math.sin(n)/Math.tan(r),this.a*(L(r-this.lat0)+(1-Math.cos(n))/Math.tan(r))):Math.abs(r)<=y?(t=this.a*i,-1*this.ml0):(t=(i=T(this.a,this.e,Math.sin(r))/Math.tan(r))*Math.sin(n),this.a*P(this.e0,this.e1,this.e2,this.e3,r)-this.ml0+i*(1-Math.cos(n))),e.x=t+this.x0,e.y=r+this.y0,e},inverse:function(e){var t,i,r,n,o,s,a=e.x-this.x0,l=e.y-this.y0;if(this.sphere)if(Math.abs(l+this.a*this.lat0)<=y)t=E(a/this.a+this.long0),i=0;else{for(var u,c=this.lat0+l/this.a,h=a*a/this.a/this.a+c*c,A=c,p=20;p;--p)if(A+=r=-1*(c*(A*(u=Math.tan(A))+1)-A-.5*(A*A+h)*u)/((A-c)/u-1),Math.abs(r)<=y){i=A;break}t=E(this.long0+Math.asin(a*Math.tan(A)/this.a)/Math.sin(i))}else if(Math.abs(l+this.ml0)<=y)i=0,t=E(this.long0+a/this.a);else{for(c=(this.ml0+l)/this.a,h=a*a/this.a/this.a+c*c,A=c,p=20;p;--p)if(s=this.e*Math.sin(A),n=Math.sqrt(1-s*s)*Math.tan(A),s=this.a*P(this.e0,this.e1,this.e2,this.e3,A),o=this.e0-2*this.e1*Math.cos(2*A)+4*this.e2*Math.cos(4*A)-6*this.e3*Math.cos(6*A),A-=r=(c*(n*(s=s/this.a)+1)-s-.5*n*(s*s+h))/(this.es*Math.sin(2*A)*(s*s+h-2*c*s)/(4*n)+(c-s)*(n*o-2/Math.sin(2*A))-o),Math.abs(r)<=y){i=A;break}n=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),t=E(this.long0+Math.asin(a*n/this.a)/Math.sin(i))}return e.x=t,e.y=i,e},names:["Polyconic","poly"]};var Ht={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(e){for(var t=e.x,i=e.y-this.lat0,t=t-this.long0,r=i/x*1e-5,i=t,n=1,o=0,s=1;s<=10;s++)o+=this.A[s]*(n*=r);var a,l=o,u=i,c=1,h=0,A=0,p=0;for(s=1;s<=6;s++)a=h*l+c*u,A=A+this.B_re[s]*(c=c*l-h*u)-this.B_im[s]*(h=a),p=p+this.B_im[s]*c+this.B_re[s]*h;return e.x=p*this.a+this.x0,e.y=A*this.a+this.y0,e},inverse:function(e){var t,i=e.x,r=e.y,i=i-this.x0,n=(r-this.y0)/this.a,o=i/this.a,s=1,a=0,l=0,u=0;for(g=1;g<=6;g++)t=a*n+s*o,l=l+this.C_re[g]*(s=s*n-a*o)-this.C_im[g]*(a=t),u=u+this.C_im[g]*s+this.C_re[g]*a;for(var c=0;c<this.iterations;c++){for(var h,A=l,p=u,f=n,d=o,g=2;g<=6;g++)h=p*l+A*u,A=A*l-p*u,p=h,f+=(g-1)*(this.B_re[g]*A-this.B_im[g]*p),d+=(g-1)*(this.B_im[g]*A+this.B_re[g]*p);var A=1,p=0,m=this.B_re[1],y=this.B_im[1];for(g=2;g<=6;g++)h=p*l+A*u,A=A*l-p*u,p=h,m+=g*(this.B_re[g]*A-this.B_im[g]*p),y+=g*(this.B_im[g]*A+this.B_re[g]*p);var _=m*m+y*y,l=(f*m+d*y)/_,u=(d*m-f*y)/_}var v=l,r=u,C=1,w=0;for(g=1;g<=9;g++)w+=this.D[g]*(C*=v);return i=this.lat0+w*x*1e5,r=this.long0+r,e.x=r,e.y=i,e},names:["New_Zealand_Map_Grid","nzmg"]};var Qt={init:function(){},forward:function(e){var t=e.x,i=e.y,t=E(t-this.long0),t=this.x0+this.a*t,i=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return e.x=t,e.y=i,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=E(this.long0+e.x/this.a),i=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=t,e.y=i,e},names:["Miller_Cylindrical","mill"]};var Vt={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Ge(this.es)},forward:function(e){var t=e.x,i=e.y,t=E(t-this.long0);if(this.sphere){if(this.m)for(var r=this.n*Math.sin(i),n=20;n;--n){var o=(this.m*i+Math.sin(i)-r)/(this.m+Math.cos(i));if(i-=o,Math.abs(o)<y)break}else i=1!==this.n?Math.asin(this.n*Math.sin(i)):i;u=this.a*this.C_x*t*(this.m+Math.cos(i)),l=this.a*this.C_y*i}else var s=Math.sin(i),a=Math.cos(i),l=this.a*rt(i,s,a,this.en),u=this.a*t*a/Math.sqrt(1-this.es*s*s);return e.x=u,e.y=l,e},inverse:function(e){var t,i,r,n;return e.x-=this.x0,r=e.x/this.a,e.y-=this.y0,t=e.y/this.a,this.sphere?(t/=this.C_y,r/=this.C_x*(this.m+Math.cos(t)),this.m?t=F((this.m*t+Math.sin(t))/this.n):1!==this.n&&(t=F(Math.sin(t)/this.n)),r=E(r+this.long0),t=L(t)):(t=ze(e.y/this.a,this.es,this.en),(n=Math.abs(t))<m?(n=Math.sin(t),i=this.long0+e.x*Math.sqrt(1-this.es*n*n)/(this.a*Math.cos(t)),r=E(i)):n-y<m&&(r=this.long0)),e.x=r,e.y=t,e},names:["Sinusoidal","sinu"]};var Gt={init:function(){},forward:function(e){for(var t=e.x,i=e.y,t=E(t-this.long0),r=i,n=Math.PI*Math.sin(i);;){var o=-(r+Math.sin(r)-n)/(1+Math.cos(r));if(r+=o,Math.abs(o)<y)break}return r/=2,Math.PI/2-Math.abs(i)<y&&(t=0),i=.900316316158*this.a*t*Math.cos(r)+this.x0,t=1.4142135623731*this.a*Math.sin(r)+this.y0,e.x=i,e.y=t,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0,t=e.y/(1.4142135623731*this.a),.999999999999<Math.abs(t)&&(t=.999999999999),r=Math.asin(t);var t,i=E(this.long0+e.x/(.900316316158*this.a*Math.cos(r))),r=((i=i<-Math.PI?-Math.PI:i)>Math.PI&&(i=Math.PI),t=(2*r+Math.sin(2*r))/Math.PI,1<Math.abs(t)&&(t=1),Math.asin(t));return e.x=i,e.y=r,e},names:["Mollweide","moll"]};var zt={init:function(){Math.abs(this.lat1+this.lat2)<y||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Ct(this.es),this.e1=wt(this.es),this.e2=xt(this.es),this.e3=bt(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=s(this.e,this.sinphi,this.cosphi),this.ml1=P(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<y?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=s(this.e,this.sinphi,this.cosphi),this.ml2=P(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=P(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(e){var t=e.x,i=e.y,t=(i=this.sphere?this.a*(this.g-i):(i=P(this.e0,this.e1,this.e2,this.e3,i),this.a*(this.g-i)),this.ns*E(t-this.long0)),r=this.x0+i*Math.sin(t),i=this.y0+this.rh-i*Math.cos(t);return e.x=r,e.y=i,e},inverse:function(e){e.x-=this.x0,e.y=this.rh-e.y+this.y0,i=0<=this.ns?(t=Math.sqrt(e.x*e.x+e.y*e.y),1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),-1);var t,i,r,n,o=0;return 0!==t&&(o=Math.atan2(i*e.x,i*e.y)),this.sphere?(n=E(this.long0+o/this.ns),r=L(this.g-t/this.a)):(i=this.g-t/this.a,r=Et(i,this.e0,this.e1,this.e2,this.e3),n=E(this.long0+o/this.ns)),e.x=n,e.y=r,e},names:["Equidistant_Conic","eqdc"]};var Wt={init:function(){this.R=this.a},forward:function(e){var t,i=e.x,r=e.y,i=E(i-this.long0),n=(Math.abs(r)<=y&&(t=this.x0+this.R*i,c=this.y0),F(2*Math.abs(r/Math.PI))),o=((Math.abs(i)<=y||Math.abs(Math.abs(r)-m)<=y)&&(t=this.x0,c=0<=r?this.y0+Math.PI*this.R*Math.tan(.5*n):this.y0+Math.PI*this.R*-Math.tan(.5*n)),.5*Math.abs(Math.PI/i-i/Math.PI)),s=o*o,a=Math.sin(n),n=Math.cos(n),l=(a=(n=n/(a+n-1))*(2/a-1))*a,u=Math.PI*this.R*(o*(n-l)+Math.sqrt(s*(n-l)*(n-l)-(l+s)*(n*n-l)))/(l+s),i=(t=this.x0+(u=i<0?-u:u),s+n),u=Math.PI*this.R*(a*i-o*Math.sqrt((l+s)*(1+s)-i*i))/(l+s),c=0<=r?this.y0+u:this.y0-u;return e.x=t,e.y=c,e},inverse:function(e){var t,i,r,n,o,s,a;return e.x-=this.x0,e.y-=this.y0,a=Math.PI*this.R,r=(t=e.x/a)*t+(i=e.y/a)*i,a=3*(i*i/(o=-2*(s=-Math.abs(i)*(1+r))+1+2*i*i+r*r)+(2*(n=s-2*i*i+t*t)*n*n/o/o/o-9*s*n/o/o)/27)/(s=(s-n*n/3/o)/o)/(s=2*Math.sqrt(-s/3)),1<Math.abs(a)&&(a=0<=a?1:-1),a=Math.acos(a)/3,s=0<=e.y?(-s*Math.cos(a+Math.PI/3)-n/3/o)*Math.PI:-(-s*Math.cos(a+Math.PI/3)-n/3/o)*Math.PI,a=Math.abs(t)<y?this.long0:E(this.long0+Math.PI*(r-1+Math.sqrt(1+2*(t*t-i*i)+r*r))/2/t),e.x=a,e.y=s,e},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]};var qt={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(e){var t,i,r,n,o,s,a,l=e.x,u=e.y,c=Math.sin(e.y),h=Math.cos(e.y),l=E(l-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=y?(e.x=this.x0+this.a*(m-u)*Math.sin(l),e.y=this.y0-this.a*(m-u)*Math.cos(l)):Math.abs(this.sin_p12+1)<=y?(e.x=this.x0+this.a*(m+u)*Math.sin(l),e.y=this.y0+this.a*(m+u)*Math.cos(l)):(n=this.sin_p12*c+this.cos_p12*h*Math.cos(l),s=(n=Math.acos(n))?n/Math.sin(n):1,e.x=this.x0+this.a*s*h*Math.sin(l),e.y=this.y0+this.a*s*(this.cos_p12*c-this.sin_p12*h*Math.cos(l))):(s=Ct(this.es),t=wt(this.es),r=xt(this.es),a=bt(this.es),Math.abs(this.sin_p12-1)<=y?(o=this.a*P(s,t,r,a,m),i=this.a*P(s,t,r,a,u),e.x=this.x0+(o-i)*Math.sin(l),e.y=this.y0-(o-i)*Math.cos(l)):Math.abs(this.sin_p12+1)<=y?(o=this.a*P(s,t,r,a,m),i=this.a*P(s,t,r,a,u),e.x=this.x0+(o+i)*Math.sin(l),e.y=this.y0+(o+i)*Math.cos(l)):(s=c/h,t=T(this.a,this.e,this.sin_p12),r=T(this.a,this.e,c),a=Math.atan((1-this.es)*s+this.es*t*this.sin_p12/(r*h)),o=0===(u=Math.atan2(Math.sin(l),this.cos_p12*Math.tan(a)-this.sin_p12*Math.cos(l)))?Math.asin(this.cos_p12*Math.sin(a)-this.sin_p12*Math.cos(a)):Math.abs(Math.abs(u)-Math.PI)<=y?-Math.asin(this.cos_p12*Math.sin(a)-this.sin_p12*Math.cos(a)):Math.asin(Math.sin(l)*Math.cos(a)/Math.sin(u)),i=this.e*this.sin_p12/Math.sqrt(1-this.es),c=this.e*this.cos_p12*Math.cos(u)/Math.sqrt(1-this.es),e.x=this.x0+(n=t*o*(1-(s=o*o)*(r=c*c)*(1-r)/6+(h=s*o)/8*(l=i*c)*(1-2*r)+(a=h*o)/120*(r*(4-7*r)-3*i*i*(1-7*r))-a*o/48*l))*Math.sin(u),e.y=this.y0+n*Math.cos(u))),e},inverse:function(e){var t,i,r,n,o,s,a,l;return e.x-=this.x0,e.y-=this.y0,this.sphere?(l=Math.sqrt(e.x*e.x+e.y*e.y))>2*m*this.a?void 0:(n=l/this.a,a=Math.sin(n),n=Math.cos(n),t=this.long0,Math.abs(l)<=y?i=this.lat0:(i=F(n*this.sin_p12+e.y*a*this.cos_p12/l),s=Math.abs(this.lat0)-m,t=Math.abs(s)<=y?0<=this.lat0?E(this.long0+Math.atan2(e.x,-e.y)):E(this.long0-Math.atan2(-e.x,e.y)):E(this.long0+Math.atan2(e.x*a,l*this.cos_p12*n-e.y*this.sin_p12*a))),e.x=t,e.y=i,e):(s=Ct(this.es),n=wt(this.es),a=xt(this.es),o=bt(this.es),Math.abs(this.sin_p12-1)<=y?(r=this.a*P(s,n,a,o,m),l=Math.sqrt(e.x*e.x+e.y*e.y),i=Et((r-l)/this.a,s,n,a,o),t=E(this.long0+Math.atan2(e.x,-1*e.y))):Math.abs(this.sin_p12+1)<=y?(r=this.a*P(s,n,a,o,m),l=Math.sqrt(e.x*e.x+e.y*e.y),i=Et((l-r)/this.a,s,n,a,o),t=E(this.long0+Math.atan2(e.x,e.y))):(l=Math.sqrt(e.x*e.x+e.y*e.y),r=Math.atan2(e.x,e.y),s=T(this.a,this.e,this.sin_p12),n=Math.cos(r),o=-(a=this.e*this.cos_p12*n)*a/(1-this.es),a=3*this.es*(1-o)*this.sin_p12*this.cos_p12*n/(1-this.es),a=1-o*(s=(l=l/s)-o*(1+o)*Math.pow(l,3)/6-a*(1+3*o)*Math.pow(l,4)/24)*s/2-l*s*s*s/6,o=Math.asin(this.sin_p12*Math.cos(s)+this.cos_p12*Math.sin(s)*n),t=E(this.long0+Math.asin(Math.sin(r)*Math.sin(s)/Math.cos(o))),l=Math.sin(o),i=Math.atan2((l-this.es*a*this.sin_p12)*Math.tan(o),l*(1-this.es))),e.x=t,e.y=i,e)},names:["Azimuthal_Equidistant","aeqd"]};var Kt={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(e){var t,i,r=e.x,n=e.y,r=E(r-this.long0),o=Math.sin(n),n=Math.cos(n),s=Math.cos(r),a=this.sin_p14*o+this.cos_p14*n*s;return(0<a||Math.abs(a)<=y)&&(t=+this.a*n*Math.sin(r),i=this.y0+ +this.a*(this.cos_p14*o-this.sin_p14*n*s)),e.x=t,e.y=i,e},inverse:function(e){var t,i,r,n,o,s;return e.x-=this.x0,e.y-=this.y0,t=Math.sqrt(e.x*e.x+e.y*e.y),r=F(t/this.a),i=Math.sin(r),r=Math.cos(r),o=this.long0,Math.abs(t)<=y?(s=this.lat0,e.x=o,e.y=s):(s=F(r*this.sin_p14+e.y*i*this.cos_p14/t),n=Math.abs(this.lat0)-m,o=Math.abs(n)<=y?0<=this.lat0?E(this.long0+Math.atan2(e.x,-e.y)):E(this.long0-Math.atan2(-e.x,e.y)):E(this.long0+Math.atan2(e.x*i,t*this.cos_p14*r-e.y*this.sin_p14*i)),e.x=o,e.y=s),e},names:["ortho"]},jt=1,Zt=2,Yt=3,Xt=4,Jt=5,$t=6,N={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function ei(e,t,i,r){var n;return e<y?(r.value=N.AREA_0,n=0):(n=Math.atan2(t,i),Math.abs(n)<=v?r.value=N.AREA_0:v<n&&n<=m+v?(r.value=N.AREA_1,n-=m):m+v<n||n<=-(m+v)?(r.value=N.AREA_2,n=0<=n?n-u:n+u):(r.value=N.AREA_3,n+=m)),n}function O(e,t){e+=t;return e<-u?e+=C:+u<e&&(e-=C),e}function ti(e,t){return e[0]+t*(e[1]+t*(e[2]+t*e[3]))}var ii={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=m-v/2?this.face=Jt:this.lat0<=-(m-v/2)?this.face=$t:Math.abs(this.long0)<=v?this.face=jt:Math.abs(this.long0)<=m+v?this.face=0<this.long0?Zt:Xt:this.face=Yt,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(e){var t,i,r,n,o,s,a={x:0,y:0},l={value:0};return e.x-=this.long0,o=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(e.y)):e.y,r=e.x,this.face===Jt?(i=m-o,t=v<=r&&r<=m+v?(l.value=N.AREA_0,r-m):m+v<r||r<=-(m+v)?(l.value=N.AREA_1,0<r?r-u:r+u):-(m+v)<r&&r<=-v?(l.value=N.AREA_2,r+m):(l.value=N.AREA_3,r)):this.face===$t?(i=m+o,t=v<=r&&r<=m+v?(l.value=N.AREA_0,-r+m):r<v&&-v<=r?(l.value=N.AREA_1,-r):r<-v&&-(m+v)<=r?(l.value=N.AREA_2,-r-m):(l.value=N.AREA_3,0<r?-r+u:-r-u)):(this.face===Zt?r=O(r,+m):this.face===Yt?r=O(r,+u):this.face===Xt&&(r=O(r,-m)),n=Math.sin(o),o=Math.cos(o),s=Math.sin(r),r=o*Math.cos(r),o=o*s,s=n,this.face===jt?t=ei(i=Math.acos(r),s,o,l):this.face===Zt?t=ei(i=Math.acos(o),s,-r,l):this.face===Yt?t=ei(i=Math.acos(-r),s,-o,l):this.face===Xt?t=ei(i=Math.acos(-o),s,r,l):(i=t=0,l.value=N.AREA_0)),n=Math.atan(12/u*(t+Math.acos(Math.sin(t)*Math.cos(v))-m)),o=Math.sqrt((1-Math.cos(i))/(Math.cos(n)*Math.cos(n))/(1-Math.cos(Math.atan(1/Math.cos(t))))),l.value===N.AREA_1?n+=m:l.value===N.AREA_2?n+=u:l.value===N.AREA_3&&(n+=1.5*u),a.x=o*Math.cos(n),a.y=o*Math.sin(n),a.x=a.x*this.a+this.x0,a.y=a.y*this.a+this.y0,e.x=a.x,e.y=a.y,e},inverse:function(e){var t,i,r,n,o,s={lam:0,phi:0},a={value:0};return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,r=Math.atan(Math.sqrt(e.x*e.x+e.y*e.y)),t=Math.atan2(e.y,e.x),0<=e.x&&e.x>=Math.abs(e.y)?a.value=N.AREA_0:0<=e.y&&e.y>=Math.abs(e.x)?(a.value=N.AREA_1,t-=m):e.x<0&&-e.x>=Math.abs(e.y)?(a.value=N.AREA_2,t=t<0?t+u:t-u):(a.value=N.AREA_3,t+=m),o=u/12*Math.tan(t),n=Math.sin(o)/(Math.cos(o)-1/Math.sqrt(2)),n=Math.atan(n),(r=1-(t=Math.cos(t))*t*(t=Math.tan(r))*t*(1-Math.cos(Math.atan(1/Math.cos(n)))))<-1?r=-1:1<r&&(r=1),this.face===Jt?(i=Math.acos(r),s.phi=m-i,a.value===N.AREA_0?s.lam=n+m:a.value===N.AREA_1?s.lam=n<0?n+u:n-u:a.value===N.AREA_2?s.lam=n-m:s.lam=n):this.face===$t?(i=Math.acos(r),s.phi=i-m,a.value===N.AREA_0?s.lam=-n+m:a.value===N.AREA_1?s.lam=-n:a.value===N.AREA_2?s.lam=-n-m:s.lam=n<0?-n-u:-n+u):(i=1<=(o=(t=r)*t)?0:Math.sqrt(1-o)*Math.sin(n),r=1<=(o+=i*i)?0:Math.sqrt(1-o),a.value===N.AREA_1?(o=r,r=-i,i=o):a.value===N.AREA_2?(r=-r,i=-i):a.value===N.AREA_3&&(o=r,r=i,i=-o),this.face===Zt?(o=t,t=-r,r=o):this.face===Yt?(t=-t,r=-r):this.face===Xt&&(o=t,t=r,r=-o),s.phi=Math.acos(-i)-m,s.lam=Math.atan2(r,t),this.face===Zt?s.lam=O(s.lam,-m):this.face===Yt?s.lam=O(s.lam,-u):this.face===Xt&&(s.lam=O(s.lam,+m))),0!==this.es&&(n=s.phi<0?1:0,a=Math.tan(s.phi),o=this.b/Math.sqrt(a*a+this.one_minus_f_squared),s.phi=Math.atan(Math.sqrt(this.a*this.a-o*o)/(this.one_minus_f*o)),n)&&(s.phi=-s.phi),s.lam+=this.long0,e.x=s.lam,e.y=s.phi,e},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},ri=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],ni=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],oi=A/5,si=1/oi;var ai={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(e){var t=E(e.x-this.long0),i=Math.abs(e.y),r=Math.floor(i*oi),t=(r<0?r=0:18<=r&&(r=17),{x:ti(ri[r],i=A*(i-si*r))*t,y:ti(ni[r],i)});return e.y<0&&(t.y=-t.y),t.x=t.x*this.a*.8487+this.x0,t.y=t.y*this.a*1.3523+this.y0,t},inverse:function(e){var t={x:(e.x-this.x0)/(.8487*this.a),y:Math.abs(e.y-this.y0)/(1.3523*this.a)};if(1<=t.y)t.x/=ri[18][0],t.y=e.y<0?-m:m;else{var i=Math.floor(18*t.y);for(i<0?i=0:18<=i&&(i=17);;)if(ni[i][0]>t.y)--i;else{if(!(ni[i+1][0]<=t.y))break;++i}var r=ni[i],n=function(e,t,i,r){for(var n=t;r;--r){var o=e(n);if(n-=o,Math.abs(o)<i)break}return n}(function(e){return(ti(r,e)-t.y)/(r[1]+e*(2*r[2]+3*e*r[3]))},5*(t.y-r[0])/(ni[i+1][0]-r[0]),y,100);t.x/=ti(ri[i],n),t.y=(5*i+n)*_,e.y<0&&(t.y=-t.y)}return t.x=E(t.x+this.long0),t},names:["Robinson","robin"]};var li={init:function(){this.name="geocent"},forward:function(e){return me(e,this.es,this.a)},inverse:function(e){return ye(e,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]},ui=0,ci=1,hi=2,Ai=3,pi={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};var fi={init:function(){if(Object.keys(pi).forEach(function(e){if(void 0===this[e])this[e]=pi[e].def;else{if(pi[e].num&&isNaN(this[e]))throw new Error("Invalid parameter value, must be numeric "+e+" = "+this[e]);pi[e].num&&(this[e]=parseFloat(this[e]))}pi[e].degrees&&(this[e]=this[e]*_)}.bind(this)),Math.abs(Math.abs(this.lat0)-m)<y?this.mode=this.lat0<0?ci:ui:Math.abs(this.lat0)<y?this.mode=hi:(this.mode=Ai,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||1e10<this.pn1)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var e=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(e),this.sw=Math.sin(e)},forward:function(e){e.x-=this.long0;var t,i,r,n,o=Math.sin(e.y),s=Math.cos(e.y),a=Math.cos(e.x);switch(this.mode){case Ai:i=this.sinph0*o+this.cosph0*s*a;break;case hi:i=s*a;break;case ci:i=-o;break;case ui:i=o}switch(t=(i=this.pn1/(this.p-i))*s*Math.sin(e.x),this.mode){case Ai:i*=this.cosph0*o-this.sinph0*s*a;break;case hi:i*=o;break;case ui:i*=-s*a;break;case ci:i*=s*a}return n=1/((r=i*this.cg+t*this.sg)*this.sw*this.h1+this.cw),t=(t*this.cg-i*this.sg)*this.cw*n,i=r*n,e.x=t*this.a,e.y=i*this.a,e},inverse:function(e){e.x/=this.a,e.y/=this.a;var t={x:e.x,y:e.y},i=1/(this.pn1-e.y*this.sw),r=this.pn1*e.x*i,i=this.pn1*e.y*this.cw*i,n=(e.x=r*this.cg+i*this.sg,e.y=i*this.cg-r*this.sg,ut(e.x,e.y));if(Math.abs(n)<y)t.x=0,t.y=e.y;else{var o,s=1-n*n*this.pfact;switch(s=(this.p-Math.sqrt(s))/(this.pn1/n+n/this.pn1),o=Math.sqrt(1-s*s),this.mode){case Ai:t.y=Math.asin(o*this.sinph0+e.y*s*this.cosph0/n),e.y=(o-this.sinph0*Math.sin(t.y))*n,e.x*=s*this.cosph0;break;case hi:t.y=Math.asin(e.y*s/n),e.y=o*n,e.x*=s;break;case ui:t.y=Math.asin(o),e.y=-e.y;break;case ci:t.y=-Math.asin(o)}t.x=Math.atan2(e.x,e.y)}return e.x=t.x+this.long0,e.y=t.y,e},names:["Tilted_Perspective","tpers"]};return t.defaultDatum="WGS84",t.Proj=M,t.WGS84=new t.Proj("WGS84"),t.Point=h,t.toPoint=be,t.defs=o,t.nadgrid=function(e,t){var i=function(e){if(11===e.getInt32(8,!1))return!1;11!==e.getInt32(8,!0)&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian");return!0}(t=new DataView(t)),r=(n=i,{nFields:(r=t).getInt32(8,n),nSubgridFields:r.getInt32(24,n),nSubgrids:r.getInt32(40,n),shiftType:ge(r,56,64).trim(),fromSemiMajorAxis:r.getFloat64(120,n),fromSemiMinorAxis:r.getFloat64(136,n),toSemiMajorAxis:r.getFloat64(152,n),toSemiMinorAxis:r.getFloat64(168,n)}),n=(1<r.nSubgrids&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored"),{header:r,subgrids:function(e,t,i){for(var r=[],n=0;n<t.nSubgrids;n++){var o=function(e,t,i){return{name:ge(e,t+8,t+16).trim(),parent:ge(e,t+24,t+24+8).trim(),lowerLatitude:e.getFloat64(t+72,i),upperLatitude:e.getFloat64(t+88,i),lowerLongitude:e.getFloat64(t+104,i),upperLongitude:e.getFloat64(t+120,i),latitudeInterval:e.getFloat64(t+136,i),longitudeInterval:e.getFloat64(t+152,i),gridNodeCount:e.getInt32(t+168,i)}}(e,176,i),s=function(e,t,i,r){for(var n=t+176,o=[],s=0;s<i.gridNodeCount;s++){var a={latitudeShift:e.getFloat32(n+16*s,r),longitudeShift:e.getFloat32(n+16*s+4,r),latitudeAccuracy:e.getFloat32(n+16*s+8,r),longitudeAccuracy:e.getFloat32(n+16*s+12,r)};o.push(a)}return o}(e,176,o,i),a=Math.round(1+(o.upperLongitude-o.lowerLongitude)/o.longitudeInterval),l=Math.round(1+(o.upperLatitude-o.lowerLatitude)/o.latitudeInterval);r.push({ll:[c(o.lowerLongitude),c(o.lowerLatitude)],del:[c(o.longitudeInterval),c(o.latitudeInterval)],lim:[a,l],count:o.gridNodeCount,cvs:function(e){return e.map(function(e){return[c(e.longitudeShift),c(e.latitudeShift)]})}(s)})}return r}(t,r,i)});return fe[e]=n},t.transform=Me,t.mgrs=e,t.version="2.7.4",(e=t).Proj.projections.add(at),e.Proj.projections.add(At),e.Proj.projections.add(ft),e.Proj.projections.add(gt),e.Proj.projections.add(mt),e.Proj.projections.add(yt),e.Proj.projections.add(_t),e.Proj.projections.add(vt),e.Proj.projections.add(Bt),e.Proj.projections.add(Mt),e.Proj.projections.add(Ft),e.Proj.projections.add(Nt),e.Proj.projections.add(Ot),e.Proj.projections.add(Rt),e.Proj.projections.add(Ut),e.Proj.projections.add(kt),e.Proj.projections.add(Ht),e.Proj.projections.add(Qt),e.Proj.projections.add(Vt),e.Proj.projections.add(Gt),e.Proj.projections.add(zt),e.Proj.projections.add(Wt),e.Proj.projections.add(qt),e.Proj.projections.add(Kt),e.Proj.projections.add(ii),e.Proj.projections.add(ai),e.Proj.projections.add(li),e.Proj.projections.add(fi),t},"object"==typeof i&&void 0!==t?t.exports=n():r.proj4=n()},{}],18:[function(e,t,i){
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
var r=e("buffer"),n=r.Buffer;function o(e,t){for(var i in e)t[i]=e[i]}function s(e,t,i){return n(e,t,i)}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?t.exports=r:(o(r,i),i.Buffer=s),s.prototype=Object.create(n.prototype),o(n,s),s.from=function(e,t,i){if("number"==typeof e)throw new TypeError("Argument must not be a number");return n(e,t,i)},s.alloc=function(e,t,i){if("number"!=typeof e)throw new TypeError("Argument must be a number");e=n(e);return void 0!==t?"string"==typeof i?e.fill(t,i):e.fill(t):e.fill(0),e},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},{buffer:8}],19:[function(e,t,i){"use strict";var r=e("safe-buffer").Buffer,n=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"==typeof t||r.isEncoding!==n&&n(e))return t||e;throw new Error("Unknown encoding: "+e)}function s(e){var t;switch(this.encoding=o(e),this.encoding){case"utf16le":this.text=u,this.end=c,t=4;break;case"utf8":this.fillLast=l,t=4;break;case"base64":this.text=h,this.end=A,t=3;break;default:return this.write=p,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function a(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function l(e){var t,i=this.lastTotal-this.lastNeed,r=(t=this,128!=(192&(r=e)[0])?(t.lastNeed=0,"�"):1<t.lastNeed&&1<r.length?128!=(192&r[1])?(t.lastNeed=1,"�"):2<t.lastNeed&&2<r.length&&128!=(192&r[2])?(t.lastNeed=2,"�"):void 0:void 0);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,i,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,i,0,e.length),void(this.lastNeed-=e.length))}function u(e,t){if((e.length-t)%2!=0)return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1);t=e.toString("utf16le",t);if(t){var i=t.charCodeAt(t.length-1);if(55296<=i&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],t.slice(0,-1)}return t}function c(e){var t,e=e&&e.length?this.write(e):"";return this.lastNeed?(t=this.lastTotal-this.lastNeed,e+this.lastChar.toString("utf16le",0,t)):e}function h(e,t){var i=(e.length-t)%3;return 0==i?e.toString("base64",t):(this.lastNeed=3-i,this.lastTotal=3,1==i?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-i))}function A(e){e=e&&e.length?this.write(e):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function p(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}(i.StringDecoder=s).prototype.write=function(e){if(0===e.length)return"";var t,i;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<e.length?t?t+this.text(e,i):this.text(e,i):t||""},s.prototype.end=function(e){e=e&&e.length?this.write(e):"";return this.lastNeed?e+"�":e},s.prototype.text=function(e,t){var i=function(e,t,i){var r=t.length-1;if(!(r<i)){var n=a(t[r]);if(0<=n)return 0<n&&(e.lastNeed=n-1),n;if(!(--r<i||-2===n)){if(0<=(n=a(t[r])))return 0<n&&(e.lastNeed=n-2),n;if(!(--r<i||-2===n)&&0<=(n=a(t[r])))return 0<n&&(2===n?n=0:e.lastNeed=n-3),n}}return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=i;i=e.length-(i-this.lastNeed);return e.copy(this.lastChar,0,i),e.toString("utf8",t,i)},s.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":18}],20:[function(e,t,i){t.exports=e("./lib/encoding.js")},{"./lib/encoding.js":21}],21:[function(V,G,e){!function(i){"use strict";function g(e,t,i){return t<=e&&e<=i}void 0!==G&&G.exports&&!i["encoding-indexes"]&&V("./encoding-indexes.js");var a=Math.floor;function s(e){if(void 0===e)return{};if(e===Object(e))return e;throw TypeError("Could not convert argument to dictionary")}function u(e){return 0<=e&&e<=127}var l=u;function c(e){this.tokens=[].slice.call(e),this.tokens.reverse()}c.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.pop():-1},prepend:function(e){if(Array.isArray(e))for(var t=e;t.length;)this.tokens.push(t.pop());else this.tokens.push(e)},push:function(e){if(Array.isArray(e))for(var t=e;t.length;)this.tokens.unshift(t.shift());else this.tokens.unshift(e)}};function m(e,t){if(e)throw TypeError("Decoder error");return t||65533}function h(e){throw TypeError("The code point "+e+" could not be encoded.")}function r(e){return e=String(e).trim().toLowerCase(),Object.prototype.hasOwnProperty.call(A,e)?A[e]:null}var n,o,e=[{encodings:[{labels:["unicode-1-1-utf-8","utf-8","utf8"],name:"UTF-8"}],heading:"The Encoding"},{encodings:[{labels:["866","cp866","csibm866","ibm866"],name:"IBM866"},{labels:["csisolatin2","iso-8859-2","iso-ir-101","iso8859-2","iso88592","iso_8859-2","iso_8859-2:1987","l2","latin2"],name:"ISO-8859-2"},{labels:["csisolatin3","iso-8859-3","iso-ir-109","iso8859-3","iso88593","iso_8859-3","iso_8859-3:1988","l3","latin3"],name:"ISO-8859-3"},{labels:["csisolatin4","iso-8859-4","iso-ir-110","iso8859-4","iso88594","iso_8859-4","iso_8859-4:1988","l4","latin4"],name:"ISO-8859-4"},{labels:["csisolatincyrillic","cyrillic","iso-8859-5","iso-ir-144","iso8859-5","iso88595","iso_8859-5","iso_8859-5:1988"],name:"ISO-8859-5"},{labels:["arabic","asmo-708","csiso88596e","csiso88596i","csisolatinarabic","ecma-114","iso-8859-6","iso-8859-6-e","iso-8859-6-i","iso-ir-127","iso8859-6","iso88596","iso_8859-6","iso_8859-6:1987"],name:"ISO-8859-6"},{labels:["csisolatingreek","ecma-118","elot_928","greek","greek8","iso-8859-7","iso-ir-126","iso8859-7","iso88597","iso_8859-7","iso_8859-7:1987","sun_eu_greek"],name:"ISO-8859-7"},{labels:["csiso88598e","csisolatinhebrew","hebrew","iso-8859-8","iso-8859-8-e","iso-ir-138","iso8859-8","iso88598","iso_8859-8","iso_8859-8:1988","visual"],name:"ISO-8859-8"},{labels:["csiso88598i","iso-8859-8-i","logical"],name:"ISO-8859-8-I"},{labels:["csisolatin6","iso-8859-10","iso-ir-157","iso8859-10","iso885910","l6","latin6"],name:"ISO-8859-10"},{labels:["iso-8859-13","iso8859-13","iso885913"],name:"ISO-8859-13"},{labels:["iso-8859-14","iso8859-14","iso885914"],name:"ISO-8859-14"},{labels:["csisolatin9","iso-8859-15","iso8859-15","iso885915","iso_8859-15","l9"],name:"ISO-8859-15"},{labels:["iso-8859-16"],name:"ISO-8859-16"},{labels:["cskoi8r","koi","koi8","koi8-r","koi8_r"],name:"KOI8-R"},{labels:["koi8-ru","koi8-u"],name:"KOI8-U"},{labels:["csmacintosh","mac","macintosh","x-mac-roman"],name:"macintosh"},{labels:["dos-874","iso-8859-11","iso8859-11","iso885911","tis-620","windows-874"],name:"windows-874"},{labels:["cp1250","windows-1250","x-cp1250"],name:"windows-1250"},{labels:["cp1251","windows-1251","x-cp1251"],name:"windows-1251"},{labels:["ansi_x3.4-1968","ascii","cp1252","cp819","csisolatin1","ibm819","iso-8859-1","iso-ir-100","iso8859-1","iso88591","iso_8859-1","iso_8859-1:1987","l1","latin1","us-ascii","windows-1252","x-cp1252"],name:"windows-1252"},{labels:["cp1253","windows-1253","x-cp1253"],name:"windows-1253"},{labels:["cp1254","csisolatin5","iso-8859-9","iso-ir-148","iso8859-9","iso88599","iso_8859-9","iso_8859-9:1989","l5","latin5","windows-1254","x-cp1254"],name:"windows-1254"},{labels:["cp1255","windows-1255","x-cp1255"],name:"windows-1255"},{labels:["cp1256","windows-1256","x-cp1256"],name:"windows-1256"},{labels:["cp1257","windows-1257","x-cp1257"],name:"windows-1257"},{labels:["cp1258","windows-1258","x-cp1258"],name:"windows-1258"},{labels:["x-mac-cyrillic","x-mac-ukrainian"],name:"x-mac-cyrillic"}],heading:"Legacy single-byte encodings"},{encodings:[{labels:["chinese","csgb2312","csiso58gb231280","gb2312","gb_2312","gb_2312-80","gbk","iso-ir-58","x-gbk"],name:"GBK"},{labels:["gb18030"],name:"gb18030"}],heading:"Legacy multi-byte Chinese (simplified) encodings"},{encodings:[{labels:["big5","big5-hkscs","cn-big5","csbig5","x-x-big5"],name:"Big5"}],heading:"Legacy multi-byte Chinese (traditional) encodings"},{encodings:[{labels:["cseucpkdfmtjapanese","euc-jp","x-euc-jp"],name:"EUC-JP"},{labels:["csiso2022jp","iso-2022-jp"],name:"ISO-2022-JP"},{labels:["csshiftjis","ms932","ms_kanji","shift-jis","shift_jis","sjis","windows-31j","x-sjis"],name:"Shift_JIS"}],heading:"Legacy multi-byte Japanese encodings"},{encodings:[{labels:["cseuckr","csksc56011987","euc-kr","iso-ir-149","korean","ks_c_5601-1987","ks_c_5601-1989","ksc5601","ksc_5601","windows-949"],name:"EUC-KR"}],heading:"Legacy multi-byte Korean encodings"},{encodings:[{labels:["csiso2022kr","hz-gb-2312","iso-2022-cn","iso-2022-cn-ext","iso-2022-kr"],name:"replacement"},{labels:["utf-16be"],name:"UTF-16BE"},{labels:["utf-16","utf-16le"],name:"UTF-16LE"},{labels:["x-user-defined"],name:"x-user-defined"}],heading:"Legacy miscellaneous encodings"}],A={},p=(e.forEach(function(e){e.encodings.forEach(function(t){t.labels.forEach(function(e){A[e]=t})})}),{}),f={};function y(e,t){return t&&t[e]||null}function d(e,t){t=t.indexOf(e);return-1===t?null:t}function _(e){if("encoding-indexes"in i)return i["encoding-indexes"][e];throw Error("Indexes missing. Did you forget to include encoding-indexes.js first?")}function v(e,t){if(!(this instanceof v))throw TypeError("Called as a function. Did you forget 'new'?");e=void 0!==e?String(e):"utf-8",t=s(t),this._encoding=null,this._decoder=null,this._ignoreBOM=!1,this._BOMseen=!1,this._error_mode="replacement",this._do_not_flush=!1;var i=r(e);if(null===i||"replacement"===i.name)throw RangeError("Unknown encoding: "+e);if(f[i.name])return this._encoding=i,Boolean(t.fatal)&&(this._error_mode="fatal"),Boolean(t.ignoreBOM)&&(this._ignoreBOM=!0),Object.defineProperty||(this.encoding=this._encoding.name.toLowerCase(),this.fatal="fatal"===this._error_mode,this.ignoreBOM=this._ignoreBOM),this;throw Error("Decoder not present. Did you forget to include encoding-indexes.js first?")}function C(e,t){if(!(this instanceof C))throw TypeError("Called as a function. Did you forget 'new'?");t=s(t),this._encoding=null,this._encoder=null,this._do_not_flush=!1,this._fatal=Boolean(t.fatal)?"fatal":"replacement";if(Boolean(t.NONSTANDARD_allowLegacyEncoding)){t=r(e=void 0!==e?String(e):"utf-8");if(null===t||"replacement"===t.name)throw RangeError("Unknown encoding: "+e);if(!p[t.name])throw Error("Encoder not present. Did you forget to include encoding-indexes.js first?");this._encoding=t}else this._encoding=r("utf-8"),void 0!==e&&"console"in i&&console.warn("TextEncoder constructor called with encoding label, which is ignored.");return Object.defineProperty||(this.encoding=this._encoding.name.toLowerCase()),this}function t(e){var r=e.fatal,n=0,o=0,s=0,a=128,l=191;this.handler=function(e,t){if(-1===t&&0!==s)return s=0,m(r);if(-1===t)return-1;if(0===s){if(g(t,0,127))return t;if(g(t,194,223))s=1,n=31&t;else if(g(t,224,239))224===t&&(a=160),237===t&&(l=159),s=2,n=15&t;else{if(!g(t,240,244))return m(r);240===t&&(a=144),244===t&&(l=143),s=3,n=7&t}return null}var i;return g(t,a,l)?(a=128,l=191,n=n<<6|63&t,(o+=1)!==s?null:(i=n,n=s=o=0,i)):(n=s=o=0,a=128,l=191,e.prepend(t),m(r))}}function w(e){e.fatal;this.handler=function(e,t){if(-1===t)return-1;if(l(t))return t;g(t,128,2047)?(i=1,r=192):g(t,2048,65535)?(i=2,r=224):g(t,65536,1114111)&&(i=3,r=240);for(var i,r,n=[(t>>6*i)+r];0<i;)n.push(128|63&t>>6*(i-1)),--i;return n}}function x(i,e){var r=e.fatal;this.handler=function(e,t){return-1===t?-1:u(t)?t:null===(t=i[t-128])?m(r):t}}function b(r,e){e.fatal;this.handler=function(e,t){var i;return-1===t?-1:l(t)?t:(null===(i=d(t,r))&&h(t),i+128)}}function E(e){var o=e.fatal,s=0,a=0,l=0;this.handler=function(e,t){var i,r,n;return-1===t&&0===s&&0===a&&0===l?-1:(-1!==t||0===s&&0===a&&0===l||(l=a=s=0,m(o)),0!==l?(i=null,g(t,48,57)&&(i=function(e){if(39419<e&&e<189e3||1237575<e)return null;if(7457===e)return 59335;for(var t=0,i=0,r=_("gb18030-ranges"),n=0;n<r.length;++n){var o=r[n];if(!(o[0]<=e))break;t=o[0],i=o[1]}return i+e-t}(10*(126*(10*(s-129)+a-48)+l-129)+t-48)),r=[a,l,t],l=a=s=0,null===i?(e.prepend(r),m(o)):i):0!==a?g(t,129,254)?(l=t,null):(e.prepend([a,t]),a=s=0,m(o)):0!==s?g(t,48,57)?(a=t,null):(r=s,s=0,(n=null)===(i=null===(n=g(t,64,126)||g(t,128,254)?190*(r-129)+(t-(t<127?64:65)):n)?null:y(n,_("gb18030")))&&u(t)&&e.prepend(t),null===i?m(o):i):u(t)?t:128===t?8364:g(t,129,254)?(s=t,null):m(o))}}function B(e,n){e.fatal;this.handler=function(e,t){var i,r;return-1===t?-1:l(t)?t:58853===t?h(t):n&&8364===t?128:null!==(i=d(t,_("gb18030")))?(r=i%190,[a(i/190)+129,r+(r<63?64:65)]):n?h(t):(i=function(e){if(59335===e)return 7457;for(var t=0,i=0,r=_("gb18030-ranges"),n=0;n<r.length;++n){var o=r[n];if(!(o[1]<=e))break;t=o[1],i=o[0]}return i+e-t}(t),[(r=a(i/10/126/10))+129,(t=a((i-=10*r*126*10)/10/126))+48,(r=a((i-=10*t*126)/10))+129,48+(i-10*r)])}}function M(e){var n=e.fatal,o=0;this.handler=function(e,t){if(-1===t&&0!==o)return o=0,m(n);if(-1===t&&0===o)return-1;if(0===o)return u(t)?t:g(t,129,254)?(o=t,null):m(n);var i=o,r=null;switch(o=0,r=g(t,64,126)||g(t,161,254)?157*(i-129)+(t-(t<127?64:98)):r){case 1133:return[202,772];case 1135:return[202,780];case 1164:return[234,772];case 1166:return[234,780]}i=null===r?null:y(r,_("big5"));return null===i&&u(t)&&e.prepend(t),null===i?m(n):i}}function I(e){e.fatal;this.handler=function(e,t){var i,r;return-1===t?-1:l(t)?t:(i=t,r=o=o||_("big5").map(function(e,t){return t<5024?null:e}),null===(i=9552===i||9566===i||9569===i||9578===i||21313===i||21317===i?r.lastIndexOf(i):d(i,r))||(r=a(i/157)+129)<161?h(t):[r,(t=i%157)+(t<63?64:98)])}}function S(e){var n=e.fatal,o=!1,s=0;this.handler=function(e,t){var i,r;return-1===t&&0!==s?(s=0,m(n)):-1===t&&0===s?-1:142===s&&g(t,161,223)?(s=0,65216+t):143===s&&g(t,161,254)?(o=!0,s=t,null):0!==s?(i=s,s=0,r=null,g(i,161,254)&&g(t,161,254)&&(r=y(94*(i-161)+(t-161),_(o?"jis0212":"jis0208"))),o=!1,g(t,161,254)||e.prepend(t),null===r?m(n):r):u(t)?t:142===t||143===t||g(t,161,254)?(s=t,null):m(n)}}function P(e){e.fatal;this.handler=function(e,t){var i;return-1===t?-1:l(t)?t:165===t?92:8254===t?126:g(t,65377,65439)?[142,t-65377+161]:null===(i=d(t=8722===t?65293:t,_("jis0208")))?h(t):[a(i/94)+161,i%94+161]}}function T(e){var n=e.fatal,o=0,s=1,a=2,l=3,u=4,c=5,h=6,A=o,p=o,f=0,d=!1;this.handler=function(e,t){switch(A){default:case o:return 27===t?(A=c,null):g(t,0,127)&&14!==t&&15!==t&&27!==t?(d=!1,t):-1===t?-1:(d=!1,m(n));case s:return 27===t?(A=c,null):92===t?(d=!1,165):126===t?(d=!1,8254):g(t,0,127)&&14!==t&&15!==t&&27!==t&&92!==t&&126!==t?(d=!1,t):-1===t?-1:(d=!1,m(n));case a:return 27===t?(A=c,null):g(t,33,95)?(d=!1,65344+t):-1===t?-1:(d=!1,m(n));case l:return 27===t?(A=c,null):g(t,33,126)?(d=!1,f=t,A=u,null):-1===t?-1:(d=!1,m(n));case u:if(27===t)A=c;else{if(g(t,33,126))return A=l,null===(i=y(94*(f-33)+t-33,_("jis0208")))?m(n):i;-1===t?(A=l,e.prepend(t)):A=l}return m(n);case c:return 36===t||40===t?(f=t,A=h,null):(e.prepend(t),d=!1,A=p,m(n));case h:var i=f,r=(f=0,null);return(40===i&&66===t&&(r=o),40===i&&74===t&&(r=s),40===i&&73===t&&(r=a),null!==(r=36!==i||64!==t&&66!==t?r:l))?(A=r,r=d,d=!0,r?m(n):null):(e.prepend([i,t]),d=!1,A=p,m(n))}}}function L(e){e.fatal;var r=0,n=1,o=2,s=r;this.handler=function(e,t){if(-1===t&&s!==r)return e.prepend(t),s=r,[27,40,66];if(-1===t&&s===r)return-1;if(!(s!==r&&s!==n||14!==t&&15!==t&&27!==t))return h(65533);if(s===r&&l(t))return t;if(s===n&&(l(t)&&92!==t&&126!==t||165==t||8254==t)){if(l(t))return t;if(165===t)return 92;if(8254===t)return 126}var i;return l(t)&&s!==r?(e.prepend(t),s=r,[27,40,66]):165!==t&&8254!==t||s===n?null===(i=d(t=8722===t?65293:t,_("jis0208")))?h(t):s!==o?(e.prepend(t),s=o,[27,36,66]):[a(i/94)+33,i%94+33]:(e.prepend(t),s=n,[27,40,74])}}function O(e){var n=e.fatal,o=0;this.handler=function(e,t){var i,r;return-1===t&&0!==o?(o=0,m(n)):-1===t&&0===o?-1:0!==o?(r=o,i=null,o=0,(g(t,64,126)||g(t,128,252))&&(i=188*(r-(r<160?129:193))+t-(t<127?64:65)),g(i,8836,10715)?48508+i:(null===(r=null===i?null:y(i,_("jis0208")))&&u(t)&&e.prepend(t),null===r?m(n):r)):u(t)||128===t?t:g(t,161,223)?65216+t:g(t,129,159)||g(t,224,252)?(o=t,null):m(n)}}function R(e){e.fatal;this.handler=function(e,t){var i;return-1===t?-1:l(t)||128===t?t:165===t?92:8254===t?126:g(t,65377,65439)?t-65377+161:(i=t=8722===t?65293:t,null===(i=(n=n||_("jis0208").map(function(e,t){return g(t,8272,8835)?null:e})).indexOf(i))?h(t):[(t=a(i/188))+(t<31?129:193),(t=i%188)+(t<63?64:65)])}}function U(e){var n=e.fatal,o=0;this.handler=function(e,t){var i,r;return-1===t&&0!==o?(o=0,m(n)):-1===t&&0===o?-1:0!==o?(r=o,o=0,r=(i=null)===(i=g(t,65,254)?190*(r-129)+(t-65):i)?null:y(i,_("euc-kr")),null===i&&u(t)&&e.prepend(t),null===r?m(n):r):u(t)?t:g(t,129,254)?(o=t,null):m(n)}}function k(e){e.fatal;this.handler=function(e,t){var i;return-1===t?-1:l(t)?t:null===(i=d(t,_("euc-kr")))?h(t):[a(i/190)+129,i%190+65]}}function D(e,t){var i=e>>8,e=255&e;return t?[i,e]:[e,i]}function F(r,e){var n=e.fatal,o=null,s=null;this.handler=function(e,t){var i;return-1!==t||null===o&&null===s?-1===t&&null===o&&null===s?-1:null===o?(o=t,null):(t=r?(o<<8)+t:(t<<8)+o,(o=null)!==s?(i=s,s=null,g(t,56320,57343)?65536+1024*(i-55296)+(t-56320):(e.prepend(D(t,r)),m(n))):g(t,55296,56319)?(s=t,null):g(t,56320,57343)?m(n):t):m(n)}}function N(r,e){e.fatal;this.handler=function(e,t){var i;return-1===t?-1:g(t,0,65535)?D(t,r):(i=D(55296+(t-65536>>10),r),t=D(56320+(t-65536&1023),r),i.concat(t))}}function H(e){e.fatal;this.handler=function(e,t){return-1===t?-1:u(t)?t:63360+t-128}}function Q(e){e.fatal;this.handler=function(e,t){return-1===t?-1:l(t)?t:g(t,63360,63487)?t-63360+128:h(t)}}Object.defineProperty&&(Object.defineProperty(v.prototype,"encoding",{get:function(){return this._encoding.name.toLowerCase()}}),Object.defineProperty(v.prototype,"fatal",{get:function(){return"fatal"===this._error_mode}}),Object.defineProperty(v.prototype,"ignoreBOM",{get:function(){return this._ignoreBOM}})),v.prototype.decode=function(e,t){e="object"==typeof e&&e instanceof ArrayBuffer?new Uint8Array(e):"object"==typeof e&&"buffer"in e&&e.buffer instanceof ArrayBuffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(0);t=s(t),this._do_not_flush||(this._decoder=f[this._encoding.name]({fatal:"fatal"===this._error_mode}),this._BOMseen=!1),this._do_not_flush=Boolean(t.stream);for(var i,r=new c(e),n=[];;){var o=r.read();if(-1===o)break;if(-1===(i=this._decoder.handler(r,o)))break;null!==i&&(Array.isArray(i)?n.push.apply(n,i):n.push(i))}if(!this._do_not_flush){for(;-1!==(i=this._decoder.handler(r,r.read()))&&(null!==i&&(Array.isArray(i)?n.push.apply(n,i):n.push(i)),!r.endOfStream()););this._decoder=null}return function(e){t=["UTF-8","UTF-16LE","UTF-16BE"],i=this._encoding.name,-1===t.indexOf(i)||this._ignoreBOM||this._BOMseen||(0<e.length&&65279===e[0]?(this._BOMseen=!0,e.shift()):0<e.length&&(this._BOMseen=!0));for(var t,i,r=e,n="",o=0;o<r.length;++o){var s=r[o];s<=65535?n+=String.fromCharCode(s):(s-=65536,n+=String.fromCharCode(55296+(s>>10),56320+(1023&s)))}return n}.call(this,n)},Object.defineProperty&&Object.defineProperty(C.prototype,"encoding",{get:function(){return this._encoding.name.toLowerCase()}}),C.prototype.encode=function(e,t){e=void 0===e?"":String(e),t=s(t),this._do_not_flush||(this._encoder=p[this._encoding.name]({fatal:"fatal"===this._fatal})),this._do_not_flush=Boolean(t.stream);for(var i,r=new c(function(e){for(var t=String(e),i=t.length,r=0,n=[];r<i;){var o,s=t.charCodeAt(r);s<55296||57343<s?n.push(s):56320<=s&&s<=57343?n.push(65533):55296<=s&&s<=56319&&(r!==i-1&&56320<=(o=t.charCodeAt(r+1))&&o<=57343?(n.push(65536+((1023&s)<<10)+(1023&o)),r+=1):n.push(65533)),r+=1}return n}(e)),n=[];;){var o=r.read();if(-1===o)break;if(-1===(i=this._encoder.handler(r,o)))break;Array.isArray(i)?n.push.apply(n,i):n.push(i)}if(!this._do_not_flush){for(;;){if(-1===(i=this._encoder.handler(r,r.read())))break;Array.isArray(i)?n.push.apply(n,i):n.push(i)}this._encoder=null}return new Uint8Array(n)},p["UTF-8"]=function(e){return new w(e)},f["UTF-8"]=function(e){return new t(e)},"encoding-indexes"in i&&e.forEach(function(e){"Legacy single-byte encodings"===e.heading&&e.encodings.forEach(function(e){var e=e.name,t=_(e.toLowerCase());f[e]=function(e){return new x(t,e)},p[e]=function(e){return new b(t,e)}})}),f.GBK=function(e){return new E(e)},p.GBK=function(e){return new B(e,!0)},p.gb18030=function(e){return new B(e)},f.gb18030=function(e){return new E(e)},p.Big5=function(e){return new I(e)},f.Big5=function(e){return new M(e)},p["EUC-JP"]=function(e){return new P(e)},f["EUC-JP"]=function(e){return new S(e)},p["ISO-2022-JP"]=function(e){return new L(e)},f["ISO-2022-JP"]=function(e){return new T(e)},p.Shift_JIS=function(e){return new R(e)},f.Shift_JIS=function(e){return new O(e)},p["EUC-KR"]=function(e){return new k(e)},f["EUC-KR"]=function(e){return new U(e)},p["UTF-16BE"]=function(e){return new N(!0,e)},f["UTF-16BE"]=function(e){return new F(!0,e)},p["UTF-16LE"]=function(e){return new N(!1,e)},f["UTF-16LE"]=function(e){return new F(!1,e)},p["x-user-defined"]=function(e){return new Q(e)},f["x-user-defined"]=function(e){return new H(e)},i.TextEncoder||(i.TextEncoder=C),i.TextDecoder||(i.TextDecoder=v),void 0!==G&&G.exports&&(G.exports={TextEncoder:i.TextEncoder,TextDecoder:i.TextDecoder,EncodingIndexes:i["encoding-indexes"]})}(this||{})},{"./encoding-indexes.js":7}],22:[function(l,e,u){!function(i,a){!function(){var r=l("process/browser.js").nextTick,e=Function.prototype.apply,n=Array.prototype.slice,o={},s=0;function t(e,t){this._id=e,this._clearFn=t}u.setTimeout=function(){return new t(e.call(setTimeout,window,arguments),clearTimeout)},u.setInterval=function(){return new t(e.call(setInterval,window,arguments),clearInterval)},u.clearTimeout=u.clearInterval=function(e){e.close()},t.prototype.unref=t.prototype.ref=function(){},t.prototype.close=function(){this._clearFn.call(window,this._id)},u.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},u.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},u._unrefActive=u.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},u.setImmediate="function"==typeof i?i:function(e){var t=s++,i=!(arguments.length<2)&&n.call(arguments,1);return o[t]=!0,r(function(){o[t]&&(i?e.apply(null,i):e.call(null),u.clearImmediate(t))}),t},u.clearImmediate="function"==typeof a?a:function(e){delete o[e]}}.call(this)}.call(this,l("timers").setImmediate,l("timers").clearImmediate)},{"process/browser.js":16,timers:22}],23:[function(f,d,e){!function(p){!function(){"use strict";let s=f("proj4");s.default&&(s=s.default);const r=f("./unzip"),n=f("./binaryajax"),a=f("./parseShp"),l=f("parsedbf"),o=f("lie");var e=f("lru-cache");const i=f("buffer").Buffer,u=p.URL,c=new e({max:20});function h(e){if(e)return i.isBuffer(e)?e:t(e)?i.from(e):t(e.buffer)?1===e.BYTES_PER_ELEMENT?i.from(e):i.from(e.buffer):void 0;throw new Error("forgot to pass buffer")}function t(e){return e instanceof p.ArrayBuffer||"[object ArrayBuffer]"===Object.prototype.toString.call(e)}function A(t,e){return"string"==typeof t&&c.has(t)?o.resolve(c.get(t)):A.getShapefile(t,e).then(function(e){return"string"==typeof t&&c.set(t,e),e})}A.combine=function([e,t]){var i={type:"FeatureCollection",features:[]};let r=0;var n=e.length;for(t=t||[];r<n;)i.features.push({type:"Feature",geometry:e[r],properties:t[r]||{}}),r++;return i},A.parseZip=async function(e,n){let t;e=h(e);const o=await r(e);var i=[];for(t in n=n||[],o)-1===t.indexOf("__MACOSX")&&("shp"===t.slice(-3).toLowerCase()?(i.push(t.slice(0,-4)),o[t.slice(0,-3)+t.slice(-3).toLowerCase()]=o[t]):"prj"===t.slice(-3).toLowerCase()?o[t.slice(0,-3)+t.slice(-3).toLowerCase()]=s(o[t]):"json"===t.slice(-4).toLowerCase()||-1<n.indexOf(t.split(".").pop())?i.push(t.slice(0,-3)+t.slice(-3).toLowerCase()):"dbf"!==t.slice(-3).toLowerCase()&&"cpg"!==t.slice(-3).toLowerCase()||(o[t.slice(0,-3)+t.slice(-3).toLowerCase()]=o[t]));if(i.length)return 1===(e=i.map(function(e){let t,i;var r=e.lastIndexOf(".");return-1<r&&-1<e.slice(r).indexOf("json")?(t=JSON.parse(o[e])).fileName=e.slice(0,r):-1<n.indexOf(e.slice(r+1))?(t=o[e]).fileName=e:(o[e+".dbf"]&&(i=l(o[e+".dbf"],o[e+".cpg"])),(t=A.combine([a(o[e+".shp"],o[e+".prj"]),i])).fileName=e),t})).length?e[0]:e;throw new Error("no layers founds")};A.getShapefile=async function(e,t){var i,r;return"string"!=typeof e?A.parseZip(e):(r=e,i=".zip",new u(r).pathname.slice(-4).toLowerCase()===i?async function(e,t){return e=await n(e),A.parseZip(e,t)}(e,t):(r=await o.all([(async e=>{e=await o.all([n(e,"shp"),n(e,"prj")]);let t=!1;try{e[1]&&(t=s(e[1]))}catch(e){t=!1}return a(e[0],t)})(e),(async e=>{var[e,t]=await o.all([n(e,"dbf"),n(e,"cpg")]);if(e)return l(e,t)})(e)]),A.combine(r)))},A.parseShp=function(e,t){if(e=h(e),"string"==typeof(t=i.isBuffer(t)?t.toString():t))try{t=s(t)}catch(e){t=!1}return a(e,t)},A.parseDbf=function(e,t){return e=h(e),l(e,t)},d.exports=A}.call(this)}.call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./binaryajax":2,"./parseShp":4,"./unzip":5,buffer:8,lie:12,"lru-cache":13,parsedbf:15,proj4:17}]},{},[23])(23)},4294:function(e,t,i){"use strict";function a(e,t){for(var i,r=e;null!==(i=r.next);r=i)if(i.key===t)return r.next=i.next,i.next=e.next,e.next=i}var r=i(7286),n=i(2680),l=i(9500),u=r("%TypeError%"),c=r("%WeakMap%",!0),h=r("%Map%",!0),A=n("WeakMap.prototype.get",!0),p=n("WeakMap.prototype.set",!0),f=n("WeakMap.prototype.has",!0),d=n("Map.prototype.get",!0),g=n("Map.prototype.set",!0),m=n("Map.prototype.has",!0);e.exports=function(){var n,o,s,t={assert:function(e){if(!t.has(e))throw new u("Side channel does not contain "+l(e))},get:function(e){if(c&&e&&("object"==typeof e||"function"==typeof e)){if(n)return A(n,e)}else if(h){if(o)return d(o,e)}else{var t;if(s)return(t=a(t=s,e))&&t.value}},has:function(e){if(c&&e&&("object"==typeof e||"function"==typeof e)){if(n)return f(n,e)}else if(h){if(o)return m(o,e)}else if(s)return!!a(s,e);return!1},set:function(e,t){var i,r;c&&e&&("object"==typeof e||"function"==typeof e)?(n=n||new c,p(n,e,t)):h?(o=o||new h,g(o,e,t)):(t=t,(r=a(i=s=s||{key:{},next:null},e=e))?r.value=t:i.next={key:e,next:i.next,value:t})}};return t}},7830:function(e,t,r){function n(r){var e,t={},n=((e={trace:function(){},yy:{},symbols_:{error:2,expressions:3,point:4,EOF:5,linestring:6,polygon:7,multipoint:8,multilinestring:9,multipolygon:10,coordinate:11,DOUBLE_TOK:12,ptarray:13,COMMA:14,ring_list:15,ring:16,"(":17,")":18,POINT:19,Z:20,ZM:21,M:22,EMPTY:23,point_untagged:24,polygon_list:25,polygon_untagged:26,point_list:27,LINESTRING:28,POLYGON:29,MULTIPOINT:30,MULTILINESTRING:31,MULTIPOLYGON:32,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",12:"DOUBLE_TOK",14:"COMMA",17:"(",18:")",19:"POINT",20:"Z",21:"ZM",22:"M",23:"EMPTY",28:"LINESTRING",29:"POLYGON",30:"MULTIPOINT",31:"MULTILINESTRING",32:"MULTIPOLYGON"},productions_:[0,[3,2],[3,2],[3,2],[3,2],[3,2],[3,2],[11,2],[11,3],[11,4],[13,3],[13,1],[15,3],[15,1],[16,3],[4,4],[4,5],[4,5],[4,5],[4,2],[24,1],[24,3],[25,3],[25,1],[26,3],[27,3],[27,1],[6,4],[6,5],[6,5],[6,5],[6,2],[7,4],[7,5],[7,5],[7,5],[7,2],[8,4],[8,5],[8,5],[8,5],[8,2],[9,4],[9,5],[9,5],[9,5],[9,2],[10,4],[10,5],[10,5],[10,5],[10,2]],performAction:function(e,t,i,r,n,o,s){var a=o.length-1;switch(n){case 1:case 2:case 3:case 4:case 5:case 6:return o[a-1];case 7:this.$=new l([Number(o[a-1]),Number(o[a])]);break;case 8:this.$=new l([Number(o[a-2]),Number(o[a-1]),Number(o[a])]);break;case 9:this.$=new l([Number(o[a-3]),Number(o[a-2]),Number(o[a-1]),Number(o[a])]);break;case 10:this.$=o[a-2].addPoint(o[a]);break;case 11:this.$=o[a];break;case 12:this.$=o[a-2].addRing(o[a]);break;case 13:this.$=new c(o[a]);break;case 14:this.$=new u(o[a-1]);break;case 15:this.$={type:"Point",coordinates:o[a-1].data[0]};break;case 16:this.$={type:"Point",coordinates:o[a-1].data[0],properties:{z:!0}};break;case 17:this.$={type:"Point",coordinates:o[a-1].data[0],properties:{z:!0,m:!0}};break;case 18:this.$={type:"Point",coordinates:o[a-1].data[0],properties:{m:!0}};break;case 19:this.$={type:"Point",coordinates:[]};break;case 20:this.$=o[a];break;case 21:this.$=o[a-1];break;case 22:this.$=o[a-2].addPolygon(o[a]);break;case 23:this.$=new h(o[a]);break;case 24:this.$=o[a-1];break;case 25:this.$=o[a-2].addPoint(o[a]);break;case 26:this.$=o[a];break;case 27:this.$={type:"LineString",coordinates:o[a-1].data};break;case 28:this.$={type:"LineString",coordinates:o[a-1].data,properties:{z:!0}};break;case 29:this.$={type:"LineString",coordinates:o[a-1].data,properties:{m:!0}};break;case 30:this.$={type:"LineString",coordinates:o[a-1].data,properties:{z:!0,m:!0}};break;case 31:this.$={type:"LineString",coordinates:[]};break;case 32:this.$={type:"Polygon",coordinates:o[a-1].toJSON()};break;case 33:this.$={type:"Polygon",coordinates:o[a-1].toJSON(),properties:{z:!0}};break;case 34:this.$={type:"Polygon",coordinates:o[a-1].toJSON(),properties:{m:!0}};break;case 35:this.$={type:"Polygon",coordinates:o[a-1].toJSON(),properties:{z:!0,m:!0}};break;case 36:this.$={type:"Polygon",coordinates:[]};break;case 37:this.$={type:"MultiPoint",coordinates:o[a-1].data};break;case 38:this.$={type:"MultiPoint",coordinates:o[a-1].data,properties:{z:!0}};break;case 39:this.$={type:"MultiPoint",coordinates:o[a-1].data,properties:{m:!0}};break;case 40:this.$={type:"MultiPoint",coordinates:o[a-1].data,properties:{z:!0,m:!0}};break;case 41:this.$={type:"MultiPoint",coordinates:[]};break;case 42:this.$={type:"MultiLineString",coordinates:o[a-1].toJSON()};break;case 43:this.$={type:"MultiLineString",coordinates:o[a-1].toJSON(),properties:{z:!0}};break;case 44:this.$={type:"MultiLineString",coordinates:o[a-1].toJSON(),properties:{m:!0}};break;case 45:this.$={type:"MultiLineString",coordinates:o[a-1].toJSON(),properties:{z:!0,m:!0}};break;case 46:this.$={type:"MultiLineString",coordinates:[]};break;case 47:this.$={type:"MultiPolygon",coordinates:o[a-1].toJSON()};break;case 48:this.$={type:"MultiPolygon",coordinates:o[a-1].toJSON(),properties:{z:!0}};break;case 49:this.$={type:"MultiPolygon",coordinates:o[a-1].toJSON(),properties:{m:!0}};break;case 50:this.$={type:"MultiPolygon",coordinates:o[a-1].toJSON(),properties:{z:!0,m:!0}};break;case 51:this.$={type:"MultiPolygon",coordinates:[]}}},table:[{3:1,4:2,6:3,7:4,8:5,9:6,10:7,19:[1,8],28:[1,9],29:[1,10],30:[1,11],31:[1,12],32:[1,13]},{1:[3]},{5:[1,14]},{5:[1,15]},{5:[1,16]},{5:[1,17]},{5:[1,18]},{5:[1,19]},{17:[1,20],20:[1,21],21:[1,22],22:[1,23],23:[1,24]},{17:[1,25],20:[1,26],21:[1,28],22:[1,27],23:[1,29]},{17:[1,30],20:[1,31],21:[1,33],22:[1,32],23:[1,34]},{17:[1,35],20:[1,36],21:[1,38],22:[1,37],23:[1,39]},{17:[1,40],20:[1,41],21:[1,43],22:[1,42],23:[1,44]},{17:[1,45],20:[1,46],21:[1,48],22:[1,47],23:[1,49]},{1:[2,1]},{1:[2,2]},{1:[2,3]},{1:[2,4]},{1:[2,5]},{1:[2,6]},{11:51,12:[1,52],13:50},{17:[1,53]},{17:[1,54]},{17:[1,55]},{5:[2,19]},{11:58,12:[1,52],17:[1,59],24:57,27:56},{17:[1,60]},{17:[1,61]},{17:[1,62]},{5:[2,31]},{15:63,16:64,17:[1,65]},{17:[1,66]},{17:[1,67]},{17:[1,68]},{5:[2,36]},{11:58,12:[1,52],17:[1,59],24:57,27:69},{17:[1,70]},{17:[1,71]},{17:[1,72]},{5:[2,41]},{15:73,16:64,17:[1,65]},{17:[1,74]},{17:[1,75]},{17:[1,76]},{5:[2,46]},{17:[1,79],25:77,26:78},{17:[1,80]},{17:[1,81]},{17:[1,82]},{5:[2,51]},{14:[1,84],18:[1,83]},{14:[2,11],18:[2,11]},{12:[1,85]},{11:51,12:[1,52],13:86},{11:51,12:[1,52],13:87},{11:51,12:[1,52],13:88},{14:[1,90],18:[1,89]},{14:[2,26],18:[2,26]},{14:[2,20],18:[2,20]},{11:91,12:[1,52]},{11:58,12:[1,52],17:[1,59],24:57,27:92},{11:58,12:[1,52],17:[1,59],24:57,27:93},{11:58,12:[1,52],17:[1,59],24:57,27:94},{14:[1,96],18:[1,95]},{14:[2,13],18:[2,13]},{11:51,12:[1,52],13:97},{15:98,16:64,17:[1,65]},{15:99,16:64,17:[1,65]},{15:100,16:64,17:[1,65]},{14:[1,90],18:[1,101]},{11:58,12:[1,52],17:[1,59],24:57,27:102},{11:58,12:[1,52],17:[1,59],24:57,27:103},{11:58,12:[1,52],17:[1,59],24:57,27:104},{14:[1,96],18:[1,105]},{15:106,16:64,17:[1,65]},{15:107,16:64,17:[1,65]},{15:108,16:64,17:[1,65]},{14:[1,110],18:[1,109]},{14:[2,23],18:[2,23]},{15:111,16:64,17:[1,65]},{17:[1,79],25:112,26:78},{17:[1,79],25:113,26:78},{17:[1,79],25:114,26:78},{5:[2,15]},{11:115,12:[1,52]},{12:[1,116],14:[2,7],18:[2,7]},{14:[1,84],18:[1,117]},{14:[1,84],18:[1,118]},{14:[1,84],18:[1,119]},{5:[2,27]},{11:58,12:[1,52],17:[1,59],24:120},{18:[1,121]},{14:[1,90],18:[1,122]},{14:[1,90],18:[1,123]},{14:[1,90],18:[1,124]},{5:[2,32]},{16:125,17:[1,65]},{14:[1,84],18:[1,126]},{14:[1,96],18:[1,127]},{14:[1,96],18:[1,128]},{14:[1,96],18:[1,129]},{5:[2,37]},{14:[1,90],18:[1,130]},{14:[1,90],18:[1,131]},{14:[1,90],18:[1,132]},{5:[2,42]},{14:[1,96],18:[1,133]},{14:[1,96],18:[1,134]},{14:[1,96],18:[1,135]},{5:[2,47]},{17:[1,79],26:136},{14:[1,96],18:[1,137]},{14:[1,110],18:[1,138]},{14:[1,110],18:[1,139]},{14:[1,110],18:[1,140]},{14:[2,10],18:[2,10]},{12:[1,141],14:[2,8],18:[2,8]},{5:[2,16]},{5:[2,17]},{5:[2,18]},{14:[2,25],18:[2,25]},{14:[2,21],18:[2,21]},{5:[2,28]},{5:[2,29]},{5:[2,30]},{14:[2,12],18:[2,12]},{14:[2,14],18:[2,14]},{5:[2,33]},{5:[2,34]},{5:[2,35]},{5:[2,38]},{5:[2,39]},{5:[2,40]},{5:[2,43]},{5:[2,44]},{5:[2,45]},{14:[2,22],18:[2,22]},{14:[2,24],18:[2,24]},{5:[2,48]},{5:[2,49]},{5:[2,50]},{14:[2,9],18:[2,9]}],defaultActions:{14:[2,1],15:[2,2],16:[2,3],17:[2,4],18:[2,5],19:[2,6],24:[2,19],29:[2,31],34:[2,36],39:[2,41],44:[2,46],49:[2,51],83:[2,15],89:[2,27],95:[2,32],101:[2,37],105:[2,42],109:[2,47],117:[2,16],118:[2,17],119:[2,18],122:[2,28],123:[2,29],124:[2,30],127:[2,33],128:[2,34],129:[2,35],130:[2,38],131:[2,39],132:[2,40],133:[2,43],134:[2,44],135:[2,45],138:[2,48],139:[2,49],140:[2,50]},parseError:function(e,t){throw new Error(e)},parse:function(e){var t=this,i=[0],r=[null],n=[],o=this.table,s="",a=0,l=0,u=0,c=(this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,void 0===(this.yy.parser=this).lexer.yylloc&&(this.lexer.yylloc={}),this.lexer.yylloc),h=(n.push(c),this.lexer.options&&this.lexer.options.ranges);"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var A,p,f,d,g,m,y,_,v={};;){if(f=i[i.length-1],void 0===(d=this.defaultActions[f]||(null==A&&(C=void 0,A=C="number"!=typeof(C=t.lexer.lex()||1)&&t.symbols_[C]||C),o[f]&&o[f][A]))||!d.length||!d[0]){var C="";if(!u){for(g in _=[],o[f])this.terminals_[g]&&2<g&&_.push("'"+this.terminals_[g]+"'");C=this.lexer.showPosition?"Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+_.join(", ")+", got '"+(this.terminals_[A]||A)+"'":"Parse error on line "+(a+1)+": Unexpected "+(1==A?"end of input":"'"+(this.terminals_[A]||A)+"'"),this.parseError(C,{text:this.lexer.match,token:this.terminals_[A]||A,line:this.lexer.yylineno,loc:c,expected:_})}}if(d[0]instanceof Array&&1<d.length)throw new Error("Parse Error: multiple actions possible at state: "+f+", token: "+A);switch(d[0]){case 1:i.push(A),r.push(this.lexer.yytext),n.push(this.lexer.yylloc),i.push(d[1]),A=null,p?(A=p,p=null):(l=this.lexer.yyleng,s=this.lexer.yytext,a=this.lexer.yylineno,c=this.lexer.yylloc,0<u&&u--);break;case 2:if(m=this.productions_[d[1]][1],v.$=r[r.length-m],v._$={first_line:n[n.length-(m||1)].first_line,last_line:n[n.length-1].last_line,first_column:n[n.length-(m||1)].first_column,last_column:n[n.length-1].last_column},h&&(v._$.range=[n[n.length-(m||1)].range[0],n[n.length-1].range[1]]),void 0!==(y=this.performAction.call(v,s,l,a,this.yy,d[1],r,n)))return y;m&&(i=i.slice(0,-1*m*2),r=r.slice(0,-1*m),n=n.slice(0,-1*m)),i.push(this.productions_[d[1]][0]),r.push(v.$),n.push(v._$),y=o[i[i.length-2]][i[i.length-1]],i.push(y);break;case 3:return!0}}return!0}}).lexer={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,i=e.split(/(?:\r\n?|\n)/g),e=(this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t,this.match.split(/(?:\r\n?|\n)/g)),r=(this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1),this.yylloc.range);return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===e.length?this.yylloc.first_column:0)+e[e.length-i.length].length-i[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(20<e.length?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(20<e.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var e,t,i,r,n=this._currentRules(),o=0;o<n.length&&(!(t=this._input.match(this.rules[n[o]]))||e&&!(t[0].length>e[0].length)||(e=t,i=o,this.options.flex));o++);return e?((r=e[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],r=this.performAction.call(this,this.yy,this,n[i],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),r||void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return void 0!==e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)},options:{},performAction:function(e,t,i,r){switch(i){case 0:break;case 1:return 17;case 2:return 18;case 3:return 12;case 4:return 19;case 5:return 28;case 6:return 29;case 7:return 30;case 8:return 31;case 9:return 32;case 10:return 14;case 11:return 23;case 12:return 22;case 13:return 20;case 14:return 21;case 15:return 5;case 16:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:\()/,/^(?:\))/,/^(?:-?[0-9]+(\.[0-9]+)?([eE][\-\+]?[0-9]+)?)/,/^(?:POINT\b)/,/^(?:LINESTRING\b)/,/^(?:POLYGON\b)/,/^(?:MULTIPOINT\b)/,/^(?:MULTILINESTRING\b)/,/^(?:MULTIPOLYGON\b)/,/^(?:,)/,/^(?:EMPTY\b)/,/^(?:M\b)/,/^(?:Z\b)/,/^(?:ZM\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],inclusive:!0}}},new((o.prototype=e).Parser=o));function o(){this.yy={}}function l(e){this.data=[e],this.type="PointArray"}function u(e){this.data=e,this.type="Ring"}function c(e){this.data=[e],this.type="RingList"}function h(e){this.data=[e],this.type="PolygonList"}function C(e){for(var t=[],i="",r=0;r<e.length;r++)t.push(e[r].join(" "));return i+="("+t.join(", ")+")"}return l.prototype.addPoint=function(e){return"PointArray"===e.type?this.data=this.data.concat(e.data):this.data.push(e),this},l.prototype.toJSON=function(){return this.data},u.prototype.toJSON=function(){for(var e=[],t=0;t<this.data.data.length;t++)e.push(this.data.data[t]);return e},c.prototype.addRing=function(e){return this.data.push(e),this},c.prototype.toJSON=function(){for(var e=[],t=0;t<this.data.length;t++)e.push(this.data[t].toJSON());return e},h.prototype.addPolygon=function(e){return this.data.push(e),this},h.prototype.toJSON=function(){for(var e=[],t=0;t<this.data.length;t++)e=e.concat([this.data[t].toJSON()]);return e},t.parser=n,t.Parser=n.Parser,t.parse=function(e){var t;try{t=n.parse(e)}catch(e){throw Error("Unable to parse: "+e)}return r.Primitive(t)},t.convert=function e(t){switch(t.type){case"Point":return v="POINT ",void 0===(_=t).coordinates||0===_.coordinates.length?v+"EMPTY":(3===_.coordinates.length?_.properties&&!0===_.properties.m?v+="M ":v+="Z ":4===_.coordinates.length&&(v+="ZM "),v+("("+_.coordinates.join(" "))+")");case"LineString":return v="LINESTRING ",void 0===(_=t).coordinates||0===_.coordinates.length||0===_.coordinates[0].length?v+"EMPTY":(3===_.coordinates[0].length?_.properties&&!0===_.properties.m?v+="M ":v+="Z ":4===_.coordinates[0].length&&(v+="ZM "),v+C(_.coordinates));case"Polygon":var r=t,n="POLYGON ";if(void 0===r.coordinates||0===r.coordinates.length||0===r.coordinates[0].length)return n+="EMPTY";3===r.coordinates[0][0].length?r.properties&&!0===r.properties.m?n+="M ":n+="Z ":4===r.coordinates[0][0].length&&(n+="ZM "),n+="(";for(var o=[],s=0;s<r.coordinates.length;s++)o.push(C(r.coordinates[s]));return n=n+o.join(", ")+")";case"MultiPoint":return n="MULTIPOINT ",void 0===(l=t).coordinates||0===l.coordinates.length||0===l.coordinates[0].length?n+"EMPTY":(3===l.coordinates[0].length?l.properties&&!0===l.properties.m?n+="M ":n+="Z ":4===l.coordinates[0].length&&(n+="ZM "),n+C(l.coordinates));case"MultiLineString":var a=t,l="MULTILINESTRING ";if(void 0===a.coordinates||0===a.coordinates.length||0===a.coordinates[0].length)return l+="EMPTY";3===a.coordinates[0][0].length?a.properties&&!0===a.properties.m?l+="M ":l+="Z ":4===a.coordinates[0][0].length&&(l+="ZM "),l+="(";for(var u=[],c=0;c<a.coordinates.length;c++)u.push(C(a.coordinates[c]));return l=l+u.join(", ")+")";case"MultiPolygon":var h=t,A="MULTIPOLYGON ";if(void 0===h.coordinates||0===h.coordinates.length||0===h.coordinates[0].length||0===h.coordinates[0][0].length)return A+="EMPTY";3===h.coordinates[0][0][0].length?h.properties&&!0===h.properties.m?A+="M ":A+="Z ":4===h.coordinates[0][0][0].length&&(A+="ZM "),A+="(";for(var p=[],f=0;f<h.coordinates.length;f++){for(var d="(",g=[],m=0;m<h.coordinates[f].length;m++)g.push(C(h.coordinates[f][m]));d+=g.join(", "),p.push(d+=")")}return A=A+p.join(", ")+")";case"GeometryCollection":var y=[];for(i=0;i<t.geometries.length;i++)y.push(e(t.geometries[i]));return"GEOMETRYCOLLECTION("+y.join(", ")+")";default:throw Error("Unknown Type: "+t.type)}var _,v},t}var o=this;if("object"==typeof e.exports)e.exports=n(r(1758));else if("object"==typeof navigator){if(!o.Terraformer)throw new Error("Terraformer.WKT requires the core Terraformer library. http://github.com/esri/terraformer");o.Terraformer.WKT=n(o.Terraformer)}},1758:function(e,t){var i,r;i=this,r=function(){"use strict";var e={},i=6378137,r=57.29577951308232,n=.017453292519943,o={type:"link",properties:{href:"http://spatialreference.org/ref/sr-org/6928/ogcwkt/",type:"ogcwkt"}};function s(e){return"[object Array]"===Object.prototype.toString.call(e)}function a(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}function C(e){if(e.type)switch(e.type){case"Point":return[e.coordinates[0],e.coordinates[1],e.coordinates[0],e.coordinates[1]];case"MultiPoint":case"LineString":return w(e.coordinates);case"MultiLineString":case"Polygon":return O(e.coordinates);case"MultiPolygon":for(var t=e.coordinates,i=null,r=null,n=null,o=null,s=0;s<t.length;s++)for(var a=t[s],l=0;l<a.length;l++)for(var u=a[l],c=0;c<u.length;c++){var h=u[c],A=h[0],h=h[1];(null===i||A<i)&&(i=A),(null===r||r<A)&&(r=A),(null===n||h<n)&&(n=h),(null===o||o<h)&&(o=h)}return[i,n,r,o];case"Feature":return e.geometry?C(e.geometry):null;case"FeatureCollection":for(var p,f=e,d=[],g=f.features.length-1;0<=g;g--)p=C(f.features[g].geometry),d.push([p[0],p[1]]),d.push([p[2],p[3]]);return w(d);case"GeometryCollection":for(var m,y=e,_=[],v=y.geometries.length-1;0<=v;v--)m=C(y.geometries[v]),_.push([m[0],m[1]]),_.push([m[2],m[3]]);return w(_);default:throw new Error("Unknown type: "+e.type)}return null}function O(e){for(var t=null,i=null,r=null,n=null,o=0;o<e.length;o++)for(var s=e[o],a=0;a<s.length;a++){var l=s[a],u=l[0],l=l[1];(null===t||u<t)&&(t=u),(null===i||i<u)&&(i=u),(null===r||l<r)&&(r=l),(null===n||n<l)&&(n=l)}return[t,r,i,n]}function w(e){for(var t=null,i=null,r=null,n=null,o=0;o<e.length;o++){var s=e[o],a=s[0],s=s[1];(null===t||a<t)&&(t=a),(null===i||i<a)&&(i=a),(null===r||s<r)&&(r=s),(null===n||n<s)&&(n=s)}return[t,r,i,n]}function t(e){e=C(e);return{x:e[0],y:e[1],w:Math.abs(e[0]-e[2]),h:Math.abs(e[1]-e[3])}}function R(e){return e*r}function l(e){var t=e[0],e=e[1];return[t/i*r-360*Math.floor((t/i*r+180)/360),R(Math.PI/2-2*Math.atan(Math.exp(-1*e/i)))]}function u(e){var t=e[0],e=Math.max(Math.min(e[1],89.99999),-89.99999);return[t*n*i,i/2*Math.log((1+Math.sin(e*n))/(1-Math.sin(e*n)))]}function c(e,t,i){if("Point"===e.type)e.coordinates=t(e.coordinates);else if("Feature"===e.type)e.geometry=c(e.geometry,t,!0);else if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)e.features[r]=c(e.features[r],t,!0);else if("GeometryCollection"===e.type)for(var n=0;n<e.geometries.length;n++)e.geometries[n]=c(e.geometries[n],t,!0);else e.coordinates=function e(t,i){for(var r=0;r<t.length;r++)"number"==typeof t[r][0]&&(t[r]=i(t[r])),"object"==typeof t[r]&&(t[r]=e(t[r],i));return t}(e.coordinates,t);return i||t===u&&(e.crs=o),t===l&&delete e.crs,e}function h(e){return c(e,u)}function A(e){return c(e,l)}function p(e,t){return e[0]>t[0]?-1:e[0]<t[0]?1:e[1]>t[1]?-1:e[1]<t[1]?1:0}function f(e,t){var i=t[0]-e[0],t=t[1]-e[1];return i*i+t*t}function d(e){if(0===e.length)return[];if(1===e.length)return e;for(var t=[e.sort(p)[0]],i=0;i<t.length;i++){var r=function(e,t){var i,r,n,o=t;for(i in e){s=t,r=o,n=e[i];var s=(n=(r[0]-s[0])*(n[1]-s[1])-(n[0]-s[0])*(r[1]-s[1]))<(r=0)?-1:r<n?1:0;(-1==s||0==s&&f(t,e[i])>f(t,o))&&(o=e[i])}return o}(e,t[i]);r!==t[0]&&t.push(r)}return t}function g(e,t){for(var i=!1,r=-1,n=e.length,o=n-1;++r<n;o=r)(e[r][1]<=t[1]&&t[1]<e[o][1]||e[o][1]<=t[1]&&t[1]<e[r][1])&&t[0]<(e[o][0]-e[r][0])*(t[1]-e[r][1])/(e[o][1]-e[r][1])+e[r][0]&&(i=!i);return i}function m(e,t){if(e&&e.length){if(1===e.length)return g(e[0],t);if(g(e[0],t)){for(var i=1;i<e.length;i++)if(g(e[i],t))return!1;return!0}}return!1}function U(e){return!isNaN(parseFloat(e))&&isFinite(e)}function y(e,t){if(U(e[0][0])){if(U(t[0][0])){for(var i=0;i<e.length-1;i++)for(var r=0;r<t.length-1;r++)if(function(e,t,i,r){var n=(r[0]-i[0])*(e[1]-i[1])-(r[1]-i[1])*(e[0]-i[0]),o=(t[0]-e[0])*(e[1]-i[1])-(t[1]-e[1])*(e[0]-i[0]);if(0!=(r=(r[1]-i[1])*(t[0]-e[0])-(r[0]-i[0])*(t[1]-e[1]))){i=n/r,t=o/r;if(0<=i&&i<=1&&0<=t&&t<=1)return 1}}(e[i],e[i+1],t[r],t[r+1]))return!0}else for(var n=0;n<t.length;n++)if(y(e,t[n]))return!0}else for(var o=0;o<e.length;o++)if(y(e[o],t))return!0;return!1}function _(e){for(var t=[],i=0;i<e.length;i++){var r=e[i].slice();!1===v(r[0],r[r.length-1])&&r.push(r[0]),t.push(r)}return t}function v(e,t){for(var i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function x(e,t){if(e.length!==t.length)return!1;for(var i=e.slice().sort(p),r=t.slice().sort(p),n=0;n<i.length;n++){if(i[n].length!==r[n].length)return!1;for(var o=0;o<i.length;o++)if(i[n][o]!==r[n][o])return!1}return!0}var k=["length"];function b(e){if(e)switch(e.type){case"Point":return new E(e);case"MultiPoint":return new B(e);case"LineString":return new M(e);case"MultiLineString":return new I(e);case"Polygon":return new S(e);case"MultiPolygon":return new P(e);case"Feature":return new T(e);case"FeatureCollection":return new L(e);case"GeometryCollection":return new D(e);default:throw new Error("Unknown type: "+e.type)}}function E(e){var t=Array.prototype.slice.call(arguments);if(e&&"Point"===e.type&&e.coordinates)a(this,e);else if(e&&s(e))this.coordinates=e;else{if(!(2<=t.length))throw"Terraformer: invalid input for Terraformer.Point";this.coordinates=t}this.type="Point"}function B(e){if(e&&"MultiPoint"===e.type&&e.coordinates)a(this,e);else{if(!s(e))throw"Terraformer: invalid input for Terraformer.MultiPoint";this.coordinates=e}this.type="MultiPoint"}function M(e){if(e&&"LineString"===e.type&&e.coordinates)a(this,e);else{if(!s(e))throw"Terraformer: invalid input for Terraformer.LineString";this.coordinates=e}this.type="LineString"}function I(e){if(e&&"MultiLineString"===e.type&&e.coordinates)a(this,e);else{if(!s(e))throw"Terraformer: invalid input for Terraformer.MultiLineString";this.coordinates=e}this.type="MultiLineString"}function S(e){if(e&&"Polygon"===e.type&&e.coordinates)a(this,e);else{if(!s(e))throw"Terraformer: invalid input for Terraformer.Polygon";this.coordinates=e}this.type="Polygon"}function P(e){if(e&&"MultiPolygon"===e.type&&e.coordinates)a(this,e);else{if(!s(e))throw"Terraformer: invalid input for Terraformer.MultiPolygon";this.coordinates=e}this.type="MultiPolygon"}function T(e){if(e&&"Feature"===e.type)a(this,e);else{if(!(e&&e.type&&e.coordinates))throw"Terraformer: invalid input for Terraformer.Feature";this.geometry=e}this.type="Feature"}function L(e){if(e&&"FeatureCollection"===e.type&&e.features)a(this,e);else{if(!s(e))throw"Terraformer: invalid input for Terraformer.FeatureCollection";this.features=e}this.type="FeatureCollection"}function D(e){if(e&&"GeometryCollection"===e.type&&e.geometries)a(this,e);else if(s(e))this.geometries=e;else{if(!e.coordinates||!e.type)throw"Terraformer: invalid input for Terraformer.GeometryCollection";this.type="GeometryCollection",this.geometries=[e]}this.type="GeometryCollection"}function F(e,t,i){for(var r=u(e),n=i||64,o={type:"Polygon",coordinates:[[]]},s=1;s<=n;s++){var a=s*(360/n)*Math.PI/180;o.coordinates[0].push([r[0]+t*Math.cos(a),r[1]+t*Math.sin(a)])}return o.coordinates=_(o.coordinates),A(o)}function N(e,t,i){i=i||64,t=t||250;if(!e||e.length<2||!t||!i)throw new Error("Terraformer: missing parameter for Terraformer.Circle");a(this,new T({type:"Feature",geometry:F(e,t,i),properties:{radius:t,center:e,steps:i}}))}return b.prototype.toMercator=function(){return h(this)},b.prototype.toGeographic=function(){return A(this)},b.prototype.envelope=function(){return t(this)},b.prototype.bbox=function(){return C(this)},b.prototype.convexHull=function(){var e,t,i=[];if("Point"===this.type)return null;if("LineString"===this.type||"MultiPoint"===this.type){if(!(this.coordinates&&3<=this.coordinates.length))return null;i=this.coordinates}else if("Polygon"===this.type||"MultiLineString"===this.type){if(!(this.coordinates&&0<this.coordinates.length))return null;for(e=0;e<this.coordinates.length;e++)i=i.concat(this.coordinates[e]);if(i.length<3)return null}else if("MultiPolygon"===this.type){if(!(this.coordinates&&0<this.coordinates.length))return null;for(e=0;e<this.coordinates.length;e++)for(t=0;t<this.coordinates[e].length;t++)i=i.concat(this.coordinates[e][t]);if(i.length<3)return null}else if("Feature"===this.type)return new b(this.geometry).convexHull();return new S({type:"Polygon",coordinates:_([d(i)])})},b.prototype.toJSON=function(){var e,t={};for(e in this)this.hasOwnProperty(e)&&-1===k.indexOf(e)&&(t[e]=this[e]);return t.bbox=C(this),t},b.prototype.contains=function(e){return new b(e).within(this)},b.prototype.within=function(e){var t,i,r;if("Point"===(e="Feature"===e.type?e.geometry:e).type&&"Point"===this.type)return v(this.coordinates,e.coordinates);if("MultiLineString"===e.type&&"Point"===this.type)for(t=0;t<e.coordinates.length;t++){var n={type:"LineString",coordinates:e.coordinates[t]};if(this.within(n))return!0}if(("LineString"===e.type||"MultiPoint"===e.type)&&"Point"===this.type)for(t=0;t<e.coordinates.length;t++){if(this.coordinates.length!==e.coordinates[t].length)return!1;if(v(this.coordinates,e.coordinates[t]))return!0}if("Polygon"===e.type){if("Polygon"===this.type){if(e.coordinates.length===this.coordinates.length)for(t=0;t<this.coordinates.length;t++)if(x(this.coordinates[t],e.coordinates[t]))return!0;return!(!this.coordinates.length||!m(e.coordinates,this.coordinates[0][0])||y(_(this.coordinates),_(e.coordinates)))}if("Point"===this.type)return m(e.coordinates,this.coordinates);if("LineString"===this.type||"MultiPoint"===this.type){if(!this.coordinates||0===this.coordinates.length)return!1;for(t=0;t<this.coordinates.length;t++)if(!1===m(e.coordinates,this.coordinates[t]))return!1;return!0}if("MultiLineString"===this.type){for(t=0;t<this.coordinates.length;t++)if(!1===new M(this.coordinates[t]).within(e))return r++,!1;return!0}if("MultiPolygon"===this.type){for(t=0;t<this.coordinates.length;t++)if(!1===new b({type:"Polygon",coordinates:this.coordinates[t]}).within(e))return!1;return!0}}if("MultiPolygon"===e.type){if("Point"===this.type){if(e.coordinates.length)for(t=0;t<e.coordinates.length;t++)if(m(e.coordinates[t],this.coordinates)&&!1===y([this.coordinates],e.coordinates))return!0;return!1}if("Polygon"===this.type){for(t=0;t<this.coordinates.length;t++)if(e.coordinates[t].length===this.coordinates.length)for(i=0;i<this.coordinates.length;i++)if(x(this.coordinates[i],e.coordinates[t][i]))return!0;if(!1===y(this.coordinates,e.coordinates)&&e.coordinates.length){for(t=0;t<e.coordinates.length;t++)r=!1!==m(e.coordinates[t],this.coordinates[0][0]);return r}}else if("LineString"===this.type||"MultiPoint"===this.type)for(t=0;t<e.coordinates.length;t++){var o={type:"Polygon",coordinates:e.coordinates[t]};return this.within(o)?!0:!1}else{if("MultiLineString"===this.type){for(t=0;t<this.coordinates.length;t++)if(!1===new M(this.coordinates[t]).within(e))return!1;return!0}if("MultiPolygon"===this.type){for(t=0;t<e.coordinates.length;t++){var s={type:"Polygon",coordinates:e.coordinates[t]};if(!1===this.within(s))return!1}return!0}}}return!1},b.prototype.intersects=function(e){var t=new b(e="Feature"===e.type?e.geometry:e);return!(!this.within(e)&&!t.within(this))||("Point"!==this.type&&"MultiPoint"!==this.type&&"Point"!==e.type&&"MultiPoint"!==e.type?y(this.coordinates,e.coordinates):"Feature"===this.type?new b(this.geometry).intersects(e):(function(){var e=Array.prototype.slice.apply(arguments);console.warn&&console.warn.apply(console,e)}("Type "+this.type+" to "+e.type+" intersection is not supported by intersects"),!1))},(E.prototype=new b).constructor=E,((B.prototype=new b).constructor=B).prototype.forEach=function(e){for(var t=0;t<this.coordinates.length;t++)e.apply(this,[this.coordinates[t],t,this.coordinates]);return this},B.prototype.addPoint=function(e){return this.coordinates.push(e),this},B.prototype.insertPoint=function(e,t){return this.coordinates.splice(t,0,e),this},B.prototype.removePoint=function(e){return"number"==typeof e?this.coordinates.splice(e,1):this.coordinates.splice(this.coordinates.indexOf(e),1),this},B.prototype.get=function(e){return new E(this.coordinates[e])},((M.prototype=new b).constructor=M).prototype.addVertex=function(e){return this.coordinates.push(e),this},M.prototype.insertVertex=function(e,t){return this.coordinates.splice(t,0,e),this},M.prototype.removeVertex=function(e){return this.coordinates.splice(e,1),this},((I.prototype=new b).constructor=I).prototype.forEach=function(e){for(var t=0;t<this.coordinates.length;t++)e.apply(this,[this.coordinates[t],t,this.coordinates])},I.prototype.get=function(e){return new M(this.coordinates[e])},((S.prototype=new b).constructor=S).prototype.addVertex=function(e){return this.insertVertex(e,this.coordinates[0].length-1),this},S.prototype.insertVertex=function(e,t){return this.coordinates[0].splice(t,0,e),this},S.prototype.removeVertex=function(e){return this.coordinates[0].splice(e,1),this},S.prototype.close=function(){this.coordinates=_(this.coordinates)},S.prototype.hasHoles=function(){return 1<this.coordinates.length},S.prototype.holes=function(){var e=[];if(this.hasHoles())for(var t=1;t<this.coordinates.length;t++)e.push(new S([this.coordinates[t]]));return e},((P.prototype=new b).constructor=P).prototype.forEach=function(e){for(var t=0;t<this.coordinates.length;t++)e.apply(this,[this.coordinates[t],t,this.coordinates])},P.prototype.get=function(e){return new S(this.coordinates[e])},P.prototype.close=function(){var t=[];return this.forEach(function(e){t.push(_(e))}),this.coordinates=t,this},(T.prototype=new b).constructor=T,((L.prototype=new b).constructor=L).prototype.forEach=function(e){for(var t=0;t<this.features.length;t++)e.apply(this,[this.features[t],t,this.features])},L.prototype.get=function(t){var i;return this.forEach(function(e){e.id===t&&(i=e)}),new T(i)},((D.prototype=new b).constructor=D).prototype.forEach=function(e){for(var t=0;t<this.geometries.length;t++)e.apply(this,[this.geometries[t],t,this.geometries])},D.prototype.get=function(e){return new b(this.geometries[e])},((N.prototype=new b).constructor=N).prototype.recalculate=function(){return this.geometry=F(this.properties.center,this.properties.radius,this.properties.steps),this},N.prototype.center=function(e){return e&&(this.properties.center=e,this.recalculate()),this.properties.center},N.prototype.radius=function(e){return e&&(this.properties.radius=e,this.recalculate()),this.properties.radius},N.prototype.steps=function(e){return e&&(this.properties.steps=e,this.recalculate()),this.properties.steps},N.prototype.toJSON=function(){return b.prototype.toJSON.call(this)},e.Primitive=b,e.Point=E,e.MultiPoint=B,e.LineString=M,e.MultiLineString=I,e.Polygon=S,e.MultiPolygon=P,e.Feature=T,e.FeatureCollection=L,e.GeometryCollection=D,e.Circle=N,e.toMercator=h,e.toGeographic=A,e.Tools={},e.Tools.positionToMercator=u,e.Tools.positionToGeographic=l,e.Tools.applyConverter=c,e.Tools.toMercator=h,e.Tools.toGeographic=A,e.Tools.createCircle=F,e.Tools.calculateBounds=C,e.Tools.calculateEnvelope=t,e.Tools.coordinatesContainPoint=g,e.Tools.polygonContainsPoint=m,e.Tools.arraysIntersectArrays=y,e.Tools.coordinatesContainPoint=g,e.Tools.coordinatesEqual=x,e.Tools.convexHull=d,e.Tools.isConvex=function(e){for(var t,i=0;i<e.length-3;i++){var r=e[i],n=e[i+1],o=e[i+2],n=[n[0]-r[0],n[1]-r[1]],o=o[0]*n[1]-o[1]*n[0]+n[0]*r[1]-n[1]*r[0];if(0===i)t=o<0;else if(t&&0<o||!t&&o<0)return!1}return!0},e.MercatorCRS=o,e.GeographicCRS={type:"link",properties:{href:"http://spatialreference.org/ref/epsg/4326/ogcwkt/",type:"ogcwkt"}},e},"object"==typeof e.exports&&(e.exports=r()),"object"==typeof window&&(i.Terraformer=r())},8621:function(e,t,i){var l,u,c,r,o,h,A,n,p,s,a,f,d,g;function m(e,t){var i;return t=t||{},(e=e||"")instanceof m?e:this instanceof m?(i=function(e){var t={r:0,g:0,b:0},i=1,r=null,n=null,o=null,s=!1,a=!1;"string"==typeof e&&(e=function(e){e=e.replace(u,"").replace(c,"").toLowerCase();var t,i=!1;if(p[e])e=p[e],i=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};if(t=g.rgb.exec(e))return{r:t[1],g:t[2],b:t[3]};if(t=g.rgba.exec(e))return{r:t[1],g:t[2],b:t[3],a:t[4]};if(t=g.hsl.exec(e))return{h:t[1],s:t[2],l:t[3]};if(t=g.hsla.exec(e))return{h:t[1],s:t[2],l:t[3],a:t[4]};if(t=g.hsv.exec(e))return{h:t[1],s:t[2],v:t[3]};if(t=g.hsva.exec(e))return{h:t[1],s:t[2],v:t[3],a:t[4]};if(t=g.hex8.exec(e))return{r:P(t[1]),g:P(t[2]),b:P(t[3]),a:F(t[4]),format:i?"name":"hex8"};if(t=g.hex6.exec(e))return{r:P(t[1]),g:P(t[2]),b:P(t[3]),format:i?"name":"hex"};if(t=g.hex4.exec(e))return{r:P(t[1]+""+t[1]),g:P(t[2]+""+t[2]),b:P(t[3]+""+t[3]),a:F(t[4]+""+t[4]),format:i?"name":"hex8"};if(t=g.hex3.exec(e))return{r:P(t[1]+""+t[1]),g:P(t[2]+""+t[2]),b:P(t[3]+""+t[3]),format:i?"name":"hex"};return!1}(e));"object"==typeof e&&(N(e.r)&&N(e.g)&&N(e.b)?(t=function(e,t,i){return{r:255*I(e,255),g:255*I(t,255),b:255*I(i,255)}}(e.r,e.g,e.b),s=!0,a="%"===String(e.r).substr(-1)?"prgb":"rgb"):N(e.h)&&N(e.s)&&N(e.v)?(r=L(e.s),n=L(e.v),t=function(e,t,i){e=6*I(e,360),t=I(t,100),i=I(i,100);var r=l.floor(e),e=e-r,n=i*(1-t),o=i*(1-e*t),e=i*(1-(1-e)*t),t=r%6;return{r:255*[i,o,n,n,e,i][t],g:255*[e,i,i,o,n,n][t],b:255*[n,n,e,i,i,o][t]}}(e.h,r,n),s=!0,a="hsv"):N(e.h)&&N(e.s)&&N(e.l)&&(r=L(e.s),o=L(e.l),t=function(e,t,i){var r,n,o;function s(e,t,i){return i<0&&(i+=1),1<i&&--i,i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}e=I(e,360),t=I(t,100),i=I(i,100),0===t?r=n=o=i:(r=s(t=2*i-(i=i<.5?i*(1+t):i+t-i*t),i,e+1/3),n=s(t,i,e),o=s(t,i,e-1/3));return{r:255*r,g:255*n,b:255*o}}(e.h,r,o),s=!0,a="hsl"),e.hasOwnProperty("a"))&&(i=e.a);return i=M(i),{ok:s,format:e.format||a,r:h(255,A(t.r,0)),g:h(255,A(t.g,0)),b:h(255,A(t.b,0)),a:i}}(e),this._originalInput=e,this._r=i.r,this._g=i.g,this._b=i.b,this._a=i.a,this._roundA=o(100*this._a)/100,this._format=t.format||i.format,this._gradientType=t.gradientType,this._r<1&&(this._r=o(this._r)),this._g<1&&(this._g=o(this._g)),this._b<1&&(this._b=o(this._b)),this._ok=i.ok,void(this._tc_id=r++)):new m(e,t)}function y(e,t,i){e=I(e,255),t=I(t,255),i=I(i,255);var r,n=A(e,t,i),o=h(e,t,i),s=(n+o)/2;if(n==o)r=l=0;else{var a=n-o,l=.5<s?a/(2-n-o):a/(n+o);switch(n){case e:r=(t-i)/a+(t<i?6:0);break;case t:r=(i-e)/a+2;break;case i:r=(e-t)/a+4}r/=6}return{h:r,s:l,l:s}}function _(e,t,i){e=I(e,255),t=I(t,255),i=I(i,255);var r,n=A(e,t,i),o=h(e,t,i),s=n,a=n-o,l=0===n?0:a/n;if(n==o)r=0;else{switch(n){case e:r=(t-i)/a+(t<i?6:0);break;case t:r=(i-e)/a+2;break;case i:r=(e-t)/a+4}r/=6}return{h:r,s:l,v:s}}function v(e,t,i,r){e=[T(o(e).toString(16)),T(o(t).toString(16)),T(o(i).toString(16))];return r&&e[0].charAt(0)==e[0].charAt(1)&&e[1].charAt(0)==e[1].charAt(1)&&e[2].charAt(0)==e[2].charAt(1)?e[0].charAt(0)+e[1].charAt(0)+e[2].charAt(0):e.join("")}function C(e,t,i,r){return[T(D(r)),T(o(e).toString(16)),T(o(t).toString(16)),T(o(i).toString(16))].join("")}function w(e,t){t=0===t?0:t||10;e=m(e).toHsl();return e.s-=t/100,e.s=S(e.s),m(e)}function x(e,t){t=0===t?0:t||10;e=m(e).toHsl();return e.s+=t/100,e.s=S(e.s),m(e)}function b(e){return m(e).desaturate(100)}function E(e,t){t=0===t?0:t||10;e=m(e).toHsl();return e.l+=t/100,e.l=S(e.l),m(e)}function B(e,t){t=0===t?0:t||10;e=m(e).toRgb();return e.r=A(0,h(255,e.r-o(-t/100*255))),e.g=A(0,h(255,e.g-o(-t/100*255))),e.b=A(0,h(255,e.b-o(-t/100*255))),m(e)}function O(e,t){t=0===t?0:t||10;e=m(e).toHsl();return e.l-=t/100,e.l=S(e.l),m(e)}function R(e,t){e=m(e).toHsl(),t=(e.h+t)%360;return e.h=t<0?360+t:t,m(e)}function U(e){e=m(e).toHsl();return e.h=(e.h+180)%360,m(e)}function k(e){var t=m(e).toHsl(),i=t.h;return[m(e),m({h:(i+120)%360,s:t.s,l:t.l}),m({h:(i+240)%360,s:t.s,l:t.l})]}function H(e){var t=m(e).toHsl(),i=t.h;return[m(e),m({h:(i+90)%360,s:t.s,l:t.l}),m({h:(i+180)%360,s:t.s,l:t.l}),m({h:(i+270)%360,s:t.s,l:t.l})]}function Q(e){var t=m(e).toHsl(),i=t.h;return[m(e),m({h:(i+72)%360,s:t.s,l:t.l}),m({h:(i+216)%360,s:t.s,l:t.l})]}function V(e,t,i){t=t||6,i=i||30;var r=m(e).toHsl(),n=360/i,o=[m(e)];for(r.h=(r.h-(n*t>>1)+720)%360;--t;)r.h=(r.h+n)%360,o.push(m(r));return o}function G(e,t){t=t||6;for(var e=m(e).toHsv(),i=e.h,r=e.s,n=e.v,o=[],s=1/t;t--;)o.push(m({h:i,s:r,v:n})),n=(n+s)%1;return o}function M(e){return e=parseFloat(e),e=isNaN(e)||e<0||1<e?1:e}function I(e,t){"string"==typeof(i=e)&&-1!=i.indexOf(".")&&1===parseFloat(i)&&(e="100%");var i="string"==typeof(i=e)&&-1!=i.indexOf("%");return e=h(t,A(0,parseFloat(e))),i&&(e=parseInt(e*t,10)/100),l.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function S(e){return h(1,A(0,e))}function P(e){return parseInt(e,16)}function T(e){return 1==e.length?"0"+e:""+e}function L(e){return e=e<=1?100*e+"%":e}function D(e){return l.round(255*parseFloat(e)).toString(16)}function F(e){return P(e)/255}function N(e){return g.CSS_UNIT.exec(e)}l=Math,u=/^\s+/,c=/\s+$/,r=0,o=l.round,h=l.min,A=l.max,n=l.random,m.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},getLuminance:function(){var e=this.toRgb(),t=e.r/255,i=e.g/255,e=e.b/255,t=t<=.03928?t/12.92:l.pow((.055+t)/1.055,2.4),i=i<=.03928?i/12.92:l.pow((.055+i)/1.055,2.4),e=e<=.03928?e/12.92:l.pow((.055+e)/1.055,2.4);return.2126*t+.7152*i+.0722*e},setAlpha:function(e){return this._a=M(e),this._roundA=o(100*this._a)/100,this},toHsv:function(){var e=_(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=_(this._r,this._g,this._b),t=o(360*e.h),i=o(100*e.s),e=o(100*e.v);return 1==this._a?"hsv("+t+", "+i+"%, "+e+"%)":"hsva("+t+", "+i+"%, "+e+"%, "+this._roundA+")"},toHsl:function(){var e=y(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=y(this._r,this._g,this._b),t=o(360*e.h),i=o(100*e.s),e=o(100*e.l);return 1==this._a?"hsl("+t+", "+i+"%, "+e+"%)":"hsla("+t+", "+i+"%, "+e+"%, "+this._roundA+")"},toHex:function(e){return v(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){var t=this._r,i=this._g,r=this._b,n=this._a;return t=[T(o(t).toString(16)),T(o(i).toString(16)),T(o(r).toString(16)),T(D(n))],e&&t[0].charAt(0)==t[0].charAt(1)&&t[1].charAt(0)==t[1].charAt(1)&&t[2].charAt(0)==t[2].charAt(1)&&t[3].charAt(0)==t[3].charAt(1)?t[0].charAt(0)+t[1].charAt(0)+t[2].charAt(0)+t[3].charAt(0):t.join("")},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:o(this._r),g:o(this._g),b:o(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+o(this._r)+", "+o(this._g)+", "+o(this._b)+")":"rgba("+o(this._r)+", "+o(this._g)+", "+o(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:o(100*I(this._r,255))+"%",g:o(100*I(this._g,255))+"%",b:o(100*I(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+o(100*I(this._r,255))+"%, "+o(100*I(this._g,255))+"%, "+o(100*I(this._b,255))+"%)":"rgba("+o(100*I(this._r,255))+"%, "+o(100*I(this._g,255))+"%, "+o(100*I(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&s[v(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t="#"+C(this._r,this._g,this._b,this._a),i=t;return"progid:DXImageTransform.Microsoft.gradient("+(this._gradientType?"GradientType = 1, ":"")+"startColorstr="+t+",endColorstr="+(i=e?"#"+C((t=m(e))._r,t._g,t._b,t._a):i)+")"},toString:function(e){var t=!!e,i=(e=e||this._format,!1),r=this._a<1&&0<=this._a;return t||!r||"hex"!==e&&"hex6"!==e&&"hex3"!==e&&"hex4"!==e&&"hex8"!==e&&"name"!==e?("rgb"===e&&(i=this.toRgbString()),"prgb"===e&&(i=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(i=this.toHexString()),"hex3"===e&&(i=this.toHexString(!0)),"hex4"===e&&(i=this.toHex8String(!0)),"hex8"===e&&(i=this.toHex8String()),"name"===e&&(i=this.toName()),"hsl"===e&&(i=this.toHslString()),(i="hsv"===e?this.toHsvString():i)||this.toHexString()):"name"===e&&0===this._a?this.toName():this.toRgbString()},clone:function(){return m(this.toString())},_applyModification:function(e,t){e=e.apply(null,[this].concat([].slice.call(t)));return this._r=e._r,this._g=e._g,this._b=e._b,this.setAlpha(e._a),this},lighten:function(){return this._applyModification(E,arguments)},brighten:function(){return this._applyModification(B,arguments)},darken:function(){return this._applyModification(O,arguments)},desaturate:function(){return this._applyModification(w,arguments)},saturate:function(){return this._applyModification(x,arguments)},greyscale:function(){return this._applyModification(b,arguments)},spin:function(){return this._applyModification(R,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(V,arguments)},complement:function(){return this._applyCombination(U,arguments)},monochromatic:function(){return this._applyCombination(G,arguments)},splitcomplement:function(){return this._applyCombination(Q,arguments)},triad:function(){return this._applyCombination(k,arguments)},tetrad:function(){return this._applyCombination(H,arguments)}},m.fromRatio=function(e,t){if("object"==typeof e){var i,r={};for(i in e)e.hasOwnProperty(i)&&(r[i]="a"===i?e[i]:L(e[i]));e=r}return m(e,t)},m.equals=function(e,t){return!(!e||!t)&&m(e).toRgbString()==m(t).toRgbString()},m.random=function(){return m.fromRatio({r:n(),g:n(),b:n()})},m.mix=function(e,t,i){i=0===i?0:i||50;e=m(e).toRgb(),t=m(t).toRgb(),i/=100;return m({r:(t.r-e.r)*i+e.r,g:(t.g-e.g)*i+e.g,b:(t.b-e.b)*i+e.b,a:(t.a-e.a)*i+e.a})},m.readability=function(e,t){e=m(e),t=m(t);return(l.max(e.getLuminance(),t.getLuminance())+.05)/(l.min(e.getLuminance(),t.getLuminance())+.05)},m.isReadable=function(e,t,i){var r=m.readability(e,t),n=!1,e=function(e){var t;t=((e=e||{level:"AA",size:"small"}).level||"AA").toUpperCase(),e=(e.size||"small").toLowerCase(),"AA"!==t&&"AAA"!==t&&(t="AA");"small"!==e&&"large"!==e&&(e="small");return{level:t,size:e}}(i);switch(e.level+e.size){case"AAsmall":case"AAAlarge":n=4.5<=r;break;case"AAlarge":n=3<=r;break;case"AAAsmall":n=7<=r}return n},m.mostReadable=function(e,t,i){for(var r,n=null,o=0,s=(i=i||{}).includeFallbackColors,a=i.level,l=i.size,u=0;u<t.length;u++)o<(r=m.readability(e,t[u]))&&(o=r,n=m(t[u]));return m.isReadable(e,n,{level:a,size:l})||!s?n:(i.includeFallbackColors=!1,m.mostReadable(e,["#fff","#000"],i))},p=m.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},s=m.hexNames=function(e){var t,i={};for(t in e)e.hasOwnProperty(t)&&(i[e[t]]=t);return i}(p),f="[\\s|\\(]+("+(a="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+a+")[,|\\s]+("+a+")\\s*\\)?",d="[\\s|\\(]+("+a+")[,|\\s]+("+a+")[,|\\s]+("+a+")[,|\\s]+("+a+")\\s*\\)?",g={CSS_UNIT:new RegExp(a),rgb:new RegExp("rgb"+f),rgba:new RegExp("rgba"+d),hsl:new RegExp("hsl"+f),hsla:new RegExp("hsla"+d),hsv:new RegExp("hsv"+f),hsva:new RegExp("hsva"+d),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/},e.exports?e.exports=m:void 0!==(a=function(){return m}.call(t,i,t,e))&&(e.exports=a)},6511:function(e,t){!function(t){"use strict";function R(){}function U(e){this.message=e||""}function k(e){this.message=e||""}function H(e){this.message=e||""}function Q(){}function V(e){return null===e?tt:e.color}function r(e){return null===e?null:e.parent}function G(e,t){null!==e&&(e.color=t)}function z(e){return null===e?null:e.left}function W(e){return null===e?null:e.right}function q(){this.root_=null,this.size_=0}function K(){}function j(){this.array_=[],arguments[0]instanceof Ge&&this.addAll(arguments[0])}function Z(){}function Y(e){this.message=e||""}function X(){this.array_=[]}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(e){if(void 0===this||null===this)throw new TypeError(this+" is not an object");var t=Object(this),i=Math.max(Math.min(t.length,9007199254740991),0)||0,r=1 in arguments?parseInt(Number(arguments[1]),10)||0:0;r=r<0?Math.max(i+r,0):Math.min(r,i);var n=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:i;for(n=n<0?Math.max(i+arguments[2],0):Math.min(n,i);r<n;)t[r]=e,++r;return t},writable:!0}),Number.isFinite=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(e){return e!=e},Math.trunc=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};var J=function(){},A=(J.prototype.interfaces_=function(){return[]},J.prototype.getClass=function(){return J},J.prototype.equalsWithTolerance=function(e,t,i){return Math.abs(e-t)<=i},function(t){function e(e){t.call(this,e),this.name="IllegalArgumentException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error)),y=function(){},$={MAX_VALUE:{configurable:!0}},ee=(y.isNaN=function(e){return Number.isNaN(e)},y.doubleToLongBits=function(e){return e},y.longBitsToDouble=function(e){return e},y.isInfinite=function(e){return!Number.isFinite(e)},$.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(y,$),function(){}),te=function(){},ie=function(){},C=function e(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=e.NULL_ORDINATE;else if(1===arguments.length){var t=arguments[0];this.x=t.x,this.y=t.y,this.z=t.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=e.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},re={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}},ne=(C.prototype.setOrdinate=function(e,t){switch(e){case C.X:this.x=t;break;case C.Y:this.y=t;break;case C.Z:this.z=t;break;default:throw new A("Invalid ordinate index: "+e)}},C.prototype.equals2D=function(){if(1===arguments.length){var e=arguments[0];return this.x===e.x&&this.y===e.y}if(2===arguments.length){var t=arguments[0],i=arguments[1];return!!J.equalsWithTolerance(this.x,t.x,i)&&!!J.equalsWithTolerance(this.y,t.y,i)}},C.prototype.getOrdinate=function(e){switch(e){case C.X:return this.x;case C.Y:return this.y;case C.Z:return this.z}throw new A("Invalid ordinate index: "+e)},C.prototype.equals3D=function(e){return this.x===e.x&&this.y===e.y&&(this.z===e.z||y.isNaN(this.z))&&y.isNaN(e.z)},C.prototype.equals=function(e){return e instanceof C&&this.equals2D(e)},C.prototype.equalInZ=function(e,t){return J.equalsWithTolerance(this.z,e.z,t)},C.prototype.compareTo=function(e){var t=e;return this.x<t.x?-1:this.x>t.x?1:this.y<t.y?-1:this.y>t.y?1:0},C.prototype.clone=function(){},C.prototype.copy=function(){return new C(this)},C.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},C.prototype.distance3D=function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return Math.sqrt(t*t+i*i+r*r)},C.prototype.distance=function(e){var t=this.x-e.x,i=this.y-e.y;return Math.sqrt(t*t+i*i)},C.prototype.hashCode=function(){var e=17;return e=37*e+C.hashCode(this.x),e=37*e+C.hashCode(this.y)},C.prototype.setCoordinate=function(e){this.x=e.x,this.y=e.y,this.z=e.z},C.prototype.interfaces_=function(){return[ee,te,R]},C.prototype.getClass=function(){return C},C.hashCode=function(){if(1===arguments.length){var e=arguments[0],t=y.doubleToLongBits(e);return Math.trunc((t^t)>>>32)}},re.DimensionalComparator.get=function(){return ne},re.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},re.NULL_ORDINATE.get=function(){return y.NaN},re.X.get=function(){return 0},re.Y.get=function(){return 1},re.Z.get=function(){return 2},Object.defineProperties(C,re),function(e){if(this._dimensionsToTest=2,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(2!==t&&3!==t)throw new A("only 2 or 3 dimensions may be specified");this._dimensionsToTest=t}}),oe=(ne.prototype.compare=function(e,t){var i=e,r=t,n=ne.compare(i.x,r.x);if(0!==n)return n;var o=ne.compare(i.y,r.y);if(0!==o)return o;if(this._dimensionsToTest<=2)return 0;return ne.compare(i.z,r.z)},ne.prototype.interfaces_=function(){return[ie]},ne.prototype.getClass=function(){return ne},ne.compare=function(e,t){return e<t?-1:e>t?1:y.isNaN(e)?y.isNaN(t)?0:-1:y.isNaN(t)?1:0},function(){}),g=(oe.prototype.create=function(){},oe.prototype.interfaces_=function(){return[]},oe.prototype.getClass=function(){return oe},function(){}),se={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}},_=(g.prototype.interfaces_=function(){return[]},g.prototype.getClass=function(){return g},g.toLocationSymbol=function(e){switch(e){case g.EXTERIOR:return"e";case g.BOUNDARY:return"b";case g.INTERIOR:return"i";case g.NONE:return"-"}throw new A("Unknown location value: "+e)},se.INTERIOR.get=function(){return 0},se.BOUNDARY.get=function(){return 1},se.EXTERIOR.get=function(){return 2},se.NONE.get=function(){return-1},Object.defineProperties(g,se),function(e,t){return e.interfaces_&&e.interfaces_().indexOf(t)>-1}),ae=function(){},le={LOG_10:{configurable:!0}},ue=(ae.prototype.interfaces_=function(){return[]},ae.prototype.getClass=function(){return ae},ae.log10=function(e){var t=Math.log(e);return y.isInfinite(t)?t:y.isNaN(t)?t:t/ae.LOG_10},ae.min=function(e,t,i,r){var n=e;return t<n&&(n=t),i<n&&(n=i),r<n&&(n=r),n},ae.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var e=arguments[0],t=arguments[1],i=arguments[2];return e<t?t:e>i?i:e}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var r=arguments[0],n=arguments[1],o=arguments[2];return r<n?n:r>o?o:r}},ae.wrap=function(e,t){return e<0?t- -e%t:e%t},ae.max=function(){if(3===arguments.length){var e=arguments[0],t=arguments[1],i=arguments[2],r=e;return t>r&&(r=t),i>r&&(r=i),r}if(4===arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3],l=n;return o>l&&(l=o),s>l&&(l=s),a>l&&(l=a),l}},ae.average=function(e,t){return(e+t)/2},le.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(ae,le),function(e){this.str=e}),ce=(ue.prototype.append=function(e){this.str+=e},ue.prototype.setCharAt=function(e,t){this.str=this.str.substr(0,e)+t+this.str.substr(e+1)},ue.prototype.toString=function(e){return this.str},function(e){this.value=e}),he=(ce.prototype.intValue=function(){return this.value},ce.prototype.compareTo=function(e){return this.value<e?-1:this.value>e?1:0},ce.isNaN=function(e){return Number.isNaN(e)},function(){}),v=(he.isWhitespace=function(e){return e<=32&&e>=0||127===e},he.toUpperCase=function(e){return e.toUpperCase()},function e(){if(this._hi=0,this._lo=0,0===arguments.length)this.init(0);else if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof e){var i=arguments[0];this.init(i)}else if("string"==typeof arguments[0]){var r=arguments[0];e.call(this,e.parse(r))}}else if(2===arguments.length){var n=arguments[0],o=arguments[1];this.init(n,o)}}),Ae={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}},pe=(v.prototype.le=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<=e._lo},v.prototype.extractSignificantDigits=function(e,t){var i=this.abs(),r=v.magnitude(i._hi),n=v.TEN.pow(r);(i=i.divide(n)).gt(v.TEN)?(i=i.divide(v.TEN),r+=1):i.lt(v.ONE)&&(i=i.multiply(v.TEN),r-=1);for(var o=r+1,s=new ue,a=v.MAX_PRINT_DIGITS-1,l=0;l<=a;l++){e&&l===o&&s.append(".");var u=Math.trunc(i._hi);if(u<0)break;var c=!1,h=0;u>9?(c=!0,h="9"):h="0"+u,s.append(h),i=i.subtract(v.valueOf(u)).multiply(v.TEN),c&&i.selfAdd(v.TEN);var A=!0,p=v.magnitude(i._hi);if(p<0&&Math.abs(p)>=a-l&&(A=!1),!A)break}return t[0]=r,s.toString()},v.prototype.sqr=function(){return this.multiply(this)},v.prototype.doubleValue=function(){return this._hi+this._lo},v.prototype.subtract=function(){if(arguments[0]instanceof v){var e=arguments[0];return this.add(e.negate())}if("number"==typeof arguments[0]){var t=arguments[0];return this.add(-t)}},v.prototype.equals=function(){if(1===arguments.length){var e=arguments[0];return this._hi===e._hi&&this._lo===e._lo}},v.prototype.isZero=function(){return 0===this._hi&&0===this._lo},v.prototype.selfSubtract=function(){if(arguments[0]instanceof v){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e._hi,-e._lo)}if("number"==typeof arguments[0]){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t,0)}},v.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},v.prototype.min=function(e){return this.le(e)?this:e},v.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof v){var e=arguments[0];return this.selfDivide(e._hi,e._lo)}if("number"==typeof arguments[0]){var t=arguments[0];return this.selfDivide(t,0)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1],n=null,o=null,s=null,a=null,l=null,u=null,c=null,h=null;return l=this._hi/i,u=v.SPLIT*l,n=u-l,h=v.SPLIT*i,n=u-n,o=l-n,s=h-i,c=l*i,s=h-s,a=i-s,h=n*s-c+n*a+o*s+o*a,u=(this._hi-c-h+this._lo-l*r)/i,h=l+u,this._hi=h,this._lo=l-h+u,this}},v.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},v.prototype.divide=function(){if(arguments[0]instanceof v){var e=arguments[0],t=null,i=null,r=null,n=null,o=null,s=null,a=null,l=null;i=(o=this._hi/e._hi)-(t=(s=v.SPLIT*o)-(t=s-o)),l=t*(r=(l=v.SPLIT*e._hi)-(r=l-e._hi))-(a=o*e._hi)+t*(n=e._hi-r)+i*r+i*n,s=(this._hi-a-l+this._lo-o*e._lo)/e._hi;return new v(l=o+s,o-l+s)}if("number"==typeof arguments[0]){var u=arguments[0];return y.isNaN(u)?v.createNaN():v.copy(this).selfDivide(u,0)}},v.prototype.ge=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>=e._lo},v.prototype.pow=function(e){if(0===e)return v.valueOf(1);var t=new v(this),i=v.valueOf(1),r=Math.abs(e);if(r>1)for(;r>0;)r%2==1&&i.selfMultiply(t),(r/=2)>0&&(t=t.sqr());else i=t;return e<0?i.reciprocal():i},v.prototype.ceil=function(){if(this.isNaN())return v.NaN;var e=Math.ceil(this._hi),t=0;return e===this._hi&&(t=Math.ceil(this._lo)),new v(e,t)},v.prototype.compareTo=function(e){var t=e;return this._hi<t._hi?-1:this._hi>t._hi?1:this._lo<t._lo?-1:this._lo>t._lo?1:0},v.prototype.rint=function(){if(this.isNaN())return this;return this.add(.5).floor()},v.prototype.setValue=function(){if(arguments[0]instanceof v){var e=arguments[0];return this.init(e),this}if("number"==typeof arguments[0]){var t=arguments[0];return this.init(t),this}},v.prototype.max=function(e){return this.ge(e)?this:e},v.prototype.sqrt=function(){if(this.isZero())return v.valueOf(0);if(this.isNegative())return v.NaN;var e=1/Math.sqrt(this._hi),t=this._hi*e,i=v.valueOf(t),r=this.subtract(i.sqr())._hi*(.5*e);return i.add(r)},v.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof v){var e=arguments[0];return this.selfAdd(e._hi,e._lo)}if("number"==typeof arguments[0]){var t=arguments[0],i=null,r=null,n=null,o=null,s=null,a=null;return n=this._hi+t,s=n-this._hi,o=n-s,o=t-s+(this._hi-o),a=o+this._lo,i=n+a,r=a+(n-i),this._hi=i+r,this._lo=r+(i-this._hi),this}}else if(2===arguments.length){var l=arguments[0],u=arguments[1],c=null,h=null,A=null,p=null,f=null,d=null,g=null;p=this._hi+l,h=this._lo+u,f=p-(d=p-this._hi),A=h-(g=h-this._lo);var m=(c=p+(d=(f=l-d+(this._hi-f))+h))+(d=(A=u-g+(this._lo-A))+(d+(p-c))),y=d+(c-m);return this._hi=m,this._lo=y,this}},v.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof v){var e=arguments[0];return this.selfMultiply(e._hi,e._lo)}if("number"==typeof arguments[0]){var t=arguments[0];return this.selfMultiply(t,0)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1],n=null,o=null,s=null,a=null,l=null,u=null;n=(l=v.SPLIT*this._hi)-this._hi,u=v.SPLIT*i,n=l-n,o=this._hi-n,s=u-i;var c=(l=this._hi*i)+(u=n*(s=u-s)-l+n*(a=i-s)+o*s+o*a+(this._hi*r+this._lo*i)),h=u+(n=l-c);return this._hi=c,this._lo=h,this}},v.prototype.selfSqr=function(){return this.selfMultiply(this)},v.prototype.floor=function(){if(this.isNaN())return v.NaN;var e=Math.floor(this._hi),t=0;return e===this._hi&&(t=Math.floor(this._lo)),new v(e,t)},v.prototype.negate=function(){return this.isNaN()?this:new v(-this._hi,-this._lo)},v.prototype.clone=function(){},v.prototype.multiply=function(){if(arguments[0]instanceof v){var e=arguments[0];return e.isNaN()?v.createNaN():v.copy(this).selfMultiply(e)}if("number"==typeof arguments[0]){var t=arguments[0];return y.isNaN(t)?v.createNaN():v.copy(this).selfMultiply(t,0)}},v.prototype.isNaN=function(){return y.isNaN(this._hi)},v.prototype.intValue=function(){return Math.trunc(this._hi)},v.prototype.toString=function(){var e=v.magnitude(this._hi);return e>=-3&&e<=20?this.toStandardNotation():this.toSciNotation()},v.prototype.toStandardNotation=function(){var e=this.getSpecialNumberString();if(null!==e)return e;var t=new Array(1).fill(null),i=this.extractSignificantDigits(!0,t),r=t[0]+1,n=i;if("."===i.charAt(0))n="0"+i;else if(r<0)n="0."+v.stringOfChar("0",-r)+i;else if(-1===i.indexOf(".")){var o=r-i.length;n=i+v.stringOfChar("0",o)+".0"}return this.isNegative()?"-"+n:n},v.prototype.reciprocal=function(){var e=null,t=null,i=null,r=null,n=null,o=null,s=null,a=null;t=(n=1/this._hi)-(e=(o=v.SPLIT*n)-(e=o-n)),i=(a=v.SPLIT*this._hi)-this._hi;var l=n+(o=(1-(s=n*this._hi)-(a=e*(i=a-i)-s+e*(r=this._hi-i)+t*i+t*r)-n*this._lo)/this._hi);return new v(l,n-l+o)},v.prototype.toSciNotation=function(){if(this.isZero())return v.SCI_NOT_ZERO;var e=this.getSpecialNumberString();if(null!==e)return e;var t=new Array(1).fill(null),i=this.extractSignificantDigits(!1,t),r=v.SCI_NOT_EXPONENT_CHAR+t[0];if("0"===i.charAt(0))throw new Error("Found leading zero: "+i);var n="";i.length>1&&(n=i.substring(1));var o=i.charAt(0)+"."+n;return this.isNegative()?"-"+o+r:o+r},v.prototype.abs=function(){return this.isNaN()?v.NaN:this.isNegative()?this.negate():new v(this)},v.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},v.prototype.lt=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<e._lo},v.prototype.add=function(){if(arguments[0]instanceof v){var e=arguments[0];return v.copy(this).selfAdd(e)}if("number"==typeof arguments[0]){var t=arguments[0];return v.copy(this).selfAdd(t)}},v.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0]){var e=arguments[0];this._hi=e,this._lo=0}else if(arguments[0]instanceof v){var t=arguments[0];this._hi=t._hi,this._lo=t._lo}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this._hi=i,this._lo=r}},v.prototype.gt=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>e._lo},v.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},v.prototype.trunc=function(){return this.isNaN()?v.NaN:this.isPositive()?this.floor():this.ceil()},v.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},v.prototype.interfaces_=function(){return[R,ee,te]},v.prototype.getClass=function(){return v},v.sqr=function(e){return v.valueOf(e).selfMultiply(e)},v.valueOf=function(){if("string"==typeof arguments[0]){var e=arguments[0];return v.parse(e)}if("number"==typeof arguments[0]){var t=arguments[0];return new v(t)}},v.sqrt=function(e){return v.valueOf(e).sqrt()},v.parse=function(e){for(var t=0,i=e.length;he.isWhitespace(e.charAt(t));)t++;var r=!1;if(t<i){var n=e.charAt(t);"-"!==n&&"+"!==n||(t++,"-"===n&&(r=!0))}for(var o=new v,s=0,a=0,l=0;!(t>=i);){var u=e.charAt(t);if(t++,he.isDigit(u)){var c=u-"0";o.selfMultiply(v.TEN),o.selfAdd(c),s++}else{if("."!==u){if("e"===u||"E"===u){var h=e.substring(t);try{l=ce.parseInt(h)}catch(t){throw t instanceof Error?new Error("Invalid exponent "+h+" in string "+e):t}break}throw new Error("Unexpected character '"+u+"' at position "+t+" in string "+e)}a=s}}var A=o,p=s-a-l;if(0===p)A=o;else if(p>0){var f=v.TEN.pow(p);A=o.divide(f)}else if(p<0){var d=v.TEN.pow(-p);A=o.multiply(d)}return r?A.negate():A},v.createNaN=function(){return new v(y.NaN,y.NaN)},v.copy=function(e){return new v(e)},v.magnitude=function(e){var t=Math.abs(e),i=Math.log(t)/Math.log(10),r=Math.trunc(Math.floor(i));return 10*Math.pow(10,r)<=t&&(r+=1),r},v.stringOfChar=function(e,t){for(var i=new ue,r=0;r<t;r++)i.append(e);return i.toString()},Ae.PI.get=function(){return new v(3.141592653589793,12246467991473532e-32)},Ae.TWO_PI.get=function(){return new v(6.283185307179586,24492935982947064e-32)},Ae.PI_2.get=function(){return new v(1.5707963267948966,6123233995736766e-32)},Ae.E.get=function(){return new v(2.718281828459045,14456468917292502e-32)},Ae.NaN.get=function(){return new v(y.NaN,y.NaN)},Ae.EPS.get=function(){return 123259516440783e-46},Ae.SPLIT.get=function(){return 134217729},Ae.MAX_PRINT_DIGITS.get=function(){return 32},Ae.TEN.get=function(){return v.valueOf(10)},Ae.ONE.get=function(){return v.valueOf(1)},Ae.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},Ae.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(v,Ae),function(){}),fe={DP_SAFE_EPSILON:{configurable:!0}},f=(pe.prototype.interfaces_=function(){return[]},pe.prototype.getClass=function(){return pe},pe.orientationIndex=function(e,t,i){var r=pe.orientationIndexFilter(e,t,i);if(r<=1)return r;var n=v.valueOf(t.x).selfAdd(-e.x),o=v.valueOf(t.y).selfAdd(-e.y),s=v.valueOf(i.x).selfAdd(-t.x),a=v.valueOf(i.y).selfAdd(-t.y);return n.selfMultiply(a).selfSubtract(o.selfMultiply(s)).signum()},pe.signOfDet2x2=function(e,t,i,r){return e.multiply(r).selfSubtract(t.multiply(i)).signum()},pe.intersection=function(e,t,i,r){var n=v.valueOf(r.y).selfSubtract(i.y).selfMultiply(v.valueOf(t.x).selfSubtract(e.x)),o=v.valueOf(r.x).selfSubtract(i.x).selfMultiply(v.valueOf(t.y).selfSubtract(e.y)),s=n.subtract(o),a=v.valueOf(r.x).selfSubtract(i.x).selfMultiply(v.valueOf(e.y).selfSubtract(i.y)),l=v.valueOf(r.y).selfSubtract(i.y).selfMultiply(v.valueOf(e.x).selfSubtract(i.x)),u=a.subtract(l).selfDivide(s).doubleValue(),c=v.valueOf(e.x).selfAdd(v.valueOf(t.x).selfSubtract(e.x).selfMultiply(u)).doubleValue(),h=v.valueOf(t.x).selfSubtract(e.x).selfMultiply(v.valueOf(e.y).selfSubtract(i.y)),A=v.valueOf(t.y).selfSubtract(e.y).selfMultiply(v.valueOf(e.x).selfSubtract(i.x)),p=h.subtract(A).selfDivide(s).doubleValue(),f=v.valueOf(i.y).selfAdd(v.valueOf(r.y).selfSubtract(i.y).selfMultiply(p)).doubleValue();return new C(c,f)},pe.orientationIndexFilter=function(e,t,i){var r=null,n=(e.x-i.x)*(t.y-i.y),o=(e.y-i.y)*(t.x-i.x),s=n-o;if(n>0){if(o<=0)return pe.signum(s);r=n+o}else{if(!(n<0))return pe.signum(s);if(o>=0)return pe.signum(s);r=-n-o}var a=pe.DP_SAFE_EPSILON*r;return s>=a||-s>=a?pe.signum(s):2},pe.signum=function(e){return e>0?1:e<0?-1:0},fe.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(pe,fe),function(){}),de={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}},ge=(de.X.get=function(){return 0},de.Y.get=function(){return 1},de.Z.get=function(){return 2},de.M.get=function(){return 3},f.prototype.setOrdinate=function(e,t,i){},f.prototype.size=function(){},f.prototype.getOrdinate=function(e,t){},f.prototype.getCoordinate=function(){},f.prototype.getCoordinateCopy=function(e){},f.prototype.getDimension=function(){},f.prototype.getX=function(e){},f.prototype.clone=function(){},f.prototype.expandEnvelope=function(e){},f.prototype.copy=function(){},f.prototype.getY=function(e){},f.prototype.toCoordinateArray=function(){},f.prototype.interfaces_=function(){return[te]},f.prototype.getClass=function(){return f},Object.defineProperties(f,de),function(){}),me=function(e){function t(){e.call(this,"Projective point not representable on the Cartesian plane.")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ge),ye=function(){},_e=(ye.arraycopy=function(e,t,i,r,n){for(var o=0,s=t;s<t+n;s++)i[r+o]=e[s],o++},ye.getProperty=function(e){return{"line.separator":"\n"}[e]},function e(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var i=arguments[0],r=arguments[1];this.x=i,this.y=r,this.w=1}else if(arguments[0]instanceof e&&arguments[1]instanceof e){var n=arguments[0],o=arguments[1];this.x=n.y*o.w-o.y*n.w,this.y=o.x*n.w-n.x*o.w,this.w=n.x*o.y-o.x*n.y}else if(arguments[0]instanceof C&&arguments[1]instanceof C){var s=arguments[0],a=arguments[1];this.x=s.y-a.y,this.y=a.x-s.x,this.w=s.x*a.y-a.x*s.y}}else if(3===arguments.length){var l=arguments[0],u=arguments[1],c=arguments[2];this.x=l,this.y=u,this.w=c}else if(4===arguments.length){var h=arguments[0],A=arguments[1],p=arguments[2],f=arguments[3],d=h.y-A.y,g=A.x-h.x,m=h.x*A.y-A.x*h.y,y=p.y-f.y,_=f.x-p.x,v=p.x*f.y-f.x*p.y;this.x=g*v-_*m,this.y=y*m-d*v,this.w=d*_-y*g}}),u=(_e.prototype.getY=function(){var e=this.y/this.w;if(y.isNaN(e)||y.isInfinite(e))throw new me;return e},_e.prototype.getX=function(){var e=this.x/this.w;if(y.isNaN(e)||y.isInfinite(e))throw new me;return e},_e.prototype.getCoordinate=function(){var e=new C;return e.x=this.getX(),e.y=this.getY(),e},_e.prototype.interfaces_=function(){return[]},_e.prototype.getClass=function(){return _e},_e.intersection=function(e,t,i,r){var n=e.y-t.y,o=t.x-e.x,s=e.x*t.y-t.x*e.y,a=i.y-r.y,l=r.x-i.x,u=i.x*r.y-r.x*i.y,c=n*l-a*o,h=(o*u-l*s)/c,A=(a*s-n*u)/c;if(y.isNaN(h)||y.isInfinite(h)||y.isNaN(A)||y.isInfinite(A))throw new me;return new C(h,A)},function e(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof C){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var i=arguments[0];this.init(i)}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this.init(r.x,n.x,r.y,n.y)}else if(4===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],l=arguments[3];this.init(o,s,a,l)}}),ve={serialVersionUID:{configurable:!0}},Ce=(u.prototype.getArea=function(){return this.getWidth()*this.getHeight()},u.prototype.equals=function(e){if(!(e instanceof u))return!1;var t=e;return this.isNull()?t.isNull():this._maxx===t.getMaxX()&&this._maxy===t.getMaxY()&&this._minx===t.getMinX()&&this._miny===t.getMinY()},u.prototype.intersection=function(e){if(this.isNull()||e.isNull()||!this.intersects(e))return new u;var t=this._minx>e._minx?this._minx:e._minx,i=this._miny>e._miny?this._miny:e._miny,r=this._maxx<e._maxx?this._maxx:e._maxx,n=this._maxy<e._maxy?this._maxy:e._maxy;return new u(t,r,i,n)},u.prototype.isNull=function(){return this._maxx<this._minx},u.prototype.getMaxX=function(){return this._maxx},u.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof C){var e=arguments[0];return this.covers(e.x,e.y)}if(arguments[0]instanceof u){var t=arguments[0];return!this.isNull()&&!t.isNull()&&(t.getMinX()>=this._minx&&t.getMaxX()<=this._maxx&&t.getMinY()>=this._miny&&t.getMaxY()<=this._maxy)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return!this.isNull()&&(i>=this._minx&&i<=this._maxx&&r>=this._miny&&r<=this._maxy)}},u.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof u){var e=arguments[0];return!this.isNull()&&!e.isNull()&&!(e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny)}if(arguments[0]instanceof C){var t=arguments[0];return this.intersects(t.x,t.y)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return!this.isNull()&&!(i>this._maxx||i<this._minx||r>this._maxy||r<this._miny)}},u.prototype.getMinY=function(){return this._miny},u.prototype.getMinX=function(){return this._minx},u.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof C){var e=arguments[0];this.expandToInclude(e.x,e.y)}else if(arguments[0]instanceof u){var t=arguments[0];if(t.isNull())return null;this.isNull()?(this._minx=t.getMinX(),this._maxx=t.getMaxX(),this._miny=t.getMinY(),this._maxy=t.getMaxY()):(t._minx<this._minx&&(this._minx=t._minx),t._maxx>this._maxx&&(this._maxx=t._maxx),t._miny<this._miny&&(this._miny=t._miny),t._maxy>this._maxy&&(this._maxy=t._maxy))}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.isNull()?(this._minx=i,this._maxx=i,this._miny=r,this._maxy=r):(i<this._minx&&(this._minx=i),i>this._maxx&&(this._maxx=i),r<this._miny&&(this._miny=r),r>this._maxy&&(this._maxy=r))}},u.prototype.minExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e<t?e:t},u.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},u.prototype.compareTo=function(e){var t=e;return this.isNull()?t.isNull()?0:-1:t.isNull()?1:this._minx<t._minx?-1:this._minx>t._minx?1:this._miny<t._miny?-1:this._miny>t._miny?1:this._maxx<t._maxx?-1:this._maxx>t._maxx?1:this._maxy<t._maxy?-1:this._maxy>t._maxy?1:0},u.prototype.translate=function(e,t){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+t,this.getMaxY()+t)},u.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},u.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},u.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},u.prototype.maxExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e>t?e:t},u.prototype.expandBy=function(){if(1===arguments.length){var e=arguments[0];this.expandBy(e,e)}else if(2===arguments.length){var t=arguments[0],i=arguments[1];if(this.isNull())return null;this._minx-=t,this._maxx+=t,this._miny-=i,this._maxy+=i,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},u.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof u){var e=arguments[0];return this.covers(e)}if(arguments[0]instanceof C){var t=arguments[0];return this.covers(t)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return this.covers(i,r)}},u.prototype.centre=function(){return this.isNull()?null:new C((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},u.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof C){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof u){var t=arguments[0];this._minx=t._minx,this._maxx=t._maxx,this._miny=t._miny,this._maxy=t._maxy}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.init(i.x,r.x,i.y,r.y)}else if(4===arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];n<o?(this._minx=n,this._maxx=o):(this._minx=o,this._maxx=n),s<a?(this._miny=s,this._maxy=a):(this._miny=a,this._maxy=s)}},u.prototype.getMaxY=function(){return this._maxy},u.prototype.distance=function(e){if(this.intersects(e))return 0;var t=0;this._maxx<e._minx?t=e._minx-this._maxx:this._minx>e._maxx&&(t=this._minx-e._maxx);var i=0;return this._maxy<e._miny?i=e._miny-this._maxy:this._miny>e._maxy&&(i=this._miny-e._maxy),0===t?i:0===i?t:Math.sqrt(t*t+i*i)},u.prototype.hashCode=function(){var e=17;return e=37*e+C.hashCode(this._minx),e=37*e+C.hashCode(this._maxx),e=37*e+C.hashCode(this._miny),e=37*e+C.hashCode(this._maxy)},u.prototype.interfaces_=function(){return[ee,R]},u.prototype.getClass=function(){return u},u.intersects=function(){if(3===arguments.length){var e=arguments[0],t=arguments[1],i=arguments[2];return i.x>=(e.x<t.x?e.x:t.x)&&i.x<=(e.x>t.x?e.x:t.x)&&i.y>=(e.y<t.y?e.y:t.y)&&i.y<=(e.y>t.y?e.y:t.y)}if(4===arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2],s=arguments[3],a=Math.min(o.x,s.x),l=Math.max(o.x,s.x),u=Math.min(r.x,n.x),c=Math.max(r.x,n.x);return!(u>l)&&(!(c<a)&&(a=Math.min(o.y,s.y),l=Math.max(o.y,s.y),u=Math.min(r.y,n.y),c=Math.max(r.y,n.y),!(u>l)&&!(c<a)))}},ve.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(u,ve),{typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/}),we=function(e){this.geometryFactory=e||new l},xe=(we.prototype.read=function(e){var t,i,r;e=e.replace(/[\n\r]/g," ");var n=Ce.typeStr.exec(e);if(-1!==e.search("EMPTY")&&((n=Ce.emptyTypeStr.exec(e))[2]=void 0),n&&(i=n[1].toLowerCase(),r=n[2],be[i]&&(t=be[i].apply(this,[r]))),void 0===t)throw new Error("Could not parse WKT "+e);return t},we.prototype.write=function(e){return this.extractGeometry(e)},we.prototype.extractGeometry=function(e){var t=e.getGeometryType().toLowerCase();if(!xe[t])return null;var i=t.toUpperCase();return e.isEmpty()?i+" EMPTY":i+"("+xe[t].apply(this,[e])+")"},{coordinate:function(e){return e.x+" "+e.y},point:function(e){return xe.coordinate.call(this,e._coordinates._coordinates[0])},multipoint:function(e){for(var t=[],i=0,r=e._geometries.length;i<r;++i)t.push("("+xe.point.apply(this,[e._geometries[i]])+")");return t.join(",")},linestring:function(e){for(var t=[],i=0,r=e._points._coordinates.length;i<r;++i)t.push(xe.coordinate.apply(this,[e._points._coordinates[i]]));return t.join(",")},linearring:function(e){for(var t=[],i=0,r=e._points._coordinates.length;i<r;++i)t.push(xe.coordinate.apply(this,[e._points._coordinates[i]]));return t.join(",")},multilinestring:function(e){for(var t=[],i=0,r=e._geometries.length;i<r;++i)t.push("("+xe.linestring.apply(this,[e._geometries[i]])+")");return t.join(",")},polygon:function(e){var t=[];t.push("("+xe.linestring.apply(this,[e._shell])+")");for(var i=0,r=e._holes.length;i<r;++i)t.push("("+xe.linestring.apply(this,[e._holes[i]])+")");return t.join(",")},multipolygon:function(e){for(var t=[],i=0,r=e._geometries.length;i<r;++i)t.push("("+xe.polygon.apply(this,[e._geometries[i]])+")");return t.join(",")},geometrycollection:function(e){for(var t=[],i=0,r=e._geometries.length;i<r;++i)t.push(this.extractGeometry(e._geometries[i]));return t.join(",")}}),be={point:function(e){if(void 0===e)return this.geometryFactory.createPoint();var t=e.trim().split(Ce.spaces);return this.geometryFactory.createPoint(new C(Number.parseFloat(t[0]),Number.parseFloat(t[1])))},multipoint:function(e){if(void 0===e)return this.geometryFactory.createMultiPoint();for(var t,i=e.trim().split(","),r=[],n=0,o=i.length;n<o;++n)t=i[n].replace(Ce.trimParens,"$1"),r.push(be.point.apply(this,[t]));return this.geometryFactory.createMultiPoint(r)},linestring:function(e){if(void 0===e)return this.geometryFactory.createLineString();for(var t,i=e.trim().split(","),r=[],n=0,o=i.length;n<o;++n)t=i[n].trim().split(Ce.spaces),r.push(new C(Number.parseFloat(t[0]),Number.parseFloat(t[1])));return this.geometryFactory.createLineString(r)},linearring:function(e){if(void 0===e)return this.geometryFactory.createLinearRing();for(var t,i=e.trim().split(","),r=[],n=0,o=i.length;n<o;++n)t=i[n].trim().split(Ce.spaces),r.push(new C(Number.parseFloat(t[0]),Number.parseFloat(t[1])));return this.geometryFactory.createLinearRing(r)},multilinestring:function(e){if(void 0===e)return this.geometryFactory.createMultiLineString();for(var t,i=e.trim().split(Ce.parenComma),r=[],n=0,o=i.length;n<o;++n)t=i[n].replace(Ce.trimParens,"$1"),r.push(be.linestring.apply(this,[t]));return this.geometryFactory.createMultiLineString(r)},polygon:function(e){if(void 0===e)return this.geometryFactory.createPolygon();for(var t,i,r,n,o=e.trim().split(Ce.parenComma),s=[],a=0,l=o.length;a<l;++a)t=o[a].replace(Ce.trimParens,"$1"),i=be.linestring.apply(this,[t]),r=this.geometryFactory.createLinearRing(i._points),0===a?n=r:s.push(r);return this.geometryFactory.createPolygon(n,s)},multipolygon:function(e){if(void 0===e)return this.geometryFactory.createMultiPolygon();for(var t,i=e.trim().split(Ce.doubleParenComma),r=[],n=0,o=i.length;n<o;++n)t=i[n].replace(Ce.trimParens,"$1"),r.push(be.polygon.apply(this,[t]));return this.geometryFactory.createMultiPolygon(r)},geometrycollection:function(e){if(void 0===e)return this.geometryFactory.createGeometryCollection();for(var t=(e=e.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),i=[],r=0,n=t.length;r<n;++r)i.push(this.read(t[r]));return this.geometryFactory.createGeometryCollection(i)}},Ee=function(e){this.parser=new we(e)},Be=(Ee.prototype.write=function(e){return this.parser.write(e)},Ee.toLineString=function(e,t){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+t.x+" "+t.y+" )"},function(t){function e(e){t.call(this,e),this.name="RuntimeException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error)),Me=function(t){function e(){if(t.call(this),0===arguments.length)t.call(this);else if(1===arguments.length){var e=arguments[0];t.call(this,e)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Be),w=function(){},i=(w.prototype.interfaces_=function(){return[]},w.prototype.getClass=function(){return w},w.shouldNeverReachHere=function(){if(0===arguments.length)w.shouldNeverReachHere(null);else if(1===arguments.length){var e=arguments[0];throw new Me("Should never reach here"+(null!==e?": "+e:""))}},w.isTrue=function(){var e,t;if(1===arguments.length)e=arguments[0],w.isTrue(e,null);else if(2===arguments.length&&(e=arguments[0],t=arguments[1],!e))throw null===t?new Me:new Me(t)},w.equals=function(){var e,t,i;if(2===arguments.length)e=arguments[0],t=arguments[1],w.equals(e,t,null);else if(3===arguments.length&&(e=arguments[0],t=arguments[1],i=arguments[2],!t.equals(e)))throw new Me("Expected "+e+" but encountered "+t+(null!==i?": "+i:""))},function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new C,this._intPt[1]=new C,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}),Ie={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}},Se=(i.prototype.getIndexAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intLineIndex[e][t]},i.prototype.getTopologySummary=function(){var e=new ue;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()},i.prototype.computeIntersection=function(e,t,i,r){this._inputLines[0][0]=e,this._inputLines[0][1]=t,this._inputLines[1][0]=i,this._inputLines[1][1]=r,this._result=this.computeIntersect(e,t,i,r)},i.prototype.getIntersectionNum=function(){return this._result},i.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var e=arguments[0];this.getEdgeDistance(e,0)>this.getEdgeDistance(e,1)?(this._intLineIndex[e][0]=0,this._intLineIndex[e][1]=1):(this._intLineIndex[e][0]=1,this._intLineIndex[e][1]=0)}},i.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},i.prototype.setPrecisionModel=function(e){this._precisionModel=e},i.prototype.isInteriorIntersection=function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var e=arguments[0],t=0;t<this._result;t++)if(!this._intPt[t].equals2D(this._inputLines[e][0])&&!this._intPt[t].equals2D(this._inputLines[e][1]))return!0;return!1}},i.prototype.getIntersection=function(e){return this._intPt[e]},i.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},i.prototype.hasIntersection=function(){return this._result!==i.NO_INTERSECTION},i.prototype.getEdgeDistance=function(e,t){return i.computeEdgeDistance(this._intPt[t],this._inputLines[e][0],this._inputLines[e][1])},i.prototype.isCollinear=function(){return this._result===i.COLLINEAR_INTERSECTION},i.prototype.toString=function(){return Ee.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Ee.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},i.prototype.getEndpoint=function(e,t){return this._inputLines[e][t]},i.prototype.isIntersection=function(e){for(var t=0;t<this._result;t++)if(this._intPt[t].equals2D(e))return!0;return!1},i.prototype.getIntersectionAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[e][t]]},i.prototype.interfaces_=function(){return[]},i.prototype.getClass=function(){return i},i.computeEdgeDistance=function(e,t,i){var r=Math.abs(i.x-t.x),n=Math.abs(i.y-t.y),o=-1;if(e.equals(t))o=0;else if(e.equals(i))o=r>n?r:n;else{var s=Math.abs(e.x-t.x),a=Math.abs(e.y-t.y);0!==(o=r>n?s:a)||e.equals(t)||(o=Math.max(s,a))}return w.isTrue(!(0===o&&!e.equals(t)),"Bad distance calculation"),o},i.nonRobustComputeEdgeDistance=function(e,t,i){var r=e.x-t.x,n=e.y-t.y,o=Math.sqrt(r*r+n*n);return w.isTrue(!(0===o&&!e.equals(t)),"Invalid distance calculation"),o},Ie.DONT_INTERSECT.get=function(){return 0},Ie.DO_INTERSECT.get=function(){return 1},Ie.COLLINEAR.get=function(){return 2},Ie.NO_INTERSECTION.get=function(){return 0},Ie.POINT_INTERSECTION.get=function(){return 1},Ie.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(i,Ie),function(l){function s(){l.apply(this,arguments)}return l&&(s.__proto__=l),s.prototype=Object.create(l&&l.prototype),s.prototype.constructor=s,s.prototype.isInSegmentEnvelopes=function(e){var t=new u(this._inputLines[0][0],this._inputLines[0][1]),i=new u(this._inputLines[1][0],this._inputLines[1][1]);return t.contains(e)&&i.contains(e)},s.prototype.computeIntersection=function(){if(3!==arguments.length)return l.prototype.computeIntersection.apply(this,arguments);var e=arguments[0],t=arguments[1],i=arguments[2];if(this._isProper=!1,u.intersects(t,i,e)&&0===x.orientationIndex(t,i,e)&&0===x.orientationIndex(i,t,e))return this._isProper=!0,(e.equals(t)||e.equals(i))&&(this._isProper=!1),this._result=l.POINT_INTERSECTION,null;this._result=l.NO_INTERSECTION},s.prototype.normalizeToMinimum=function(e,t,i,r,n){n.x=this.smallestInAbsValue(e.x,t.x,i.x,r.x),n.y=this.smallestInAbsValue(e.y,t.y,i.y,r.y),e.x-=n.x,e.y-=n.y,t.x-=n.x,t.y-=n.y,i.x-=n.x,i.y-=n.y,r.x-=n.x,r.y-=n.y},s.prototype.safeHCoordinateIntersection=function(t,i,r,n){var o=null;try{o=_e.intersection(t,i,r,n)}catch(e){if(!(e instanceof me))throw e;o=s.nearestEndpoint(t,i,r,n)}return o},s.prototype.intersection=function(e,t,i,r){var n=this.intersectionWithNormalization(e,t,i,r);return this.isInSegmentEnvelopes(n)||(n=new C(s.nearestEndpoint(e,t,i,r))),null!==this._precisionModel&&this._precisionModel.makePrecise(n),n},s.prototype.smallestInAbsValue=function(e,t,i,r){var n=e,o=Math.abs(n);return Math.abs(t)<o&&(n=t,o=Math.abs(t)),Math.abs(i)<o&&(n=i,o=Math.abs(i)),Math.abs(r)<o&&(n=r),n},s.prototype.checkDD=function(e,t,i,r,n){var o=pe.intersection(e,t,i,r),s=this.isInSegmentEnvelopes(o);ye.out.println("DD in env = "+s+"  --------------------- "+o),n.distance(o)>1e-4&&ye.out.println("Distance = "+n.distance(o))},s.prototype.intersectionWithNormalization=function(e,t,i,r){var n=new C(e),o=new C(t),s=new C(i),a=new C(r),l=new C;this.normalizeToEnvCentre(n,o,s,a,l);var u=this.safeHCoordinateIntersection(n,o,s,a);return u.x+=l.x,u.y+=l.y,u},s.prototype.computeCollinearIntersection=function(e,t,i,r){var n=u.intersects(e,t,i),o=u.intersects(e,t,r),s=u.intersects(i,r,e),a=u.intersects(i,r,t);return n&&o?(this._intPt[0]=i,this._intPt[1]=r,l.COLLINEAR_INTERSECTION):s&&a?(this._intPt[0]=e,this._intPt[1]=t,l.COLLINEAR_INTERSECTION):n&&s?(this._intPt[0]=i,this._intPt[1]=e,!i.equals(e)||o||a?l.COLLINEAR_INTERSECTION:l.POINT_INTERSECTION):n&&a?(this._intPt[0]=i,this._intPt[1]=t,!i.equals(t)||o||s?l.COLLINEAR_INTERSECTION:l.POINT_INTERSECTION):o&&s?(this._intPt[0]=r,this._intPt[1]=e,!r.equals(e)||n||a?l.COLLINEAR_INTERSECTION:l.POINT_INTERSECTION):o&&a?(this._intPt[0]=r,this._intPt[1]=t,!r.equals(t)||n||s?l.COLLINEAR_INTERSECTION:l.POINT_INTERSECTION):l.NO_INTERSECTION},s.prototype.normalizeToEnvCentre=function(e,t,i,r,n){var o=e.x<t.x?e.x:t.x,s=e.y<t.y?e.y:t.y,a=e.x>t.x?e.x:t.x,l=e.y>t.y?e.y:t.y,u=i.x<r.x?i.x:r.x,c=i.y<r.y?i.y:r.y,h=i.x>r.x?i.x:r.x,A=i.y>r.y?i.y:r.y,p=((o>u?o:u)+(a<h?a:h))/2,f=((s>c?s:c)+(l<A?l:A))/2;n.x=p,n.y=f,e.x-=n.x,e.y-=n.y,t.x-=n.x,t.y-=n.y,i.x-=n.x,i.y-=n.y,r.x-=n.x,r.y-=n.y},s.prototype.computeIntersect=function(e,t,i,r){if(this._isProper=!1,!u.intersects(e,t,i,r))return l.NO_INTERSECTION;var n=x.orientationIndex(e,t,i),o=x.orientationIndex(e,t,r);if(n>0&&o>0||n<0&&o<0)return l.NO_INTERSECTION;var s=x.orientationIndex(i,r,e),a=x.orientationIndex(i,r,t);if(s>0&&a>0||s<0&&a<0)return l.NO_INTERSECTION;return 0===n&&0===o&&0===s&&0===a?this.computeCollinearIntersection(e,t,i,r):(0===n||0===o||0===s||0===a?(this._isProper=!1,e.equals2D(i)||e.equals2D(r)?this._intPt[0]=e:t.equals2D(i)||t.equals2D(r)?this._intPt[0]=t:0===n?this._intPt[0]=new C(i):0===o?this._intPt[0]=new C(r):0===s?this._intPt[0]=new C(e):0===a&&(this._intPt[0]=new C(t))):(this._isProper=!0,this._intPt[0]=this.intersection(e,t,i,r)),l.POINT_INTERSECTION)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s.nearestEndpoint=function(e,t,i,r){var n=e,o=x.distancePointLine(e,i,r),s=x.distancePointLine(t,i,r);return s<o&&(o=s,n=t),(s=x.distancePointLine(i,e,t))<o&&(o=s,n=i),(s=x.distancePointLine(r,e,t))<o&&(o=s,n=r),n},s}(i)),Pe=function(){},Te=(Pe.prototype.interfaces_=function(){return[]},Pe.prototype.getClass=function(){return Pe},Pe.orientationIndex=function(e,t,i){var r=t.x-e.x,n=t.y-e.y,o=i.x-t.x,s=i.y-t.y;return Pe.signOfDet2x2(r,n,o,s)},Pe.signOfDet2x2=function(e,t,i,r){var n=null,o=null,s=null;if(n=1,0===e||0===r)return 0===t||0===i?0:t>0?i>0?-n:n:i>0?n:-n;if(0===t||0===i)return r>0?e>0?n:-n:e>0?-n:n;if(t>0?r>0?t<=r||(n=-n,o=e,e=i,i=o,o=t,t=r,r=o):t<=-r?(n=-n,i=-i,r=-r):(o=e,e=-i,i=o,o=t,t=-r,r=o):r>0?-t<=r?(n=-n,e=-e,t=-t):(o=-e,e=i,i=o,o=-t,t=r,r=o):t>=r?(e=-e,t=-t,i=-i,r=-r):(n=-n,o=-e,e=-i,i=o,o=-t,t=-r,r=o),e>0){if(!(i>0))return n;if(!(e<=i))return n}else{if(i>0)return-n;if(!(e>=i))return-n;n=-n,e=-e,i=-i}for(;;){if(s=Math.floor(i/e),i-=s*e,(r-=s*t)<0)return-n;if(r>t)return n;if(e>i+i){if(t<r+r)return n}else{if(t>r+r)return-n;i=e-i,r=t-r,n=-n}if(0===r)return 0===i?0:-n;if(0===i)return n;if(s=Math.floor(e/i),e-=s*i,(t-=s*r)<0)return n;if(t>r)return-n;if(i>e+e){if(r<t+t)return-n}else{if(r>t+t)return n;e=i-e,t=r-t,n=-n}if(0===t)return 0===e?0:n;if(0===e)return-n}},function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var e=arguments[0];this._p=e}),x=(Te.prototype.countSegment=function(e,t){if(e.x<this._p.x&&t.x<this._p.x)return null;if(this._p.x===t.x&&this._p.y===t.y)return this._isPointOnSegment=!0,null;if(e.y===this._p.y&&t.y===this._p.y){var i=e.x,r=t.x;return i>r&&(i=t.x,r=e.x),this._p.x>=i&&this._p.x<=r&&(this._isPointOnSegment=!0),null}if(e.y>this._p.y&&t.y<=this._p.y||t.y>this._p.y&&e.y<=this._p.y){var n=e.x-this._p.x,o=e.y-this._p.y,s=t.x-this._p.x,a=t.y-this._p.y,l=Pe.signOfDet2x2(n,o,s,a);if(0===l)return this._isPointOnSegment=!0,null;a<o&&(l=-l),l>0&&this._crossingCount++}},Te.prototype.isPointInPolygon=function(){return this.getLocation()!==g.EXTERIOR},Te.prototype.getLocation=function(){return this._isPointOnSegment?g.BOUNDARY:this._crossingCount%2==1?g.INTERIOR:g.EXTERIOR},Te.prototype.isOnSegment=function(){return this._isPointOnSegment},Te.prototype.interfaces_=function(){return[]},Te.prototype.getClass=function(){return Te},Te.locatePointInRing=function(){if(arguments[0]instanceof C&&_(arguments[1],f)){for(var e=arguments[0],t=arguments[1],i=new Te(e),r=new C,n=new C,o=1;o<t.size();o++)if(t.getCoordinate(o,r),t.getCoordinate(o-1,n),i.countSegment(r,n),i.isOnSegment())return i.getLocation();return i.getLocation()}if(arguments[0]instanceof C&&arguments[1]instanceof Array){for(var s=arguments[0],a=arguments[1],l=new Te(s),u=1;u<a.length;u++){var c=a[u],h=a[u-1];if(l.countSegment(c,h),l.isOnSegment())return l.getLocation()}return l.getLocation()}},function(){}),Le={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}},De=(x.prototype.interfaces_=function(){return[]},x.prototype.getClass=function(){return x},x.orientationIndex=function(e,t,i){return pe.orientationIndex(e,t,i)},x.signedArea=function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var t=0,i=e[0].x,r=1;r<e.length-1;r++){var n=e[r].x-i,o=e[r+1].y;t+=n*(e[r-1].y-o)}return t/2}if(_(arguments[0],f)){var s=arguments[0],a=s.size();if(a<3)return 0;var l=new C,u=new C,c=new C;s.getCoordinate(0,u),s.getCoordinate(1,c);var h=u.x;c.x-=h;for(var A=0,p=1;p<a-1;p++)l.y=u.y,u.x=c.x,u.y=c.y,s.getCoordinate(p+1,c),c.x-=h,A+=u.x*(l.y-c.y);return A/2}},x.distanceLineLine=function(e,t,i,r){if(e.equals(t))return x.distancePointLine(e,i,r);if(i.equals(r))return x.distancePointLine(r,e,t);var n=!1;if(u.intersects(e,t,i,r)){var o=(t.x-e.x)*(r.y-i.y)-(t.y-e.y)*(r.x-i.x);if(0===o)n=!0;else{var s=(e.y-i.y)*(r.x-i.x)-(e.x-i.x)*(r.y-i.y),a=((e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y))/o,l=s/o;(l<0||l>1||a<0||a>1)&&(n=!0)}}else n=!0;return n?ae.min(x.distancePointLine(e,i,r),x.distancePointLine(t,i,r),x.distancePointLine(i,e,t),x.distancePointLine(r,e,t)):0},x.isPointInRing=function(e,t){return x.locatePointInRing(e,t)!==g.EXTERIOR},x.computeLength=function(e){var t=e.size();if(t<=1)return 0;var i=0,r=new C;e.getCoordinate(0,r);for(var n=r.x,o=r.y,s=1;s<t;s++){e.getCoordinate(s,r);var a=r.x,l=r.y,u=a-n,c=l-o;i+=Math.sqrt(u*u+c*c),n=a,o=l}return i},x.isCCW=function(e){var t=e.length-1;if(t<3)throw new A("Ring has fewer than 4 points, so orientation cannot be determined");for(var i=e[0],r=0,n=1;n<=t;n++){var o=e[n];o.y>i.y&&(i=o,r=n)}var s=r;do{(s-=1)<0&&(s=t)}while(e[s].equals2D(i)&&s!==r);var a=r;do{a=(a+1)%t}while(e[a].equals2D(i)&&a!==r);var l=e[s],u=e[a];if(l.equals2D(i)||u.equals2D(i)||l.equals2D(u))return!1;var c=x.computeOrientation(l,i,u),h=!1;return h=0===c?l.x>u.x:c>0,h},x.locatePointInRing=function(e,t){return Te.locatePointInRing(e,t)},x.distancePointLinePerpendicular=function(e,t,i){var r=(i.x-t.x)*(i.x-t.x)+(i.y-t.y)*(i.y-t.y),n=((t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y))/r;return Math.abs(n)*Math.sqrt(r)},x.computeOrientation=function(e,t,i){return x.orientationIndex(e,t,i)},x.distancePointLine=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];if(0===t.length)throw new A("Line array must contain at least one vertex");for(var i=e.distance(t[0]),r=0;r<t.length-1;r++){var n=x.distancePointLine(e,t[r],t[r+1]);n<i&&(i=n)}return i}if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];if(s.x===a.x&&s.y===a.y)return o.distance(s);var l=(a.x-s.x)*(a.x-s.x)+(a.y-s.y)*(a.y-s.y),u=((o.x-s.x)*(a.x-s.x)+(o.y-s.y)*(a.y-s.y))/l;if(u<=0)return o.distance(s);if(u>=1)return o.distance(a);var c=((s.y-o.y)*(a.x-s.x)-(s.x-o.x)*(a.y-s.y))/l;return Math.abs(c)*Math.sqrt(l)}},x.isOnLine=function(e,t){for(var i=new Se,r=1;r<t.length;r++){var n=t[r-1],o=t[r];if(i.computeIntersection(e,n,o),i.hasIntersection())return!0}return!1},Le.CLOCKWISE.get=function(){return-1},Le.RIGHT.get=function(){return x.CLOCKWISE},Le.COUNTERCLOCKWISE.get=function(){return 1},Le.LEFT.get=function(){return x.COUNTERCLOCKWISE},Le.COLLINEAR.get=function(){return 0},Le.STRAIGHT.get=function(){return x.COLLINEAR},Object.defineProperties(x,Le),function(){}),b=(De.prototype.filter=function(e){},De.prototype.interfaces_=function(){return[]},De.prototype.getClass=function(){return De},function(){var e=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=e,this._SRID=e.getSRID()}),Fe={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}},Ne=(b.prototype.isGeometryCollection=function(){return this.getSortIndex()===b.SORTINDEX_GEOMETRYCOLLECTION},b.prototype.getFactory=function(){return this._factory},b.prototype.getGeometryN=function(e){return this},b.prototype.getArea=function(){return 0},b.prototype.isRectangle=function(){return!1},b.prototype.equals=function(){if(arguments[0]instanceof b){var e=arguments[0];return null!==e&&this.equalsTopo(e)}if(arguments[0]instanceof Object){var t=arguments[0];if(!(t instanceof b))return!1;var i=t;return this.equalsExact(i)}},b.prototype.equalsExact=function(e){return this===e||this.equalsExact(e,0)},b.prototype.geometryChanged=function(){this.apply(b.geometryChangedFilter)},b.prototype.geometryChangedAction=function(){this._envelope=null},b.prototype.equalsNorm=function(e){return null!==e&&this.norm().equalsExact(e.norm())},b.prototype.getLength=function(){return 0},b.prototype.getNumGeometries=function(){return 1},b.prototype.compareTo=function(){if(1===arguments.length){var e=arguments[0],t=e;return this.getSortIndex()!==t.getSortIndex()?this.getSortIndex()-t.getSortIndex():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(e)}if(2===arguments.length){var i=arguments[0],r=arguments[1];return this.getSortIndex()!==i.getSortIndex()?this.getSortIndex()-i.getSortIndex():this.isEmpty()&&i.isEmpty()?0:this.isEmpty()?-1:i.isEmpty()?1:this.compareToSameClass(i,r)}},b.prototype.getUserData=function(){return this._userData},b.prototype.getSRID=function(){return this._SRID},b.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},b.prototype.checkNotGeometryCollection=function(e){if(e.getSortIndex()===b.SORTINDEX_GEOMETRYCOLLECTION)throw new A("This method does not support GeometryCollection arguments")},b.prototype.equal=function(e,t,i){return 0===i?e.equals(t):e.distance(t)<=i},b.prototype.norm=function(){var e=this.copy();return e.normalize(),e},b.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},b.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new u(this._envelope)},b.prototype.setSRID=function(e){this._SRID=e},b.prototype.setUserData=function(e){this._userData=e},b.prototype.compare=function(e,t){for(var i=e.iterator(),r=t.iterator();i.hasNext()&&r.hasNext();){var n=i.next(),o=r.next(),s=n.compareTo(o);if(0!==s)return s}return i.hasNext()?1:r.hasNext()?-1:0},b.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},b.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===b.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===b.SORTINDEX_MULTIPOINT||this.getSortIndex()===b.SORTINDEX_MULTILINESTRING||this.getSortIndex()===b.SORTINDEX_MULTIPOLYGON},b.prototype.interfaces_=function(){return[te,ee,R]},b.prototype.getClass=function(){return b},b.hasNonEmptyElements=function(e){for(var t=0;t<e.length;t++)if(!e[t].isEmpty())return!0;return!1},b.hasNullElements=function(e){for(var t=0;t<e.length;t++)if(null===e[t])return!0;return!1},Fe.serialVersionUID.get=function(){return 0x799ea46522854c00},Fe.SORTINDEX_POINT.get=function(){return 0},Fe.SORTINDEX_MULTIPOINT.get=function(){return 1},Fe.SORTINDEX_LINESTRING.get=function(){return 2},Fe.SORTINDEX_LINEARRING.get=function(){return 3},Fe.SORTINDEX_MULTILINESTRING.get=function(){return 4},Fe.SORTINDEX_POLYGON.get=function(){return 5},Fe.SORTINDEX_MULTIPOLYGON.get=function(){return 6},Fe.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},Fe.geometryChangedFilter.get=function(){return Ne},Object.defineProperties(b,Fe),function(){}),Oe=(Ne.interfaces_=function(){return[De]},Ne.filter=function(e){e.geometryChangedAction()},function(){}),Re=(Oe.prototype.filter=function(e){},Oe.prototype.interfaces_=function(){return[]},Oe.prototype.getClass=function(){return Oe},function(){}),Ue={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}},ke=(Re.prototype.isInBoundary=function(e){},Re.prototype.interfaces_=function(){return[]},Re.prototype.getClass=function(){return Re},Ue.Mod2BoundaryNodeRule.get=function(){return ke},Ue.EndPointBoundaryNodeRule.get=function(){return He},Ue.MultiValentEndPointBoundaryNodeRule.get=function(){return Qe},Ue.MonoValentEndPointBoundaryNodeRule.get=function(){return Ve},Ue.MOD2_BOUNDARY_RULE.get=function(){return new ke},Ue.ENDPOINT_BOUNDARY_RULE.get=function(){return new He},Ue.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Qe},Ue.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Ve},Ue.OGC_SFS_BOUNDARY_RULE.get=function(){return Re.MOD2_BOUNDARY_RULE},Object.defineProperties(Re,Ue),function(){}),He=(ke.prototype.isInBoundary=function(e){return e%2==1},ke.prototype.interfaces_=function(){return[Re]},ke.prototype.getClass=function(){return ke},function(){}),Qe=(He.prototype.isInBoundary=function(e){return e>0},He.prototype.interfaces_=function(){return[Re]},He.prototype.getClass=function(){return He},function(){}),Ve=(Qe.prototype.isInBoundary=function(e){return e>1},Qe.prototype.interfaces_=function(){return[Re]},Qe.prototype.getClass=function(){return Qe},function(){}),Ge=(Ve.prototype.isInBoundary=function(e){return 1===e},Ve.prototype.interfaces_=function(){return[Re]},Ve.prototype.getClass=function(){return Ve},function(){}),ze=(Ge.prototype.add=function(){},Ge.prototype.addAll=function(){},Ge.prototype.isEmpty=function(){},Ge.prototype.iterator=function(){},Ge.prototype.size=function(){},Ge.prototype.toArray=function(){},Ge.prototype.remove=function(){},(U.prototype=new Error).name="IndexOutOfBoundsException",function(){}),We=(ze.prototype.hasNext=function(){},ze.prototype.next=function(){},ze.prototype.remove=function(){},function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(){},t.prototype.set=function(){},t.prototype.isEmpty=function(){},t}(Ge)),E=((k.prototype=new Error).name="NoSuchElementException",function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof Ge&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.ensureCapacity=function(){},t.prototype.interfaces_=function(){return[e,Ge]},t.prototype.add=function(e){return 1===arguments.length?this.array_.push(e):this.array_.splice(arguments[0],arguments[1]),!0},t.prototype.clear=function(){this.array_=[]},t.prototype.addAll=function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next());return!0},t.prototype.set=function(e,t){var i=this.array_[e];return this.array_[e]=t,i},t.prototype.iterator=function(){return new qe(this)},t.prototype.get=function(e){if(e<0||e>=this.size())throw new U;return this.array_[e]},t.prototype.isEmpty=function(){return 0===this.array_.length},t.prototype.size=function(){return this.array_.length},t.prototype.toArray=function(){for(var e=[],t=0,i=this.array_.length;t<i;t++)e.push(this.array_[t]);return e},t.prototype.remove=function(e){for(var t=!1,i=0,r=this.array_.length;i<r;i++)if(this.array_[i]===e){this.array_.splice(i,1),t=!0;break}return t},t}(We)),qe=function(t){function e(e){t.call(this),this.arrayList_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new k;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(e){return this.arrayList_.set(this.position_-1,e)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(ze),Ke=function(_){function e(){if(_.call(this),0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.ensureCapacity(e.length),this.add(e,!0)}else if(2===arguments.length){var t=arguments[0],i=arguments[1];this.ensureCapacity(t.length),this.add(t,i)}}_&&(e.__proto__=_),(e.prototype=Object.create(_&&_.prototype)).constructor=e;var t={coordArrayType:{configurable:!0}};return t.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(e){return this.get(e)},e.prototype.addAll=function(){if(2===arguments.length){for(var e=arguments[0],t=arguments[1],i=!1,r=e.iterator();r.hasNext();)this.add(r.next(),t),i=!0;return i}return _.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var e=_.prototype.clone.call(this),t=0;t<this.size();t++)e.add(t,this.get(t).copy());return e},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){if(1===arguments.length){var e=arguments[0];_.prototype.add.call(this,e)}else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var t=arguments[0],i=arguments[1];return this.add(t,i,!0),!0}if(arguments[0]instanceof C&&"boolean"==typeof arguments[1]){var r=arguments[0];if(!arguments[1]&&this.size()>=1)if(this.get(this.size()-1).equals2D(r))return null;_.prototype.add.call(this,r)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var n=arguments[0],o=arguments[1];return this.add(n,o),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var s=arguments[0],a=arguments[1];if(arguments[2])for(var l=0;l<s.length;l++)this.add(s[l],a);else for(var u=s.length-1;u>=0;u--)this.add(s[u],a);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof C){var c=arguments[0],h=arguments[1];if(!arguments[2]){var A=this.size();if(A>0){if(c>0)if(this.get(c-1).equals2D(h))return null;if(c<A)if(this.get(c).equals2D(h))return null}}_.prototype.add.call(this,c,h)}}else if(4===arguments.length){var p=arguments[0],f=arguments[1],d=arguments[2],g=arguments[3],m=1;d>g&&(m=-1);for(var y=d;y!==g;y+=m)this.add(p[y],f);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new C(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,t),e}(E),c=function(){},je={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}},Ze=(je.ForwardComparator.get=function(){return Ze},je.BidirectionalComparator.get=function(){return Ye},je.coordArrayType.get=function(){return new Array(0).fill(null)},c.prototype.interfaces_=function(){return[]},c.prototype.getClass=function(){return c},c.isRing=function(e){return!(e.length<4)&&!!e[0].equals2D(e[e.length-1])},c.ptNotInList=function(e,t){for(var i=0;i<e.length;i++){var r=e[i];if(c.indexOf(r,t)<0)return r}return null},c.scroll=function(e,t){var i=c.indexOf(t,e);if(i<0)return null;var r=new Array(e.length).fill(null);ye.arraycopy(e,i,r,0,e.length-i),ye.arraycopy(e,0,r,e.length-i,i),ye.arraycopy(r,0,e,0,e.length)},c.equals=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];if(e===t)return!0;if(null===e||null===t)return!1;if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(!e[i].equals(t[i]))return!1;return!0}if(3===arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2];if(r===n)return!0;if(null===r||null===n)return!1;if(r.length!==n.length)return!1;for(var s=0;s<r.length;s++)if(0!==o.compare(r[s],n[s]))return!1;return!0}},c.intersection=function(e,t){for(var i=new Ke,r=0;r<e.length;r++)t.intersects(e[r])&&i.add(e[r],!0);return i.toCoordinateArray()},c.hasRepeatedPoints=function(e){for(var t=1;t<e.length;t++)if(e[t-1].equals(e[t]))return!0;return!1},c.removeRepeatedPoints=function(e){if(!c.hasRepeatedPoints(e))return e;return new Ke(e,!1).toCoordinateArray()},c.reverse=function(e){for(var t=e.length-1,i=Math.trunc(t/2),r=0;r<=i;r++){var n=e[r];e[r]=e[t-r],e[t-r]=n}},c.removeNull=function(e){for(var t=0,i=0;i<e.length;i++)null!==e[i]&&t++;var r=new Array(t).fill(null);if(0===t)return r;for(var n=0,o=0;o<e.length;o++)null!==e[o]&&(r[n++]=e[o]);return r},c.copyDeep=function(){if(1===arguments.length){for(var e=arguments[0],t=new Array(e.length).fill(null),i=0;i<e.length;i++)t[i]=new C(e[i]);return t}if(5===arguments.length)for(var r=arguments[0],n=arguments[1],o=arguments[2],s=arguments[3],a=arguments[4],l=0;l<a;l++)o[s+l]=new C(r[n+l])},c.isEqualReversed=function(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=t[e.length-i-1];if(0!==r.compareTo(n))return!1}return!0},c.envelope=function(e){for(var t=new u,i=0;i<e.length;i++)t.expandToInclude(e[i]);return t},c.toCoordinateArray=function(e){return e.toArray(c.coordArrayType)},c.atLeastNCoordinatesOrNothing=function(e,t){return t.length>=e?t:[]},c.indexOf=function(e,t){for(var i=0;i<t.length;i++)if(e.equals(t[i]))return i;return-1},c.increasingDirection=function(e){for(var t=0;t<Math.trunc(e.length/2);t++){var i=e.length-1-t,r=e[t].compareTo(e[i]);if(0!==r)return r}return 1},c.compare=function(e,t){for(var i=0;i<e.length&&i<t.length;){var r=e[i].compareTo(t[i]);if(0!==r)return r;i++}return i<t.length?-1:i<e.length?1:0},c.minCoordinate=function(e){for(var t=null,i=0;i<e.length;i++)(null===t||t.compareTo(e[i])>0)&&(t=e[i]);return t},c.extract=function(e,t,i){t=ae.clamp(t,0,e.length);var r=(i=ae.clamp(i,-1,e.length))-t+1;i<0&&(r=0),t>=e.length&&(r=0),i<t&&(r=0);var n=new Array(r).fill(null);if(0===r)return n;for(var o=0,s=t;s<=i;s++)n[o++]=e[s];return n},Object.defineProperties(c,je),function(){}),Ye=(Ze.prototype.compare=function(e,t){return c.compare(e,t)},Ze.prototype.interfaces_=function(){return[ie]},Ze.prototype.getClass=function(){return Ze},function(){}),Xe=(Ye.prototype.compare=function(e,t){var i=e,r=t;if(i.length<r.length)return-1;if(i.length>r.length)return 1;if(0===i.length)return 0;var n=c.compare(i,r);return c.isEqualReversed(i,r)?0:n},Ye.prototype.OLDcompare=function(e,t){var i=e,r=t;if(i.length<r.length)return-1;if(i.length>r.length)return 1;if(0===i.length)return 0;for(var n=c.increasingDirection(i),o=c.increasingDirection(r),s=n>0?0:i.length-1,a=o>0?0:i.length-1,l=0;l<i.length;l++){var u=i[s].compareTo(r[a]);if(0!==u)return u;s+=n,a+=o}return 0},Ye.prototype.interfaces_=function(){return[ie]},Ye.prototype.getClass=function(){return Ye},function(){}),Je=(Xe.prototype.get=function(){},Xe.prototype.put=function(){},Xe.prototype.size=function(){},Xe.prototype.values=function(){},Xe.prototype.entrySet=function(){},function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Xe)),$e=((H.prototype=new Error).name="OperationNotSupported",(Q.prototype=new Ge).contains=function(){},function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof Ge&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.contains=function(e){for(var t=0,i=this.array_.length;t<i;t++)if(this.array_[t]===e)return!0;return!1},t.prototype.add=function(e){return!this.contains(e)&&(this.array_.push(e),!0)},t.prototype.addAll=function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next());return!0},t.prototype.remove=function(e){throw new Error},t.prototype.size=function(){return this.array_.length},t.prototype.isEmpty=function(){return 0===this.array_.length},t.prototype.toArray=function(){for(var e=[],t=0,i=this.array_.length;t<i;t++)e.push(this.array_[t]);return e},t.prototype.iterator=function(){return new et(this)},t}(Q)),et=function(t){function e(e){t.call(this),this.hashSet_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new k;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new H},e}(ze),tt=0,it=((q.prototype=new Je).get=function(e){for(var t=this.root_;null!==t;){var i=e.compareTo(t.key);if(i<0)t=t.left;else{if(!(i>0))return t.value;t=t.right}}return null},q.prototype.put=function(e,t){if(null===this.root_)return this.root_={key:e,value:t,left:null,right:null,parent:null,color:tt,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var i,r,n=this.root_;do{if(i=n,(r=e.compareTo(n.key))<0)n=n.left;else{if(!(r>0)){var o=n.value;return n.value=t,o}n=n.right}}while(null!==n);var s={key:e,left:null,right:null,value:t,parent:i,color:tt,getValue:function(){return this.value},getKey:function(){return this.key}};return r<0?i.left=s:i.right=s,this.fixAfterInsertion(s),this.size_++,null},q.prototype.fixAfterInsertion=function(e){for(e.color=1;null!=e&&e!==this.root_&&1===e.parent.color;)if(r(e)===z(r(r(e)))){var t=W(r(r(e)));1===V(t)?(G(r(e),tt),G(t,tt),G(r(r(e)),1),e=r(r(e))):(e===W(r(e))&&(e=r(e),this.rotateLeft(e)),G(r(e),tt),G(r(r(e)),1),this.rotateRight(r(r(e))))}else{var i=z(r(r(e)));1===V(i)?(G(r(e),tt),G(i,tt),G(r(r(e)),1),e=r(r(e))):(e===z(r(e))&&(e=r(e),this.rotateRight(e)),G(r(e),tt),G(r(r(e)),1),this.rotateLeft(r(r(e))))}this.root_.color=tt},q.prototype.values=function(){var e=new E,t=this.getFirstEntry();if(null!==t)for(e.add(t.value);null!==(t=q.successor(t));)e.add(t.value);return e},q.prototype.entrySet=function(){var e=new $e,t=this.getFirstEntry();if(null!==t)for(e.add(t);null!==(t=q.successor(t));)e.add(t);return e},q.prototype.rotateLeft=function(e){if(null!=e){var t=e.right;e.right=t.left,null!=t.left&&(t.left.parent=e),t.parent=e.parent,null===e.parent?this.root_=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}},q.prototype.rotateRight=function(e){if(null!=e){var t=e.left;e.left=t.right,null!=t.right&&(t.right.parent=e),t.parent=e.parent,null===e.parent?this.root_=t:e.parent.right===e?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}},q.prototype.getFirstEntry=function(){var e=this.root_;if(null!=e)for(;null!=e.left;)e=e.left;return e},q.successor=function(e){if(null===e)return null;if(null!==e.right){for(var t=e.right;null!==t.left;)t=t.left;return t}for(var i=e.parent,r=e;null!==i&&r===i.right;)r=i,i=i.parent;return i},q.prototype.size=function(){return this.size_},function(){}),rt=(it.prototype.interfaces_=function(){return[]},it.prototype.getClass=function(){return it},K.prototype=new Q,(j.prototype=new K).contains=function(e){for(var t=0,i=this.array_.length;t<i;t++)if(0===this.array_[t].compareTo(e))return!0;return!1},j.prototype.add=function(e){if(this.contains(e))return!1;for(var t=0,i=this.array_.length;t<i;t++)if(1===this.array_[t].compareTo(e))return this.array_.splice(t,0,e),!0;return this.array_.push(e),!0},j.prototype.addAll=function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next());return!0},j.prototype.remove=function(e){throw new H},j.prototype.size=function(){return this.array_.length},j.prototype.isEmpty=function(){return 0===this.array_.length},j.prototype.toArray=function(){for(var e=[],t=0,i=this.array_.length;t<i;t++)e.push(this.array_[t]);return e},j.prototype.iterator=function(){return new rt(this)},function(e){this.treeSet_=e,this.position_=0}),nt=(rt.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new k;return this.treeSet_.array_[this.position_++]},rt.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},rt.prototype.remove=function(){throw new H},function(){}),o=(nt.sort=function(){var e,t,i,r,n=arguments[0];if(1===arguments.length)r=function(e,t){return e.compareTo(t)},n.sort(r);else if(2===arguments.length)i=arguments[1],r=function(e,t){return i.compare(e,t)},n.sort(r);else if(3===arguments.length){(t=n.slice(arguments[1],arguments[2])).sort();var o=n.slice(0,arguments[1]).concat(t,n.slice(arguments[2],n.length));for(n.splice(0,n.length),e=0;e<o.length;e++)n.push(o[e])}else if(4===arguments.length)for(t=n.slice(arguments[1],arguments[2]),i=arguments[3],r=function(e,t){return i.compare(e,t)},t.sort(r),o=n.slice(0,arguments[1]).concat(t,n.slice(arguments[2],n.length)),n.splice(0,n.length),e=0;e<o.length;e++)n.push(o[e])},nt.asList=function(e){for(var t=new E,i=0,r=e.length;i<r;i++)t.add(e[i]);return t},function(){}),ot={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}},st=(ot.P.get=function(){return 0},ot.L.get=function(){return 1},ot.A.get=function(){return 2},ot.FALSE.get=function(){return-1},ot.TRUE.get=function(){return-2},ot.DONTCARE.get=function(){return-3},ot.SYM_FALSE.get=function(){return"F"},ot.SYM_TRUE.get=function(){return"T"},ot.SYM_DONTCARE.get=function(){return"*"},ot.SYM_P.get=function(){return"0"},ot.SYM_L.get=function(){return"1"},ot.SYM_A.get=function(){return"2"},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o.toDimensionSymbol=function(e){switch(e){case o.FALSE:return o.SYM_FALSE;case o.TRUE:return o.SYM_TRUE;case o.DONTCARE:return o.SYM_DONTCARE;case o.P:return o.SYM_P;case o.L:return o.SYM_L;case o.A:return o.SYM_A}throw new A("Unknown dimension value: "+e)},o.toDimensionValue=function(e){switch(he.toUpperCase(e)){case o.SYM_FALSE:return o.FALSE;case o.SYM_TRUE:return o.TRUE;case o.SYM_DONTCARE:return o.DONTCARE;case o.SYM_P:return o.P;case o.SYM_L:return o.L;case o.SYM_A:return o.A}throw new A("Unknown dimension symbol: "+e)},Object.defineProperties(o,ot),function(){}),at=(st.prototype.filter=function(e){},st.prototype.interfaces_=function(){return[]},st.prototype.getClass=function(){return st},function(){}),lt=(at.prototype.filter=function(e,t){},at.prototype.isDone=function(){},at.prototype.isGeometryChanged=function(){},at.prototype.interfaces_=function(){return[]},at.prototype.getClass=function(){return at},function(n){function i(e,t){if(n.call(this,t),this._geometries=e||[],n.hasNullElements(this._geometries))throw new A("geometries must not contain null elements")}n&&(i.__proto__=n),(i.prototype=Object.create(n&&n.prototype)).constructor=i;var e={serialVersionUID:{configurable:!0}};return i.prototype.computeEnvelopeInternal=function(){for(var e=new u,t=0;t<this._geometries.length;t++)e.expandToInclude(this._geometries[t].getEnvelopeInternal());return e},i.prototype.getGeometryN=function(e){return this._geometries[e]},i.prototype.getSortIndex=function(){return n.SORTINDEX_GEOMETRYCOLLECTION},i.prototype.getCoordinates=function(){for(var e=new Array(this.getNumPoints()).fill(null),t=-1,i=0;i<this._geometries.length;i++)for(var r=this._geometries[i].getCoordinates(),n=0;n<r.length;n++)e[++t]=r[n];return e},i.prototype.getArea=function(){for(var e=0,t=0;t<this._geometries.length;t++)e+=this._geometries[t].getArea();return e},i.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];if(!this.isEquivalentClass(e))return!1;var i=e;if(this._geometries.length!==i._geometries.length)return!1;for(var r=0;r<this._geometries.length;r++)if(!this._geometries[r].equalsExact(i._geometries[r],t))return!1;return!0}return n.prototype.equalsExact.apply(this,arguments)},i.prototype.normalize=function(){for(var e=0;e<this._geometries.length;e++)this._geometries[e].normalize();nt.sort(this._geometries)},i.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},i.prototype.getBoundaryDimension=function(){for(var e=o.FALSE,t=0;t<this._geometries.length;t++)e=Math.max(e,this._geometries[t].getBoundaryDimension());return e},i.prototype.getDimension=function(){for(var e=o.FALSE,t=0;t<this._geometries.length;t++)e=Math.max(e,this._geometries[t].getDimension());return e},i.prototype.getLength=function(){for(var e=0,t=0;t<this._geometries.length;t++)e+=this._geometries[t].getLength();return e},i.prototype.getNumPoints=function(){for(var e=0,t=0;t<this._geometries.length;t++)e+=this._geometries[t].getNumPoints();return e},i.prototype.getNumGeometries=function(){return this._geometries.length},i.prototype.reverse=function(){for(var e=this._geometries.length,t=new Array(e).fill(null),i=0;i<this._geometries.length;i++)t[i]=this._geometries[i].reverse();return this.getFactory().createGeometryCollection(t)},i.prototype.compareToSameClass=function(){if(1===arguments.length){var e=arguments[0],t=new j(nt.asList(this._geometries)),i=new j(nt.asList(e._geometries));return this.compare(t,i)}if(2===arguments.length){for(var r=arguments[0],n=arguments[1],o=r,s=this.getNumGeometries(),a=o.getNumGeometries(),l=0;l<s&&l<a;){var u=this.getGeometryN(l),c=o.getGeometryN(l),h=u.compareToSameClass(c,n);if(0!==h)return h;l++}return l<s?1:l<a?-1:0}},i.prototype.apply=function(){if(_(arguments[0],Oe))for(var e=arguments[0],t=0;t<this._geometries.length;t++)this._geometries[t].apply(e);else if(_(arguments[0],at)){var i=arguments[0];if(0===this._geometries.length)return null;for(var r=0;r<this._geometries.length&&(this._geometries[r].apply(i),!i.isDone());r++);i.isGeometryChanged()&&this.geometryChanged()}else if(_(arguments[0],st)){var n=arguments[0];n.filter(this);for(var o=0;o<this._geometries.length;o++)this._geometries[o].apply(n)}else if(_(arguments[0],De)){var s=arguments[0];s.filter(this);for(var a=0;a<this._geometries.length;a++)this._geometries[a].apply(s)}},i.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),w.shouldNeverReachHere(),null},i.prototype.clone=function(){var e=n.prototype.clone.call(this);e._geometries=new Array(this._geometries.length).fill(null);for(var t=0;t<this._geometries.length;t++)e._geometries[t]=this._geometries[t].clone();return e},i.prototype.getGeometryType=function(){return"GeometryCollection"},i.prototype.copy=function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new i(e,this._factory)},i.prototype.isEmpty=function(){for(var e=0;e<this._geometries.length;e++)if(!this._geometries[e].isEmpty())return!1;return!0},i.prototype.interfaces_=function(){return[]},i.prototype.getClass=function(){return i},e.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(i,e),i}(b)),ut=function(i){function r(){i.apply(this,arguments)}i&&(r.__proto__=i),(r.prototype=Object.create(i&&i.prototype)).constructor=r;var e={serialVersionUID:{configurable:!0}};return r.prototype.getSortIndex=function(){return b.SORTINDEX_MULTILINESTRING},r.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return!!this.isEquivalentClass(e)&&i.prototype.equalsExact.call(this,e,t)}return i.prototype.equalsExact.apply(this,arguments)},r.prototype.getBoundaryDimension=function(){return this.isClosed()?o.FALSE:0},r.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var e=0;e<this._geometries.length;e++)if(!this._geometries[e].isClosed())return!1;return!0},r.prototype.getDimension=function(){return 1},r.prototype.reverse=function(){for(var e=this._geometries.length,t=new Array(e).fill(null),i=0;i<this._geometries.length;i++)t[e-1-i]=this._geometries[i].reverse();return this.getFactory().createMultiLineString(t)},r.prototype.getBoundary=function(){return new ct(this).getBoundary()},r.prototype.getGeometryType=function(){return"MultiLineString"},r.prototype.copy=function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new r(e,this._factory)},r.prototype.interfaces_=function(){return[it]},r.prototype.getClass=function(){return r},e.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(r,e),r}(lt),ct=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var e=arguments[0],t=Re.MOD2_BOUNDARY_RULE;this._geom=e,this._geomFact=e.getFactory(),this._bnRule=t}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this._geom=i,this._geomFact=i.getFactory(),this._bnRule=r}},ht=(ct.prototype.boundaryMultiLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var t=this.computeBoundaryCoordinates(e);return 1===t.length?this._geomFact.createPoint(t[0]):this._geomFact.createMultiPointFromCoords(t)},ct.prototype.getBoundary=function(){return this._geom instanceof B?this.boundaryLineString(this._geom):this._geom instanceof ut?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},ct.prototype.boundaryLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(e.isClosed())return this._bnRule.isInBoundary(2)?e.getStartPoint():this._geomFact.createMultiPoint();return this._geomFact.createMultiPoint([e.getStartPoint(),e.getEndPoint()])},ct.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},ct.prototype.computeBoundaryCoordinates=function(e){var t=new E;this._endpointMap=new q;for(var i=0;i<e.getNumGeometries();i++){var r=e.getGeometryN(i);0!==r.getNumPoints()&&(this.addEndpoint(r.getCoordinateN(0)),this.addEndpoint(r.getCoordinateN(r.getNumPoints()-1)))}for(var n=this._endpointMap.entrySet().iterator();n.hasNext();){var o=n.next(),s=o.getValue().count;this._bnRule.isInBoundary(s)&&t.add(o.getKey())}return c.toCoordinateArray(t)},ct.prototype.addEndpoint=function(e){var t=this._endpointMap.get(e);null===t&&(t=new ht,this._endpointMap.put(e,t)),t.count++},ct.prototype.interfaces_=function(){return[]},ct.prototype.getClass=function(){return ct},ct.getBoundary=function(){if(1===arguments.length){var e=arguments[0];return new ct(e).getBoundary()}if(2===arguments.length){var t=arguments[0],i=arguments[1];return new ct(t,i).getBoundary()}},function(){this.count=null}),At=(ht.prototype.interfaces_=function(){return[]},ht.prototype.getClass=function(){return ht},function(){}),pt={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}},s=(At.prototype.interfaces_=function(){return[]},At.prototype.getClass=function(){return At},At.chars=function(e,t){for(var i=new Array(t).fill(null),r=0;r<t;r++)i[r]=e;return String(i)},At.getStackTrace=function(){if(1===arguments.length){var e=arguments[0],t=new function(){},i=new function(){}(t);return e.printStackTrace(i),t.toString()}if(2===arguments.length){for(var r=arguments[0],n=arguments[1],o="",s=new function(){}(new function(){}(At.getStackTrace(r))),a=0;a<n;a++)try{o+=s.readLine()+At.NEWLINE}catch(e){if(!(e instanceof Z))throw e;w.shouldNeverReachHere()}return o}},At.split=function(e,t){for(var i=t.length,r=new E,n=""+e,o=n.indexOf(t);o>=0;){var s=n.substring(0,o);r.add(s),o=(n=n.substring(o+i)).indexOf(t)}n.length>0&&r.add(n);for(var a=new Array(r.size()).fill(null),l=0;l<a.length;l++)a[l]=r.get(l);return a},At.toString=function(){if(1===arguments.length){var e=arguments[0];return At.SIMPLE_ORDINATE_FORMAT.format(e)}},At.spaces=function(e){return At.chars(" ",e)},pt.NEWLINE.get=function(){return ye.getProperty("line.separator")},pt.SIMPLE_ORDINATE_FORMAT.get=function(){return new function(){}("0.#")},Object.defineProperties(At,pt),function(){}),B=(s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s.copyCoord=function(e,t,i,r){for(var n=Math.min(e.getDimension(),i.getDimension()),o=0;o<n;o++)i.setOrdinate(r,o,e.getOrdinate(t,o))},s.isRing=function(e){var t=e.size();return 0===t||!(t<=3)&&(e.getOrdinate(0,f.X)===e.getOrdinate(t-1,f.X)&&e.getOrdinate(0,f.Y)===e.getOrdinate(t-1,f.Y))},s.isEqual=function(e,t){var i=e.size();if(i!==t.size())return!1;for(var r=Math.min(e.getDimension(),t.getDimension()),n=0;n<i;n++)for(var o=0;o<r;o++){var s=e.getOrdinate(n,o),a=t.getOrdinate(n,o);if(e.getOrdinate(n,o)!==t.getOrdinate(n,o)&&(!y.isNaN(s)||!y.isNaN(a)))return!1}return!0},s.extend=function(e,t,i){var r=e.create(i,t.getDimension()),n=t.size();if(s.copy(t,0,r,0,n),n>0)for(var o=n;o<i;o++)s.copy(t,n-1,r,o,1);return r},s.reverse=function(e){for(var t=e.size()-1,i=Math.trunc(t/2),r=0;r<=i;r++)s.swap(e,r,t-r)},s.swap=function(e,t,i){if(t===i)return null;for(var r=0;r<e.getDimension();r++){var n=e.getOrdinate(t,r);e.setOrdinate(t,r,e.getOrdinate(i,r)),e.setOrdinate(i,r,n)}},s.copy=function(e,t,i,r,n){for(var o=0;o<n;o++)s.copyCoord(e,t+o,i,r+o)},s.toString=function(){if(1===arguments.length){var e=arguments[0],t=e.size();if(0===t)return"()";var i=e.getDimension(),r=new ue;r.append("(");for(var n=0;n<t;n++){n>0&&r.append(" ");for(var o=0;o<i;o++)o>0&&r.append(","),r.append(At.toString(e.getOrdinate(n,o)))}return r.append(")"),r.toString()}},s.ensureValidRing=function(e,t){var i=t.size();if(0===i)return t;if(i<=3)return s.createClosedRing(e,t,4);return t.getOrdinate(0,f.X)===t.getOrdinate(i-1,f.X)&&t.getOrdinate(0,f.Y)===t.getOrdinate(i-1,f.Y)?t:s.createClosedRing(e,t,i+1)},s.createClosedRing=function(e,t,i){var r=e.create(i,t.getDimension()),n=t.size();s.copy(t,0,r,0,n);for(var o=n;o<i;o++)s.copy(t,0,r,o,1);return r},function(n){function t(e,t){n.call(this,t),this._points=null,this.init(e)}n&&(t.__proto__=n),(t.prototype=Object.create(n&&n.prototype)).constructor=t;var e={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new u:this._points.expandEnvelope(new u)},t.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},t.prototype.getSortIndex=function(){return n.SORTINDEX_LINESTRING},t.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},t.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];if(!this.isEquivalentClass(e))return!1;var i=e;if(this._points.size()!==i._points.size())return!1;for(var r=0;r<this._points.size();r++)if(!this.equal(this._points.getCoordinate(r),i._points.getCoordinate(r),t))return!1;return!0}return n.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var e=0;e<Math.trunc(this._points.size()/2);e++){var t=this._points.size()-1-e;if(!this._points.getCoordinate(e).equals(this._points.getCoordinate(t)))return this._points.getCoordinate(e).compareTo(this._points.getCoordinate(t))>0&&s.reverse(this._points),null}},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?o.FALSE:0},t.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},t.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},t.prototype.getDimension=function(){return 1},t.prototype.getLength=function(){return x.computeLength(this._points)},t.prototype.getNumPoints=function(){return this._points.size()},t.prototype.reverse=function(){var e=this._points.copy();s.reverse(e);return this.getFactory().createLineString(e)},t.prototype.compareToSameClass=function(){if(1===arguments.length){for(var e=arguments[0],t=0,i=0;t<this._points.size()&&i<e._points.size();){var r=this._points.getCoordinate(t).compareTo(e._points.getCoordinate(i));if(0!==r)return r;t++,i++}return t<this._points.size()?1:i<e._points.size()?-1:0}if(2===arguments.length){var n=arguments[0];return arguments[1].compare(this._points,n._points)}},t.prototype.apply=function(){if(_(arguments[0],Oe))for(var e=arguments[0],t=0;t<this._points.size();t++)e.filter(this._points.getCoordinate(t));else if(_(arguments[0],at)){var i=arguments[0];if(0===this._points.size())return null;for(var r=0;r<this._points.size()&&(i.filter(this._points,r),!i.isDone());r++);i.isGeometryChanged()&&this.geometryChanged()}else if(_(arguments[0],st))arguments[0].filter(this);else if(_(arguments[0],De))arguments[0].filter(this)},t.prototype.getBoundary=function(){return new ct(this).getBoundary()},t.prototype.isEquivalentClass=function(e){return e instanceof t},t.prototype.clone=function(){var e=n.prototype.clone.call(this);return e._points=this._points.clone(),e},t.prototype.getCoordinateN=function(e){return this._points.getCoordinate(e)},t.prototype.getGeometryType=function(){return"LineString"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._points},t.prototype.isEmpty=function(){return 0===this._points.size()},t.prototype.init=function(e){if(null===e&&(e=this.getFactory().getCoordinateSequenceFactory().create([])),1===e.size())throw new A("Invalid number of points in LineString (found "+e.size()+" - must be 0 or >= 2)");this._points=e},t.prototype.isCoordinate=function(e){for(var t=0;t<this._points.size();t++)if(this._points.getCoordinate(t).equals(e))return!0;return!1},t.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},t.prototype.getPointN=function(e){return this.getFactory().createPoint(this._points.getCoordinate(e))},t.prototype.interfaces_=function(){return[it]},t.prototype.getClass=function(){return t},e.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(t,e),t}(b)),ft=function(){},dt=(ft.prototype.interfaces_=function(){return[]},ft.prototype.getClass=function(){return ft},function(i){function e(e,t){i.call(this,t),this._coordinates=e||null,this.init(this._coordinates)}i&&(e.__proto__=i),(e.prototype=Object.create(i&&i.prototype)).constructor=e;var t={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new u;var e=new u;return e.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),e},e.prototype.getSortIndex=function(){return i.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return!!this.isEquivalentClass(e)&&(!(!this.isEmpty()||!e.isEmpty())||this.isEmpty()===e.isEmpty()&&this.equal(e.getCoordinate(),this.getCoordinate(),t))}return i.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return o.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(1===arguments.length){var e=arguments[0];return this.getCoordinate().compareTo(e.getCoordinate())}if(2===arguments.length){var t=arguments[0];return arguments[1].compare(this._coordinates,t._coordinates)}},e.prototype.apply=function(){if(_(arguments[0],Oe)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this.getCoordinate())}else if(_(arguments[0],at)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this._coordinates,0),t.isGeometryChanged()&&this.geometryChanged()}else if(_(arguments[0],st))arguments[0].filter(this);else if(_(arguments[0],De))arguments[0].filter(this)},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var e=i.prototype.clone.call(this);return e._coordinates=this._coordinates.clone(),e},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return 0===this._coordinates.size()},e.prototype.init=function(e){null===e&&(e=this.getFactory().getCoordinateSequenceFactory().create([])),w.isTrue(e.size()<=1),this._coordinates=e},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[ft]},e.prototype.getClass=function(){return e},t.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(e,t),e}(b)),gt=function(){},mt=(gt.prototype.interfaces_=function(){return[]},gt.prototype.getClass=function(){return gt},function(s){function r(e,t,i){if(s.call(this,i),this._shell=null,this._holes=null,null===e&&(e=this.getFactory().createLinearRing()),null===t&&(t=[]),s.hasNullElements(t))throw new A("holes must not contain null elements");if(e.isEmpty()&&s.hasNonEmptyElements(t))throw new A("shell is empty but holes are not");this._shell=e,this._holes=t}s&&(r.__proto__=s),(r.prototype=Object.create(s&&s.prototype)).constructor=r;var e={serialVersionUID:{configurable:!0}};return r.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},r.prototype.getSortIndex=function(){return s.SORTINDEX_POLYGON},r.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var e=new Array(this.getNumPoints()).fill(null),t=-1,i=this._shell.getCoordinates(),r=0;r<i.length;r++)e[++t]=i[r];for(var n=0;n<this._holes.length;n++)for(var o=this._holes[n].getCoordinates(),s=0;s<o.length;s++)e[++t]=o[s];return e},r.prototype.getArea=function(){var e=0;e+=Math.abs(x.signedArea(this._shell.getCoordinateSequence()));for(var t=0;t<this._holes.length;t++)e-=Math.abs(x.signedArea(this._holes[t].getCoordinateSequence()));return e},r.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing())return!1;if(null===this._shell)return!1;if(5!==this._shell.getNumPoints())return!1;for(var e=this._shell.getCoordinateSequence(),t=this.getEnvelopeInternal(),i=0;i<5;i++){var r=e.getX(i);if(r!==t.getMinX()&&r!==t.getMaxX())return!1;var n=e.getY(i);if(n!==t.getMinY()&&n!==t.getMaxY())return!1}for(var o=e.getX(0),s=e.getY(0),a=1;a<=4;a++){var l=e.getX(a),u=e.getY(a);if(l!==o===(u!==s))return!1;o=l,s=u}return!0},r.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];if(!this.isEquivalentClass(e))return!1;var i=e,r=this._shell,n=i._shell;if(!r.equalsExact(n,t))return!1;if(this._holes.length!==i._holes.length)return!1;for(var o=0;o<this._holes.length;o++)if(!this._holes[o].equalsExact(i._holes[o],t))return!1;return!0}return s.prototype.equalsExact.apply(this,arguments)},r.prototype.normalize=function(){if(0===arguments.length){this.normalize(this._shell,!0);for(var e=0;e<this._holes.length;e++)this.normalize(this._holes[e],!1);nt.sort(this._holes)}else if(2===arguments.length){var t=arguments[0],i=arguments[1];if(t.isEmpty())return null;var r=new Array(t.getCoordinates().length-1).fill(null);ye.arraycopy(t.getCoordinates(),0,r,0,r.length);var n=c.minCoordinate(t.getCoordinates());c.scroll(r,n),ye.arraycopy(r,0,t.getCoordinates(),0,r.length),t.getCoordinates()[r.length]=r[0],x.isCCW(t.getCoordinates())===i&&c.reverse(t.getCoordinates())}},r.prototype.getCoordinate=function(){return this._shell.getCoordinate()},r.prototype.getNumInteriorRing=function(){return this._holes.length},r.prototype.getBoundaryDimension=function(){return 1},r.prototype.getDimension=function(){return 2},r.prototype.getLength=function(){var e=0;e+=this._shell.getLength();for(var t=0;t<this._holes.length;t++)e+=this._holes[t].getLength();return e},r.prototype.getNumPoints=function(){for(var e=this._shell.getNumPoints(),t=0;t<this._holes.length;t++)e+=this._holes[t].getNumPoints();return e},r.prototype.reverse=function(){var e=this.copy();e._shell=this._shell.copy().reverse(),e._holes=new Array(this._holes.length).fill(null);for(var t=0;t<this._holes.length;t++)e._holes[t]=this._holes[t].copy().reverse();return e},r.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},r.prototype.compareToSameClass=function(){if(1===arguments.length){var e=arguments[0],t=this._shell,i=e._shell;return t.compareToSameClass(i)}if(2===arguments.length){var r=arguments[0],n=arguments[1],o=r,s=this._shell,a=o._shell,l=s.compareToSameClass(a,n);if(0!==l)return l;for(var u=this.getNumInteriorRing(),c=o.getNumInteriorRing(),h=0;h<u&&h<c;){var A=this.getInteriorRingN(h),p=o.getInteriorRingN(h),f=A.compareToSameClass(p,n);if(0!==f)return f;h++}return h<u?1:h<c?-1:0}},r.prototype.apply=function(e){if(_(e,Oe)){this._shell.apply(e);for(var t=0;t<this._holes.length;t++)this._holes[t].apply(e)}else if(_(e,at)){if(this._shell.apply(e),!e.isDone())for(var i=0;i<this._holes.length&&(this._holes[i].apply(e),!e.isDone());i++);e.isGeometryChanged()&&this.geometryChanged()}else if(_(e,st))e.filter(this);else if(_(e,De)){e.filter(this),this._shell.apply(e);for(var r=0;r<this._holes.length;r++)this._holes[r].apply(e)}},r.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var e=new Array(this._holes.length+1).fill(null);e[0]=this._shell;for(var t=0;t<this._holes.length;t++)e[t+1]=this._holes[t];return e.length<=1?this.getFactory().createLinearRing(e[0].getCoordinateSequence()):this.getFactory().createMultiLineString(e)},r.prototype.clone=function(){var e=s.prototype.clone.call(this);e._shell=this._shell.clone(),e._holes=new Array(this._holes.length).fill(null);for(var t=0;t<this._holes.length;t++)e._holes[t]=this._holes[t].clone();return e},r.prototype.getGeometryType=function(){return"Polygon"},r.prototype.copy=function(){for(var e=this._shell.copy(),t=new Array(this._holes.length).fill(null),i=0;i<t.length;i++)t[i]=this._holes[i].copy();return new r(e,t,this._factory)},r.prototype.getExteriorRing=function(){return this._shell},r.prototype.isEmpty=function(){return this._shell.isEmpty()},r.prototype.getInteriorRingN=function(e){return this._holes[e]},r.prototype.interfaces_=function(){return[gt]},r.prototype.getClass=function(){return r},e.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(r,e),r}(b)),yt=function(i){function r(){i.apply(this,arguments)}i&&(r.__proto__=i),(r.prototype=Object.create(i&&i.prototype)).constructor=r;var e={serialVersionUID:{configurable:!0}};return r.prototype.getSortIndex=function(){return b.SORTINDEX_MULTIPOINT},r.prototype.isValid=function(){return!0},r.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return!!this.isEquivalentClass(e)&&i.prototype.equalsExact.call(this,e,t)}return i.prototype.equalsExact.apply(this,arguments)},r.prototype.getCoordinate=function(){if(1===arguments.length){var e=arguments[0];return this._geometries[e].getCoordinate()}return i.prototype.getCoordinate.apply(this,arguments)},r.prototype.getBoundaryDimension=function(){return o.FALSE},r.prototype.getDimension=function(){return 0},r.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},r.prototype.getGeometryType=function(){return"MultiPoint"},r.prototype.copy=function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new r(e,this._factory)},r.prototype.interfaces_=function(){return[ft]},r.prototype.getClass=function(){return r},e.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(r,e),r}(lt),_t=function(i){function e(e,t){e instanceof C&&t instanceof l&&(e=t.getCoordinateSequenceFactory().create(e)),i.call(this,e,t),this.validateConstruction()}i&&(e.__proto__=i),(e.prototype=Object.create(i&&i.prototype)).constructor=e;var t={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return b.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return o.FALSE},e.prototype.isClosed=function(){return!!this.isEmpty()||i.prototype.isClosed.call(this)},e.prototype.reverse=function(){var e=this._points.copy();s.reverse(e);return this.getFactory().createLinearRing(e)},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!i.prototype.isClosed.call(this))throw new A("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new A("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},t.MINIMUM_VALID_SIZE.get=function(){return 4},t.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,t),e}(B),vt=function(i){function r(){i.apply(this,arguments)}i&&(r.__proto__=i),(r.prototype=Object.create(i&&i.prototype)).constructor=r;var e={serialVersionUID:{configurable:!0}};return r.prototype.getSortIndex=function(){return b.SORTINDEX_MULTIPOLYGON},r.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return!!this.isEquivalentClass(e)&&i.prototype.equalsExact.call(this,e,t)}return i.prototype.equalsExact.apply(this,arguments)},r.prototype.getBoundaryDimension=function(){return 1},r.prototype.getDimension=function(){return 2},r.prototype.reverse=function(){for(var e=this._geometries.length,t=new Array(e).fill(null),i=0;i<this._geometries.length;i++)t[i]=this._geometries[i].reverse();return this.getFactory().createMultiPolygon(t)},r.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var e=new E,t=0;t<this._geometries.length;t++)for(var i=this._geometries[t].getBoundary(),r=0;r<i.getNumGeometries();r++)e.add(i.getGeometryN(r));var n=new Array(e.size()).fill(null);return this.getFactory().createMultiLineString(e.toArray(n))},r.prototype.getGeometryType=function(){return"MultiPolygon"},r.prototype.copy=function(){for(var e=new Array(this._geometries.length).fill(null),t=0;t<e.length;t++)e[t]=this._geometries[t].copy();return new r(e,this._factory)},r.prototype.interfaces_=function(){return[gt]},r.prototype.getClass=function(){return r},e.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(r,e),r}(lt),Ct=function(e){this._factory=e||null,this._isUserDataCopied=!1},wt={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}},xt=(Ct.prototype.setCopyUserData=function(e){this._isUserDataCopied=e},Ct.prototype.edit=function(e,t){if(null===e)return null;var i=this.editInternal(e,t);return this._isUserDataCopied&&i.setUserData(e.getUserData()),i},Ct.prototype.editInternal=function(e,t){return null===this._factory&&(this._factory=e.getFactory()),e instanceof lt?this.editGeometryCollection(e,t):e instanceof mt?this.editPolygon(e,t):e instanceof dt?t.edit(e,this._factory):e instanceof B?t.edit(e,this._factory):(w.shouldNeverReachHere("Unsupported Geometry class: "+e.getClass().getName()),null)},Ct.prototype.editGeometryCollection=function(e,t){for(var i=t.edit(e,this._factory),r=new E,n=0;n<i.getNumGeometries();n++){var o=this.edit(i.getGeometryN(n),t);null===o||o.isEmpty()||r.add(o)}return i.getClass()===yt?this._factory.createMultiPoint(r.toArray([])):i.getClass()===ut?this._factory.createMultiLineString(r.toArray([])):i.getClass()===vt?this._factory.createMultiPolygon(r.toArray([])):this._factory.createGeometryCollection(r.toArray([]))},Ct.prototype.editPolygon=function(e,t){var i=t.edit(e,this._factory);if(null===i&&(i=this._factory.createPolygon(null)),i.isEmpty())return i;var r=this.edit(i.getExteriorRing(),t);if(null===r||r.isEmpty())return this._factory.createPolygon();for(var n=new E,o=0;o<i.getNumInteriorRing();o++){var s=this.edit(i.getInteriorRingN(o),t);null===s||s.isEmpty()||n.add(s)}return this._factory.createPolygon(r,n.toArray([]))},Ct.prototype.interfaces_=function(){return[]},Ct.prototype.getClass=function(){return Ct},Ct.GeometryEditorOperation=function(){},wt.NoOpGeometryOperation.get=function(){return xt},wt.CoordinateOperation.get=function(){return bt},wt.CoordinateSequenceOperation.get=function(){return Et},Object.defineProperties(Ct,wt),function(){}),bt=(xt.prototype.edit=function(e,t){return e},xt.prototype.interfaces_=function(){return[Ct.GeometryEditorOperation]},xt.prototype.getClass=function(){return xt},function(){}),Et=(bt.prototype.edit=function(e,t){var i=this.editCoordinates(e.getCoordinates(),e);return null===i?e:e instanceof _t?t.createLinearRing(i):e instanceof B?t.createLineString(i):e instanceof dt?i.length>0?t.createPoint(i[0]):t.createPoint():e},bt.prototype.interfaces_=function(){return[Ct.GeometryEditorOperation]},bt.prototype.getClass=function(){return bt},function(){}),n=(Et.prototype.edit=function(e,t){return e instanceof _t?t.createLinearRing(this.edit(e.getCoordinateSequence(),e)):e instanceof B?t.createLineString(this.edit(e.getCoordinateSequence(),e)):e instanceof dt?t.createPoint(this.edit(e.getCoordinateSequence(),e)):e},Et.prototype.interfaces_=function(){return[Ct.GeometryEditorOperation]},Et.prototype.getClass=function(){return Et},function(){if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var e=arguments[0];this._coordinates=new Array(e).fill(null);for(var t=0;t<e;t++)this._coordinates[t]=new C}else if(_(arguments[0],f)){var i=arguments[0];if(null===i)return this._coordinates=new Array(0).fill(null),null;this._dimension=i.getDimension(),this._coordinates=new Array(i.size()).fill(null);for(var r=0;r<this._coordinates.length;r++)this._coordinates[r]=i.getCoordinateCopy(r)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var n=arguments[0],o=arguments[1];this._coordinates=n,this._dimension=o,null===n&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var s=arguments[0],a=arguments[1];this._coordinates=new Array(s).fill(null),this._dimension=a;for(var l=0;l<s;l++)this._coordinates[l]=new C}}),Bt={serialVersionUID:{configurable:!0}},Mt=(n.prototype.setOrdinate=function(e,t,i){switch(t){case f.X:this._coordinates[e].x=i;break;case f.Y:this._coordinates[e].y=i;break;case f.Z:this._coordinates[e].z=i;break;default:throw new A("invalid ordinateIndex")}},n.prototype.size=function(){return this._coordinates.length},n.prototype.getOrdinate=function(e,t){switch(t){case f.X:return this._coordinates[e].x;case f.Y:return this._coordinates[e].y;case f.Z:return this._coordinates[e].z}return y.NaN},n.prototype.getCoordinate=function(){if(1===arguments.length){var e=arguments[0];return this._coordinates[e]}if(2===arguments.length){var t=arguments[0],i=arguments[1];i.x=this._coordinates[t].x,i.y=this._coordinates[t].y,i.z=this._coordinates[t].z}},n.prototype.getCoordinateCopy=function(e){return new C(this._coordinates[e])},n.prototype.getDimension=function(){return this._dimension},n.prototype.getX=function(e){return this._coordinates[e].x},n.prototype.clone=function(){for(var e=new Array(this.size()).fill(null),t=0;t<this._coordinates.length;t++)e[t]=this._coordinates[t].clone();return new n(e,this._dimension)},n.prototype.expandEnvelope=function(e){for(var t=0;t<this._coordinates.length;t++)e.expandToInclude(this._coordinates[t]);return e},n.prototype.copy=function(){for(var e=new Array(this.size()).fill(null),t=0;t<this._coordinates.length;t++)e[t]=this._coordinates[t].copy();return new n(e,this._dimension)},n.prototype.toString=function(){if(this._coordinates.length>0){var e=new ue(17*this._coordinates.length);e.append("("),e.append(this._coordinates[0]);for(var t=1;t<this._coordinates.length;t++)e.append(", "),e.append(this._coordinates[t]);return e.append(")"),e.toString()}return"()"},n.prototype.getY=function(e){return this._coordinates[e].y},n.prototype.toCoordinateArray=function(){return this._coordinates},n.prototype.interfaces_=function(){return[f,R]},n.prototype.getClass=function(){return n},Bt.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(n,Bt),function(){}),It={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}},St=(Mt.prototype.readResolve=function(){return Mt.instance()},Mt.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];return new n(e)}if(_(arguments[0],f)){var t=arguments[0];return new n(t)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return r>3&&(r=3),r<2?new n(i):new n(i,r)}},Mt.prototype.interfaces_=function(){return[oe,R]},Mt.prototype.getClass=function(){return Mt},Mt.instance=function(){return Mt.instanceObject},It.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},It.instanceObject.get=function(){return new Mt},Object.defineProperties(Mt,It),function(e){function t(){e.call(this),this.map_=new Map}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(e){return this.map_.get(e)||null},t.prototype.put=function(e,t){return this.map_.set(e,t),t},t.prototype.values=function(){for(var e=new E,t=this.map_.values(),i=t.next();!i.done;)e.add(i.value),i=t.next();return e},t.prototype.entrySet=function(){var t=new $e;return this.map_.entries().forEach(function(e){return t.add(e)}),t},t.prototype.size=function(){return this.map_.size()},t}(Xe)),a=function e(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=e.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof Tt){var t=arguments[0];this._modelType=t,t===e.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var i=arguments[0];this._modelType=e.FIXED,this.setScale(i)}else if(arguments[0]instanceof e){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}},Pt={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}},Tt=(a.prototype.equals=function(e){if(!(e instanceof a))return!1;var t=e;return this._modelType===t._modelType&&this._scale===t._scale},a.prototype.compareTo=function(e){var t=e,i=this.getMaximumSignificantDigits(),r=t.getMaximumSignificantDigits();return new ce(i).compareTo(new ce(r))},a.prototype.getScale=function(){return this._scale},a.prototype.isFloating=function(){return this._modelType===a.FLOATING||this._modelType===a.FLOATING_SINGLE},a.prototype.getType=function(){return this._modelType},a.prototype.toString=function(){var e="UNKNOWN";return this._modelType===a.FLOATING?e="Floating":this._modelType===a.FLOATING_SINGLE?e="Floating-Single":this._modelType===a.FIXED&&(e="Fixed (Scale="+this.getScale()+")"),e},a.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var e=arguments[0];if(y.isNaN(e))return e;if(this._modelType===a.FLOATING_SINGLE)return e;return this._modelType===a.FIXED?Math.round(e*this._scale)/this._scale:e}if(arguments[0]instanceof C){var t=arguments[0];if(this._modelType===a.FLOATING)return null;t.x=this.makePrecise(t.x),t.y=this.makePrecise(t.y)}},a.prototype.getMaximumSignificantDigits=function(){var e=16;return this._modelType===a.FLOATING?e=16:this._modelType===a.FLOATING_SINGLE?e=6:this._modelType===a.FIXED&&(e=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),e},a.prototype.setScale=function(e){this._scale=Math.abs(e)},a.prototype.interfaces_=function(){return[R,ee]},a.prototype.getClass=function(){return a},a.mostPrecise=function(e,t){return e.compareTo(t)>=0?e:t},Pt.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},Pt.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(a,Pt),function e(t){this._name=t||null,e.nameToTypeMap.put(t,this)}),Lt={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}},l=(Tt.prototype.readResolve=function(){return Tt.nameToTypeMap.get(this._name)},Tt.prototype.toString=function(){return this._name},Tt.prototype.interfaces_=function(){return[R]},Tt.prototype.getClass=function(){return Tt},Lt.serialVersionUID.get=function(){return-552860263173159e4},Lt.nameToTypeMap.get=function(){return new St},Object.defineProperties(Tt,Lt),a.Type=Tt,a.FIXED=new Tt("FIXED"),a.FLOATING=new Tt("FLOATING"),a.FLOATING_SINGLE=new Tt("FLOATING SINGLE"),function e(){this._precisionModel=new a,this._SRID=0,this._coordinateSequenceFactory=e.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?_(arguments[0],oe)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof a&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))}),Dt={serialVersionUID:{configurable:!0}},Ft=(l.prototype.toGeometry=function(e){return e.isNull()?this.createPoint(null):e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new C(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new C(e.getMinX(),e.getMinY()),new C(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new C(e.getMinX(),e.getMinY()),new C(e.getMinX(),e.getMaxY()),new C(e.getMaxX(),e.getMaxY()),new C(e.getMaxX(),e.getMinY()),new C(e.getMinX(),e.getMinY())]),null)},l.prototype.createLineString=function(e){return e?e instanceof Array?new B(this.getCoordinateSequenceFactory().create(e),this):_(e,f)?new B(e,this):void 0:new B(this.getCoordinateSequenceFactory().create([]),this)},l.prototype.createMultiLineString=function(){if(0===arguments.length)return new ut(null,this);if(1===arguments.length){var e=arguments[0];return new ut(e,this)}},l.prototype.buildGeometry=function(e){for(var t=null,i=!1,r=!1,n=e.iterator();n.hasNext();){var o=n.next(),s=o.getClass();null===t&&(t=s),s!==t&&(i=!0),o.isGeometryCollectionOrDerived()&&(r=!0)}if(null===t)return this.createGeometryCollection();if(i||r)return this.createGeometryCollection(l.toGeometryArray(e));var a=e.iterator().next();if(e.size()>1){if(a instanceof mt)return this.createMultiPolygon(l.toPolygonArray(e));if(a instanceof B)return this.createMultiLineString(l.toLineStringArray(e));if(a instanceof dt)return this.createMultiPoint(l.toPointArray(e));w.shouldNeverReachHere("Unhandled class: "+a.getClass().getName())}return a},l.prototype.createMultiPointFromCoords=function(e){return this.createMultiPoint(null!==e?this.getCoordinateSequenceFactory().create(e):null)},l.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof C){var e=arguments[0];return this.createPoint(null!==e?this.getCoordinateSequenceFactory().create([e]):null)}if(_(arguments[0],f)){var t=arguments[0];return new dt(t,this)}}},l.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},l.prototype.createPolygon=function(){if(0===arguments.length)return new mt(null,null,this);if(1===arguments.length){if(_(arguments[0],f)){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof Array){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof _t){var i=arguments[0];return this.createPolygon(i,null)}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];return new mt(r,n,this)}},l.prototype.getSRID=function(){return this._SRID},l.prototype.createGeometryCollection=function(){if(0===arguments.length)return new lt(null,this);if(1===arguments.length){var e=arguments[0];return new lt(e,this)}},l.prototype.createGeometry=function(e){return new Ct(this).edit(e,{edit:function(){if(2===arguments.length){var e=arguments[0];return this._coordinateSequenceFactory.create(e)}}})},l.prototype.getPrecisionModel=function(){return this._precisionModel},l.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(null!==e?this.getCoordinateSequenceFactory().create(e):null)}if(_(arguments[0],f)){var t=arguments[0];return new _t(t,this)}}},l.prototype.createMultiPolygon=function(){if(0===arguments.length)return new vt(null,this);if(1===arguments.length){var e=arguments[0];return new vt(e,this)}},l.prototype.createMultiPoint=function(){if(0===arguments.length)return new yt(null,this);if(1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];return new yt(e,this)}if(arguments[0]instanceof Array){var t=arguments[0];return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(_(arguments[0],f)){var i=arguments[0];if(null===i)return this.createMultiPoint(new Array(0).fill(null));for(var r=new Array(i.size()).fill(null),n=0;n<i.size();n++){var o=this.getCoordinateSequenceFactory().create(1,i.getDimension());s.copy(i,n,o,0,1),r[n]=this.createPoint(o)}return this.createMultiPoint(r)}}},l.prototype.interfaces_=function(){return[R]},l.prototype.getClass=function(){return l},l.toMultiPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},l.toGeometryArray=function(e){if(null===e)return null;var t=new Array(e.size()).fill(null);return e.toArray(t)},l.getDefaultCoordinateSequenceFactory=function(){return Mt.instance()},l.toMultiLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},l.toLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},l.toMultiPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},l.toLinearRingArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},l.toPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},l.toPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)},l.createPointFromInternalCoord=function(e,t){return t.getPrecisionModel().makePrecise(e),t.getFactory().createPoint(e)},Dt.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(l,Dt),["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"]),Nt=function(e){this.geometryFactory=e||new l},Ot=(Nt.prototype.read=function(e){var t,i=(t="string"==typeof e?JSON.parse(e):e).type;if(!Ot[i])throw new Error("Unknown GeoJSON type: "+t.type);return-1!==Ft.indexOf(i)?Ot[i].apply(this,[t.coordinates]):"GeometryCollection"===i?Ot[i].apply(this,[t.geometries]):Ot[i].apply(this,[t])},Nt.prototype.write=function(e){var t=e.getGeometryType();if(!Rt[t])throw new Error("Geometry is not supported");return Rt[t].apply(this,[e])},{Feature:function(e){var t={};for(var i in e)t[i]=e[i];if(e.geometry){var r=e.geometry.type;if(!Ot[r])throw new Error("Unknown GeoJSON type: "+e.type);t.geometry=this.read(e.geometry)}return e.bbox&&(t.bbox=Ot.bbox.apply(this,[e.bbox])),t},FeatureCollection:function(e){var t={};if(e.features){t.features=[];for(var i=0;i<e.features.length;++i)t.features.push(this.read(e.features[i]))}return e.bbox&&(t.bbox=this.parse.bbox.apply(this,[e.bbox])),t},coordinates:function(e){for(var t=[],i=0;i<e.length;++i){var r=e[i];t.push(new C(r[0],r[1]))}return t},bbox:function(e){return this.geometryFactory.createLinearRing([new C(e[0],e[1]),new C(e[2],e[1]),new C(e[2],e[3]),new C(e[0],e[3]),new C(e[0],e[1])])},Point:function(e){var t=new C(e[0],e[1]);return this.geometryFactory.createPoint(t)},MultiPoint:function(e){for(var t=[],i=0;i<e.length;++i)t.push(Ot.Point.apply(this,[e[i]]));return this.geometryFactory.createMultiPoint(t)},LineString:function(e){var t=Ot.coordinates.apply(this,[e]);return this.geometryFactory.createLineString(t)},MultiLineString:function(e){for(var t=[],i=0;i<e.length;++i)t.push(Ot.LineString.apply(this,[e[i]]));return this.geometryFactory.createMultiLineString(t)},Polygon:function(e){for(var t=Ot.coordinates.apply(this,[e[0]]),i=this.geometryFactory.createLinearRing(t),r=[],n=1;n<e.length;++n){var o=e[n],s=Ot.coordinates.apply(this,[o]),a=this.geometryFactory.createLinearRing(s);r.push(a)}return this.geometryFactory.createPolygon(i,r)},MultiPolygon:function(e){for(var t=[],i=0;i<e.length;++i){var r=e[i];t.push(Ot.Polygon.apply(this,[r]))}return this.geometryFactory.createMultiPolygon(t)},GeometryCollection:function(e){for(var t=[],i=0;i<e.length;++i){var r=e[i];t.push(this.read(r))}return this.geometryFactory.createGeometryCollection(t)}}),Rt={coordinate:function(e){return[e.x,e.y]},Point:function(e){return{type:"Point",coordinates:Rt.coordinate.apply(this,[e.getCoordinate()])}},MultiPoint:function(e){for(var t=[],i=0;i<e._geometries.length;++i){var r=e._geometries[i],n=Rt.Point.apply(this,[r]);t.push(n.coordinates)}return{type:"MultiPoint",coordinates:t}},LineString:function(e){for(var t=[],i=e.getCoordinates(),r=0;r<i.length;++r){var n=i[r];t.push(Rt.coordinate.apply(this,[n]))}return{type:"LineString",coordinates:t}},MultiLineString:function(e){for(var t=[],i=0;i<e._geometries.length;++i){var r=e._geometries[i],n=Rt.LineString.apply(this,[r]);t.push(n.coordinates)}return{type:"MultiLineString",coordinates:t}},Polygon:function(e){var t=[],i=Rt.LineString.apply(this,[e._shell]);t.push(i.coordinates);for(var r=0;r<e._holes.length;++r){var n=e._holes[r],o=Rt.LineString.apply(this,[n]);t.push(o.coordinates)}return{type:"Polygon",coordinates:t}},MultiPolygon:function(e){for(var t=[],i=0;i<e._geometries.length;++i){var r=e._geometries[i],n=Rt.Polygon.apply(this,[r]);t.push(n.coordinates)}return{type:"MultiPolygon",coordinates:t}},GeometryCollection:function(e){for(var t=[],i=0;i<e._geometries.length;++i){var r=e._geometries[i],n=r.getGeometryType();t.push(Rt[n].apply(this,[r]))}return{type:"GeometryCollection",geometries:t}}},Ut=function(e){this.geometryFactory=e||new l,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new Nt(this.geometryFactory)},kt=(Ut.prototype.read=function(e){var t=this.parser.read(e);return this.precisionModel.getType()===a.FIXED&&this.reducePrecision(t),t},Ut.prototype.reducePrecision=function(e){var t,i;if(e.coordinate)this.precisionModel.makePrecise(e.coordinate);else if(e.points)for(t=0,i=e.points.length;t<i;t++)this.precisionModel.makePrecise(e.points[t]);else if(e.geometries)for(t=0,i=e.geometries.length;t<i;t++)this.reducePrecision(e.geometries[t])},function(){this.parser=new Nt(this.geometryFactory)}),m=(kt.prototype.write=function(e){return this.parser.write(e)},function(){}),Ht={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}},Qt=(m.prototype.interfaces_=function(){return[]},m.prototype.getClass=function(){return m},m.opposite=function(e){return e===m.LEFT?m.RIGHT:e===m.RIGHT?m.LEFT:e},Ht.ON.get=function(){return 0},Ht.LEFT.get=function(){return 1},Ht.RIGHT.get=function(){return 2},Object.defineProperties(m,Ht),(Y.prototype=new Error).name="EmptyStackException",(X.prototype=new We).add=function(e){return this.array_.push(e),!0},X.prototype.get=function(e){if(e<0||e>=this.size())throw new Error;return this.array_[e]},X.prototype.push=function(e){return this.array_.push(e),e},X.prototype.pop=function(e){if(0===this.array_.length)throw new Y;return this.array_.pop()},X.prototype.peek=function(){if(0===this.array_.length)throw new Y;return this.array_[this.array_.length-1]},X.prototype.empty=function(){return 0===this.array_.length},X.prototype.isEmpty=function(){return this.empty()},X.prototype.search=function(e){return this.array_.indexOf(e)},X.prototype.size=function(){return this.array_.length},X.prototype.toArray=function(){for(var e=[],t=0,i=this.array_.length;t<i;t++)e.push(this.array_[t]);return e},function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}),Vt=(Qt.prototype.getCoordinate=function(){return this._minCoord},Qt.prototype.getRightmostSide=function(e,t){var i=this.getRightmostSideOfSegment(e,t);return i<0&&(i=this.getRightmostSideOfSegment(e,t-1)),i<0&&(this._minCoord=null,this.checkForRightmostCoordinate(e)),i},Qt.prototype.findRightmostEdgeAtVertex=function(){var e=this._minDe.getEdge().getCoordinates();w.isTrue(this._minIndex>0&&this._minIndex<e.length,"rightmost point expected to be interior vertex of edge");var t=e[this._minIndex-1],i=e[this._minIndex+1],r=x.computeOrientation(this._minCoord,i,t),n=!1;t.y<this._minCoord.y&&i.y<this._minCoord.y&&r===x.COUNTERCLOCKWISE?n=!0:t.y>this._minCoord.y&&i.y>this._minCoord.y&&r===x.CLOCKWISE&&(n=!0),n&&(this._minIndex=this._minIndex-1)},Qt.prototype.getRightmostSideOfSegment=function(e,t){var i=e.getEdge().getCoordinates();if(t<0||t+1>=i.length)return-1;if(i[t].y===i[t+1].y)return-1;var r=m.LEFT;return i[t].y<i[t+1].y&&(r=m.RIGHT),r},Qt.prototype.getEdge=function(){return this._orientedDe},Qt.prototype.checkForRightmostCoordinate=function(e){for(var t=e.getEdge().getCoordinates(),i=0;i<t.length-1;i++)(null===this._minCoord||t[i].x>this._minCoord.x)&&(this._minDe=e,this._minIndex=i,this._minCoord=t[i])},Qt.prototype.findRightmostEdgeAtNode=function(){var e=this._minDe.getNode().getEdges();this._minDe=e.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},Qt.prototype.findEdge=function(e){for(var t=e.iterator();t.hasNext();){var i=t.next();i.isForward()&&this.checkForRightmostCoordinate(i)}w.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;this.getRightmostSide(this._minDe,this._minIndex)===m.LEFT&&(this._orientedDe=this._minDe.getSym())},Qt.prototype.interfaces_=function(){return[]},Qt.prototype.getClass=function(){return Qt},function(i){function r(e,t){i.call(this,r.msgWithCoord(e,t)),this.pt=t?new C(t):null,this.name="TopologyException"}return i&&(r.__proto__=i),r.prototype=Object.create(i&&i.prototype),r.prototype.constructor=r,r.prototype.getCoordinate=function(){return this.pt},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r.msgWithCoord=function(e,t){return t?e:e+" [ "+t+" ]"},r}(Be)),Gt=function(){this.array_=[]},zt=(Gt.prototype.addLast=function(e){this.array_.push(e)},Gt.prototype.removeFirst=function(){return this.array_.shift()},Gt.prototype.isEmpty=function(){return 0===this.array_.length},function(){this._finder=null,this._dirEdgeList=new E,this._nodes=new E,this._rightMostCoord=null,this._env=null,this._finder=new Qt}),p=(zt.prototype.clearVisitedEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();)e.next().setVisited(!1)},zt.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},zt.prototype.computeNodeDepth=function(e){for(var t=null,i=e.getEdges().iterator();i.hasNext();){var r=i.next();if(r.isVisited()||r.getSym().isVisited()){t=r;break}}if(null===t)throw new Vt("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(t);for(var n=e.getEdges().iterator();n.hasNext();){var o=n.next();o.setVisited(!0),this.copySymDepths(o)}},zt.prototype.computeDepth=function(e){this.clearVisitedEdges();var t=this._finder.getEdge();t.setEdgeDepths(m.RIGHT,e),this.copySymDepths(t),this.computeDepths(t)},zt.prototype.create=function(e){this.addReachable(e),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},zt.prototype.findResultEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.getDepth(m.RIGHT)>=1&&t.getDepth(m.LEFT)<=0&&!t.isInteriorAreaEdge()&&t.setInResult(!0)}},zt.prototype.computeDepths=function(e){var t=new $e,i=new Gt,r=e.getNode();for(i.addLast(r),t.add(r),e.setVisited(!0);!i.isEmpty();){var n=i.removeFirst();t.add(n),this.computeNodeDepth(n);for(var o=n.getEdges().iterator();o.hasNext();){var s=o.next().getSym();if(!s.isVisited()){var a=s.getNode();t.contains(a)||(i.addLast(a),t.add(a))}}}},zt.prototype.compareTo=function(e){var t=e;return this._rightMostCoord.x<t._rightMostCoord.x?-1:this._rightMostCoord.x>t._rightMostCoord.x?1:0},zt.prototype.getEnvelope=function(){if(null===this._env){for(var e=new u,t=this._dirEdgeList.iterator();t.hasNext();)for(var i=t.next().getEdge().getCoordinates(),r=0;r<i.length-1;r++)e.expandToInclude(i[r]);this._env=e}return this._env},zt.prototype.addReachable=function(e){var t=new X;for(t.add(e);!t.empty();){var i=t.pop();this.add(i,t)}},zt.prototype.copySymDepths=function(e){var t=e.getSym();t.setDepth(m.LEFT,e.getDepth(m.RIGHT)),t.setDepth(m.RIGHT,e.getDepth(m.LEFT))},zt.prototype.add=function(e,t){e.setVisited(!0),this._nodes.add(e);for(var i=e.getEdges().iterator();i.hasNext();){var r=i.next();this._dirEdgeList.add(r);var n=r.getSym().getNode();n.isVisited()||t.push(n)}},zt.prototype.getNodes=function(){return this._nodes},zt.prototype.getDirectedEdges=function(){return this._dirEdgeList},zt.prototype.interfaces_=function(){return[ee]},zt.prototype.getClass=function(){return zt},function e(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];this.init(t.length)}else if(Number.isInteger(arguments[0])){var i=arguments[0];this.init(1),this.location[m.ON]=i}else if(arguments[0]instanceof e){var r=arguments[0];if(this.init(r.location.length),null!==r)for(var n=0;n<this.location.length;n++)this.location[n]=r.location[n]}}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.init(3),this.location[m.ON]=o,this.location[m.LEFT]=s,this.location[m.RIGHT]=a}}),h=(p.prototype.setAllLocations=function(e){for(var t=0;t<this.location.length;t++)this.location[t]=e},p.prototype.isNull=function(){for(var e=0;e<this.location.length;e++)if(this.location[e]!==g.NONE)return!1;return!0},p.prototype.setAllLocationsIfNull=function(e){for(var t=0;t<this.location.length;t++)this.location[t]===g.NONE&&(this.location[t]=e)},p.prototype.isLine=function(){return 1===this.location.length},p.prototype.merge=function(e){if(e.location.length>this.location.length){var t=new Array(3).fill(null);t[m.ON]=this.location[m.ON],t[m.LEFT]=g.NONE,t[m.RIGHT]=g.NONE,this.location=t}for(var i=0;i<this.location.length;i++)this.location[i]===g.NONE&&i<e.location.length&&(this.location[i]=e.location[i])},p.prototype.getLocations=function(){return this.location},p.prototype.flip=function(){if(this.location.length<=1)return null;var e=this.location[m.LEFT];this.location[m.LEFT]=this.location[m.RIGHT],this.location[m.RIGHT]=e},p.prototype.toString=function(){var e=new ue;return this.location.length>1&&e.append(g.toLocationSymbol(this.location[m.LEFT])),e.append(g.toLocationSymbol(this.location[m.ON])),this.location.length>1&&e.append(g.toLocationSymbol(this.location[m.RIGHT])),e.toString()},p.prototype.setLocations=function(e,t,i){this.location[m.ON]=e,this.location[m.LEFT]=t,this.location[m.RIGHT]=i},p.prototype.get=function(e){return e<this.location.length?this.location[e]:g.NONE},p.prototype.isArea=function(){return this.location.length>1},p.prototype.isAnyNull=function(){for(var e=0;e<this.location.length;e++)if(this.location[e]===g.NONE)return!0;return!1},p.prototype.setLocation=function(){if(1===arguments.length){var e=arguments[0];this.setLocation(m.ON,e)}else if(2===arguments.length){var t=arguments[0],i=arguments[1];this.location[t]=i}},p.prototype.init=function(e){this.location=new Array(e).fill(null),this.setAllLocations(g.NONE)},p.prototype.isEqualOnSide=function(e,t){return this.location[t]===e.location[t]},p.prototype.allPositionsEqual=function(e){for(var t=0;t<this.location.length;t++)if(this.location[t]!==e)return!1;return!0},p.prototype.interfaces_=function(){return[]},p.prototype.getClass=function(){return p},function e(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new p(t),this.elt[1]=new p(t)}else if(arguments[0]instanceof e){var i=arguments[0];this.elt[0]=new p(i.elt[0]),this.elt[1]=new p(i.elt[1])}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this.elt[0]=new p(g.NONE),this.elt[1]=new p(g.NONE),this.elt[r].setLocation(n)}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.elt[0]=new p(o,s,a),this.elt[1]=new p(o,s,a)}else if(4===arguments.length){var l=arguments[0],u=arguments[1],c=arguments[2],h=arguments[3];this.elt[0]=new p(g.NONE,g.NONE,g.NONE),this.elt[1]=new p(g.NONE,g.NONE,g.NONE),this.elt[l].setLocations(u,c,h)}}),e=(h.prototype.getGeometryCount=function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e},h.prototype.setAllLocations=function(e,t){this.elt[e].setAllLocations(t)},h.prototype.isNull=function(e){return this.elt[e].isNull()},h.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(2===arguments.length){var t=arguments[0],i=arguments[1];this.elt[t].setAllLocationsIfNull(i)}},h.prototype.isLine=function(e){return this.elt[e].isLine()},h.prototype.merge=function(e){for(var t=0;t<2;t++)null===this.elt[t]&&null!==e.elt[t]?this.elt[t]=new p(e.elt[t]):this.elt[t].merge(e.elt[t])},h.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},h.prototype.getLocation=function(){if(1===arguments.length){var e=arguments[0];return this.elt[e].get(m.ON)}if(2===arguments.length){var t=arguments[0],i=arguments[1];return this.elt[t].get(i)}},h.prototype.toString=function(){var e=new ue;return null!==this.elt[0]&&(e.append("A:"),e.append(this.elt[0].toString())),null!==this.elt[1]&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()},h.prototype.isArea=function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var e=arguments[0];return this.elt[e].isArea()}},h.prototype.isAnyNull=function(e){return this.elt[e].isAnyNull()},h.prototype.setLocation=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];this.elt[e].setLocation(m.ON,t)}else if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2];this.elt[i].setLocation(r,n)}},h.prototype.isEqualOnSide=function(e,t){return this.elt[0].isEqualOnSide(e.elt[0],t)&&this.elt[1].isEqualOnSide(e.elt[1],t)},h.prototype.allPositionsEqual=function(e,t){return this.elt[e].allPositionsEqual(t)},h.prototype.toLine=function(e){this.elt[e].isArea()&&(this.elt[e]=new p(this.elt[e].location[0]))},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.toLineLabel=function(e){for(var t=new h(g.NONE),i=0;i<2;i++)t.setLocation(i,e.getLocation(i));return t},function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new E,this._pts=new E,this._label=new h(g.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new E,this._geometryFactory=null;var e=arguments[0],t=arguments[1];this._geometryFactory=t,this.computePoints(e),this.computeRing()}),Wt=(e.prototype.computeRing=function(){if(null!==this._ring)return null;for(var e=new Array(this._pts.size()).fill(null),t=0;t<this._pts.size();t++)e[t]=this._pts.get(t);this._ring=this._geometryFactory.createLinearRing(e),this._isHole=x.isCCW(this._ring.getCoordinates())},e.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},e.prototype.computePoints=function(e){this._startDe=e;var t=e,i=!0;do{if(null===t)throw new Vt("Found null DirectedEdge");if(t.getEdgeRing()===this)throw new Vt("Directed Edge visited twice during ring-building at "+t.getCoordinate());this._edges.add(t);var r=t.getLabel();w.isTrue(r.isArea()),this.mergeLabel(r),this.addPoints(t.getEdge(),t.isForward(),i),i=!1,this.setEdgeRing(t,this),t=this.getNext(t)}while(t!==this._startDe)},e.prototype.getLinearRing=function(){return this._ring},e.prototype.getCoordinate=function(e){return this._pts.get(e)},e.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var e=this._startDe;do{var t=e.getNode().getEdges().getOutgoingDegree(this);t>this._maxNodeDegree&&(this._maxNodeDegree=t),e=this.getNext(e)}while(e!==this._startDe);this._maxNodeDegree*=2},e.prototype.addPoints=function(e,t,i){var r=e.getCoordinates();if(t){var n=1;i&&(n=0);for(var o=n;o<r.length;o++)this._pts.add(r[o])}else{var s=r.length-2;i&&(s=r.length-1);for(var a=s;a>=0;a--)this._pts.add(r[a])}},e.prototype.isHole=function(){return this._isHole},e.prototype.setInResult=function(){var e=this._startDe;do{e.getEdge().setInResult(!0),e=e.getNext()}while(e!==this._startDe)},e.prototype.containsPoint=function(e){var t=this.getLinearRing();if(!t.getEnvelopeInternal().contains(e))return!1;if(!x.isPointInRing(e,t.getCoordinates()))return!1;for(var i=this._holes.iterator();i.hasNext();)if(i.next().containsPoint(e))return!1;return!0},e.prototype.addHole=function(e){this._holes.add(e)},e.prototype.isShell=function(){return null===this._shell},e.prototype.getLabel=function(){return this._label},e.prototype.getEdges=function(){return this._edges},e.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},e.prototype.getShell=function(){return this._shell},e.prototype.mergeLabel=function(){if(1===arguments.length){var e=arguments[0];this.mergeLabel(e,0),this.mergeLabel(e,1)}else if(2===arguments.length){var t=arguments[0],i=arguments[1],r=t.getLocation(i,m.RIGHT);if(r===g.NONE)return null;if(this._label.getLocation(i)===g.NONE)return this._label.setLocation(i,r),null}},e.prototype.setShell=function(e){this._shell=e,null!==e&&e.addHole(this)},e.prototype.toPolygon=function(e){for(var t=new Array(this._holes.size()).fill(null),i=0;i<this._holes.size();i++)t[i]=this._holes.get(i).getLinearRing();return e.createPolygon(this.getLinearRing(),t)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},function(i){function e(){var e=arguments[0],t=arguments[1];i.call(this,e,t)}return i&&(e.__proto__=i),e.prototype=Object.create(i&&i.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(e,t){e.setMinEdgeRing(t)},e.prototype.getNext=function(e){return e.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(e)),qt=function(i){function e(){var e=arguments[0],t=arguments[1];i.call(this,e,t)}return i&&(e.__proto__=i),e.prototype=Object.create(i&&i.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var e=new E,t=this._startDe;do{if(null===t.getMinEdgeRing()){var i=new Wt(t,this._geometryFactory);e.add(i)}t=t.getNext()}while(t!==this._startDe);return e},e.prototype.setEdgeRing=function(e,t){e.setEdgeRing(t)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var e=this._startDe;do{e.getNode().getEdges().linkMinimalDirectedEdges(this),e=e.getNext()}while(e!==this._startDe)},e.prototype.getNext=function(e){return e.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(e),Kt=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this._label=e}},jt=(Kt.prototype.setVisited=function(e){this._isVisited=e},Kt.prototype.setInResult=function(e){this._isInResult=e},Kt.prototype.isCovered=function(){return this._isCovered},Kt.prototype.isCoveredSet=function(){return this._isCoveredSet},Kt.prototype.setLabel=function(e){this._label=e},Kt.prototype.getLabel=function(){return this._label},Kt.prototype.setCovered=function(e){this._isCovered=e,this._isCoveredSet=!0},Kt.prototype.updateIM=function(e){w.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(e)},Kt.prototype.isInResult=function(){return this._isInResult},Kt.prototype.isVisited=function(){return this._isVisited},Kt.prototype.interfaces_=function(){return[]},Kt.prototype.getClass=function(){return Kt},function(i){function n(){i.call(this),this._coord=null,this._edges=null;var e=arguments[0],t=arguments[1];this._coord=e,this._edges=t,this._label=new h(0,g.NONE)}return i&&(n.__proto__=i),n.prototype=Object.create(i&&i.prototype),n.prototype.constructor=n,n.prototype.isIncidentEdgeInResult=function(){for(var e=this.getEdges().getEdges().iterator();e.hasNext();)if(e.next().getEdge().isInResult())return!0;return!1},n.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},n.prototype.getCoordinate=function(){return this._coord},n.prototype.print=function(e){e.println("node "+this._coord+" lbl: "+this._label)},n.prototype.computeIM=function(e){},n.prototype.computeMergedLocation=function(e,t){var i=g.NONE;if(i=this._label.getLocation(t),!e.isNull(t)){var r=e.getLocation(t);i!==g.BOUNDARY&&(i=r)}return i},n.prototype.setLabel=function(){if(2!==arguments.length)return i.prototype.setLabel.apply(this,arguments);var e=arguments[0],t=arguments[1];null===this._label?this._label=new h(e,t):this._label.setLocation(e,t)},n.prototype.getEdges=function(){return this._edges},n.prototype.mergeLabel=function(){if(arguments[0]instanceof n){var e=arguments[0];this.mergeLabel(e._label)}else if(arguments[0]instanceof h)for(var t=arguments[0],i=0;i<2;i++){var r=this.computeMergedLocation(t,i);this._label.getLocation(i)===g.NONE&&this._label.setLocation(i,r)}},n.prototype.add=function(e){this._edges.insert(e),e.setNode(this)},n.prototype.setLabelBoundary=function(e){if(null===this._label)return null;var t=g.NONE;null!==this._label&&(t=this._label.getLocation(e));var i=null;switch(t){case g.BOUNDARY:i=g.INTERIOR;break;case g.INTERIOR:default:i=g.BOUNDARY}this._label.setLocation(e,i)},n.prototype.interfaces_=function(){return[]},n.prototype.getClass=function(){return n},n}(Kt)),Zt=function(){this.nodeMap=new q,this.nodeFact=null;var e=arguments[0];this.nodeFact=e},d=(Zt.prototype.find=function(e){return this.nodeMap.get(e)},Zt.prototype.addNode=function(){if(arguments[0]instanceof C){var e=arguments[0],t=this.nodeMap.get(e);return null===t&&(t=this.nodeFact.createNode(e),this.nodeMap.put(e,t)),t}if(arguments[0]instanceof jt){var i=arguments[0],r=this.nodeMap.get(i.getCoordinate());return null===r?(this.nodeMap.put(i.getCoordinate(),i),i):(r.mergeLabel(i),r)}},Zt.prototype.print=function(e){for(var t=this.iterator();t.hasNext();)t.next().print(e)},Zt.prototype.iterator=function(){return this.nodeMap.values().iterator()},Zt.prototype.values=function(){return this.nodeMap.values()},Zt.prototype.getBoundaryNodes=function(e){for(var t=new E,i=this.iterator();i.hasNext();){var r=i.next();r.getLabel().getLocation(e)===g.BOUNDARY&&t.add(r)}return t},Zt.prototype.add=function(e){var t=e.getCoordinate();this.addNode(t).add(e)},Zt.prototype.interfaces_=function(){return[]},Zt.prototype.getClass=function(){return Zt},function(){}),Yt={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}},Xt=(d.prototype.interfaces_=function(){return[]},d.prototype.getClass=function(){return d},d.isNorthern=function(e){return e===d.NE||e===d.NW},d.isOpposite=function(e,t){if(e===t)return!1;return 2===(e-t+4)%4},d.commonHalfPlane=function(e,t){if(e===t)return e;if(2===(e-t+4)%4)return-1;var i=e<t?e:t;return 0===i&&3===(e>t?e:t)?3:i},d.isInHalfPlane=function(e,t){return t===d.SE?e===d.SE||e===d.SW:e===t||e===t+1},d.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var e=arguments[0],t=arguments[1];if(0===e&&0===t)throw new A("Cannot compute the quadrant for point ( "+e+", "+t+" )");return e>=0?t>=0?d.NE:d.SE:t>=0?d.NW:d.SW}if(arguments[0]instanceof C&&arguments[1]instanceof C){var i=arguments[0],r=arguments[1];if(r.x===i.x&&r.y===i.y)throw new A("Cannot compute the quadrant for two identical points "+i);return r.x>=i.x?r.y>=i.y?d.NE:d.SE:r.y>=i.y?d.NW:d.SW}},Yt.NE.get=function(){return 0},Yt.NW.get=function(){return 1},Yt.SW.get=function(){return 2},Yt.SE.get=function(){return 3},Object.defineProperties(d,Yt),function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length){var e=arguments[0];this._edge=e}else if(3===arguments.length){var t=arguments[0],i=arguments[1],r=arguments[2];this._edge=t,this.init(i,r),this._label=null}else if(4===arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];this._edge=n,this.init(o,s),this._label=a}}),Jt=(Xt.prototype.compareDirection=function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:x.computeOrientation(e._p0,e._p1,this._p1)},Xt.prototype.getDy=function(){return this._dy},Xt.prototype.getCoordinate=function(){return this._p0},Xt.prototype.setNode=function(e){this._node=e},Xt.prototype.print=function(e){var t=Math.atan2(this._dy,this._dx),i=this.getClass().getName(),r=i.lastIndexOf("."),n=i.substring(r+1);e.print("  "+n+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label)},Xt.prototype.compareTo=function(e){var t=e;return this.compareDirection(t)},Xt.prototype.getDirectedCoordinate=function(){return this._p1},Xt.prototype.getDx=function(){return this._dx},Xt.prototype.getLabel=function(){return this._label},Xt.prototype.getEdge=function(){return this._edge},Xt.prototype.getQuadrant=function(){return this._quadrant},Xt.prototype.getNode=function(){return this._node},Xt.prototype.toString=function(){var e=Math.atan2(this._dy,this._dx),t=this.getClass().getName(),i=t.lastIndexOf(".");return"  "+t.substring(i+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label},Xt.prototype.computeLabel=function(e){},Xt.prototype.init=function(e,t){this._p0=e,this._p1=t,this._dx=t.x-e.x,this._dy=t.y-e.y,this._quadrant=d.quadrant(this._dx,this._dy),w.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},Xt.prototype.interfaces_=function(){return[ee]},Xt.prototype.getClass=function(){return Xt},function(r){function e(){var e=arguments[0],t=arguments[1];if(r.call(this,e),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=t,t)this.init(e.getCoordinate(0),e.getCoordinate(1));else{var i=e.getNumPoints()-1;this.init(e.getCoordinate(i),e.getCoordinate(i-1))}this.computeDirectedLabel()}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(e){return this._depth[e]},e.prototype.setVisited=function(e){this._isVisited=e},e.prototype.computeDirectedLabel=function(){this._label=new h(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(e,t){if(-999!==this._depth[e]&&this._depth[e]!==t)throw new Vt("assigned depths do not match",this.getCoordinate());this._depth[e]=t},e.prototype.isInteriorAreaEdge=function(){for(var e=!0,t=0;t<2;t++)this._label.isArea(t)&&this._label.getLocation(t,m.LEFT)===g.INTERIOR&&this._label.getLocation(t,m.RIGHT)===g.INTERIOR||(e=!1);return e},e.prototype.setNextMin=function(e){this._nextMin=e},e.prototype.print=function(e){r.prototype.print.call(this,e),e.print(" "+this._depth[m.LEFT]+"/"+this._depth[m.RIGHT]),e.print(" ("+this.getDepthDelta()+")"),this._isInResult&&e.print(" inResult")},e.prototype.setMinEdgeRing=function(e){this._minEdgeRing=e},e.prototype.isLineEdge=function(){var e=this._label.isLine(0)||this._label.isLine(1),t=!this._label.isArea(0)||this._label.allPositionsEqual(0,g.EXTERIOR),i=!this._label.isArea(1)||this._label.allPositionsEqual(1,g.EXTERIOR);return e&&t&&i},e.prototype.setEdgeRing=function(e){this._edgeRing=e},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var e=this._edge.getDepthDelta();return this._isForward||(e=-e),e},e.prototype.setInResult=function(e){this._isInResult=e},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(e){this.print(e),e.print(" "),this._isForward?this._edge.print(e):this._edge.printReverse(e)},e.prototype.setSym=function(e){this._sym=e},e.prototype.setVisitedEdge=function(e){this.setVisited(e),this._sym.setVisited(e)},e.prototype.setEdgeDepths=function(e,t){var i=this.getEdge().getDepthDelta();this._isForward||(i=-i);var r=1;e===m.LEFT&&(r=-1);var n=m.opposite(e),o=t+i*r;this.setDepth(e,t),this.setDepth(n,o)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(e){this._next=e},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(e,t){return e===g.EXTERIOR&&t===g.INTERIOR?1:e===g.INTERIOR&&t===g.EXTERIOR?-1:0},e}(Xt)),$t=function(){},M=($t.prototype.createNode=function(e){return new jt(e,null)},$t.prototype.interfaces_=function(){return[]},$t.prototype.getClass=function(){return $t},function(){if(this._edges=new E,this._nodes=null,this._edgeEndList=new E,0===arguments.length)this._nodes=new Zt(new $t);else if(1===arguments.length){var e=arguments[0];this._nodes=new Zt(e)}}),ei=(M.prototype.printEdges=function(e){e.println("Edges:");for(var t=0;t<this._edges.size();t++){e.println("edge "+t+":");var i=this._edges.get(t);i.print(e),i.eiList.print(e)}},M.prototype.find=function(e){return this._nodes.find(e)},M.prototype.addNode=function(){if(arguments[0]instanceof jt){var e=arguments[0];return this._nodes.addNode(e)}if(arguments[0]instanceof C){var t=arguments[0];return this._nodes.addNode(t)}},M.prototype.getNodeIterator=function(){return this._nodes.iterator()},M.prototype.linkResultDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()},M.prototype.debugPrintln=function(e){ye.out.println(e)},M.prototype.isBoundaryNode=function(e,t){var i=this._nodes.find(t);if(null===i)return!1;var r=i.getLabel();return null!==r&&r.getLocation(e)===g.BOUNDARY},M.prototype.linkAllDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();)e.next().getEdges().linkAllDirectedEdges()},M.prototype.matchInSameDirection=function(e,t,i,r){return!!e.equals(i)&&(x.computeOrientation(e,t,r)===x.COLLINEAR&&d.quadrant(e,t)===d.quadrant(i,r))},M.prototype.getEdgeEnds=function(){return this._edgeEndList},M.prototype.debugPrint=function(e){ye.out.print(e)},M.prototype.getEdgeIterator=function(){return this._edges.iterator()},M.prototype.findEdgeInSameDirection=function(e,t){for(var i=0;i<this._edges.size();i++){var r=this._edges.get(i),n=r.getCoordinates();if(this.matchInSameDirection(e,t,n[0],n[1]))return r;if(this.matchInSameDirection(e,t,n[n.length-1],n[n.length-2]))return r}return null},M.prototype.insertEdge=function(e){this._edges.add(e)},M.prototype.findEdgeEnd=function(e){for(var t=this.getEdgeEnds().iterator();t.hasNext();){var i=t.next();if(i.getEdge()===e)return i}return null},M.prototype.addEdges=function(e){for(var t=e.iterator();t.hasNext();){var i=t.next();this._edges.add(i);var r=new Jt(i,!0),n=new Jt(i,!1);r.setSym(n),n.setSym(r),this.add(r),this.add(n)}},M.prototype.add=function(e){this._nodes.add(e),this._edgeEndList.add(e)},M.prototype.getNodes=function(){return this._nodes.values()},M.prototype.findEdge=function(e,t){for(var i=0;i<this._edges.size();i++){var r=this._edges.get(i),n=r.getCoordinates();if(e.equals(n[0])&&t.equals(n[1]))return r}return null},M.prototype.interfaces_=function(){return[]},M.prototype.getClass=function(){return M},M.linkResultDirectedEdges=function(e){for(var t=e.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()},function(){this._geometryFactory=null,this._shellList=new E;var e=arguments[0];this._geometryFactory=e}),ti=(ei.prototype.sortShellsAndHoles=function(e,t,i){for(var r=e.iterator();r.hasNext();){var n=r.next();n.isHole()?i.add(n):t.add(n)}},ei.prototype.computePolygons=function(e){for(var t=new E,i=e.iterator();i.hasNext();){var r=i.next().toPolygon(this._geometryFactory);t.add(r)}return t},ei.prototype.placeFreeHoles=function(e,t){for(var i=t.iterator();i.hasNext();){var r=i.next();if(null===r.getShell()){var n=this.findEdgeRingContaining(r,e);if(null===n)throw new Vt("unable to assign hole to a shell",r.getCoordinate(0));r.setShell(n)}}},ei.prototype.buildMinimalEdgeRings=function(e,t,i){for(var r=new E,n=e.iterator();n.hasNext();){var o=n.next();if(o.getMaxNodeDegree()>2){o.linkDirectedEdgesForMinimalEdgeRings();var s=o.buildMinimalRings(),a=this.findShell(s);null!==a?(this.placePolygonHoles(a,s),t.add(a)):i.addAll(s)}else r.add(o)}return r},ei.prototype.containsPoint=function(e){for(var t=this._shellList.iterator();t.hasNext();)if(t.next().containsPoint(e))return!0;return!1},ei.prototype.buildMaximalEdgeRings=function(e){for(var t=new E,i=e.iterator();i.hasNext();){var r=i.next();if(r.isInResult()&&r.getLabel().isArea()&&null===r.getEdgeRing()){var n=new qt(r,this._geometryFactory);t.add(n),n.setInResult()}}return t},ei.prototype.placePolygonHoles=function(e,t){for(var i=t.iterator();i.hasNext();){var r=i.next();r.isHole()&&r.setShell(e)}},ei.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},ei.prototype.findEdgeRingContaining=function(e,t){for(var i=e.getLinearRing(),r=i.getEnvelopeInternal(),n=i.getCoordinateN(0),o=null,s=null,a=t.iterator();a.hasNext();){var l=a.next(),u=l.getLinearRing(),c=u.getEnvelopeInternal();null!==o&&(s=o.getLinearRing().getEnvelopeInternal());var h=!1;c.contains(r)&&x.isPointInRing(n,u.getCoordinates())&&(h=!0),h&&(null===o||s.contains(c))&&(o=l)}return o},ei.prototype.findShell=function(e){for(var t=0,i=null,r=e.iterator();r.hasNext();){var n=r.next();n.isHole()||(i=n,t++)}return w.isTrue(t<=1,"found two shells in MinimalEdgeRing list"),i},ei.prototype.add=function(){if(1===arguments.length){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(2===arguments.length){var t=arguments[0],i=arguments[1];M.linkResultDirectedEdges(i);var r=this.buildMaximalEdgeRings(t),n=new E,o=this.buildMinimalEdgeRings(r,this._shellList,n);this.sortShellsAndHoles(o,this._shellList,n),this.placeFreeHoles(this._shellList,n)}},ei.prototype.interfaces_=function(){return[]},ei.prototype.getClass=function(){return ei},function(){}),ii=(ti.prototype.getBounds=function(){},ti.prototype.interfaces_=function(){return[]},ti.prototype.getClass=function(){return ti},function(){this._bounds=null,this._item=null;var e=arguments[0],t=arguments[1];this._bounds=e,this._item=t}),ri=(ii.prototype.getItem=function(){return this._item},ii.prototype.getBounds=function(){return this._bounds},ii.prototype.interfaces_=function(){return[ti,R]},ii.prototype.getClass=function(){return ii},function(){this._size=null,this._items=null,this._size=0,this._items=new E,this._items.add(null)}),ni=(ri.prototype.poll=function(){if(this.isEmpty())return null;var e=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),e},ri.prototype.size=function(){return this._size},ri.prototype.reorder=function(e){for(var t=null,i=this._items.get(e);2*e<=this._size&&((t=2*e)!==this._size&&this._items.get(t+1).compareTo(this._items.get(t))<0&&t++,this._items.get(t).compareTo(i)<0);e=t)this._items.set(e,this._items.get(t));this._items.set(e,i)},ri.prototype.clear=function(){this._size=0,this._items.clear()},ri.prototype.isEmpty=function(){return 0===this._size},ri.prototype.add=function(e){this._items.add(null),this._size+=1;var t=this._size;for(this._items.set(0,e);e.compareTo(this._items.get(Math.trunc(t/2)))<0;t/=2)this._items.set(t,this._items.get(Math.trunc(t/2)));this._items.set(t,e)},ri.prototype.interfaces_=function(){return[]},ri.prototype.getClass=function(){return ri},function(){}),oi=(ni.prototype.visitItem=function(e){},ni.prototype.interfaces_=function(){return[]},ni.prototype.getClass=function(){return ni},function(){}),si=(oi.prototype.insert=function(e,t){},oi.prototype.remove=function(e,t){},oi.prototype.query=function(){},oi.prototype.interfaces_=function(){return[]},oi.prototype.getClass=function(){return oi},function(){if(this._childBoundables=new E,this._bounds=null,this._level=null,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this._level=e}}),ai={serialVersionUID:{configurable:!0}},li=(si.prototype.getLevel=function(){return this._level},si.prototype.size=function(){return this._childBoundables.size()},si.prototype.getChildBoundables=function(){return this._childBoundables},si.prototype.addChildBoundable=function(e){w.isTrue(null===this._bounds),this._childBoundables.add(e)},si.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},si.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},si.prototype.interfaces_=function(){return[ti,R]},si.prototype.getClass=function(){return si},ai.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(si,ai),function(){}),ui=(li.reverseOrder=function(){return{compare:function(e,t){return t.compareTo(e)}}},li.min=function(e){return li.sort(e),e.get(0)},li.sort=function(e,t){var i=e.toArray();t?nt.sort(i,t):nt.sort(i);for(var r=e.iterator(),n=0,o=i.length;n<o;n++)r.next(),r.set(i[n])},li.singletonList=function(e){var t=new E;return t.add(e),t},function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var e=arguments[0],t=arguments[1],i=arguments[2];this._boundable1=e,this._boundable2=t,this._itemDistance=i,this._distance=this.distance()}),ci=(ui.prototype.expandToQueue=function(e,t){var i=ui.isComposite(this._boundable1),r=ui.isComposite(this._boundable2);if(i&&r)return ui.area(this._boundable1)>ui.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,e,t),null):(this.expand(this._boundable2,this._boundable1,e,t),null);if(i)return this.expand(this._boundable1,this._boundable2,e,t),null;if(r)return this.expand(this._boundable2,this._boundable1,e,t),null;throw new A("neither boundable is composite")},ui.prototype.isLeaves=function(){return!(ui.isComposite(this._boundable1)||ui.isComposite(this._boundable2))},ui.prototype.compareTo=function(e){var t=e;return this._distance<t._distance?-1:this._distance>t._distance?1:0},ui.prototype.expand=function(e,t,i,r){for(var n=e.getChildBoundables().iterator();n.hasNext();){var o=n.next(),s=new ui(o,t,this._itemDistance);s.getDistance()<r&&i.add(s)}},ui.prototype.getBoundable=function(e){return 0===e?this._boundable1:this._boundable2},ui.prototype.getDistance=function(){return this._distance},ui.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},ui.prototype.interfaces_=function(){return[ee]},ui.prototype.getClass=function(){return ui},ui.area=function(e){return e.getBounds().getArea()},ui.isComposite=function(e){return e instanceof si},function e(){if(this._root=null,this._built=!1,this._itemBoundables=new E,this._nodeCapacity=null,0===arguments.length){var t=e.DEFAULT_NODE_CAPACITY;this._nodeCapacity=t}else if(1===arguments.length){var i=arguments[0];w.isTrue(i>1,"Node capacity must be greater than 1"),this._nodeCapacity=i}}),hi={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}},Ai=(ci.prototype.getNodeCapacity=function(){return this._nodeCapacity},ci.prototype.lastNode=function(e){return e.get(e.size()-1)},ci.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var e=0,t=arguments[0].getChildBoundables().iterator();t.hasNext();){var i=t.next();i instanceof si?e+=this.size(i):i instanceof ii&&(e+=1)}return e}},ci.prototype.removeItem=function(e,t){for(var i=null,r=e.getChildBoundables().iterator();r.hasNext();){var n=r.next();n instanceof ii&&n.getItem()===t&&(i=n)}return null!==i&&(e.getChildBoundables().remove(i),!0)},ci.prototype.itemsTree=function(){if(0===arguments.length){this.build();var e=this.itemsTree(this._root);return null===e?new E:e}if(1===arguments.length){for(var t=arguments[0],i=new E,r=t.getChildBoundables().iterator();r.hasNext();){var n=r.next();if(n instanceof si){var o=this.itemsTree(n);null!==o&&i.add(o)}else n instanceof ii?i.add(n.getItem()):w.shouldNeverReachHere()}return i.size()<=0?null:i}},ci.prototype.insert=function(e,t){w.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new ii(e,t))},ci.prototype.boundablesAtLevel=function(){if(1===arguments.length){var e=arguments[0],t=new E;return this.boundablesAtLevel(e,this._root,t),t}if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2];if(w.isTrue(i>-2),r.getLevel()===i)return n.add(r),null;for(var o=r.getChildBoundables().iterator();o.hasNext();){var s=o.next();s instanceof si?this.boundablesAtLevel(i,s,n):(w.isTrue(s instanceof ii),-1===i&&n.add(s))}return null}},ci.prototype.query=function(){if(1===arguments.length){var e=arguments[0];this.build();var t=new E;return this.isEmpty()?t:(this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.query(e,this._root,t),t)}if(2===arguments.length){var i=arguments[0],r=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),i)&&this.query(i,this._root,r)}else if(3===arguments.length)if(_(arguments[2],ni)&&arguments[0]instanceof Object&&arguments[1]instanceof si)for(var n=arguments[0],o=arguments[1],s=arguments[2],a=o.getChildBoundables(),l=0;l<a.size();l++){var u=a.get(l);this.getIntersectsOp().intersects(u.getBounds(),n)&&(u instanceof si?this.query(n,u,s):u instanceof ii?s.visitItem(u.getItem()):w.shouldNeverReachHere())}else if(_(arguments[2],We)&&arguments[0]instanceof Object&&arguments[1]instanceof si)for(var c=arguments[0],h=arguments[1],A=arguments[2],p=h.getChildBoundables(),f=0;f<p.size();f++){var d=p.get(f);this.getIntersectsOp().intersects(d.getBounds(),c)&&(d instanceof si?this.query(c,d,A):d instanceof ii?A.add(d.getItem()):w.shouldNeverReachHere())}},ci.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},ci.prototype.getRoot=function(){return this.build(),this._root},ci.prototype.remove=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.remove(e,this._root,t)}if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2],o=this.removeItem(r,n);if(o)return!0;for(var s=null,a=r.getChildBoundables().iterator();a.hasNext();){var l=a.next();if(this.getIntersectsOp().intersects(l.getBounds(),i)&&(l instanceof si&&(o=this.remove(i,l,n)))){s=l;break}}return null!==s&&s.getChildBoundables().isEmpty()&&r.getChildBoundables().remove(s),o}},ci.prototype.createHigherLevels=function(e,t){w.isTrue(!e.isEmpty());var i=this.createParentBoundables(e,t+1);return 1===i.size()?i.get(0):this.createHigherLevels(i,t+1)},ci.prototype.depth=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var e=0,t=arguments[0].getChildBoundables().iterator();t.hasNext();){var i=t.next();if(i instanceof si){var r=this.depth(i);r>e&&(e=r)}}return e+1}},ci.prototype.createParentBoundables=function(e,t){w.isTrue(!e.isEmpty());var i=new E;i.add(this.createNode(t));var r=new E(e);li.sort(r,this.getComparator());for(var n=r.iterator();n.hasNext();){var o=n.next();this.lastNode(i).getChildBoundables().size()===this.getNodeCapacity()&&i.add(this.createNode(t)),this.lastNode(i).addChildBoundable(o)}return i},ci.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},ci.prototype.interfaces_=function(){return[R]},ci.prototype.getClass=function(){return ci},ci.compareDoubles=function(e,t){return e>t?1:e<t?-1:0},hi.IntersectsOp.get=function(){return Ai},hi.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},hi.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(ci,hi),function(){}),pi=function(){},fi=(pi.prototype.distance=function(e,t){},pi.prototype.interfaces_=function(){return[]},pi.prototype.getClass=function(){return pi},function(u){function m(e){e=e||m.DEFAULT_NODE_CAPACITY,u.call(this,e)}u&&(m.__proto__=u),(m.prototype=Object.create(u&&u.prototype)).constructor=m;var e={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return m.prototype.createParentBoundablesFromVerticalSlices=function(e,t){w.isTrue(e.length>0);for(var i=new E,r=0;r<e.length;r++)i.addAll(this.createParentBoundablesFromVerticalSlice(e[r],t));return i},m.prototype.createNode=function(e){return new di(e)},m.prototype.size=function(){return 0===arguments.length?u.prototype.size.call(this):u.prototype.size.apply(this,arguments)},m.prototype.insert=function(){if(2!==arguments.length)return u.prototype.insert.apply(this,arguments);var e=arguments[0],t=arguments[1];if(e.isNull())return null;u.prototype.insert.call(this,e,t)},m.prototype.getIntersectsOp=function(){return m.intersectsOp},m.prototype.verticalSlices=function(e,t){for(var i=Math.trunc(Math.ceil(e.size()/t)),r=new Array(t).fill(null),n=e.iterator(),o=0;o<t;o++){r[o]=new E;for(var s=0;n.hasNext()&&s<i;){var a=n.next();r[o].add(a),s++}}return r},m.prototype.query=function(){if(1===arguments.length){var e=arguments[0];return u.prototype.query.call(this,e)}if(2===arguments.length){var t=arguments[0],i=arguments[1];u.prototype.query.call(this,t,i)}else if(3===arguments.length)if(_(arguments[2],ni)&&arguments[0]instanceof Object&&arguments[1]instanceof si){var r=arguments[0],n=arguments[1],o=arguments[2];u.prototype.query.call(this,r,n,o)}else if(_(arguments[2],We)&&arguments[0]instanceof Object&&arguments[1]instanceof si){var s=arguments[0],a=arguments[1],l=arguments[2];u.prototype.query.call(this,s,a,l)}},m.prototype.getComparator=function(){return m.yComparator},m.prototype.createParentBoundablesFromVerticalSlice=function(e,t){return u.prototype.createParentBoundables.call(this,e,t)},m.prototype.remove=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return u.prototype.remove.call(this,e,t)}return u.prototype.remove.apply(this,arguments)},m.prototype.depth=function(){return 0===arguments.length?u.prototype.depth.call(this):u.prototype.depth.apply(this,arguments)},m.prototype.createParentBoundables=function(e,t){w.isTrue(!e.isEmpty());var i=Math.trunc(Math.ceil(e.size()/this.getNodeCapacity())),r=new E(e);li.sort(r,m.xComparator);var n=this.verticalSlices(r,Math.trunc(Math.ceil(Math.sqrt(i))));return this.createParentBoundablesFromVerticalSlices(n,t)},m.prototype.nearestNeighbour=function(){if(1===arguments.length){if(_(arguments[0],pi)){var e=arguments[0],t=new ui(this.getRoot(),this.getRoot(),e);return this.nearestNeighbour(t)}if(arguments[0]instanceof ui){var i=arguments[0];return this.nearestNeighbour(i,y.POSITIVE_INFINITY)}}else if(2===arguments.length){if(arguments[0]instanceof m&&_(arguments[1],pi)){var r=arguments[0],n=arguments[1],o=new ui(this.getRoot(),r.getRoot(),n);return this.nearestNeighbour(o)}if(arguments[0]instanceof ui&&"number"==typeof arguments[1]){var s=arguments[0],a=arguments[1],l=null,u=new ri;for(u.add(s);!u.isEmpty()&&a>0;){var c=u.poll(),h=c.getDistance();if(h>=a)break;c.isLeaves()?(a=h,l=c):c.expandToQueue(u,a)}return[l.getBoundable(0).getItem(),l.getBoundable(1).getItem()]}}else if(3===arguments.length){var A=arguments[0],p=arguments[1],f=arguments[2],d=new ii(A,p),g=new ui(this.getRoot(),d,f);return this.nearestNeighbour(g)[0]}},m.prototype.interfaces_=function(){return[oi,R]},m.prototype.getClass=function(){return m},m.centreX=function(e){return m.avg(e.getMinX(),e.getMaxX())},m.avg=function(e,t){return(e+t)/2},m.centreY=function(e){return m.avg(e.getMinY(),e.getMaxY())},e.STRtreeNode.get=function(){return di},e.serialVersionUID.get=function(){return 0x39920f7d5f261e0},e.xComparator.get=function(){return{interfaces_:function(){return[ie]},compare:function(e,t){return u.compareDoubles(m.centreX(e.getBounds()),m.centreX(t.getBounds()))}}},e.yComparator.get=function(){return{interfaces_:function(){return[ie]},compare:function(e,t){return u.compareDoubles(m.centreY(e.getBounds()),m.centreY(t.getBounds()))}}},e.intersectsOp.get=function(){return{interfaces_:function(){return[u.IntersectsOp]},intersects:function(e,t){return e.intersects(t)}}},e.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(m,e),m}(ci)),di=function(t){function e(){var e=arguments[0];t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var e=null,t=this.getChildBoundables().iterator();t.hasNext();){var i=t.next();null===e?e=new u(i.getBounds()):e.expandToInclude(i.getBounds())}return e},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(si),gi=function(){},mi=(gi.prototype.interfaces_=function(){return[]},gi.prototype.getClass=function(){return gi},gi.relativeSign=function(e,t){return e<t?-1:e>t?1:0},gi.compare=function(e,t,i){if(t.equals2D(i))return 0;var r=gi.relativeSign(t.x,i.x),n=gi.relativeSign(t.y,i.y);switch(e){case 0:return gi.compareValue(r,n);case 1:return gi.compareValue(n,r);case 2:return gi.compareValue(n,-r);case 3:return gi.compareValue(-r,n);case 4:return gi.compareValue(-r,-n);case 5:return gi.compareValue(-n,-r);case 6:return gi.compareValue(-n,r);case 7:return gi.compareValue(r,-n)}return w.shouldNeverReachHere("invalid octant value"),0},gi.compareValue=function(e,t){return e<0?-1:e>0?1:t<0?-1:t>0?1:0},function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3];this._segString=e,this.coord=new C(t),this.segmentIndex=i,this._segmentOctant=r,this._isInterior=!t.equals2D(e.getCoordinate(i))}),yi=(mi.prototype.getCoordinate=function(){return this.coord},mi.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)},mi.prototype.compareTo=function(e){var t=e;return this.segmentIndex<t.segmentIndex?-1:this.segmentIndex>t.segmentIndex?1:this.coord.equals2D(t.coord)?0:gi.compare(this._segmentOctant,this.coord,t.coord)},mi.prototype.isEndPoint=function(e){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===e},mi.prototype.isInterior=function(){return this._isInterior},mi.prototype.interfaces_=function(){return[ee]},mi.prototype.getClass=function(){return mi},function(){this._nodeMap=new q,this._edge=null;var e=arguments[0];this._edge=e}),_i=(yi.prototype.getSplitCoordinates=function(){var e=new Ke;this.addEndpoints();for(var t=this.iterator(),i=t.next();t.hasNext();){var r=t.next();this.addEdgeCoordinates(i,r,e),i=r}return e.toCoordinateArray()},yi.prototype.addCollapsedNodes=function(){var e=new E;this.findCollapsesFromInsertedNodes(e),this.findCollapsesFromExistingVertices(e);for(var t=e.iterator();t.hasNext();){var i=t.next().intValue();this.add(this._edge.getCoordinate(i),i)}},yi.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();)t.next().print(e)},yi.prototype.findCollapsesFromExistingVertices=function(e){for(var t=0;t<this._edge.size()-2;t++){var i=this._edge.getCoordinate(t),r=this._edge.getCoordinate(t+2);i.equals2D(r)&&e.add(new ce(t+1))}},yi.prototype.addEdgeCoordinates=function(e,t,i){var r=this._edge.getCoordinate(t.segmentIndex),n=t.isInterior()||!t.coord.equals2D(r);i.add(new C(e.coord),!1);for(var o=e.segmentIndex+1;o<=t.segmentIndex;o++)i.add(this._edge.getCoordinate(o));n&&i.add(new C(t.coord))},yi.prototype.iterator=function(){return this._nodeMap.values().iterator()},yi.prototype.addSplitEdges=function(e){this.addEndpoints(),this.addCollapsedNodes();for(var t=this.iterator(),i=t.next();t.hasNext();){var r=t.next(),n=this.createSplitEdge(i,r);e.add(n),i=r}},yi.prototype.findCollapseIndex=function(e,t,i){if(!e.coord.equals2D(t.coord))return!1;var r=t.segmentIndex-e.segmentIndex;return t.isInterior()||r--,1===r&&(i[0]=e.segmentIndex+1,!0)},yi.prototype.findCollapsesFromInsertedNodes=function(e){for(var t=new Array(1).fill(null),i=this.iterator(),r=i.next();i.hasNext();){var n=i.next();this.findCollapseIndex(r,n,t)&&e.add(new ce(t[0])),r=n}},yi.prototype.getEdge=function(){return this._edge},yi.prototype.addEndpoints=function(){var e=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(e),e)},yi.prototype.createSplitEdge=function(e,t){var i=t.segmentIndex-e.segmentIndex+2,r=this._edge.getCoordinate(t.segmentIndex),n=t.isInterior()||!t.coord.equals2D(r);n||i--;var o=new Array(i).fill(null),s=0;o[s++]=new C(e.coord);for(var a=e.segmentIndex+1;a<=t.segmentIndex;a++)o[s++]=this._edge.getCoordinate(a);return n&&(o[s]=new C(t.coord)),new I(o,this._edge.getData())},yi.prototype.add=function(e,t){var i=new mi(this._edge,e,t,this._edge.getSegmentOctant(t)),r=this._nodeMap.get(i);return null!==r?(w.isTrue(r.coord.equals2D(e),"Found equal nodes with different coordinates"),r):(this._nodeMap.put(i,i),i)},yi.prototype.checkSplitEdgesCorrectness=function(e){var t=this._edge.getCoordinates(),i=e.get(0).getCoordinate(0);if(!i.equals2D(t[0]))throw new Be("bad split edge start point at "+i);var r=e.get(e.size()-1).getCoordinates(),n=r[r.length-1];if(!n.equals2D(t[t.length-1]))throw new Be("bad split edge end point at "+n)},yi.prototype.interfaces_=function(){return[]},yi.prototype.getClass=function(){return yi},function(){}),vi=(_i.prototype.interfaces_=function(){return[]},_i.prototype.getClass=function(){return _i},_i.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var e=arguments[0],t=arguments[1];if(0===e&&0===t)throw new A("Cannot compute the octant for point ( "+e+", "+t+" )");var i=Math.abs(e),r=Math.abs(t);return e>=0?t>=0?i>=r?0:1:i>=r?7:6:t>=0?i>=r?3:2:i>=r?4:5}if(arguments[0]instanceof C&&arguments[1]instanceof C){var n=arguments[0],o=arguments[1],s=o.x-n.x,a=o.y-n.y;if(0===s&&0===a)throw new A("Cannot compute the octant for two identical points "+n);return _i.octant(s,a)}},function(){}),Ci=(vi.prototype.getCoordinates=function(){},vi.prototype.size=function(){},vi.prototype.getCoordinate=function(e){},vi.prototype.isClosed=function(){},vi.prototype.setData=function(e){},vi.prototype.getData=function(){},vi.prototype.interfaces_=function(){return[]},vi.prototype.getClass=function(){return vi},function(){}),I=(Ci.prototype.addIntersection=function(e,t){},Ci.prototype.interfaces_=function(){return[vi]},Ci.prototype.getClass=function(){return Ci},function(){this._nodeList=new yi(this),this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t}),S=(I.prototype.getCoordinates=function(){return this._pts},I.prototype.size=function(){return this._pts.length},I.prototype.getCoordinate=function(e){return this._pts[e]},I.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},I.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))},I.prototype.setData=function(e){this._data=e},I.prototype.safeOctant=function(e,t){return e.equals2D(t)?0:_i.octant(e,t)},I.prototype.getData=function(){return this._data},I.prototype.addIntersection=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];this.addIntersectionNode(e,t)}else if(4===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[3],o=new C(i.getIntersection(n));this.addIntersection(o,r)}},I.prototype.toString=function(){return Ee.toLineString(new n(this._pts))},I.prototype.getNodeList=function(){return this._nodeList},I.prototype.addIntersectionNode=function(e,t){var i=t,r=i+1;if(r<this._pts.length){var n=this._pts[r];e.equals2D(n)&&(i=r)}return this._nodeList.add(e,i)},I.prototype.addIntersections=function(e,t,i){for(var r=0;r<e.getIntersectionNum();r++)this.addIntersection(e,t,i,r)},I.prototype.interfaces_=function(){return[Ci]},I.prototype.getClass=function(){return I},I.getNodedSubstrings=function(){if(1===arguments.length){var e=arguments[0],t=new E;return I.getNodedSubstrings(e,t),t}if(2===arguments.length)for(var i=arguments[0],r=arguments[1],n=i.iterator();n.hasNext();)n.next().getNodeList().addSplitEdges(r)},function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new C,this.p1=new C;else if(1===arguments.length){var e=arguments[0];this.p0=new C(e.p0),this.p1=new C(e.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var t=arguments[0],i=arguments[1],r=arguments[2],n=arguments[3];this.p0=new C(t,i),this.p1=new C(r,n)}}),wi={serialVersionUID:{configurable:!0}},xi=(S.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},S.prototype.orientationIndex=function(){if(arguments[0]instanceof S){var e=arguments[0],t=x.orientationIndex(this.p0,this.p1,e.p0),i=x.orientationIndex(this.p0,this.p1,e.p1);return t>=0&&i>=0?Math.max(t,i):t<=0&&i<=0?Math.max(t,i):0}if(arguments[0]instanceof C){var r=arguments[0];return x.orientationIndex(this.p0,this.p1,r)}},S.prototype.toGeometry=function(e){return e.createLineString([this.p0,this.p1])},S.prototype.isVertical=function(){return this.p0.x===this.p1.x},S.prototype.equals=function(e){if(!(e instanceof S))return!1;var t=e;return this.p0.equals(t.p0)&&this.p1.equals(t.p1)},S.prototype.intersection=function(e){var t=new Se;return t.computeIntersection(this.p0,this.p1,e.p0,e.p1),t.hasIntersection()?t.getIntersection(0):null},S.prototype.project=function(){if(arguments[0]instanceof C){var e=arguments[0];if(e.equals(this.p0)||e.equals(this.p1))return new C(e);var t=this.projectionFactor(e),i=new C;return i.x=this.p0.x+t*(this.p1.x-this.p0.x),i.y=this.p0.y+t*(this.p1.y-this.p0.y),i}if(arguments[0]instanceof S){var r=arguments[0],n=this.projectionFactor(r.p0),o=this.projectionFactor(r.p1);if(n>=1&&o>=1)return null;if(n<=0&&o<=0)return null;var s=this.project(r.p0);n<0&&(s=this.p0),n>1&&(s=this.p1);var a=this.project(r.p1);return o<0&&(a=this.p0),o>1&&(a=this.p1),new S(s,a)}},S.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},S.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},S.prototype.getCoordinate=function(e){return 0===e?this.p0:this.p1},S.prototype.distancePerpendicular=function(e){return x.distancePointLinePerpendicular(e,this.p0,this.p1)},S.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},S.prototype.midPoint=function(){return S.midPoint(this.p0,this.p1)},S.prototype.projectionFactor=function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var t=this.p1.x-this.p0.x,i=this.p1.y-this.p0.y,r=t*t+i*i;if(r<=0)return y.NaN;return((e.x-this.p0.x)*t+(e.y-this.p0.y)*i)/r},S.prototype.closestPoints=function(e){var t=this.intersection(e);if(null!==t)return[t,t];var i=new Array(2).fill(null),r=y.MAX_VALUE,n=null,o=this.closestPoint(e.p0);r=o.distance(e.p0),i[0]=o,i[1]=e.p0;var s=this.closestPoint(e.p1);(n=s.distance(e.p1))<r&&(r=n,i[0]=s,i[1]=e.p1);var a=e.closestPoint(this.p0);(n=a.distance(this.p0))<r&&(r=n,i[0]=this.p0,i[1]=a);var l=e.closestPoint(this.p1);return(n=l.distance(this.p1))<r&&(r=n,i[0]=this.p1,i[1]=l),i},S.prototype.closestPoint=function(e){var t=this.projectionFactor(e);if(t>0&&t<1)return this.project(e);return this.p0.distance(e)<this.p1.distance(e)?this.p0:this.p1},S.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},S.prototype.getLength=function(){return this.p0.distance(this.p1)},S.prototype.compareTo=function(e){var t=e,i=this.p0.compareTo(t.p0);return 0!==i?i:this.p1.compareTo(t.p1)},S.prototype.reverse=function(){var e=this.p0;this.p0=this.p1,this.p1=e},S.prototype.equalsTopo=function(e){return this.p0.equals(e.p0)&&(this.p1.equals(e.p1)||this.p0.equals(e.p1))&&this.p1.equals(e.p0)},S.prototype.lineIntersection=function(e){try{return _e.intersection(this.p0,this.p1,e.p0,e.p1)}catch(e){if(!(e instanceof me))throw e}return null},S.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},S.prototype.pointAlongOffset=function(e,t){var i=this.p0.x+e*(this.p1.x-this.p0.x),r=this.p0.y+e*(this.p1.y-this.p0.y),n=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,s=Math.sqrt(n*n+o*o),a=0,l=0;if(0!==t){if(s<=0)throw new Error("Cannot compute offset from zero-length line segment");a=t*n/s,l=t*o/s}return new C(i-l,r+a)},S.prototype.setCoordinates=function(){if(1===arguments.length){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(2===arguments.length){var t=arguments[0],i=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=i.x,this.p1.y=i.y}},S.prototype.segmentFraction=function(e){var t=this.projectionFactor(e);return t<0?t=0:(t>1||y.isNaN(t))&&(t=1),t},S.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},S.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},S.prototype.distance=function(){if(arguments[0]instanceof S){var e=arguments[0];return x.distanceLineLine(this.p0,this.p1,e.p0,e.p1)}if(arguments[0]instanceof C){var t=arguments[0];return x.distancePointLine(t,this.p0,this.p1)}},S.prototype.pointAlong=function(e){var t=new C;return t.x=this.p0.x+e*(this.p1.x-this.p0.x),t.y=this.p0.y+e*(this.p1.y-this.p0.y),t},S.prototype.hashCode=function(){var e=y.doubleToLongBits(this.p0.x);e^=31*y.doubleToLongBits(this.p0.y);var t=Math.trunc(e)^Math.trunc(e>>32),i=y.doubleToLongBits(this.p1.x);i^=31*y.doubleToLongBits(this.p1.y);return t^(Math.trunc(i)^Math.trunc(i>>32))},S.prototype.interfaces_=function(){return[ee,R]},S.prototype.getClass=function(){return S},S.midPoint=function(e,t){return new C((e.x+t.x)/2,(e.y+t.y)/2)},wi.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(S,wi),function(){this.tempEnv1=new u,this.tempEnv2=new u,this._overlapSeg1=new S,this._overlapSeg2=new S}),bi=(xi.prototype.overlap=function(){if(2===arguments.length);else if(4===arguments.length){var e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3];e.getLineSegment(t,this._overlapSeg1),i.getLineSegment(r,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},xi.prototype.interfaces_=function(){return[]},xi.prototype.getClass=function(){return xi},function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3];this._pts=e,this._start=t,this._end=i,this._context=r}),Ei=(bi.prototype.getLineSegment=function(e,t){t.p0=this._pts[e],t.p1=this._pts[e+1]},bi.prototype.computeSelect=function(e,t,i,r){var n=this._pts[t],o=this._pts[i];if(r.tempEnv1.init(n,o),i-t==1)return r.select(this,t),null;if(!e.intersects(r.tempEnv1))return null;var s=Math.trunc((t+i)/2);t<s&&this.computeSelect(e,t,s,r),s<i&&this.computeSelect(e,s,i,r)},bi.prototype.getCoordinates=function(){for(var e=new Array(this._end-this._start+1).fill(null),t=0,i=this._start;i<=this._end;i++)e[t++]=this._pts[i];return e},bi.prototype.computeOverlaps=function(e,t){this.computeOverlapsInternal(this._start,this._end,e,e._start,e._end,t)},bi.prototype.setId=function(e){this._id=e},bi.prototype.select=function(e,t){this.computeSelect(e,this._start,this._end,t)},bi.prototype.getEnvelope=function(){if(null===this._env){var e=this._pts[this._start],t=this._pts[this._end];this._env=new u(e,t)}return this._env},bi.prototype.getEndIndex=function(){return this._end},bi.prototype.getStartIndex=function(){return this._start},bi.prototype.getContext=function(){return this._context},bi.prototype.getId=function(){return this._id},bi.prototype.computeOverlapsInternal=function(e,t,i,r,n,o){var s=this._pts[e],a=this._pts[t],l=i._pts[r],u=i._pts[n];if(t-e==1&&n-r==1)return o.overlap(this,e,i,r),null;if(o.tempEnv1.init(s,a),o.tempEnv2.init(l,u),!o.tempEnv1.intersects(o.tempEnv2))return null;var c=Math.trunc((e+t)/2),h=Math.trunc((r+n)/2);e<c&&(r<h&&this.computeOverlapsInternal(e,c,i,r,h,o),h<n&&this.computeOverlapsInternal(e,c,i,h,n,o)),c<t&&(r<h&&this.computeOverlapsInternal(c,t,i,r,h,o),h<n&&this.computeOverlapsInternal(c,t,i,h,n,o))},bi.prototype.interfaces_=function(){return[]},bi.prototype.getClass=function(){return bi},function(){}),Bi=(Ei.prototype.interfaces_=function(){return[]},Ei.prototype.getClass=function(){return Ei},Ei.getChainStartIndices=function(e){var t=0,i=new E;i.add(new ce(t));do{var r=Ei.findChainEnd(e,t);i.add(new ce(r)),t=r}while(t<e.length-1);return Ei.toIntArray(i)},Ei.findChainEnd=function(e,t){for(var i=t;i<e.length-1&&e[i].equals2D(e[i+1]);)i++;if(i>=e.length-1)return e.length-1;for(var r=d.quadrant(e[i],e[i+1]),n=t+1;n<e.length;){if(!e[n-1].equals2D(e[n]))if(d.quadrant(e[n-1],e[n])!==r)break;n++}return n-1},Ei.getChains=function(){if(1===arguments.length){var e=arguments[0];return Ei.getChains(e,null)}if(2===arguments.length){for(var t=arguments[0],i=arguments[1],r=new E,n=Ei.getChainStartIndices(t),o=0;o<n.length-1;o++){var s=new bi(t,n[o],n[o+1],i);r.add(s)}return r}},Ei.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),i=0;i<t.length;i++)t[i]=e.get(i).intValue();return t},function(){}),Mi=(Bi.prototype.computeNodes=function(e){},Bi.prototype.getNodedSubstrings=function(){},Bi.prototype.interfaces_=function(){return[]},Bi.prototype.getClass=function(){return Bi},function(){if(this._segInt=null,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.setSegmentIntersector(e)}}),Ii=(Mi.prototype.setSegmentIntersector=function(e){this._segInt=e},Mi.prototype.interfaces_=function(){return[Bi]},Mi.prototype.getClass=function(){return Mi},function(t){function e(e){e?t.call(this,e):t.call(this),this._monoChains=new E,this._index=new fi,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return I.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(e){for(var t=Ei.getChains(e.getCoordinates(),e).iterator();t.hasNext();){var i=t.next();i.setId(this._idCounter++),this._index.insert(i.getEnvelope(),i),this._monoChains.add(i)}},e.prototype.computeNodes=function(e){this._nodedSegStrings=e;for(var t=e.iterator();t.hasNext();)this.add(t.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var e=new Si(this._segInt),t=this._monoChains.iterator();t.hasNext();)for(var i=t.next(),r=this._index.query(i.getEnvelope()).iterator();r.hasNext();){var n=r.next();if(n.getId()>i.getId()&&(i.computeOverlaps(n,e),this._nOverlaps++),this._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},i.SegmentOverlapAction.get=function(){return Si},Object.defineProperties(e,i),e}(Mi)),Si=function(s){function e(){s.call(this),this._si=null;var e=arguments[0];this._si=e}return s&&(e.__proto__=s),e.prototype=Object.create(s&&s.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(4!==arguments.length)return s.prototype.overlap.apply(this,arguments);var e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3],n=e.getContext(),o=i.getContext();this._si.processIntersections(n,t,o,r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(xi),P=function e(){if(this._quadrantSegments=e.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=e.CAP_ROUND,this._joinStyle=e.JOIN_ROUND,this._mitreLimit=e.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=e.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setQuadrantSegments(t)}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.setQuadrantSegments(i),this.setEndCapStyle(r)}else if(4===arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];this.setQuadrantSegments(n),this.setEndCapStyle(o),this.setJoinStyle(s),this.setMitreLimit(a)}},Pi={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}},T=(P.prototype.getEndCapStyle=function(){return this._endCapStyle},P.prototype.isSingleSided=function(){return this._isSingleSided},P.prototype.setQuadrantSegments=function(e){this._quadrantSegments=e,0===this._quadrantSegments&&(this._joinStyle=P.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=P.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),e<=0&&(this._quadrantSegments=1),this._joinStyle!==P.JOIN_ROUND&&(this._quadrantSegments=P.DEFAULT_QUADRANT_SEGMENTS)},P.prototype.getJoinStyle=function(){return this._joinStyle},P.prototype.setJoinStyle=function(e){this._joinStyle=e},P.prototype.setSimplifyFactor=function(e){this._simplifyFactor=e<0?0:e},P.prototype.getSimplifyFactor=function(){return this._simplifyFactor},P.prototype.getQuadrantSegments=function(){return this._quadrantSegments},P.prototype.setEndCapStyle=function(e){this._endCapStyle=e},P.prototype.getMitreLimit=function(){return this._mitreLimit},P.prototype.setMitreLimit=function(e){this._mitreLimit=e},P.prototype.setSingleSided=function(e){this._isSingleSided=e},P.prototype.interfaces_=function(){return[]},P.prototype.getClass=function(){return P},P.bufferDistanceError=function(e){var t=Math.PI/2/e;return 1-Math.cos(t/2)},Pi.CAP_ROUND.get=function(){return 1},Pi.CAP_FLAT.get=function(){return 2},Pi.CAP_SQUARE.get=function(){return 3},Pi.JOIN_ROUND.get=function(){return 1},Pi.JOIN_MITRE.get=function(){return 2},Pi.JOIN_BEVEL.get=function(){return 3},Pi.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},Pi.DEFAULT_MITRE_LIMIT.get=function(){return 5},Pi.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(P,Pi),function(e){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=x.COUNTERCLOCKWISE,this._inputLine=e||null}),Ti={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}},Li=(T.prototype.isDeletable=function(e,t,i,r){var n=this._inputLine[e],o=this._inputLine[t],s=this._inputLine[i];return!!this.isConcave(n,o,s)&&(!!this.isShallow(n,o,s,r)&&this.isShallowSampled(n,o,e,i,r))},T.prototype.deleteShallowConcavities=function(){for(var e=1,t=this.findNextNonDeletedIndex(e),i=this.findNextNonDeletedIndex(t),r=!1;i<this._inputLine.length;){var n=!1;this.isDeletable(e,t,i,this._distanceTol)&&(this._isDeleted[t]=T.DELETE,n=!0,r=!0),e=n?i:t,t=this.findNextNonDeletedIndex(e),i=this.findNextNonDeletedIndex(t)}return r},T.prototype.isShallowConcavity=function(e,t,i,r){if(!(x.computeOrientation(e,t,i)===this._angleOrientation))return!1;return x.distancePointLine(t,e,i)<r},T.prototype.isShallowSampled=function(e,t,i,r,n){var o=Math.trunc((r-i)/T.NUM_PTS_TO_CHECK);o<=0&&(o=1);for(var s=i;s<r;s+=o)if(!this.isShallow(e,t,this._inputLine[s],n))return!1;return!0},T.prototype.isConcave=function(e,t,i){var r=x.computeOrientation(e,t,i)===this._angleOrientation;return r},T.prototype.simplify=function(e){this._distanceTol=Math.abs(e),e<0&&(this._angleOrientation=x.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var t=!1;do{t=this.deleteShallowConcavities()}while(t);return this.collapseLine()},T.prototype.findNextNonDeletedIndex=function(e){for(var t=e+1;t<this._inputLine.length&&this._isDeleted[t]===T.DELETE;)t++;return t},T.prototype.isShallow=function(e,t,i,r){return x.distancePointLine(t,e,i)<r},T.prototype.collapseLine=function(){for(var e=new Ke,t=0;t<this._inputLine.length;t++)this._isDeleted[t]!==T.DELETE&&e.add(this._inputLine[t]);return e.toCoordinateArray()},T.prototype.interfaces_=function(){return[]},T.prototype.getClass=function(){return T},T.simplify=function(e,t){return new T(e).simplify(t)},Ti.INIT.get=function(){return 0},Ti.DELETE.get=function(){return 1},Ti.KEEP.get=function(){return 1},Ti.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(T,Ti),function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new E}),Di={COORDINATE_ARRAY_TYPE:{configurable:!0}},L=(Li.prototype.getCoordinates=function(){return this._ptList.toArray(Li.COORDINATE_ARRAY_TYPE)},Li.prototype.setPrecisionModel=function(e){this._precisionModel=e},Li.prototype.addPt=function(e){var t=new C(e);if(this._precisionModel.makePrecise(t),this.isRedundant(t))return null;this._ptList.add(t)},Li.prototype.revere=function(){},Li.prototype.addPts=function(e,t){if(t)for(var i=0;i<e.length;i++)this.addPt(e[i]);else for(var r=e.length-1;r>=0;r--)this.addPt(e[r])},Li.prototype.isRedundant=function(e){if(this._ptList.size()<1)return!1;var t=this._ptList.get(this._ptList.size()-1);return e.distance(t)<this._minimimVertexDistance},Li.prototype.toString=function(){return(new l).createLineString(this.getCoordinates()).toString()},Li.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var e=new C(this._ptList.get(0)),t=this._ptList.get(this._ptList.size()-1);if(e.equals(t))return null;this._ptList.add(e)},Li.prototype.setMinimumVertexDistance=function(e){this._minimimVertexDistance=e},Li.prototype.interfaces_=function(){return[]},Li.prototype.getClass=function(){return Li},Di.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(Li,Di),function(){}),Fi={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}},D=(L.prototype.interfaces_=function(){return[]},L.prototype.getClass=function(){return L},L.toDegrees=function(e){return 180*e/Math.PI},L.normalize=function(e){for(;e>Math.PI;)e-=L.PI_TIMES_2;for(;e<=-Math.PI;)e+=L.PI_TIMES_2;return e},L.angle=function(){if(1===arguments.length){var e=arguments[0];return Math.atan2(e.y,e.x)}if(2===arguments.length){var t=arguments[0],i=arguments[1],r=i.x-t.x,n=i.y-t.y;return Math.atan2(n,r)}},L.isAcute=function(e,t,i){var r=e.x-t.x,n=e.y-t.y;return r*(i.x-t.x)+n*(i.y-t.y)>0},L.isObtuse=function(e,t,i){var r=e.x-t.x,n=e.y-t.y;return r*(i.x-t.x)+n*(i.y-t.y)<0},L.interiorAngle=function(e,t,i){var r=L.angle(t,e),n=L.angle(t,i);return Math.abs(n-r)},L.normalizePositive=function(e){if(e<0){for(;e<0;)e+=L.PI_TIMES_2;e>=L.PI_TIMES_2&&(e=0)}else{for(;e>=L.PI_TIMES_2;)e-=L.PI_TIMES_2;e<0&&(e=0)}return e},L.angleBetween=function(e,t,i){var r=L.angle(t,e),n=L.angle(t,i);return L.diff(r,n)},L.diff=function(e,t){var i=null;return(i=e<t?t-e:e-t)>Math.PI&&(i=2*Math.PI-i),i},L.toRadians=function(e){return e*Math.PI/180},L.getTurn=function(e,t){var i=Math.sin(t-e);return i>0?L.COUNTERCLOCKWISE:i<0?L.CLOCKWISE:L.NONE},L.angleBetweenOriented=function(e,t,i){var r=L.angle(t,e),n=L.angle(t,i)-r;return n<=-Math.PI?n+L.PI_TIMES_2:n>Math.PI?n-L.PI_TIMES_2:n},Fi.PI_TIMES_2.get=function(){return 2*Math.PI},Fi.PI_OVER_2.get=function(){return Math.PI/2},Fi.PI_OVER_4.get=function(){return Math.PI/4},Fi.COUNTERCLOCKWISE.get=function(){return x.COUNTERCLOCKWISE},Fi.CLOCKWISE.get=function(){return x.CLOCKWISE},Fi.NONE.get=function(){return x.COLLINEAR},Object.defineProperties(L,Fi),function e(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new S,this._seg1=new S,this._offset0=new S,this._offset1=new S,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],i=arguments[1],r=arguments[2];this._precisionModel=t,this._bufParams=i,this._li=new Se,this._filletAngleQuantum=Math.PI/2/i.getQuadrantSegments(),i.getQuadrantSegments()>=8&&i.getJoinStyle()===P.JOIN_ROUND&&(this._closingSegLengthFactor=e.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)}),Ni={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}},Oi=(D.prototype.addNextSegment=function(e,t){if(this._s0=this._s1,this._s1=this._s2,this._s2=e,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var i=x.computeOrientation(this._s0,this._s1,this._s2),r=i===x.CLOCKWISE&&this._side===m.LEFT||i===x.COUNTERCLOCKWISE&&this._side===m.RIGHT;0===i?this.addCollinear(t):r?this.addOutsideTurn(i,t):this.addInsideTurn(i,t)},D.prototype.addLineEndCap=function(e,t){var i=new S(e,t),r=new S;this.computeOffsetSegment(i,m.LEFT,this._distance,r);var n=new S;this.computeOffsetSegment(i,m.RIGHT,this._distance,n);var o=t.x-e.x,s=t.y-e.y,a=Math.atan2(s,o);switch(this._bufParams.getEndCapStyle()){case P.CAP_ROUND:this._segList.addPt(r.p1),this.addFilletArc(t,a+Math.PI/2,a-Math.PI/2,x.CLOCKWISE,this._distance),this._segList.addPt(n.p1);break;case P.CAP_FLAT:this._segList.addPt(r.p1),this._segList.addPt(n.p1);break;case P.CAP_SQUARE:var l=new C;l.x=Math.abs(this._distance)*Math.cos(a),l.y=Math.abs(this._distance)*Math.sin(a);var u=new C(r.p1.x+l.x,r.p1.y+l.y),c=new C(n.p1.x+l.x,n.p1.y+l.y);this._segList.addPt(u),this._segList.addPt(c)}},D.prototype.getCoordinates=function(){return this._segList.getCoordinates()},D.prototype.addMitreJoin=function(e,t,i,r){var n=!0,o=null;try{o=_e.intersection(t.p0,t.p1,i.p0,i.p1);(r<=0?1:o.distance(e)/Math.abs(r))>this._bufParams.getMitreLimit()&&(n=!1)}catch(e){if(!(e instanceof me))throw e;o=new C(0,0),n=!1}n?this._segList.addPt(o):this.addLimitedMitreJoin(t,i,r,this._bufParams.getMitreLimit())},D.prototype.addFilletCorner=function(e,t,i,r,n){var o=t.x-e.x,s=t.y-e.y,a=Math.atan2(s,o),l=i.x-e.x,u=i.y-e.y,c=Math.atan2(u,l);r===x.CLOCKWISE?a<=c&&(a+=2*Math.PI):a>=c&&(a-=2*Math.PI),this._segList.addPt(t),this.addFilletArc(e,a,c,r,n),this._segList.addPt(i)},D.prototype.addOutsideTurn=function(e,t){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*D.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===P.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===P.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(t&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,e,this._distance),this._segList.addPt(this._offset1.p0))},D.prototype.createSquare=function(e){this._segList.addPt(new C(e.x+this._distance,e.y+this._distance)),this._segList.addPt(new C(e.x+this._distance,e.y-this._distance)),this._segList.addPt(new C(e.x-this._distance,e.y-this._distance)),this._segList.addPt(new C(e.x-this._distance,e.y+this._distance)),this._segList.closeRing()},D.prototype.addSegments=function(e,t){this._segList.addPts(e,t)},D.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},D.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},D.prototype.initSideSegments=function(e,t,i){this._s1=e,this._s2=t,this._side=i,this._seg1.setCoordinates(e,t),this.computeOffsetSegment(this._seg1,i,this._distance,this._offset1)},D.prototype.addLimitedMitreJoin=function(e,t,i,r){var n=this._seg0.p1,o=L.angle(n,this._seg0.p0),s=L.angleBetweenOriented(this._seg0.p0,n,this._seg1.p1)/2,a=L.normalize(o+s),l=L.normalize(a+Math.PI),u=r*i,c=i-u*Math.abs(Math.sin(s)),h=n.x+u*Math.cos(l),A=n.y+u*Math.sin(l),p=new C(h,A),f=new S(n,p),d=f.pointAlongOffset(1,c),g=f.pointAlongOffset(1,-c);this._side===m.LEFT?(this._segList.addPt(d),this._segList.addPt(g)):(this._segList.addPt(g),this._segList.addPt(d))},D.prototype.computeOffsetSegment=function(e,t,i,r){var n=t===m.LEFT?1:-1,o=e.p1.x-e.p0.x,s=e.p1.y-e.p0.y,a=Math.sqrt(o*o+s*s),l=n*i*o/a,u=n*i*s/a;r.p0.x=e.p0.x-u,r.p0.y=e.p0.y+l,r.p1.x=e.p1.x-u,r.p1.y=e.p1.y+l},D.prototype.addFilletArc=function(e,t,i,r,n){var o=r===x.CLOCKWISE?-1:1,s=Math.abs(t-i),a=Math.trunc(s/this._filletAngleQuantum+.5);if(a<1)return null;for(var l=s/a,u=0,c=new C;u<s;){var h=t+o*u;c.x=e.x+n*Math.cos(h),c.y=e.y+n*Math.sin(h),this._segList.addPt(c),u+=l}},D.prototype.addInsideTurn=function(e,t){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*D.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var i=new C((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(i);var r=new C((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},D.prototype.createCircle=function(e){var t=new C(e.x+this._distance,e.y);this._segList.addPt(t),this.addFilletArc(e,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},D.prototype.addBevelJoin=function(e,t){this._segList.addPt(e.p1),this._segList.addPt(t.p0)},D.prototype.init=function(e){this._distance=e,this._maxCurveSegmentError=e*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Li,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(e*D.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},D.prototype.addCollinear=function(e){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===P.JOIN_BEVEL||this._bufParams.getJoinStyle()===P.JOIN_MITRE?(e&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,x.CLOCKWISE,this._distance))},D.prototype.closeRing=function(){this._segList.closeRing()},D.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},D.prototype.interfaces_=function(){return[]},D.prototype.getClass=function(){return D},Ni.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},Ni.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},Ni.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},Ni.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(D,Ni),function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var e=arguments[0],t=arguments[1];this._precisionModel=e,this._bufParams=t}),Ri=(Oi.prototype.getOffsetCurve=function(e,t){if(this._distance=t,0===t)return null;var i=t<0,r=Math.abs(t),n=this.getSegGen(r);e.length<=1?this.computePointCurve(e[0],n):this.computeOffsetCurve(e,i,n);var o=n.getCoordinates();return i&&c.reverse(o),o},Oi.prototype.computeSingleSidedBufferCurve=function(e,t,i){var r=this.simplifyTolerance(this._distance);if(t){i.addSegments(e,!0);var n=T.simplify(e,-r),o=n.length-1;i.initSideSegments(n[o],n[o-1],m.LEFT),i.addFirstSegment();for(var s=o-2;s>=0;s--)i.addNextSegment(n[s],!0)}else{i.addSegments(e,!1);var a=T.simplify(e,r),l=a.length-1;i.initSideSegments(a[0],a[1],m.LEFT),i.addFirstSegment();for(var u=2;u<=l;u++)i.addNextSegment(a[u],!0)}i.addLastSegment(),i.closeRing()},Oi.prototype.computeRingBufferCurve=function(e,t,i){var r=this.simplifyTolerance(this._distance);t===m.RIGHT&&(r=-r);var n=T.simplify(e,r),o=n.length-1;i.initSideSegments(n[o-1],n[0],t);for(var s=1;s<=o;s++){var a=1!==s;i.addNextSegment(n[s],a)}i.closeRing()},Oi.prototype.computeLineBufferCurve=function(e,t){var i=this.simplifyTolerance(this._distance),r=T.simplify(e,i),n=r.length-1;t.initSideSegments(r[0],r[1],m.LEFT);for(var o=2;o<=n;o++)t.addNextSegment(r[o],!0);t.addLastSegment(),t.addLineEndCap(r[n-1],r[n]);var s=T.simplify(e,-i),a=s.length-1;t.initSideSegments(s[a],s[a-1],m.LEFT);for(var l=a-2;l>=0;l--)t.addNextSegment(s[l],!0);t.addLastSegment(),t.addLineEndCap(s[1],s[0]),t.closeRing()},Oi.prototype.computePointCurve=function(e,t){switch(this._bufParams.getEndCapStyle()){case P.CAP_ROUND:t.createCircle(e);break;case P.CAP_SQUARE:t.createSquare(e)}},Oi.prototype.getLineCurve=function(e,t){if(this._distance=t,t<0&&!this._bufParams.isSingleSided())return null;if(0===t)return null;var i=Math.abs(t),r=this.getSegGen(i);if(e.length<=1)this.computePointCurve(e[0],r);else if(this._bufParams.isSingleSided()){var n=t<0;this.computeSingleSidedBufferCurve(e,n,r)}else this.computeLineBufferCurve(e,r);return r.getCoordinates()},Oi.prototype.getBufferParameters=function(){return this._bufParams},Oi.prototype.simplifyTolerance=function(e){return e*this._bufParams.getSimplifyFactor()},Oi.prototype.getRingCurve=function(e,t,i){if(this._distance=i,e.length<=2)return this.getLineCurve(e,i);if(0===i)return Oi.copyCoordinates(e);var r=this.getSegGen(i);return this.computeRingBufferCurve(e,t,r),r.getCoordinates()},Oi.prototype.computeOffsetCurve=function(e,t,i){var r=this.simplifyTolerance(this._distance);if(t){var n=T.simplify(e,-r),o=n.length-1;i.initSideSegments(n[o],n[o-1],m.LEFT),i.addFirstSegment();for(var s=o-2;s>=0;s--)i.addNextSegment(n[s],!0)}else{var a=T.simplify(e,r),l=a.length-1;i.initSideSegments(a[0],a[1],m.LEFT),i.addFirstSegment();for(var u=2;u<=l;u++)i.addNextSegment(a[u],!0)}i.addLastSegment()},Oi.prototype.getSegGen=function(e){return new D(this._precisionModel,this._bufParams,e)},Oi.prototype.interfaces_=function(){return[]},Oi.prototype.getClass=function(){return Oi},Oi.copyCoordinates=function(e){for(var t=new Array(e.length).fill(null),i=0;i<t.length;i++)t[i]=new C(e[i]);return t},function(){this._subgraphs=null,this._seg=new S,this._cga=new x;var e=arguments[0];this._subgraphs=e}),Ui={DepthSegment:{configurable:!0}},ki=(Ri.prototype.findStabbedSegments=function(){if(1===arguments.length){for(var e=arguments[0],t=new E,i=this._subgraphs.iterator();i.hasNext();){var r=i.next(),n=r.getEnvelope();e.y<n.getMinY()||e.y>n.getMaxY()||this.findStabbedSegments(e,r.getDirectedEdges(),t)}return t}if(3===arguments.length)if(_(arguments[2],We)&&arguments[0]instanceof C&&arguments[1]instanceof Jt)for(var o=arguments[0],s=arguments[1],a=arguments[2],l=s.getEdge().getCoordinates(),u=0;u<l.length-1;u++){this._seg.p0=l[u],this._seg.p1=l[u+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse();if(!(Math.max(this._seg.p0.x,this._seg.p1.x)<o.x)&&!(this._seg.isHorizontal()||o.y<this._seg.p0.y||o.y>this._seg.p1.y||x.computeOrientation(this._seg.p0,this._seg.p1,o)===x.RIGHT)){var c=s.getDepth(m.LEFT);this._seg.p0.equals(l[u])||(c=s.getDepth(m.RIGHT));var h=new ki(this._seg,c);a.add(h)}}else if(_(arguments[2],We)&&arguments[0]instanceof C&&_(arguments[1],We))for(var A=arguments[0],p=arguments[1],f=arguments[2],d=p.iterator();d.hasNext();){var g=d.next();g.isForward()&&this.findStabbedSegments(A,g,f)}},Ri.prototype.getDepth=function(e){var t=this.findStabbedSegments(e);if(0===t.size())return 0;return li.min(t)._leftDepth},Ri.prototype.interfaces_=function(){return[]},Ri.prototype.getClass=function(){return Ri},Ui.DepthSegment.get=function(){return ki},Object.defineProperties(Ri,Ui),function(){this._upwardSeg=null,this._leftDepth=null;var e=arguments[0],t=arguments[1];this._upwardSeg=new S(e),this._leftDepth=t}),F=(ki.prototype.compareTo=function(e){var t=e;if(this._upwardSeg.minX()>=t._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=t._upwardSeg.minX())return-1;var i=this._upwardSeg.orientationIndex(t._upwardSeg);return 0!==i?i:0!=(i=-1*t._upwardSeg.orientationIndex(this._upwardSeg))?i:this._upwardSeg.compareTo(t._upwardSeg)},ki.prototype.compareX=function(e,t){var i=e.p0.compareTo(t.p0);return 0!==i?i:e.p1.compareTo(t.p1)},ki.prototype.toString=function(){return this._upwardSeg.toString()},ki.prototype.interfaces_=function(){return[ee]},ki.prototype.getClass=function(){return ki},function(e,t,i){this.p0=e||null,this.p1=t||null,this.p2=i||null}),Hi=(F.prototype.area=function(){return F.area(this.p0,this.p1,this.p2)},F.prototype.signedArea=function(){return F.signedArea(this.p0,this.p1,this.p2)},F.prototype.interpolateZ=function(e){if(null===e)throw new A("Supplied point is null.");return F.interpolateZ(e,this.p0,this.p1,this.p2)},F.prototype.longestSideLength=function(){return F.longestSideLength(this.p0,this.p1,this.p2)},F.prototype.isAcute=function(){return F.isAcute(this.p0,this.p1,this.p2)},F.prototype.circumcentre=function(){return F.circumcentre(this.p0,this.p1,this.p2)},F.prototype.area3D=function(){return F.area3D(this.p0,this.p1,this.p2)},F.prototype.centroid=function(){return F.centroid(this.p0,this.p1,this.p2)},F.prototype.inCentre=function(){return F.inCentre(this.p0,this.p1,this.p2)},F.prototype.interfaces_=function(){return[]},F.prototype.getClass=function(){return F},F.area=function(e,t,i){return Math.abs(((i.x-e.x)*(t.y-e.y)-(t.x-e.x)*(i.y-e.y))/2)},F.signedArea=function(e,t,i){return((i.x-e.x)*(t.y-e.y)-(t.x-e.x)*(i.y-e.y))/2},F.det=function(e,t,i,r){return e*r-t*i},F.interpolateZ=function(e,t,i,r){var n=t.x,o=t.y,s=i.x-n,a=r.x-n,l=i.y-o,u=r.y-o,c=s*u-a*l,h=e.x-n,A=e.y-o,p=(u*h-a*A)/c,f=(-l*h+s*A)/c;return t.z+p*(i.z-t.z)+f*(r.z-t.z)},F.longestSideLength=function(e,t,i){var r=e.distance(t),n=t.distance(i),o=i.distance(e),s=r;return n>s&&(s=n),o>s&&(s=o),s},F.isAcute=function(e,t,i){return!!L.isAcute(e,t,i)&&(!!L.isAcute(t,i,e)&&!!L.isAcute(i,e,t))},F.circumcentre=function(e,t,i){var r=i.x,n=i.y,o=e.x-r,s=e.y-n,a=t.x-r,l=t.y-n,u=2*F.det(o,s,a,l),c=F.det(s,o*o+s*s,l,a*a+l*l),h=F.det(o,o*o+s*s,a,a*a+l*l);return new C(r-c/u,n+h/u)},F.perpendicularBisector=function(e,t){var i=t.x-e.x,r=t.y-e.y,n=new _e(e.x+i/2,e.y+r/2,1),o=new _e(e.x-r+i/2,e.y+i+r/2,1);return new _e(n,o)},F.angleBisector=function(e,t,i){var r=t.distance(e),n=r/(r+t.distance(i)),o=i.x-e.x,s=i.y-e.y;return new C(e.x+n*o,e.y+n*s)},F.area3D=function(e,t,i){var r=t.x-e.x,n=t.y-e.y,o=t.z-e.z,s=i.x-e.x,a=i.y-e.y,l=i.z-e.z,u=n*l-o*a,c=o*s-r*l,h=r*a-n*s,A=u*u+c*c+h*h,p=Math.sqrt(A)/2;return p},F.centroid=function(e,t,i){var r=(e.x+t.x+i.x)/3,n=(e.y+t.y+i.y)/3;return new C(r,n)},F.inCentre=function(e,t,i){var r=t.distance(i),n=e.distance(i),o=e.distance(t),s=r+n+o,a=(r*e.x+n*t.x+o*i.x)/s,l=(r*e.y+n*t.y+o*i.y)/s;return new C(a,l)},function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new E;var e=arguments[0],t=arguments[1],i=arguments[2];this._inputGeom=e,this._distance=t,this._curveBuilder=i}),Qi=(Hi.prototype.addPoint=function(e){if(this._distance<=0)return null;var t=e.getCoordinates(),i=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(i,g.EXTERIOR,g.INTERIOR)},Hi.prototype.addPolygon=function(e){var t=this._distance,i=m.LEFT;this._distance<0&&(t=-this._distance,i=m.RIGHT);var r=e.getExteriorRing(),n=c.removeRepeatedPoints(r.getCoordinates());if(this._distance<0&&this.isErodedCompletely(r,this._distance))return null;if(this._distance<=0&&n.length<3)return null;this.addPolygonRing(n,t,i,g.EXTERIOR,g.INTERIOR);for(var o=0;o<e.getNumInteriorRing();o++){var s=e.getInteriorRingN(o),a=c.removeRepeatedPoints(s.getCoordinates());this._distance>0&&this.isErodedCompletely(s,-this._distance)||this.addPolygonRing(a,t,m.opposite(i),g.INTERIOR,g.EXTERIOR)}},Hi.prototype.isTriangleErodedCompletely=function(e,t){var i=new F(e[0],e[1],e[2]),r=i.inCentre();return x.distancePointLine(r,i.p0,i.p1)<Math.abs(t)},Hi.prototype.addLineString=function(e){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var t=c.removeRepeatedPoints(e.getCoordinates()),i=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(i,g.EXTERIOR,g.INTERIOR)},Hi.prototype.addCurve=function(e,t,i){if(null===e||e.length<2)return null;var r=new I(e,new h(0,g.BOUNDARY,t,i));this._curveList.add(r)},Hi.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},Hi.prototype.addPolygonRing=function(e,t,i,r,n){if(0===t&&e.length<_t.MINIMUM_VALID_SIZE)return null;var o=r,s=n;e.length>=_t.MINIMUM_VALID_SIZE&&x.isCCW(e)&&(o=n,s=r,i=m.opposite(i));var a=this._curveBuilder.getRingCurve(e,i,t);this.addCurve(a,o,s)},Hi.prototype.add=function(e){if(e.isEmpty())return null;e instanceof mt?this.addPolygon(e):e instanceof B?this.addLineString(e):e instanceof dt?this.addPoint(e):e instanceof yt?this.addCollection(e):e instanceof ut?this.addCollection(e):e instanceof vt?this.addCollection(e):e instanceof lt&&this.addCollection(e)},Hi.prototype.isErodedCompletely=function(e,t){var i=e.getCoordinates();if(i.length<4)return t<0;if(4===i.length)return this.isTriangleErodedCompletely(i,t);var r=e.getEnvelopeInternal(),n=Math.min(r.getHeight(),r.getWidth());return t<0&&2*Math.abs(t)>n},Hi.prototype.addCollection=function(e){for(var t=0;t<e.getNumGeometries();t++){var i=e.getGeometryN(t);this.add(i)}},Hi.prototype.interfaces_=function(){return[]},Hi.prototype.getClass=function(){return Hi},function(){}),Vi=(Qi.prototype.locate=function(e){},Qi.prototype.interfaces_=function(){return[]},Qi.prototype.getClass=function(){return Qi},function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var e=arguments[0];this._parent=e,this._atStart=!0,this._index=0,this._max=e.getNumGeometries()}),Gi=(Vi.prototype.next=function(){if(this._atStart)return this._atStart=!1,Vi.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new k;var e=this._parent.getGeometryN(this._index++);return e instanceof lt?(this._subcollectionIterator=new Vi(e),this._subcollectionIterator.next()):e},Vi.prototype.remove=function(){throw new Error(this.getClass().getName())},Vi.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},Vi.prototype.interfaces_=function(){return[ze]},Vi.prototype.getClass=function(){return Vi},Vi.isAtomic=function(e){return!(e instanceof lt)},function(){this._geom=null;var e=arguments[0];this._geom=e}),zi=(Gi.prototype.locate=function(e){return Gi.locate(e,this._geom)},Gi.prototype.interfaces_=function(){return[Qi]},Gi.prototype.getClass=function(){return Gi},Gi.isPointInRing=function(e,t){return!!t.getEnvelopeInternal().intersects(e)&&x.isPointInRing(e,t.getCoordinates())},Gi.containsPointInPolygon=function(e,t){if(t.isEmpty())return!1;var i=t.getExteriorRing();if(!Gi.isPointInRing(e,i))return!1;for(var r=0;r<t.getNumInteriorRing();r++){var n=t.getInteriorRingN(r);if(Gi.isPointInRing(e,n))return!1}return!0},Gi.containsPoint=function(e,t){if(t instanceof mt)return Gi.containsPointInPolygon(e,t);if(t instanceof lt)for(var i=new Vi(t);i.hasNext();){var r=i.next();if(r!==t&&Gi.containsPoint(e,r))return!0}return!1},Gi.locate=function(e,t){return t.isEmpty()?g.EXTERIOR:Gi.containsPoint(e,t)?g.INTERIOR:g.EXTERIOR},function(){this._edgeMap=new q,this._edgeList=null,this._ptInAreaLocation=[g.NONE,g.NONE]}),Wi=(zi.prototype.getNextCW=function(e){this.getEdges();var t=this._edgeList.indexOf(e),i=t-1;return 0===t&&(i=this._edgeList.size()-1),this._edgeList.get(i)},zi.prototype.propagateSideLabels=function(e){for(var t=g.NONE,i=this.iterator();i.hasNext();){var r=i.next().getLabel();r.isArea(e)&&r.getLocation(e,m.LEFT)!==g.NONE&&(t=r.getLocation(e,m.LEFT))}if(t===g.NONE)return null;for(var n=t,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getLabel();if(a.getLocation(e,m.ON)===g.NONE&&a.setLocation(e,m.ON,n),a.isArea(e)){var l=a.getLocation(e,m.LEFT),u=a.getLocation(e,m.RIGHT);if(u!==g.NONE){if(u!==n)throw new Vt("side location conflict",s.getCoordinate());l===g.NONE&&w.shouldNeverReachHere("found single null side (at "+s.getCoordinate()+")"),n=l}else w.isTrue(a.getLocation(e,m.LEFT)===g.NONE,"found single null side"),a.setLocation(e,m.RIGHT,n),a.setLocation(e,m.LEFT,n)}}},zi.prototype.getCoordinate=function(){var e=this.iterator();if(!e.hasNext())return null;return e.next().getCoordinate()},zi.prototype.print=function(e){ye.out.println("EdgeEndStar:   "+this.getCoordinate());for(var t=this.iterator();t.hasNext();)t.next().print(e)},zi.prototype.isAreaLabelsConsistent=function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},zi.prototype.checkAreaLabelsConsistent=function(e){var t=this.getEdges();if(t.size()<=0)return!0;var i=t.size()-1,r=t.get(i).getLabel().getLocation(e,m.LEFT);w.isTrue(r!==g.NONE,"Found unlabelled area edge");for(var n=r,o=this.iterator();o.hasNext();){var s=o.next().getLabel();w.isTrue(s.isArea(e),"Found non-area edge");var a=s.getLocation(e,m.LEFT),l=s.getLocation(e,m.RIGHT);if(a===l)return!1;if(l!==n)return!1;n=a}return!0},zi.prototype.findIndex=function(e){this.iterator();for(var t=0;t<this._edgeList.size();t++)if(this._edgeList.get(t)===e)return t;return-1},zi.prototype.iterator=function(){return this.getEdges().iterator()},zi.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new E(this._edgeMap.values())),this._edgeList},zi.prototype.getLocation=function(e,t,i){return this._ptInAreaLocation[e]===g.NONE&&(this._ptInAreaLocation[e]=Gi.locate(t,i[e].getGeometry())),this._ptInAreaLocation[e]},zi.prototype.toString=function(){var e=new ue;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append("\n");for(var t=this.iterator();t.hasNext();){var i=t.next();e.append(i),e.append("\n")}return e.toString()},zi.prototype.computeEdgeEndLabels=function(e){for(var t=this.iterator();t.hasNext();)t.next().computeLabel(e)},zi.prototype.computeLabelling=function(e){this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var t=[!1,!1],i=this.iterator();i.hasNext();)for(var r=i.next().getLabel(),n=0;n<2;n++)r.isLine(n)&&r.getLocation(n)===g.BOUNDARY&&(t[n]=!0);for(var o=this.iterator();o.hasNext();)for(var s=o.next(),a=s.getLabel(),l=0;l<2;l++)if(a.isAnyNull(l)){var u=g.NONE;if(t[l])u=g.EXTERIOR;else{var c=s.getCoordinate();u=this.getLocation(l,c,e)}a.setAllLocationsIfNull(l,u)}},zi.prototype.getDegree=function(){return this._edgeMap.size()},zi.prototype.insertEdgeEnd=function(e,t){this._edgeMap.put(e,t),this._edgeList=null},zi.prototype.interfaces_=function(){return[]},zi.prototype.getClass=function(){return zi},function(o){function e(){o.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return o&&(e.__proto__=o),e.prototype=Object.create(o&&o.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var e=null,t=null,i=this._SCANNING_FOR_INCOMING,r=0;r<this._resultAreaEdgeList.size();r++){var n=this._resultAreaEdgeList.get(r),o=n.getSym();if(n.getLabel().isArea())switch(null===e&&n.isInResult()&&(e=n),i){case this._SCANNING_FOR_INCOMING:if(!o.isInResult())continue;t=o,i=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!n.isInResult())continue;t.setNext(n),i=this._SCANNING_FOR_INCOMING}}if(i===this._LINKING_TO_OUTGOING){if(null===e)throw new Vt("no outgoing dirEdge found",this.getCoordinate());w.isTrue(e.isInResult(),"unable to link last incoming dirEdge"),t.setNext(e)}},e.prototype.insert=function(e){var t=e;this.insertEdgeEnd(t,t)},e.prototype.getRightmostEdge=function(){var e=this.getEdges(),t=e.size();if(t<1)return null;var i=e.get(0);if(1===t)return i;var r=e.get(t-1),n=i.getQuadrant(),o=r.getQuadrant();return d.isNorthern(n)&&d.isNorthern(o)?i:d.isNorthern(n)||d.isNorthern(o)?0!==i.getDy()?i:0!==r.getDy()?r:(w.shouldNeverReachHere("found two horizontal edges incident on node"),null):r},e.prototype.print=function(e){ye.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var t=this.iterator();t.hasNext();){var i=t.next();e.print("out "),i.print(e),e.println(),e.print("in "),i.getSym().print(e),e.println()}},e.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new E;for(var e=this.iterator();e.hasNext();){var t=e.next();(t.isInResult()||t.getSym().isInResult())&&this._resultAreaEdgeList.add(t)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(e){for(var t=this.iterator();t.hasNext();){var i=t.next().getLabel();i.setAllLocationsIfNull(0,e.getLocation(0)),i.setAllLocationsIfNull(1,e.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var e=null,t=null,i=this._edgeList.size()-1;i>=0;i--){var r=this._edgeList.get(i),n=r.getSym();null===t&&(t=n),null!==e&&n.setNext(e),e=r}t.setNext(e)},e.prototype.computeDepths=function(){if(1===arguments.length){var e=arguments[0],t=this.findIndex(e),i=e.getDepth(m.LEFT),r=e.getDepth(m.RIGHT),n=this.computeDepths(t+1,this._edgeList.size(),i);if(this.computeDepths(0,t,n)!==r)throw new Vt("depth mismatch at "+e.getCoordinate())}else if(3===arguments.length){for(var o=arguments[0],s=arguments[1],a=arguments[2],l=o;l<s;l++){var u=this._edgeList.get(l);u.setEdgeDepths(m.RIGHT,a),a=u.getDepth(m.LEFT)}return a}},e.prototype.mergeSymLabels=function(){for(var e=this.iterator();e.hasNext();){var t=e.next();t.getLabel().merge(t.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(e){for(var t=null,i=null,r=this._SCANNING_FOR_INCOMING,n=this._resultAreaEdgeList.size()-1;n>=0;n--){var o=this._resultAreaEdgeList.get(n),s=o.getSym();switch(null===t&&o.getEdgeRing()===e&&(t=o),r){case this._SCANNING_FOR_INCOMING:if(s.getEdgeRing()!==e)continue;i=s,r=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(o.getEdgeRing()!==e)continue;i.setNextMin(o),r=this._SCANNING_FOR_INCOMING}}r===this._LINKING_TO_OUTGOING&&(w.isTrue(null!==t,"found null for first outgoing dirEdge"),w.isTrue(t.getEdgeRing()===e,"unable to link last incoming dirEdge"),i.setNextMin(t))},e.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var e=0,t=this.iterator();t.hasNext();)t.next().isInResult()&&e++;return e}if(1===arguments.length){for(var i=arguments[0],r=0,n=this.iterator();n.hasNext();)n.next().getEdgeRing()===i&&r++;return r}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var e=g.NONE,t=this.iterator();t.hasNext();){var i=t.next(),r=i.getSym();if(!i.isLineEdge()){if(i.isInResult()){e=g.INTERIOR;break}if(r.isInResult()){e=g.EXTERIOR;break}}}if(e===g.NONE)return null;for(var n=e,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getSym();s.isLineEdge()?s.getEdge().setCovered(n===g.INTERIOR):(s.isInResult()&&(n=g.EXTERIOR),a.isInResult()&&(n=g.INTERIOR))}},e.prototype.computeLabelling=function(e){o.prototype.computeLabelling.call(this,e),this._label=new h(g.NONE);for(var t=this.iterator();t.hasNext();)for(var i=t.next().getEdge().getLabel(),r=0;r<2;r++){var n=i.getLocation(r);n!==g.INTERIOR&&n!==g.BOUNDARY||this._label.setLocation(r,g.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(zi)),qi=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createNode=function(e){return new jt(e,new Wi)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}($t),Ki=function e(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=e.orientation(t)},ji=(Ki.prototype.compareTo=function(e){var t=e;return Ki.compareOriented(this._pts,this._orientation,t._pts,t._orientation)},Ki.prototype.interfaces_=function(){return[ee]},Ki.prototype.getClass=function(){return Ki},Ki.orientation=function(e){return 1===c.increasingDirection(e)},Ki.compareOriented=function(e,t,i,r){for(var n=t?1:-1,o=r?1:-1,s=t?e.length:-1,a=r?i.length:-1,l=t?0:e.length-1,u=r?0:i.length-1;;){var c=e[l].compareTo(i[u]);if(0!==c)return c;var h=(l+=n)===s,A=(u+=o)===a;if(h&&!A)return-1;if(!h&&A)return 1;if(h&&A)return 0}},function(){this._edges=new E,this._ocaMap=new q}),Zi=(ji.prototype.print=function(e){e.print("MULTILINESTRING ( ");for(var t=0;t<this._edges.size();t++){var i=this._edges.get(t);t>0&&e.print(","),e.print("(");for(var r=i.getCoordinates(),n=0;n<r.length;n++)n>0&&e.print(","),e.print(r[n].x+" "+r[n].y);e.println(")")}e.print(")  ")},ji.prototype.addAll=function(e){for(var t=e.iterator();t.hasNext();)this.add(t.next())},ji.prototype.findEdgeIndex=function(e){for(var t=0;t<this._edges.size();t++)if(this._edges.get(t).equals(e))return t;return-1},ji.prototype.iterator=function(){return this._edges.iterator()},ji.prototype.getEdges=function(){return this._edges},ji.prototype.get=function(e){return this._edges.get(e)},ji.prototype.findEqualEdge=function(e){var t=new Ki(e.getCoordinates());return this._ocaMap.get(t)},ji.prototype.add=function(e){this._edges.add(e);var t=new Ki(e.getCoordinates());this._ocaMap.put(t,e)},ji.prototype.interfaces_=function(){return[]},ji.prototype.getClass=function(){return ji},function(){}),Yi=(Zi.prototype.processIntersections=function(e,t,i,r){},Zi.prototype.isDone=function(){},Zi.prototype.interfaces_=function(){return[]},Zi.prototype.getClass=function(){return Zi},function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var e=arguments[0];this._li=e}),Xi=(Yi.prototype.isTrivialIntersection=function(e,t,i,r){if(e===i&&1===this._li.getIntersectionNum()){if(Yi.isAdjacentSegments(t,r))return!0;if(e.isClosed()){var n=e.size()-1;if(0===t&&r===n||0===r&&t===n)return!0}}return!1},Yi.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Yi.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Yi.prototype.getLineIntersector=function(){return this._li},Yi.prototype.hasProperIntersection=function(){return this._hasProper},Yi.prototype.processIntersections=function(e,t,i,r){if(e===i&&t===r)return null;this.numTests++;var n=e.getCoordinates()[t],o=e.getCoordinates()[t+1],s=i.getCoordinates()[r],a=i.getCoordinates()[r+1];this._li.computeIntersection(n,o,s,a),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e,t,i,r)||(this._hasIntersection=!0,e.addIntersections(this._li,t,0),i.addIntersections(this._li,r,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},Yi.prototype.hasIntersection=function(){return this._hasIntersection},Yi.prototype.isDone=function(){return!1},Yi.prototype.hasInteriorIntersection=function(){return this._hasInterior},Yi.prototype.interfaces_=function(){return[Zi]},Yi.prototype.getClass=function(){return Yi},Yi.isAdjacentSegments=function(e,t){return 1===Math.abs(e-t)},function(){this.coord=null,this.segmentIndex=null,this.dist=null;var e=arguments[0],t=arguments[1],i=arguments[2];this.coord=new C(e),this.segmentIndex=t,this.dist=i}),Ji=(Xi.prototype.getSegmentIndex=function(){return this.segmentIndex},Xi.prototype.getCoordinate=function(){return this.coord},Xi.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)},Xi.prototype.compareTo=function(e){var t=e;return this.compare(t.segmentIndex,t.dist)},Xi.prototype.isEndPoint=function(e){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===e},Xi.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},Xi.prototype.getDistance=function(){return this.dist},Xi.prototype.compare=function(e,t){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<t?-1:this.dist>t?1:0},Xi.prototype.interfaces_=function(){return[ee]},Xi.prototype.getClass=function(){return Xi},function(){this._nodeMap=new q,this.edge=null;var e=arguments[0];this.edge=e}),$i=(Ji.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();)t.next().print(e)},Ji.prototype.iterator=function(){return this._nodeMap.values().iterator()},Ji.prototype.addSplitEdges=function(e){this.addEndpoints();for(var t=this.iterator(),i=t.next();t.hasNext();){var r=t.next(),n=this.createSplitEdge(i,r);e.add(n),i=r}},Ji.prototype.addEndpoints=function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)},Ji.prototype.createSplitEdge=function(e,t){var i=t.segmentIndex-e.segmentIndex+2,r=this.edge.pts[t.segmentIndex],n=t.dist>0||!t.coord.equals2D(r);n||i--;var o=new Array(i).fill(null),s=0;o[s++]=new C(e.coord);for(var a=e.segmentIndex+1;a<=t.segmentIndex;a++)o[s++]=this.edge.pts[a];return n&&(o[s]=t.coord),new rr(o,new h(this.edge._label))},Ji.prototype.add=function(e,t,i){var r=new Xi(e,t,i),n=this._nodeMap.get(r);return null!==n?n:(this._nodeMap.put(r,r),r)},Ji.prototype.isIntersection=function(e){for(var t=this.iterator();t.hasNext();)if(t.next().coord.equals(e))return!0;return!1},Ji.prototype.interfaces_=function(){return[]},Ji.prototype.getClass=function(){return Ji},function(){}),er=($i.prototype.getChainStartIndices=function(e){var t=0,i=new E;i.add(new ce(t));do{var r=this.findChainEnd(e,t);i.add(new ce(r)),t=r}while(t<e.length-1);return $i.toIntArray(i)},$i.prototype.findChainEnd=function(e,t){for(var i=d.quadrant(e[t],e[t+1]),r=t+1;r<e.length;){if(d.quadrant(e[r-1],e[r])!==i)break;r++}return r-1},$i.prototype.interfaces_=function(){return[]},$i.prototype.getClass=function(){return $i},$i.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),i=0;i<t.length;i++)t[i]=e.get(i).intValue();return t},function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new u,this.env2=new u;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var t=new $i;this.startIndex=t.getChainStartIndices(this.pts)}),tr=(er.prototype.getCoordinates=function(){return this.pts},er.prototype.getMaxX=function(e){var t=this.pts[this.startIndex[e]].x,i=this.pts[this.startIndex[e+1]].x;return t>i?t:i},er.prototype.getMinX=function(e){var t=this.pts[this.startIndex[e]].x,i=this.pts[this.startIndex[e+1]].x;return t<i?t:i},er.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var e=arguments[0],t=arguments[1],i=arguments[2],r=arguments[3];this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],t,t.startIndex[i],t.startIndex[i+1],r)}else if(6===arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3],l=arguments[4],u=arguments[5],c=this.pts[n],h=this.pts[o],A=s.pts[a],p=s.pts[l];if(o-n==1&&l-a==1)return u.addIntersections(this.e,n,s.e,a),null;if(this.env1.init(c,h),this.env2.init(A,p),!this.env1.intersects(this.env2))return null;var f=Math.trunc((n+o)/2),d=Math.trunc((a+l)/2);n<f&&(a<d&&this.computeIntersectsForChain(n,f,s,a,d,u),d<l&&this.computeIntersectsForChain(n,f,s,d,l,u)),f<o&&(a<d&&this.computeIntersectsForChain(f,o,s,a,d,u),d<l&&this.computeIntersectsForChain(f,o,s,d,l,u))}},er.prototype.getStartIndexes=function(){return this.startIndex},er.prototype.computeIntersects=function(e,t){for(var i=0;i<this.startIndex.length-1;i++)for(var r=0;r<e.startIndex.length-1;r++)this.computeIntersectsForChain(i,e,r,t)},er.prototype.interfaces_=function(){return[]},er.prototype.getClass=function(){return er},function e(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var t=0;t<2;t++)for(var i=0;i<3;i++)this._depth[t][i]=e.NULL_VALUE}),ir={NULL_VALUE:{configurable:!0}},rr=(tr.prototype.getDepth=function(e,t){return this._depth[e][t]},tr.prototype.setDepth=function(e,t,i){this._depth[e][t]=i},tr.prototype.isNull=function(){if(0===arguments.length){for(var e=0;e<2;e++)for(var t=0;t<3;t++)if(this._depth[e][t]!==tr.NULL_VALUE)return!1;return!0}if(1===arguments.length){var i=arguments[0];return this._depth[i][1]===tr.NULL_VALUE}if(2===arguments.length){var r=arguments[0],n=arguments[1];return this._depth[r][n]===tr.NULL_VALUE}},tr.prototype.normalize=function(){for(var e=0;e<2;e++)if(!this.isNull(e)){var t=this._depth[e][1];this._depth[e][2]<t&&(t=this._depth[e][2]),t<0&&(t=0);for(var i=1;i<3;i++){var r=0;this._depth[e][i]>t&&(r=1),this._depth[e][i]=r}}},tr.prototype.getDelta=function(e){return this._depth[e][m.RIGHT]-this._depth[e][m.LEFT]},tr.prototype.getLocation=function(e,t){return this._depth[e][t]<=0?g.EXTERIOR:g.INTERIOR},tr.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},tr.prototype.add=function(){if(1===arguments.length)for(var e=arguments[0],t=0;t<2;t++)for(var i=1;i<3;i++){var r=e.getLocation(t,i);r!==g.EXTERIOR&&r!==g.INTERIOR||(this.isNull(t,i)?this._depth[t][i]=tr.depthAtLocation(r):this._depth[t][i]+=tr.depthAtLocation(r))}else if(3===arguments.length){var n=arguments[0],o=arguments[1];arguments[2]===g.INTERIOR&&this._depth[n][o]++}},tr.prototype.interfaces_=function(){return[]},tr.prototype.getClass=function(){return tr},tr.depthAtLocation=function(e){return e===g.EXTERIOR?0:e===g.INTERIOR?1:tr.NULL_VALUE},ir.NULL_VALUE.get=function(){return-1},Object.defineProperties(tr,ir),function(r){function s(){if(r.call(this),this.pts=null,this._env=null,this.eiList=new Ji(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new tr,this._depthDelta=0,1===arguments.length){var e=arguments[0];s.call(this,e,null)}else if(2===arguments.length){var t=arguments[0],i=arguments[1];this.pts=t,this._label=i}}return r&&(s.__proto__=r),s.prototype=Object.create(r&&r.prototype),s.prototype.constructor=s,s.prototype.getDepth=function(){return this._depth},s.prototype.getCollapsedEdge=function(){var e=new Array(2).fill(null);e[0]=this.pts[0],e[1]=this.pts[1];return new s(e,h.toLineLabel(this._label))},s.prototype.isIsolated=function(){return this._isIsolated},s.prototype.getCoordinates=function(){return this.pts},s.prototype.setIsolated=function(e){this._isIsolated=e},s.prototype.setName=function(e){this._name=e},s.prototype.equals=function(e){if(!(e instanceof s))return!1;var t=e;if(this.pts.length!==t.pts.length)return!1;for(var i=!0,r=!0,n=this.pts.length,o=0;o<this.pts.length;o++)if(this.pts[o].equals2D(t.pts[o])||(i=!1),this.pts[o].equals2D(t.pts[--n])||(r=!1),!i&&!r)return!1;return!0},s.prototype.getCoordinate=function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var e=arguments[0];return this.pts[e]}},s.prototype.print=function(e){e.print("edge "+this._name+": "),e.print("LINESTRING (");for(var t=0;t<this.pts.length;t++)t>0&&e.print(","),e.print(this.pts[t].x+" "+this.pts[t].y);e.print(")  "+this._label+" "+this._depthDelta)},s.prototype.computeIM=function(e){s.updateIM(this._label,e)},s.prototype.isCollapsed=function(){return!!this._label.isArea()&&(3===this.pts.length&&!!this.pts[0].equals(this.pts[2]))},s.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},s.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},s.prototype.getDepthDelta=function(){return this._depthDelta},s.prototype.getNumPoints=function(){return this.pts.length},s.prototype.printReverse=function(e){e.print("edge "+this._name+": ");for(var t=this.pts.length-1;t>=0;t--)e.print(this.pts[t]+" ");e.println("")},s.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new er(this)),this._mce},s.prototype.getEnvelope=function(){if(null===this._env){this._env=new u;for(var e=0;e<this.pts.length;e++)this._env.expandToInclude(this.pts[e])}return this._env},s.prototype.addIntersection=function(e,t,i,r){var n=new C(e.getIntersection(r)),o=t,s=e.getEdgeDistance(i,r),a=o+1;if(a<this.pts.length){var l=this.pts[a];n.equals2D(l)&&(o=a,s=0)}this.eiList.add(n,o,s)},s.prototype.toString=function(){var e=new ue;e.append("edge "+this._name+": "),e.append("LINESTRING (");for(var t=0;t<this.pts.length;t++)t>0&&e.append(","),e.append(this.pts[t].x+" "+this.pts[t].y);return e.append(")  "+this._label+" "+this._depthDelta),e.toString()},s.prototype.isPointwiseEqual=function(e){if(this.pts.length!==e.pts.length)return!1;for(var t=0;t<this.pts.length;t++)if(!this.pts[t].equals2D(e.pts[t]))return!1;return!0},s.prototype.setDepthDelta=function(e){this._depthDelta=e},s.prototype.getEdgeIntersectionList=function(){return this.eiList},s.prototype.addIntersections=function(e,t,i){for(var r=0;r<e.getIntersectionNum();r++)this.addIntersection(e,t,i,r)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s.updateIM=function(){if(2!==arguments.length)return r.prototype.updateIM.apply(this,arguments);var e=arguments[0],t=arguments[1];t.setAtLeastIfValid(e.getLocation(0,m.ON),e.getLocation(1,m.ON),1),e.isArea()&&(t.setAtLeastIfValid(e.getLocation(0,m.LEFT),e.getLocation(1,m.LEFT),2),t.setAtLeastIfValid(e.getLocation(0,m.RIGHT),e.getLocation(1,m.RIGHT),2))},s}(Kt)),nr=function(e){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new ji,this._bufParams=e||null},or=(nr.prototype.setWorkingPrecisionModel=function(e){this._workingPrecisionModel=e},nr.prototype.insertUniqueEdge=function(e){var t=this._edgeList.findEqualEdge(e);if(null!==t){var i=t.getLabel(),r=e.getLabel();t.isPointwiseEqual(e)||(r=new h(e.getLabel())).flip(),i.merge(r);var n=nr.depthDelta(r),o=t.getDepthDelta()+n;t.setDepthDelta(o)}else this._edgeList.add(e),e.setDepthDelta(nr.depthDelta(e.getLabel()))},nr.prototype.buildSubgraphs=function(e,t){for(var i=new E,r=e.iterator();r.hasNext();){var n=r.next(),o=n.getRightmostCoordinate(),s=new Ri(i).getDepth(o);n.computeDepth(s),n.findResultEdges(),i.add(n),t.add(n.getDirectedEdges(),n.getNodes())}},nr.prototype.createSubgraphs=function(e){for(var t=new E,i=e.getNodes().iterator();i.hasNext();){var r=i.next();if(!r.isVisited()){var n=new zt;n.create(r),t.add(n)}}return li.sort(t,li.reverseOrder()),t},nr.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},nr.prototype.getNoder=function(e){if(null!==this._workingNoder)return this._workingNoder;var t=new Ii,i=new Se;return i.setPrecisionModel(e),t.setSegmentIntersector(new Yi(i)),t},nr.prototype.buffer=function(e,t){var i=this._workingPrecisionModel;null===i&&(i=e.getPrecisionModel()),this._geomFact=e.getFactory();var r=new Oi(i,this._bufParams),n=new Hi(e,t,r).getCurves();if(n.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(n,i),this._graph=new M(new qi),this._graph.addEdges(this._edgeList.getEdges());var o=this.createSubgraphs(this._graph),s=new ei(this._geomFact);this.buildSubgraphs(o,s);var a=s.getPolygons();if(a.size()<=0)return this.createEmptyResultGeometry();return this._geomFact.buildGeometry(a)},nr.prototype.computeNodedEdges=function(e,t){var i=this.getNoder(t);i.computeNodes(e);for(var r=i.getNodedSubstrings().iterator();r.hasNext();){var n=r.next(),o=n.getCoordinates();if(2!==o.length||!o[0].equals2D(o[1])){var s=n.getData(),a=new rr(n.getCoordinates(),new h(s));this.insertUniqueEdge(a)}}},nr.prototype.setNoder=function(e){this._workingNoder=e},nr.prototype.interfaces_=function(){return[]},nr.prototype.getClass=function(){return nr},nr.depthDelta=function(e){var t=e.getLocation(0,m.LEFT),i=e.getLocation(0,m.RIGHT);return t===g.INTERIOR&&i===g.EXTERIOR?1:t===g.EXTERIOR&&i===g.INTERIOR?-1:0},nr.convertSegStrings=function(e){for(var t=new l,i=new E;e.hasNext();){var r=e.next(),n=t.createLineString(r.getCoordinates());i.add(n)}return t.buildGeometry(i)},function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var e=arguments[0],t=arguments[1];this._noder=e,this._scaleFactor=t,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2],o=arguments[3];this._noder=i,this._scaleFactor=r,this._offsetX=n,this._offsetY=o,this._isScaled=!this.isIntegerPrecision()}}),sr=(or.prototype.rescale=function(){if(_(arguments[0],Ge))for(var e=arguments[0].iterator();e.hasNext();){var t=e.next();this.rescale(t.getCoordinates())}else if(arguments[0]instanceof Array){for(var i=arguments[0],r=0;r<i.length;r++)i[r].x=i[r].x/this._scaleFactor+this._offsetX,i[r].y=i[r].y/this._scaleFactor+this._offsetY;2===i.length&&i[0].equals2D(i[1])&&ye.out.println(i)}},or.prototype.scale=function(){if(_(arguments[0],Ge)){for(var e=arguments[0],t=new E,i=e.iterator();i.hasNext();){var r=i.next();t.add(new I(this.scale(r.getCoordinates()),r.getData()))}return t}if(arguments[0]instanceof Array){for(var n=arguments[0],o=new Array(n.length).fill(null),s=0;s<n.length;s++)o[s]=new C(Math.round((n[s].x-this._offsetX)*this._scaleFactor),Math.round((n[s].y-this._offsetY)*this._scaleFactor),n[s].z);return c.removeRepeatedPoints(o)}},or.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},or.prototype.getNodedSubstrings=function(){var e=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(e),e},or.prototype.computeNodes=function(e){var t=e;this._isScaled&&(t=this.scale(e)),this._noder.computeNodes(t)},or.prototype.interfaces_=function(){return[Bi]},or.prototype.getClass=function(){return or},function(){this._li=new Se,this._segStrings=null;var e=arguments[0];this._segStrings=e}),ar={fact:{configurable:!0}},lr=(sr.prototype.checkEndPtVertexIntersections=function(){if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var t=e.next().getCoordinates();this.checkEndPtVertexIntersections(t[0],this._segStrings),this.checkEndPtVertexIntersections(t[t.length-1],this._segStrings)}else if(2===arguments.length)for(var i=arguments[0],r=arguments[1].iterator();r.hasNext();)for(var n=r.next().getCoordinates(),o=1;o<n.length-1;o++)if(n[o].equals(i))throw new Be("found endpt/interior pt intersection at index "+o+" :pt "+i)},sr.prototype.checkInteriorIntersections=function(){if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();)for(var t=e.next(),i=this._segStrings.iterator();i.hasNext();){var r=i.next();this.checkInteriorIntersections(t,r)}else if(2===arguments.length)for(var n=arguments[0],o=arguments[1],s=n.getCoordinates(),a=o.getCoordinates(),l=0;l<s.length-1;l++)for(var u=0;u<a.length-1;u++)this.checkInteriorIntersections(n,l,o,u);else if(4===arguments.length){var c=arguments[0],h=arguments[1],A=arguments[2],p=arguments[3];if(c===A&&h===p)return null;var f=c.getCoordinates()[h],d=c.getCoordinates()[h+1],g=A.getCoordinates()[p],m=A.getCoordinates()[p+1];if(this._li.computeIntersection(f,d,g,m),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,f,d)||this.hasInteriorIntersection(this._li,g,m)))throw new Be("found non-noded intersection at "+f+"-"+d+" and "+g+"-"+m)}},sr.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},sr.prototype.checkCollapses=function(){if(0===arguments.length)for(var e=this._segStrings.iterator();e.hasNext();){var t=e.next();this.checkCollapses(t)}else if(1===arguments.length)for(var i=arguments[0].getCoordinates(),r=0;r<i.length-2;r++)this.checkCollapse(i[r],i[r+1],i[r+2])},sr.prototype.hasInteriorIntersection=function(e,t,i){for(var r=0;r<e.getIntersectionNum();r++){var n=e.getIntersection(r);if(!n.equals(t)&&!n.equals(i))return!0}return!1},sr.prototype.checkCollapse=function(e,t,i){if(e.equals(i))throw new Be("found non-noded collapse at "+sr.fact.createLineString([e,t,i]))},sr.prototype.interfaces_=function(){return[]},sr.prototype.getClass=function(){return sr},ar.fact.get=function(){return new l},Object.defineProperties(sr,ar),function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var e=arguments[0],t=arguments[1],i=arguments[2];if(this._originalPt=e,this._pt=e,this._scaleFactor=t,this._li=i,t<=0)throw new A("Scale factor must be non-zero");1!==t&&(this._pt=new C(this.scale(e.x),this.scale(e.y)),this._p0Scaled=new C,this._p1Scaled=new C),this.initCorners(this._pt)}),ur={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}},cr=(lr.prototype.intersectsScaled=function(e,t){var i=Math.min(e.x,t.x),r=Math.max(e.x,t.x),n=Math.min(e.y,t.y),o=Math.max(e.y,t.y),s=this._maxx<i||this._minx>r||this._maxy<n||this._miny>o;if(s)return!1;var a=this.intersectsToleranceSquare(e,t);return w.isTrue(!(s&&a),"Found bad envelope test"),a},lr.prototype.initCorners=function(e){this._minx=e.x-.5,this._maxx=e.x+.5,this._miny=e.y-.5,this._maxy=e.y+.5,this._corner[0]=new C(this._maxx,this._maxy),this._corner[1]=new C(this._minx,this._maxy),this._corner[2]=new C(this._minx,this._miny),this._corner[3]=new C(this._maxx,this._miny)},lr.prototype.intersects=function(e,t){return 1===this._scaleFactor?this.intersectsScaled(e,t):(this.copyScaled(e,this._p0Scaled),this.copyScaled(t,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},lr.prototype.scale=function(e){return Math.round(e*this._scaleFactor)},lr.prototype.getCoordinate=function(){return this._originalPt},lr.prototype.copyScaled=function(e,t){t.x=this.scale(e.x),t.y=this.scale(e.y)},lr.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var e=lr.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new u(this._originalPt.x-e,this._originalPt.x+e,this._originalPt.y-e,this._originalPt.y+e)}return this._safeEnv},lr.prototype.intersectsPixelClosure=function(e,t){return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))},lr.prototype.intersectsToleranceSquare=function(e,t){var i=!1,r=!1;return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(i=!0),this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),!!this._li.isProper()||(!(!i||!r)||(!!e.equals(this._pt)||!!t.equals(this._pt))))))},lr.prototype.addSnappedNode=function(e,t){var i=e.getCoordinate(t),r=e.getCoordinate(t+1);return!!this.intersects(i,r)&&(e.addIntersection(this.getCoordinate(),t),!0)},lr.prototype.interfaces_=function(){return[]},lr.prototype.getClass=function(){return lr},ur.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(lr,ur),function(){this.tempEnv1=new u,this.selectedSegment=new S}),hr=(cr.prototype.select=function(){if(1===arguments.length);else if(2===arguments.length){var e=arguments[0],t=arguments[1];e.getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}},cr.prototype.interfaces_=function(){return[]},cr.prototype.getClass=function(){return cr},function(){this._index=null;var e=arguments[0];this._index=e}),Ar={HotPixelSnapAction:{configurable:!0}},pr=(hr.prototype.snap=function(){if(1===arguments.length){var e=arguments[0];return this.snap(e,null,-1)}if(3===arguments.length){var t=arguments[0],i=arguments[1],r=arguments[2],n=t.getSafeEnvelope(),o=new pr(t,i,r);return this._index.query(n,{interfaces_:function(){return[ni]},visitItem:function(e){e.select(n,o)}}),o.isNodeAdded()}},hr.prototype.interfaces_=function(){return[]},hr.prototype.getClass=function(){return hr},Ar.HotPixelSnapAction.get=function(){return pr},Object.defineProperties(hr,Ar),function(r){function e(){r.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var e=arguments[0],t=arguments[1],i=arguments[2];this._hotPixel=e,this._parentEdge=t,this._hotPixelVertexIndex=i}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(2!==arguments.length)return r.prototype.select.apply(this,arguments);var e=arguments[0],t=arguments[1],i=e.getContext();if(null!==this._parentEdge&&i===this._parentEdge&&t===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(i,t)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(cr)),fr=function(){this._li=null,this._interiorIntersections=null;var e=arguments[0];this._li=e,this._interiorIntersections=new E},dr=(fr.prototype.processIntersections=function(e,t,i,r){if(e===i&&t===r)return null;var n=e.getCoordinates()[t],o=e.getCoordinates()[t+1],s=i.getCoordinates()[r],a=i.getCoordinates()[r+1];if(this._li.computeIntersection(n,o,s,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var l=0;l<this._li.getIntersectionNum();l++)this._interiorIntersections.add(this._li.getIntersection(l));e.addIntersections(this._li,t,0),i.addIntersections(this._li,r,1)}},fr.prototype.isDone=function(){return!1},fr.prototype.getInteriorIntersections=function(){return this._interiorIntersections},fr.prototype.interfaces_=function(){return[Zi]},fr.prototype.getClass=function(){return fr},function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var e=arguments[0];this._pm=e,this._li=new Se,this._li.setPrecisionModel(e),this._scaleFactor=e.getScale()}),gr=(dr.prototype.checkCorrectness=function(e){var t=I.getNodedSubstrings(e),i=new sr(t);try{i.checkValid()}catch(e){if(!(e instanceof ge))throw e;e.printStackTrace()}},dr.prototype.getNodedSubstrings=function(){return I.getNodedSubstrings(this._nodedSegStrings)},dr.prototype.snapRound=function(e,t){var i=this.findInteriorIntersections(e,t);this.computeIntersectionSnaps(i),this.computeVertexSnaps(e)},dr.prototype.findInteriorIntersections=function(e,t){var i=new fr(t);return this._noder.setSegmentIntersector(i),this._noder.computeNodes(e),i.getInteriorIntersections()},dr.prototype.computeVertexSnaps=function(){if(_(arguments[0],Ge))for(var e=arguments[0].iterator();e.hasNext();){var t=e.next();this.computeVertexSnaps(t)}else if(arguments[0]instanceof I)for(var i=arguments[0],r=i.getCoordinates(),n=0;n<r.length;n++){var o=new lr(r[n],this._scaleFactor,this._li);this._pointSnapper.snap(o,i,n)&&i.addIntersection(r[n],n)}},dr.prototype.computeNodes=function(e){this._nodedSegStrings=e,this._noder=new Ii,this._pointSnapper=new hr(this._noder.getIndex()),this.snapRound(e,this._li)},dr.prototype.computeIntersectionSnaps=function(e){for(var t=e.iterator();t.hasNext();){var i=t.next(),r=new lr(i,this._scaleFactor,this._li);this._pointSnapper.snap(r)}},dr.prototype.interfaces_=function(){return[Bi]},dr.prototype.getClass=function(){return dr},function(){if(this._argGeom=null,this._distance=null,this._bufParams=new P,this._resultGeometry=null,this._saveException=null,1===arguments.length){var e=arguments[0];this._argGeom=e}else if(2===arguments.length){var t=arguments[0],i=arguments[1];this._argGeom=t,this._bufParams=i}}),mr={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}},yr=(gr.prototype.bufferFixedPrecision=function(e){var t=new or(new dr(new a(1)),e.getScale()),i=new nr(this._bufParams);i.setWorkingPrecisionModel(e),i.setNoder(t),this._resultGeometry=i.buffer(this._argGeom,this._distance)},gr.prototype.bufferReducedPrecision=function(){var e=this;if(0===arguments.length){for(var t=gr.MAX_PRECISION_DIGITS;t>=0;t--){try{e.bufferReducedPrecision(t)}catch(t){if(!(t instanceof Vt))throw t;e._saveException=t}if(null!==e._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var i=arguments[0],r=gr.precisionScaleFactor(this._argGeom,this._distance,i),n=new a(r);this.bufferFixedPrecision(n)}},gr.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var e=this._argGeom.getFactory().getPrecisionModel();e.getType()===a.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()},gr.prototype.setQuadrantSegments=function(e){this._bufParams.setQuadrantSegments(e)},gr.prototype.bufferOriginalPrecision=function(){try{var e=new nr(this._bufParams);this._resultGeometry=e.buffer(this._argGeom,this._distance)}catch(e){if(!(e instanceof Be))throw e;this._saveException=e}},gr.prototype.getResultGeometry=function(e){return this._distance=e,this.computeGeometry(),this._resultGeometry},gr.prototype.setEndCapStyle=function(e){this._bufParams.setEndCapStyle(e)},gr.prototype.interfaces_=function(){return[]},gr.prototype.getClass=function(){return gr},gr.bufferOp=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return new gr(e).getResultGeometry(t)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof b&&"number"==typeof arguments[1]){var i=arguments[0],r=arguments[1],n=arguments[2],o=new gr(i);o.setQuadrantSegments(n);return o.getResultGeometry(r)}if(arguments[2]instanceof P&&arguments[0]instanceof b&&"number"==typeof arguments[1]){var s=arguments[0],a=arguments[1],l=arguments[2];return new gr(s,l).getResultGeometry(a)}}else if(4===arguments.length){var u=arguments[0],c=arguments[1],h=arguments[2],A=arguments[3],p=new gr(u);p.setQuadrantSegments(h),p.setEndCapStyle(A);return p.getResultGeometry(c)}},gr.precisionScaleFactor=function(e,t,i){var r=e.getEnvelopeInternal(),n=ae.max(Math.abs(r.getMaxX()),Math.abs(r.getMaxY()),Math.abs(r.getMinX()),Math.abs(r.getMinY()))+2*(t>0?t:0),o=i-Math.trunc(Math.log(n)/Math.log(10)+1);return Math.pow(10,o)},mr.CAP_ROUND.get=function(){return P.CAP_ROUND},mr.CAP_BUTT.get=function(){return P.CAP_FLAT},mr.CAP_FLAT.get=function(){return P.CAP_FLAT},mr.CAP_SQUARE.get=function(){return P.CAP_SQUARE},mr.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(gr,mr),function(){this._pt=[new C,new C],this._distance=y.NaN,this._isNull=!0}),_r=(yr.prototype.getCoordinates=function(){return this._pt},yr.prototype.getCoordinate=function(e){return this._pt[e]},yr.prototype.setMinimum=function(){if(1===arguments.length){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(2===arguments.length){var t=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(t,i),null;var r=t.distance(i);r<this._distance&&this.initialize(t,i,r)}},yr.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2];this._pt[0].setCoordinate(i),this._pt[1].setCoordinate(r),this._distance=n,this._isNull=!1}},yr.prototype.getDistance=function(){return this._distance},yr.prototype.setMaximum=function(){if(1===arguments.length){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(2===arguments.length){var t=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(t,i),null;var r=t.distance(i);r>this._distance&&this.initialize(t,i,r)}},yr.prototype.interfaces_=function(){return[]},yr.prototype.getClass=function(){return yr},function(){}),vr=(_r.prototype.interfaces_=function(){return[]},_r.prototype.getClass=function(){return _r},_r.computeDistance=function(){if(arguments[2]instanceof yr&&arguments[0]instanceof B&&arguments[1]instanceof C)for(var e=arguments[0],t=arguments[1],i=arguments[2],r=e.getCoordinates(),n=new S,o=0;o<r.length-1;o++){n.setCoordinates(r[o],r[o+1]);var s=n.closestPoint(t);i.setMinimum(s,t)}else if(arguments[2]instanceof yr&&arguments[0]instanceof mt&&arguments[1]instanceof C){var a=arguments[0],l=arguments[1],u=arguments[2];_r.computeDistance(a.getExteriorRing(),l,u);for(var c=0;c<a.getNumInteriorRing();c++)_r.computeDistance(a.getInteriorRingN(c),l,u)}else if(arguments[2]instanceof yr&&arguments[0]instanceof b&&arguments[1]instanceof C){var h=arguments[0],A=arguments[1],p=arguments[2];if(h instanceof B)_r.computeDistance(h,A,p);else if(h instanceof mt)_r.computeDistance(h,A,p);else if(h instanceof lt)for(var f=h,d=0;d<f.getNumGeometries();d++){var g=f.getGeometryN(d);_r.computeDistance(g,A,p)}else p.setMinimum(h.getCoordinate(),A)}else if(arguments[2]instanceof yr&&arguments[0]instanceof S&&arguments[1]instanceof C){var m=arguments[0],y=arguments[1],_=arguments[2],v=m.closestPoint(y);_.setMinimum(v,y)}},function(e){this._maxPtDist=new yr,this._inputGeom=e||null}),Cr={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}},wr=(vr.prototype.computeMaxMidpointDistance=function(e){var t=new xr(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())},vr.prototype.computeMaxVertexDistance=function(e){var t=new wr(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())},vr.prototype.findDistance=function(e){return this.computeMaxVertexDistance(e),this.computeMaxMidpointDistance(e),this._maxPtDist.getDistance()},vr.prototype.getDistancePoints=function(){return this._maxPtDist},vr.prototype.interfaces_=function(){return[]},vr.prototype.getClass=function(){return vr},Cr.MaxPointDistanceFilter.get=function(){return wr},Cr.MaxMidpointDistanceFilter.get=function(){return xr},Object.defineProperties(vr,Cr),function(e){this._maxPtDist=new yr,this._minPtDist=new yr,this._geom=e||null}),xr=(wr.prototype.filter=function(e){this._minPtDist.initialize(),_r.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},wr.prototype.getMaxPointDistance=function(){return this._maxPtDist},wr.prototype.interfaces_=function(){return[Oe]},wr.prototype.getClass=function(){return wr},function(e){this._maxPtDist=new yr,this._minPtDist=new yr,this._geom=e||null}),br=(xr.prototype.filter=function(e,t){if(0===t)return null;var i=e.getCoordinate(t-1),r=e.getCoordinate(t),n=new C((i.x+r.x)/2,(i.y+r.y)/2);this._minPtDist.initialize(),_r.computeDistance(this._geom,n,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},xr.prototype.isDone=function(){return!1},xr.prototype.isGeometryChanged=function(){return!1},xr.prototype.getMaxPointDistance=function(){return this._maxPtDist},xr.prototype.interfaces_=function(){return[at]},xr.prototype.getClass=function(){return xr},function(e){this._comps=e||null}),Er=(br.prototype.filter=function(e){e instanceof mt&&this._comps.add(e)},br.prototype.interfaces_=function(){return[st]},br.prototype.getClass=function(){return br},br.getPolygons=function(){if(1===arguments.length){var e=arguments[0];return br.getPolygons(e,new E)}if(2===arguments.length){var t=arguments[0],i=arguments[1];return t instanceof mt?i.add(t):t instanceof lt&&t.apply(new br(i)),i}},function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length){var e=arguments[0];this._lines=e}else if(2===arguments.length){var t=arguments[0],i=arguments[1];this._lines=t,this._isForcedToLineString=i}}),Br=(Er.prototype.filter=function(e){if(this._isForcedToLineString&&e instanceof _t){var t=e.getFactory().createLineString(e.getCoordinateSequence());return this._lines.add(t),null}e instanceof B&&this._lines.add(e)},Er.prototype.setForceToLineString=function(e){this._isForcedToLineString=e},Er.prototype.interfaces_=function(){return[De]},Er.prototype.getClass=function(){return Er},Er.getGeometry=function(){if(1===arguments.length){var e=arguments[0];return e.getFactory().buildGeometry(Er.getLines(e))}if(2===arguments.length){var t=arguments[0],i=arguments[1];return t.getFactory().buildGeometry(Er.getLines(t,i))}},Er.getLines=function(){if(1===arguments.length){var e=arguments[0];return Er.getLines(e,!1)}if(2===arguments.length){if(_(arguments[0],Ge)&&_(arguments[1],Ge)){for(var t=arguments[0],i=arguments[1],r=t.iterator();r.hasNext();){var n=r.next();Er.getLines(n,i)}return i}if(arguments[0]instanceof b&&"boolean"==typeof arguments[1]){var o=arguments[0],s=arguments[1],a=new E;return o.apply(new Er(a,s)),a}if(arguments[0]instanceof b&&_(arguments[1],Ge)){var l=arguments[0],u=arguments[1];return l instanceof B?u.add(l):l.apply(new Er(u)),u}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&_(arguments[0],Ge)&&_(arguments[1],Ge)){for(var c=arguments[0],h=arguments[1],A=arguments[2],p=c.iterator();p.hasNext();){var f=p.next();Er.getLines(f,h,A)}return h}if("boolean"==typeof arguments[2]&&arguments[0]instanceof b&&_(arguments[1],Ge)){var d=arguments[0],g=arguments[1],m=arguments[2];return d.apply(new Er(g,m)),g}}},function(){if(this._boundaryRule=Re.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0===arguments.length);else if(1===arguments.length){var e=arguments[0];if(null===e)throw new A("Rule must be non-null");this._boundaryRule=e}}),Mr=(Br.prototype.locateInternal=function(){if(arguments[0]instanceof C&&arguments[1]instanceof mt){var e=arguments[0],t=arguments[1];if(t.isEmpty())return g.EXTERIOR;var i=t.getExteriorRing(),r=this.locateInPolygonRing(e,i);if(r===g.EXTERIOR)return g.EXTERIOR;if(r===g.BOUNDARY)return g.BOUNDARY;for(var n=0;n<t.getNumInteriorRing();n++){var o=t.getInteriorRingN(n),s=this.locateInPolygonRing(e,o);if(s===g.INTERIOR)return g.EXTERIOR;if(s===g.BOUNDARY)return g.BOUNDARY}return g.INTERIOR}if(arguments[0]instanceof C&&arguments[1]instanceof B){var a=arguments[0],l=arguments[1];if(!l.getEnvelopeInternal().intersects(a))return g.EXTERIOR;var u=l.getCoordinates();return l.isClosed()||!a.equals(u[0])&&!a.equals(u[u.length-1])?x.isOnLine(a,u)?g.INTERIOR:g.EXTERIOR:g.BOUNDARY}if(arguments[0]instanceof C&&arguments[1]instanceof dt){var c=arguments[0];return arguments[1].getCoordinate().equals2D(c)?g.INTERIOR:g.EXTERIOR}},Br.prototype.locateInPolygonRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?x.locatePointInRing(e,t.getCoordinates()):g.EXTERIOR},Br.prototype.intersects=function(e,t){return this.locate(e,t)!==g.EXTERIOR},Br.prototype.updateLocationInfo=function(e){e===g.INTERIOR&&(this._isIn=!0),e===g.BOUNDARY&&this._numBoundaries++},Br.prototype.computeLocation=function(e,t){if(t instanceof dt&&this.updateLocationInfo(this.locateInternal(e,t)),t instanceof B)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof mt)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof ut)for(var i=t,r=0;r<i.getNumGeometries();r++){var n=i.getGeometryN(r);this.updateLocationInfo(this.locateInternal(e,n))}else if(t instanceof vt)for(var o=t,s=0;s<o.getNumGeometries();s++){var a=o.getGeometryN(s);this.updateLocationInfo(this.locateInternal(e,a))}else if(t instanceof lt)for(var l=new Vi(t);l.hasNext();){var u=l.next();u!==t&&this.computeLocation(e,u)}},Br.prototype.locate=function(e,t){return t.isEmpty()?g.EXTERIOR:t instanceof B?this.locateInternal(e,t):t instanceof mt?this.locateInternal(e,t):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(e,t),this._boundaryRule.isInBoundary(this._numBoundaries)?g.BOUNDARY:this._numBoundaries>0||this._isIn?g.INTERIOR:g.EXTERIOR)},Br.prototype.interfaces_=function(){return[]},Br.prototype.getClass=function(){return Br},function e(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length){var t=arguments[0],i=arguments[1];e.call(this,t,e.INSIDE_AREA,i)}else if(3===arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2];this._component=r,this._segIndex=n,this._pt=o}}),Ir={INSIDE_AREA:{configurable:!0}},Sr=(Mr.prototype.isInsideArea=function(){return this._segIndex===Mr.INSIDE_AREA},Mr.prototype.getCoordinate=function(){return this._pt},Mr.prototype.getGeometryComponent=function(){return this._component},Mr.prototype.getSegmentIndex=function(){return this._segIndex},Mr.prototype.interfaces_=function(){return[]},Mr.prototype.getClass=function(){return Mr},Ir.INSIDE_AREA.get=function(){return-1},Object.defineProperties(Mr,Ir),function(e){this._pts=e||null}),Pr=(Sr.prototype.filter=function(e){e instanceof dt&&this._pts.add(e)},Sr.prototype.interfaces_=function(){return[st]},Sr.prototype.getClass=function(){return Sr},Sr.getPoints=function(){if(1===arguments.length){var e=arguments[0];return e instanceof dt?li.singletonList(e):Sr.getPoints(e,new E)}if(2===arguments.length){var t=arguments[0],i=arguments[1];return t instanceof dt?i.add(t):t instanceof lt&&t.apply(new Sr(i)),i}},function(){this._locations=null;var e=arguments[0];this._locations=e}),Tr=(Pr.prototype.filter=function(e){(e instanceof dt||e instanceof B||e instanceof mt)&&this._locations.add(new Mr(e,0,e.getCoordinate()))},Pr.prototype.interfaces_=function(){return[st]},Pr.prototype.getClass=function(){return Pr},Pr.getLocations=function(e){var t=new E;return e.apply(new Pr(t)),t},function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Br,this._minDistanceLocation=null,this._minDistance=y.MAX_VALUE,2===arguments.length){var e=arguments[0],t=arguments[1];this._geom=[e,t],this._terminateDistance=0}else if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=i,this._geom[1]=r,this._terminateDistance=n}}),Lr=(Tr.prototype.computeContainmentDistance=function(){if(0===arguments.length){var e=new Array(2).fill(null);if(this.computeContainmentDistance(0,e),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,e)}else if(2===arguments.length){var t=arguments[0],i=arguments[1],r=1-t,n=br.getPolygons(this._geom[t]);if(n.size()>0){var o=Pr.getLocations(this._geom[r]);if(this.computeContainmentDistance(o,n,i),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[r]=i[0],this._minDistanceLocation[t]=i[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&_(arguments[0],We)&&_(arguments[1],We)){for(var s=arguments[0],a=arguments[1],l=arguments[2],u=0;u<s.size();u++)for(var c=s.get(u),h=0;h<a.size();h++)if(this.computeContainmentDistance(c,a.get(h),l),this._minDistance<=this._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Mr&&arguments[1]instanceof mt){var A=arguments[0],p=arguments[1],f=arguments[2],d=A.getCoordinate();if(g.EXTERIOR!==this._ptLocator.locate(d,p))return this._minDistance=0,f[0]=A,f[1]=new Mr(p,d),null}},Tr.prototype.computeMinDistanceLinesPoints=function(e,t,i){for(var r=0;r<e.size();r++)for(var n=e.get(r),o=0;o<t.size();o++){var s=t.get(o);if(this.computeMinDistance(n,s,i),this._minDistance<=this._terminateDistance)return null}},Tr.prototype.computeFacetDistance=function(){var e=new Array(2).fill(null),t=Er.getLines(this._geom[0]),i=Er.getLines(this._geom[1]),r=Sr.getPoints(this._geom[0]),n=Sr.getPoints(this._geom[1]);return this.computeMinDistanceLines(t,i,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance?null:(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(t,n,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance?null:(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(i,r,e),this.updateMinDistance(e,!0),this._minDistance<=this._terminateDistance?null:(e[0]=null,e[1]=null,this.computeMinDistancePoints(r,n,e),void this.updateMinDistance(e,!1))))},Tr.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},Tr.prototype.updateMinDistance=function(e,t){if(null===e[0])return null;t?(this._minDistanceLocation[0]=e[1],this._minDistanceLocation[1]=e[0]):(this._minDistanceLocation[0]=e[0],this._minDistanceLocation[1]=e[1])},Tr.prototype.nearestPoints=function(){this.computeMinDistance();return[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},Tr.prototype.computeMinDistance=function(){if(0===arguments.length){if(null!==this._minDistanceLocation)return null;if(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof B&&arguments[1]instanceof dt){var e=arguments[0],t=arguments[1],i=arguments[2];if(e.getEnvelopeInternal().distance(t.getEnvelopeInternal())>this._minDistance)return null;for(var r=e.getCoordinates(),n=t.getCoordinate(),o=0;o<r.length-1;o++){var s=x.distancePointLine(n,r[o],r[o+1]);if(s<this._minDistance){this._minDistance=s;var a=new S(r[o],r[o+1]).closestPoint(n);i[0]=new Mr(e,o,a),i[1]=new Mr(t,0,n)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof B&&arguments[1]instanceof B){var l=arguments[0],u=arguments[1],c=arguments[2];if(l.getEnvelopeInternal().distance(u.getEnvelopeInternal())>this._minDistance)return null;for(var h=l.getCoordinates(),A=u.getCoordinates(),p=0;p<h.length-1;p++)for(var f=0;f<A.length-1;f++){var d=x.distanceLineLine(h[p],h[p+1],A[f],A[f+1]);if(d<this._minDistance){this._minDistance=d;var g=new S(h[p],h[p+1]),m=new S(A[f],A[f+1]),y=g.closestPoints(m);c[0]=new Mr(l,p,y[0]),c[1]=new Mr(u,f,y[1])}if(this._minDistance<=this._terminateDistance)return null}}},Tr.prototype.computeMinDistancePoints=function(e,t,i){for(var r=0;r<e.size();r++)for(var n=e.get(r),o=0;o<t.size();o++){var s=t.get(o),a=n.getCoordinate().distance(s.getCoordinate());if(a<this._minDistance&&(this._minDistance=a,i[0]=new Mr(n,0,n.getCoordinate()),i[1]=new Mr(s,0,s.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},Tr.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new A("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},Tr.prototype.computeMinDistanceLines=function(e,t,i){for(var r=0;r<e.size();r++)for(var n=e.get(r),o=0;o<t.size();o++){var s=t.get(o);if(this.computeMinDistance(n,s,i),this._minDistance<=this._terminateDistance)return null}},Tr.prototype.interfaces_=function(){return[]},Tr.prototype.getClass=function(){return Tr},Tr.distance=function(e,t){return new Tr(e,t).distance()},Tr.isWithinDistance=function(e,t,i){return new Tr(e,t,i).distance()<=i},Tr.nearestPoints=function(e,t){return new Tr(e,t).nearestPoints()},function(){this._pt=[new C,new C],this._distance=y.NaN,this._isNull=!0}),Dr=(Lr.prototype.getCoordinates=function(){return this._pt},Lr.prototype.getCoordinate=function(e){return this._pt[e]},Lr.prototype.setMinimum=function(){if(1===arguments.length){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(2===arguments.length){var t=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(t,i),null;var r=t.distance(i);r<this._distance&&this.initialize(t,i,r)}},Lr.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2];this._pt[0].setCoordinate(i),this._pt[1].setCoordinate(r),this._distance=n,this._isNull=!1}},Lr.prototype.toString=function(){return Ee.toLineString(this._pt[0],this._pt[1])},Lr.prototype.getDistance=function(){return this._distance},Lr.prototype.setMaximum=function(){if(1===arguments.length){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(2===arguments.length){var t=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(t,i),null;var r=t.distance(i);r>this._distance&&this.initialize(t,i,r)}},Lr.prototype.interfaces_=function(){return[]},Lr.prototype.getClass=function(){return Lr},function(){}),Fr=(Dr.prototype.interfaces_=function(){return[]},Dr.prototype.getClass=function(){return Dr},Dr.computeDistance=function(){if(arguments[2]instanceof Lr&&arguments[0]instanceof B&&arguments[1]instanceof C)for(var e=arguments[0],t=arguments[1],i=arguments[2],r=new S,n=e.getCoordinates(),o=0;o<n.length-1;o++){r.setCoordinates(n[o],n[o+1]);var s=r.closestPoint(t);i.setMinimum(s,t)}else if(arguments[2]instanceof Lr&&arguments[0]instanceof mt&&arguments[1]instanceof C){var a=arguments[0],l=arguments[1],u=arguments[2];Dr.computeDistance(a.getExteriorRing(),l,u);for(var c=0;c<a.getNumInteriorRing();c++)Dr.computeDistance(a.getInteriorRingN(c),l,u)}else if(arguments[2]instanceof Lr&&arguments[0]instanceof b&&arguments[1]instanceof C){var h=arguments[0],A=arguments[1],p=arguments[2];if(h instanceof B)Dr.computeDistance(h,A,p);else if(h instanceof mt)Dr.computeDistance(h,A,p);else if(h instanceof lt)for(var f=h,d=0;d<f.getNumGeometries();d++){var g=f.getGeometryN(d);Dr.computeDistance(g,A,p)}else p.setMinimum(h.getCoordinate(),A)}else if(arguments[2]instanceof Lr&&arguments[0]instanceof S&&arguments[1]instanceof C){var m=arguments[0],y=arguments[1],_=arguments[2],v=m.closestPoint(y);_.setMinimum(v,y)}},function(){this._g0=null,this._g1=null,this._ptDist=new Lr,this._densifyFrac=0;var e=arguments[0],t=arguments[1];this._g0=e,this._g1=t}),Nr={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}},Or=(Fr.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},Fr.prototype.setDensifyFraction=function(e){if(e>1||e<=0)throw new A("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=e},Fr.prototype.compute=function(e,t){this.computeOrientedDistance(e,t,this._ptDist),this.computeOrientedDistance(t,e,this._ptDist)},Fr.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},Fr.prototype.computeOrientedDistance=function(e,t,i){var r=new Or(t);if(e.apply(r),i.setMaximum(r.getMaxPointDistance()),this._densifyFrac>0){var n=new Rr(t,this._densifyFrac);e.apply(n),i.setMaximum(n.getMaxPointDistance())}},Fr.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},Fr.prototype.interfaces_=function(){return[]},Fr.prototype.getClass=function(){return Fr},Fr.distance=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return new Fr(e,t).distance()}if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2],o=new Fr(i,r);return o.setDensifyFraction(n),o.distance()}},Nr.MaxPointDistanceFilter.get=function(){return Or},Nr.MaxDensifiedByFractionDistanceFilter.get=function(){return Rr},Object.defineProperties(Fr,Nr),function(){this._maxPtDist=new Lr,this._minPtDist=new Lr,this._euclideanDist=new Dr,this._geom=null;var e=arguments[0];this._geom=e}),Rr=(Or.prototype.filter=function(e){this._minPtDist.initialize(),Dr.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Or.prototype.getMaxPointDistance=function(){return this._maxPtDist},Or.prototype.interfaces_=function(){return[Oe]},Or.prototype.getClass=function(){return Or},function(){this._maxPtDist=new Lr,this._minPtDist=new Lr,this._geom=null,this._numSubSegs=0;var e=arguments[0],t=arguments[1];this._geom=e,this._numSubSegs=Math.trunc(Math.round(1/t))}),Ur=(Rr.prototype.filter=function(e,t){if(0===t)return null;for(var i=e.getCoordinate(t-1),r=e.getCoordinate(t),n=(r.x-i.x)/this._numSubSegs,o=(r.y-i.y)/this._numSubSegs,s=0;s<this._numSubSegs;s++){var a=i.x+s*n,l=i.y+s*o,u=new C(a,l);this._minPtDist.initialize(),Dr.computeDistance(this._geom,u,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},Rr.prototype.isDone=function(){return!1},Rr.prototype.isGeometryChanged=function(){return!1},Rr.prototype.getMaxPointDistance=function(){return this._maxPtDist},Rr.prototype.interfaces_=function(){return[at]},Rr.prototype.getClass=function(){return Rr},function(e,t,i){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._bufDistance=t||null,this._result=i||null}),kr={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}},Hr=(Ur.prototype.checkMaximumDistance=function(e,t,i){var r=new Fr(t,e);if(r.setDensifyFraction(.25),this._maxDistanceFound=r.orientedDistance(),this._maxDistanceFound>i){this._isValid=!1;var n=r.getCoordinates();this._errorLocation=n[1],this._errorIndicator=e.getFactory().createLineString(n),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+Ee.toLineString(n[0],n[1])+")"}},Ur.prototype.isValid=function(){var e=Math.abs(this._bufDistance),t=Ur.MAX_DISTANCE_DIFF_FRAC*e;return this._minValidDistance=e-t,this._maxValidDistance=e+t,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Ur.VERBOSE&&ye.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},Ur.prototype.checkNegativeValid=function(){if(!(this._input instanceof mt||this._input instanceof vt||this._input instanceof lt))return null;var e=this.getPolygonLines(this._input);if(this.checkMinimumDistance(e,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(e,this._result,this._maxValidDistance)},Ur.prototype.getErrorIndicator=function(){return this._errorIndicator},Ur.prototype.checkMinimumDistance=function(e,t,i){var r=new Tr(e,t,i);if(this._minDistanceFound=r.distance(),this._minDistanceFound<i){this._isValid=!1;var n=r.nearestPoints();this._errorLocation=r.nearestPoints()[1],this._errorIndicator=e.getFactory().createLineString(n),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+Ee.toLineString(n[0],n[1])+" )"}},Ur.prototype.checkPositiveValid=function(){var e=this._result.getBoundary();if(this.checkMinimumDistance(this._input,e,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,e,this._maxValidDistance)},Ur.prototype.getErrorLocation=function(){return this._errorLocation},Ur.prototype.getPolygonLines=function(e){for(var t=new E,i=new Er(t),r=br.getPolygons(e).iterator();r.hasNext();)r.next().apply(i);return e.getFactory().buildGeometry(t)},Ur.prototype.getErrorMessage=function(){return this._errMsg},Ur.prototype.interfaces_=function(){return[]},Ur.prototype.getClass=function(){return Ur},kr.VERBOSE.get=function(){return!1},kr.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Ur,kr),function(e,t,i){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._distance=t||null,this._result=i||null}),Qr={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}},Vr=(Hr.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},Hr.prototype.checkEnvelope=function(){if(this._distance<0)return null;var e=this._distance*Hr.MAX_ENV_DIFF_FRAC;0===e&&(e=.001);var t=new u(this._input.getEnvelopeInternal());t.expandBy(this._distance);var i=new u(this._result.getEnvelopeInternal());i.expandBy(e),i.contains(t)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(i)),this.report("Envelope")},Hr.prototype.checkDistance=function(){var e=new Ur(this._input,this._distance,this._result);e.isValid()||(this._isValid=!1,this._errorMsg=e.getErrorMessage(),this._errorLocation=e.getErrorLocation(),this._errorIndicator=e.getErrorIndicator()),this.report("Distance")},Hr.prototype.checkArea=function(){var e=this._input.getArea(),t=this._result.getArea();this._distance>0&&e>t&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&e<t&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},Hr.prototype.checkPolygonal=function(){this._result instanceof mt||this._result instanceof vt||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},Hr.prototype.getErrorIndicator=function(){return this._errorIndicator},Hr.prototype.getErrorLocation=function(){return this._errorLocation},Hr.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2?null:this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},Hr.prototype.report=function(e){if(!Hr.VERBOSE)return null;ye.out.println("Check "+e+": "+(this._isValid?"passed":"FAILED"))},Hr.prototype.getErrorMessage=function(){return this._errorMsg},Hr.prototype.interfaces_=function(){return[]},Hr.prototype.getClass=function(){return Hr},Hr.isValidMsg=function(e,t,i){var r=new Hr(e,t,i);return r.isValid()?null:r.getErrorMessage()},Hr.isValid=function(e,t,i){return!!new Hr(e,t,i).isValid()},Qr.VERBOSE.get=function(){return!1},Qr.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Hr,Qr),function(){this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t}),Gr=(Vr.prototype.getCoordinates=function(){return this._pts},Vr.prototype.size=function(){return this._pts.length},Vr.prototype.getCoordinate=function(e){return this._pts[e]},Vr.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},Vr.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:_i.octant(this.getCoordinate(e),this.getCoordinate(e+1))},Vr.prototype.setData=function(e){this._data=e},Vr.prototype.getData=function(){return this._data},Vr.prototype.toString=function(){return Ee.toLineString(new n(this._pts))},Vr.prototype.interfaces_=function(){return[vi]},Vr.prototype.getClass=function(){return Vr},function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new E,this._intersectionCount=0,this._keepIntersections=!0;var e=arguments[0];this._li=e,this._interiorIntersection=null}),zr=(Gr.prototype.getInteriorIntersection=function(){return this._interiorIntersection},Gr.prototype.setCheckEndSegmentsOnly=function(e){this._isCheckEndSegmentsOnly=e},Gr.prototype.getIntersectionSegments=function(){return this._intSegments},Gr.prototype.count=function(){return this._intersectionCount},Gr.prototype.getIntersections=function(){return this._intersections},Gr.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e},Gr.prototype.setKeepIntersections=function(e){this._keepIntersections=e},Gr.prototype.processIntersections=function(e,t,i,r){if(!this._findAllIntersections&&this.hasIntersection())return null;if(e===i&&t===r)return null;if(this._isCheckEndSegmentsOnly)if(!(this.isEndSegment(e,t)||this.isEndSegment(i,r)))return null;var n=e.getCoordinates()[t],o=e.getCoordinates()[t+1],s=i.getCoordinates()[r],a=i.getCoordinates()[r+1];this._li.computeIntersection(n,o,s,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=n,this._intSegments[1]=o,this._intSegments[2]=s,this._intSegments[3]=a,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},Gr.prototype.isEndSegment=function(e,t){return 0===t||t>=e.size()-2},Gr.prototype.hasIntersection=function(){return null!==this._interiorIntersection},Gr.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},Gr.prototype.interfaces_=function(){return[Zi]},Gr.prototype.getClass=function(){return Gr},Gr.createAllIntersectionsFinder=function(e){var t=new Gr(e);return t.setFindAllIntersections(!0),t},Gr.createAnyIntersectionFinder=function(e){return new Gr(e)},Gr.createIntersectionCounter=function(e){var t=new Gr(e);return t.setFindAllIntersections(!0),t.setKeepIntersections(!1),t},function(){this._li=new Se,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var e=arguments[0];this._segStrings=e}),Wr=(zr.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},zr.prototype.getIntersections=function(){return this._segInt.getIntersections()},zr.prototype.isValid=function(){return this.execute(),this._isValid},zr.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e},zr.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Gr(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var e=new Ii;if(e.setSegmentIntersector(this._segInt),e.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},zr.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Vt(this.getErrorMessage(),this._segInt.getInteriorIntersection())},zr.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var e=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+Ee.toLineString(e[0],e[1])+" and "+Ee.toLineString(e[2],e[3])},zr.prototype.interfaces_=function(){return[]},zr.prototype.getClass=function(){return zr},zr.computeIntersections=function(e){var t=new zr(e);return t.setFindAllIntersections(!0),t.isValid(),t.getIntersections()},function e(){this._nv=null;var t=arguments[0];this._nv=new zr(e.toSegmentStrings(t))}),qr=(Wr.prototype.checkValid=function(){this._nv.checkValid()},Wr.prototype.interfaces_=function(){return[]},Wr.prototype.getClass=function(){return Wr},Wr.toSegmentStrings=function(e){for(var t=new E,i=e.iterator();i.hasNext();){var r=i.next();t.add(new Vr(r.getCoordinates(),r))}return t},Wr.checkValid=function(e){new Wr(e).checkValid()},function(e){this._mapOp=e}),Kr=(qr.prototype.map=function(e){for(var t=new E,i=0;i<e.getNumGeometries();i++){var r=this._mapOp.map(e.getGeometryN(i));r.isEmpty()||t.add(r)}return e.getFactory().createGeometryCollection(l.toGeometryArray(t))},qr.prototype.interfaces_=function(){return[]},qr.prototype.getClass=function(){return qr},qr.map=function(e,t){return new qr(t).map(e)},function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new E,this._resultLineList=new E;var e=arguments[0],t=arguments[1],i=arguments[2];this._op=e,this._geometryFactory=t,this._ptLocator=i}),jr=(Kr.prototype.collectLines=function(e){for(var t=this._op.getGraph().getEdgeEnds().iterator();t.hasNext();){var i=t.next();this.collectLineEdge(i,e,this._lineEdgesList),this.collectBoundaryTouchEdge(i,e,this._lineEdgesList)}},Kr.prototype.labelIsolatedLine=function(e,t){var i=this._ptLocator.locate(e.getCoordinate(),this._op.getArgGeometry(t));e.getLabel().setLocation(t,i)},Kr.prototype.build=function(e){return this.findCoveredLineEdges(),this.collectLines(e),this.buildLines(e),this._resultLineList},Kr.prototype.collectLineEdge=function(e,t,i){var r=e.getLabel(),n=e.getEdge();e.isLineEdge()&&(e.isVisited()||!O.isResultOfOp(r,t)||n.isCovered()||(i.add(n),e.setVisitedEdge(!0)))},Kr.prototype.findCoveredLineEdges=function(){for(var e=this._op.getGraph().getNodes().iterator();e.hasNext();)e.next().getEdges().findCoveredLineEdges();for(var t=this._op.getGraph().getEdgeEnds().iterator();t.hasNext();){var i=t.next(),r=i.getEdge();if(i.isLineEdge()&&!r.isCoveredSet()){var n=this._op.isCoveredByA(i.getCoordinate());r.setCovered(n)}}},Kr.prototype.labelIsolatedLines=function(e){for(var t=e.iterator();t.hasNext();){var i=t.next(),r=i.getLabel();i.isIsolated()&&(r.isNull(0)?this.labelIsolatedLine(i,0):this.labelIsolatedLine(i,1))}},Kr.prototype.buildLines=function(e){for(var t=this._lineEdgesList.iterator();t.hasNext();){var i=t.next(),r=this._geometryFactory.createLineString(i.getCoordinates());this._resultLineList.add(r),i.setInResult(!0)}},Kr.prototype.collectBoundaryTouchEdge=function(e,t,i){var r=e.getLabel();return e.isLineEdge()?null:e.isVisited()?null:e.isInteriorAreaEdge()?null:e.getEdge().isInResult()?null:(w.isTrue(!(e.isInResult()||e.getSym().isInResult())||!e.getEdge().isInResult()),void(O.isResultOfOp(r,t)&&t===O.INTERSECTION&&(i.add(e.getEdge()),e.setVisitedEdge(!0))))},Kr.prototype.interfaces_=function(){return[]},Kr.prototype.getClass=function(){return Kr},function(){this._op=null,this._geometryFactory=null,this._resultPointList=new E;var e=arguments[0],t=arguments[1];this._op=e,this._geometryFactory=t}),Zr=(jr.prototype.filterCoveredNodeToPoint=function(e){var t=e.getCoordinate();if(!this._op.isCoveredByLA(t)){var i=this._geometryFactory.createPoint(t);this._resultPointList.add(i)}},jr.prototype.extractNonCoveredResultNodes=function(e){for(var t=this._op.getGraph().getNodes().iterator();t.hasNext();){var i=t.next();if(!i.isInResult()&&(!i.isIncidentEdgeInResult()&&(0===i.getEdges().getDegree()||e===O.INTERSECTION))){var r=i.getLabel();O.isResultOfOp(r,e)&&this.filterCoveredNodeToPoint(i)}}},jr.prototype.build=function(e){return this.extractNonCoveredResultNodes(e),this._resultPointList},jr.prototype.interfaces_=function(){return[]},jr.prototype.getClass=function(){return jr},function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1}),Yr=(Zr.prototype.transformPoint=function(e,t){return this._factory.createPoint(this.transformCoordinates(e.getCoordinateSequence(),e))},Zr.prototype.transformPolygon=function(e,t){var i=!0,r=this.transformLinearRing(e.getExteriorRing(),e);null!==r&&r instanceof _t&&!r.isEmpty()||(i=!1);for(var n=new E,o=0;o<e.getNumInteriorRing();o++){var s=this.transformLinearRing(e.getInteriorRingN(o),e);null===s||s.isEmpty()||(s instanceof _t||(i=!1),n.add(s))}if(i)return this._factory.createPolygon(r,n.toArray([]));var a=new E;return null!==r&&a.add(r),a.addAll(n),this._factory.buildGeometry(a)},Zr.prototype.createCoordinateSequence=function(e){return this._factory.getCoordinateSequenceFactory().create(e)},Zr.prototype.getInputGeometry=function(){return this._inputGeom},Zr.prototype.transformMultiLineString=function(e,t){for(var i=new E,r=0;r<e.getNumGeometries();r++){var n=this.transformLineString(e.getGeometryN(r),e);null!==n&&(n.isEmpty()||i.add(n))}return this._factory.buildGeometry(i)},Zr.prototype.transformCoordinates=function(e,t){return this.copy(e)},Zr.prototype.transformLineString=function(e,t){return this._factory.createLineString(this.transformCoordinates(e.getCoordinateSequence(),e))},Zr.prototype.transformMultiPoint=function(e,t){for(var i=new E,r=0;r<e.getNumGeometries();r++){var n=this.transformPoint(e.getGeometryN(r),e);null!==n&&(n.isEmpty()||i.add(n))}return this._factory.buildGeometry(i)},Zr.prototype.transformMultiPolygon=function(e,t){for(var i=new E,r=0;r<e.getNumGeometries();r++){var n=this.transformPolygon(e.getGeometryN(r),e);null!==n&&(n.isEmpty()||i.add(n))}return this._factory.buildGeometry(i)},Zr.prototype.copy=function(e){return e.copy()},Zr.prototype.transformGeometryCollection=function(e,t){for(var i=new E,r=0;r<e.getNumGeometries();r++){var n=this.transform(e.getGeometryN(r));null!==n&&(this._pruneEmptyGeometry&&n.isEmpty()||i.add(n))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(l.toGeometryArray(i)):this._factory.buildGeometry(i)},Zr.prototype.transform=function(e){if(this._inputGeom=e,this._factory=e.getFactory(),e instanceof dt)return this.transformPoint(e,null);if(e instanceof yt)return this.transformMultiPoint(e,null);if(e instanceof _t)return this.transformLinearRing(e,null);if(e instanceof B)return this.transformLineString(e,null);if(e instanceof ut)return this.transformMultiLineString(e,null);if(e instanceof mt)return this.transformPolygon(e,null);if(e instanceof vt)return this.transformMultiPolygon(e,null);if(e instanceof lt)return this.transformGeometryCollection(e,null);throw new A("Unknown Geometry subtype: "+e.getClass().getName())},Zr.prototype.transformLinearRing=function(e,t){var i=this.transformCoordinates(e.getCoordinateSequence(),e);if(null===i)return this._factory.createLinearRing(null);var r=i.size();return r>0&&r<4&&!this._preserveType?this._factory.createLineString(i):this._factory.createLinearRing(i)},Zr.prototype.interfaces_=function(){return[]},Zr.prototype.getClass=function(){return Zr},function e(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new S,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof B&&"number"==typeof arguments[1]){var t=arguments[0],i=arguments[1];e.call(this,t.getCoordinates(),i)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var r=arguments[0],n=arguments[1];this._srcPts=r,this._isClosed=e.isClosed(r),this._snapTolerance=n}}),N=(Yr.prototype.snapVertices=function(e,t){for(var i=this._isClosed?e.size()-1:e.size(),r=0;r<i;r++){var n=e.get(r),o=this.findSnapForVertex(n,t);null!==o&&(e.set(r,new C(o)),0===r&&this._isClosed&&e.set(e.size()-1,new C(o)))}},Yr.prototype.findSnapForVertex=function(e,t){for(var i=0;i<t.length;i++){if(e.equals2D(t[i]))return null;if(e.distance(t[i])<this._snapTolerance)return t[i]}return null},Yr.prototype.snapTo=function(e){var t=new Ke(this._srcPts);this.snapVertices(t,e),this.snapSegments(t,e);return t.toCoordinateArray()},Yr.prototype.snapSegments=function(e,t){if(0===t.length)return null;var i=t.length;t[0].equals2D(t[t.length-1])&&(i=t.length-1);for(var r=0;r<i;r++){var n=t[r],o=this.findSegmentIndexToSnap(n,e);o>=0&&e.add(o+1,new C(n),!1)}},Yr.prototype.findSegmentIndexToSnap=function(e,t){for(var i=y.MAX_VALUE,r=-1,n=0;n<t.size()-1;n++){if(this._seg.p0=t.get(n),this._seg.p1=t.get(n+1),this._seg.p0.equals2D(e)||this._seg.p1.equals2D(e)){if(this._allowSnappingToSourceVertices)continue;return-1}var o=this._seg.distance(e);o<this._snapTolerance&&o<i&&(i=o,r=n)}return r},Yr.prototype.setAllowSnappingToSourceVertices=function(e){this._allowSnappingToSourceVertices=e},Yr.prototype.interfaces_=function(){return[]},Yr.prototype.getClass=function(){return Yr},Yr.isClosed=function(e){return!(e.length<=1)&&e[0].equals2D(e[e.length-1])},function(e){this._srcGeom=e||null}),Xr={SNAP_PRECISION_FACTOR:{configurable:!0}},Jr=(N.prototype.snapTo=function(e,t){var i=this.extractTargetCoordinates(e);return new Jr(t,i).transform(this._srcGeom)},N.prototype.snapToSelf=function(e,t){var i=this.extractTargetCoordinates(this._srcGeom),r=new Jr(e,i,!0).transform(this._srcGeom),n=r;return t&&_(n,gt)&&(n=r.buffer(0)),n},N.prototype.computeSnapTolerance=function(e){return this.computeMinimumSegmentLength(e)/10},N.prototype.extractTargetCoordinates=function(e){for(var t=new j,i=e.getCoordinates(),r=0;r<i.length;r++)t.add(i[r]);return t.toArray(new Array(0).fill(null))},N.prototype.computeMinimumSegmentLength=function(e){for(var t=y.MAX_VALUE,i=0;i<e.length-1;i++){var r=e[i].distance(e[i+1]);r<t&&(t=r)}return t},N.prototype.interfaces_=function(){return[]},N.prototype.getClass=function(){return N},N.snap=function(e,t,i){var r=new Array(2).fill(null),n=new N(e);r[0]=n.snapTo(t,i);var o=new N(t);return r[1]=o.snapTo(r[0],i),r},N.computeOverlaySnapTolerance=function(){if(1===arguments.length){var e=arguments[0],t=N.computeSizeBasedSnapTolerance(e),i=e.getPrecisionModel();if(i.getType()===a.FIXED){var r=1/i.getScale()*2/1.415;r>t&&(t=r)}return t}if(2===arguments.length){var n=arguments[0],o=arguments[1];return Math.min(N.computeOverlaySnapTolerance(n),N.computeOverlaySnapTolerance(o))}},N.computeSizeBasedSnapTolerance=function(e){var t=e.getEnvelopeInternal();return Math.min(t.getHeight(),t.getWidth())*N.SNAP_PRECISION_FACTOR},N.snapToSelf=function(e,t,i){return new N(e).snapToSelf(t,i)},Xr.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(N,Xr),function(r){function e(e,t,i){r.call(this),this._snapTolerance=e||null,this._snapPts=t||null,this._isSelfSnap=void 0!==i&&i}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(e,t){var i=new Yr(e,this._snapTolerance);return i.setAllowSnappingToSourceVertices(this._isSelfSnap),i.snapTo(t)},e.prototype.transformCoordinates=function(e,t){var i=e.toCoordinateArray(),r=this.snapLine(i,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Zr)),$r=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null},en=($r.prototype.getCommon=function(){return y.longBitsToDouble(this._commonBits)},$r.prototype.add=function(e){var t=y.doubleToLongBits(e);if(this._isFirst)return this._commonBits=t,this._commonSignExp=$r.signExpBits(this._commonBits),this._isFirst=!1,null;if($r.signExpBits(t)!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=$r.numCommonMostSigMantissaBits(this._commonBits,t),this._commonBits=$r.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))},$r.prototype.toString=function(){if(1===arguments.length){var e=arguments[0],t=y.longBitsToDouble(e),i="0000000000000000000000000000000000000000000000000000000000000000"+y.toBinaryString(e),r=i.substring(i.length-64);return r.substring(0,1)+"  "+r.substring(1,12)+"(exp) "+r.substring(12)+" [ "+t+" ]"}},$r.prototype.interfaces_=function(){return[]},$r.prototype.getClass=function(){return $r},$r.getBit=function(e,t){return 0!=(e&1<<t)?1:0},$r.signExpBits=function(e){return e>>52},$r.zeroLowerBits=function(e,t){return e&~((1<<t)-1)},$r.numCommonMostSigMantissaBits=function(e,t){for(var i=0,r=52;r>=0;r--){if($r.getBit(e,r)!==$r.getBit(t,r))return i;i++}return 52},function(){this._commonCoord=null,this._ccFilter=new rn}),tn={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}},rn=(en.prototype.addCommonBits=function(e){var t=new nn(this._commonCoord);e.apply(t),e.geometryChanged()},en.prototype.removeCommonBits=function(e){if(0===this._commonCoord.x&&0===this._commonCoord.y)return e;var t=new C(this._commonCoord);t.x=-t.x,t.y=-t.y;var i=new nn(t);return e.apply(i),e.geometryChanged(),e},en.prototype.getCommonCoordinate=function(){return this._commonCoord},en.prototype.add=function(e){e.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},en.prototype.interfaces_=function(){return[]},en.prototype.getClass=function(){return en},tn.CommonCoordinateFilter.get=function(){return rn},tn.Translater.get=function(){return nn},Object.defineProperties(en,tn),function(){this._commonBitsX=new $r,this._commonBitsY=new $r}),nn=(rn.prototype.filter=function(e){this._commonBitsX.add(e.x),this._commonBitsY.add(e.y)},rn.prototype.getCommonCoordinate=function(){return new C(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},rn.prototype.interfaces_=function(){return[Oe]},rn.prototype.getClass=function(){return rn},function(){this.trans=null;var e=arguments[0];this.trans=e}),on=(nn.prototype.filter=function(e,t){var i=e.getOrdinate(t,0)+this.trans.x,r=e.getOrdinate(t,1)+this.trans.y;e.setOrdinate(t,0,i),e.setOrdinate(t,1,r)},nn.prototype.isDone=function(){return!1},nn.prototype.isGeometryChanged=function(){return!0},nn.prototype.interfaces_=function(){return[at]},nn.prototype.getClass=function(){return nn},function(e,t){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=e,this._geom[1]=t,this.computeSnapTolerance()}),sn=(on.prototype.selfSnap=function(e){return new N(e).snapTo(e,this._snapTolerance)},on.prototype.removeCommonBits=function(e){this._cbr=new en,this._cbr.add(e[0]),this._cbr.add(e[1]);var t=new Array(2).fill(null);return t[0]=this._cbr.removeCommonBits(e[0].copy()),t[1]=this._cbr.removeCommonBits(e[1].copy()),t},on.prototype.prepareResult=function(e){return this._cbr.addCommonBits(e),e},on.prototype.getResultGeometry=function(e){var t=this.snap(this._geom),i=O.overlayOp(t[0],t[1],e);return this.prepareResult(i)},on.prototype.checkValid=function(e){e.isValid()||ye.out.println("Snapped geometry is invalid")},on.prototype.computeSnapTolerance=function(){this._snapTolerance=N.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},on.prototype.snap=function(e){var t=this.removeCommonBits(e);return N.snap(t[0],t[1],this._snapTolerance)},on.prototype.interfaces_=function(){return[]},on.prototype.getClass=function(){return on},on.overlayOp=function(e,t,i){return new on(e,t).getResultGeometry(i)},on.union=function(e,t){return on.overlayOp(e,t,O.UNION)},on.intersection=function(e,t){return on.overlayOp(e,t,O.INTERSECTION)},on.symDifference=function(e,t){return on.overlayOp(e,t,O.SYMDIFFERENCE)},on.difference=function(e,t){return on.overlayOp(e,t,O.DIFFERENCE)},function(e,t){this._geom=new Array(2).fill(null),this._geom[0]=e,this._geom[1]=t}),an=(sn.prototype.getResultGeometry=function(e){var t=null,i=!1,r=null;try{t=O.overlayOp(this._geom[0],this._geom[1],e);i=!0}catch(e){if(!(e instanceof Be))throw e;r=e}if(!i)try{t=on.overlayOp(this._geom[0],this._geom[1],e)}catch(e){throw e instanceof Be?r:e}return t},sn.prototype.interfaces_=function(){return[]},sn.prototype.getClass=function(){return sn},sn.overlayOp=function(e,t,i){return new sn(e,t).getResultGeometry(i)},sn.union=function(e,t){return sn.overlayOp(e,t,O.UNION)},sn.intersection=function(e,t){return sn.overlayOp(e,t,O.INTERSECTION)},sn.symDifference=function(e,t){return sn.overlayOp(e,t,O.SYMDIFFERENCE)},sn.difference=function(e,t){return sn.overlayOp(e,t,O.DIFFERENCE)},function(){this.mce=null,this.chainIndex=null;var e=arguments[0],t=arguments[1];this.mce=e,this.chainIndex=t}),ln=(an.prototype.computeIntersections=function(e,t){this.mce.computeIntersectsForChain(this.chainIndex,e.mce,e.chainIndex,t)},an.prototype.interfaces_=function(){return[]},an.prototype.getClass=function(){return an},function e(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var t=arguments[0],i=arguments[1];this._eventType=e.DELETE,this._xValue=t,this._insertEvent=i}else if(3===arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2];this._eventType=e.INSERT,this._label=r,this._xValue=n,this._obj=o}}),un={INSERT:{configurable:!0},DELETE:{configurable:!0}},cn=(ln.prototype.isDelete=function(){return this._eventType===ln.DELETE},ln.prototype.setDeleteEventIndex=function(e){this._deleteEventIndex=e},ln.prototype.getObject=function(){return this._obj},ln.prototype.compareTo=function(e){var t=e;return this._xValue<t._xValue?-1:this._xValue>t._xValue?1:this._eventType<t._eventType?-1:this._eventType>t._eventType?1:0},ln.prototype.getInsertEvent=function(){return this._insertEvent},ln.prototype.isInsert=function(){return this._eventType===ln.INSERT},ln.prototype.isSameLabel=function(e){return null!==this._label&&this._label===e._label},ln.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},ln.prototype.interfaces_=function(){return[ee]},ln.prototype.getClass=function(){return ln},un.INSERT.get=function(){return 1},un.DELETE.get=function(){return 2},Object.defineProperties(ln,un),function(){}),hn=(cn.prototype.interfaces_=function(){return[]},cn.prototype.getClass=function(){return cn},function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var e=arguments[0],t=arguments[1],i=arguments[2];this._li=e,this._includeProper=t,this._recordIsolated=i}),An=(hn.prototype.isTrivialIntersection=function(e,t,i,r){if(e===i&&1===this._li.getIntersectionNum()){if(hn.isAdjacentSegments(t,r))return!0;if(e.isClosed()){var n=e.getNumPoints()-1;if(0===t&&r===n||0===r&&t===n)return!0}}return!1},hn.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},hn.prototype.setIsDoneIfProperInt=function(e){this._isDoneWhenProperInt=e},hn.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},hn.prototype.isBoundaryPointInternal=function(e,t){for(var i=t.iterator();i.hasNext();){var r=i.next().getCoordinate();if(e.isIntersection(r))return!0}return!1},hn.prototype.hasProperIntersection=function(){return this._hasProper},hn.prototype.hasIntersection=function(){return this._hasIntersection},hn.prototype.isDone=function(){return this._isDone},hn.prototype.isBoundaryPoint=function(e,t){return null!==t&&(!!this.isBoundaryPointInternal(e,t[0])||!!this.isBoundaryPointInternal(e,t[1]))},hn.prototype.setBoundaryNodes=function(e,t){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=e,this._bdyNodes[1]=t},hn.prototype.addIntersections=function(e,t,i,r){if(e===i&&t===r)return null;this.numTests++;var n=e.getCoordinates()[t],o=e.getCoordinates()[t+1],s=i.getCoordinates()[r],a=i.getCoordinates()[r+1];this._li.computeIntersection(n,o,s,a),this._li.hasIntersection()&&(this._recordIsolated&&(e.setIsolated(!1),i.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(e,t,i,r)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(e.addIntersections(this._li,t,0),i.addIntersections(this._li,r,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},hn.prototype.interfaces_=function(){return[]},hn.prototype.getClass=function(){return hn},hn.isAdjacentSegments=function(e,t){return 1===Math.abs(e-t)},function(e){function t(){e.call(this),this.events=new E,this.nOverlaps=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.prepareEvents=function(){li.sort(this.events);for(var e=0;e<this.events.size();e++){var t=this.events.get(e);t.isDelete()&&t.getInsertEvent().setDeleteEventIndex(e)}},t.prototype.computeIntersections=function(){if(1===arguments.length){var e=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var t=0;t<this.events.size();t++){var i=this.events.get(t);if(i.isInsert()&&this.processOverlaps(t,i.getDeleteEventIndex(),i,e),e.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof hn&&_(arguments[0],We)&&_(arguments[1],We)){var r=arguments[0],n=arguments[1],o=arguments[2];this.addEdges(r,r),this.addEdges(n,n),this.computeIntersections(o)}else if("boolean"==typeof arguments[2]&&_(arguments[0],We)&&arguments[1]instanceof hn){var s=arguments[0],a=arguments[1];arguments[2]?this.addEdges(s,null):this.addEdges(s),this.computeIntersections(a)}},t.prototype.addEdge=function(e,t){for(var i=e.getMonotoneChainEdge(),r=i.getStartIndexes(),n=0;n<r.length-1;n++){var o=new an(i,n),s=new ln(t,i.getMinX(n),o);this.events.add(s),this.events.add(new ln(i.getMaxX(n),s))}},t.prototype.processOverlaps=function(e,t,i,r){for(var n=i.getObject(),o=e;o<t;o++){var s=this.events.get(o);if(s.isInsert()){var a=s.getObject();i.isSameLabel(s)||(n.computeIntersections(a,r),this.nOverlaps++)}}},t.prototype.addEdges=function(){if(1===arguments.length)for(var e=arguments[0].iterator();e.hasNext();){var t=e.next();this.addEdge(t,t)}else if(2===arguments.length)for(var i=arguments[0],r=arguments[1],n=i.iterator();n.hasNext();){var o=n.next();this.addEdge(o,r)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(cn)),pn=function(){this._min=y.POSITIVE_INFINITY,this._max=y.NEGATIVE_INFINITY},fn={NodeComparator:{configurable:!0}},dn=(pn.prototype.getMin=function(){return this._min},pn.prototype.intersects=function(e,t){return!(this._min>t||this._max<e)},pn.prototype.getMax=function(){return this._max},pn.prototype.toString=function(){return Ee.toLineString(new C(this._min,0),new C(this._max,0))},pn.prototype.interfaces_=function(){return[]},pn.prototype.getClass=function(){return pn},fn.NodeComparator.get=function(){return dn},Object.defineProperties(pn,fn),function(){}),gn=(dn.prototype.compare=function(e,t){var i=e,r=t,n=(i._min+i._max)/2,o=(r._min+r._max)/2;return n<o?-1:n>o?1:0},dn.prototype.interfaces_=function(){return[ie]},dn.prototype.getClass=function(){return dn},function(r){function e(){r.call(this),this._item=null;var e=arguments[0],t=arguments[1],i=arguments[2];this._min=e,this._max=t,this._item=i}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.query=function(e,t,i){if(!this.intersects(e,t))return null;i.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(pn)),mn=function(i){function e(){i.call(this),this._node1=null,this._node2=null;var e=arguments[0],t=arguments[1];this._node1=e,this._node2=t,this.buildExtent(this._node1,this._node2)}return i&&(e.__proto__=i),e.prototype=Object.create(i&&i.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(e,t){this._min=Math.min(e._min,t._min),this._max=Math.max(e._max,t._max)},e.prototype.query=function(e,t,i){if(!this.intersects(e,t))return null;null!==this._node1&&this._node1.query(e,t,i),null!==this._node2&&this._node2.query(e,t,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(pn),yn=function(){this._leaves=new E,this._root=null,this._level=0},_n=(yn.prototype.buildTree=function(){li.sort(this._leaves,new pn.NodeComparator);for(var e=this._leaves,t=null,i=new E;;){if(this.buildLevel(e,i),1===i.size())return i.get(0);t=e,e=i,i=t}},yn.prototype.insert=function(e,t,i){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new gn(e,t,i))},yn.prototype.query=function(e,t,i){this.init(),this._root.query(e,t,i)},yn.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},yn.prototype.printNode=function(e){ye.out.println(Ee.toLineString(new C(e._min,this._level),new C(e._max,this._level)))},yn.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},yn.prototype.buildLevel=function(e,t){this._level++,t.clear();for(var i=0;i<e.size();i+=2){var r=e.get(i);if(null===(i+1<e.size()?e.get(i):null))t.add(r);else{var n=new mn(e.get(i),e.get(i+1));t.add(n)}}},yn.prototype.interfaces_=function(){return[]},yn.prototype.getClass=function(){return yn},function(){this._items=new E}),vn=(_n.prototype.visitItem=function(e){this._items.add(e)},_n.prototype.getItems=function(){return this._items},_n.prototype.interfaces_=function(){return[ni]},_n.prototype.getClass=function(){return _n},function(){this._index=null;var e=arguments[0];if(!_(e,gt))throw new A("Argument must be Polygonal");this._index=new xn(e)}),Cn={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}},wn=(vn.prototype.locate=function(e){var t=new Te(e),i=new wn(t);return this._index.query(e.y,e.y,i),t.getLocation()},vn.prototype.interfaces_=function(){return[Qi]},vn.prototype.getClass=function(){return vn},Cn.SegmentVisitor.get=function(){return wn},Cn.IntervalIndexedGeometry.get=function(){return xn},Object.defineProperties(vn,Cn),function(){this._counter=null;var e=arguments[0];this._counter=e}),xn=(wn.prototype.visitItem=function(e){var t=e;this._counter.countSegment(t.getCoordinate(0),t.getCoordinate(1))},wn.prototype.interfaces_=function(){return[ni]},wn.prototype.getClass=function(){return wn},function(){this._index=new yn;var e=arguments[0];this.init(e)}),bn=(xn.prototype.init=function(e){for(var t=Er.getLines(e).iterator();t.hasNext();){var i=t.next().getCoordinates();this.addLine(i)}},xn.prototype.addLine=function(e){for(var t=1;t<e.length;t++){var i=new S(e[t-1],e[t]),r=Math.min(i.p0.y,i.p1.y),n=Math.max(i.p0.y,i.p1.y);this._index.insert(r,n,i)}},xn.prototype.query=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1],i=new _n;return this._index.query(e,t,i),i.getItems()}if(3===arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2];this._index.query(r,n,o)}},xn.prototype.interfaces_=function(){return[]},xn.prototype.getClass=function(){return xn},function(s){function o(){if(s.call(this),this._parentGeom=null,this._lineEdgeMap=new St,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Br,2===arguments.length){var e=arguments[0],t=arguments[1],i=Re.OGC_SFS_BOUNDARY_RULE;this._argIndex=e,this._parentGeom=t,this._boundaryNodeRule=i,null!==t&&this.add(t)}else if(3===arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2];this._argIndex=r,this._parentGeom=n,this._boundaryNodeRule=o,null!==n&&this.add(n)}}return s&&(o.__proto__=s),o.prototype=Object.create(s&&s.prototype),o.prototype.constructor=o,o.prototype.insertBoundaryPoint=function(e,t){var i=this._nodes.addNode(t).getLabel(),r=1;g.NONE;i.getLocation(e,m.ON)===g.BOUNDARY&&r++;var n=o.determineBoundary(this._boundaryNodeRule,r);i.setLocation(e,n)},o.prototype.computeSelfNodes=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1];return this.computeSelfNodes(e,t,!1)}if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2],o=new hn(i,!0,!1);o.setIsDoneIfProperInt(n);var s=this.createEdgeSetIntersector(),a=this._parentGeom instanceof _t||this._parentGeom instanceof mt||this._parentGeom instanceof vt,l=r||!a;return s.computeIntersections(this._edges,o,l),this.addSelfIntersectionNodes(this._argIndex),o}},o.prototype.computeSplitEdges=function(e){for(var t=this._edges.iterator();t.hasNext();)t.next().eiList.addSplitEdges(e)},o.prototype.computeEdgeIntersections=function(e,t,i){var r=new hn(t,i,!0);r.setBoundaryNodes(this.getBoundaryNodes(),e.getBoundaryNodes());return this.createEdgeSetIntersector().computeIntersections(this._edges,e._edges,r),r},o.prototype.getGeometry=function(){return this._parentGeom},o.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},o.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},o.prototype.addPoint=function(){if(arguments[0]instanceof dt){var e=arguments[0].getCoordinate();this.insertPoint(this._argIndex,e,g.INTERIOR)}else if(arguments[0]instanceof C){var t=arguments[0];this.insertPoint(this._argIndex,t,g.INTERIOR)}},o.prototype.addPolygon=function(e){this.addPolygonRing(e.getExteriorRing(),g.EXTERIOR,g.INTERIOR);for(var t=0;t<e.getNumInteriorRing();t++){var i=e.getInteriorRingN(t);this.addPolygonRing(i,g.INTERIOR,g.EXTERIOR)}},o.prototype.addEdge=function(e){this.insertEdge(e);var t=e.getCoordinates();this.insertPoint(this._argIndex,t[0],g.BOUNDARY),this.insertPoint(this._argIndex,t[t.length-1],g.BOUNDARY)},o.prototype.addLineString=function(e){var t=c.removeRepeatedPoints(e.getCoordinates());if(t.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=t[0],null;var i=new rr(t,new h(this._argIndex,g.INTERIOR));this._lineEdgeMap.put(e,i),this.insertEdge(i),w.isTrue(t.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,t[0]),this.insertBoundaryPoint(this._argIndex,t[t.length-1])},o.prototype.getInvalidPoint=function(){return this._invalidPoint},o.prototype.getBoundaryPoints=function(){for(var e=this.getBoundaryNodes(),t=new Array(e.size()).fill(null),i=0,r=e.iterator();r.hasNext();){var n=r.next();t[i++]=n.getCoordinate().copy()}return t},o.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},o.prototype.addSelfIntersectionNode=function(e,t,i){if(this.isBoundaryNode(e,t))return null;i===g.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(e,t):this.insertPoint(e,t,i)},o.prototype.addPolygonRing=function(e,t,i){if(e.isEmpty())return null;var r=c.removeRepeatedPoints(e.getCoordinates());if(r.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=r[0],null;var n=t,o=i;x.isCCW(r)&&(n=i,o=t);var s=new rr(r,new h(this._argIndex,g.BOUNDARY,n,o));this._lineEdgeMap.put(e,s),this.insertEdge(s),this.insertPoint(this._argIndex,r[0],g.BOUNDARY)},o.prototype.insertPoint=function(e,t,i){var r=this._nodes.addNode(t),n=r.getLabel();null===n?r._label=new h(e,i):n.setLocation(e,i)},o.prototype.createEdgeSetIntersector=function(){return new An},o.prototype.addSelfIntersectionNodes=function(e){for(var t=this._edges.iterator();t.hasNext();)for(var i=t.next(),r=i.getLabel().getLocation(e),n=i.eiList.iterator();n.hasNext();){var o=n.next();this.addSelfIntersectionNode(e,o.coord,r)}},o.prototype.add=function(){if(1!==arguments.length)return s.prototype.add.apply(this,arguments);var e=arguments[0];if(e.isEmpty())return null;if(e instanceof vt&&(this._useBoundaryDeterminationRule=!1),e instanceof mt)this.addPolygon(e);else if(e instanceof B)this.addLineString(e);else if(e instanceof dt)this.addPoint(e);else if(e instanceof yt)this.addCollection(e);else if(e instanceof ut)this.addCollection(e);else if(e instanceof vt)this.addCollection(e);else{if(!(e instanceof lt))throw new Error(e.getClass().getName());this.addCollection(e)}},o.prototype.addCollection=function(e){for(var t=0;t<e.getNumGeometries();t++){var i=e.getGeometryN(t);this.add(i)}},o.prototype.locate=function(e){return _(this._parentGeom,gt)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new vn(this._parentGeom)),this._areaPtLocator.locate(e)):this._ptLocator.locate(e,this._parentGeom)},o.prototype.findEdge=function(){if(1===arguments.length){var e=arguments[0];return this._lineEdgeMap.get(e)}return s.prototype.findEdge.apply(this,arguments)},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o.determineBoundary=function(e,t){return e.isInBoundary(t)?g.BOUNDARY:g.INTERIOR},o}(M)),En=function(){if(this._li=new Se,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var e=arguments[0];this.setComputationPrecision(e.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new bn(0,e)}else if(2===arguments.length){var t=arguments[0],i=arguments[1],r=Re.OGC_SFS_BOUNDARY_RULE;t.getPrecisionModel().compareTo(i.getPrecisionModel())>=0?this.setComputationPrecision(t.getPrecisionModel()):this.setComputationPrecision(i.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new bn(0,t,r),this._arg[1]=new bn(1,i,r)}else if(3===arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2];n.getPrecisionModel().compareTo(o.getPrecisionModel())>=0?this.setComputationPrecision(n.getPrecisionModel()):this.setComputationPrecision(o.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new bn(0,n,s),this._arg[1]=new bn(1,o,s)}},Bn=(En.prototype.getArgGeometry=function(e){return this._arg[e].getGeometry()},En.prototype.setComputationPrecision=function(e){this._resultPrecisionModel=e,this._li.setPrecisionModel(this._resultPrecisionModel)},En.prototype.interfaces_=function(){return[]},En.prototype.getClass=function(){return En},function(){}),O=(Bn.prototype.interfaces_=function(){return[]},Bn.prototype.getClass=function(){return Bn},Bn.map=function(){if(arguments[0]instanceof b&&_(arguments[1],Bn.MapOp)){for(var e=arguments[0],t=arguments[1],i=new E,r=0;r<e.getNumGeometries();r++){var n=t.map(e.getGeometryN(r));null!==n&&i.add(n)}return e.getFactory().buildGeometry(i)}if(_(arguments[0],Ge)&&_(arguments[1],Bn.MapOp)){for(var o=arguments[0],s=arguments[1],a=new E,l=o.iterator();l.hasNext();){var u=l.next(),c=s.map(u);null!==c&&a.add(c)}return a}},Bn.MapOp=function(){},function(i){function o(){var e=arguments[0],t=arguments[1];i.call(this,e,t),this._ptLocator=new Br,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new ji,this._resultPolyList=new E,this._resultLineList=new E,this._resultPointList=new E,this._graph=new M(new qi),this._geomFact=e.getFactory()}return i&&(o.__proto__=i),o.prototype=Object.create(i&&i.prototype),o.prototype.constructor=o,o.prototype.insertUniqueEdge=function(e){var t=this._edgeList.findEqualEdge(e);if(null!==t){var i=t.getLabel(),r=e.getLabel();t.isPointwiseEqual(e)||(r=new h(e.getLabel())).flip();var n=t.getDepth();n.isNull()&&n.add(i),n.add(r),i.merge(r)}else this._edgeList.add(e)},o.prototype.getGraph=function(){return this._graph},o.prototype.cancelDuplicateResultEdges=function(){for(var e=this._graph.getEdgeEnds().iterator();e.hasNext();){var t=e.next(),i=t.getSym();t.isInResult()&&i.isInResult()&&(t.setInResult(!1),i.setInResult(!1))}},o.prototype.isCoveredByLA=function(e){return!!this.isCovered(e,this._resultLineList)||!!this.isCovered(e,this._resultPolyList)},o.prototype.computeGeometry=function(e,t,i,r){var n=new E;return n.addAll(e),n.addAll(t),n.addAll(i),n.isEmpty()?o.createEmptyResult(r,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(n)},o.prototype.mergeSymLabels=function(){for(var e=this._graph.getNodes().iterator();e.hasNext();)e.next().getEdges().mergeSymLabels()},o.prototype.isCovered=function(e,t){for(var i=t.iterator();i.hasNext();){var r=i.next();if(this._ptLocator.locate(e,r)!==g.EXTERIOR)return!0}return!1},o.prototype.replaceCollapsedEdges=function(){for(var e=new E,t=this._edgeList.iterator();t.hasNext();){var i=t.next();i.isCollapsed()&&(t.remove(),e.add(i.getCollapsedEdge()))}this._edgeList.addAll(e)},o.prototype.updateNodeLabelling=function(){for(var e=this._graph.getNodes().iterator();e.hasNext();){var t=e.next(),i=t.getEdges().getLabel();t.getLabel().merge(i)}},o.prototype.getResultGeometry=function(e){return this.computeOverlay(e),this._resultGeom},o.prototype.insertUniqueEdges=function(e){for(var t=e.iterator();t.hasNext();){var i=t.next();this.insertUniqueEdge(i)}},o.prototype.computeOverlay=function(e){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var t=new E;this._arg[0].computeSplitEdges(t),this._arg[1].computeSplitEdges(t),this.insertUniqueEdges(t),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Wr.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(e),this.cancelDuplicateResultEdges();var i=new ei(this._geomFact);i.add(this._graph),this._resultPolyList=i.getPolygons();var r=new Kr(this,this._geomFact,this._ptLocator);this._resultLineList=r.build(e);var n=new jr(this,this._geomFact,this._ptLocator);this._resultPointList=n.build(e),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,e)},o.prototype.labelIncompleteNode=function(e,t){var i=this._ptLocator.locate(e.getCoordinate(),this._arg[t].getGeometry());e.getLabel().setLocation(t,i)},o.prototype.copyPoints=function(e){for(var t=this._arg[e].getNodeIterator();t.hasNext();){var i=t.next();this._graph.addNode(i.getCoordinate()).setLabel(e,i.getLabel().getLocation(e))}},o.prototype.findResultAreaEdges=function(e){for(var t=this._graph.getEdgeEnds().iterator();t.hasNext();){var i=t.next(),r=i.getLabel();r.isArea()&&!i.isInteriorAreaEdge()&&o.isResultOfOp(r.getLocation(0,m.RIGHT),r.getLocation(1,m.RIGHT),e)&&i.setInResult(!0)}},o.prototype.computeLabelsFromDepths=function(){for(var e=this._edgeList.iterator();e.hasNext();){var t=e.next(),i=t.getLabel(),r=t.getDepth();if(!r.isNull()){r.normalize();for(var n=0;n<2;n++)i.isNull(n)||!i.isArea()||r.isNull(n)||(0===r.getDelta(n)?i.toLine(n):(w.isTrue(!r.isNull(n,m.LEFT),"depth of LEFT side has not been initialized"),i.setLocation(n,m.LEFT,r.getLocation(n,m.LEFT)),w.isTrue(!r.isNull(n,m.RIGHT),"depth of RIGHT side has not been initialized"),i.setLocation(n,m.RIGHT,r.getLocation(n,m.RIGHT))))}}},o.prototype.computeLabelling=function(){for(var e=this._graph.getNodes().iterator();e.hasNext();)e.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},o.prototype.labelIncompleteNodes=function(){for(var e=this._graph.getNodes().iterator();e.hasNext();){var t=e.next(),i=t.getLabel();t.isIsolated()&&(i.isNull(0)?this.labelIncompleteNode(t,0):this.labelIncompleteNode(t,1)),t.getEdges().updateLabelling(i)}},o.prototype.isCoveredByA=function(e){return!!this.isCovered(e,this._resultPolyList)},o.prototype.interfaces_=function(){return[]},o.prototype.getClass=function(){return o},o}(En)),Mn=(O.overlayOp=function(e,t,i){return new O(e,t).getResultGeometry(i)},O.intersection=function(e,t){if(e.isEmpty()||t.isEmpty())return O.createEmptyResult(O.INTERSECTION,e,t,e.getFactory());if(e.isGeometryCollection()){var i=t;return qr.map(e,{interfaces_:function(){return[Bn.MapOp]},map:function(e){return e.intersection(i)}})}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),sn.overlayOp(e,t,O.INTERSECTION)},O.symDifference=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return O.createEmptyResult(O.SYMDIFFERENCE,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),sn.overlayOp(e,t,O.SYMDIFFERENCE)},O.resultDimension=function(e,t,i){var r=t.getDimension(),n=i.getDimension(),o=-1;switch(e){case O.INTERSECTION:o=Math.min(r,n);break;case O.UNION:o=Math.max(r,n);break;case O.DIFFERENCE:o=r;break;case O.SYMDIFFERENCE:o=Math.max(r,n)}return o},O.createEmptyResult=function(e,t,i,r){var n=null;switch(O.resultDimension(e,t,i)){case-1:n=r.createGeometryCollection(new Array(0).fill(null));break;case 0:n=r.createPoint();break;case 1:n=r.createLineString();break;case 2:n=r.createPolygon()}return n},O.difference=function(e,t){return e.isEmpty()?O.createEmptyResult(O.DIFFERENCE,e,t,e.getFactory()):t.isEmpty()?e.copy():(e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),sn.overlayOp(e,t,O.DIFFERENCE))},O.isResultOfOp=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1],i=e.getLocation(0),r=e.getLocation(1);return O.isResultOfOp(i,r,t)}if(3===arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2];switch(n===g.BOUNDARY&&(n=g.INTERIOR),o===g.BOUNDARY&&(o=g.INTERIOR),s){case O.INTERSECTION:return n===g.INTERIOR&&o===g.INTERIOR;case O.UNION:return n===g.INTERIOR||o===g.INTERIOR;case O.DIFFERENCE:return n===g.INTERIOR&&o!==g.INTERIOR;case O.SYMDIFFERENCE:return n===g.INTERIOR&&o!==g.INTERIOR||n!==g.INTERIOR&&o===g.INTERIOR}return!1}},O.INTERSECTION=1,O.UNION=2,O.DIFFERENCE=3,O.SYMDIFFERENCE=4,function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Br,this._seg=new S;var e=arguments[0],t=arguments[1];this._g=e,this._boundaryDistanceTolerance=t,this._linework=this.extractLinework(e)}),In=(Mn.prototype.isWithinToleranceOfBoundary=function(e){for(var t=0;t<this._linework.getNumGeometries();t++)for(var i=this._linework.getGeometryN(t).getCoordinateSequence(),r=0;r<i.size()-1;r++){i.getCoordinate(r,this._seg.p0),i.getCoordinate(r+1,this._seg.p1);if(this._seg.distance(e)<=this._boundaryDistanceTolerance)return!0}return!1},Mn.prototype.getLocation=function(e){return this.isWithinToleranceOfBoundary(e)?g.BOUNDARY:this._ptLocator.locate(e,this._g)},Mn.prototype.extractLinework=function(e){var t=new In;e.apply(t);var i=t.getLinework(),r=l.toLineStringArray(i);return e.getFactory().createMultiLineString(r)},Mn.prototype.interfaces_=function(){return[]},Mn.prototype.getClass=function(){return Mn},function(){this._linework=null,this._linework=new E}),Sn=(In.prototype.getLinework=function(){return this._linework},In.prototype.filter=function(e){if(e instanceof mt){var t=e;this._linework.add(t.getExteriorRing());for(var i=0;i<t.getNumInteriorRing();i++)this._linework.add(t.getInteriorRingN(i))}},In.prototype.interfaces_=function(){return[st]},In.prototype.getClass=function(){return In},function(){this._g=null,this._doLeft=!0,this._doRight=!0;var e=arguments[0];this._g=e}),Pn=(Sn.prototype.extractPoints=function(e,t,i){for(var r=e.getCoordinates(),n=0;n<r.length-1;n++)this.computeOffsetPoints(r[n],r[n+1],t,i)},Sn.prototype.setSidesToGenerate=function(e,t){this._doLeft=e,this._doRight=t},Sn.prototype.getPoints=function(e){for(var t=new E,i=Er.getLines(this._g).iterator();i.hasNext();){var r=i.next();this.extractPoints(r,e,t)}return t},Sn.prototype.computeOffsetPoints=function(e,t,i,r){var n=t.x-e.x,o=t.y-e.y,s=Math.sqrt(n*n+o*o),a=i*n/s,l=i*o/s,u=(t.x+e.x)/2,c=(t.y+e.y)/2;if(this._doLeft){var h=new C(u-l,c+a);r.add(h)}if(this._doRight){var A=new C(u+l,c-a);r.add(A)}},Sn.prototype.interfaces_=function(){return[]},Sn.prototype.getClass=function(){return Sn},function e(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=e.TOLERANCE,this._testCoords=new E;var t=arguments[0],i=arguments[1],r=arguments[2];this._boundaryDistanceTolerance=e.computeBoundaryDistanceTolerance(t,i),this._geom=[t,i,r],this._locFinder=[new Mn(this._geom[0],this._boundaryDistanceTolerance),new Mn(this._geom[1],this._boundaryDistanceTolerance),new Mn(this._geom[2],this._boundaryDistanceTolerance)]}),Tn={TOLERANCE:{configurable:!0}},Ln=(Pn.prototype.reportResult=function(e,t,i){ye.out.println("Overlay result invalid - A:"+g.toLocationSymbol(t[0])+" B:"+g.toLocationSymbol(t[1])+" expected:"+(i?"i":"e")+" actual:"+g.toLocationSymbol(t[2]))},Pn.prototype.isValid=function(e){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var t=this.checkValid(e);return t},Pn.prototype.checkValid=function(){if(1===arguments.length){for(var e=arguments[0],t=0;t<this._testCoords.size();t++){var i=this._testCoords.get(t);if(!this.checkValid(e,i))return this._invalidLocation=i,!1}return!0}if(2===arguments.length){var r=arguments[0],n=arguments[1];return this._location[0]=this._locFinder[0].getLocation(n),this._location[1]=this._locFinder[1].getLocation(n),this._location[2]=this._locFinder[2].getLocation(n),!!Pn.hasLocation(this._location,g.BOUNDARY)||this.isValidResult(r,this._location)}},Pn.prototype.addTestPts=function(e){var t=new Sn(e);this._testCoords.addAll(t.getPoints(5*this._boundaryDistanceTolerance))},Pn.prototype.isValidResult=function(e,t){var i=O.isResultOfOp(t[0],t[1],e),r=!(i^t[2]===g.INTERIOR);return r||this.reportResult(e,t,i),r},Pn.prototype.getInvalidLocation=function(){return this._invalidLocation},Pn.prototype.interfaces_=function(){return[]},Pn.prototype.getClass=function(){return Pn},Pn.hasLocation=function(e,t){for(var i=0;i<3;i++)if(e[i]===t)return!0;return!1},Pn.computeBoundaryDistanceTolerance=function(e,t){return Math.min(N.computeSizeBasedSnapTolerance(e),N.computeSizeBasedSnapTolerance(t))},Pn.isValid=function(e,t,i,r){return new Pn(e,t,r).isValid(i)},Tn.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(Pn,Tn),function e(t){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=e.extractFactory(t),this._inputGeoms=t}),Dn=(Ln.prototype.extractElements=function(e,t){if(null===e)return null;for(var i=0;i<e.getNumGeometries();i++){var r=e.getGeometryN(i);this._skipEmpty&&r.isEmpty()||t.add(r)}},Ln.prototype.combine=function(){for(var e=new E,t=this._inputGeoms.iterator();t.hasNext();){var i=t.next();this.extractElements(i,e)}return 0===e.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(e)},Ln.prototype.interfaces_=function(){return[]},Ln.prototype.getClass=function(){return Ln},Ln.combine=function(){if(1===arguments.length){var e=arguments[0];return new Ln(e).combine()}if(2===arguments.length){var t=arguments[0],i=arguments[1];return new Ln(Ln.createList(t,i)).combine()}if(3===arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2];return new Ln(Ln.createList(r,n,o)).combine()}},Ln.extractFactory=function(e){return e.isEmpty()?null:e.iterator().next().getFactory()},Ln.createList=function(){if(2===arguments.length){var e=arguments[0],t=arguments[1],i=new E;return i.add(e),i.add(t),i}if(3===arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2],s=new E;return s.add(r),s.add(n),s.add(o),s}},function(){this._inputPolys=null,this._geomFactory=null;var e=arguments[0];this._inputPolys=e,null===this._inputPolys&&(this._inputPolys=new E)}),Fn={STRTREE_NODE_CAPACITY:{configurable:!0}},Nn=(Dn.prototype.reduceToGeometries=function(e){for(var t=new E,i=e.iterator();i.hasNext();){var r=i.next(),n=null;_(r,We)?n=this.unionTree(r):r instanceof b&&(n=r),t.add(n)}return t},Dn.prototype.extractByEnvelope=function(e,t,i){for(var r=new E,n=0;n<t.getNumGeometries();n++){var o=t.getGeometryN(n);o.getEnvelopeInternal().intersects(e)?r.add(o):i.add(o)}return this._geomFactory.buildGeometry(r)},Dn.prototype.unionOptimized=function(e,t){var i=e.getEnvelopeInternal(),r=t.getEnvelopeInternal();if(!i.intersects(r))return Ln.combine(e,t);if(e.getNumGeometries()<=1&&t.getNumGeometries()<=1)return this.unionActual(e,t);var n=i.intersection(r);return this.unionUsingEnvelopeIntersection(e,t,n)},Dn.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var e=new fi(Dn.STRTREE_NODE_CAPACITY),t=this._inputPolys.iterator();t.hasNext();){var i=t.next();e.insert(i.getEnvelopeInternal(),i)}this._inputPolys=null;var r=e.itemsTree();return this.unionTree(r)},Dn.prototype.binaryUnion=function(){if(1===arguments.length){var e=arguments[0];return this.binaryUnion(e,0,e.size())}if(3===arguments.length){var t=arguments[0],i=arguments[1],r=arguments[2];if(r-i<=1){var n=Dn.getGeometry(t,i);return this.unionSafe(n,null)}if(r-i==2)return this.unionSafe(Dn.getGeometry(t,i),Dn.getGeometry(t,i+1));var o=Math.trunc((r+i)/2),s=this.binaryUnion(t,i,o),a=this.binaryUnion(t,o,r);return this.unionSafe(s,a)}},Dn.prototype.repeatedUnion=function(e){for(var t=null,i=e.iterator();i.hasNext();){var r=i.next();t=null===t?r.copy():t.union(r)}return t},Dn.prototype.unionSafe=function(e,t){return null===e&&null===t?null:null===e?t.copy():null===t?e.copy():this.unionOptimized(e,t)},Dn.prototype.unionActual=function(e,t){return Dn.restrictToPolygons(e.union(t))},Dn.prototype.unionTree=function(e){var t=this.reduceToGeometries(e);return this.binaryUnion(t)},Dn.prototype.unionUsingEnvelopeIntersection=function(e,t,i){var r=new E,n=this.extractByEnvelope(i,e,r),o=this.extractByEnvelope(i,t,r),s=this.unionActual(n,o);r.add(s);return Ln.combine(r)},Dn.prototype.bufferUnion=function(){if(1===arguments.length){var e=arguments[0];return e.get(0).getFactory().buildGeometry(e).buffer(0)}if(2===arguments.length){var t=arguments[0],i=arguments[1];return t.getFactory().createGeometryCollection([t,i]).buffer(0)}},Dn.prototype.interfaces_=function(){return[]},Dn.prototype.getClass=function(){return Dn},Dn.restrictToPolygons=function(e){if(_(e,gt))return e;var t=br.getPolygons(e);return 1===t.size()?t.get(0):e.getFactory().createMultiPolygon(l.toPolygonArray(t))},Dn.getGeometry=function(e,t){return t>=e.size()?null:e.get(t)},Dn.union=function(e){return new Dn(e).union()},Fn.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(Dn,Fn),function(){});Nn.prototype.interfaces_=function(){return[]},Nn.prototype.getClass=function(){return Nn},Nn.union=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return O.createEmptyResult(O.UNION,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),sn.overlayOp(e,t,O.UNION)},t.GeoJSONReader=Ut,t.GeoJSONWriter=kt,t.OverlayOp=O,t.UnionOp=Nn,t.BufferOp=gr,Object.defineProperty(t,"__esModule",{value:!0})}(t)},844:function(e,t,i){e.exports.VectorTile=i(2578),i(6906),i(5421)},2578:function(e,t,i){"use strict";var r=i(5421);function n(e,t,i){3===e&&(e=new r(i,i.readVarint()+i.pos)).length&&(t[e.name]=e)}e.exports=function(e,t){this.layers=e.readFields(n,{},t)}},6906:function(e,t,i){"use strict";var u=i(4492);function h(e,t,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=n,e.readFields(o,this,t)}function o(e,t,i){if(1==e)t.id=i.readVarint();else if(2==e)for(var r=i,n=t,o=r.readVarint()+r.pos;r.pos<o;){var s=n._keys[r.readVarint()],a=n._values[r.readVarint()];n.properties[s]=a}else 3==e?t.type=i.readVarint():4==e&&(t._geometry=i.pos)}(e.exports=h).types=["Unknown","Point","LineString","Polygon"],h.prototype.loadGeometry=function(){for(var e,t,i=this._pbf,r=(i.pos=this._geometry,i.readVarint()+i.pos),n=1,o=0,s=0,a=0,l=[];i.pos<r;)if(o||(n=7&(t=i.readVarint()),o=t>>3),o--,1===n||2===n)s+=i.readSVarint(),a+=i.readSVarint(),1===n&&(e&&l.push(e),e=[]),e.push(new u(s,a));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}return e&&l.push(e),l},h.prototype.bbox=function(){for(var e,t=this._pbf,i=(t.pos=this._geometry,t.readVarint()+t.pos),r=1,n=0,o=0,s=0,a=1/0,l=-1/0,u=1/0,c=-1/0;t.pos<i;)if(n||(r=7&(e=t.readVarint()),n=e>>3),n--,1===r||2===r)(o+=t.readSVarint())<a&&(a=o),l<o&&(l=o),(s+=t.readSVarint())<u&&(u=s),c<s&&(c=s);else if(7!==r)throw new Error("unknown command "+r);return[a,u,l,c]},h.prototype.toGeoJSON=function(e,t,i){var r,n=this.extent*Math.pow(2,i),o=this.extent*e,s=this.extent*t,a=this.loadGeometry(),i=h.types[this.type];function l(e){for(var t=0;t<e.length;t++){var i=e[t],r=180-360*(i.y+s)/n;e[t]=[360*(i.x+o)/n-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:for(var u=[],c=0;c<a.length;c++)u[c]=a[c][0];l(a=u);break;case 2:for(c=0;c<a.length;c++)l(a[c]);break;case 3:for(a=function(e){var t=e.length;if(t<=1)return[e];for(var i,r,n=[],o=0;o<t;o++){var s=function(e){for(var t,i,r=0,n=0,o=e.length,s=o-1;n<o;s=n++)t=e[n],i=e[s],r+=(i.x-t.x)*(t.y+i.y);return r}(e[o]);0!==s&&((r=void 0===r?s<0:r)===s<0?(i&&n.push(i),i=[e[o]]):i.push(e[o]))}i&&n.push(i);return n}(a),c=0;c<a.length;c++)for(r=0;r<a[c].length;r++)l(a[c][r])}1===a.length?a=a[0]:i="Multi"+i;e={type:"Feature",geometry:{type:i,coordinates:a},properties:this.properties};return"id"in this&&(e.id=this.id),e}},5421:function(e,t,i){"use strict";var r=i(6906);function n(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(o,this,t),this.length=this._features.length}function o(e,t,i){15===e?t.version=i.readVarint():1===e?t.name=i.readString():5===e?t.extent=i.readVarint():2===e?t._features.push(i.pos):3===e?t._keys.push(i.readString()):4===e&&t._values.push(function(e){var t=null,i=e.readVarint()+e.pos;for(;e.pos<i;){var r=e.readVarint()>>3;t=1==r?e.readString():2==r?e.readFloat():3==r?e.readDouble():4==r?e.readVarint64():5==r?e.readVarint():6==r?e.readSVarint():7==r?e.readBoolean():null}return t}(i))}(e.exports=n).prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];e=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,e,this.extent,this._keys,this._values)}},5731:function(e,t,i){"use strict";var r=i(2053);t.Z=class{constructor(){this.requestOption=null}setNetInfo(){var e;this.requestOption&&(e=null,this.requestOption.authorization&&(e=this.requestOption.authorization,r.Z.setHeader({Authorization:e})),e=null,this.requestOption.serverUrl&&(e=this.requestOption.serverUrl,r.Z.setBaseUrl(e)),this._baseUrl=this.requestOption.baseUrl||agcim.net.apiPath._agcim_server_bim+"/agsupport/bimParamethy")}}},4207:function(e,t,i){"use strict";i.d(t,{Z:function(){return c}});var o=i(2053),t=i(5731),A=i(2759),p=i(7643),s=i(5271);var r=class{constructor(e,t,i){this._textureTable=null,this._entityTable=e,this._entityTableName=t,this._entityId=i,this.worldTransform=null,this.entityProperities=null}async getProperties(){var e=await this._entityTable.getPropertyById(this._entityTableName,this._entityId);if(e.success&&(null!==e.content&&""!=e.content))return e=e.content[0],this.entityProperities=e}async getWorldBoundingBox(){var e,t,i,r,n;if(this.worldTransform)return this.entityProperities||await this.getProperties(),this.entityProperities?(n=(e=JSON.parse(this.entityProperities.boundingbox)).Max,e=e.Min,i={X:(t={X:n.X,Y:n.Y,Z:e.Z}).X,Y:e.Y,Z:e.Z},r={X:e.X,Y:t.Y,Z:e.Z},n=s.Z.getWorldPosition(n,this.worldTransform,1),{planarPoints:[s.Z.getWorldPosition(e,this.worldTransform,1),s.Z.getWorldPosition(i,this.worldTransform,1),s.Z.getWorldPosition(t,this.worldTransform,1),s.Z.getWorldPosition(r,this.worldTransform,1)],maxPoint:n}):null;throw"本实体对象没有与世界地图对象进行绑定，难以获得世界位置。请通过bindWorldMapFeature()方法进行关联"}async getRelatedInfo(){var e={host:this._entityId},e=await this._entityTable.getPropertyByParams(this._entityTableName,e);if(e.success&&(null!==e.content&&""!=e.content))return e.content}async getGeometryInfo(){var e=await this._entityTable.getGeometryById(this._entityTableName,this._entityId);if(e.success&&(null!==e.content&&""!=e.content))return e.content[0]}async addToMap(t,i){var e=await this.getGeometryInfo(),r=JSON.parse(e.geometry),n=e.objectid,o=e.materialid.split(","),e="agcim3dtexture_"+this._entityTableName.split("_")[1],s=(this._textureTable||(this._textureTable=new p.Z),await this._textureTable.getTexture(e,o).getTexture());if(r.FaceIndices){r.Materails&&(o=r.Materails);for(let e=0;e<o.length;e++){var a,l,u=3*r.FaceIndices[e],c=0,c=o.length==e+1?r.VertexIndexes.length:3*r.FaceIndices[e+1],h=(a=(a=s[o[e]])||{color:Cesium.Color.GHOSTWHITE,translucent:!1},r.VertexIndexes.slice(u,c)),u=r.UVsIndex.slice(u,c),c={Vertices:r.Vertices,VertexIndexes:h,UVs:r.UVs,UVsIndex:u};(l=new A.Z(n,c,a,t)).primitive._asynchronous=!1,l.addToLayer(i)}}else a=s[o[0]],(l=new A.Z(n,r,null,t)).primitive._asynchronous=!1,l.addToLayer(i)}};class n extends r{constructor(e,t,i){super(e,t,i)}async getWindowCenterPosition(e){var t=this.getProperties(),i=t.topologyelements,t=JSON.parse(t.boundingbox),r=t.BoundingBox.Min,t=t.BoundingBox.Max,n={x:0,y:0},i=("东"==i.Facing&&(n.x+=.1),"南"==i.Facing&&(n.y-=.1),"西"==i.Facing&&(n.x-=.1),"北"==i.Facing&&(n.y+=.1),r={X:r.X+n.x,Y:r.Y+n.y,Z:r.Z},t={X:t.X+n.x,Y:t.Y+n.y,Z:t.Z},s.Z.getWorldPosition(r,e)),n=s.Z.getWorldPosition(t,e);return Cesium.BoundingSphere.fromCornerPoints(i,n).center}}var a=n;var l=new class{constructor(){this.matches={window:a}}match(e){return this.matches[e]}};class u extends t.Z{async getPropertyByParams(e,t){var i,r="tableName="+e;for(i in t)r+=`&${i}=`+t[i];return this.setNetInfo(),await o.Z.getData(agcim.net.apiPath.bimParamethy_dentity_find+"?"+r)}async getPropertyById(e,t){var i=t;return Array.isArray(t)&&(i=t.join(",")),this.setNetInfo(),await o.Z.getData(agcim.net.apiPath.bimParamethy_dentity_find+"?"+(`tableName=${e}&objectid=`+i))}async getFileterData(e,t,i){var r,n=`tableName=${e}&filterKey=`+t;for(r in i)n+=`&${r}=`+i[r];return this.setNetInfo(),await o.Z.getData(agcim.net.apiPath.bimParamethy_dentity_filter+"?"+n)}async getGeometryById(e,t){var i=t,t=(Array.isArray(t)&&(i=t.join(",")),this.setNetInfo(),`tableName=${e}&objectids=`+i);return await o.Z.getData(this._baseUrl+"/dentity/getGeometry?"+t)}getEntity(e,t,i){i=l.match(i);return new(i||r)(this,e,t)}}var c=u},7643:function(e,t,i){"use strict";i.d(t,{Z:function(){return s}});var r=i(2053),t=i(5731);var n=class{constructor(e,t,i){this._textureTable=e,this._textureTableName=t,this._materialId=i}async getTexture(){var e=await this._textureTable.getTexturesById(this._textureTableName,this._materialId);if(e.success&&null!==e.content&&""!=e.content){var t=e.content,i={};for(let e=0;e<t.length;e++)i[t[e].materialid]=this.getUsefulTexture(t[e]);return i}}getUsefulTexture(e){var t,i,r=!1;return null==e||""==e?{color:Cesium.Color.GHOSTWHITE,translucent:r,image:null}:((t=JSON.parse(e.textruesource)).material&&(t=JSON.parse(t.material.extensions.textruesource.Value)),i=JSON.parse(t.TintingColor),{color:Cesium.Color.fromBytes(i[0],i[1],i[2],255*(1-t.Transparency),new Cesium.Color),translucent:r=0<t.Transparency?!0:r,image:"data:image/png;base64,"+e.image})}};class o extends t.Z{async getTexturesById(e,t){var i=t;return Array.isArray(t)&&(i=t.join(",")),this.setNetInfo(),await r.Z.getData(agcim.net.apiPath.bimParamethy_dentity_getMaterial+"?"+(`tableName=${e}&materialids=`+i))}async getAllTextures(e){return this.setNetInfo(),await r.Z.getData(agcim.net.apiPath.bimParamethy_dentity_getMaterial+"?"+("tableName="+e))}getTexture(e,t){return new n(this,e,t)}}var s=o},1752:function(e,t,i){"use strict";i.d(t,{Z:function(){return A}});var r=i(4207),o=i(2053),t=i(5731);class n extends t.Z{async getProjectTree(){return this.setNetInfo(),await o.Z.getData("/bim-rest/agsupport/BIM/agcim3dproject/tree")}}var s=n;class a extends t.Z{async getBuildingInfo(e,t){this.setNetInfo();var i=await o.Z.getData(agcim.net.apiPath.bimParamethy_building_get+"?paramType=1&bldgId="+e);if(i.success&&null!==i.content&&""!=i.content){var r={};for(let e=0;e<t.length;e++){var n=t[e];r[n]=i.content[n]}return r}}}var l=a,u=i(7643),c=i(7681);var h=class{constructor(e){this.bimTableServer=e}fromFeature(e,r){var t=e.tileset,n=c.Z.getTilesetFeatureObjectIdValue(e),o=t._asset.buildingId,s=t.root.transform;let a=this;return new Promise((t,i)=>{a.bimTableServer.buildingTable.getBuildingInfo(o,["entitytable"]).then(e=>{(e?(e=e.entitytable,(e=a.bimTableServer.entityTable.getEntity(e,n,r)).worldTransform=s,t):(e="该模型还没有入库,无法通过BuildingID="+o+" 查找建筑表",console.error(e),i))(e)})})}};var A=new class p{constructor(){this.entityTable=new r.Z,this.entityBus=new h(this),this.buildingTable=new l,this.projectTable=new s,this.textureTable=new u.Z,this._requestOption=null,Object.defineProperties(p.prototype,{requestOption:{get:function(){return this._requestOption},set:function(e){this._requestOption=e,this.entityTable.requestOption=this._requestOption,this.buildingTable.requestOption=this._requestOption,this.projectTable.requestOption=this._requestOption,this.textureTable.requestOption=this._requestOption}}})}}},2759:function(O,e,t){"use strict";t.d(e,{Z:function(){return N}});var l=t(9745);var a=new class{constructor(){}transform(t,e,i){var r=l.Z.getCGCS2000(),n=[];if("WGS84"==e.toUpperCase())for(let e=0;e<t.length;e++){var o=l.Z.getWgs84().toCartesian3({lng:t[e][0],lat:t[e][1],alt:t[e][2]});n.push(o)}else if(0==e.toUpperCase().indexOf("CGCS2000")){var s=e.substring(10);r.CentralLongitude=""==s?r.CentralLongitude:parseFloat(s);for(let e=0;e<t.length;e++){var a=r.toWGS84(t[e][0],t[e][1]),o=l.Z.getWgs84().toCartesian3(a);n.push(o)}}else if("Cartesian"==e)for(let e=0;e<t.length;e++){o=new Cesium.Cartesian3(t[e][0],t[e][1],t[e][2]);i&&(o=i.transformToWorld([o])[0]),n.push(o)}return n}},u=t(7017),r=t(920);class o{constructor(){this.beanType="Agm::Prism",this.height=0,this.polygon=null}}var i=new class{constructor(){this.filter="Agm::Prism",this.height=0}parseJson(e,t,i){var r=new o,n=t.path;return r.height=t.height,r.polygon=a.transform(n,e.agmSrs,i),r}toGeometry(e,t,i){t=new r.Z(e.name,t.polygon,{material:i.color,extrudedHeight:t.height,perPositionHeight:!0,...i});return t.agPolygon.labeltext=e.label,t}toInstanceGeometry(e){e=new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(e.polygon),extrudedHeight:e.height});return{geometry:Cesium.PolygonGeometry.createGeometry(e)}}build(e,t,i){var r=this.calculateBoundingBox(t,i)["center"],n=t.length,o=[];for(let e=0;e<n;e+=2)o[e/2]=l.Z.getWgs84().toCartesian3({lng:t[e],lat:t[e+1],alt:0}),o[n/2+e/2]=l.Z.getWgs84().toCartesian3({lng:t[e],lat:t[e+1],alt:i});var r=u.Z.createLocalCoordinateHelper(r).transformToLocal(o).map(e=>(e.X=e.x.toFixed(2),e.Y=e.y.toFixed(2),e.Z=e.z.toFixed(2),delete e.x,delete e.y,delete e.z,e)),s=this.calculateIndices(n/2);return e.model={Vertices:r,VertexIndexes:s.vertextIndexes,UVs:[{X:0,Y:0},{X:0,Y:1},{X:1,Y:1},{X:1,Y:0}],UVsIndex:s.uvsIndex,PolymeshIndex:[0,1],FaceIndices:s.faceIndices},e}calculateBoundingBox(t,i){var r=t.length,n=[];for(let e=0;e<r;e+=2){var o=l.Z.getWgs84().toCartesian3({lng:t[e],lat:t[e+1],alt:0}),s=l.Z.getWgs84().toCartesian3({lng:t[e],lat:t[e+1],alt:i});n.push(o,s)}return Cesium.BoundingSphere.fromPoints(n)}calculateIndices(t){var i=[],r=[],n=[],o=[];for(let e=0;e<t;e++)e==t-1?i.push(0,t,t-1+t,t-1+t,t-1,0):i.push(e+1,e+1+t,e+t,e+t,e,e+1),r.push(2,3,0,0,1,2);for(let e=0;e<t-2;e++)e%2==0?(n.push(0,e+1,e+2),o.push(t,t+e+1,t+e+2)):(n.push(e+1,e+2,0),o.push(t+e+1,t+e+2,t));i.push(...n),i.push(...o),r.push(1,2,3,3,0,1,1,2,3,3,0,1);var s=[];for(let e=0;e<2*t;e+=2)s.push(e);return s.push(2*t+(t-2)),{vertextIndexes:i,uvsIndex:r,faceIndices:s}}},c=t(1696);new class{parseJson(e){var t=!1,i="",e=(null!=e.image&&""!=e.image&&(i="data:image/png;base64,"+e.image),JSON.parse(e.texturesource));if(e.material){if(!e.material.extensions||"{}"==JSON.stringify(e.material.extensions))return r=e.material.pbrMetallicRoughness.baseColorFactor,{color:Cesium.Color.fromBytes(255*r[0],255*r[1],255*r[2],255*r[3],new Cesium.Color),translucent:t="BLEND"==e.material.alphaMode||r[3]<1?!0:t,image:i};e=JSON.parse(e.material.extensions.textruesource.Value)}var r=JSON.parse(e.TintingColor);return{color:Cesium.Color.fromBytes(r[0],r[1],r[2],255*(1-e.Transparency),new Cesium.Color),translucent:t=0<e.Transparency?!0:t,image:i}}parseJsonV2(e){var t,i,r=!1,n="",o=e.type.toLowerCase(),s=Cesium.Color.YELLOW;return e.color&&(s=Cesium.Color.fromBytes(255*e.color[0],255*e.color[1],255*e.color[2],255*e.color[3],new Cesium.Color)),"mesh"==o?(null!=e.image&&""!=e.image&&(n="data:image/png;base64,"+e.image),t=e.pbrMetallicRoughness.baseColorFactor,{color:Cesium.Color.fromBytes(255*t[0],255*t[1],255*t[2],255*t[3],new Cesium.Color),translucent:r="BLEND"==e.alphaMode||t[3]<1?!0:r,image:n}):"text"==o?(i={},e.font&&(i.font=e.font),e.hasOwnProperty("showBackground")&&(i.showBackground=e.showBackground),e.color&&(i.fillColor=s),e.border&&(i.outlineColor=Cesium.Color.fromBytes(255*e.border[0],255*e.border[1],255*e.border[2],255*e.border[3],new Cesium.Color)),e.backgroundColor&&(i.backgroundColor=Cesium.Color.fromBytes(255*e.backgroundColor[0],255*e.backgroundColor[1],255*e.backgroundColor[2],255*e.backgroundColor[3],new Cesium.Color)),e.pixelOffset&&(i.pixelOffset=new Cesium.Cartesian2(e.pixelOffset[0],e.pixelOffset[1])),i):"fill"==o?((i={}).color=s,i.outline=!1,e.outline&&(i.outline=!0,i.outlineColor=Cesium.Color.fromBytes(255*e.outline[0],255*e.outline[1],255*e.outline[2],255*e.outline[3],new Cesium.Color)),i):"line"==o?((i={}).color=s,i.width=e.width,i):"point"==o?((i={}).color=s,i.pixelSize=e.pixelSize,e.border&&(i.outlineColor=Cesium.Color.fromBytes(255*e.border.color[0],255*e.border.color[1],255*e.border.color[2],255*e.border.color[3],new Cesium.Color),i.outlineWidth=e.border.width),i):"icon"==o?((i={}).color=s,i.image=e.image,i.pixelSize=e.pixelSize,i.transparency=1!=e.transparency,i):"agpbrmetallicroughnessmaterial"==o?((i={}).material=new c.Z(e),i):{color:Cesium.Color.YELLOW,translucent:!1,image:null}}};var n=t(2130);class s{constructor(){this.text="",this.point=null,this.beanType="Agm::Anno"}}var h=new class{constructor(){this.filter="Agm::Anno"}parseJson(e,t,i){var r=new s,n=t.point;return r.text=t.text,r.point=a.transform([n],e.agmSrs,i)[0],r}toGeometry(e,t,i){return new n.Z(e.name,t.point,t.text,i)}},A=t(2406);class p{constructor(){this.beanType="Agm::Polyline",this.lineWidth=1,this.line=null}}var f=new class{constructor(){this.filter="Agm::Arc"}parseJson(e,t,i){var r=new p,n=(r.lineWidth=e.symbols[0].width||1,t.center),o=t.radius,n=a.transform([n],e.agmSrs,i)[0],e=agcim.maths.math.createLocalCoordinateHelper(n),i=e.transformToLocal([n])[0],n=Cesium.Math.toRadians(360)-t.endAngle,t=Cesium.Math.toRadians(360)-t.startAngle,i=A.sg([i.x,i.y],o,n,t),s=[],o=(i.forEach(e=>{s.push(new Cesium.Cartesian3(e[0],e[1],0))}),e.transformToWorld(s));return r.line=o,r}},d=t(6746);var g=new class{constructor(){this.filter="Agm::BezierLine"}parseJson(e,t,i){var r={beanType:"Agm::Polyline",lineWidth:e.symbols[0].width||1},t=t.controlPoints,t=a.transform(t,e.agmSrs,i);let n=[];t.forEach(e=>{e=l.Z.getWgs84().formCartesian3(e);n.push([e.lng,e.lat])});var e=d.Z.generateCurve(n),o=[],i=(e.forEach(e=>{o.push(e[0]),o.push(e[1])}),Cesium.Cartesian3.fromDegreesArray(o));return r.line=i,r}},R=t(7710);class U{constructor(){this.center=null,this.blockParams=Cesium.Cartesian3.ZERO,this.beanType="Agm::Block"}}var m=new class{constructor(){this.filter="Agm::Block",this.blockParams=Cesium.Cartesian3.ZERO}parseJson(e,t,i){var r=new U,e=a.transform([t.bottom],e.agmSrs,i)[0],i=l.Z.getGlobalCartesian().toGeographic(e);return r.center=Cesium.Cartesian3.fromDegrees(i.lng,i.lat,i.alt+t.height/2),r.blockParams=new Cesium.Cartesian3(t.depth,t.width,t.height),r}toGeometry(e,t,i){t={name:e.name,position:t.center,box:{dimensions:t.blockParams,material:i.color,label:e.label}};return new R.Z(t)}toInstanceGeometry(e){var t=Cesium.BoxGeometry.fromDimensions({dimensions:e.blockParams});return{geometry:Cesium.BoxGeometry.createGeometry(t),modelMatrix:Cesium.Transforms.eastNorthUpToFixedFrame(e.center)}}},y=t(1284);class k{constructor(){this.height=0,this.radius=0,this.center=null,this.beanType="Agm::Cone"}}var _=new class{constructor(){this.filter="Agm::Cone"}parseJson(e,t,i){var r=new k,e=a.transform([t.bottomCenter],e.agmSrs,i)[0],i=(r.height=t.height,r.radius=t.radius,l.Z.getGlobalCartesian().toGeographic(e));return r.center=Cesium.Cartesian3.fromDegrees(i.lng,i.lat,i.alt+t.height/2),r}toGeometry(e,t,i){var r={color:i.color,topRadius:0,bottomRadius:t.radius},r=new y.Z(e.name,r);return r.createEntity(t.center,t.height,i),r.entity.labeltext=e.label,r}toInstanceGeometry(e){var t=new Cesium.CylinderGeometry({length:e.height,topRadius:0,bottomRadius:e.radius});return{geometry:Cesium.CylinderGeometry.createGeometry(t),modelMatrix:Cesium.Transforms.eastNorthUpToFixedFrame(e.center)}}};class H{constructor(){this.height=0,this.radius=0,this.center=null,this.beanType="Agm::Cylinder"}}var v=new class{constructor(){this.filter="Agm::Cylinder",this.height=0,this.radius=0,this.center=null}parseJson(e,t,i){var r=new H,e=a.transform([t.bottomCenter],e.agmSrs,i)[0],i=(r.height=t.height,r.radius=t.topRadius,l.Z.getGlobalCartesian().toGeographic(e));return r.center=Cesium.Cartesian3.fromDegrees(i.lng,i.lat,i.alt+r.height/2),r}toGeometry(e,t,i){var r={color:i.color,topRadius:t.radius,bottomRadius:t.radius},r=new y.Z(e.name,r);return r.createEntity(t.center,t.height,i),r.entity.labeltext=e.label,r}toInstanceGeometry(e){var t=new Cesium.CylinderGeometry({length:e.height,topRadius:e.radius,bottomRadius:e.radius});return{geometry:Cesium.CylinderGeometry.createGeometry(t),modelMatrix:Cesium.Transforms.eastNorthUpToFixedFrame(e.center)}}};class C{constructor(){this.beanType="Agm::Mesh",this.model={vertices:[],vertexIndexes:[],uvs:[],uvsIndexes:[],Center:null,faceRange:[]},this.matrix4=Cesium.Matrix4.multiplyByTranslation(Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(113.32445849,23.12016038,1)),new Cesium.Cartesian3(0,0,0),new Cesium.Matrix4),this.texture=null}}var Q=new class{constructor(){this.filter="Agm::Mesh"}parseJson(e,t,i){var r=new C,n=(i&&(r.matrix4=i._transform),t.Vertices||t.vertices),n=this.transform(e.agmSrs,n),i=t.UVs||t.uvs,e=t.UVsIndex||t.uvsIndex||t.uvsIndexes;if(r.model={vertices:n,vertexIndexes:t.VertexIndexes||t.vertexIndexes,uvs:null==i?[]:i,uvsIndexes:null==e?[]:e},null==t.faceRanges||t.faceRanges.length<1)return r;var o=[];for(let e=0;e<t.faceRanges.length;e++){var s=3*t.faceRanges[e][0],a=3*(t.faceRanges[e][1]+1),l=r.model.vertexIndexes.slice(s,a),s=r.model.uvsIndexes.slice(s,a),a=new C;a.model={vertices:n,vertexIndexes:l,uvs:r.model.uvs,uvsIndexes:s},o.push(a)}return o}transform(e,t){if(!e||"WGS84"!=e.toUpperCase())return t;var i=[];for(let e=0;e<t.length;e++)i[e]=l.Z.getWgs84().toCartesian3({lng:t[e].X,lat:t[e].Y,alt:t[e].Z});e=u.Z.createLocalCoordinateHelper(i[0]).transformToLocal(i).map(e=>(e.X=e.x.toFixed(2),e.Y=e.y.toFixed(2),e.Z=e.z.toFixed(2),delete e.x,delete e.y,delete e.z,e));return this.matrix4=Cesium.Matrix4.multiplyByTranslation(Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(t[0].X,t[0].Y,t[0].Z)),new Cesium.Cartesian3(0,0,0),new Cesium.Matrix4),e}toGeometry(e,t,i){i=new N(e.name,t.model,i,t.matrix4);return i.primitive._asynchronous=!1,i.primitive.label=e.name,i}};var V=new class{constructor(){this.filter="Agm::MultiPoint"}parseJson(e,t,i){var r=[],t=t.points,n=a.transform(t,e.agmSrs,i);for(let e=0;e<n.length;e++)r.push({beanType:"Agm::Point",point:n[e]});return r}};var G=new class{constructor(){this.filter="Agm::MultiPolygon"}parseJson(t,e,i){var r=e.path,n=[];for(let e=0;e<r.length;e++){var o=a.transform(r[e],t.agmSrs,i);n.push({beanType:"Agm::Polygon",polygon:o})}return n}};var z=new class{constructor(){this.filter="Agm::MultiPolyline"}parseJson(t,e,i){var r=e.path,n=[];for(let e=0;e<r.length;e++){var o=a.transform(r[e],t.agmSrs,i);n.push({beanType:"Agm::Polyline",line:o,lineWidth:t.symbols[0].width||1})}return n}},W=t(5924),w=t(1558);var q=new class{constructor(){this.filter="Agm::Point"}parseJson(e,t,i){t=t.point;return{beanType:"Agm::Point",point:a.transform([t],e.agmSrs,i)[0]}}toGeometry(e,t,i){var r,n;return i.image?(r=new w.Z(e.name,t.point,i.image,i),n.agBillboard.labeltext=e.label,r):((n=new W.Z(e.name,t.point,{color:i.color,label:e.label,...i})).agPoint.labeltext=e.label,n)}},K=t(8728);class j{constructor(){this.beanType="Agm::Polyline",this.line=null,this.lineWidth=1}}var x=new class{constructor(){this.filter="Agm::Polyline"}parseJson(e,t,i){var r=new j,t=t.path;return r.line=a.transform(t,e.agmSrs,i),r.lineWidth=e.symbols[0].width||1,r}toGeometry(e,t,i){t=new K.Z(e.name,t.line,{material:i.color,...i});return t.agPolyline.labeltext=e.label,t}toInstanceGeometry(e){e=new Cesium.PolylineGeometry({positions:e.line,width:e.lineWidth});return{geometry:Cesium.PolylineGeometry.createGeometry(e)}}};var b=new class{constructor(){this.filter="Agm::Polygon"}parseJson(e,t,i){t=t.path;return{beanType:"Agm::Polygon",polygon:a.transform(t,e.agmSrs,i)}}toGeometry(e,t,i){t=new r.Z(e.name,t.polygon,{material:i.color,...i});return t.agPolygon.labeltext=e.label,t}toInstanceGeometry(e){e=new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(e.polygon)});return{geometry:Cesium.PolygonGeometry.createGeometry(e)}}},Z=t(8986);class Y{constructor(){this.rectangle=null,this.beanType="Agm::Rectangle"}}var E=new class{constructor(){this.filter="Agm::Rectangle"}parseJson(e,t,i){var r=new Y,n=t.center,o=t.width,t=t.height,n=a.transform([n],e.agmSrs,i)[0],e=agcim.maths.math.createLocalCoordinateHelper(n),i=e.transformToLocal([n])[0],n=new Cesium.Cartesian3(i.x+o/2,i.y+t/2),o=new Cesium.Cartesian3(i.x-o/2,i.y-t/2);return r.rectangle=e.transformToWorld([n,o]),r}toGeometry(e,t,i){return new Z.Z(e.name,t.rectangle,{material:i.color,label:e.label,...i})}toInstanceGeometry(e){e=new Cesium.RectangleGeometry({rectangle:Cesium.Rectangle.fromCartesianArray(e.rectangle)});return{geometry:Cesium.RectangleGeometry.createGeometry(e)}}};class X extends t(8423).Z{constructor(e,t){t.ellipsoid.radii=new Cesium.Cartesian3(e,e,e),super(t)}}class J{constructor(){this.beanType="Agm::Sphere",this.radius=0,this.center=null}}var B=new class{constructor(){this.filter="Agm::Sphere"}parseJson(e,t,i){var r=new J,t=(r.radius=t.radius,a.transform([t.bottomCenter],e.agmSrs,i)[0]),e=l.Z.getGlobalCartesian().toGeographic(t);return r.center=Cesium.Cartesian3.fromDegrees(e.lng,e.lat,e.alt+r.radius),r}toGeometry(e,t,i){i={name:e.name,position:t.center,ellipsoid:{material:i.color,...i},labeltext:e.label};return new X(t.radius,i)}toInstanceGeometry(e){var t=new Cesium.EllipsoidGeometry({radii:new Cesium.Cartesian3(e.radius,e.radius,e.radius)});return{geometry:Cesium.EllipsoidGeometry.createGeometry(t),modelMatrix:Cesium.Transforms.eastNorthUpToFixedFrame(e.center)}}};class ${constructor(e,t,i,r){this.name=e,this.positions=t,this.options=r,this.entity=null,this.createEntity(t,i)}createEntity(e,t){e={positions:e,shape:t,material:Cesium.Color.YELLOW};this.entity=new Cesium.Entity({name:this.name,polylineVolume:{...e,...this.options}})}addToLayer(e){e.addEntity(this.entity)}setPosition(e){this.position=e}getPosition(){return this.position._value}}class ee{constructor(){this.polyline=null,this.shape=null,this.beanType="Agm::SweptModel"}}var M=new class{constructor(){this.filter="Agm::SweptModel",this.shape=null}parseJson(e,t,i){var r=new ee,n=t.surface,t=t.direction;r.shape=[],r.polyline=a.transform(t,e.agmSrs,i);for(let e=0;e<n.length;e++)r.shape.push(new Cesium.Cartesian2(n[e][0],n[e][1]));return r}toGeometry(e,t,i){t=new $(e.name,t.polyline,t.shape,{material:i.color,label:e.label,...i});return t.entity.labeltext=e.label,t}toInstanceGeometry(e){e=new Cesium.PolylineVolumeGeometry({polylinePositions:e.polyline,shapePositions:e.shape});return{geometry:Cesium.PolylineVolumeGeometry.createGeometry(e)}}};class te{constructor(){this.beanType="Agm::Reference",this.height=0,this.polygon=null}}var ie=new class{constructor(){this.filter="Agm::Reference",this.text="",this.image=""}parseJson(e,t,i){var r=new te,n=t.point,t=(r.text=t.text,t.icon);return null!=t&&""!=t&&(t.startsWith("http")||t.startsWith("data:image/png;")?r.image=t:r.image="data:image/png;base64,"+t),r.point=a.transform([n],e.agmSrs,i)[0],r}toGeometry(e,t,i){var r=new w.Z(e.name,t.point,t.image,i);return r.agBillboard.label={text:t.text,showBackground:!0,backgroundColor:Cesium.Color.fromCssColorString("#f99d0d"),disableDepthTestDistance:Number.POSITIVE_INFINITY,...i},r.agBillboard.labeltext=e.label,r}};var re=new class{constructor(){this.filter="Agm::Triangle"}parseJson(e,t,i){var r=t.p1,r=(t.p2,[r,t.p3,p3]);return{beanType:"Agm::Polygon",polygon:a.transform(r,e.agmSrs,i)}}};var ne=new class{constructor(){this.filter="Agm::GeometryCollection"}parseJson(t,e,i,r){var n=e.geometries,o=[];for(let e=0;e<n.length;e++)for(var s=0;s<r.length;s++)if(r[s].filter==n[e].type){var a=r[s].parseJson(t,n[e],i);a&&(a instanceof Array?o=o.concat(a):o.push(a));break}return o}};class oe{constructor(e,t,i,r={}){this.name=e,this.position=t,this.options=r,this.entity=null,this.createEntity(t,i)}createEntity(e,t){this.entity=new Cesium.Entity({name:this.name,position:e,orientation:this.options.orientation||Cesium.Cartesian4.ONE,model:{uri:t,scale:this.options.scale||1}})}addToLayer(e){e.addEntity(this.entity)}setPosition(e){this.position=e}getPosition(){return this.position._value}}class se{constructor(){this.position=null,this.url=null,this.orientation=null,this.scale=1,this.beanType="Agm::GeometryFeature"}}var ae=new class{constructor(){this.filter="Agm::GeometryFeature"}parseJson(e,t,i){var r=new se,n=t.position.srs,o=t.position.point,o=a.transform([o],n,i)[0],n=t.rotation.point,i=new Cesium.Cartesian4(n[0],n[1],n[2],n[3]);return r.position=o,r.url=t.url,r.orientation=i,r.scale=t.scale,r}toGeometry(e,t){return new oe(e.name,t.position,t.url,{orientation:t.orientation,scale:t.scale})}};var le=new class{constructor(){this.filter="icon"}toMaterial(e){var t={};return t.color=new Cesium.Color(e.color[0],e.color[1],e.color[2],e.color[3]),t.pixelSize=e.pixelSize,t.transparency=1!=e.transparency,e.image.startsWith("http")||e.image.startsWith("data:image/png;")?t.image=e.image:t.image="data:image/png;base64,"+e.image,t}};var ue=new class{constructor(){this.filter="text"}toMaterial(e){var t={};return e.text&&(t.text=e.text),e.color&&(t.fillColor=new Cesium.Color(e.color[0],e.color[1],e.color[2],e.color[3])),e.font&&(t.font=e.font),e.hasOwnProperty("showBackground")&&(t.showBackground=e.showBackground),e.border&&(t.outlineColor=new Cesium.Color(e.border[0],e.border[1],e.border[2],e.border[3])),e.backgroundColor&&(t.backgroundColor=Cesium.Color.fromBytes(e.backgroundColor[0],e.backgroundColor[1],e.backgroundColor[2],e.backgroundColor[3])),e.style&&(t.style=Cesium.LabelStyle[e.style]),e.pixelOffset&&(t.pixelOffset=new Cesium.Cartesian2(e.pixelOffset[0],e.pixelOffset[1])),t}};var ce=new class{constructor(){this.filter="point"}toMaterial(e){var t={};return t.color=new Cesium.Color(e.color[0],e.color[1],e.color[2],e.color[3]),t.pixelSize=e.pixelSize,e.border&&(t.outlineColor=new Cesium.Color(e.border.color[0],e.border.color[1],e.border.color[2],e.border.color[3]),t.outlineWidth=e.border.width),t}};var I=new class{constructor(){this.filter="line"}toAppearance(e){var t=new Cesium.Color(e.color[0],e.color[1],e.color[2],e.color[3]),i=1!=e.color[3],r=new Cesium.PolylineMaterialAppearance({translucent:i,material:Cesium.Material.fromType("Color",{color:t})});if(e.style){var n=e.style,o=null;switch(n.type){case"PolylineDash":var s=this.parsePolylineDash(n,t),o=new Cesium.Material({fabric:{type:"PolylineDash",uniforms:s}});break;case"PolylineArrow":o=new Cesium.Material({fabric:{type:"PolylineArrow",uniforms:{color:t}}})}r=new Cesium.PolylineMaterialAppearance({material:o,translucent:i})}return r}toMaterial(e){var t={};if(t.color=new Cesium.Color(e.color[0],e.color[1],e.color[2],e.color[3]),t.width=e.width,e.style){var i=e.style;switch(i.type){case"PolylineDash":var r=this.parsePolylineDash(i,t.color);t.material=new Cesium.PolylineDashMaterialProperty(r);break;case"PolylineArrow":t.material=new Cesium.PolylineArrowMaterialProperty(t.color)}}return t}parsePolylineDash(e,t){return{color:t,gapColor:e.gapColor?new Cesium.Color(e.gapColor[0],e.gapColor[1],e.gapColor[2],e.gapColor[3]):Cesium.Color.TRANSPARENT,dashLength:e.dashLength||16,dashPattern:e.dashPattern||255}}};class he{constructor(){this.color=null,this.outline=!1,this.outlineColor=Cesium.Color.BLACK,this.material=Cesium.Color.WHITE}}var S=new class{constructor(){this.filter="fill"}toMaterial(e){var t=new he;if(t.color=new Cesium.Color(e.color[0],e.color[1],e.color[2],e.color[3]),t.outline=!1,t.material=t.color,e.outline&&(t.outline=!0,t.outlineColor=new Cesium.Color(e.outline[0],e.outline[1],e.outline[2],e.outline[3])),e.style){var i=e.style;switch(i.type){case"Grid":var r=this.parseGrid(i);t.material=new Cesium.GridMaterialProperty(r);break;case"Stripe":r=this.parseStrip(i);t.material=new Cesium.StripeMaterialProperty(r)}}return t}toAppearance(e){var t=new Cesium.Color(e.color[0],e.color[1],e.color[2],e.color[3]),i=1!=e.color[3],t=new Cesium.MaterialAppearance({material:new Cesium.Material({fabric:{type:"Color",uniforms:{color:t}}}),translucent:i,flat:!0});if(e.style){var r=e.style,n=null;switch(r.type){case"Grid":var o=this.parseGrid(r),n=new Cesium.Material({fabric:{type:"Grid",uniforms:o}});break;case"Stripe":o=this.parseStrip(r);n=new Cesium.Material({fabric:{type:"Stripe",uniforms:o}})}t=new Cesium.MaterialAppearance({material:n,translucent:i,flat:!0})}return t}parseGrid(e){var t={};return e.cellAlpha&&(t.cellAlpha=e.cellAlpha),e.lineCount&&(t.lineCount=new Cesium.Cartesian2(e.lineCount[0],e.lineCount[1])),e.lineThickness&&(t.lineThickness=new Cesium.Cartesian2(e.lineThickness[0],e.lineThickness[1])),e.lineOffset&&(t.lineOffset=new Cesium.Cartesian2(e.lineOffset[0],e.lineOffset[1])),t}parseStrip(e){var t={};return e.orientation&&(t.orientation=Cesium.StripeOrientation[e.orientation]),e.evenColor&&(t.evenColor=new Cesium.Color(e.evenColor[0],e.evenColor[1],e.evenColor[2],e.evenColor[3])),e.oddColor&&(t.oddColor=new Cesium.Color(e.oddColor[0],e.oddColor[1],e.oddColor[2],e.oddColor[3])),e.offset&&(t.offset=e.offset),e.repeat&&(t.repeat=e.repeat),t}};var P=new class{constructor(){this.filter="mesh"}toMaterial(e){var t=null,i=!1,r=(null!=e.image&&""!=e.image&&(t=e.image.startsWith("http")||e.image.startsWith("data:image/png;")?e.image:"data:image/png;base64,"+e.image),e.pbrMetallicRoughness.baseColorFactor);return{color:Cesium.Color.fromBytes(255*r[0],255*r[1],255*r[2],255*r[3],new Cesium.Color),translucent:i="BLEND"==e.alphaMode||r[3]<1?!0:i,image:t}}},Ae=t(7156);var T=new class{constructor(){this.filter="agpbrmetallicroughnessmaterial"}toAppearance(e){var e=new Ae.Z(e),t=e.baseColorFactor.w<1;return new Cesium.MaterialAppearance({material:e.material,translucent:t,flat:!0})}toMaterial(e){var t={};return t.material=new c.Z(e),t}};var L=new class{constructor(){this._parserItems=[le,ue,ce,I,S,P,T],this._appearanceItems=[S,I,P,T]}toMaterial(e){if(!e.type)return e;for(var t=e.type.toLowerCase(),i=0;i<this._parserItems.length;i++)if(this._parserItems[i].filter==t)return this._parserItems[i].toMaterial(e)}toAppearance(e){if(e.type)for(var t=e.type.toLowerCase(),i=0;i<this._appearanceItems.length;i++)if(this._appearanceItems[i].filter==t)return this._appearanceItems[i].toAppearance(e);return new Cesium.PerInstanceColorAppearance({translucent:!1,flat:!1})}parseJson(t,i){var r,n,o,s=[];for(let e=0;e<t.length;e++)"symbol"==t[e].type?(r=t[e].uri,n=i.findIndex(e=>e.id==r),s.push(n)):"simple"==t[e].type?(r=t[e].uri,n=i.findIndex(e=>e.id==r),o={...t[e],...n},s.push(o)):s.push(t[e]);return s.length<1&&s.push({color:Cesium.Color.YELLOW,translucent:!1}),s}parseTable(e,i){if(!i)return[{color:Cesium.Color.YELLOW,translucent:!1}];var r=[],n=e.split(",");for(let t=0;t<n.length;t++){var o=i.find(e=>e.materialid==n[t]),s={};s.image=o.image,null!=o.texturesource&&""!=o.texturesource&&(s=(o=JSON.parse(o.texturesource)).material?{...s,...o.material,type:"mesh"}:{...s,...s.source}),r.push(s)}return r.length<1&&r.push({color:Cesium.Color.YELLOW,translucent:!1}),r}};var D=class{constructor(e,t){this.primitive=null,this.boundingSphere=null,this.createPrimitive(e,t)}createPrimitive(t,e){if(t instanceof Array)for(let e=0;e<t.length;e++)this.updateBoundingSpere(t[e]);else this.updateBoundingSpere(t);this.primitive=new Cesium.Primitive({geometryInstances:t,appearance:e,asynchronous:!1})}updateBoundingSpere(e){var t=e.modelMatrix,i=null;i=Cesium.Matrix4.equals(t,Cesium.Matrix4.IDENTITY)?e.geometry.boundingSphere:(e=Cesium.Matrix4.getTranslation(t,new Cesium.Cartesian3),new Cesium.BoundingSphere(e,0)),this.boundingSphere?this.boundingSphere=Cesium.BoundingSphere.union(this.boundingSphere,i,new Cesium.BoundingSphere):this.boundingSphere=i}addToLayer(e){this.primitive&&(e.addPrimitive(this.primitive),e.updateBoundingSpere(this.boundingSphere))}getBoundingSphere(){return this.boundingSphere}remove(e){this.primitive&&e.removePrimitive(this.primitive)}};var F=class{constructor(){this.id="",this.uuid="",this.name="",this.type="",this.symbols=[],this.agmType="",this.agmSrs="",this.beans=[]}fromPrism(e,t){i.build(this,e,t)}fromJSON(e,t,i){for(var r=e.geometry,n=r.type,o=(this.agmType=n,this.id=e.id,this.uuid=e.uuid,this.name=e.name,this.agmSrs=r.srs,null),i=(null!=i&&(o=agcim.maths.math.createLocalCoordinateHelper(i)),e.symbols),s=(this.symbols=L.parseJson(i,t),this.getParseItem()),a=0;a<s.length;a++)if(s[a].filter==n){var l=s[a].parseJson(this,r,o,s);l&&(l instanceof Array?this.beans=this.beans.concat(l):this.beans.push(l));break}}fromBinary(e){}fromTable(e,t,i){var r=null,n=null,n=e.geometry?(r=JSON.parse(e.geometry)).type:(r=JSON.parse(e.geometryfeature),"Agm::GeometryFeature");this.agmType=n,this.id=e.objectid,this.uuid=e.id,this.name=e.name,this.agmSrs=r.srs;for(var o=null,i=(null!=i&&(o=agcim.maths.math.createLocalCoordinateHelper(i)),e.materialid),s=(this.symbols=L.parseTable(i,t),this.getParseItem()),a=0;a<s.length;a++)if(s[a].filter==n){var l=s[a].parseJson(this,r,o,s);l&&(l instanceof Array?this.beans=this.beans.concat(l):this.beans.push(l));break}}computeGeometryBuffer(){for(var e=this.model,t=e.VertexIndexes||e.vertexIndexes,i=t.length-3;0<i;i-=3)t[i]!=t[i+1]&&t[i]!=t[i+2]&&t[i+2]!=t[i+1]||t.splice(i,3);var r=new Float64Array(3*t.length),n=new Float32Array(3*t.length),o=e.Vertices||e.vertices,s=e.Center,a=null,l=(null!=s&&(a=new Float64Array(3*t.length)),0),u=[];for(let e=0;e<t.length/3;e++){var c=t[3*e],h=t[3*e+1],A=t[3*e+2],c=o[c],h=o[h],A=o[A],p=new Cesium.Cartesian3,f=new Cesium.Cartesian3,c=(c.hasOwnProperty("X")?(p=new Cesium.Cartesian3(c.X-h.X,c.Y-h.Y,c.Z-h.Z),f=new Cesium.Cartesian3(c.X-A.X,c.Y-A.Y,c.Z-A.Z),r[l]=c.X,r[l+1]=c.Y,r[l+2]=c.Z,r[l+3]=h.X,r[l+4]=h.Y,r[l+5]=h.Z,r[l+6]=A.X,r[l+7]=A.Y,r[l+8]=A.Z):(p=new Cesium.Cartesian3(c[0]-h[0],c[1]-h[1],c[2]-h[2]),f=new Cesium.Cartesian3(c[0]-A[0],c[1]-A[1],c[2]-A[2]),r[l]=c[0],r[l+1]=c[1],r[l+2]=c[2],r[l+3]=h[0],r[l+4]=h[1],r[l+5]=h[2],r[l+6]=A[0],r[l+7]=A[1],r[l+8]=A[2]),Cesium.Cartesian3.cross(p,f,new Cesium.Cartesian3));try{Cesium.Cartesian3.normalize(c,c)}catch{c=new Cesium.Cartesian3(0,0,1)}n[l]=c.x,n[l+1]=c.y,n[l+2]=c.z,n[l+3]=c.x,n[l+4]=c.y,n[l+5]=c.z,n[l+6]=c.x,n[l+7]=c.y,n[l+8]=c.z,null!=s&&(a[l]=s.x,a[l+1]=s.y,a[l+2]=s.z,a[l+3]=s.x,a[l+4]=s.y,a[l+5]=s.z,a[l+6]=s.x,a[l+7]=s.y,a[l+8]=s.z),l+=9,u.push(u.length),u.push(u.length),u.push(u.length)}var d=e.UVsIndex||e.uvsIndexes||e.uvsIndex||[],g=e.UVs||e.uvs,m=new Float32Array(2*d.length),y=0;for(let e=0;e<d.length;e++){var _=d[e];_<0||((_=g[_]).hasOwnProperty("X")?(m[y]=_.X,m[y+1]=_.Y):(m[y]=_[0],m[y+1]=_[1]),y+=2)}return{positions:r,verticalNoraml:n,uvs:m,index:new Uint16Array(u),center:a}}toGeometry(){var e=[],t=this.getParseItem(),i=[];for(let e=0;e<this.symbols.length;e++){var r=L.toMaterial(this.symbols[e]);i.push(r)}for(var n=0;n<this.beans.length;n++)for(var o=0;o<t.length;o++)if(t[o].filter==this.beans[n].beanType){var s=n<i.length?i[n]:i[0];e.push(t[o].toGeometry(this,this.beans[n],s));break}return 1==e.length?e[0]:e}toGeometryInstance(){for(var e=this.getParseItem(!0),t=[],i=0;i<this.beans.length;i++)for(var r=0;r<e.length;r++)if(e[r].filter==this.beans[i].beanType){var n=e[r].toInstanceGeometry(this.beans[i]),o=(n.modelMatrix=n.modelMatrix||Cesium.Matrix4.IDENTITY,this.symbols[0].color||Cesium.Color.WHITE),o=(this.symbols>r&&(o=this.symbols[r].color||Cesium.Color.WHITE),new Cesium.GeometryInstance({geometry:n.geometry,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(o)},modelMatrix:n.modelMatrix}));t.push(o);break}return t}toPrimitive(){var t=[],i=this.toGeometryInstance();for(let e=0;e<this.symbols.length;e++){var r=L.toAppearance(this.symbols[e]);t.push(r)}if(1==t.length)return s=new D(i,t[0]);var n=[];for(let e=0;e<i.length;e++){var o=t[0],s=(t.length>e&&(o=t[e]),new D(i[e],o));n.push(s)}return n}getParseItem(e){return e?[x,b,b,f,g,m,_,v,E,B,i,M]:[q,x,b,Q,h,f,g,m,ie,re,_,v,V,G,z,E,B,i,M,ne,ae]}};var N=class{constructor(e,t,i,r){this.name=e,this.primitive=null,this.boundingSphere=null,this.createPrimitive(t,i,r)}createPrimitive(t,i,r){null==i&&(i={color:Cesium.Color.RED,translucent:!1});var n=this.name,o=[],e=this.getApperance(i),s=t.VertexIndexes||t.vertexIndexes,a=t.UVsIndex||t.uvsIndexes,l=s.length;if(3e4<l){var u=parseInt(l/3e4)+1;for(let e=0;e<u;e++){var c=3e4*e,h=3e4*(e+1),A=(u.length==e+1&&(h=l),s.slice(c,h)),p=[],c=(a&&(p=a.slice(c,h)),{vertices:t.Vertices||t.vertices,vertexIndexes:A,uvs:t.UVs||t.uvs,uvsIndexes:p,Center:t.Center}),f=((d=new F).model=c,d.computeGeometryBuffer());(g=this.getInstance(f,r,i)).id=n,o.push(g)}}else{(d=new F).model=t;var d,g,f=d.computeGeometryBuffer();(g=this.getInstance(f,r,i)).id=n,o.push(g)}e=new Cesium.Primitive({geometryInstances:o,appearance:e});e._compressVertices=!1,this.primitive=e}getApperance(e){var t=new Cesium.PerInstanceColorAppearance({translucent:e.translucent,flat:!1});return t=null!=e.image&&""!=e.image?new Cesium.MaterialAppearance({material:new Cesium.Material({fabric:{type:"Image",uniforms:{image:e.image}},translucent:e.translucent}),translucent:e.translucent,flat:!0}):t}getInstance(e,t,i){var r=e.positions,n=e.verticalNoraml,o=e.uvs,s=e.center,n=new Cesium.Geometry({attributes:{position:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:r}),normal:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:n})},indices:e.index,primitiveType:Cesium.PrimitiveType.TRIANGLES,boundingSphere:Cesium.BoundingSphere.fromVertices(r)}),e=Cesium.BoundingSphere.fromVertices(r);return this.boundingSphere=Cesium.BoundingSphere.transform(e,t,new Cesium.BoundingSphere),null!=i.image&&""!=i.image&&0<o.length&&(n.attributes.st=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:o})),s&&(n.attributes.center=new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:s})),new Cesium.GeometryInstance({geometry:n,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(i.color),show:new Cesium.ShowGeometryInstanceAttribute(!0)},modelMatrix:t})}addToLayer(e){e.addPrimitive(this.primitive)}remove(e){e.removePrimitive(this.primitive)}dispose(){this.name=null,this.primitive=null}}},5271:function(e,t,i){"use strict";i.d(t,{Z:function(){return p}});var u=i(8728),r=i(9195),c=i(1133);var h=new class{parseBoundingBox(e){return e.boundingbox&&" "!=e.boundingbox?(e=JSON.parse(e.boundingbox)).BoundingBox||e:null}parseTopologyelements(e){return e.topologyelements&&" "!=e.topologyelements?{EdgeArray:(e=JSON.parse(e.topologyelements)).EdgeArray,Facing:e.Facing,Sizes:e.Sizes,Boundary:e.Boundary,Inside:e.Inside,Transform:e.Transform,FacingFlipped:e.FacingFlipped,HandFlipped:e.HandFlipped,FacingOrientation:e.FacingOrientation,HandOrientation:e.HandOrientation,Path:e.Path,Width:e.Width}:null}parseElementattributes(e){return e.elementattributes&&" "!=e.elementattributes?JSON.parse(e.elementattributes):null}parseGeometry(e){return e.geometry&&" "!=e.geometry?{Vertices:(e=JSON.parse(e.geometry)).Vertices,VertexIndexes:e.VertexIndexes,UVs:e.UVs,UVsIndex:e.UVsIndex,VerticPolymeshIndexes:e.PolymeshIndex,Materails:e.Materails}:null}parseSimpifygeometry(e){return e.simpifygeometry&&" "!=e.simpifygeometry?JSON.parse(e.simpifygeometry):null}};class A{createBorder_v1(t,i,r,n){for(let e=0;e<i.length;e++){var o=t.getWorldPosition(i[e].XYZ1,r,.3048,n),s=t.getWorldPosition(i[e].XYZ2,r,.3048,n);new u.Z("房间",[o,s],{material:Cesium.Color.RED,width:2}).addToLayer(t.featureLayer)}}createBorder_v2(t,i,r,n,e,o){var s=[];for(let e=0;e<i.length;e++){i[e]instanceof Array?i[e][2]=3.28*n.Max.Z:i[e].Z=3.28*n.Max.Z;var a=t.getWorldPosition(i[e],r,.3048,o);s.push(a)}var l=n.Max.Z-n.Min.Z,e=agcim.maths.coordinate.getGlobalCartesian().toGeographic(e);new agcim.geometry.Polygon("房间",s,{material:Cesium.Color.LIGHTPINK.withAlpha(.2),height:l,heightReference:Cesium.HeightReference.NONE,perPositionHeight:!0,outline:!0,fill:!0,extrudedHeight:e.alt}).addToLayer(t.featureLayer)}getBoundingBox(e){return e.BoundingBox||(e.Max&&e.Min?e:h.parseBoundingBox(e))}getEdgeArray(e){return e.EdgeArray||h.parseTopologyelements(e).EdgeArray}}t=new class{flyTo(e,t,i,r,n){"string"==typeof e&&(e=JSON.parse(e));var t=t.root.computedTransform,o=(this.removeMark(),this.initialize(r),this.featureLayer.removeAll(),new A),s=o.getBoundingBox(e),a=this.getWorldPosition(s.Min,t,1,n),l=this.getWorldPosition(s.Max,t,1,n),l=Cesium.BoundingSphere.fromCornerPoints(a,l),r=r.scene.camera,u=new Cesium.HeadingPitchRange(r.heading,r.pitch,0);"Room"!=i&&"Area"!=i||((i=o.getEdgeArray(e).path||o.getEdgeArray(e))&&0<i.length&&i[0].XYZ1?o.createBorder_v1(this,i,t,n):o.createBorder_v2(this,i,t,s,a,n)),r.flyToBoundingSphere(l,{offset:u})}getExportMethods(){return["flyTo"]}};for(var n=new class{constructor(){this.allPolyLine=[],this.featureLayer=null}initialize(e){this.featureLayer||(this.featureLayer=new c.Z(e))}getModelMatrix(e,t){var i=h.parseBoundingBox(t),t=h.parseTopologyelements(t),i=this.createBoundingBox(i),i=new Cesium.Cartesian4(i.center.x,i.center.y,i.center.z,0),e=Cesium.Matrix4.multiplyByTranslation(e,i,new Cesium.Matrix4),i=e,t=t.Facing,r=null;return"东"==t?r=Cesium.Matrix3.fromRotationZ(Cesium.Math.toRadians(90)):"西"==t?r=Cesium.Matrix3.fromRotationZ(Cesium.Math.toRadians(270)):"北"==t&&(r=Cesium.Matrix3.fromRotationZ(Cesium.Math.toRadians(180))),i=null!=r?Cesium.Matrix4.multiplyByMatrix3(e,r,new Cesium.Matrix4):i}getWorldPosition(e,t,i=1,r){var n=e.X||e[0],o=e.Y||e[1],e=e.Z||e[2]||0,n=new Cesium.Cartesian3(n*i,o*i,e*i),o=new Cesium.Cartesian4(n.x,n.y,n.z),n=(r&&(e=(r.Min.X+r.Max.X)/2,i=(r.Min.Y+r.Max.Y)/2,o.x-=e,o.y-=i,o.z-=r.Min.Z-1),Cesium.Matrix4.multiplyByTranslation(t,o,new Cesium.Matrix4));return Cesium.Matrix4.getTranslation(n,new Cesium.Cartesian3)}computeComponentPosition(e,t,i){var e=h.parseBoundingBox(e),r=this.getWorldPosition(e.Min,t,1,i),e=this.getWorldPosition(e.Max,t,1,i);return Cesium.BoundingSphere.fromCornerPoints(r,e)}async getComponentPosition(s,a,e,l){return r.Z.getProperty(e,s).then(e=>{if(!e.success)return null;var t=e.content,i=[],r={};for(let e=0;e<t.length;e++){var n=t[e],o=this.computeComponentPosition(n,a,l);if(!Array.isArray(s))return o;r[n.objectid]=o}for(let e=0;e<s.length;e++)i.push(r[s[e]]);return i})}markingSize(e,t,i){this.removeMark(),this.featureLayer||(this.featureLayer=new c.Z(CIM.viewer));var r=h.parseTopologyelements(e),n=r.Sizes;for(let e=0;e<n.length;e++){"东"==r.Facing?(n[e].Start.X+=.15,n[e].End.X+=.15):"南"==r.Facing?(n[e].Start.Y-=.15,n[e].End.Y-=.15):"西"==r.Facing?(n[e].Start.X-=.15,n[e].End.X-=.15):"北"==r.Facing&&(n[e].Start.Y+=.15,n[e].End.Y+=.15);var o=this.getWorldPosition(n[e].Start,t,.3048),s=this.getWorldPosition(n[e].End,t,.3048),a=new Cesium.Cartesian3.midpoint(o,s,new Cesium.Cartesian3),l=(1e3*(.3048*n[e].Length).toFixed(4)).toString()+"mm",o=new u.Z("尺寸标注",[o,s],{material:i,width:2,pixelSize:5});o.addToLayer(this.featureLayer),o.position=a,o.label={text:l,font:"14px sans-serif",fillColor:Cesium.Color.GOLD,style:Cesium.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,verticalOrigin:Cesium.VerticalOrigin.TOP,pixelOffset:new Cesium.Cartesian2(0,5)},this.allPolyLine.push(o)}}getSizes(e){var t=h.parseTopologyelements(e),i=[];for(let e=0;e<t.Sizes.length;e++){var r=1e3*(.3048*t.Sizes[e].Length).toFixed(4);i.push(r)}return"南"==t.Facing||"北"==t.Facing?i[0]+"×"+i[2]:i[1]+"×"+i[2]}isSuitable(e,t,i){var r,e=h.parseBoundingBox(e),e=this.createBoundingBox(e),n=h.parseBoundingBox(t),n=this.createBoundingBox(n),t=this.getSizes(t),n=new Cesium.Cartesian3(n.center.x-e.center.x,n.center.y-e.center.y,n.center.z-e.center.z),e=h.parseTopologyelements(data),o=null,o=("南"==e.Facing||"北"==e.Facing?(r=(t.split("×")[0]/2/1e3-n.x).toFixed(3),t.split("×")[0]/2/1e3+n.x):(r=(t.split("×")[0]/2/1e3-n.y).toFixed(3),t.split("×")[0]/2/1e3+n.y)).toFixed(3),e=(t.split("×")[1]/2/1e3-n.z).toFixed(3),t=(t.split("×")[1]/2/1e3+n.z).toFixed(3),n=i.split("×")[0]/2/1e3,i=i.split("×")[1]/2/1e3;return!(r<n||o<n||e<i||t<i)}getClippingPlane(e,t,i){var r,i=i.split("×"),n=r=-i[1]/1e3/2,o=i=-i[0]/1e3/2,e=h.parseBoundingBox(e),e=this.createBoundingBox(e),t=h.parseBoundingBox(t),t=(t.BoundingBox&&(t=t.BoundingBox),this.createBoundingBox(t)),s=t.center.y-e.center.y,a=t.center.x-e.center.x,t=t.center.z-e.center.z,e=0*Math.PI/180;return new Cesium.ClippingPlaneCollection({modelMatrix:Cesium.Matrix4.fromTranslation(new Cesium.Cartesian3(s,a,t)),planes:[new Cesium.ClippingPlane(new Cesium.Cartesian3(0,0,-1),n),new Cesium.ClippingPlane(new Cesium.Cartesian3(0,0,1),r),new Cesium.ClippingPlane(new Cesium.Cartesian3(-Math.cos(e),-Math.sin(e),0),.2),new Cesium.ClippingPlane(new Cesium.Cartesian3(Math.cos(e),Math.sin(e),0),.2),new Cesium.ClippingPlane(new Cesium.Cartesian3(Math.sin(e),-Math.cos(e),0),o),new Cesium.ClippingPlane(new Cesium.Cartesian3(-Math.sin(e),Math.cos(e),0),i)],edgeWidth:0,edgeColor:Cesium.Color.WHITE,enabled:!0})}createBoundingBox(e){var t=new Cesium.Cartesian3(e.Min.X,e.Min.Y,e.Min.Z),e=new Cesium.Cartesian3(e.Max.X,e.Max.Y,e.Max.Z);return Cesium.BoundingSphere.fromCornerPoints(t,e,new Cesium.BoundingSphere)}getBoundingBox(t){var i=[];for(let e=0;e<t.length;e++)i.push(new Cesium.Cartesian3(t[e].X,t[e].Y,t[e].Z));return Cesium.AxisAlignedBoundingBox.fromPoints(i)}removeMark(){this.featureLayer&&this.featureLayer.removeAll()}dispose(){this.featureLayer&&(this.featureLayer.removeAll(),this.featureLayer.dispose(0))}},o=[t],s=0;s<o.length;s++)for(var a=o[s].getExportMethods(),l=0;l<a.length;l++)n[a[l]]=o[s][a[l]];var p=n},9195:function(e,t,i){"use strict";var o=i(2053);class r{get property_url(){return agcim.net.apiPath.bim_dentitya_find}get methods_url(){return agcim.net.apiPath.bimParamethy_dentity_get}get statics_url(){return agcim.net.apiPath.bim_dentitya_statistics}get tableInfo_Url(){return agcim.net.apiPath.bimParamethy_building_get}}t.Z=new class{constructor(){this.requestOption=null,this._urlHelper=new r}async getFileterData(e,t){e="tableName="+e;return t.filterKey&&(e+="&filterKey="+t.filterKey),t.profession&&(e+="&profession="+t.profession),t.level&&(e+="&level="+t.level),t.catagory&&(e+="&catagory="+t.catagory),t.familyname&&(e+="&familyname="+t.familyname),t.familytype&&(e+="&familytype="+t.familytype),t.infotype&&(e+="&infotype="+t.infotype),await o.Z.getDataByGet(agcim.net.apiPath.bim_dentitya_filter+"?"+e)}async getPropertyByParams(e,t){var i,r="tableName="+e;for(i in t)r+=`&${i}=`+t[i];return this.setNetInfo(),await o.Z.getData(this._urlHelper.property_url+"?"+r)}setNetInfo(){var e=null;this.requestOption&&this.requestOption.authorization&&(e=this.requestOption.authorization,o.Z.setHeader({Authorization:e}));this.requestOption&&this.requestOption.serverUrl&&(e=this.requestOption.serverUrl,o.Z.setBaseUrl(e))}async getProperty(e,t){var i=t,t=(Array.isArray(t)&&(i=t.join(",")),this.setNetInfo(),`tableName=${e}&objectid=`+i);return await o.Z.getDataByGet(this._urlHelper.property_url+"?"+t)}async shortFindProperty(e,t){var i=t,e=`tableName=${e}&objectid=`+(i=Array.isArray(t)?t.join(","):i);return await o.Z.getDataByGet(agcim.net.apiPath.bim_dentitya_shortFind+"?"+e)}async shortFindAllComponents(e,t){e=`tableName=${e}&catagorys=`+encodeURIComponent(t);return await o.Z.getDataByGet(agcim.net.apiPath.bim_dentitya_shortFind+"?"+e)}async getAllComponents(e,t){e=`tableName=${e}&catagory=`+encodeURIComponent(t);return await o.Z.getDataByGet(this._urlHelper.property_url+"?"+e)}async getStatics(e,t,i){e=`tableName=${e}&countKey=${t}&groupKey=${t}&profession=`+i.profession;return i.level&&(e+="&level="+i.level),i.catagory&&(e+="&catagory="+i.catagory),i.familyname&&(e+="&familyname="+i.familyname),i.familytype&&(e+="&familytype="+i.familytype),await o.Z.getDataByGet(this._urlHelper.statics_url+"?"+e)}async getTableName(e){return this.setNetInfo(),await o.Z.getDataByGet(this._urlHelper.tableInfo_Url+"?paramType=1&bldgId="+e,{headers:{}})}async getTableList(e){return await o.Z.getDataByGet(this._urlHelper.tableInfo_Url+"?paramType=2&id="+e)}async getCompareDataTwo(e,t,i,r,n){i=`paramType=${i}&baseTableName=${e}&targetTableName=${t}&columns=${r}&page=1&rows=50`;return n.dtgcid&&(i+="&dtgcid="+n.dtgcid),n.projectcode&&(i+="&projectcode="+n.projectcode),n.projectnum&&(i+="&projectnum="+n.projectnum),n.version&&(i+="&version="+n.version),n.profession&&(i+="&profession="+n.profession),n.level&&(i+="&level="+n.level),n.catagory&&(i+="&catagory="+n.catagory),n.boundingbox&&(i+="&boundingbox="+n.boundingbox),n.userdata&&(i+="&userdata="+n.userdata),n.objectid&&(i+="&objectid="+n.objectid),n.columns&&(i+="&columns="+r),await o.Z.getDataByGet(this._urlHelper.methods_url+"?"+i)}}},1710:function(e,t,i){"use strict";i.d(t,{Z:function(){return p}});var r=i(9720),n=i(1618),l=i(7017);t=new class{flyToTileset(e,t,i){e.flyTo(t,i)}flyToTilesetOfFace(e,t,i){var r=e.scene.camera,n=new Cesium.HeadingPitchRange(r.heading,0,400),r=t._root.transform,r=l.Z.getRotationFromTransform(r),o=l.Z.getAngleFromMatrix(r).z,s=Cesium.Math.toRadians(o),a={};switch(i){case"up":n.heading=Cesium.Math.PI+Cesium.Math.toRadians(o),n.pitch=-Cesium.Math.PI/2,a.pitch=-90,a.heading=0;break;case"down":n.heading=Cesium.Math.PI+Cesium.Math.toRadians(o),n.pitch=Cesium.Math.PI,a.pitch=90,a.heading=0;break;case"left":n.heading=-Cesium.Math.PI_OVER_TWO+s,a.heading=90;break;case"right":n.heading=Cesium.Math.PI_OVER_TWO+s,a.heading=270;break;case"front":n.heading=-Cesium.Math.PI+s,a.heading=0;break;case"back":n.heading=s,a.heading=180}return e.flyTo(t,{duration:1,offset:n}),a}getExportMethods(){return["flyToTileset","flyToTilesetOfFace"]}};var o=new class{getCameraHeight(e){return e.camera._positionCartographic.height}getDistanceFromSurface(e){var t=e._ellipsoid,i=e._scene.camera,r=0,t=t.cartesianToCartographic(i.position,new Cesium.Cartographic),i=(Cesium.defined(t)&&(r=t.height),Cesium.defaultValue(e._scene.globeHeight,0));return Math.abs(i-r)}getExportMethods(){return["getCameraHeight","getDistanceFromSurface"]}},s=i(9745);for(var a=new class{setCamera(e,t){t.heading?e.camera.setView({destination:t.position,orientation:{heading:t.heading,roll:t.roll,pitch:t.pitch}}):e.camera.setView({destination:t.position})}setCameraByPosition(e,t){e.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(t[0],t[1],t[2])})}setCameraByRectangle(e,t,i,r,n,o){o&&o.animate?e.camera.flyTo({destination:Cesium.Rectangle.fromDegrees(t,i,r,n),...o}):(o=o||{},e.camera.setView({destination:Cesium.Rectangle.fromDegrees(t,i,r,n),...o}))}setCameraController(e,t){if(null!=t)for(var i in t)e.scene.screenSpaceCameraController[i]=t[i]}flyTo(e,t,i){t&&(i=i||{},t.position||t.longitude&&t.latitude&&(t.position=Cesium.Cartesian3.fromDegrees(t.longitude,t.latitude,t.height)),t.heading?e.camera.flyTo({destination:t.position,orientation:{heading:t.heading,roll:t.roll,pitch:t.pitch},...i}):e.camera.flyTo({destination:t.position,...i}))}flyToBoundingSphere(e,t,i=10){t=new Cesium.BoundingSphere(t,i);e.camera.flyToBoundingSphere(t)}cameraFlyTo(e,t){e.camera.flyTo(t)}flyToEntity(e,t,i){let r=t;"string"==typeof t&&(r=n.Z.getEntitiesByEntityId(e,t)),Array.isArray(r)?r[0]&&e.flyTo(r[0],i):e.flyTo(r,i)}resetCamera(e){e.camera.lookAtTransform(Cesium.Matrix4.IDENTITY)}getCameraAsJSON(e){var t={};return t.position=e.camera.positionWC.clone(),t.heading=e.camera.heading,t.pitch=e.camera.pitch,t.roll=e.camera.roll,t}getViewExtent(e){var t,i,r=e.camera.computeViewRectangle();return r||(r=e.scene.canvas,i=new Cesium.Cartesian2(0,0),r=new Cesium.Cartesian2(r.clientWidth,r.clientHeight),t=e.scene.globe.ellipsoid,i=e.camera.pickEllipsoid(i,t),e=e.camera.pickEllipsoid(r,t),i&&e?Cesium.Rectangle.fromCartesianArray([i,e]):void 0)}getScreenCornerCoordinates(){var e=this.getViewExtent(CIM.viewer),t=Cesium.Rectangle.subsample(e),i=[];for(let e=0;e<t.length;e++)i[e]=s.Z.getGlobalCartesian().toGeographic(new Cesium.Cartesian3(t[e].x,t[e].y,t[e].z));return i}getCenterPosition(e){var t=e.camera.pickEllipsoid(new Cesium.Cartesian2(e.canvas.clientWidth/2,e.canvas.clientHeight/2)),t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(t);return{lng:180*t.longitude/Math.PI,lat:180*t.latitude/Math.PI,alt:this.getCameraHeight(e)}}flyByEntityId(e,t,i){t=r.Z.getEntitiesByEntityId(e,t);t[0]&&e.flyTo(t[0],i)}},u=[t,o],c=0;c<u.length;c++)for(var h=u[c].getExportMethods(),A=0;A<h.length;A++)a[h[A]]=u[c][h[A]];var p=a},4723:function(e,t,i){"use strict";i.d(t,{Z:function(){return o}});var r=new class{getShift(){return{x:5625709.989926453,y:12347.3628296942}}getViewShift(){return{x:5697414.258678359,y:242211.15230822048}}getName(){return"GUANGZHOU2000"}};i(2053);var n=new class{getName(){return"4326"}transfromData(e,i){if(i.crs&&i.crs.properties&&i.crs.properties.name&&(i.crs.properties.name="urn:ogc:def:crs:EPSG::4326"),!e||e.spatialReference){var r=new Cesium.CRSSupport(e.spatialReference);if(e.centerLon&&r.setCentralMeridian(e.centerLon),e.centerLat&&r.setLatitudeOfOrigin(e.centerLat),r.crsParams)for(let e=0,t=i.features.length;e<t;e++)r.coordinatesConverter(i.features[e])}}getLayerSpatialReference(r,n){let o=this;return new Promise((e,t)=>{var i;r.mapParam&&r.mapParam.mapParamReference&&"EPSG:4326"!=r.mapParam.mapParamReference&&(o.getMapParam(r,n),i=JSON.parse(r.mapParam.mapParamReferenceValue),new Cesium.CRSSupport(i).PROJECTION)&&(n.spatialReference=i),e()})}getWFSLayerSpatialReference(r,n){return new Promise((e,t)=>{var i;r.mapParam&&r.mapParam.mapParamReference&&"EPSG:4326"!=r.mapParam.mapParamReference&&(i=JSON.parse(r.mapParam.mapParamReferenceValue),new Cesium.CRSSupport(i).PROJECTION)&&(n.spatialReference=i,r.mapParam.mapParamCenter)&&0<r.mapParam.mapParamCenter.indexOf(",")&&(n.centerLon=parseFloat(r.mapParam.mapParamCenter.split(",")[0]),n.centerLat=parseFloat(r.mapParam.mapParamCenter.split(",")[1])),e()})}getMapParam(e,t){let i={};e.data&&(i=JSON.parse(e.data)),t.tileWidth=i.tileSize?parseFloat(i.tileSize):256,t.tileHeight=i.tileSize?parseFloat(i.tileSize):256,e.mapParam&&(t.tileOriginX=parseFloat(e.mapParam.mapParamCutMapOrigin.split(",")[0]),t.tileOriginY=parseFloat(e.mapParam.mapParamCutMapOrigin.split(",")[1]),t.centerLon=parseFloat(e.mapParam.mapParamCenter.split(",")[0]),t.centerLat=parseFloat(e.mapParam.mapParamCenter.split(",")[1]),t.tile0Resolution=parseFloat(e.mapParam.mapParamScales.split(",")[0]))}};var o=new class{constructor(){this.items=[r,n]}findCrsByName(e){for(var t=0;t<this.items.length;t++)if(this.items[t].getName()==e)return this.items[t];return null}}},5989:function(){Object.defineProperties(Cesium.Model.prototype,{_cachedGltf:{set:function(e){var s,t,a;this._vtxf_cachedGltf=e,this._vtxf_cachedGltf&&this._vtxf_cachedGltf._gltf&&(s=this._vtxf_cachedGltf._gltf).extensionsUsed&&0<=(e=s.extensionsUsed.indexOf("KHR_technique_webgl"))&&(t=s.extensionsRequired.indexOf("KHR_technique_webgl"),s.extensionsRequired.splice(t,1,"KHR_techniques_webgl"),s.extensionsUsed.splice(e,1,"KHR_techniques_webgl"),s.extensions=s.extensions||{},s.extensions.KHR_techniques_webgl={},s.extensions.KHR_techniques_webgl.programs=s.programs,s.extensions.KHR_techniques_webgl.shaders=s.shaders,s.extensions.KHR_techniques_webgl.techniques=s.techniques,a=s.extensions.KHR_techniques_webgl.techniques,s.materials.forEach(function(e,t){s.materials[t].extensions||(s.materials[t].extensions={KHR_technique_webgl:{}}),s.materials[t].extensions.KHR_technique_webgl.values=s.materials[t].values,s.materials[t].extensions.KHR_techniques_webgl=s.materials[t].extensions.KHR_technique_webgl;var i,r=s.materials[t].extensions.KHR_techniques_webgl;for(i in r.technique||(r.technique=s.materials[t].technique),r.values){var n,o=a[r.technique].uniforms;for(n in o)if(o[n]===i){r.values[n]=r.values[i],delete r.values[i];break}}}),a.forEach(function(e){for(var t in e.attributes){var i=e.attributes[t];e.attributes[t]=e.parameters[i]}for(var r in e.uniforms){i=e.uniforms[r];e.uniforms[r]=e.parameters[i]}}))},get:function(){return this._vtxf_cachedGltf}}})},7156:function(e,t){"use strict";t.Z=class{constructor(e={}){this.type=Cesium.defaultValue(e.type,"AgPbrMetallicRoughnessMaterial");let t=e.pbrMetallicRoughness.baseColorFactor;t&&Array.isArray(t)&&(t=new Cesium.Cartesian4(t[0],t[1],t[2],t[3])),this.baseColorFactor=Cesium.defaultValue(t,new Cesium.Cartesian4(1,1,1,1));var i=Cesium.defaultValue(e.alphaMode,"OPAQUE");this.translucent="BLEND"===i?this.baseColorFactor.w:1,this.baseColorTexture=Cesium.defaultValue(e.pbrMetallicRoughness.baseColorTexture.source,Cesium.Material.DefaultImageId),this.normalTexture=Cesium.defaultValue(e.normalTexture.source,Cesium.Material.DefaultImageId),this.repeat=Cesium.defaultValue(e.repeat,new Cesium.Cartesian2(1,1)),Cesium.Material._materialCache.getMaterial(this.type)||Cesium.Material._materialCache.addMaterial(this.type,{fabric:{type:this.type,uniforms:{baseColorTexture:this.baseColorTexture,normalTexture:this.normalTexture,repeat:this.repeat,baseColorFactor:this.baseColorFactor,translucent:this.translucent,alphaMode:i},source:`
uniform sampler2D normalTexture;
uniform sampler2D baseColorTexture;

uniform vec2 repeat;
uniform vec4 baseColorFactor;

czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);
    vec2 st = materialInput.st;
    vec4 colorImage = texture(baseColorTexture, vec2(fract(st.s * repeat.x), fract(st.t * repeat.y)));
    vec3 diffuse = colorImage.rgb * baseColorFactor.rgb;
  
    float alpha =  colorImage.a * baseColorFactor.a;

    vec4 textureValue = texture(normalTexture, vec2(fract(st.s * repeat.x), fract(st.t * repeat.y)));
 
    material.normal = textureValue.rgb;
 
    material.alpha = alpha;
    float hours = czm_globeTime.x;
    if(6.0 <hours && hours<20.0){
        material.diffuse = diffuse;
    }else{
        material.emission = diffuse;
    }
    return material;
}
`},translucent:e=>{var e=e.uniforms,t=e.translucent;return e.baseColorFactor.w=t,"BLEND"===e.alphaMode||t<1},minificationFilter:Cesium.TextureMinificationFilter.LINEAR_MIPMAP_LINEAR,magnificationFilter:Cesium.TextureMagnificationFilter.LINEAR}),this.material=Cesium.Material.fromType(this.type)}}},5808:function(){class t{constructor(e,t){this._definitionChanged=new Cesium.Event,this._color=void 0,this._colorSubscription=void 0,this.color=e,this.duration=t||3e3,this._time=(new Date).getTime(),this.isTranslucent=function(){return!0}}getType(){return"PolylineTrailLink"}getValue(e,t){return(t=Cesium.defined(t)?t:{}).color=Cesium.Property.getValueOrClonedDefault(this._color,e,Cesium.Color.WHITE,t.color),t.image=Cesium.Material.PolylineTrailLinkImage,t.time=((new Date).getTime()-this._time)%this.duration/this.duration,t}equals(e){return this===e||e instanceof t&&Cesium.Property.equals(this._color,e._color)}}var e,i,r;Object.defineProperties(t.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium.createPropertyDescriptor("color")}),Cesium.PolylineTrailLinkMaterialProperty=t,Cesium.Material.PolylineTrailLinkType="PolylineTrailLink",Cesium.Material.PolylineTrailLinkImage=((e=document.createElement("canvas")).width=512,e.height=32,i=e.getContext("2d"),(r=i.createLinearGradient(0,0,e.width,0)).addColorStop(0,"rgba(255,0,0, 1)"),r.addColorStop(1,"rgba(255,0,0, 0)"),i.fillStyle=r,i.fillRect(0,0,e.width,e.height),e.toDataURL("image/png")),Cesium.Material.PolylineTrailLinkSource="czm_material czm_getMaterial(czm_materialInput materialInput)\n                                        {\n                                            czm_material material = czm_getDefaultMaterial(materialInput);\n                                            vec2 st = materialInput.st;\n                                            vec4 colorImage = texture(image, vec2(fract(st.s - time), st.t));\n                                            material.alpha = colorImage.a * color.a;\n                                            material.diffuse = (color.rgb);\n                                            return material;\n                                        }",Cesium.Material._materialCache.addMaterial(Cesium.Material.PolylineTrailLinkType,{fabric:{type:Cesium.Material.PolylineTrailLinkType,uniforms:{color:new Cesium.Color(0,0,1,0),image:Cesium.Material.PolylineTrailLinkImage,time:20},source:Cesium.Material.PolylineTrailLinkSource},translucent:function(e){return!0}})},1696:function(e,t,i){"use strict";var r=i(7156);let{Cartesian2:n,defaultValue:o,defined:s,Event:a,createPropertyDescriptor:l,Property:u}=Cesium;const c=new n(1,1),h=new Cesium.Cartesian4(1,1,1,1);function A(e){e=o(e,o.EMPTY_OBJECT),this.type=e.type||"AgPbrMetallicRoughnessMaterial",e.type=this.type,Cesium.Material._materialCache.getMaterial(this.type)||new r.Z(e),this._definitionChanged=new a,this._baseColorTexture=void 0,this._baseColorTextureSubscription=void 0,this._repeat=void 0,this._repeatSubscription=void 0,this._baseColorFactor=void 0,this._baseColorFactorSubscription=void 0,this._translucent=void 0,this._translucentSubscription=void 0,this._normalTexture=void 0,this.baseColorTexture=Cesium.defaultValue(e.pbrMetallicRoughness.baseColorTexture.source,Cesium.Material.DefaultImageId),this.normalTexture=Cesium.defaultValue(e.normalTexture.source,Cesium.Material.DefaultImageId),this.repeat=Cesium.defaultValue(e.repeat,c);let t=e.pbrMetallicRoughness.baseColorFactor;t&&Array.isArray(t)&&(t=new Cesium.Cartesian4(t[0],t[1],t[2],t[3])),this.baseColorFactor=Cesium.defaultValue(t,h);e=Cesium.defaultValue(e.translucent,1);this.translucent=e}Object.defineProperties(A.prototype,{isConstant:{get:function(){return u.isConstant(this._baseColorTexture)&&u.isConstant(this._normalTexture)&&u.isConstant(this._baseColorFactor)&&u.isConstant(this._repeat)&&u.isConstant(this._translucent)}},definitionChanged:{get:function(){return this._definitionChanged}},baseColorTexture:l("baseColorTexture"),repeat:l("repeat"),baseColorFactor:l("baseColorFactor"),translucent:l("translucent"),normalTexture:l("normalTexture")}),A.prototype.getType=function(e){return this.type},A.prototype.getValue=function(e,t){return(t=s(t)?t:{}).baseColorTexture=u.getValueOrUndefined(this._baseColorTexture,e),t.normalTexture=u.getValueOrUndefined(this._normalTexture,e),t.repeat=u.getValueOrClonedDefault(this._repeat,e,c,t.repeat),t.baseColorFactor=u.getValueOrClonedDefault(this._baseColorFactor,e,h,t.baseColorFactor),t.translucent=u.getValueOrClonedDefault(this._translucent,e,1,t.translucent),t},A.prototype.equals=function(e){return this===e||e instanceof A&&u.equals(this._baseColorTexture,e._baseColorTexture)&&u.equals(this._normalTexture,e._normalTexture)&&u.equals(this._repeat,e._repeat)&&u.equals(this._baseColorFactor,e._baseColorFactor)&&u.equals(this._translucent,e._translucent)},t.Z=A},1558:function(e,t){"use strict";t.Z=class{constructor(e,t,i,r){this.name=e,this.position=t,this.image=i,this.options=r,this.agBillboard=null,this.entity=null,this.createEntity()}createEntity(){var e={image:this.image,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,disableDepthTestDistance:Number.POSITIVE_INFINITY};this.entity=new Cesium.Entity({name:this.name,position:this.position,billboard:{...e,...this.options}}),this.agBillboard=this.entity}addToLayer(e){e.addEntity(this.entity)}setPosition(e){this.entity.position=e}getPosition(){return this.entity.position._value}changeImage(e){this.entity.billboard.image=e}dispose(){this.name=null,this.position=null,this.image=null,this.options=null,this.entity=null}}},7710:function(e,t,i){"use strict";i.d(t,{Z:function(){return n}});const r={material:Cesium.Color.YELLOW};class n extends Cesium.Entity{constructor(e){e.box={...r,...e.box},super(e)}addToLayer(e){e.addEntity(this)}setPosition(e){this.position=e}getPosition(){return this.position._value}}},1284:function(e,t,i){"use strict";i.d(t,{Z:function(){return r}});class r{constructor(e,t={}){this.name=e,this.color=t.color||Cesium.Color.BLUE,this.topRadius=t.topRadius||.05,this.bottomRadius=t.bottomRadius||.05,this.entity=null,this.primitive=null}createPrimitive(e,t,i,r){var n=Cesium.Cartesian3.distance(e,t),e=Cesium.Cartesian3.midpoint(e,t,new Cesium.Cartesian3),t=new Cesium.CylinderGeometry({length:n,topRadius:this.topRadius,bottomRadius:this.bottomRadius}),t=Cesium.CylinderGeometry.createGeometry(t,{repeat:new Cesium.Cartesian2(1,Math.ceil(n/.5)),orientation:Cesium.StripeOrientation.VERTICAL}),n=Cesium.Transforms.eastNorthUpToFixedFrame(e),n=Cesium.Matrix4.getMatrix3(n,new Cesium.Matrix3),n=Cesium.Matrix3.multiply(n,i,new Cesium.Matrix3),i=new Cesium.GeometryInstance({geometry:t,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(this.color)},modelMatrix:Cesium.Matrix4.fromRotationTranslation(n,e,new Cesium.Matrix4)});return r=r||new Cesium.Material({fabric:{type:"Color",uniforms:{color:this.color}}}),this.primitive=new Cesium.Primitive({geometryInstances:i,appearance:new Cesium.MaterialAppearance({material:r}),asynchronous:!1,compressVertices:!1}),this.primitive}createEntity(e,t,i){t={length:t,topRadius:this.topRadius,bottomRadius:this.bottomRadius,material:this.color};return this.entity=new Cesium.Entity({name:this.name,position:e,cylinder:{...t,...i}}),this.entity}addToLayer(e){this.primitive&&e.addPrimitive(this.primitive),this.entity&&e.addEntity(this.entity)}remove(e){this.entity&&e.removeEntity(this.entity),this.primitive&&e.removePrimitive(this.primitive)}dispose(){this.name=null,this.entity=null,this.primitive=null}}},8423:function(e,t,i){"use strict";i.d(t,{Z:function(){return n}});const r={material:Cesium.Color.YELLOW};class n extends Cesium.Entity{constructor(e){e.ellipsoid={...r,...e.ellipsoid},super(e)}addToLayer(e){e.addEntity(this)}setPosition(e){this.position=e}getPosition(){return this.position._value}}},2130:function(e,t){"use strict";t.Z=class{constructor(e,t,i,r){this.name=e,this.position=t,this.text=i,this.options=r,this.agLabel=null,this.createEntity()}createEntity(){var e={text:this.text,showBackground:!0,backgroundColor:Cesium.Color.fromCssColorString("#f99d0d"),disableDepthTestDistance:Number.POSITIVE_INFINITY};this.agLabel=new Cesium.Entity({name:this.name,position:this.position,label:{...e,...this.options}})}addToLayer(e){e.addEntity(this.agLabel)}setPosition(e){this.agLabel.position=e}getPosition(){return this.agLabel.position._value}changeText(e){this.agLabel.label.text=e}dispose(){this.name=null,this.position=null,this.text=null,this.options=null,this.agLabel=null}}},5924:function(e,t){"use strict";t.Z=class{constructor(e,t,i){this.name=e,this.position=t,this.options=i,this.agPoint=null,this.createEntity()}createEntity(){var e={pixelSize:5,color:Cesium.Color.RED,outlineColor:Cesium.Color.WHITE,outlineWidth:2,disableDepthTestDistance:Number.POSITIVE_INFINITY};this.agPoint=new Cesium.Entity({name:this.name,position:this.position,point:{...e,...this.options}})}addToLayer(e){e.addEntity(this.agPoint)}setPosition(e){this.agPoint.position=e}getPosition(){return this.agPoint.position._value}changeSize(e){this.agPoint.point.pixelSize=e}dispose(){this.name=null,this.position=null,this.options=null,this.agPoint=null}}},920:function(e,t){"use strict";t.Z=class{constructor(e,t,i={}){this.name=e,this.positions=t,this.options=i,this.agPolygon=null,this.entity=null,this.createEntity(t)}createEntity(e){var t=e instanceof Array?new Cesium.CallbackProperty(function(){return{positions:e}},!this.options.hasOwnProperty("isConstant")||this.options.isConstant):e,t={hierarchy:t,material:Cesium.Color.RED.withAlpha(.4),outline:!0,outlineWidth:10,fill:!0,outlineColor:Cesium.Color.RED};this.entity=new Cesium.Entity({name:this.name,polygon:{...t,...this.options}}),this.agPolygon=this.entity}addToLayer(e){e.addEntity(this.entity)}remove(e){e.removeEntity(this.entity)}setPosition(e){this.positions=e,this.entity.polygon.hierarchy=e}getPosition(){return this.positions}dispose(){this.name=null,this.positions=null,this.options=null,this.entity=null}}},8728:function(e,t){"use strict";t.Z=class{constructor(e,t,i={}){this.name=e,this.positions=t,this.options=i,this.agPolyline=null,this.entity=null,this.createEntity(t)}createEntity(e){var t=e instanceof Array?new Cesium.CallbackProperty(function(){return e},!this.options.hasOwnProperty("isConstant")||this.options.isConstant):e,t={positions:t,material:Cesium.Color.YELLOW,width:2};this.entity=new Cesium.Entity({name:this.name,polyline:{...t,...this.options}}),this.agPolyline=this.entity}addToLayer(e){e.addEntity(this.entity)}remove(e){e.removeEntity(this.entity)}setPosition(e){this.positions=e,this.entity.polyline.positions=e}getPosition(){return this.positions}changeMaterial(e){this.entity.polyline.material=e}dispose(){this.name=null,this.positions=null,this.options=null,this.entity=null}}},8986:function(e,t){"use strict";t.Z=class{constructor(e,t,i={}){this.name=e,this.positions=t,this.options=i,this.agRectangle=null,this.primitive=null,t&&this.createEntity(t)}createEntity(e){var t=e instanceof Array?new Cesium.CallbackProperty(function(){return Cesium.Rectangle.fromCartesianArray(e)},!this.options.hasOwnProperty("isConstant")||this.options.isConstant):e,t={coordinates:t,material:Cesium.Color.RED.withAlpha(.4),outline:!0,outlineWidth:10,fill:!0,outlineColor:Cesium.Color.fromCssColorString("#f99d0d")};this.agRectangle=new Cesium.Entity({name:this.name,rectangle:{...t,...this.options}})}createPrimitive(e,t,i,r){e=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.RectangleGeometry({rectangle:Cesium.Rectangle.fromDegrees(e,t,i,r),vertexFormat:Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT})}),appearance:new Cesium.EllipsoidSurfaceAppearance({aboveGround:!1})});return this.primitive=e}addToLayer(e){this.agRectangle&&e.addEntity(this.agRectangle),this.primitive&&e.addPrimitive(this.primitive)}remove(e){this.agRectangle&&e.removeEntity(this.agRectangle),this.primitive&&e.removePrimitive(this.primitive)}setPosition(e){this.positions=e,this.agRectangle.rectangle.coordinates=Cesium.Rectangle.fromCartesianArray(e)}getPosition(){return this.positions}dispose(){this.name=null,this.positions=null,this.options=null,this.agRectangle=null}}},2325:function(e,t){"use strict";t.Z=class{constructor(e){this.name=e,this.primitive=null,this.entity=null}createPrimitive(e,t,i,r){r=r||Cesium.Color.RED;var n=new Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),e=new Cesium.RectangleGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:Cesium.Rectangle.fromCartesianArray(e),height:t,extrudedHeight:i}),t=Cesium.RectangleGeometry.createGeometry(e),i=new Cesium.GeometryInstance({geometry:t,modelMatrix:n,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(r)}}),e=new Cesium.Primitive({geometryInstances:i,appearance:new Cesium.PerInstanceColorAppearance({translucent:!0}),asynchronous:!1});this.primitive=e}createEntity(e,t,i,r,n,o){n={id:n,name:this.name,rectangle:{coordinates:Cesium.Rectangle.fromCartesianArray(e),material:r,extrudedHeight:i,height:t,outline:!0,outlineColor:Cesium.Color.WHITE},properties:new Cesium.PropertyBag(o)};this.entity=n}addToLayer(e){this.primitive&&e.addPrimitive(this.primitive),this.entity&&e.addEntity(this.entity)}remove(e){this.primitive&&e.removePrimitive(this.primitive)}dispose(){this.name=null,this.primitive=null}}},6746:function(e,t,i){"use strict";var f=i(2406);const h={TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,FITTING_COUNT:100,ZERO_TOLERANCE:1e-4,HELPER_HIDDEN_DIV:"p-helper-hidden-div",HELPER_CONTROL_POINT_DIV:"p-helper-control-point-div",SE_DISABLED:"se_disabled"};t.Z=new class{constructor(){}getTailPoints(e){var t=f.SO(e)*this.tailWidthFactor,i=f.Y8(e[1],e[0],h.HALF_PI,t,!1),r=f.Y8(e[1],e[0],h.HALF_PI,t,!0),t=t*this.swallowTailFactor;return[i,f.Y8(e[1],e[0],0,t,!0),r]}getDoubleArrowPoints(e,t,i,r){var n=f.Pi(e,t),o=f.TE(n,i),s=f.Y8(i,n,0,.3*o,!0),a=f.Y8(i,n,0,.5*o,!0),s=[n,f.Y8(n,s,h.HALF_PI,o/5,r),f.Y8(n,a,h.HALF_PI,o/4,r),i],n=this.getDoubleArrowHeadPoints(s,this.headHeightFactor,this.headWidthFactor,this.neckHeightFactor,this.neckWidthFactor),a=n[0],o=n[4],r=f.TE(e,t)/f.SO(s)/2,i=this.getDoubleArrowBodyPoints(s,a,o,r),s=i.length,r=i.slice(0,s/2),i=i.slice(s/2,s);return r.push(a),i.push(o),(r=r.reverse()).push(t),(i=i.reverse()).push(e),r.reverse().concat(n,i)}getDoubleArrowHeadPoints(e,t,i){var r=f.SO(e)*this.headHeightFactor,n=e[e.length-1],t=(f.TE(t,i),r*this.headWidthFactor),i=r*this.neckWidthFactor,o=r*this.neckHeightFactor,r=f.Y8(e[e.length-2],n,0,r,!0),e=f.Y8(e[e.length-2],n,0,o,!0),o=f.Y8(n,r,h.HALF_PI,t,!1),r=f.Y8(n,r,h.HALF_PI,t,!0);return[f.Y8(n,e,h.HALF_PI,i,!1),o,n,r,f.Y8(n,e,h.HALF_PI,i,!0)]}getArrowBodyPoints(e,t,i,r){for(var n=f.SE(e),o=f.SO(e)*r,s=(o-f.TE(t,i))/2,a=0,l=[],u=[],c=1;c<e.length-1;c++){var h=f.i4(e[c-1],e[c],e[c+1])/2,A=(o/2-(a+=f.TE(e[c-1],e[c]))/n*s)/Math.sin(h),p=f.Y8(e[c-1],e[c],Math.PI-h,A,!0),h=f.Y8(e[c-1],e[c],h,A,!1);l.push(p),u.push(h)}return l.concat(u)}getArrowHeadPoints(e,t,i){var r=f.SO(e)*this.headHeightFactor,n=e[e.length-1],o=f.TE(n,e[e.length-2]),t=f.TE(t,i),i=(r=r>t*this.headTailFactor?t*this.headTailFactor:r)*this.headWidthFactor,t=r*this.neckWidthFactor,o=(r=o<r?o:r)*this.neckHeightFactor,r=f.Y8(e[e.length-2],n,0,r,!0),e=f.Y8(e[e.length-2],n,0,o,!0),o=f.Y8(n,r,h.HALF_PI,i,!1),r=f.Y8(n,r,h.HALF_PI,i,!0);return[f.Y8(n,e,h.HALF_PI,t,!1),o,n,r,f.Y8(n,e,h.HALF_PI,t,!0)]}getDoubleArrowBodyPoints(e,t,i,r){for(var n=f.SE(e),o=f.SO(e)*r,s=(o-f.TE(t,i))/2,a=0,l=[],u=[],c=1;c<e.length-1;c++){var h=f.i4(e[c-1],e[c],e[c+1])/2,A=(o/2-(a+=f.TE(e[c-1],e[c]))/n*s)/Math.sin(h),p=f.Y8(e[c-1],e[c],Math.PI-h,A,!0),h=f.Y8(e[c-1],e[c],h,A,!1);l.push(p),u.push(h)}return l.concat(u)}generateAttackArrow(e){var t,i,r,n,o,s;if(this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.headTailFactor=.8,this._points=e,3<=this._points.length)return o=(e=this._points)[0],t=e[1],f.En(e[0],e[1],e[2])&&(o=e[1],t=e[0]),e=[f.Pi(o,t)].concat(e.slice(2)),s=(i=this.getArrowHeadPoints(e,o,t))[0],r=i[4],n=f.TE(o,t)/f.SO(e),n=(e=this.getArrowBodyPoints(e,s,r,n)).length,(o=[o].concat(e.slice(0,n/2))).push(s),(s=[t].concat(e.slice(n/2,n))).push(r),o=f.dK(o),s=f.dK(s),o.concat(i,s.reverse())}getTempPoint4(e,t,i){var r,n,o,t=f.Pi(e,t),s=f.TE(t,i),i=f.i4(e,t,i),s=i<h.HALF_PI?(r=s*Math.sin(i),n=s*Math.cos(i),o=f.Y8(e,t,h.HALF_PI,r,!1),f.Y8(t,o,h.HALF_PI,n,!0)):i>=h.HALF_PI&&i<Math.PI?(r=s*Math.sin(Math.PI-i),n=s*Math.cos(Math.PI-i),o=f.Y8(e,t,h.HALF_PI,r,!1),f.Y8(t,o,h.HALF_PI,n,!1)):i>=Math.PI&&i<1.5*Math.PI?(r=s*Math.sin(i-Math.PI),n=s*Math.cos(i-Math.PI),o=f.Y8(e,t,h.HALF_PI,r,!0),f.Y8(t,o,h.HALF_PI,n,!0)):(r=s*Math.sin(2*Math.PI-i),n=s*Math.cos(2*Math.PI-i),o=f.Y8(e,t,h.HALF_PI,r,!0),f.Y8(t,o,h.HALF_PI,n,!1));return s}generateDoubleArrow(e){this.headHeightFactor=.25,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.connPoint=null,this.tempPoint4=null,this.fixPointCount=4,this._points=e;var e=this._points[0],t=this._points[1],i=this._points[2],r=this._points.length,t=(this.tempPoint4=3==r?this.getTempPoint4(e,t,i):this._points[3],this.connPoint=3==r||4==r?f.Pi(e,t):this._points[4],r=f.En(e,t,i)?(o=this.getDoubleArrowPoints(e,this.connPoint,this.tempPoint4,!1),this.getDoubleArrowPoints(this.connPoint,t,i,!0)):(o=this.getDoubleArrowPoints(t,this.connPoint,i,!1),this.getDoubleArrowPoints(this.connPoint,e,this.tempPoint4,!0)),o.length),i=(t-5)/2,e=o.slice(0,i),n=o.slice(i,5+i),o=o.slice(5+i,t),s=r.slice(0,i),a=r.slice(i,5+i),r=r.slice(5+i,t),s=f.Xu(s),i=f.Xu(r.concat(e.slice(1))),o=f.Xu(o);return s.concat(a,i,n,o)}generateAssaultDirection(e){return this.setAssaultDirection(),this.getFineArrowPoints(e)}generateFineArrow(e){return this.setFineArrow(),this.getFineArrowPoints(e)}setAssaultDirection(){this.tailWidthFactor=.2,this.neckWidthFactor=.25,this.headWidthFactor=.3,this.headAngle=Math.PI/4,this.neckAngle=.17741*Math.PI}setFineArrow(){this.tailWidthFactor=.15,this.neckWidthFactor=.2,this.headWidthFactor=.25,this.headAngle=Math.PI/8.5,this.neckAngle=Math.PI/13}getFineArrowPoints(e){this.fixPointCount=2;var t=e[0],i=e[1],e=f.SO(e),r=e*this.tailWidthFactor,n=e*this.neckWidthFactor,e=e*this.headWidthFactor,o=f.Y8(i,t,h.HALF_PI,r,!0),r=f.Y8(i,t,h.HALF_PI,r,!1),s=f.Y8(t,i,this.headAngle,e,!1),e=f.Y8(t,i,this.headAngle,e,!0);return[o,f.Y8(t,i,this.neckAngle,n,!1),s,i,e,f.Y8(t,i,this.neckAngle,n,!0),r]}generateArc(e){this.fixPointCount=3,this.points=e;var t,e=this.points[0],i=this.points[1],r=this.points[2],n=f.sO(e,i,r),o=f.TE(e,n),s=f.uV(e,n),a=f.uV(i,n),e=f.En(e,i,r)?(t=a,s):(t=s,a);return f.sg(n,o,t,e)}generateGatheringPlace(e){if(this.t=.4,this.fixPointCount=3,!(e.length<2)){2==e.length&&(t=f.Pi(e[0],e[1]),a=f.TE(e[0],t)/.9,c=f.Y8(e[0],t,h.HALF_PI,a,!0),e=[e[0],c,e[1]]);for(var t=f.Pi(e[0],e[2]),i=(e.push(t,e[0],e[1]),[]),r=0;r<e.length-2;r++)var n=e[r],o=e[r+1],s=e[r+2],s=f.zF(this.t,n,o,s),i=i.concat(s);for(var a=i.length,l=(i=[i[a-1]].concat(i.slice(0,a-1)),[]),r=0;r<e.length-2;r++){n=e[r],o=e[r+1],l.push(n);for(var u=0;u<=h.FITTING_COUNT;u++){var c=f.cJ(u/h.FITTING_COUNT,n,i[2*r],i[2*r+1],o);l.push(c)}l.push(o)}return l}}generateTailedSquadCombat(e){this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.tailWidthFactor=.1,this.swallowTailFactor=1,this.swallowTailPnt=null;var t,i,r,n,o,s=e.length;if(!(s<2))return t=this.getTailPoints(e),o=(i=this.getArrowHeadPoints(e,t[0],t[2]))[0],r=i[4],s=(e=this.getArrowBodyPoints(e,o,r,this.tailWidthFactor)).length,(n=[t[0]].concat(e.slice(0,s/2))).push(o),(o=[t[2]].concat(e.slice(s/2,s))).push(r),n=f.dK(n),o=f.dK(o),n.concat(i,o.reverse(),[t[1],n[0]])}generateClosedCurve(e){this.t=.3,e.push(e[0],e[1]);for(var t=[],i=0;i<e.length-2;i++)var r=f.zF(this.t,e[i],e[i+1],e[i+2]),t=t.concat(r);for(var n=t.length,o=(t=[t[n-1]].concat(t.slice(0,n-1)),[]),i=0;i<e.length-2;i++){var s=e[i],a=e[i+1];o.push(s);for(var l=0;l<=h.FITTING_COUNT;l++){var u=f.cJ(l/h.FITTING_COUNT,s,t[2*i],t[2*i+1],a);o.push(u)}o.push(a)}return o}generateCurve(e){return this.t=.3,f.bz(this.t,e)}createArc(e,t,i,r){e=f.sg([e.lng,e.lat],t,i,r),t=this.array2Dto1D(e);return Cesium.Cartesian3.fromDegreesArray(t)}createBezier(e){e=this.generateCurve(e),e=this.array2Dto1D(e);return Cesium.Cartesian3.fromDegreesArray(e)}array2Dto1D(e){var t=[];return e.forEach(e=>{t.push(e[0]),t.push(e[1])}),t}}},2406:function(e,t,i){"use strict";i.d(t,{En:function(){return p},Pi:function(){return c},SE:function(){return r},SO:function(){return n},TE:function(){return A},Xu:function(){return y},Y8:function(){return l},bz:function(){return m},cJ:function(){return f},dK:function(){return v},i4:function(){return a},sO:function(){return o},sg:function(){return u},uV:function(){return s},zF:function(){return d}});const h={TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,FITTING_COUNT:100,ZERO_TOLERANCE:1e-4,HELPER_HIDDEN_DIV:"p-helper-hidden-div",HELPER_CONTROL_POINT_DIV:"p-helper-control-point-div",SE_DISABLED:"se_disabled"};function A(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function r(e){for(var t=0,i=0;i<e.length-1;i++)t+=A(e[i],e[i+1]);return t}function n(e){return Math.pow(r(e),.99)}function c(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}function o(e,t,i){var r,n,o,s,a=[(e[0]+t[0])/2,(e[1]+t[1])/2],t=[a[0]-e[1]+t[1],a[1]+e[0]-t[0]],l=[(e[0]+i[0])/2,(e[1]+i[1])/2],e=[l[0]-e[1]+i[1],l[1]+e[0]-i[0]];return i=l,l=e,(e=a)[1]==(a=t)[1]?(r=(l[0]-i[0])/(l[1]-i[1]),n=r*(e[1]-i[1])+i[0],o=e[1]):i[1]==l[1]?(s=(a[0]-e[0])/(a[1]-e[1]),n=s*(i[1]-e[1])+e[0],o=i[1]):(s=(a[0]-e[0])/(a[1]-e[1]),r=(l[0]-i[0])/(l[1]-i[1]),o=(s*e[1]-e[0]-r*i[1]+i[0])/(s-r),n=s*o-s*e[1]+e[0]),[n,o]}function s(e,t){var i,r=Math.asin(Math.abs(t[1]-e[1])/A(e,t));return t[1]>=e[1]&&t[0]>=e[0]?i=r+Math.PI:t[1]>=e[1]&&t[0]<e[0]?i=h.TWO_PI-r:t[1]<e[1]&&t[0]<e[0]?i=r:t[1]<e[1]&&t[0]>=e[0]&&(i=Math.PI-r),i}function a(e,t,i){e=s(t,e)-s(t,i);return e<0?e+h.TWO_PI:e}function p(e,t,i){return(i[1]-e[1])*(t[0]-e[0])>(t[1]-e[1])*(i[0]-e[0])}function f(e,t,i,r,n){var o=1-(e=Math.max(Math.min(e,1),0)),s=e*e,a=s*e,l=o*o,u=l*o;return[u*t[0]+3*l*e*i[0]+3*o*s*r[0]+a*n[0],u*t[1]+3*l*e*i[1]+3*o*s*r[1]+a*n[1]]}function l(e,t,i,r,n){e=s(e,t),n=n?e+i:e-i,e=r*Math.cos(n),i=r*Math.sin(n);return[t[0]+e,t[1]+i]}function u(e,t,i,r){for(var n=[],o=(o=r-i)<0?o+h.TWO_PI:o,s=0;s<=h.FITTING_COUNT;s++){var a=i+o*s/h.FITTING_COUNT,l=e[0]+t*Math.cos(a),a=e[1]+t*Math.sin(a);n.push([l,a])}return n}function d(e,t,i,r){var n,o,s=g(t,i,r),a=Math.sqrt(s[0]*s[0]+s[1]*s[1]),l=s[0]/a,s=s[1]/a,u=A(t,i),c=A(i,r);return a=a>h.ZERO_TOLERANCE?p(t,i,r)?(n=[i[0]-(o=e*u)*s,i[1]+o*l],[i[0]+(o=e*c)*s,i[1]-o*l]):(n=[i[0]+(o=e*u)*s,i[1]-o*l],[i[0]-(o=e*c)*s,i[1]+o*l]):(n=[i[0]+e*(t[0]-i[0]),i[1]+e*(t[1]-i[1])],[i[0]+e*(r[0]-i[0]),i[1]+e*(r[1]-i[1])]),[n,a]}function g(e,t,i){var r=e[0]-t[0],e=e[1]-t[1],n=Math.sqrt(r*r+e*e),n=(r/=n,e/=n,i[0]-t[0]),i=i[1]-t[1],t=Math.sqrt(n*n+i*i);return[r+(n/=t),e+(i/=t)]}function m(e,t){for(var i=[function(e,t){var i=e[0],r=e[1],e=e[2],n=d(0,i,r,e)[0],e=g(i,r,e);{var o,s,a,l;e=Math.sqrt(e[0]*e[0]+e[1]*e[1])>h.ZERO_TOLERANCE?(e=c(i,r),l=i[0]-e[0],a=i[1]-e[1],s=2/A(i,r),l=(a=-s*a)*a-(s=s*l)*s,o=2*a*s,s=s*s-a*a,a=n[0]-e[0],n=n[1]-e[1],l=e[0]+l*a+o*n,e[1]+o*a+s*n):(l=i[0]+t*(r[0]-i[0]),i[1]+t*(r[1]-i[1]))}return[l,e]}(t,e)],r=0;r<t.length-2;r++)var n=t[r],o=t[r+1],s=d(e,n,o,t[r+2]),i=i.concat(s);for(var a=function(e,t){var i=e.length,r=e[i-3],n=e[i-2],e=e[i-1],i=d(0,r,n,e)[1],r=g(r,n,e);{var o,s,a,l;r=Math.sqrt(r[0]*r[0]+r[1]*r[1])>h.ZERO_TOLERANCE?(r=c(n,e),l=e[0]-r[0],a=e[1]-r[1],s=2/A(n,e),l=(a=-s*a)*a-(s=s*l)*s,o=2*a*s,s=s*s-a*a,a=i[0]-r[0],i=i[1]-r[1],l=r[0]+l*a+o*i,r[1]+o*a+s*i):(l=e[0]+t*(n[0]-e[0]),e[1]+t*(n[1]-e[1]))}return[l,r]}(t,e),l=(i.push(a),[]),r=0;r<t.length-1;r++){n=t[r],o=t[r+1],l.push(n);for(e=0;e<h.FITTING_COUNT;e++){var u=f(e/h.FITTING_COUNT,n,i[2*r],i[2*r+1],o);l.push(u)}l.push(o)}return l}function y(e){if(e.length<=2)return e;for(var t=[],i=e.length-1,r=0;r<=1;r+=.01){for(var n=0,o=0,s=0;s<=i;s++){l=s;var a=_(a=i)/(_(l)*_(a-l)),l=Math.pow(r,s),u=Math.pow(1-r,i-s);n+=a*l*u*e[s][0],o+=a*l*u*e[s][1]}t.push([n,o])}return t.push(e[i]),t}function _(e){if(e<=1)return 1;if(2==e)return 2;if(3==e)return 6;if(4==e)return 24;if(5==e)return 120;for(var t=1,i=1;i<=e;i++)t*=i;return t}function v(e){if(e.length<=2)return e;var t=[],i=e.length-2-1;t.push(e[0]);for(var r,n=0;n<=i;n++)for(var o=0;o<=1;o+=.05){for(var s=0,a=0,l=0;l<=2;l++){r=o;var u=0==(u=l)?Math.pow(r-1,2)/2:1==u?(-2*Math.pow(r,2)+2*r+1)/2:2==u?Math.pow(r,2)/2:0;s+=u*e[n+l][0],a+=u*e[n+l][1]}t.push([s,a])}return t.push(e[e.length-1]),t}},9720:function(e,t,i){"use strict";i.d(t,{Z:function(){return n}});var r=class{constructor(e,t,i){i=i||{},this.pickedObject=e.scene.pick(t.position),i.disablePosition||(this.pickedPosition=e.scene.pickPosition(t.position)),this.is3DTileFeature=null!=this.pickedObject&&this.pickedObject instanceof Cesium.Cesium3DTileFeature,this.isEntity=this.pickedObject&&this.pickedObject.id&&this.pickedObject.id instanceof Cesium.Entity,this.tileset=this.pickedObject&&this.pickedObject.tileset}};class o{constructor(e){this.viewer=e,this._handler=new Cesium.ScreenSpaceEventHandler(e.scene.canvas)}on(e,t,i=10){return"MOUSE_MOVE"==e?this._addIntervalToMouseMove(t,i):("LEFT_DOUBLE_CLICK"==e&&this.viewer.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this._handler.setInputAction(t,Cesium.ScreenSpaceEventType[e])),this}_addIntervalToMouseMove(i,r=10){let n;this._handler.setInputAction(e=>{if(0!=r){var t=Date.now();if(n&&t-n<r)return;n=t}i(e)},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}remove(e){this._handler&&this._handler.removeInputAction(Cesium.ScreenSpaceEventType[e])}off(){this._handler.isDestroyed()||this._handler.destroy()}hitTest(n,o,s=0){return o=o&&o.filter(e=>null!=e),new Promise((e,t)=>{var i,r={screenPoint:void 0,position:void 0,results:[]};r.screenPoint=n.position||n.endPosition,this.viewer.scene.globe.depthTestAgainstTerrain&&this.viewer.scene.mode!==Cesium.SceneMode.SCENE2D?0==s&&this.viewer.scene.pickPositionSupported||this.viewer.scene.mode!==Cesium.SceneMode.SCENE3D?r.position=this.viewer.scene.pickPosition(r.screenPoint):0==s?(i=this.viewer.camera.getPickRay(windowPosition),(i=this.viewer.scene.pickFromRay(i,o))&&(r.position=i.position)):(i=this.viewer.camera.getPickRay(r.screenPoint),o&&0<o.length?r.results=this.viewer.scene.drillPickFromRay(i,s,o):r.results=this.viewer.scene.drillPickFromRay(i,s),r.results&&r.results[0]&&(r.position=r.results[0].position)):r.position=this.getPositionByRay(r.screenPoint),(null==r.position?t:e)(r)})}getPickObject(e){return this.viewer.scene.pick(e)}getPickedObjectInfo(e){return new r(this.viewer,e)}getPickFromRay(e,t){e=this.viewer.camera.getPickRay(e);return this.viewer.scene.pickFromRay(e,t)}getPointByPick(e,t,i){e=!e||e.id&&e.id.name==t?this.getPositionByRay(i):this.getPickPosition(i);return e}getPositionByEllipsoid(e){return this.viewer.camera.pickEllipsoid(e,this.viewer.scene.globe.ellipsoid)}getPickPosition(e){return this.viewer.scene.pickPosition(e)}setCursor(e){this.viewer._element.style.cursor=e}getPreciseCartesian(e){var e="x"in e?e:e.position||e.endPosition,t=this.viewer.scene.pickPosition(e);return this.viewer.scene.pickPositionSupported&&0<this.viewer.scene.drillPick(e,1).length?t:this.getPositionByRay(e)}getPositionByRay(e){var e="x"in e?e:e.position||e.endPosition,t=this.viewer.scene,e=this.viewer.camera.getPickRay(e);return t.globe.pick(e,t)}reset(e=!0){for(var t in Cesium.ScreenSpaceEventType)this._handler.removeInputAction(Cesium.ScreenSpaceEventType[t]);e&&this.setCursor("default")}pickOnce(e=!0,n){let o=["RIGHT_CLICK"];return o.push(e?"LEFT_DOUBLE_CLICK":"LEFT_CLICK"),n&&o.push("MOUSE_MOVE"),new Promise((i,r)=>{o.forEach((e,t)=>{switch(t){case 0:this.on(e,t=>{this.hitTest(t).then(e=>{e=e.position;r({position:e,event:t}),o.forEach(e=>this.remove(e))})});break;case 1:this.on(e,t=>{this.hitTest(t).then(e=>{e=e.position;i({position:e,event:t}),o.forEach(e=>this.remove(e))})});break;case 2:this.on(e,t=>{this.hitTest(t).then(e=>{e=e.position;n(e,t)})})}})})}static verticalDrillPickFromRay(e,t,i={}){var r=Cesium.Cartographic.fromCartesian(t),r=Cesium.Cartesian3.fromRadians(r.longitude,r.latitude,100);return o.axisDrillPickFromRay(e,t,r,i)}static axisDrillPickFromRay(e,t,i,r={}){t=Cesium.Cartesian3.normalize(Cesium.Cartesian3.subtract(t,i,new Cesium.Cartesian3),new Cesium.Cartesian3),i=new Cesium.Ray(i,t);return e.scene.drillPickFromRay(i,r.limit,r.objectsToExclude,r.width)}static pick3DTilePrimitiveByVerticalRay(t,i){let r=[];for(let e=1;e<i.length;e++)r=r.concat(o.verticalDrillPickFromRay(t,i[e]));r=r.filter(e=>e.object&&e.object instanceof Cesium.Cesium3DTileFeature&&null!=e.object.primitive).map(e=>e.object.primitive);var e=[...new Set(r)];let n={};return r.forEach(e=>{e in n?n[e]+=1:n[e]=1}),e.sort((e,t)=>n[t]-n[e]),e}pickEntityOnce(){let r="LEFT_CLICK";return new Promise((i,e)=>{this.on(r,t=>{this.hitTest(t).then(e=>{e=e.position,e=this.getPickObject(t.position)?e:void 0;this.remove(r),i(e)})}).on("RIGHT_CLICK",e=>{this.reset()})})}getTransform(e){console.warn("请采用primitiveHelper.getModelTransform()方法");let t;return e.root?t=e.root.transform:e.modelMatrix?t=e.modelMatrix:e.position&&(e=e.position._value,e=Cesium.Transforms.eastNorthUpToFixedFrame(e),t=e),t}}var n=o},3924:function(P,e,t){"use strict";t.d(e,{Z:function(){return Ke}});var g=Object.freeze({UNLOADED:0,LOADING:1,PARSING:2,READY:3,FAILED:4}),U=function r(n,o,s){function a(i,e){if(!o[i]){if(!n[i]){if(l)return l(i,!0);var t=new Error("Cannot find module '"+i+"'");throw t.code="MODULE_NOT_FOUND",t}t=o[i]={exports:{}};n[i][0].call(t.exports,function(e){var t=n[i][1][e];return a(t||e)},t,t.exports,r,n,o,s)}return o[i].exports}for(var l=void 0,e=0;e<s.length;e++)a(s[e]);return a}({1:[function(e,t,i){var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array,n=(i.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])}}return e},i.shrinkBuf=function(e,t){if(e.length!==t){if(e.subarray)return e.subarray(0,t);e.length=t}return e},{arraySet:function(e,t,i,r,n){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+r),n);else for(var o=0;o<r;o++)e[n+o]=t[i+o]},flattenChunks:function(e){for(var t,i,r,n=0,o=0,s=e.length;o<s;o++)n+=e[o].length;for(r=new Uint8Array(n),o=t=0,s=e.length;o<s;o++)i=e[o],r.set(i,t),t+=i.length;return r}}),o={arraySet:function(e,t,i,r,n){for(var o=0;o<r;o++)e[n+o]=t[i+o]},flattenChunks:function(e){return[].concat.apply([],e)}};i.setTyped=function(e){e?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,n)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(r)},{}],2:[function(e,t,i){var l=e("./common"),n=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var u=new l.Buf8(256),r=0;r<256;r++)u[r]=252<=r?6:248<=r?5:240<=r?4:224<=r?3:192<=r?2:1;function c(e,t){if(t<65537&&(e.subarray&&o||!e.subarray&&n))return String.fromCharCode.apply(null,l.shrinkBuf(e,t));for(var i="",r=0;r<t;r++)i+=String.fromCharCode(e[r]);return i}u[254]=u[254]=1,i.string2buf=function(e){for(var t,i,r,n,o=e.length,s=0,a=0;a<o;a++)55296==(64512&(i=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=e.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(r-56320),a++),s+=i<128?1:i<2048?2:i<65536?3:4;for(t=new l.Buf8(s),a=n=0;n<s;a++)55296==(64512&(i=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(r=e.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(r-56320),a++),i<128?t[n++]=i:(i<2048?t[n++]=192|i>>>6:(i<65536?t[n++]=224|i>>>12:(t[n++]=240|i>>>18,t[n++]=128|i>>>12&63),t[n++]=128|i>>>6&63),t[n++]=128|63&i);return t},i.buf2binstring=function(e){return c(e,e.length)},i.binstring2buf=function(e){for(var t=new l.Buf8(e.length),i=0,r=t.length;i<r;i++)t[i]=e.charCodeAt(i);return t},i.buf2string=function(e,t){for(var i,r,n=t||e.length,o=new Array(2*n),s=0,a=0;a<n;)if((i=e[a++])<128)o[s++]=i;else if(4<(r=u[i]))o[s++]=65533,a+=r-1;else{for(i&=2===r?31:3===r?15:7;1<r&&a<n;)i=i<<6|63&e[a++],r--;1<r?o[s++]=65533:i<65536?o[s++]=i:(i-=65536,o[s++]=55296|i>>10&1023,o[s++]=56320|1023&i)}return c(o,s)},i.utf8border=function(e,t){for(var i=(t=(t=t||e.length)>e.length?e.length:t)-1;0<=i&&128==(192&e[i]);)i--;return!(i<0)&&0!==i&&i+u[e[i]]>t?i:t}},{"./common":1}],3:[function(e,t,i){t.exports=function(e,t,i,r){for(var n=65535&e|0,o=e>>>16&65535|0,s=0;0!==i;){for(i-=s=2e3<i?2e3:i;o=o+(n=n+t[r++]|0)|0,--s;);n%=65521,o%=65521}return n|o<<16|0}},{}],4:[function(e,t,i){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(e,t,i){var a=function(){for(var e=[],t=0;t<256;t++){for(var i=t,r=0;r<8;r++)i=1&i?3988292384^i>>>1:i>>>1;e[t]=i}return e}();t.exports=function(e,t,i,r){var n=a,o=r+i;e^=-1;for(var s=r;s<o;s++)e=e>>>8^n[255&(e^t[s])];return-1^e}},{}],6:[function(e,t,i){t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],7:[function(e,t,i){t.exports=function(e,t){var i,r,n,o,s,a,l=e.state,u=e.next_in,c=e.input,h=u+(e.avail_in-5),A=e.next_out,p=e.output,f=A-(t-e.avail_out),d=A+(e.avail_out-257),g=l.dmax,m=l.wsize,y=l.whave,_=l.wnext,v=l.window,C=l.hold,w=l.bits,x=l.lencode,b=l.distcode,E=(1<<l.lenbits)-1,B=(1<<l.distbits)-1;e:do{for(w<15&&(C+=c[u++]<<w,w+=8,C+=c[u++]<<w,w+=8),i=x[C&E];;){if(C>>>=r=i>>>24,w-=r,0===(r=i>>>16&255))p[A++]=65535&i;else{if(!(16&r)){if(0==(64&r)){i=x[(65535&i)+(C&(1<<r)-1)];continue}if(32&r){l.mode=12;break e}e.msg="invalid literal/length code",l.mode=30;break e}for(n=65535&i,(r&=15)&&(w<r&&(C+=c[u++]<<w,w+=8),n+=C&(1<<r)-1,C>>>=r,w-=r),w<15&&(C+=c[u++]<<w,w+=8,C+=c[u++]<<w,w+=8),i=b[C&B];;){if(C>>>=r=i>>>24,w-=r,!(16&(r=i>>>16&255))){if(0==(64&r)){i=b[(65535&i)+(C&(1<<r)-1)];continue}e.msg="invalid distance code",l.mode=30;break e}if(o=65535&i,w<(r&=15)&&(C+=c[u++]<<w,(w+=8)<r)&&(C+=c[u++]<<w,w+=8),g<(o+=C&(1<<r)-1)){e.msg="invalid distance too far back",l.mode=30;break e}if(C>>>=r,w-=r,(r=A-f)<o){if(y<(r=o-r)&&l.sane){e.msg="invalid distance too far back",l.mode=30;break e}if(a=v,(s=0)===_){if(s+=m-r,r<n){for(n-=r;p[A++]=v[s++],--r;);s=A-o,a=p}}else if(_<r){if(s+=m+_-r,(r-=_)<n){for(n-=r;p[A++]=v[s++],--r;);if(s=0,_<n){for(n-=r=_;p[A++]=v[s++],--r;);s=A-o,a=p}}}else if(s+=_-r,r<n){for(n-=r;p[A++]=v[s++],--r;);s=A-o,a=p}for(;2<n;)p[A++]=a[s++],p[A++]=a[s++],p[A++]=a[s++],n-=3;n&&(p[A++]=a[s++],1<n)&&(p[A++]=a[s++])}else{for(s=A-o;p[A++]=p[s++],p[A++]=p[s++],p[A++]=p[s++],2<(n-=3););n&&(p[A++]=p[s++],1<n)&&(p[A++]=p[s++])}break}}break}}while(u<h&&A<d);C&=(1<<(w-=(n=w>>3)<<3))-1,e.next_in=u-=n,e.next_out=A,e.avail_in=u<h?h-u+5:5-(u-h),e.avail_out=A<d?d-A+257:257-(A-d),l.hold=C,l.bits=w}},{}],8:[function(e,t,i){var T=e("../utils/common"),L=e("./adler32"),D=e("./crc32"),F=e("./inffast"),N=e("./inftrees"),O=1,R=2,U=0,k=-2,H=1,r=852,n=592;function Q(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function o(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new T.Buf16(320),this.work=new T.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function s(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=H,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new T.Buf32(r),t.distcode=t.distdyn=new T.Buf32(n),t.sane=1,t.back=-1,U):k}function a(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,s(e)):k}function l(e,t){var i,r;return!e||!e.state||(r=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t))?k:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=i,r.wbits=t,a(e))}function u(e,t){var i;return e?(i=new o,(e.state=i).window=null,(i=l(e,t))!==U&&(e.state=null),i):k}var V,G,z=!0;function W(e,t,i,r){var n,e=e.state;return null===e.window&&(e.wsize=1<<e.wbits,e.wnext=0,e.whave=0,e.window=new T.Buf8(e.wsize)),r>=e.wsize?(T.arraySet(e.window,t,i-e.wsize,e.wsize,0),e.wnext=0,e.whave=e.wsize):(r<(n=e.wsize-e.wnext)&&(n=r),T.arraySet(e.window,t,i-r,n,e.wnext),(r-=n)?(T.arraySet(e.window,t,i-r,r,0),e.wnext=r,e.whave=e.wsize):(e.wnext+=n,e.wnext===e.wsize&&(e.wnext=0),e.whave<e.wsize&&(e.whave+=n))),0}i.inflateReset=a,i.inflateReset2=l,i.inflateResetKeep=s,i.inflateInit=function(e){return u(e,15)},i.inflateInit2=u,i.inflate=function(e,t){var i,r,n,o,s,a,l,u,c,h,A,p,f,d,g,m,y,_,v,C,w,x,b,E,B=0,M=new T.Buf8(4),I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return k;12===(i=e.state).mode&&(i.mode=13),s=e.next_out,n=e.output,l=e.avail_out,o=e.next_in,r=e.input,a=e.avail_in,u=i.hold,c=i.bits,h=a,A=l,x=U;e:for(;;)switch(i.mode){case H:if(0===i.wrap)i.mode=13;else{for(;c<16;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}if(2&i.wrap&&35615===u)M[i.check=0]=255&u,M[1]=u>>>8&255,i.check=D(i.check,M,2,0),c=u=0,i.mode=2;else if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&u)<<8)+(u>>8))%31)e.msg="incorrect header check",i.mode=30;else if(8!=(15&u))e.msg="unknown compression method",i.mode=30;else{if(c-=4,w=8+(15&(u>>>=4)),0===i.wbits)i.wbits=w;else if(w>i.wbits){e.msg="invalid window size",i.mode=30;break}i.dmax=1<<w,e.adler=i.check=1,i.mode=512&u?10:12,c=u=0}}break;case 2:for(;c<16;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}if(i.flags=u,8!=(255&i.flags)){e.msg="unknown compression method",i.mode=30;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=30;break}i.head&&(i.head.text=u>>8&1),512&i.flags&&(M[0]=255&u,M[1]=u>>>8&255,i.check=D(i.check,M,2,0)),c=u=0,i.mode=3;case 3:for(;c<32;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}i.head&&(i.head.time=u),512&i.flags&&(M[0]=255&u,M[1]=u>>>8&255,M[2]=u>>>16&255,M[3]=u>>>24&255,i.check=D(i.check,M,4,0)),c=u=0,i.mode=4;case 4:for(;c<16;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}i.head&&(i.head.xflags=255&u,i.head.os=u>>8),512&i.flags&&(M[0]=255&u,M[1]=u>>>8&255,i.check=D(i.check,M,2,0)),c=u=0,i.mode=5;case 5:if(1024&i.flags){for(;c<16;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}i.length=u,i.head&&(i.head.extra_len=u),512&i.flags&&(M[0]=255&u,M[1]=u>>>8&255,i.check=D(i.check,M,2,0)),c=u=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&((p=a<(p=i.length)?a:p)&&(i.head&&(w=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),T.arraySet(i.head.extra,r,o,p,w)),512&i.flags&&(i.check=D(i.check,r,p,o)),a-=p,o+=p,i.length-=p),i.length))break e;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===a)break e;for(p=0;w=r[o+p++],i.head&&w&&i.length<65536&&(i.head.name+=String.fromCharCode(w)),w&&p<a;);if(512&i.flags&&(i.check=D(i.check,r,p,o)),a-=p,o+=p,w)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===a)break e;for(p=0;w=r[o+p++],i.head&&w&&i.length<65536&&(i.head.comment+=String.fromCharCode(w)),w&&p<a;);if(512&i.flags&&(i.check=D(i.check,r,p,o)),a-=p,o+=p,w)break e}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;c<16;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}if(u!==(65535&i.check)){e.msg="header crc mismatch",i.mode=30;break}c=u=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=12;break;case 10:for(;c<32;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}e.adler=i.check=Q(u),c=u=0,i.mode=11;case 11:if(0===i.havedict)return e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=a,i.hold=u,i.bits=c,2;e.adler=i.check=1,i.mode=12;case 12:if(5===t||6===t)break e;case 13:if(i.last)u>>>=7&c,c-=7&c,i.mode=27;else{for(;c<3;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}switch(i.last=1&u,--c,3&(u>>>=1)){case 0:i.mode=14;break;case 1:S=P=void 0;var S,P=i;if(z){for(V=new T.Buf32(512),G=new T.Buf32(32),S=0;S<144;)P.lens[S++]=8;for(;S<256;)P.lens[S++]=9;for(;S<280;)P.lens[S++]=7;for(;S<288;)P.lens[S++]=8;for(N(O,P.lens,0,288,V,0,P.work,{bits:9}),S=0;S<32;)P.lens[S++]=5;N(R,P.lens,0,32,G,0,P.work,{bits:5}),z=!1}if(P.lencode=V,P.lenbits=9,P.distcode=G,P.distbits=5,i.mode=20,6!==t)break;u>>>=2,c-=2;break e;case 2:i.mode=17;break;case 3:e.msg="invalid block type",i.mode=30}u>>>=2,c-=2}break;case 14:for(u>>>=7&c,c-=7&c;c<32;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",i.mode=30;break}if(i.length=65535&u,c=u=0,i.mode=15,6===t)break e;case 15:i.mode=16;case 16:if(p=i.length){if(0===(p=l<(p=a<p?a:p)?l:p))break e;T.arraySet(n,r,o,p,s),a-=p,o+=p,l-=p,s+=p,i.length-=p}else i.mode=12;break;case 17:for(;c<14;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}if(i.nlen=257+(31&u),u>>>=5,c-=5,i.ndist=1+(31&u),u>>>=5,c-=5,i.ncode=4+(15&u),u>>>=4,c-=4,286<i.nlen||30<i.ndist){e.msg="too many length or distance symbols",i.mode=30;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;c<3;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}i.lens[I[i.have++]]=7&u,u>>>=3,c-=3}for(;i.have<19;)i.lens[I[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,b={bits:i.lenbits},x=N(0,i.lens,0,19,i.lencode,0,i.work,b),i.lenbits=b.bits,x){e.msg="invalid code lengths set",i.mode=30;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;m=(B=i.lencode[u&(1<<i.lenbits)-1])>>>16&255,y=65535&B,!((g=B>>>24)<=c);){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}if(y<16)u>>>=g,c-=g,i.lens[i.have++]=y;else{if(16===y){for(E=g+2;c<E;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}if(u>>>=g,c-=g,0===i.have){e.msg="invalid bit length repeat",i.mode=30;break}w=i.lens[i.have-1],p=3+(3&u),u>>>=2,c-=2}else if(17===y){for(E=g+3;c<E;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}w=0,p=3+(7&(u>>>=g)),u>>>=3,c=c-g-3}else{for(E=g+7;c<E;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}w=0,p=11+(127&(u>>>=g)),u>>>=7,c=c-g-7}if(i.have+p>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=30;break}for(;p--;)i.lens[i.have++]=w}}if(30===i.mode)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=30;break}if(i.lenbits=9,b={bits:i.lenbits},x=N(O,i.lens,0,i.nlen,i.lencode,0,i.work,b),i.lenbits=b.bits,x){e.msg="invalid literal/lengths set",i.mode=30;break}if(i.distbits=6,i.distcode=i.distdyn,b={bits:i.distbits},x=N(R,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,b),i.distbits=b.bits,x){e.msg="invalid distances set",i.mode=30;break}if(i.mode=20,6===t)break e;case 20:i.mode=21;case 21:if(6<=a&&258<=l){e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=a,i.hold=u,i.bits=c,F(e,A),s=e.next_out,n=e.output,l=e.avail_out,o=e.next_in,r=e.input,a=e.avail_in,u=i.hold,c=i.bits,12===i.mode&&(i.back=-1);break}for(i.back=0;m=(B=i.lencode[u&(1<<i.lenbits)-1])>>>16&255,y=65535&B,!((g=B>>>24)<=c);){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}if(m&&0==(240&m)){for(_=g,v=m,C=y;m=(B=i.lencode[C+((u&(1<<_+v)-1)>>_)])>>>16&255,y=65535&B,!(_+(g=B>>>24)<=c);){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}u>>>=_,c-=_,i.back+=_}if(u>>>=g,c-=g,i.back+=g,i.length=y,0===m){i.mode=26;break}if(32&m){i.back=-1,i.mode=12;break}if(64&m){e.msg="invalid literal/length code",i.mode=30;break}i.extra=15&m,i.mode=22;case 22:if(i.extra){for(E=i.extra;c<E;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}i.length+=u&(1<<i.extra)-1,u>>>=i.extra,c-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;m=(B=i.distcode[u&(1<<i.distbits)-1])>>>16&255,y=65535&B,!((g=B>>>24)<=c);){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}if(0==(240&m)){for(_=g,v=m,C=y;m=(B=i.distcode[C+((u&(1<<_+v)-1)>>_)])>>>16&255,y=65535&B,!(_+(g=B>>>24)<=c);){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}u>>>=_,c-=_,i.back+=_}if(u>>>=g,c-=g,i.back+=g,64&m){e.msg="invalid distance code",i.mode=30;break}i.offset=y,i.extra=15&m,i.mode=24;case 24:if(i.extra){for(E=i.extra;c<E;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}i.offset+=u&(1<<i.extra)-1,u>>>=i.extra,c-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=30;break}i.mode=25;case 25:if(0===l)break e;if(i.offset>(p=A-l)){if((p=i.offset-p)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=30;break}f=p>i.wnext?(p-=i.wnext,i.wsize-p):i.wnext-p,p>i.length&&(p=i.length),d=i.window}else d=n,f=s-i.offset,p=i.length;for(l-=p=l<p?l:p,i.length-=p;n[s++]=d[f++],--p;);0===i.length&&(i.mode=21);break;case 26:if(0===l)break e;n[s++]=i.length,l--,i.mode=21;break;case 27:if(i.wrap){for(;c<32;){if(0===a)break e;a--,u|=r[o++]<<c,c+=8}if(A-=l,e.total_out+=A,i.total+=A,A&&(e.adler=i.check=(i.flags?D:L)(i.check,n,A,s-A)),A=l,(i.flags?u:Q(u))!==i.check){e.msg="incorrect data check",i.mode=30;break}c=u=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;c<32;){if(0===a)break e;a--,u+=r[o++]<<c,c+=8}if(u!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=30;break}c=u=0}i.mode=29;case 29:x=1;break e;case 30:x=-3;break e;case 31:return-4;default:return k}return e.next_out=s,e.avail_out=l,e.next_in=o,e.avail_in=a,i.hold=u,i.bits=c,(i.wsize||A!==e.avail_out&&i.mode<30&&(i.mode<27||4!==t))&&W(e,e.output,e.next_out,A-e.avail_out)?(i.mode=31,-4):(h-=e.avail_in,A-=e.avail_out,e.total_in+=h,e.total_out+=A,i.total+=A,i.wrap&&A&&(e.adler=i.check=(i.flags?D:L)(i.check,n,A,e.next_out-A)),e.data_type=i.bits+(i.last?64:0)+(12===i.mode?128:0)+(20===i.mode||15===i.mode?256:0),(0==h&&0===A||4===t)&&x===U?-5:x)},i.inflateEnd=function(e){var t;return e&&e.state?((t=e.state).window&&(t.window=null),e.state=null,U):k},i.inflateGetHeader=function(e,t){return!e||!e.state||0==(2&(e=e.state).wrap)?k:((e.head=t).done=!1,U)},i.inflateSetDictionary=function(e,t){var i,r=t.length;return!e||!e.state||0!==(i=e.state).wrap&&11!==i.mode?k:11===i.mode&&L(1,t,r,0)!==i.check?-3:W(e,t,r,r)?(i.mode=31,-4):(i.havedict=1,U)},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(e,t,i){var F=e("../utils/common"),N=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],O=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],R=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],U=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,i,r,n,o,s,a){for(var l,u,c,h,A,p,f,d,g,m=a.bits,y=0,_=0,v=0,C=0,w=0,x=0,b=0,E=0,B=0,M=0,I=null,S=0,P=new F.Buf16(16),T=new F.Buf16(16),L=null,D=0,y=0;y<=15;y++)P[y]=0;for(_=0;_<r;_++)P[t[i+_]]++;for(w=m,C=15;1<=C&&0===P[C];C--);if(C<w&&(w=C),0===C)n[o++]=20971520,n[o++]=20971520,a.bits=1;else{for(v=1;v<C&&0===P[v];v++);for(w<v&&(w=v),y=E=1;y<=15;y++)if((E=(E<<=1)-P[y])<0)return-1;if(0<E&&(0===e||1!==C))return-1;for(T[1]=0,y=1;y<15;y++)T[y+1]=T[y]+P[y];for(_=0;_<r;_++)0!==t[i+_]&&(s[T[t[i+_]]++]=_);if(p=0===e?(I=L=s,19):1===e?(I=N,S-=257,L=O,D-=257,256):(I=R,L=U,-1),y=v,A=o,b=_=M=0,c=-1,h=(B=1<<(x=w))-1,1===e&&852<B||2===e&&592<B)return 1;for(;;){for(g=s[_]<p?(d=0,s[_]):s[_]>p?(d=L[D+s[_]],I[S+s[_]]):(d=96,0),l=1<<(f=y-b),v=u=1<<x;n[A+(M>>b)+(u-=l)]=f<<24|d<<16|g|0,0!==u;);for(l=1<<y-1;M&l;)l>>=1;if(M=0!==l?(M&l-1)+l:0,_++,0==--P[y]){if(y===C)break;y=t[i+s[_]]}if(w<y&&(M&h)!==c){for(A+=v,E=1<<(x=y-(b=0===b?w:b));x+b<C&&!((E-=P[x+b])<=0);)x++,E<<=1;if(B+=1<<x,1===e&&852<B||2===e&&592<B)return 1;n[c=M&h]=w<<24|x<<16|A-o|0}}0!==M&&(n[A+M]=y-b<<24|64<<16|0),a.bits=w}return 0}},{"../utils/common":1}],10:[function(e,t,i){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(e,t,i){t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],"/lib/inflate.js":[function(e,t,i){var h=e("./zlib/inflate"),A=e("./utils/common"),p=e("./utils/strings"),f=e("./zlib/constants"),r=e("./zlib/messages"),n=e("./zlib/zstream"),o=e("./zlib/gzheader"),d=Object.prototype.toString;function s(e){if(!(this instanceof s))return new s(e);this.options=A.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options,e=(t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits)&&(t.windowBits=-15),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new n,this.strm.avail_out=0,h.inflateInit2(this.strm,t.windowBits));if(e!==f.Z_OK)throw new Error(r[e]);this.header=new o,h.inflateGetHeader(this.strm,this.header)}function a(e,t){t=new s(t);if(t.push(e,!0),t.err)throw t.msg||r[t.err];return t.result}s.prototype.push=function(e,t){var i,r,n,o,s,a=this.strm,l=this.options.chunkSize,u=this.options.dictionary,c=!1;if(this.ended)return!1;r=t===~~t?t:!0===t?f.Z_FINISH:f.Z_NO_FLUSH,"string"==typeof e?a.input=p.binstring2buf(e):"[object ArrayBuffer]"===d.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new A.Buf8(l),a.next_out=0,a.avail_out=l),(i=h.inflate(a,f.Z_NO_FLUSH))===f.Z_NEED_DICT&&u&&(s="string"==typeof u?p.string2buf(u):"[object ArrayBuffer]"===d.call(u)?new Uint8Array(u):u,i=h.inflateSetDictionary(this.strm,s)),i===f.Z_BUF_ERROR&&!0===c&&(i=f.Z_OK,c=!1),i!==f.Z_STREAM_END&&i!==f.Z_OK)return this.onEnd(i),!(this.ended=!0)}while(!a.next_out||0!==a.avail_out&&i!==f.Z_STREAM_END&&(0!==a.avail_in||r!==f.Z_FINISH&&r!==f.Z_SYNC_FLUSH)||("string"===this.options.to?(s=p.utf8border(a.output,a.next_out),n=a.next_out-s,o=p.buf2string(a.output,s),a.next_out=n,a.avail_out=l-n,n&&A.arraySet(a.output,a.output,s,n,0),this.onData(o)):this.onData(A.shrinkBuf(a.output,a.next_out))),0===a.avail_in&&0===a.avail_out&&(c=!0),(0<a.avail_in||0===a.avail_out)&&i!==f.Z_STREAM_END);return(r=i===f.Z_STREAM_END?f.Z_FINISH:r)===f.Z_FINISH?(i=h.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===f.Z_OK):r!==f.Z_SYNC_FLUSH||(this.onEnd(f.Z_OK),!(a.avail_out=0))},s.prototype.onData=function(e){this.chunks.push(e)},s.prototype.onEnd=function(e){e===f.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=A.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Inflate=s,i.inflate=a,i.inflateRaw=function(e,t){return(t=t||{}).raw=!0,a(e,t)},i.ungzip=a},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js"),k=1,Q=2,H=4;function V(e,t,i,r){var e=e|t<<8,t=e>>11&31,n=e>>5&63,o=31&e;return i[r+0]=t<<3|t>>2,i[r+1]=n<<2|n>>4,i[r+2]=o<<3|o>>2,i[r+3]=255,e}function G(e,t,i,r){for(var n=0,o=e,s=t,a=i+(n=0!=(r&(Q|H))?8:n),l=0!=(r&k),u=new Uint8Array(16),c=V(s[a+0],s[a+1],u,0),h=V(s[a+2],s[a+3],u,4),A=0;A<3;A++){var p=u[A],f=u[4+A];l&&c<=h?(u[8+A]=(p+f)/2,u[12+A]=0):(u[8+A]=(2*p+f)/3,u[12+A]=(p+2*f)/3)}u[11]=255,u[15]=l&&c<=h?0:255;for(var d=new Uint8Array(16),A=0;A<4;++A){var g=s[a+4+A];d[4*A+0]=3&g,d[4*A+1]=g>>2&3,d[4*A+2]=g>>4&3,d[4*A+3]=g>>6&3}for(A=0;A<16;++A)for(var m=4*d[A],y=0;y<4;++y)o[4*A+y]=u[m+y];if(0!=(r&Q))for(var _=e,v=i,C=0;C<8;++C){var w=bytes[v+C],x=15&w,w=240&w;_[8*C+3]=x|x<<4,_[8*C+7]=w|w>>4}else if(0!=(r&H)){var b=e,E=t,B=E[(T=i)+0],M=E[T+1],I=new Uint8Array(8);if((I[0]=B)<=(I[1]=M)){for(var S=1;S<5;++S)I[1+S]=((5-S)*B+S*M)/5;I[6]=0,I[7]=255}else for(S=1;S<7;++S)I[1+S]=((7-S)*B+S*M)/7;for(var P=new Uint8Array(16),T=T+2,L=0,S=0;S<2;++S){for(var D=0,F=0;F<3;++F)D|=E[T++]<<8*F;for(F=0;F<8;++F)P[L++]=D>>3*F&7}for(S=0;S<16;++S)b[4*S+3]=I[P[S]]}}function T(e){}T.decode=function(e,t,i,r,n){if(null!=e&&null!=r&&0!=i&&0!=t){var o=0;if((o=11<n||5===n?H:32|k)&k&&32&o)for(var s,a,l,u,c,h,A,n=e,p=t,f=i,d=r,g=new Uint16Array(4),m=n,y=p/4,_=f/4,v=0;v<_;v++)for(var C=0;C<y;C++)g[0]=d[s=4*((_-v)*y+C)],g[1]=d[1+s],a=31&g[0],l=2016&g[0],u=63488&g[0],c=31&g[1],h=2016&g[1],A=63488&g[1],g[2]=5*a+3*c>>3|5*l+3*h>>3&2016|5*u+3*A>>3&63488,g[3]=5*c+3*a>>3|5*h+3*l>>3&2016|5*A+3*u>>3&63488,c=d[2+s],m[a=4*v*p+4*C]=g[3&c],m[1+a]=g[c>>2&3],m[2+a]=g[c>>4&3],m[3+a]=g[c>>6&3],m[a+=p]=g[c>>8&3],m[a+1]=g[c>>10&3],m[a+2]=g[c>>12&3],m[a+3]=g[c>>14],c=d[3+s],m[a+=p]=g[3&c],m[a+1]=g[c>>2&3],m[a+2]=g[c>>4&3],m[a+3]=g[c>>6&3],m[a+=p]=g[c>>8&3],m[a+1]=g[c>>10&3],m[a+2]=g[c>>12&3],m[a+3]=g[c>>14];else for(var w=e,x=t,b=i,O=r,E=o,R=0!=(E&k)?8:16,B=0,M=0;M<b;M+=4)for(var I=0;I<x;I+=4){for(var S=new Uint8Array(64),P=(G(S,O,B,E),0),T=0;T<4;++T)for(var L=0;L<4;++L){var D=I+L,F=M+T;if(D<x&&F<b)for(var U=4*(x*(b-F)+D),N=0;N<4;++N)w[U++]=S[P++];else P+=4}B+=R}}};var h,s,L,D,z=T;function a(e,t,i,r,n,o){var s=h.exports.sbrk,a=i+3&-4,l=s(a*r),u=s(n.length),c=new Uint8Array(h.exports.memory.buffer),e=(c.set(n,u),e(l,i,r,u,n.length));if(0==e&&o&&o(l,a,r),t.set(c.subarray(l,l+i*r)),s(l-s(0)),0!=e)throw new Error("Malformed buffer data: "+e)}t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),D=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);var W="object"!=typeof WebAssembly?{supported:!1}:(e="B9h79tEBBBE8fV9gBB9gVUUUUUEU9gIUUUB9gEUEU9gIUUUEUIKQBEEEDDDILLLVE9wEEEVIEBEOWEUEC+Q/IEKR/LEdO9tw9t9vv95DBh9f9f939h79t9f9j9h229f9jT9vv7BB8a9tw79o9v9wT9f9kw9j9v9kw9WwvTw949C919m9mwvBEy9tw79o9v9wT9f9kw9j9v9kw69u9kw949C919m9mwvBDe9tw79o9v9wT9f9kw9j9v9kw69u9kw949Twg91w9u9jwBIl9tw79o9v9wT9f9kw9j9v9kws9p2Twv9P9jTBLk9tw79o9v9wT9f9kw9j9v9kws9p2Twv9R919hTBVl9tw79o9v9wT9f9kw9j9v9kws9p2Twvt949wBOL79iv9rBRQ+x8yQDBK/qMEZU8jJJJJBCJ/EB9rGV8kJJJJBC9+HODNADCEFAL0MBCUHOAIrBBC+gE9HMBAVAIALFGRAD9rADZ1JJJBHWCJ/ABAD9uC/wfBgGOCJDAOCJD6eHdAICEFHLCBHQDNINAQAE9PMEAdAEAQ9rAQAdFAE6eHKDNDNADtMBAKCSFGOC9wgHXAOCL4CIFCD4HMAWCJDFHpCBHSALHZINDNARAZ9rAM9PMBCBHLXIKAZAMFHLDNAXtMBCBHhCBHIINDNARAL9rCk9PMBCBHLXVKAWCJ/CBFAIFHODNDNDNDNDNAZAICO4FrBBAhCOg4CIgpLBEDIBKAO9CB83IBAOCWF9CB83IBXIKAOALrBLALrBBGoCO4GaAaCIsGae86BBAOCEFALCLFAaFGarBBAoCL4CIgGcAcCIsGce86BBAOCDFAaAcFGarBBAoCD4CIgGcAcCIsGce86BBAOCIFAaAcFGarBBAoCIgGoAoCIsGoe86BBAOCLFAaAoFGarBBALrBEGoCO4GcAcCIsGce86BBAOCVFAaAcFGarBBAoCL4CIgGcAcCIsGce86BBAOCOFAaAcFGarBBAoCD4CIgGcAcCIsGce86BBAOCRFAaAcFGarBBAoCIgGoAoCIsGoe86BBAOCWFAaAoFGarBBALrBDGoCO4GcAcCIsGce86BBAOCdFAaAcFGarBBAoCL4CIgGcAcCIsGce86BBAOCQFAaAcFGarBBAoCD4CIgGcAcCIsGce86BBAOCKFAaAcFGarBBAoCIgGoAoCIsGoe86BBAOCXFAaAoFGorBBALrBIGLCO4GaAaCIsGae86BBAOCMFAoAaFGorBBALCL4CIgGaAaCIsGae86BBAOCpFAoAaFGorBBALCD4CIgGaAaCIsGae86BBAOCSFAoAaFGOrBBALCIgGLALCIsGLe86BBAOALFHLXDKAOALrBWALrBBGoCL4GaAaCSsGae86BBAOCEFALCWFAaFGarBBAoCSgGoAoCSsGoe86BBAOCDFAaAoFGorBBALrBEGaCL4GcAcCSsGce86BBAOCIFAoAcFGorBBAaCSgGaAaCSsGae86BBAOCLFAoAaFGorBBALrBDGaCL4GcAcCSsGce86BBAOCVFAoAcFGorBBAaCSgGaAaCSsGae86BBAOCOFAoAaFGorBBALrBIGaCL4GcAcCSsGce86BBAOCRFAoAcFGorBBAaCSgGaAaCSsGae86BBAOCWFAoAaFGorBBALrBLGaCL4GcAcCSsGce86BBAOCdFAoAcFGorBBAaCSgGaAaCSsGae86BBAOCQFAoAaFGorBBALrBVGaCL4GcAcCSsGce86BBAOCKFAoAcFGorBBAaCSgGaAaCSsGae86BBAOCXFAoAaFGorBBALrBOGaCL4GcAcCSsGce86BBAOCMFAoAcFGorBBAaCSgGaAaCSsGae86BBAOCpFAoAaFGorBBALrBRGLCL4GaAaCSsGae86BBAOCSFAoAaFGOrBBALCSgGLALCSsGLe86BBAOALFHLXEKAOAL8pBB83BBAOCWFALCWF8pBB83BBALCZFHLKAhCDFHhAICZFGIAX6MBKKDNALMBCBHLXIKDNAKtMBAWASFrBBHhCBHOApHIINAIAWCJ/CBFAOFrBBGZCE4CBAZCEg9r7AhFGh86BBAIADFHIAOCEFGOAK9HMBKKApCEFHpALHZASCEFGSAD9HMBKKABAQAD2FAWCJDFAKAD2Z1JJJB8aAWAWCJDFAKCUFAD2FADZ1JJJB8aKAKCBALeAQFHQALMBKC9+HOXEKCBC99ARAL9rADCAADCA0eseHOKAVCJ/EBF8kJJJJBAOK+OoEZU8jJJJJBC/AE9rGV8kJJJJBC9+HODNAECI9uGRChFAL0MBCUHOAIrBBGWC/wEgC/gE9HMBAWCSgGdCE0MBAVC/ABFCfECJEZ+JJJJB8aAVCuF9CU83IBAVC8wF9CU83IBAVCYF9CU83IBAVCAF9CU83IBAVCkF9CU83IBAVCZF9CU83IBAV9CU83IWAV9CU83IBAIALFC9wFHQAICEFGWARFHKDNAEtMBCMCSAdCEseHXABHICBHdCBHMCBHpCBHLCBHOINDNAKAQ9NMBC9+HOXIKDNDNAWrBBGRC/vE0MBAVC/ABFARCL4CU7AOFCSgCITFGSYDLHZASYDBHhDNARCSgGSAX9PMBAVARCU7ALFCSgCDTFYDBAdASeHRAStHSDNDNADCD9HMBABAh87EBABCLFAR87EBABCDFAZ87EBXEKAIAhbDBAICWFARbDBAICLFAZbDBKAdASFHdAVC/ABFAOCITFGoARbDBAoAZbDLAVALCDTFARbDBAVC/ABFAOCEFCSgGOCITFGZAhbDBAZARbDLALASFHLAOCEFHOXDKDNDNASCSsMBAMASFASC987FCEFHMXEKAK8sBBGSCfEgHRDNDNASCU9MMBAKCEFHKXEKAK8sBEGSCfBgCRTARCfBgvHRDNASCU9MMBAKCDFHKXEKAK8sBDGSCfBgCpTARvHRDNASCU9MMBAKCIFHKXEKAK8sBIGSCfBgCxTARvHRDNASCU9MMBAKCLFHKXEKAKrBLC3TARvHRAKCVFHKKARCE4CBARCEg9r7AMFHMKDNDNADCD9HMBABAh87EBABCLFAM87EBABCDFAZ87EBXEKAIAhbDBAICWFAMbDBAICLFAZbDBKAVC/ABFAOCITFGRAMbDBARAZbDLAVALCDTFAMbDBAVC/ABFAOCEFCSgGOCITFGRAhbDBARAMbDLALCEFHLAOCEFHOXEKDNARCPE0MBAVALAQARCSgFrBBGSCL4GZ9rCSgCDTFYDBAdCEFGhAZeHRAVALAS9rCSgCDTFYDBAhAZtGoFGhASCSgGZeHSAZtHZDNDNADCD9HMBABAd87EBABCLFAS87EBABCDFAR87EBXEKAIAdbDBAICWFASbDBAICLFARbDBKAVALCDTFAdbDBAVC/ABFAOCITFGaARbDBAaAdbDLAVALCEFGLCSgCDTFARbDBAVC/ABFAOCEFCSgCITFGaASbDBAaARbDLAVALAoFCSgGLCDTFASbDBAVC/ABFAOCDFCSgGOCITFGRAdbDBARASbDLAOCEFHOALAZFHLAhAZFHdXEKAdCBAKrBBGaeGZARC/+EsGcFHRAaCSgHhDNDNAaCL4GoMBARCEFHSXEKARHSAVALAo9rCSgCDTFYDBHRKDNDNAhMBASCEFHdXEKASHdAVALAa9rCSgCDTFYDBHSKDNDNActMBAKCEFHaXEKAK8sBEGaCfEgHZDNDNAaCU9MMBAKCDFHaXEKAK8sBDGaCfBgCRTAZCfBgvHZDNAaCU9MMBAKCIFHaXEKAK8sBIGaCfBgCpTAZvHZDNAaCU9MMBAKCLFHaXEKAK8sBLGaCfBgCxTAZvHZDNAaCU9MMBAKCVFHaXEKAKCOFHaAKrBVC3TAZvHZKAZCE4CBAZCEg9r7AMFGMHZKDNDNAoCSsMBAaHcXEKAa8sBBGKCfEgHRDNDNAKCU9MMBAaCEFHcXEKAa8sBEGKCfBgCRTARCfBgvHRDNAKCU9MMBAaCDFHcXEKAa8sBDGKCfBgCpTARvHRDNAKCU9MMBAaCIFHcXEKAa8sBIGKCfBgCxTARvHRDNAKCU9MMBAaCLFHcXEKAaCVFHcAarBLC3TARvHRKARCE4CBARCEg9r7AMFGMHRKDNDNAhCSsMBAcHKXEKAc8sBBGKCfEgHSDNDNAKCU9MMBAcCEFHKXEKAc8sBEGKCfBgCRTASCfBgvHSDNAKCU9MMBAcCDFHKXEKAc8sBDGKCfBgCpTASvHSDNAKCU9MMBAcCIFHKXEKAc8sBIGKCfBgCxTASvHSDNAKCU9MMBAcCLFHKXEKAcCVFHKAcrBLC3TASvHSKASCE4CBASCEg9r7AMFGMHSKDNDNADCD9HMBABAZ87EBABCLFAS87EBABCDFAR87EBXEKAIAZbDBAICWFASbDBAICLFARbDBKAVC/ABFAOCITFGaARbDBAaAZbDLAVALCDTFAZbDBAVC/ABFAOCEFCSgCITFGaASbDBAaARbDLAVALCEFGLCSgCDTFARbDBAVC/ABFAOCDFCSgCITFGRAZbDBARASbDLAVALAotAoCSsvFGLCSgCDTFASbDBALAhtAhCSsvFHLAOCIFHOKAWCEFHWABCOFHBAICXFHIAOCSgHOALCSgHLApCIFGpAE6MBKKCBC99AKAQseHOKAVC/AEF8kJJJJBAOK/tLEDU8jJJJJBCZ9rHVC9+HODNAECVFAL0MBCUHOAIrBBC/+EgC/QE9HMBAV9CB83IWAICEFHOAIALFC98FHIDNAEtMBDNADCDsMBINDNAOAI6MBC9+SKAO8sBBGDCfEgHLDNDNADCU9MMBAOCEFHOXEKAO8sBEGDCfBgCRTALCfBgvHLDNADCU9MMBAOCDFHOXEKAO8sBDGDCfBgCpTALvHLDNADCU9MMBAOCIFHOXEKAO8sBIGDCfBgCxTALvHLDNADCU9MMBAOCLFHOXEKAOrBLC3TALvHLAOCVFHOKAVCWFALCEgCDTvGDALCD4CBALCE4CEg9r7ADYDBFGLbDBABALbDBABCLFHBAECUFGEMBXDKKINDNAOAI6MBC9+SKAO8sBBGDCfEgHLDNDNADCU9MMBAOCEFHOXEKAO8sBEGDCfBgCRTALCfBgvHLDNADCU9MMBAOCDFHOXEKAO8sBDGDCfBgCpTALvHLDNADCU9MMBAOCIFHOXEKAO8sBIGDCfBgCxTALvHLDNADCU9MMBAOCLFHOXEKAOrBLC3TALvHLAOCVFHOKABALCD4CBALCE4CEg9r7AVCWFALCEgCDTvGLYDBFGD87EBALADbDBABCDFHBAECUFGEMBKKCBC99AOAIseHOKAOK+lVOEUE99DUD99EUD99DNDNADCL9HMBAEtMEINDNDNjBBBzjBBB+/ABCDFGD8sBB+yAB8sBBGI+yGL+L+TABCEFGV8sBBGO+yGR+L+TGWjBBBB9gGdeAWjBB/+9CAWAWnjBBBBAWAdeGQAQ+MGKAICU9KeALmGLALnAQAKAOCU9KeARmGQAQnmm+R+VGRnmGW+LjBBB9P9dtMBAW+oHIXEKCJJJJ94HIKADAI86BBDNDNjBBBzjBBB+/AQjBBBB9geAQARnmGW+LjBBB9P9dtMBAW+oHDXEKCJJJJ94HDKAVAD86BBDNDNjBBBzjBBB+/ALjBBBB9geALARnmGW+LjBBB9P9dtMBAW+oHDXEKCJJJJ94HDKABAD86BBABCLFHBAECUFGEMBXDKKAEtMBINDNDNjBBBzjBBB+/ABCLFGD8uEB+yAB8uEBGI+yGL+L+TABCDFGV8uEBGO+yGR+L+TGWjBBBB9gGdeAWjB/+fsAWAWnjBBBBAWAdeGQAQ+MGKAICU9KeALmGLALnAQAKAOCU9KeARmGQAQnmm+R+VGRnmGW+LjBBB9P9dtMBAW+oHIXEKCJJJJ94HIKADAI87EBDNDNjBBBzjBBB+/AQjBBBB9geAQARnmGW+LjBBB9P9dtMBAW+oHDXEKCJJJJ94HDKAVAD87EBDNDNjBBBzjBBB+/ALjBBBB9geALARnmGW+LjBBB9P9dtMBAW+oHDXEKCJJJJ94HDKABAD87EBABCWFHBAECUFGEMBKKK/SILIUI99IUE99DNAEtMBCBHIABHLINDNDNj/zL81zALCOF8uEBGVCIv+y+VGOAL8uEB+ynGRjB/+fsnjBBBzjBBB+/ARjBBBB9gemGW+LjBBB9P9dtMBAW+oHdXEKCJJJJ94HdKALCLF8uEBHQALCDF8uEBHKABAVCEFCIgAIvCETFAd87EBDNDNAOAK+ynGWjB/+fsnjBBBzjBBB+/AWjBBBB9gemGX+LjBBB9P9dtMBAX+oHKXEKCJJJJ94HKKABAVCDFCIgAIvCETFAK87EBDNDNAOAQ+ynGOjB/+fsnjBBBzjBBB+/AOjBBBB9gemGX+LjBBB9P9dtMBAX+oHQXEKCJJJJ94HQKABAVCUFCIgAIvCETFAQ87EBDNDNjBBJzARARn+TAWAWn+TAOAOn+TGRjBBBBARjBBBB9ge+RjB/+fsnjBBBzmGR+LjBBB9P9dtMBAR+oHQXEKCJJJJ94HQKABAVCIgAIvCETFAQ87EBALCWFHLAICLFHIAECUFGEMBKKK6BDNADCD4AE2GEtMBINABABYDBGDCWTCW91+yADCk91ClTCJJJ/8IF++nuDBABCLFHBAECUFGEMBKKK9TEIUCBCBYDJ1JJBGEABCIFC98gFGBbDJ1JJBDNDNABzBCZTGD9NMBCUHIABAD9rCffIFCZ4NBCUsMEKAEHIKAIK/lEEEUDNDNAEABvCIgtMBABHIXEKDNDNADCZ9PMBABHIXEKABHIINAIAEYDBbDBAICLFAECLFYDBbDBAICWFAECWFYDBbDBAICXFAECXFYDBbDBAICZFHIAECZFHEADC9wFGDCS0MBKKADCL6MBINAIAEYDBbDBAECLFHEAICLFHIADC98FGDCI0MBKKDNADtMBINAIAErBB86BBAICEFHIAECEFHEADCUFGDMBKKABK/AEEDUDNDNABCIgtMBABHIXEKAECfEgC+B+C+EW2HLDNDNADCZ9PMBABHIXEKABHIINAIALbDBAICXFALbDBAICWFALbDBAICLFALbDBAICZFHIADC9wFGDCS0MBKKADCL6MBINAIALbDBAICLFHIADC98FGDCI0MBKKDNADtMBINAIAE86BBAICEFHIADCUFGDMBKKABKKKEBCJWKLZ9kBB",WebAssembly.validate(t)&&(e="B9h79tEBBBE5V9gBB9gVUUUUUEU9gIUUUB9gDUUB9gEUEUIMXBBEBEEDIDIDLLVE9wEEEVIEBEOWEUEC+Q/aEKR/LEdO9tw9t9vv95DBh9f9f939h79t9f9j9h229f9jT9vv7BB8a9tw79o9v9wT9f9kw9j9v9kw9WwvTw949C919m9mwvBDy9tw79o9v9wT9f9kw9j9v9kw69u9kw949C919m9mwvBLe9tw79o9v9wT9f9kw9j9v9kw69u9kw949Twg91w9u9jwBVl9tw79o9v9wT9f9kw9j9v9kws9p2Twv9P9jTBOk9tw79o9v9wT9f9kw9j9v9kws9p2Twv9R919hTBWl9tw79o9v9wT9f9kw9j9v9kws9p2Twvt949wBQL79iv9rBKQ/j6XLBZIK9+EVU8jJJJJBCZ9rHBCBHEINCBHDCBHIINABCWFADFAICJUAEAD4CEgGLe86BBAIALFHIADCEFGDCW9HMBKAEC+Q+YJJBFAI86BBAECITC+Q1JJBFAB8pIW83IBAECEFGECJD9HMBKK1HLSUD97EUO978jJJJJBCJ/KB9rGV8kJJJJBC9+HODNADCEFAL0MBCUHOAIrBBC+gE9HMBAVAIALFGRAD9rAD/8QBBCJ/ABAD9uC/wfBgGOCJDAOCJD6eHWAICEFHOCBHdDNINAdAE9PMEAWAEAd9rAdAWFAE6eHQDNDNADtMBAQCSFGLC9wgGKCI2HXAKCETHMALCL4CIFCD4HpCBHSINAOHZCBHhDNINDNARAZ9rAp9PMBCBHOXVKAVCJ/CBFAhAK2FHoAZApFHOCBHIDNAKC/AB6MBARAO9rC/gB6MBCBHLINAoALFHIDNDNDNDNDNAZALCO4FrBBGaCIgpLBEDIBKAICBPhPKLBXIKAIAOPBBLAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlGcCDP+MEAcPMBZEhDoIaLcVxOqRlC+D+G+MkPhP9OGxCIPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLBAOCLFAlPqBFAqC+Q+YJJBFrBBFHOXDKAIAOPBBWAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlC+P+e+8/4BPhP9OGxCSPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLBAOCWFAlPqBFAqC+Q+YJJBFrBBFHOXEKAIAOPBBBPKLBAOCZFHOKDNDNDNDNDNAaCD4CIgpLBEDIBKAICBPhPKLZXIKAIAOPBBLAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlGcCDP+MEAcPMBZEhDoIaLcVxOqRlC+D+G+MkPhP9OGxCIPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLZAOCLFAlPqBFAqC+Q+YJJBFrBBFHOXDKAIAOPBBWAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlC+P+e+8/4BPhP9OGxCSPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLZAOCWFAlPqBFAqC+Q+YJJBFrBBFHOXEKAIAOPBBBPKLZAOCZFHOKDNDNDNDNDNAaCL4CIgpLBEDIBKAICBPhPKLAXIKAIAOPBBLAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlGcCDP+MEAcPMBZEhDoIaLcVxOqRlC+D+G+MkPhP9OGxCIPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLAAOCLFAlPqBFAqC+Q+YJJBFrBBFHOXDKAIAOPBBWAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlC+P+e+8/4BPhP9OGxCSPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLAAOCWFAlPqBFAqC+Q+YJJBFrBBFHOXEKAIAOPBBBPKLAAOCZFHOKDNDNDNDNDNAaCO4pLBEDIBKAICBPhPKL8wXIKAIAOPBBLAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlGcCDP+MEAcPMBZEhDoIaLcVxOqRlC+D+G+MkPhP9OGxCIPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGaCITC+Q1JJBFPBIBAaC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGaCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKL8wAOCLFAlPqBFAaC+Q+YJJBFrBBFHOXDKAIAOPBBWAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlC+P+e+8/4BPhP9OGxCSPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGaCITC+Q1JJBFPBIBAaC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGaCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKL8wAOCWFAlPqBFAaC+Q+YJJBFrBBFHOXEKAIAOPBBBPKL8wAOCZFHOKALC/ABFHIALCJEFAK0MEAIHLARAO9rC/fB0MBKKDNAIAK9PMBAICI4HLINDNARAO9rCk9PMBCBHOXRKAoAIFHaDNDNDNDNDNAZAICO4FrBBALCOg4CIgpLBEDIBKAaCBPhPKLBXIKAaAOPBBLAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlGcCDP+MEAcPMBZEhDoIaLcVxOqRlC+D+G+MkPhP9OGxCIPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLBAOCLFAlPqBFAqC+Q+YJJBFrBBFHOXDKAaAOPBBWAOPBBBGcCLP+MEAcPMBZEhDoIaLcVxOqRlC+P+e+8/4BPhP9OGxCSPSP8jGcP5B9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBAqC+Q+YJJBFPBBBGlAlPMBBBBBBBBBBBBBBBBAcP5E9CJf/8/4/w/g/AB9+9Cu1+nGqCITC+Q1JJBFPBIBP9uPMBEDILVORZhoacxqlPpAxAcP9SPKLBAOCWFAlPqBFAqC+Q+YJJBFrBBFHOXEKAaAOPBBBPKLBAOCZFHOKALCDFHLAICZFGIAK6MBKKDNAOtMBAOHZAhCEFGhCLsMDXEKKCBHOXIKDNAKtMBAVCJDFASFHIAVASFPBDBHlCBHaINAIAVCJ/CBFAaFGLPBLBGxCEP9tAxCEPSGcP9OP9hP9RGxALAKFPBLBGkCEP9tAkAcP9OP9hP9RGkPMBZEhDoIaLcVxOqRlGyALAMFPBLBG8aCEP9tA8aAcP9OP9hP9RG8aALAXFPBLBGeCEP9tAeAcP9OP9hP9RGePMBZEhDoIaLcVxOqRlG3PMBEZhDIoaLVcxORqlGcAcPMBEDIBEDIBEDIBEDIAlP9uGlPeBbDBAIADFGLAlAcAcPMLVORLVORLVORLVORP9uGlPeBbDBALADFGLAlAcAcPMWdQKWdQKWdQKWdQKP9uGlPeBbDBALADFGLAlAcAcPMXMpSXMpSXMpSXMpSP9uGlPeBbDBALADFGLAlAyA3PMWdkyQK8aeXM35pS8e8fGcAcPMBEDIBEDIBEDIBEDIP9uGlPeBbDBALADFGLAlAcAcPMLVORLVORLVORLVORP9uGlPeBbDBALADFGLAlAcAcPMWdQKWdQKWdQKWdQKP9uGlPeBbDBALADFGLAlAcAcPMXMpSXMpSXMpSXMpSP9uGlPeBbDBALADFGLAlAxAkPMWkdyQ8aKeX3M5p8eS8fGxA8aAePMWkdyQ8aKeX3M5p8eS8fGkPMBEZhDIoaLVcxORqlGcAcPMBEDIBEDIBEDIBEDIP9uGlPeBbDBALADFGLAlAcAcPMLVORLVORLVORLVORP9uGlPeBbDBALADFGLAlAcAcPMWdQKWdQKWdQKWdQKP9uGlPeBbDBALADFGLAlAcAcPMXMpSXMpSXMpSXMpSP9uGlPeBbDBALADFGLAlAxAkPMWdkyQK8aeXM35pS8e8fGcAcPMBEDIBEDIBEDIBEDIP9uGlPeBbDBALADFGLAlAcAcPMLVORLVORLVORLVORP9uGlPeBbDBALADFGLAlAcAcPMWdQKWdQKWdQKWdQKP9uGlPeBbDBALADFGLAlAcAcPMXMpSXMpSXMpSXMpSP9uGlPeBbDBALADFHIAaCZFGaAK6MBKKASCLFGSAD6MBKKABAdAD2FAVCJDFAQAD2/8QBBAVAVCJDFAQCUFAD2FAD/8QBBKAQCBAOeAdFHdAOMBKC9+HOXEKCBC99ARAO9rADCAADCA0eseHOKAVCJ/KBF8kJJJJBAOKWBZ+BJJJBK+KoEZU8jJJJJBC/AE9rGV8kJJJJBC9+HODNAECI9uGRChFAL0MBCUHOAIrBBGWC/wEgC/gE9HMBAWCSgGdCE0MBAVC/ABFCfECJE/8KBAVCuF9CU83IBAVC8wF9CU83IBAVCYF9CU83IBAVCAF9CU83IBAVCkF9CU83IBAVCZF9CU83IBAV9CU83IWAV9CU83IBAIALFC9wFHQAICEFGWARFHKDNAEtMBCMCSAdCEseHXABHICBHdCBHMCBHpCBHLCBHOINDNAKAQ9NMBC9+HOXIKDNDNAWrBBGRC/vE0MBAVC/ABFARCL4CU7AOFCSgCITFGSYDLHZASYDBHhDNARCSgGSAX9PMBAVARCU7ALFCSgCDTFYDBAdASeHRAStHSDNDNADCD9HMBABAh87EBABCLFAR87EBABCDFAZ87EBXEKAIAhbDBAICWFARbDBAICLFAZbDBKAdASFHdAVC/ABFAOCITFGoARbDBAoAZbDLAVALCDTFARbDBAVC/ABFAOCEFCSgGOCITFGZAhbDBAZARbDLALASFHLAOCEFHOXDKDNDNASCSsMBAMASFASC987FCEFHMXEKAK8sBBGSCfEgHRDNDNASCU9MMBAKCEFHKXEKAK8sBEGSCfBgCRTARCfBgvHRDNASCU9MMBAKCDFHKXEKAK8sBDGSCfBgCpTARvHRDNASCU9MMBAKCIFHKXEKAK8sBIGSCfBgCxTARvHRDNASCU9MMBAKCLFHKXEKAKrBLC3TARvHRAKCVFHKKARCE4CBARCEg9r7AMFHMKDNDNADCD9HMBABAh87EBABCLFAM87EBABCDFAZ87EBXEKAIAhbDBAICWFAMbDBAICLFAZbDBKAVC/ABFAOCITFGRAMbDBARAZbDLAVALCDTFAMbDBAVC/ABFAOCEFCSgGOCITFGRAhbDBARAMbDLALCEFHLAOCEFHOXEKDNARCPE0MBAVALAQARCSgFrBBGSCL4GZ9rCSgCDTFYDBAdCEFGhAZeHRAVALAS9rCSgCDTFYDBAhAZtGoFGhASCSgGZeHSAZtHZDNDNADCD9HMBABAd87EBABCLFAS87EBABCDFAR87EBXEKAIAdbDBAICWFASbDBAICLFARbDBKAVALCDTFAdbDBAVC/ABFAOCITFGaARbDBAaAdbDLAVALCEFGLCSgCDTFARbDBAVC/ABFAOCEFCSgCITFGaASbDBAaARbDLAVALAoFCSgGLCDTFASbDBAVC/ABFAOCDFCSgGOCITFGRAdbDBARASbDLAOCEFHOALAZFHLAhAZFHdXEKAdCBAKrBBGaeGZARC/+EsGcFHRAaCSgHhDNDNAaCL4GoMBARCEFHSXEKARHSAVALAo9rCSgCDTFYDBHRKDNDNAhMBASCEFHdXEKASHdAVALAa9rCSgCDTFYDBHSKDNDNActMBAKCEFHaXEKAK8sBEGaCfEgHZDNDNAaCU9MMBAKCDFHaXEKAK8sBDGaCfBgCRTAZCfBgvHZDNAaCU9MMBAKCIFHaXEKAK8sBIGaCfBgCpTAZvHZDNAaCU9MMBAKCLFHaXEKAK8sBLGaCfBgCxTAZvHZDNAaCU9MMBAKCVFHaXEKAKCOFHaAKrBVC3TAZvHZKAZCE4CBAZCEg9r7AMFGMHZKDNDNAoCSsMBAaHcXEKAa8sBBGKCfEgHRDNDNAKCU9MMBAaCEFHcXEKAa8sBEGKCfBgCRTARCfBgvHRDNAKCU9MMBAaCDFHcXEKAa8sBDGKCfBgCpTARvHRDNAKCU9MMBAaCIFHcXEKAa8sBIGKCfBgCxTARvHRDNAKCU9MMBAaCLFHcXEKAaCVFHcAarBLC3TARvHRKARCE4CBARCEg9r7AMFGMHRKDNDNAhCSsMBAcHKXEKAc8sBBGKCfEgHSDNDNAKCU9MMBAcCEFHKXEKAc8sBEGKCfBgCRTASCfBgvHSDNAKCU9MMBAcCDFHKXEKAc8sBDGKCfBgCpTASvHSDNAKCU9MMBAcCIFHKXEKAc8sBIGKCfBgCxTASvHSDNAKCU9MMBAcCLFHKXEKAcCVFHKAcrBLC3TASvHSKASCE4CBASCEg9r7AMFGMHSKDNDNADCD9HMBABAZ87EBABCLFAS87EBABCDFAR87EBXEKAIAZbDBAICWFASbDBAICLFARbDBKAVC/ABFAOCITFGaARbDBAaAZbDLAVALCDTFAZbDBAVC/ABFAOCEFCSgCITFGaASbDBAaARbDLAVALCEFGLCSgCDTFARbDBAVC/ABFAOCDFCSgCITFGRAZbDBARASbDLAVALAotAoCSsvFGLCSgCDTFASbDBALAhtAhCSsvFHLAOCIFHOKAWCEFHWABCOFHBAICXFHIAOCSgHOALCSgHLApCIFGpAE6MBKKCBC99AKAQseHOKAVC/AEF8kJJJJBAOK/tLEDU8jJJJJBCZ9rHVC9+HODNAECVFAL0MBCUHOAIrBBC/+EgC/QE9HMBAV9CB83IWAICEFHOAIALFC98FHIDNAEtMBDNADCDsMBINDNAOAI6MBC9+SKAO8sBBGDCfEgHLDNDNADCU9MMBAOCEFHOXEKAO8sBEGDCfBgCRTALCfBgvHLDNADCU9MMBAOCDFHOXEKAO8sBDGDCfBgCpTALvHLDNADCU9MMBAOCIFHOXEKAO8sBIGDCfBgCxTALvHLDNADCU9MMBAOCLFHOXEKAOrBLC3TALvHLAOCVFHOKAVCWFALCEgCDTvGDALCD4CBALCE4CEg9r7ADYDBFGLbDBABALbDBABCLFHBAECUFGEMBXDKKINDNAOAI6MBC9+SKAO8sBBGDCfEgHLDNDNADCU9MMBAOCEFHOXEKAO8sBEGDCfBgCRTALCfBgvHLDNADCU9MMBAOCDFHOXEKAO8sBDGDCfBgCpTALvHLDNADCU9MMBAOCIFHOXEKAO8sBIGDCfBgCxTALvHLDNADCU9MMBAOCLFHOXEKAOrBLC3TALvHLAOCVFHOKABALCD4CBALCE4CEg9r7AVCWFALCEgCDTvGLYDBFGD87EBALADbDBABCDFHBAECUFGEMBKKCBC99AOAIseHOKAOK/xVDIUO978jJJJJBCA9rGI8kJJJJBDNDNADCL9HMBDNAEC98gGLtMBABHDCBHVINADADPBBBGOCkP+rECkP+sEP/6EGRAOCWP+rECkP+sEP/6EARP/gEAOCZP+rECkP+sEP/6EGWP/gEP/kEP/lEGdCBPhP+2EGQARCJJJJ94PhGKP9OP9RP/kEGRjBB/+9CPaARARP/mEAdAdP/mEAWAQAWAKP9OP9RP/kEGRARP/mEP/kEP/kEP/jEP/nEGWP/mEjBBN0PaGQP/kECfEPhP9OAOCJJJ94PhP9OP9QARAWP/mEAQP/kECWP+rECJ/+IPhP9OP9QAdAWP/mEAQP/kECZP+rECJJ/8RPhP9OP9QPKBBADCZFHDAVCLFGVAL6MBKKALAE9PMEAIAECIgGVCDTGDvCBCZAD9r/8KBAIABALCDTFGLAD/8QBBDNAVtMBAIAIPBLBGOCkP+rECkP+sEP/6EGRAOCWP+rECkP+sEP/6EARP/gEAOCZP+rECkP+sEP/6EGWP/gEP/kEP/lEGdCBPhP+2EGQARCJJJJ94PhGKP9OP9RP/kEGRjBB/+9CPaARARP/mEAdAdP/mEAWAQAWAKP9OP9RP/kEGRARP/mEP/kEP/kEP/jEP/nEGWP/mEjBBN0PaGQP/kECfEPhP9OAOCJJJ94PhP9OP9QARAWP/mEAQP/kECWP+rECJ/+IPhP9OP9QAdAWP/mEAQP/kECZP+rECJJ/8RPhP9OP9QPKLBKALAIAD/8QBBXEKABAEC98gGDZ+HJJJBADAE9PMBAIAECIgGLCITGVFCBCAAV9r/8KBAIABADCITFGDAV/8QBBAIALZ+HJJJBADAIAV/8QBBKAICAF8kJJJJBK+yIDDUR97DNAEtMBCBHDINABCZFGIAIPBBBGLCBPhGVCJJ98P3ECJJ98P3IGOP9OABPBBBGRALPMLVORXMpScxql358e8fCffEPhP9OP/6EARALPMBEDIWdQKZhoaky8aeGLCZP+sEP/6EGWP/gEALCZP+rECZP+sEP/6EGdP/gEP/kEP/lEGLjB/+fsPaAdALAVP+2EGVAdCJJJJ94PhGQP9OP9RP/kEGdAdP/mEALALP/mEAWAVAWAQP9OP9RP/kEGLALP/mEP/kEP/kEP/jEP/nEGWP/mEjBBN0PaGVP/kECZP+rEAdAWP/mEAVP/kECffIPhP9OP9QGdALAWP/mEAVP/kECUPSCBPlDCBPlICBPlOCBPlRCBPlQCBPlKCBPlpCBPlSP9OGLPMWdkyQK8aeXM35pS8e8fP9QPKBBABARAOP9OAdALPMBEZhDIoaLVcxORqlP9QPKBBABCAFHBADCLFGDAE6MBKKK94EIU8jJJJJBCA9rGI8kJJJJBABAEC98gGLZ+JJJJBDNALAE9PMBAIAECIgGVCITGEFCBCAAE9r/8KBAIABALCITFGBAE/8QBBAIAVZ+JJJJBABAIAE/8QBBKAICAF8kJJJJBK/hILDUE97EUV978jJJJJBCZ9rHDDNAEtMBCBHIINADABPBBBGLABCZFGVPBBBGOPMLVORXMpScxql358e8fGRCZP+sEGWCLP+rEPKLBABjBBJzPaj/zL81zPaAWCIPhP9QP/6EP/nEGWALAOPMBEDIWdQKZhoaky8aeGLCZP+rECZP+sEP/6EP/mEGOAOP/mEAWALCZP+sEP/6EP/mEGdAdP/mEAWARCZP+rECZP+sEP/6EP/mEGRARP/mEP/kEP/kEP/lECBPhP+4EP/jEjB/+fsPaGWP/mEjBBN0PaGLP/kECffIPhGQP9OAdAWP/mEALP/kECZP+rEP9QGdARAWP/mEALP/kECZP+rEAOAWP/mEALP/kEAQP9OP9QGWPMBEZhDIoaLVcxORqlGLP5BADPBLBPeB+t+J83IBABCWFALP5EADPBLBPeE+t+J83IBAVAdAWPMWdkyQK8aeXM35pS8e8fGWP5BADPBLBPeD+t+J83IBABCkFAWP5EADPBLBPeI+t+J83IBABCAFHBAICLFGIAE6MBKKK/3EDIUE978jJJJJBC/AB9rHIDNADCD4AE2GLC98gGVtMBCBHDABHEINAEAEPBBBGOCWP+rECWP+sEP/6EAOCkP+sEClP+rECJJJ/8IPhP+uEP/mEPKBBAECZFHEADCLFGDAV6MBKKDNAVAL9PMBAIALCIgGDCDTGEvCBC/ABAE9r/8KBAIABAVCDTFGVAE/8QBBDNADtMBAIAIPBLBGOCWP+rECWP+sEP/6EAOCkP+sEClP+rECJJJ/8IPhP+uEP/mEPKLBKAVAIAE/8QBBKK9TEIUCBCBYDJ1JJBGEABCIFC98gFGBbDJ1JJBDNDNABzBCZTGD9NMBCUHIABAD9rCffIFCZ4NBCUsMEKAEHIKAIKKKEBCJWKLZ9tBB"),t=WebAssembly.instantiate(function(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;++i){var r=e.charCodeAt(i);t[i]=96<r?r-71:64<r?r-65:47<r?r+4:46<r?63:62}for(var n=0,i=0;i<e.length;++i)t[n++]=t[i]<60?D[t[i]]:64*(t[i]-60)+t[++i];return t.buffer.slice(0,n)}(e),{}).then(function(e){(h=e.instance).exports.__wasm_call_ctors()}),s={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},L={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},{ready:t,supported:!0,decodeVertexBuffer:function(e,t,i,r,n){a(h.exports.meshopt_decodeVertexBuffer,e,t,i,r,h.exports[s[n]])},decodeIndexBuffer:function(e,t,i,r){a(h.exports.meshopt_decodeIndexBuffer,e,t,i,r)},decodeIndexSequence:function(e,t,i,r){a(h.exports.meshopt_decodeIndexSequence,e,t,i,r)},decodeGltfBuffer:function(e,t,i,r,n,o){a(h.exports[L[n]],e,t,i,r,h.exports[s[o]])}});function F(){}F.s3tc=!0,F.pvrtc=!1,F.etc1=!1;const c={SV_Unkown:0,SV_Standard:1,SV_Compressed:2,SV_DracoCompressed:3},A={Standard:0,Draco:1,MeshOpt:2},q={0:Uint32Array.BYTES_PER_ELEMENT,1:Float32Array.BYTES_PER_ELEMENT,2:Float64Array.BYTES_PER_ELEMENT},N={LUMINANCE_8:1,LUMINANCE_16:2,ALPHA:3,ALPHA_4_LUMINANCE_4:4,LUMINANCE_ALPHA:5,RGB_565:6,BGR565:7,RGB:10,BGR:11,ARGB:12,ABGR:13,BGRA:14,WEBP:25,RGBA:28,DXT1:17,DXT2:18,DXT3:19,DXT4:20,DXT5:21,CRN_DXT5:26,STANDARD_CRN:27},f={SVC_Vertex:1,SVC_Normal:2,SVC_VertexColor:4,SVC_SecondColor:8,SVC_TexutreCoord:16,SVC_TexutreCoordIsW:32},I={Invalid:0,Position:1,PositionW:2,Normal:4,Tangent:8,FirstTexcoord:16,SecondTexcoord:32,Color:64,SecondColor:128,Custom0:512,Custom1:1024};function K(e,t,i){i=e.byteLength;return e=e.subarray(0,0+i),new TextDecoder("utf-8").decode(e)}function O(e,t,i){t=t.getUint32(i,!0),i+=Uint32Array.BYTES_PER_ELEMENT,e=new Uint8Array(e,i,t);return{string:K(e),bytesOffset:i+=t,length:t}}function j(t,i,r,e,n){var o={},s=(o.rangeList=i.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,o.rangeMode=i.getUint16(r,!0),r+=Uint16Array.BYTES_PER_ELEMENT,{}),a=(s.x=i.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,s.y=i.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,s.z=i.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,i.getFloat64(r,!0)),a=(r+=Float64Array.BYTES_PER_ELEMENT,o.boundingSphere={center:s,radius:a},3===n&&((s={}).x=i.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,s.y=i.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,s.z=i.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,(a={}).x=i.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,a.y=i.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,a.z=i.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,(c={}).x=i.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,c.y=i.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,c.z=i.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,(u={}).x=i.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,u.y=i.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,u.z=i.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,o.obb={xExtent:a,yExtent:c,zExtent:u,obbCenter:s}),O(t,i,r));let l=a.string;r=a.bytesOffset;var u,c=l.indexOf("Geometry"),h=(-1!==c&&(u=l.substring(c),l=l.replace(u,"")),o.childTile=l,o.geodes=[],i.getUint32(r,!0));r+=Uint32Array.BYTES_PER_ELEMENT;for(let e=0;e<h;e++)r=function(t,i,r,e){var n={},o=[],s=new Array(16);for(let e=0;e<16;e++)s[e]=i.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT;n.matrix=s,n.skeletonNames=o;var a=i.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let e=0;e<a;e++){var l=O(t,i,r);o.push(l.string),r=l.bytesOffset}return e.push(n),r}(t,i,r,o.geodes);return e.push(o),r=3===n?O(t,i,r).bytesOffset:r}function Z(e,t,i,r){var n,o=t.getUint32(i,!0);return r.verticesCount=o,(i+=Uint32Array.BYTES_PER_ELEMENT)<=0||(n=t.getUint16(i,!0),i+=Uint16Array.BYTES_PER_ELEMENT,t=t.getUint16(i,!0),t=n*Float32Array.BYTES_PER_ELEMENT,i+=Uint16Array.BYTES_PER_ELEMENT,o=o*n*Float32Array.BYTES_PER_ELEMENT,e=new Uint8Array(e,i,o),i+=o,o=r.vertexAttributes,(r=r.attrLocation).aPosition=o.length,o.push({index:r.aPosition,typedArray:e,componentsPerAttribute:n,componentDatatype:5126,offsetInBytes:0,strideInBytes:t,normalize:!1})),i}function Y(e,t,i,r){var n,o=t.getUint32(i,!0);return i+=Uint32Array.BYTES_PER_ELEMENT,o<=0||(n=t.getUint16(i,!0),i+=Uint16Array.BYTES_PER_ELEMENT,t=t.getUint16(i,!0),i+=Uint16Array.BYTES_PER_ELEMENT,o=o*n*Float32Array.BYTES_PER_ELEMENT,e=new Uint8Array(e,i,o),i+=o,o=r.vertexAttributes,(r=r.attrLocation).aNormal=o.length,o.push({index:r.aNormal,typedArray:e,componentsPerAttribute:n,componentDatatype:5126,offsetInBytes:0,strideInBytes:t,normalize:!1})),i}function X(e,t,i,r){var n=t.getUint32(i,!0),o=(i+=Uint32Array.BYTES_PER_ELEMENT,r.verticesCount);let s;if(0<n){t.getUint16(i,!0);i=(i+=Uint16Array.BYTES_PER_ELEMENT)+2*Uint8Array.BYTES_PER_ELEMENT;t=n*Uint8Array.BYTES_PER_ELEMENT*4,n=new Uint8Array(e,i,t);s=n.slice(0,t),i+=t}else{s=new Uint8Array(4*o);for(let e=0;e<o;e++)s[4*e]=255,s[4*e+1]=255,s[4*e+2]=255,s[4*e+3]=255}e=r.vertexAttributes,n=r.attrLocation;return n.aColor=e.length,e.push({index:n.aColor,typedArray:s,componentsPerAttribute:4,componentDatatype:5121,offsetInBytes:0,strideInBytes:4,normalize:!0}),r.vertexColor=s,i}function J(e,t,i,r){var n=t.getUint32(i,!0);return i+=Uint32Array.BYTES_PER_ELEMENT,n<=0||(t.getUint16(i,!0),i=(i+=Uint16Array.BYTES_PER_ELEMENT)+2*Uint8Array.BYTES_PER_ELEMENT,t=n*Uint8Array.BYTES_PER_ELEMENT*4,n=new Uint8Array(e,i,t),i+=t,e=r.vertexAttributes,(t=r.attrLocation).aSecondColor=e.length,e.push({index:t.aSecondColor,typedArray:n,componentsPerAttribute:4,componentDatatype:5121,offsetInBytes:0,strideInBytes:4,normalize:!0})),i}function $(t,i,r,n){var o=i.getUint16(r,!0);r=(r+=Uint16Array.BYTES_PER_ELEMENT)+Uint16Array.BYTES_PER_ELEMENT;for(let e=0;e<o;e++){var s=i.getUint32(r,!0),a=(r+=Uint32Array.BYTES_PER_ELEMENT,i.getUint16(r,!0)),s=(r+=Uint16Array.BYTES_PER_ELEMENT,i.getUint16(r,!0),r+=Uint16Array.BYTES_PER_ELEMENT,s*a*Float32Array.BYTES_PER_ELEMENT),l=new Uint8Array(t,r,s),s=(r+=s,"aTexCoord"+e),u=n.vertexAttributes,c=n.attrLocation;c[s]=u.length,u.push({index:c[s],typedArray:l,componentsPerAttribute:a,componentDatatype:5126,offsetInBytes:0,strideInBytes:a*Float32Array.BYTES_PER_ELEMENT,normalize:!1})}return r}function ee(t,i,r,n){var o=i.getUint16(r,!0),s=(r=(r+=Uint16Array.BYTES_PER_ELEMENT)+Uint16Array.BYTES_PER_ELEMENT,n.vertexAttributes),a=n.attrLocation;for(let e=0;e<o;e++){var l=i.getUint32(r,!0),u=(r+=Uint32Array.BYTES_PER_ELEMENT,i.getUint16(r,!0)),c=(r+=Uint16Array.BYTES_PER_ELEMENT,i.getUint16(r,!0),r+=Uint16Array.BYTES_PER_ELEMENT,l*u*Float32Array.BYTES_PER_ELEMENT);if(17===u||29===u){var h=new Uint8Array(t,r,c),A=(n.instanceCount=l,n.instanceMode=u,n.instanceBuffer=h,n.instanceIndex=1,u*l*4),h=h.slice(0,A);n.vertexColorInstance=h;let e;17===u?(e=17*Float32Array.BYTES_PER_ELEMENT,a.uv2=s.length,s.push({index:a.uv2,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:0,strideInBytes:e,instanceDivisor:1}),a.uv3=s.length,s.push({index:a.uv3,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:e,instanceDivisor:1}),a.uv4=s.length,s.push({index:a.uv4,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:e,instanceDivisor:1}),a.secondary_colour=s.length,s.push({index:a.secondary_colour,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:e,instanceDivisor:1}),a.uv6=s.length,s.push({index:a.uv6,componentsPerAttribute:4,componentDatatype:5121,normalize:!0,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:e,instanceDivisor:1})):29===u&&(e=29*Float32Array.BYTES_PER_ELEMENT,a.uv1=s.length,s.push({index:a.uv1,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:0,strideInBytes:e,instanceDivisor:1,byteLength:c}),a.uv2=s.length,s.push({index:a.uv2,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:e,instanceDivisor:1}),a.uv3=s.length,s.push({index:a.uv3,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:e,instanceDivisor:1}),a.uv4=s.length,s.push({index:a.uv4,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:e,instanceDivisor:1}),a.uv5=s.length,s.push({index:a.uv5,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:e,instanceDivisor:1}),a.uv6=s.length,s.push({index:a.uv6,componentsPerAttribute:4,componentDatatype:5126,normalize:!1,offsetInBytes:20*Float32Array.BYTES_PER_ELEMENT,strideInBytes:e,instanceDivisor:1}),a.uv7=s.length,s.push({index:a.uv7,componentsPerAttribute:3,componentDatatype:5126,normalize:!1,offsetInBytes:24*Float32Array.BYTES_PER_ELEMENT,strideInBytes:e,instanceDivisor:1}),a.secondary_colour=s.length,s.push({index:a.secondary_colour,componentsPerAttribute:4,componentDatatype:5121,normalize:!0,offsetInBytes:27*Float32Array.BYTES_PER_ELEMENT,strideInBytes:e,instanceDivisor:1}),a.uv9=s.length,s.push({index:a.uv9,componentsPerAttribute:4,componentDatatype:5121,normalize:!0,offsetInBytes:28*Float32Array.BYTES_PER_ELEMENT,strideInBytes:e,instanceDivisor:1}))}else{var p=l*u;n.instanceBounds=new Float32Array(p);for(let e=0;e<p;e++)n.instanceBounds[e]=i.getFloat32(r+e*Float32Array.BYTES_PER_ELEMENT,!0)}r+=c}return r}function te(t,i,r,n,o){if(3===o&&(i.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT),r=Z(t,i,r,n),r=Y(t,i,r,n),r=X(t,i,r,n),3!==o&&(r=J(t,i,r,n)),r=$(t,i,r,n),r=ee(t,i,r,n),3===o){r=function(t,i,r,n){var o=i.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let e=0;e<o;e++){var s=i.getUint32(r,!0),a=(r+=Uint32Array.BYTES_PER_ELEMENT,i.getUint16(r,!0)),l=(r+=Uint16Array.BYTES_PER_ELEMENT,i.getUint16(r,!0)),s=(r+=Uint16Array.BYTES_PER_ELEMENT,s*a*q[l]),l=new Uint8Array(t,r,s),s=(r+=s,n.vertexAttributes),u=n.attrLocation,c="aCustom"+e;u[c]=s.length,s.push({index:u[c],typedArray:l,componentsPerAttribute:a,componentDatatype:5126,offsetInBytes:0,strideInBytes:0,normalize:!1})}return r}(t,i,r,n);var o=O(t,i,r),t=(r=o.bytesOffset,n.customVertexAttribute=JSON.parse(o.string),"aCustom"+n.customVertexAttribute.TextureCoordMatrix),o="aCustom"+n.customVertexAttribute.VertexWeight;void 0!==n.attrLocation[t]&&(n.attrLocation.aTextureCoordMatrix=n.attrLocation[t],delete n.attrLocation[t]),void 0!==n.attrLocation[o]&&(n.attrLocation.aVertexWeight=n.attrLocation[o],delete n.attrLocation[o]);let e=r%4;r+=e=e&&4-e,t=r,o=(n=i).getUint32(t,!0),t+=Uint32Array.BYTES_PER_ELEMENT,o<=0||(i=n.getUint16(t,!0),t+=Uint16Array.BYTES_PER_ELEMENT,n.getUint16(t,!0),t=(t+=Uint16Array.BYTES_PER_ELEMENT)+o*i*Float32Array.BYTES_PER_ELEMENT),r=t}return r}function ie(i,r,n,s){var a=r.getUint32(n,!0),o=(n+=Uint32Array.BYTES_PER_ELEMENT,s.compressOptions=a,r.getUint32(n,!0));n+=Uint32Array.BYTES_PER_ELEMENT,s.minVerticesValue={x:0,y:0,z:0,w:0},s.minTexCoordValue=[{x:0,y:0},{x:0,y:0}],s.texCoordCompressConstant=[{x:0,y:0,z:0},{x:0,y:0,z:0}];for(let t=0;t<o;t++){var l=r.getUint32(n,!0),u=(n+=Uint32Array.BYTES_PER_ELEMENT,s.vertCompressConstant=r.getFloat32(n,!0),n+=Float32Array.BYTES_PER_ELEMENT,s.minVerticesValue.x=r.getFloat64(n,!0),n+=Float64Array.BYTES_PER_ELEMENT,s.minVerticesValue.y=r.getFloat64(n,!0),n+=Float64Array.BYTES_PER_ELEMENT,s.minVerticesValue.z=r.getFloat64(n,!0),n+=Float64Array.BYTES_PER_ELEMENT,r.getFloat64(n,!0)),c=(n+=Float64Array.BYTES_PER_ELEMENT,r.getFloat64(n,!0)),h=(n+=Float64Array.BYTES_PER_ELEMENT,r.getFloat64(n,!0)),A=(n+=Float64Array.BYTES_PER_ELEMENT,r.getFloat64(n,!0)),p=(n+=Float64Array.BYTES_PER_ELEMENT,r.getFloat64(n,!0)),f=(n+=Float64Array.BYTES_PER_ELEMENT,r.getFloat64(n,!0)),d=(n+=Float64Array.BYTES_PER_ELEMENT,r.getFloat64(n,!0)),g=(n+=Float64Array.BYTES_PER_ELEMENT,r.getFloat64(n,!0)),m=(n+=Float64Array.BYTES_PER_ELEMENT,s.minTexCoordValue[0].x=h,s.minTexCoordValue[0].y=A,s.minTexCoordValue[1].x=d,s.minTexCoordValue[1].y=g,s.texCoordCompressConstant[0].x=u,s.texCoordCompressConstant[0].y=c,s.texCoordCompressConstant[1].x=p,s.texCoordCompressConstant[1].y=f,r.getInt32(n,!0));n+=Int32Array.BYTES_PER_ELEMENT;for(let e=0;e<m;e++){var y=r.getInt32(n,!0);n+=Int32Array.BYTES_PER_ELEMENT;let o=0;y!==I.Custom0&&y!==I.Custom1||(o=r.getInt32(n,!0),n+=Int32Array.BYTES_PER_ELEMENT);var _=r.getInt32(n,!0),v=(n+=Int32Array.BYTES_PER_ELEMENT,new Uint8Array(i,n,_));let e=(n+=Uint8Array.BYTES_PER_ELEMENT*_)%4;n+=e=e&&4-e;{C=void 0;w=void 0;x=void 0;_=void 0;b=void 0;E=void 0;B=void 0;M=void 0;var C=l;var w=y;var x=o;_=v;var b=s;var E=a;let e=0,t;var B=b.vertexAttributes,M=b.attrLocation;switch(w){case I.Normal:case I.FirstTexcoord:case I.SecondTexcoord:e=2*Uint16Array.BYTES_PER_ELEMENT,0!=(16&E)||w!==I.FirstTexcoord&&w!==I.SecondTexcoord||(e=2*Float32Array.BYTES_PER_ELEMENT),t=new Uint8Array(C*e);break;case I.Color:case I.SecondColor:e=4*Uint8Array.BYTES_PER_ELEMENT,t=new Uint8Array(4*C);break;case I.Custom0:case I.Custom1:e=Float32Array.BYTES_PER_ELEMENT*x,t=new Uint8Array(C*x*4);break;default:e=4*Uint16Array.BYTES_PER_ELEMENT,t=new Uint8Array(C*e)}W.decodeVertexBuffer(t,C,e,_,_.length);let i,r,n;switch(w){case I.Position:M.aPosition=B.length,B.push({index:M.aPosition,typedArray:new Uint16Array(t.buffer,0,t.length/2),componentsPerAttribute:4,componentDatatype:5122,offsetInBytes:0,strideInBytes:0,normalize:!1}),b.verticesCount=C;break;case I.Normal:M.aNormal=B.length,B.push({index:M.aNormal,typedArray:new Int16Array(t.buffer,0,t.length/2),componentsPerAttribute:2,componentDatatype:5122,offsetInBytes:0,strideInBytes:0,normalize:!1});break;case I.FirstTexcoord:i=0==(16&E)?(n=5126,new(r=Float32Array)(t.buffer,0,t.length/4)):(n=5122,new(r=Uint16Array)(t.buffer,0,t.length/2)),M.aTexCoord0=B.length,B.push({index:M.aTexCoord0,typedArray:i,componentsPerAttribute:2,componentDatatype:n,offsetInBytes:0,strideInBytes:0,normalize:!1});break;case I.SecondTexcoord:i=0==(16&E)?(n=5126,new(r=Float32Array)(t.buffer,0,t.length/4)):(n=5122,new(r=Uint16Array)(t.buffer,0,t.length/2)),M.aTexCoord1=B.length,B.push({index:M.aTexCoord1,typedArray:i,componentsPerAttribute:2,componentDatatype:n,offsetInBytes:0,strideInBytes:0,normalize:!1});break;case I.Color:M.aColor=B.length,B.push({index:M.aColor,typedArray:t,componentsPerAttribute:4,componentDatatype:5121,offsetInBytes:0,strideInBytes:0,normalize:!0});break;case I.SecondColor:M.aSecondColor=B.length,B.push({index:M.aSecondColor,typedArray:t,componentsPerAttribute:4,componentDatatype:5120,offsetInBytes:0,strideInBytes:0,normalize:!1});break;case I.Custom0:M.aCustom0=B.length,B.push({index:M.aCustom0,typedArray:new Float32Array(t.buffer,0,t.length/4),componentsPerAttribute:x,componentDatatype:5126,offsetInBytes:0,strideInBytes:0,normalize:!1});break;case I.Custom1:M.aCustom1=B.length,B.push({index:M.aCustom1,typedArray:new Float32Array(t.buffer,0,t.length/4),componentsPerAttribute:x,componentDatatype:5126,offsetInBytes:0,strideInBytes:0,normalize:!1})}}}h=O(i,r,n),A=(n=h.bytesOffset,s.customVertexAttribute=JSON.parse(h.string),"aCustom"+s.customVertexAttribute.TextureCoordMatrix),d="aCustom"+s.customVertexAttribute.VertexWeight;void 0!==s.attrLocation[A]&&(s.attrLocation.aTextureCoordMatrix=s.attrLocation[A],t===o-1)&&delete s.attrLocation[A],void 0!==s.attrLocation[d]&&(s.attrLocation.aVertexWeight=s.attrLocation[d],t===o-1)&&delete s.attrLocation[d];let e=n%4;n+=e=e&&4-e}return n}function re(e,t,i,r){var n,o,s,a,l,u,c,h,A,p=t.getUint32(i,!0);return r.compressOptions=p,i+=Uint32Array.BYTES_PER_ELEMENT,i=(p&f.SVC_Vertex)===f.SVC_Vertex?(l=e,n=i,h=r,A=(c=t).getUint32(n,!0),h.verticesCount=A,(n+=Uint32Array.BYTES_PER_ELEMENT)<=0||(o=c.getUint16(n,!0),n+=Uint16Array.BYTES_PER_ELEMENT,s=c.getUint16(n,!0),s=o*Int16Array.BYTES_PER_ELEMENT,n+=Uint16Array.BYTES_PER_ELEMENT,a=c.getFloat32(n,!0),n+=Float32Array.BYTES_PER_ELEMENT,(u={}).x=c.getFloat32(n,!0),n+=Float32Array.BYTES_PER_ELEMENT,u.y=c.getFloat32(n,!0),n+=Float32Array.BYTES_PER_ELEMENT,u.z=c.getFloat32(n,!0),n+=Float32Array.BYTES_PER_ELEMENT,u.w=c.getFloat32(n,!0),n+=Float32Array.BYTES_PER_ELEMENT,h.vertCompressConstant=a,h.minVerticesValue=u,c=A*o*Int16Array.BYTES_PER_ELEMENT,a=new Uint8Array(l,n,c),n+=c,u=h.vertexAttributes,(A=h.attrLocation).aPosition=u.length,u.push({index:A.aPosition,typedArray:a,componentsPerAttribute:o,componentDatatype:5122,offsetInBytes:0,strideInBytes:s,normalize:!1})),n):Z(e,t,i,r),i=(p&f.SVC_Normal)===f.SVC_Normal?(l=e,c=i,h=r,A=(u=t).getUint32(c,!0),c+=Uint32Array.BYTES_PER_ELEMENT,A<=0||(u.getUint16(c,!0),c+=Uint16Array.BYTES_PER_ELEMENT,u=u.getUint16(c,!0),c+=Uint16Array.BYTES_PER_ELEMENT,A=2*A*Int16Array.BYTES_PER_ELEMENT,l=new Uint8Array(l,c,A),c+=A,A=h.vertexAttributes,(h=h.attrLocation).aNormal=A.length,A.push({index:h.aNormal,typedArray:l,componentsPerAttribute:2,componentDatatype:5122,offsetInBytes:0,strideInBytes:u,normalize:!1})),c):Y(e,t,i,r),i=X(e,t,i,r),i=J(e,t,i,r),i=((p&f.SVC_TexutreCoord)===f.SVC_TexutreCoord?function(t,i,r,n){n.texCoordCompressConstant=[],n.minTexCoordValue=[];var o=i.getUint16(r,!0);r=(r+=Uint16Array.BYTES_PER_ELEMENT)+Uint16Array.BYTES_PER_ELEMENT;for(let e=0;e<o;e++){var s=i.getUint8(r,!0),a=(r=(r+=Uint8Array.BYTES_PER_ELEMENT)+3*Uint8Array.BYTES_PER_ELEMENT,i.getUint32(r,!0)),l=(r+=Uint32Array.BYTES_PER_ELEMENT,i.getUint16(r,!0)),u=(r+=Uint16Array.BYTES_PER_ELEMENT,i.getUint16(r,!0),r+=Uint16Array.BYTES_PER_ELEMENT,i.getFloat32(r,!0)),u=(r+=Float32Array.BYTES_PER_ELEMENT,n.texCoordCompressConstant.push(u),{}),u=(u.x=i.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,u.y=i.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,u.z=i.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,u.w=i.getFloat32(r,!0),r+=Float32Array.BYTES_PER_ELEMENT,n.minTexCoordValue.push(u),a*l*Int16Array.BYTES_PER_ELEMENT),c=new Uint8Array(t,r,u),h=(r+=u)%4,h=(0!=h&&(r+=4-h),"aTexCoord"+e),A=n.vertexAttributes,p=n.attrLocation;p[h]=A.length,A.push({index:p[h],typedArray:c,componentsPerAttribute:l,componentDatatype:5122,offsetInBytes:0,strideInBytes:l*Int16Array.BYTES_PER_ELEMENT,normalize:!1}),s&&(u=a*Float32Array.BYTES_PER_ELEMENT,c=new Uint8Array(t,r,u),r+=u,n.texCoordZMatrix=!0,p[h="aTexCoordZ"+e]=A.length,A.push({index:p[h],typedArray:c,componentsPerAttribute:1,componentDatatype:5126,offsetInBytes:0,strideInBytes:Float32Array.BYTES_PER_ELEMENT,normalize:!1}))}return r}:$)(e,t,i,r),(p&f.SVC_TexutreCoordIsW)===f.SVC_TexutreCoordIsW&&(r.textureCoordIsW=!0),i=ee(e,t,i,r)}function ne(i,r,n,o,s){r.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;var t=r.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;for(let e=0;e<t;e++){3===s&&(r.getUint32(n,!0),n+=Uint32Array.BYTES_PER_ELEMENT);var a=O(i,r,n),l=a.string,a=(n=a.bytesOffset,a.length%4);0!=a&&(n+=4-a);let e=r.getUint32(n,!0);if(n+=Int32Array.BYTES_PER_ELEMENT,3===s)switch(e){case A.Standard:e=c.SV_Standard;break;case A.Draco:e=c.SV_DracoCompressed;break;case A.MeshOpt:e=c.SV_Compressed}var a={vertexAttributes:[],attrLocation:{},instanceCount:0,instanceMode:0,instanceIndex:-1},u=(e===c.SV_Standard?n=te(i,r,n,a,s):e===c.SV_Compressed&&3===s?n=ie(i,r,n,a):e===c.SV_Compressed&&(n=re(i,r,n,a)),[]);n=e===c.SV_Compressed&&3===s?function(r,n,o,s){var t=n.getInt32(o,!0);o+=Int32Array.BYTES_PER_ELEMENT;for(let e=0;e<t;e++){var a={},l=n.getInt32(o,!0);if(o+=Int32Array.BYTES_PER_ELEMENT,!(l<1)){var u=n.getInt8(o,!0),c=(o+=Int8Array.BYTES_PER_ELEMENT,n.getInt8(o,!0),o+=Int8Array.BYTES_PER_ELEMENT,n.getInt8(o,!0)),h=(o+=Int8Array.BYTES_PER_ELEMENT,n.getInt8(o,!0),o+=Int8Array.BYTES_PER_ELEMENT,n.getInt32(o,!0));o+=Int32Array.BYTES_PER_ELEMENT;let e,t=(13!==c?(e=new Uint8Array(r,o,h),o+=Uint8Array.BYTES_PER_ELEMENT*h):(e=new Uint32Array(r,o,h),o+=Uint32Array.BYTES_PER_ELEMENT*h),o%4);o+=t=t&&4-t;let i;13!==c?(i=new Uint8Array(l*Uint32Array.BYTES_PER_ELEMENT),W.decodeIndexBuffer(i,l,Uint32Array.BYTES_PER_ELEMENT,e)):i=e;var A=n.getInt32(o,!0),h=(o+=Int32Array.BYTES_PER_ELEMENT,new(0===(a.indexType=u)?Uint16Array:Uint32Array)(l)),u=(a.indicesCount=l,new Uint32Array(i.buffer,i.byteOffset,i.byteLength/4));h.set(u,0),a.indicesTypedArray=h,a.primitiveType=c;for(let e=0;e<A;e++){var p=O(r,n,o);o=p.bytesOffset,a.materialCode=p.string}s.push(a),o+=t=(t=o%4)&&4-t}}return o}(i,r,n,u):function(i,t,r,n,o){var s=t.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let e=0;e<s;e++){var a={},l=(3===o&&(t.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT),t.getUint32(r,!0)),u=(r+=Uint32Array.BYTES_PER_ELEMENT,t.getUint8(r,!0)),c=(r+=Uint8Array.BYTES_PER_ELEMENT,t.getUint8(r,!0),r+=Uint8Array.BYTES_PER_ELEMENT,t.getUint8(r,!0));if(r=(r+=Uint8Array.BYTES_PER_ELEMENT)+Uint8Array.BYTES_PER_ELEMENT,0<l){let e=null,t;1===u||3===u?(t=l*Uint32Array.BYTES_PER_ELEMENT,e=new Uint8Array(i,r,t)):(t=l*Uint16Array.BYTES_PER_ELEMENT,e=new Uint8Array(i,r,t),l%2!=0&&(t+=2)),a.indicesTypedArray=e,r+=t}a.indicesCount=l,a.indexType=u,a.primitiveType=c;var h=[],A=t.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(let e=0;e<A;e++){var p=O(i,t,r),f=p.string;r=p.bytesOffset,h.push(f),a.materialCode=f}0!=r%4&&(r+=4-r%4),n.push(a)}return r}(i,r,n,u,s);let t=void 0;2===u.length&&13===u[1].primitiveType&&3<=u[1].indicesCount&&(t=S3MEdgeProcessor.createEdgeDataByIndices(a,u[1])),o[l]={vertexPackage:a,arrIndexPackage:u,edgeGeometry:t},3===s&&(0,r.getFloat64(n,!0),n+=Float64Array.BYTES_PER_ELEMENT,r.getFloat64(n,!0),n+=Float64Array.BYTES_PER_ELEMENT,r.getFloat64(n,!0),n+=Float64Array.BYTES_PER_ELEMENT,0,r.getFloat64(n,!0),n+=Float64Array.BYTES_PER_ELEMENT,r.getFloat64(n,!0),n+=Float64Array.BYTES_PER_ELEMENT,r.getFloat64(n,!0),n+=Float64Array.BYTES_PER_ELEMENT,0,r.getFloat64(n,!0),n+=Float64Array.BYTES_PER_ELEMENT,r.getFloat64(n,!0),n+=Float64Array.BYTES_PER_ELEMENT,r.getFloat64(n,!0),n+=Float64Array.BYTES_PER_ELEMENT,0,r.getFloat64(n,!0),n+=Float64Array.BYTES_PER_ELEMENT,r.getFloat64(n,!0),n+=Float64Array.BYTES_PER_ELEMENT,r.getFloat64(n,!0),n+=Float64Array.BYTES_PER_ELEMENT)}return n=3!==s?(n+=r.getUint32(n,!0))+Uint32Array.BYTES_PER_ELEMENT:n}let R={red:0,green:0,blue:0,alpha:0};function oe(e,t,i){var r=e.vertexAttributes,e=e.attrLocation,n=r.length;e[1===i?"instanceId":"batchId"]=n,r.push({index:n,typedArray:t,componentsPerAttribute:1,componentDatatype:5126,offsetInBytes:0,strideInBytes:0,instanceDivisor:i})}F.parseBuffer=function(e){let t=0;var i={version:void 0,groupNode:void 0,geoPackage:{},matrials:void 0,texturePackage:{}};let r=new DataView(e);i.version=r.getFloat32(t,!0),t+=Float32Array.BYTES_PER_ELEMENT,2<=i.version&&(r.getUint32(t,!0),t+=Uint32Array.BYTES_PER_ELEMENT);3<=i.version&&(r.getUint32(t,!0),t+=Uint32Array.BYTES_PER_ELEMENT),r.getUint32(t,!0);t+=Uint32Array.BYTES_PER_ELEMENT,n=e,a=t,n=new Uint8Array(e,a);var n,o,s,e=U.inflate(n).buffer,a=(r=new DataView(e),t=0,r.getUint32(t,!0)),l=(t+=Uint32Array.BYTES_PER_ELEMENT,t=function(t,i,r,n){var e={},o=[],s=(i.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT,i.getUint32(r,!0));r+=Uint32Array.BYTES_PER_ELEMENT;for(let e=0;e<s;e++)r=j(t,i,r,o,n.version);e.pageLods=o;var a=r%4;return 0!=a&&(r+=4-a),n.groupNode=e,r}(e,r,t,i),t=ne(e,r,t,i.geoPackage,i.version),t=function(r,n,o,s){n.getUint32(o,!0),o+=Uint32Array.BYTES_PER_ELEMENT;var t=n.getUint32(o,!0);o+=Uint32Array.BYTES_PER_ELEMENT;for(let e=0;e<t;e++){var a=O(r,n,o),l=a.string,a=(o=a.bytesOffset,a.length%4),a=(0!=a&&(o+=4-a),n.getUint32(o,!0),o+=Uint32Array.BYTES_PER_ELEMENT,n.getUint32(o,!0)),u=(o+=Uint32Array.BYTES_PER_ELEMENT,n.getUint32(o,!0));o+=Uint32Array.BYTES_PER_ELEMENT;let e=n.getUint32(o,!0);o+=Uint32Array.BYTES_PER_ELEMENT;var c=n.getUint32(o,!0),h=(o+=Uint32Array.BYTES_PER_ELEMENT,n.getUint32(o,!0));o+=Uint32Array.BYTES_PER_ELEMENT;let t=new Uint8Array(r,o,c),i=(o+=c,h===N.RGB||h===N.BGR?33776:33779);22===e&&(i=36196),F.s3tc||33776!==i&&33779!==i||(c=new Uint8Array(a*u*4),z.decode(c,a,u,t,h),t=c,e=0,i=h===N.RGB||h===N.RGB?273:4369),s[l]={id:l,width:a,height:u,compressType:e,nFormat:h,internalFormat:i,arrayBufferView:t}}return o}(e,r,t,i.texturePackage),t=(n=e,h=r,o=t,s=i,h=h.getUint32(o,!0),o+=Uint32Array.BYTES_PER_ELEMENT,n=K(n=new Uint8Array(n,o,h)),o+=h,s.materials=JSON.parse(n),o),e),u=r,c=t,h=a,A=i.geoPackage,p=i.version;if(3===p&&(h=u.getUint32(c,!0),c+=Uint32Array.BYTES_PER_ELEMENT),1==(1&h)){u.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;var f=u.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;for(let e=0;e<f;e++){var d=O(l,u,c),g=d.string,m=(c=d.bytesOffset,u.getUint32(c,!0)),y=(c+=Uint32Array.BYTES_PER_ELEMENT,{}),d=(A[g].pickInfo=y,A[g].vertexPackage.instanceIndex);if(-1==d){var _=new Float32Array(A[g].vertexPackage.verticesCount);for(let t=0;t<m;t++){var v=u.getUint32(c,!0),C=(c+=Uint32Array.BYTES_PER_ELEMENT,u.getUint32(c,!0)),w=(c+=Uint32Array.BYTES_PER_ELEMENT,[]);for(let e=0;e<C;e++){var x=u.getUint32(c,!0),b=(c+=Uint32Array.BYTES_PER_ELEMENT,u.getUint32(c,!0));c+=Uint32Array.BYTES_PER_ELEMENT,_.fill(t,x,x+b),w.push({vertexColorOffset:x,vertexColorCount:b,batchId:t})}y[v]=w}oe(A[g].vertexPackage,_,void 0)}else{var E=A[g].vertexPackage.instanceCount,B=A[g].vertexPackage.instanceBuffer,M=A[g].vertexPackage.instanceMode,I=new Float32Array(E),S=[];for(let e=0;e<m;e++){var P=u.getUint32(c,!0),T=(S.push(P),c+=Uint32Array.BYTES_PER_ELEMENT,u.getUint32(c,!0));c+=Uint32Array.BYTES_PER_ELEMENT;for(let e=0;e<T;e++){u.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT,3===p&&(u.getUint32(c,!0),c+=Uint32Array.BYTES_PER_ELEMENT)}}var L=17===M?16:28;L*=Float32Array.BYTES_PER_ELEMENT;for(let e=0;e<E;e++){var D=(I[e]=e)*M*Float32Array.BYTES_PER_ELEMENT+L,D=(Cesium.Color.unpack(B,D,R),2===p?S[e]:R.red+256*R.green+65536*R.blue);void 0===y[D]&&(y[D]={vertexColorCount:1,instanceIds:[],vertexColorOffset:e}),y[D].instanceIds.push(e)}oe(A[g].vertexPackage,I,1)}}}return i};var i=F;function r(e,t,i){var r=e._gl;this.contextId=e.id,this.textureId=t,this.layerId=i.layerId,this.rootName=i.rootName,this.context=e,this.width=i.width,this.height=i.height,this.compressType=i.compressType,this.internalFormat=i.internalFormat,this.pixelFormat=i.pixelFormat,this.arrayBufferView=i.arrayBufferView,this.wrapS=Cesium.defaultValue(i.wrapS,Cesium.TextureWrap.CLAMP_TO_EDGE),this.wrapT=Cesium.defaultValue(i.wrapT,Cesium.TextureWrap.CLAMP_TO_EDGE),this._target=r.TEXTURE_2D,this._texture=void 0,this.refCount=1,this.arrayBufferView&&this.init()}r.prototype.init=function(){var e=this.context._gl,t=(this._texture||(this._texture=e.createTexture()),e.bindTexture(e.TEXTURE_2D,this._texture),this.internalFormat);6410!==t&&4369!==t||e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0);let i=0,r=0,n=this.width,o=this.height;var s=function(e,t,i,r){let n=e.length,o=i,s=r,a=0;for(;;){var l=Cesium.PixelFormat.compressedTextureSizeInBytes(t,o,s);if(a+=l,o>>=1,s>>=1,0===o&&0===s)break;o=Math.max(o,1),s=Math.max(s,1)}return a===n}(this.arrayBufferView,t,n,o);do{var a=Cesium.PixelFormat.compressedTextureSizeInBytes(t,n,o),l=new Uint8Array(this.arrayBufferView.buffer,this.arrayBufferView.byteOffset+r,a);4369===t?e.texImage2D(e.TEXTURE_2D,i++,e.RGBA,n,o,0,e.RGBA,e.UNSIGNED_BYTE,l):e.compressedTexImage2D(e.TEXTURE_2D,i++,t,n,o,0,l),n=Math.max(n>>1,1),o=Math.max(o>>1,1),r+=a}while(r<this.arrayBufferView.byteLength&&s);1<i?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this.wrapS),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this.wrapT),e.texParameteri(this._target,this.context._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,1),e.bindTexture(e.TEXTURE_2D,null),this.arrayBufferView=void 0,this.ready=!0},r.prototype.isDestroyed=function(){return!1},r.prototype.destroy=function(){this.context._gl.deleteTexture(this._texture),this._texture=null,this.id=0,Cesium.destroyObject(this)};var se=r;function n(){this.ambientColor=new Cesium.Color,this.diffuseColor=new Cesium.Color,this.specularColor=new Cesium.Color(0,0,0,0),this.shininess=50,this.bTransparentSorting=!1,this.texMatrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY,new Cesium.Matrix4),this.textures=[]}n.prototype.isDestroyed=function(){return!1},n.prototype.destroy=function(){var t=this.textures.length;for(let e=0;e<t;e++)this.textures[e].destroy();return this.textures.length=0,this.ambientColor=void 0,this.diffuseColor=void 0,this.specularColor=void 0,Cesium.destroyObject(this)};var ae=n;function o(){this.context=void 0,this.model=void 0,this.index=void 0}o.prototype.set=function(e,t,i){this.context=e,this.model=t,this.index=i},o.prototype.execute=function(){var e=this.context,t=this.index,i=this.model.vertexPackage,t=i.vertexAttributes[t];if(!Cesium.defined(t))throw new Cesium.DeveloperError("attribute is null");if(-1!==i.instanceIndex&&!Cesium.defined(this.model.instanceBuffer)){if(!Cesium.defined(i.instanceBuffer))throw new Cesium.DeveloperError("instance buffer is null");this.model.instanceBuffer=Cesium.Buffer.createVertexBuffer({context:e,typedArray:i.instanceBuffer,usage:Cesium.BufferUsage.STATIC_DRAW})}1!==t.instanceDivisor||Cesium.defined(t.typedArray)?Cesium.defined(t.vertexBuffer)||(t.vertexBuffer=Cesium.Buffer.createVertexBuffer({context:e,typedArray:t.typedArray,usage:Cesium.BufferUsage.STATIC_DRAW}),t.typedArray=null,delete t.typedArray):t.vertexBuffer=this.model.instanceBuffer};e=o;function l(){this.model=void 0,this.context=void 0,this.index=0}l.prototype.set=function(e,t,i){this.model=t,this.context=e,this.index=i},l.prototype.execute=function(){var t=this.context,i=this.model.arrIndexPackage[this.index],r=this.model.vertexPackage.verticesCount;if(!Cesium.defined(i))throw new Cesium.DeveloperError("index package is null");if(!Cesium.defined(i.indexBuffer)){if(!Cesium.defined(i.indicesTypedArray))throw new Cesium.DeveloperError("index buffer is null");let e=Cesium.IndexDatatype.UNSIGNED_SHORT;(1===i.indexType||r>=Cesium.Math.SIXTY_FOUR_KILOBYTES)&&t.elementIndexUint&&(e=Cesium.IndexDatatype.UNSIGNED_INT),Cesium.defined(i.indexBuffer)||(i.indexBuffer=Cesium.Buffer.createIndexBuffer({context:t,typedArray:i.indicesTypedArray,usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:e})),i.indicesTypedArray=null,delete i.indicesTypedArray}};var t=l,u=Object.freeze({VertexNormal:"VertexNormal",VertexColor:"VertexColor",TexCoord:"TexCoord",TexCoord2:"TexCoord2",Instance:"Instance",COMPRESS_VERTEX:"COMPRESS_VERTEX",COMPRESS_NORMAL:"COMPRESS_NORMAL",COMPRESS_COLOR:"COMPRESS_COLOR",COMPRESS_TEXCOORD:"COMPRESS_TEXCOORD",UseLineColor:"USE_LINECOLOR",InstanceBim:"InstanceBim",InstancePipe:"InstancePipe",COMPUTE_TEXCOORD:"COMPUTE_TEXCOORD"}),p=Object.freeze({SVC_Vertex:1,SVC_Normal:2,SVC_VertexColor:4,SVC_SecondColor:8,SVC_TexutreCoord:16,SVC_TexutreCoordIsW:32}),le=Object.freeze({BIM:17,PIPELINE:29});function d(){this.model=void 0,this.context=void 0}d.prototype.set=function(e,t){this.model=t,this.context=e},d.prototype.execute=function(){var e=this.context,t=this.model,i=t.layer,r=t.vs,n=t.fs,o=t.attributeLocations,s=t.material,a=t.vertexPackage,r=t.batchTable?t.batchTable.getVertexShaderCallback()(r):r,r=(void 0===e.texturelod&&(e.texturelod=Cesium.defaultValue(function(t,i){var r=i.length;for(let e=0;e<r;++e){var n=t.getExtension(i[e]);if(n)return n}}(e._gl,["EXT_shader_texture_lod"]),!1)),new Cesium.ShaderSource({sources:[r]})),n=new Cesium.ShaderSource({sources:[n]});Cesium.defined(o.aNormal)&&(r.defines.push(u.VertexNormal),n.defines.push(u.VertexNormal)),Cesium.defined(o.aColor)&&r.defines.push(u.VertexColor),s&&0<s.textures.length&&(r.defines.push(u.COMPUTE_TEXCOORD),n.defines.push(u.COMPUTE_TEXCOORD)),s&&2===s.textures.length&&(r.defines.push(u.TexCoord2),n.defines.push(u.TexCoord2)),Cesium.defined(o.aTexCoord0)&&(r.defines.push("TexCoord"),n.defines.push("TexCoord")),-1<a.instanceIndex&&r.defines.push(u.Instance),a.instanceMode===le.BIM&&r.defines.push(u.InstanceBim),a.instanceMode===le.PIPELINE&&r.defines.push(u.InstancePipe),Cesium.defined(a.compressOptions)&&(((s=a.compressOptions)&p.SVC_Vertex)===p.SVC_Vertex&&r.defines.push(u.COMPRESS_VERTEX),(s&p.SVC_Normal)===p.SVC_Normal&&r.defines.push(u.COMPRESS_NORMAL),(s&p.SVC_VertexColor)===p.SVC_VertexColor&&r.defines.push(u.COMPRESS_COLOR),(s&p.SVC_TexutreCoord)===p.SVC_TexutreCoord)&&r.defines.push(u.COMPRESS_TEXCOORD),Cesium.defined(t.arrIndexPackage)&&0<t.arrIndexPackage.length&&2===t.arrIndexPackage[0].primitiveType&&n.defines.push(u.UseLineColor),Cesium.defined(a.customVertexAttribute)&&Cesium.defined(a.customVertexAttribute.TextureCoordMatrix)&&r.defines.push("USE_TextureCoordMatrix"),Cesium.defined(a.customVertexAttribute)&&Cesium.defined(a.customVertexAttribute.VertexWeight)&&r.defines.push("USE_VertexWeight"),"MESHOPT"===i._vertexCompressionType&&r.defines.push("MeshOPT_Compress"),Cesium.defined(i.clippingPlanes)&&i.clippingPlanes.enabled&&i.clippingPlanes.length&&(n.defines.push("HAS_CLIPPING_PLANES"),n.defines.push("CLIPPING_PLANES_LENGTH "+i.clippingPlanes.length),i.clippingPlanes.unionClippingRegions&&n.defines.push("UNION_CLIPPING_REGIONS"),Cesium.ClippingPlaneCollection.useFloatTexture(e)&&n.defines.push("USE_CLIPPING_PLANES_FLOAT_TEXTURE"),s=Cesium.ClippingPlaneCollection.getTextureResolution(i.clippingPlanes,e,new Cesium.Cartesian2),n.defines.push("CLIPPING_PLANES_TEXTURE_WIDTH "+s.x),n.defines.push("CLIPPING_PLANES_TEXTURE_HEIGHT "+s.y)),t.shaderProgram=Cesium.ShaderProgram.fromCache({context:e,vertexShaderSource:r,fragmentShaderSource:n,attributeLocations:o})};var ue=d;function m(e){this.layer=e.layer,this.vertexPackage=e.vertexPackage,this.arrIndexPackage=e.arrIndexPackage,this.vertexBufferToCreate=new Cesium.Queue,this.indexBufferToCreate=new Cesium.Queue,this.shaderProgramToCreate=new Cesium.Queue;let t,i;for(t=0,i=this.vertexPackage.vertexAttributes.length;t<i;t++)this.vertexBufferToCreate.enqueue(t);for(t=0,i=this.arrIndexPackage.length;t<i;t++)this.indexBufferToCreate.enqueue(t);this.shaderProgramToCreate.enqueue(0),this.boundingVolume=e.boundingVolume,this.material=Cesium.defaultValue(e.material,new ae),this.geoName=e.geoName,this.modelMatrix=e.modelMatrix,this.geoMatrix=e.geoMatrix,this.invGeoMatrix=Cesium.Matrix4.inverse(this.geoMatrix,new Cesium.Matrix4),this.instanceCount=e.vertexPackage.instanceCount,this.attributeLocations=e.vertexPackage.attrLocation,this.shaderProgram=void 0,this.vertexArray=void 0,this.colorCommand=void 0,this.pickInfo=Cesium.defaultValue(e.pickInfo,{}),this.selectionInfoMap=new Cesium.AssociativeArray,this.batchTable=void 0,this.batchTableDirty=!1,this.idsOperationMap=new Cesium.AssociativeArray,this.pickColorIdentifier="vSecondColor",this.createBoundingBoxForInstance(),this.ready=!1}const ce=new e,he=new t,Ae=new ue;m.prototype.createBuffers=function(e){for(var t=this,i=e,r=t.layer.context,n=t.vertexBufferToCreate;n.length;){var o=n.peek();if(ce.set(r,t,o),!i.jobScheduler.execute(ce,Cesium.JobType.BUFFER))break;n.dequeue()}for(var s=this,a=e,l=s.layer.context,u=s.indexBufferToCreate;u.length;){var c=u.peek();if(he.set(l,s,c),!a.jobScheduler.execute(he,Cesium.JobType.BUFFER))break;u.dequeue()}},m.prototype.createShaderProgram=function(e){for(var t=this,i=e,r=t.layer.context,n=t.shaderProgramToCreate;n.length;){n.peek();if(Ae.set(r,t),!i.jobScheduler.execute(Ae,Cesium.JobType.PROGRAM))break;n.dequeue()}},m.prototype.createBatchTable=function(e){var t,i,r,n;t=this,!Cesium.defined(t.batchTable)&&t.pickInfo&&(i=t.layer.context,(r=[]).push({functionName:"batchTable_operation",componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4},{functionName:"batchTable_pickColor",componentDatatype:Cesium.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0}),n=t.pickInfo,n=Object.keys(n),n=0<t.instanceCount?t.instanceCount:n.length,t.batchTable=new Cesium.BatchTable(i,r,n))};let pe=new Cesium.Cartesian3,y=(m.prototype.createBoundingBoxForInstance=function(){var e,t,i,r=this.vertexPackage;Cesium.defined(r)&&-1!==r.instanceIndex&&Cesium.defined(r.instanceBounds)&&(e=r.instanceBounds,t=new Cesium.Cartesian3(e[0],e[1],e[2]),e=new Cesium.Cartesian3(e[3],e[4],e[5]),e=Cesium.Cartesian3.lerp(t,e,.5,pe),t=Cesium.Cartesian3.distance(e,t),i=new Cesium.Cartesian3,Cesium.Matrix4.multiplyByPoint(this.modelMatrix,e,i),this.boundingVolume.center=i,this.boundingVolume.radius=t,r.instanceBounds=void 0)},m.prototype.initLayerSetting=function(e){0<Object.keys(e._objsOperationList).length&&this.updateObjsOperation(e._objsOperationList)},new Cesium.Cartesian4);m.prototype.createPickIds=function(){var i=this.layer,r=i.context,e=this.pickInfo;if(Cesium.defined(e)){for(var n in e)e.hasOwnProperty(n)&&this.selectionInfoMap.set(n,e[n]);let t=this.batchTable;var o,s=this.selectionInfoMap,a=s._hash;for(o in a)if(a.hasOwnProperty(o)){var l=s.get(o);let e;var u=(e=Cesium.defined(e)?e:r.createPickId({primitive:i,id:o})).color,u=(y.x=Cesium.Color.floatToByte(u.red),y.y=Cesium.Color.floatToByte(u.green),y.z=Cesium.Color.floatToByte(u.blue),y.w=Cesium.Color.floatToByte(u.alpha),l.instanceIds);0<this.instanceCount?u.map(function(e){t.setBatchedAttribute(e,1,y)}):(u=l[0].batchId,t.setBatchedAttribute(u,1,y))}this.pickInfo=void 0}},m.prototype.updateBatchTableAttributes=function(){let i=this;var r=this.idsOperationMap;for(let e=0,t=r.length;e<t;e++){let t=r.values[e];t.dirty&&(t.dirty=!1,0<this.instanceCount?Array.isArray(t.instanceIds)&&t.instanceIds.map(function(e){i.batchTable.setBatchedAttribute(e,0,t.operationValue)}):Cesium.defined(t.batchId)&&this.batchTable.setBatchedAttribute(t.batchId,0,t.operationValue))}},m.prototype.updateObjsOperation=function(e){if(this.ready&&!(this.selectionInfoMap.length<1)){var t,i=this.selectionInfoMap._hash;for(t in i)if(i.hasOwnProperty(t)){var r=e[t];if(Cesium.defined(r)){var n=i[t][0],o=n.batchId,n=n.instanceIds;let e=this.idsOperationMap.get(t);(e=Cesium.defined(e)?e:{batchId:o,instanceIds:n,operationValue:new Cesium.Cartesian4,dirty:!0}).dirty=!0,e.operationValue.x=1&e.operationValue.x|r,this.idsOperationMap.set(t,e),this.batchTableDirty=!0}}}},m.prototype.createCommand=Cesium.DeveloperError.throwInstantiationError,m.prototype.update=Cesium.DeveloperError.throwInstantiationError,m.prototype.isDestroyed=Cesium.DeveloperError.throwInstantiationError,m.prototype.destroy=Cesium.DeveloperError.throwInstantiationError;var _=m;function v(e){_.call(this,e),this.vs=`
    in vec4 aPosition;
#ifdef VertexColor
    in vec4 aColor;
#endif
#ifdef VertexNormal
    in vec3 aNormal;
#endif
#ifdef Instance
    in float instanceId;
#else
    in float batchId;
#endif 

#ifdef USE_VertexWeight
    in float aVertexWeight;
#endif

#ifdef USE_TextureCoordMatrix
    in vec2 aTextureCoordMatrix;
#endif

#ifdef TexCoord
    in vec4 aTexCoord0;
    out vec4 vTexCoord;
    uniform mat4 uTexMatrix;
#ifdef COMPUTE_TEXCOORD
    uniform float uTexture0Width;
    out vec4 vTexMatrix;
    out vec4 vTexCoordTransform;
    out vec2 vIsRGBA;
#endif
#endif

#ifdef TexCoord2
    in vec4 aTexCoord1;
    uniform float uTexture1Width;
    out vec4 vTexMatrix2;
#endif
#ifdef InstanceBim
    in vec4 uv2;
    in vec4 uv3;
    in vec4 uv4;
    in vec4 secondary_colour;
    in vec4 uv6;   
#endif

#ifdef InstancePipe
    in vec4 uv1;
    in vec4 uv2;
    in vec4 uv3;
    in vec4 uv4;
    in vec4 uv5;
    in vec4 uv6;
    in vec4 uv7;
    in vec4 secondary_colour;
    in vec4 uv9;
#endif
    uniform vec4 uFillForeColor;
    uniform vec4 uSelectedColor;
    out vec4 vSecondColor;
    out vec4 vPositionMC;
    out vec3 vPositionEC;
#ifdef VertexNormal
    out vec3 vNormalEC;
#endif
    out vec4 vColor;
    
    const float SHIFT_LEFT8 = 256.0;
    const float SHIFT_RIGHT8 = 1.0 / 256.0;
    const float SHIFT_RIGHT4 = 1.0 / 16.0;
    const float SHIFT_LEFT4 = 16.0;
    void getTextureMatrixFromZValue(in float nZ, inout float XTran, inout float YTran, inout float scale, inout float isRGBA)
    {
        if(nZ <= 0.0)
        {
            return;
        }
        float nDel8 = floor(nZ * SHIFT_RIGHT8);
        float nDel16 = floor(nDel8 * SHIFT_RIGHT8);
        float nDel20 = floor(nDel16 * SHIFT_RIGHT4);
        isRGBA = floor(nDel20);
        YTran = nZ - nDel8 * SHIFT_LEFT8;
        XTran = nDel8 - nDel16 * SHIFT_LEFT8;
        float nLevel = nDel16 - nDel20 * SHIFT_LEFT4;
        scale = 1.0 / pow(2.0, nLevel);
    }
    
    void operation(vec4 operationType, vec4 color, vec4 selectedColor, inout vec4 vertexColor)
    {
        float right_2 = operationType.x * 0.5;
        float right_4 = right_2 * 0.5;
        float right_8 = right_4 * 0.5;
        float right_16 = right_8 * 0.5;
        float isSetColor = fract(right_2);
        if(isSetColor > 0.1)
        {
            vertexColor *= color;
        }
        float isPicked = fract(floor(right_2)* 0.5);
        if(isPicked > 0.1)
        {
            vertexColor *= selectedColor;
        }
        float isHide = fract(floor(right_4)* 0.5);
        if(isHide > 0.1)
        {
            vertexColor.a = 0.0;
        }
    }
    
#ifdef COMPRESS_TEXCOORD
#ifdef TexCoord
    uniform vec2 decode_texCoord0_min;
#endif
#ifdef TexCoord2
    uniform vec2 decode_texCoord1_min;
#endif
#ifdef MeshOPT_Compress
    uniform vec3 decode_texCoord0_vNormConstant;
    uniform vec3 decode_texCoord1_vNormConstant;
#else
    uniform float decode_texCoord0_normConstant;
    uniform float decode_texCoord1_normConstant;
#endif
#endif

#ifdef COMPRESS_VERTEX
    uniform vec4 decode_position_min;
    uniform float decode_position_normConstant;
#endif

#ifdef COMPRESS_NORMAL
    uniform float normal_rangeConstant;
#endif
    void main()
    {
    #ifdef COMPRESS_VERTEX
        vec4 vertexPos = vec4(1.0);
        vertexPos = decode_position_min + vec4(aPosition.xyz, 1.0) * decode_position_normConstant;
    #else
        vec4 vertexPos = aPosition;
    #endif
    #ifdef TexCoord
    
    #ifdef COMPRESS_TEXCOORD
    #ifdef MeshOPT_Compress
        vec2 texCoord0;
        texCoord0.x = aTexCoord0.x * decode_texCoord0_vNormConstant.x;
        texCoord0.y = aTexCoord0.y * decode_texCoord0_vNormConstant.y;
        vTexCoord.xy = decode_texCoord0_min + texCoord0.xy;
    #else
        vTexCoord.xy = decode_texCoord0_min.xy + aTexCoord0.xy * decode_texCoord0_normConstant;
    #endif
    #else
        vTexCoord.xy = aTexCoord0.xy;
    #endif
    
    #ifdef COMPUTE_TEXCOORD
        vTexMatrix = vec4(0.0,0.0,1.0,0.0);
        vIsRGBA.x = 0.0;
        vTexCoordTransform.x = aTexCoord0.z;
    #ifdef USE_TextureCoordMatrix
        vTexCoordTransform.x = aTextureCoordMatrix.x;
    #endif
        if(vTexCoordTransform.x < -90000.0)
        {
            vTexMatrix.z = -1.0;
        }
        getTextureMatrixFromZValue(floor(vTexCoordTransform.x), vTexMatrix.x, vTexMatrix.y, vTexMatrix.z, vIsRGBA.x);
        vTexMatrix.w = log2(uTexture0Width * vTexMatrix.z);
    #endif
    #endif
    
    #ifdef TexCoord2
    
    #ifdef COMPRESS_TEXCOORD
    #ifdef MeshOPT_Compress
        vec2 texCoord1;
        texCoord1.x = aTexCoord1.x * decode_texCoord1_vNormConstant.x;
        texCoord1.y = aTexCoord1.y * decode_texCoord1_vNormConstant.y;
        vTexCoord.zw = decode_texCoord1_min + texCoord1.xy;
    #else
        vTexCoord.zw = decode_texCoord1_min.xy + aTexCoord1.xy * decode_texCoord1_normConstant;
    #endif
    #else
        vTexCoord.zw = aTexCoord1.xy;
    #endif
    
        vTexMatrix2 = vec4(0.0,0.0,1.0,0.0);
        vIsRGBA.y = 0.0;
        vTexCoordTransform.y = aTexCoord1.z;
    #ifdef USE_TextureCoordMatrix
        vTexCoordTransform.y = aTextureCoordMatrix.y;
    #endif
        if(vTexCoordTransform.y < -90000.0)
        {
            vTexMatrix2.z = -1.0;
        }
        getTextureMatrixFromZValue(floor(vTexCoordTransform.y), vTexMatrix2.x, vTexMatrix2.y, vTexMatrix2.z, vIsRGBA.y);
        vTexMatrix2.w = log2(uTexture1Width * vTexMatrix.z);
    #endif
    
        vec4 vertexColor = uFillForeColor;
    #ifdef VertexColor
        vertexColor *= aColor;
    #endif
    #ifdef VertexNormal
        vec3 normal = aNormal;
    #ifdef COMPRESS_NORMAL
    #ifdef MeshOPT_Compress
        normal.x = aNormal.x / 127.0;
        normal.y = aNormal.y / 127.0;
        normal.z = 1.0 - abs(normal.x) - abs(normal.y);
        normal = normalize(normal);
    #else
        normal = czm_octDecode(aNormal.xy, normal_rangeConstant).zxy;
    #endif
    #endif
    #endif
    #ifdef InstanceBim
        mat4 worldMatrix;
        worldMatrix[0] = uv2;
        worldMatrix[1] = uv3;
        worldMatrix[2] = uv4;
        worldMatrix[3] = vec4(0, 0, 0, 1);
        vertexPos = vec4(vertexPos.xyz,1.0) * worldMatrix;
        vertexColor *= secondary_colour; 
    #endif
    #ifdef InstancePipe
        mat4 worldMatrix;
        mat4 worldMatrix0;
        mat4 worldMatrix1;
        vec4 worldPos0;
        vec4 worldPos1;
        worldMatrix0[0] = uv1;
        worldMatrix0[1] = uv2;
        worldMatrix0[2] = uv3;
        worldMatrix0[3] = vec4( 0.0, 0.0, 0.0, 1.0 );
        worldMatrix1[0] = uv4;
        worldMatrix1[1] = uv5;
        worldMatrix1[2] = uv6;
        worldMatrix1[3] = vec4( 0.0, 0.0, 0.0, 1.0 );
        vec4 realVertex = vec4(vertexPos.xyz, 1.0);
        realVertex.x = realVertex.x * uv7.z;
        worldPos0 = realVertex * worldMatrix0;
        worldPos1 = realVertex * worldMatrix1;
        vertexColor *= secondary_colour; 
    #ifdef TexCoord
        if(aTexCoord0.y > 0.5)
        {
            vec4 tex4Vec = uTexMatrix * vec4(uv7.y, aTexCoord0.x, 0.0, 1.0);
            vTexCoord.xy = tex4Vec.xy;
            vertexPos = worldPos1;
            worldMatrix = worldMatrix1;
        }
        else
        {
            vec4 tex4Vec = uTexMatrix * vec4(uv7.x, aTexCoord0.x, 0.0, 1.0);
            vTexCoord.xy = tex4Vec.xy;
            vertexPos = worldPos0;
            worldMatrix = worldMatrix0;
        }
    #endif
    #ifdef VertexNormal
        normal.x = normal.x * uv7.z;
    #endif
    #endif
    #ifdef Instance  
        float index = instanceId;
    #else
        float index = batchId;
    #endif  
        vec4 operationType = batchTable_operation(index);
        operation(operationType, vec4(1.0), uSelectedColor, vertexColor);
        vSecondColor = batchTable_pickColor(index);
        vec4 positionMC = vec4(vertexPos.xyz, 1.0);
        vColor = vertexColor;
    #ifdef VertexNormal
        vNormalEC = czm_normal * normal;
    #endif
        vPositionMC = positionMC;
        vPositionEC = (czm_modelView * positionMC).xyz;
        gl_Position = czm_modelViewProjection * vec4(vertexPos.xyz, 1.0);
    }
`,this.fs=`
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
#endif
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable
#endif
    uniform vec4 uDiffuseColor;
    //>> modify.start(2023-09-20) liuling S3M图层亮度调整
    uniform float udirDiffuseWeight;
    uniform vec4 ubaseColorWithAlpha;
    //>>modify.end
#ifdef TexCoord
    in vec4 vTexCoord;
#ifdef COMPUTE_TEXCOORD
    uniform sampler2D uTexture;
    uniform float uTexture0Width;
    in vec4 vTexCoordTransform;
    in vec4 vTexMatrix;
    in vec2 vIsRGBA;
#endif
#endif

    in vec4 vColor;
    in vec4 vSecondColor;
    in vec4 vPositionMC;
    in vec3 vPositionEC;
#ifdef VertexNormal
    in vec3 vNormalEC;
#endif
#ifdef TexCoord2
    uniform sampler2D uTexture2;
    uniform float uTexture1Width;
    in vec4 vTexMatrix2;
#endif
#ifdef COMPUTE_TEXCOORD
    float calculateMipLevel(in vec2 inTexCoord, in float vecTile, in float fMaxMip, inout float mipLevel)
    {
        vec2 dx = dFdx(inTexCoord * vecTile);
        vec2 dy = dFdy(inTexCoord * vecTile);
        float dotX = dot(dx, dx);
        float dotY = dot(dy, dy);
        float dMax = max(dotX, dotY);
        float dMin = min(dotX, dotY);
        float offset = (dMax - dMin) / (dMax + dMin);
        offset = clamp(offset, 0.0, 1.0);
        float d = dMax * (1.0 - offset) + dMin * offset;
        mipLevel = 0.5 * log2(d);
        mipLevel = clamp(mipLevel, 0.0, fMaxMip - 1.62);
        // >> modify.start(2023-04-19) 蔡周峻 参考opengl4.6编程规范，计算mipmap层级，并和s3m自己的计算方式对比，得出lod等级偏差值
        float n = min(dMax / dMin,1.0);
        float autolevel = 0.5 * log2(dMax) - log2(n);
        float lodBias =  mipLevel - autolevel - 2.50;
        lodBias = lodBias * 0.6;
        if(mipLevel < 3.5)
        {
            lodBias = -1.0 * fMaxMip;
        }
        return lodBias;
        // >> modify.end
    }
    
    void calculateTexCoord(in vec3 inTexCoord, in float scale, in float XTran, in float YTran, in float fTile, in float mipLevel, inout vec2 outTexCoord)
    {
        if(inTexCoord.z < -9000.0)
        {
            outTexCoord = inTexCoord.xy;
        }
        else
        {
            vec2 fTexCoord = fract(inTexCoord.xy);
            float offset = 1.0 * pow(2.0, mipLevel) / fTile;
            fTexCoord = clamp(fTexCoord, offset, 1.0 - offset);
            outTexCoord.x = (fTexCoord.x + XTran) * scale;
            outTexCoord.y = (fTexCoord.y + YTran) * scale;
        }
    }
    
    vec4 getTexColorForS3M(sampler2D curTexture, vec3 oriTexCoord, float texTileWidth, float fMaxMipLev, float fTexCoordScale, vec2 vecTexCoordTranslate, float isRGBA)
    {
        vec4 color = vec4(1.0);
        float mipLevel = 0.0;
        float lodBias = calculateMipLevel(oriTexCoord.xy, texTileWidth, fMaxMipLev, mipLevel);
        vec2 realTexCoord;
        calculateTexCoord(oriTexCoord, fTexCoordScale, vecTexCoordTranslate.x, vecTexCoordTranslate.y, texTileWidth, mipLevel, realTexCoord);
        if(isRGBA > 0.5)
        {
            vec2 rgbTexCoord;
            rgbTexCoord.x = (realTexCoord.x + vecTexCoordTranslate.x * fTexCoordScale) * 0.5;
            rgbTexCoord.y = (realTexCoord.y + vecTexCoordTranslate.y * fTexCoordScale) * 0.5;
            color = texture(curTexture, rgbTexCoord.xy, -10.0);
            vec2 vecAlphaTexCoord;
            vecAlphaTexCoord.x = rgbTexCoord.x;
            vecAlphaTexCoord.y = rgbTexCoord.y + fTexCoordScale * 0.5;
            color.a = texture(curTexture, vecAlphaTexCoord.xy, -10.0).r;
        }
        else
        {
            if(oriTexCoord.z < -9000.0)
            {
                color = texture(curTexture, realTexCoord.xy);
            }
            else
            {
                // >> modify.start(2023-04-18) 蔡周峻 修复webgl2中纹理缝隙问题，基本都采样顶层
                #ifdef GL_EXT_shader_texture_lod
                    color = textureLodEXT(curTexture, realTexCoord.xy, mipLevel);
                #else
                    color = texture(curTexture, realTexCoord.xy, -fMaxMipLev);
                #endif
                //>> modify.end
            }
        }
       
        return color;
    }
    
    vec4 getTextureColor()
    {
        if(vTexMatrix.z < 0.0)
        {
            return vec4(1.0);
        }
        float texTileWidth0 = vTexMatrix.z * uTexture0Width;
        vec3 realTexCoord = vec3(vTexCoord.xy, vTexCoordTransform.x);
        vec4 FColor = getTexColorForS3M(uTexture, realTexCoord, texTileWidth0, vTexMatrix.w, vTexMatrix.z, vTexMatrix.xy, vIsRGBA.x);
    #ifdef TexCoord2
        float texTileWidth1 = vTexMatrix2.z * uTexture1Width;
        realTexCoord = vec3(vTexCoord.zw, vTexCoordTransform.y);
        vec4 SColor = getTexColorForS3M(uTexture2, realTexCoord, texTileWidth1, vTexMatrix2.w, vTexMatrix2.z, vTexMatrix2.xy, vIsRGBA.y);
        SColor.r = clamp(SColor.r, 0.0, 1.0);
        SColor.g = clamp(SColor.g, 0.0, 1.0);
        SColor.b = clamp(SColor.b, 0.0, 1.0);
        return FColor * SColor;
    #else
        return FColor;
    #endif
    }
#endif
    vec4 SRGBtoLINEAR4(vec4 srgbIn)
    {
    #ifndef HDR 
        vec3 linearOut = pow(srgbIn.rgb, vec3(2.2));
        return vec4(linearOut, srgbIn.a);
    #else
        return srgbIn;
    #endif
    }
    vec3 LINEARtoSRGB(vec3 linearIn)
    {
    #ifndef HDR 
        return pow(linearIn, vec3(1.0/2.2));
    #else
        return linearIn;
    #endif
    }
    vec3 applyTonemapping(vec3 linearIn) 
    {
    #ifndef HDR
        return czm_acesTonemapping(linearIn);
    #else
        return linearIn;
    #endif
    }
  
    vec3 computeNormal(in vec3 oriVertex)
    {
        vec3 normal = cross(vec3(dFdx(oriVertex.x), dFdx(oriVertex.y), dFdx(oriVertex.z)), vec3(dFdy(oriVertex.x), dFdy(oriVertex.y), dFdy(oriVertex.z)));
        normal = normalize(normal);
        return normal;
    }

    //>>modify.start
#ifdef HAS_CLIPPING_PLANES
    uniform sampler2D model_clippingPlanes;
    uniform vec4 model_clippingPlanesEdgeStyle;
    uniform mat4 model_clippingPlanesMatrix;

#ifdef USE_CLIPPING_PLANES_FLOAT_TEXTURE
    vec4 getClippingPlane(
        highp sampler2D packedClippingPlanes,
        int clippingPlaneNumber,
        mat4 transform
    ) {
        int pixY = clippingPlaneNumber / CLIPPING_PLANES_TEXTURE_WIDTH;
        int pixX = clippingPlaneNumber - (pixY * CLIPPING_PLANES_TEXTURE_WIDTH);
        float pixelWidth = 1.0 / float(CLIPPING_PLANES_TEXTURE_WIDTH);
        float pixelHeight = 1.0 / float(CLIPPING_PLANES_TEXTURE_HEIGHT);
        float u = (float(pixX) + 0.5) * pixelWidth; 
        float v = (float(pixY) + 0.5) * pixelHeight;
        vec4 plane = texture(packedClippingPlanes, vec2(u, v));
        return czm_transformPlane(plane, transform);
    }
#else
    
    vec4 getClippingPlane(
        highp sampler2D packedClippingPlanes,
        int clippingPlaneNumber,
        mat4 transform
    ) {
        int clippingPlaneStartIndex = clippingPlaneNumber * 2; 
        int pixY = clippingPlaneStartIndex / CLIPPING_PLANES_TEXTURE_WIDTH;
        int pixX = clippingPlaneStartIndex - (pixY * CLIPPING_PLANES_TEXTURE_WIDTH);
        float pixelWidth = 1.0 / float(CLIPPING_PLANES_TEXTURE_WIDTH);
        float pixelHeight = 1.0 / float(CLIPPING_PLANES_TEXTURE_HEIGHT);
        float u = (float(pixX) + 0.5) * pixelWidth; 
        float v = (float(pixY) + 0.5) * pixelHeight;
        vec4 oct32 = texture(packedClippingPlanes, vec2(u, v)) * 255.0;
        vec2 oct = vec2(oct32.x * 256.0 + oct32.y, oct32.z * 256.0 + oct32.w);
        vec4 plane;
        plane.xyz = czm_octDecode(oct, 65535.0);
        plane.w = czm_unpackFloat(texture(packedClippingPlanes, vec2(u + pixelWidth, v)));
        return czm_transformPlane(plane, transform);
    }
#endif
    
    float clip(vec4 fragCoord, sampler2D clippingPlanes, mat4 clippingPlanesMatrix) {
        vec4 position = czm_windowToEyeCoordinates(fragCoord);
        vec3 clipNormal = vec3(0.0);
        vec3 clipPosition = vec3(0.0);
        float pixelWidth = czm_metersPerPixel(position);
        
    #ifdef UNION_CLIPPING_REGIONS
        float clipAmount; 
    #else
        float clipAmount = 0.0;
        bool clipped = true;
    #endif
    
        for (int i = 0; i < CLIPPING_PLANES_LENGTH; ++i) {
            vec4 clippingPlane = getClippingPlane(clippingPlanes, i, clippingPlanesMatrix);
            clipNormal = clippingPlane.xyz;
            clipPosition = -clippingPlane.w * clipNormal;
            float amount = dot(clipNormal, (position.xyz - clipPosition)) / pixelWidth;
            
            #ifdef UNION_CLIPPING_REGIONS
            clipAmount = czm_branchFreeTernary(i == 0, amount, min(amount, clipAmount));
            if (amount <= 0.0) {
                discard;
            }
            #else
            clipAmount = max(amount, clipAmount);
            clipped = clipped && (amount <= 0.0);
            #endif
        }
    
    #ifndef UNION_CLIPPING_REGIONS
        if (clipped) {
            discard;
        }
    #endif
        
        return clipAmount;
    }
    
    void modelClippingPlanesStage(inout vec4 color)
    {
        float clipDistance = clip(gl_FragCoord, model_clippingPlanes, model_clippingPlanesMatrix);
        vec4 clippingPlanesEdgeColor = vec4(1.0);
        clippingPlanesEdgeColor.rgb = model_clippingPlanesEdgeStyle.rgb;
        float clippingPlanesEdgeWidth = model_clippingPlanesEdgeStyle.a;
        
        if (clipDistance > 0.0 && clipDistance < clippingPlanesEdgeWidth) {
            color = clippingPlanesEdgeColor;
        }
    }
#endif
    //>>modify.end

    void main()
    {
        if(vColor.a < 0.1)
        {
            discard;
        } 
        // vec4 baseColorWithAlpha = vColor;
        vec4 baseColorWithAlpha = ubaseColorWithAlpha;
    #ifdef COMPUTE_TEXCOORD
        baseColorWithAlpha *= SRGBtoLINEAR4(getTextureColor());
    #endif
    
        if(baseColorWithAlpha.a < 0.1)
        {
            discard;
        }
        vec3 normal = vec3(0.0);
    #ifdef VertexNormal
        normal = normalize(vNormalEC);
    #endif
        normal = length(normal) > 0.1 ? normal : computeNormal(vPositionMC.xyz);
        vec3 color = baseColorWithAlpha.rgb;
        vec3 dirVectorEC = normalize(czm_lightDirectionEC);
        float dotProduct = dot( normal, dirVectorEC );
        //>> modify.start(2023-09-20) liuling S3M图层亮度调整
        float dirDiffuseWeight = udirDiffuseWeight;
        //>>modify.end
        color = color * uDiffuseColor.rgb * dirDiffuseWeight;
    #ifdef TexCoord
        color = LINEARtoSRGB(color);
    #endif

    //>>modify.start
        vec4 colorResult = vec4(color, baseColorWithAlpha.a);
    #ifdef HAS_CLIPPING_PLANES
        modelClippingPlanesStage(colorResult);
    #endif
        out_FragColor = colorResult;
    //>>modify.end
    }
`,this.useLineColor=!1}(v.prototype=Object.create(_.prototype)).constructor=_,v.prototype.createCommand=function(){if(!Cesium.defined(this.colorCommand)&&0===this.vertexBufferToCreate.length&&0===this.indexBufferToCreate.length&&0===this.shaderProgramToCreate.length){var i=this.layer,r=i.context,n=this.vertexPackage,o=this.arrIndexPackage,s=n.vertexAttributes;if(!(o.length<1)){var o=o[0],a=this.material;this.vertexArray=new Cesium.VertexArray({context:r,attributes:s,indexBuffer:o.indexBuffer});let e=Cesium.PrimitiveType.TRIANGLES;switch(o.primitiveType){case 1:e=Cesium.PrimitiveType.POINTS;break;case 2:e=Cesium.PrimitiveType.LINES;break;case 4:e=Cesium.PrimitiveType.TRIANGLES}this.useLineColor=e===Cesium.PrimitiveType.LINES,this.colorCommand=new Cesium.DrawCommand({castShadows:!0,receiveShadows:!0,primitiveType:e,modelMatrix:this.modelMatrix,boundingVolume:Cesium.BoundingSphere.clone(this.boundingVolume),pickId:this.pickColorIdentifier,vertexArray:this.vertexArray,shaderProgram:this.shaderProgram,pass:a.bTransparentSorting?Cesium.Pass.TRANSLUCENT:Cesium.Pass.OPAQUE,renderState:a.bTransparentSorting?Cesium.RenderState.fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:Cesium.DepthFunction.LESS_OR_EQUAL},blending:Cesium.BlendingState.ALPHA_BLEND}):Cesium.RenderState.fromCache({cull:{enabled:!1},depthTest:{enabled:!0,func:Cesium.DepthFunction.LESS_OR_EQUAL},blending:Cesium.BlendingState.ALPHA_BLEND}),instanceCount:n.instanceCount});let t=function(e,t,i){var r={uGeoMatrix:function(){return i.geoMatrix},uTexMatrix:function(){return e.texMatrix},uFillForeColor:function(){return i.useLineColor?t.style3D.lineColor:t.style3D.fillForeColor},uInverseGeoMatrix:function(){return i.invGeoMatrix},uTexture:function(){return e.textures[0]},uTexture2:function(){return e.textures[1]},uTexture0Width:function(){return e.textures[0].width},uTexture1Width:function(){return e.textures[1].width},uDiffuseColor:function(){return e.diffuseColor},uSelectedColor:function(){return t._selectedColor},udirDiffuseWeight:function(){return t.dirDiffuseWeight},ubaseColorWithAlpha:function(){return t.baseColorWithAlpha}};const n=i.vertexPackage;var o=n.compressOptions;return(o&p.SVC_Vertex)===p.SVC_Vertex&&(r.decode_position_min=function(){return n.minVerticesValue},r.decode_position_normConstant=function(){return n.vertCompressConstant}),(o&p.SVC_Normal)===p.SVC_Normal&&(r.normal_rangeConstant=function(){return n.normalRangeConstant}),(o&p.SVC_TexutreCoord)===p.SVC_TexutreCoord&&(0<n.texCoordCompressConstant.length&&(r.decode_texCoord0_min=function(){return n.minTexCoordValue[0]},r.decode_texCoord0_normConstant=function(){return n.texCoordCompressConstant[0]},r.decode_texCoord0_vNormConstant=function(){return n.texCoordCompressConstant[0]}),1<n.texCoordCompressConstant.length&&(r.decode_texCoord1_min=function(){return n.minTexCoordValue[1]},r.decode_texCoord1_normConstant=function(){return n.texCoordCompressConstant[1]},r.decode_texCoord1_vNormConstant=function(){return n.texCoordCompressConstant[1]}),2<n.texCoordCompressConstant.length&&(r.decode_texCoord2_min=function(){return n.minTexCoordValue[2]},r.decode_texCoord2_normConstant=function(){return n.texCoordCompressConstant[2]}),3<n.texCoordCompressConstant.length&&(r.decode_texCoord3_min=function(){return n.minTexCoordValue[3]},r.decode_texCoord3_normConstant=function(){return n.texCoordCompressConstant[3]}),4<n.texCoordCompressConstant.length&&(r.decode_texCoord4_min=function(){return n.minTexCoordValue[4]},r.decode_texCoord4_normConstant=function(){return n.texCoordCompressConstant[4]}),5<n.texCoordCompressConstant.length&&(r.decode_texCoord5_min=function(){return n.minTexCoordValue[5]},r.decode_texCoord5_normConstant=function(){return n.texCoordCompressConstant[5]}),6<n.texCoordCompressConstant.length&&(r.decode_texCoord6_min=function(){return n.minTexCoordValue[6]},r.decode_texCoord6_normConstant=function(){return n.texCoordCompressConstant[6]}),7<n.texCoordCompressConstant.length)&&(r.decode_texCoord7_min=function(){return n.minTexCoordValue[7]},r.decode_texCoord7_normConstant=function(){return n.texCoordCompressConstant[7]}),Cesium.defined(t.clippingPlanes)&&t.clippingPlanes.enabled&&t.clippingPlanes.length&&(r.model_clippingPlanes=function(){return t.clippingPlanes.texture},r.model_clippingPlanesEdgeStyle=function(){var e=Cesium.Color.clone(t.clippingPlanes.edgeColor);return e.alpha=t.clippingPlanes.edgeWidth,e},r.model_clippingPlanesMatrix=function(){return t.clippingPlanesMatrix}),r}(a,i,this);this.batchTable&&(t=this.batchTable.getUniformMapCallback()(t)),this.colorCommand.uniformMap=t,this.ready=!0}}},v.prototype.update=function(e,t){this.ready?(this.batchTableDirty&&(this.updateBatchTableAttributes(),this.batchTableDirty=!1),this.batchTable&&this.batchTable.update(e),e.commandList.push(this.colorCommand)):(this.createBatchTable(e),this.createPickIds(),this.createBuffers(e),this.createShaderProgram(e),this.createCommand(e),this.initLayerSetting(t))},v.prototype.isDestroyed=function(){return!1},v.prototype.destroy=function(){return this.shaderProgram=this.shaderProgram&&!this.shaderProgram.isDestroyed()&&this.shaderProgram.destroy(),this.vertexArray=this.vertexArray&&!this.vertexArray.isDestroyed()&&this.vertexArray.destroy(),this.material=this.material&&!this.material.isDestroyed()&&this.material.destroy(),this.batchTable=this.batchTable&&!this.batchTable.isDestroyed()&&this.batchTable.destroy(),this.colorCommand=void 0,this.vertexPackage=null,this.arrIndexPackage=null,this.modelMatrix=void 0,this.pickInfo=void 0,this.selectionInfoMap=void 0,this.vs=void 0,this.fs=void 0,Cesium.destroyObject(this)};var fe=v;function C(e){_.call(this,e),this.vs=`
    in vec4 aPosition;
    in vec4 aColor;
#ifdef TexCoord
    in vec4 aTexCoord0;
    uniform float uTexture0Width;
    out vec4 vTexCoord;
    out vec4 vTexMatrix;
    out vec4 vTexCoordTransform;
#endif
    
#ifdef VertexColor
    out vec4 vColor;
#endif
    
    const float SHIFT_LEFT8 = 256.0;
    const float SHIFT_RIGHT8 = 1.0 / 256.0;
    const float SHIFT_RIGHT4 = 1.0 / 16.0;
    const float SHIFT_LEFT4 = 16.0;
    void getTextureMatrixFromZValue(in float nZ, inout float XTran, inout float YTran, inout float scale)
    {
        if(nZ <= 0.0)
        {
            return;
        }
        float nDel8 = floor(nZ * SHIFT_RIGHT8);
        float nDel16 = floor(nDel8 * SHIFT_RIGHT8);
        float nDel20 = floor(nDel16 * SHIFT_RIGHT4);
        YTran = nZ - nDel8 * SHIFT_LEFT8;
        XTran = nDel8 - nDel16 * SHIFT_LEFT8;
        float nLevel = nDel16 - nDel20 * SHIFT_LEFT4;
        scale = 1.0 / pow(2.0, nLevel);
    }
    
    void main()
    {
    #ifdef TexCoord
        vTexCoord.xy = aTexCoord0.xy;
        vTexMatrix = vec4(0.0,0.0,1.0,0.0);
        vTexCoordTransform.x = aTexCoord0.z;
        if(vTexCoordTransform.x < -90000.0)
        {
            vTexMatrix.z = -1.0;
        }
        getTextureMatrixFromZValue(floor(vTexCoordTransform.x), vTexMatrix.x, vTexMatrix.y, vTexMatrix.z);
        vTexMatrix.w = log2(uTexture0Width * vTexMatrix.z);
    #endif
    
        vec4 vertexPos = aPosition;

    #ifdef VertexColor
         vColor = aColor;
    #endif
    
        gl_Position = czm_modelViewProjection * vec4(vertexPos.xyz, 1.0);
    }
`,this.fs=`
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
#endif
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable
#endif
    //>> modify.start(2023-09-20) liuling S3M图层亮度调整
    uniform float udirDiffuseWeight;
    uniform vec4 ubaseColorWithAlpha;
    //>>modify.end
#ifdef TexCoord
    uniform sampler2D uTexture;
    uniform float uTexture0Width;
    in vec4 vTexCoord;
    in vec4 vTexCoordTransform;
    in vec4 vTexMatrix;
#endif

#ifdef VertexColor
    in vec4 vColor;
#endif

#ifdef TexCoord
    void calculateMipLevel(in vec2 inTexCoord, in float vecTile, in float fMaxMip, inout float mipLevel)
    {
        vec2 dx = dFdx(inTexCoord * vecTile);
        vec2 dy = dFdy(inTexCoord * vecTile);
        float dotX = dot(dx, dx);
        float dotY = dot(dy, dy);
        float dMax = max(dotX, dotY);
        float dMin = min(dotX, dotY);
        float offset = (dMax - dMin) / (dMax + dMin);
        offset = clamp(offset, 0.0, 1.0);
        float d = dMax * (1.0 - offset) + dMin * offset;
        mipLevel = 0.5 * log2(d);
        mipLevel = clamp(mipLevel, 0.0, fMaxMip - 1.62);
    }

    void calculateTexCoord(in vec3 inTexCoord, in float scale, in float XTran, in float YTran, in float fTile, in float mipLevel, inout vec2 outTexCoord)
    {
        if(inTexCoord.z < -9000.0)
        {
            outTexCoord = inTexCoord.xy;
        }
        else
        {
            vec2 fTexCoord = fract(inTexCoord.xy);
            float offset = 1.0 * pow(2.0, mipLevel) / fTile;
            fTexCoord = clamp(fTexCoord, offset, 1.0 - offset);
            outTexCoord.x = (fTexCoord.x + XTran) * scale;
            outTexCoord.y = (fTexCoord.y + YTran) * scale;
        }
    }
    
    vec4 getTexColorForS3M(sampler2D curTexture, vec3 oriTexCoord, float texTileWidth, float fMaxMipLev, float fTexCoordScale, vec2 vecTexCoordTranslate)
    {
        vec4 color = vec4(1.0);
        float mipLevel = 0.0;
    #ifdef GL_OES_standard_derivatives
        calculateMipLevel(oriTexCoord.xy, texTileWidth, fMaxMipLev, mipLevel);
    #endif
        vec2 realTexCoord;
        calculateTexCoord(oriTexCoord, fTexCoordScale, vecTexCoordTranslate.x, vecTexCoordTranslate.y, texTileWidth, mipLevel, realTexCoord);
        if(oriTexCoord.z < -9000.0)
        {
            color = texture(curTexture, realTexCoord.xy);
        }
        else
        {
            #ifdef GL_EXT_shader_texture_lod
                color = textureLodEXT(curTexture, realTexCoord.xy, mipLevel);
            #else
                color = texture(curTexture, realTexCoord.xy, mipLevel);
            #endif
        }
        return color;
    }

    vec4 getTextureColor()
    {
        if(vTexMatrix.z < 0.0)
        {
            return vec4(1.0);
        }
        float texTileWidth0 = vTexMatrix.z * uTexture0Width;
        vec3 realTexCoord = vec3(vTexCoord.xy, vTexCoordTransform.x);
        return getTexColorForS3M(uTexture, realTexCoord, texTileWidth0, vTexMatrix.w, vTexMatrix.z, vTexMatrix.xy);
    }
#endif
    
//>>modify.start
#ifdef HAS_CLIPPING_PLANES
    uniform sampler2D model_clippingPlanes;
    uniform vec4 model_clippingPlanesEdgeStyle;
    uniform mat4 model_clippingPlanesMatrix;

#ifdef USE_CLIPPING_PLANES_FLOAT_TEXTURE
    vec4 getClippingPlane(
        highp sampler2D packedClippingPlanes,
        int clippingPlaneNumber,
        mat4 transform
    ) {
        int pixY = clippingPlaneNumber / CLIPPING_PLANES_TEXTURE_WIDTH;
        int pixX = clippingPlaneNumber - (pixY * CLIPPING_PLANES_TEXTURE_WIDTH);
        float pixelWidth = 1.0 / float(CLIPPING_PLANES_TEXTURE_WIDTH);
        float pixelHeight = 1.0 / float(CLIPPING_PLANES_TEXTURE_HEIGHT);
        float u = (float(pixX) + 0.5) * pixelWidth; 
        float v = (float(pixY) + 0.5) * pixelHeight;
        vec4 plane = texture(packedClippingPlanes, vec2(u, v));
        return czm_transformPlane(plane, transform);
    }
#else
    
    vec4 getClippingPlane(
        highp sampler2D packedClippingPlanes,
        int clippingPlaneNumber,
        mat4 transform
    ) {
        int clippingPlaneStartIndex = clippingPlaneNumber * 2; 
        int pixY = clippingPlaneStartIndex / CLIPPING_PLANES_TEXTURE_WIDTH;
        int pixX = clippingPlaneStartIndex - (pixY * CLIPPING_PLANES_TEXTURE_WIDTH);
        float pixelWidth = 1.0 / float(CLIPPING_PLANES_TEXTURE_WIDTH);
        float pixelHeight = 1.0 / float(CLIPPING_PLANES_TEXTURE_HEIGHT);
        float u = (float(pixX) + 0.5) * pixelWidth; 
        float v = (float(pixY) + 0.5) * pixelHeight;
        vec4 oct32 = texture(packedClippingPlanes, vec2(u, v)) * 255.0;
        vec2 oct = vec2(oct32.x * 256.0 + oct32.y, oct32.z * 256.0 + oct32.w);
        vec4 plane;
        plane.xyz = czm_octDecode(oct, 65535.0);
        plane.w = czm_unpackFloat(texture(packedClippingPlanes, vec2(u + pixelWidth, v)));
        return czm_transformPlane(plane, transform);
    }
#endif
    
    float clip(vec4 fragCoord, sampler2D clippingPlanes, mat4 clippingPlanesMatrix) {
        vec4 position = czm_windowToEyeCoordinates(fragCoord);
        vec3 clipNormal = vec3(0.0);
        vec3 clipPosition = vec3(0.0);
        float pixelWidth = czm_metersPerPixel(position);
        
    #ifdef UNION_CLIPPING_REGIONS
        float clipAmount; 
    #else
        float clipAmount = 0.0;
        bool clipped = true;
    #endif
    
        for (int i = 0; i < CLIPPING_PLANES_LENGTH; ++i) {
            vec4 clippingPlane = getClippingPlane(clippingPlanes, i, clippingPlanesMatrix);
            clipNormal = clippingPlane.xyz;
            clipPosition = -clippingPlane.w * clipNormal;
            float amount = dot(clipNormal, (position.xyz - clipPosition)) / pixelWidth;
            
            #ifdef UNION_CLIPPING_REGIONS
            clipAmount = czm_branchFreeTernary(i == 0, amount, min(amount, clipAmount));
            if (amount <= 0.0) {
                discard;
            }
            #else
            clipAmount = max(amount, clipAmount);
            clipped = clipped && (amount <= 0.0);
            #endif
        }
    
    #ifndef UNION_CLIPPING_REGIONS
        if (clipped) {
            discard;
        }
    #endif
        
        return clipAmount;
    }
    
    void modelClippingPlanesStage(inout vec4 color)
    {
        float clipDistance = clip(gl_FragCoord, model_clippingPlanes, model_clippingPlanesMatrix);
        vec4 clippingPlanesEdgeColor = vec4(1.0);
        clippingPlanesEdgeColor.rgb = model_clippingPlanesEdgeStyle.rgb;
        float clippingPlanesEdgeWidth = model_clippingPlanesEdgeStyle.a;
        
        if (clipDistance > 0.0 && clipDistance < clippingPlanesEdgeWidth) {
            color = clippingPlanesEdgeColor;
        }
    }
#endif
    //>>modify.end

    void main()
    {
        //>> modify.start(2023-09-20) liuling S3M图层亮度调整
        // vec4 baseColorWithAlpha = vec4(1.0);
        vec4 baseColorWithAlpha = ubaseColorWithAlpha;
        //>>modify.end
        
    #ifdef VertexColor
        vec4 baseColorWithAlpha = vColor;
    #endif
    
    #ifdef TexCoord
        baseColorWithAlpha *= getTextureColor();
    #endif
        //>> modify.start(2023-09-20) liuling S3M图层亮度调整
        float dirDiffuseWeight = udirDiffuseWeight;
        vec3 adjustedColor = baseColorWithAlpha.rgb * dirDiffuseWeight;

        //>>modify.start
        vec4 colorResult = vec4(adjustedColor, baseColorWithAlpha.a);
    #ifdef HAS_CLIPPING_PLANES
        modelClippingPlanesStage(colorResult);
    #endif
        out_FragColor = colorResult;
        // out_FragColor = vec4(adjustedColor, baseColorWithAlpha.a);
        //>>modify.end

        // out_FragColor = baseColorWithAlpha * 0.5;
        //>>modify.end
    }
`}(C.prototype=Object.create(_.prototype)).constructor=_,C.prototype.createCommand=function(){var e,t,i,r,n,o,s,a,l;Cesium.defined(this.colorCommand)||0!==this.vertexBufferToCreate.length||0!==this.indexBufferToCreate.length||0!==this.shaderProgramToCreate.length||(l=(e=this.layer).context,t=this.vertexPackage,r=this.arrIndexPackage,i=t.vertexAttributes,r.length<1)||(r=r[0],n=this.material,this.vertexArray=new Cesium.VertexArray({context:l,attributes:i,indexBuffer:r.indexBuffer}),this.colorCommand=new Cesium.DrawCommand({castShadows:!0,receiveShadows:!0,primitiveType:r.primitiveType,modelMatrix:this.modelMatrix,boundingVolume:Cesium.BoundingSphere.clone(this.boundingVolume),vertexArray:this.vertexArray,shaderProgram:this.shaderProgram,pass:n.bTransparentSorting?Cesium.Pass.TRANSLUCENT:Cesium.Pass.OPAQUE,renderState:Cesium.RenderState.fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:Cesium.DepthFunction.LESS_OR_EQUAL},blending:Cesium.BlendingState.ALPHA_BLEND}),instanceCount:t.instanceCount}),this.colorCommand.uniformMap=(o=n,s=e,a=this,l={uGeoMatrix:function(){return a.geoMatrix},uInverseGeoMatrix:function(){return a.invGeoMatrix},uTexture:function(){return o.textures[0]},uTexture0Width:function(){return o.textures[0].width},udirDiffuseWeight:function(){return s.dirDiffuseWeight},ubaseColorWithAlpha:function(){return s.baseColorWithAlpha}},Cesium.defined(s.clippingPlanes)&&s.clippingPlanes.enabled&&s.clippingPlanes.length&&(l.model_clippingPlanes=function(){return s.clippingPlanes.texture},l.model_clippingPlanesEdgeStyle=function(){var e=Cesium.Color.clone(s.clippingPlanes.edgeColor);return e.alpha=s.clippingPlanes.edgeWidth,e},l.model_clippingPlanesMatrix=function(){return s.clippingPlanesMatrix}),l),this.ready=!0)},C.prototype.update=function(e,t){this.ready?e.commandList.push(this.colorCommand):(this.createBuffers(e),this.createShaderProgram(e),this.createCommand(e),this.initLayerSetting(t))},C.prototype.isDestroyed=function(){return!1},C.prototype.destroy=function(){return this.shaderProgram=this.shaderProgram&&!this.shaderProgram.isDestroyed()&&this.shaderProgram.destroy(),this.vertexArray=this.vertexArray&&!this.vertexArray.isDestroyed()&&this.vertexArray.destroy(),this.material=this.material&&!this.material.isDestroyed()&&this.material.destroy(),this.colorCommand=void 0,this.vertexPackage=null,this.arrIndexPackage=null,this.modelMatrix=void 0,this.pickInfo=void 0,this.selectionInfoMap=void 0,this.vs=void 0,this.fs=void 0,Cesium.destroyObject(this)};var de=C,ge={OSGBFile:function(e){return new de(e)},OSGBCacheFile:function(e){return new fe(e)}};function me(){}let ye=new Cesium.Cartesian3;function _e(e,o){if(-1<e.instanceIndex)return a=e,u=new Cesium.BoundingSphere,a=a.instanceBounds,Cesium.defined(a)&&(l=new Cesium.Cartesian3(a[0],a[1],a[2]),a=new Cesium.Cartesian3(a[3],a[4],a[5]),a=new Cesium.Cartesian3.lerp(l,a,.5,ye),l=new Cesium.Cartesian3.distance(a,l),u.center=a,u.radius=l),u;{var s=e,a=o,l=new Cesium.BoundingSphere;let t=new Cesium.Cartesian3;var u=s.vertexAttributes[0],c=u.componentsPerAttribute,h=Cesium.defined(s.compressOptions)&&(s.compressOptions&p.SVC_Vertex)===p.SVC_Vertex;let i=1,r,n;n=h?(i=s.vertCompressConstant,r=new Cesium.Cartesian3(s.minVerticesValue.x,s.minVerticesValue.y,s.minVerticesValue.z),new Uint16Array(u.typedArray.buffer,u.typedArray.byteOffset,u.typedArray.byteLength/2)):new Float32Array(u.typedArray.buffer,u.typedArray.byteOffset,u.typedArray.byteLength/4);var A=[];for(let e=0;e<s.verticesCount;e++)Cesium.Cartesian3.fromArray(n,c*e,t),h&&(t=Cesium.Cartesian3.multiplyByScalar(t,i,t),t=Cesium.Cartesian3.add(t,r,t)),A.push(Cesium.Cartesian3.clone(t));return Cesium.BoundingSphere.fromPoints(A,l),Cesium.BoundingSphere.transform(l,a,l),A.length=0,l}}const ve=new Cesium.Matrix3;function Ce(i,r,n){var o=r.groupNode,s=[];for(let e=0,t=o.pageLods.length;e<t;e++){var a,l,u={},c=o.pageLods[e],h=(u.rangeMode=c.rangeMode,u.rangeDataList=c.childTile,u.rangeList=c.rangeList,c.obb?u.boundingVolume={box:{center:c.obb.obbCenter,xExtent:c.obb.xExtent,yExtent:c.obb.yExtent,zExtent:c.obb.zExtent}}:(a=c.boundingSphere.center,l=c.boundingSphere.radius,""!==u.rangeDataList?u.boundingVolume={sphere:{center:new Cesium.Cartesian3(a.x,a.y,a.z),radius:l}}:u.isLeafTile=!0),L=D=T=P=S=I=M=B=E=C=y=v=m=_=b=x=w=g=d=f=p=A=h=void 0,i),A=r,p=n,f=u,d={},g=c.geodes;for(let t=0,e=g.length;t<e;t++){var m,y,_,v,C,w=g[t],x=w.matrix,b=Cesium.Matrix4.multiply(h.modelMatrix,x,new Cesium.Matrix4);let e;Cesium.defined(f.boundingVolume)&&(f.boundingVolume.sphere?(e=new Cesium.BoundingSphere(f.boundingVolume.sphere.center,f.boundingVolume.sphere.radius),Cesium.BoundingSphere.transform(e,h.modelMatrix,e)):f.boundingVolume.box&&(_=f.boundingVolume.box,m=new Cesium.Cartesian3(_.center.x,_.center.y,_.center.z),v=new Cesium.Cartesian4(_.xExtent.x,_.xExtent.y,_.xExtent.z,0),y=new Cesium.Cartesian4(_.yExtent.x,_.yExtent.y,_.yExtent.z,0),_=new Cesium.Cartesian4(_.zExtent.x,_.zExtent.y,_.zExtent.z,0),C=new Cesium.Matrix3,Cesium.Matrix3.setColumn(C,0,v,C),Cesium.Matrix3.setColumn(C,1,y,C),Cesium.Matrix3.setColumn(C,2,_,C),m=Cesium.Matrix4.multiplyByPoint(h.modelMatrix,m,m),v=Cesium.Matrix4.getMatrix3(h.modelMatrix,ve),C=Cesium.Matrix3.multiply(v,C,C),e=new Cesium.OrientedBoundingBox(m,C)));var E=w.skeletonNames;for(let t=0,e=E.length;t<e;t++){var B=E[t],M=A.geoPackage[B],I=M.vertexPackage,S=M.arrIndexPackage,P=M.pickInfo;let e;0<S.length&&(e=p[S[0].materialCode]);var T=_e(I,b);d[B]=ge[h.fileType]({layer:h,vertexPackage:I,arrIndexPackage:S,pickInfo:P,modelMatrix:b,geoMatrix:x,boundingVolume:T,material:e,edgeGeometry:M.edgeGeometry,geoName:B})}}if(!(Object.keys(d).length<1)){if(!Cesium.defined(f.boundingVolume)){var L,D=[];for(L in d)d.hasOwnProperty(L)&&D.push(d[L].boundingVolume);f.boundingVolume={sphere:Cesium.BoundingSphere.fromBoundingSpheres(D)}}f.geoMap=d}Cesium.defined(u.geoMap)&&s.push(u)}return s}me.parse=function(e,t,i){if(Cesium.defined(t))return Ce(e,t,function(i,r,n){var o={},s=r.materials.material;for(let e=0,t=s.length;e<t;e++){var a=s[e].material,l=a.id,u=new ae,c=a.ambient,l=((o[l]=u).ambientColor=new Cesium.Color(c.r,c.g,c.b,c.a),a.diffuse),c=(u.diffuseColor=new Cesium.Color(l.r,l.g,l.b,l.a),a.specular),h=(u.specularColor=new Cesium.Color(c.r,c.g,c.b,c.a),u.shininess=a.shininess,u.bTransparentSorting=a.transparentsorting,a.textureunitstates),A=h.length;for(let e=0;e<A;e++){var p=h[e].textureunitstate,f=p.id,d=0===p.addressmode.u?Cesium.TextureWrap.REPEAT:Cesium.TextureWrap.CLAMP_TO_EDGE,g=0===p.addressmode.v?Cesium.TextureWrap.REPEAT:Cesium.TextureWrap.CLAMP_TO_EDGE,p=(u.texMatrix=Cesium.Matrix4.unpack(p.texmodmatrix),r.texturePackage[f]);if(Cesium.defined(p)&&0<p.arrayBufferView.byteLength){p.wrapS=d,p.wrapT=g;var m=n.fileName+f;let e=i.textureCache.getTexture(m);Cesium.defined(e)||(Cesium.PixelFormat.isCompressedFormat(p.internalFormat)?e=new se(i,f,p):(f=Cesium.Math.isPowerOfTwo(p.width)&&Cesium.Math.isPowerOfTwo(p.height),e=new Cesium.Texture({context:i,source:{width:p.width,height:p.height,arrayBufferView:p.arrayBufferView},sampler:new Cesium.Sampler({minificationFilter:f?i._gl.LINEAR_MIPMAP_LINEAR:i._gl.LINEAR,wrapS:d,wrapT:g})}),f&&e.generateMipmap(Cesium.MipmapHint.NICEST)),i.textureCache.addTexture(m,e)),u.textures.push(e)}}}return o}(e.context,t,i))};var we=me,w=Object.freeze({Distance:0,Pixel:1,GeometryError:2});function x(e,t,i,r,n,o){this.layer=e,this.parent=t;var s=r.replace(/\\/g,"/"),r=(this.fileExtension=Cesium.getExtensionFromUri(r),this.relativePath=function(e,t){e=e.replace(/\+/g,"%2B");let i=t._basePath,r="";-1!=i.indexOf("?")&&(r=i.split("?")[1],i=i.split("?")[0]);t=-1<t._basePath.indexOf("realspace");if(!t)return e;let n=i.replace(/(.*realspace)/,""),o=i.replace(/\/rest\/realspace/g,"").replace(n,""),s="";s=r?o+"/rest/realspace"+n+"data/path/"+e.replace(/^\.*/,"").replace(/^\//,"").replace(/\/$/,"")+"?"+r:o+"/rest/realspace"+n+"data/path/"+e.replace(/^\.*/,"").replace(/^\//,"").replace(/\/$/,"");return s}(s,e),this.fileName=r,this.isLeafTile=0===n,this.isRootTile=!1,this.boundingVolume=this.createBoundingVolume(i,e.modelMatrix),Cesium.Resource.createIfNeeded(e._baseResource));Cesium.defined(t)?this.baseUri=t.baseUri:(i=new Cesium.Resource(s),this.baseUri=i.getBaseUri()),this.contentResource=r.getDerivedResource({url:this.relativePath}),this.serverKey=Cesium.RequestScheduler.getServerKey(this.contentResource.getUrlComponent()),this.request=void 0,this.cacheNode=void 0,this.distanceToCamera=0,this.centerZDepth=0,this.pixel=0,this.depth=t?t.depth+1:0,this.visibilityPlaneMask=0,this.visible=!1,this.children=[],this.renderEntities=[],this.lodRangeData=Cesium.defaultValue(n,16),this.lodRangeMode=Cesium.defaultValue(o,w.Pixel),this.contentState=this.isLeafTile?g.READY:g.UNLOADED,this.touchedFrame=0,this.requestedFrame=0,this.processFrame=0,this.selectedFrame=0,this.updatedVisibilityFrame=0,this.foveatedFactor=0,this.priority=0,(this.priorityHolder=this).wasMinPriorityChild=!1,this.shouldSelect=!1,this.selected=!1,this.finalResolution=!0,this.refines=!1,this._debugBoundingVolume=void 0,this._ancestorWithContent=void 0,this._ancestorWithContentAvailable=void 0}Object.defineProperties(x.prototype,{renderable:{get:function(){var t=this.renderEntities,i=t.length;if(0===i)return!1;for(let e=0;e<i;e++)if(!t[e].ready)return!1;return!0}}});let xe=new Cesium.Cartesian3;const be=new Cesium.Matrix3;function Ee(e){return e.boundingVolume}x.prototype.createBoundingVolume=function(e,t){return Cesium.defined(e.sphere)?(a=e.sphere,l=t,u=Cesium.Cartesian3.clone(a.center),a=a.radius,u=Cesium.Matrix4.multiplyByPoint(l,u,u),l=Cesium.Matrix4.getScale(l,xe),a*=Cesium.Cartesian3.maximumComponent(l),new Cesium.TileBoundingSphere(u,a)):Cesium.defined(e.box)?(l=e.box,u=t,new(Cesium.defined(l.center)?(o=new Cesium.Cartesian3(l.center.x,l.center.y,l.center.z),n=new Cesium.Cartesian4(l.xExtent.x,l.xExtent.y,l.xExtent.z,0),i=new Cesium.Cartesian4(l.yExtent.x,l.yExtent.y,l.yExtent.z,0),r=new Cesium.Cartesian4(l.zExtent.x,l.zExtent.y,l.zExtent.z,0),s=new Cesium.Matrix3,Cesium.Matrix3.setColumn(s,0,n,s),Cesium.Matrix3.setColumn(s,1,i,s),Cesium.Matrix3.setColumn(s,2,r,s),o=Cesium.Matrix4.multiplyByPoint(u,o,o),n=Cesium.Matrix4.getMatrix3(u,be),s=Cesium.Matrix3.multiply(n,s,s),Cesium.TileOrientedBoundingBox):(i=new Cesium.Cartesian3(l.min.x,l.min.y,l.min.z),Cesium.Matrix4.multiplyByPoint(u,i,i),r=new Cesium.Cartesian3(l.max.x,l.max.y,l.max.z),Cesium.Matrix4.multiplyByPoint(u,r,r),o=(n=Cesium.BoundingSphere.fromCornerPoints(i,r,new Cesium.BoundingSphere)).center,s=n.radius,l=Cesium.Matrix4.getScale(u,xe),s*=Cesium.Cartesian3.maximumComponent(l),Cesium.TileBoundingSphere))(o,s)):void 0;var i,r,n,o,s,a,l,u},x.prototype.canTraverse=function(){return 0!==this.children.length&&!this.isLeafTile&&(!Cesium.defined(this.lodRangeData)||this.pixel>this.lodRangeData)},x.prototype.getPixel=function(e){var t=this.boundingVolume.boundingSphere,i=t.radius,t=t.center,t=Cesium.Cartesian3.distance(e.camera.positionWC,t),r=e.context.drawingBufferHeight,e=.5*e.camera.frustum._fovy;return.5*r/Math.tan(e)*i/t},x.prototype.getGeometryError=function(e){var t=e.camera,i=this.layer.context.drawingBufferHeight;return this.lodRangeData*i/(this.boundingVolume.distanceToCamera(e)*t.frustum.sseDenominator)},x.prototype.distanceToTile=function(e){return Ee(this).distanceToCamera(e)};let Be=new Cesium.Cartesian3,b=(x.prototype.distanceToTileCenter=function(e){var t=Ee(this).boundingVolume,t=Cesium.Cartesian3.subtract(t.center,e.camera.positionWC,Be);return Cesium.Cartesian3.dot(e.camera.directionWC,t)},x.prototype.getScreenSpaceError=function(e,t,i){var r=this.layer,i=Cesium.defaultValue(i,1),n=Cesium.defined(this.parent)?this.parent.geometryError:r._scaledGeometricError,t=t?n:this.geometryError;if(0===t)return 0;var{camera:n,context:o}=e;let s=n.frustum;var n=o.drawingBufferWidth,o=o.drawingBufferHeight*i;let a;return e.mode===Cesium.SceneMode.SCENE2D||s instanceof Cesium.OrthographicFrustum?(i=s.offCenterFrustum,Cesium.defined(i)&&(s=i),i=Math.max(s.top-s.bottom,s.right-s.left)/Math.max(n,o),a=t/i):(n=Math.max(this.distanceToCamera,Cesium.Math.EPSILON7),i=s.sseDenominator,a=t*o/(n*i),r.dynamicScreenSpaceError&&(t=r._dynamicScreenSpaceErrorComputedDensity,o=r.dynamicScreenSpaceErrorFactor,i=Cesium.Math.fog(n,t)*o,a-=i)),a/=e.pixelRatio},x.prototype.visibility=function(e,t){var i=Ee(this);return e.cullingVolume.computeVisibilityWithPlaneMask(i,t)},new Cesium.Cartesian3);function Me(e,n,t){e._cache.add(n),i.s3tc=e.context.s3tc,i.pvrtc=e.context.pvrtc,i.etc1=e.context.etc1;t=i.parseBuffer(t);if(t){e=we.parse(e,t,n);{var o=n;var s=e;var a=o.layer,l=s.length;let t=Number.MAX_VALUE,i=0,r=w.Pixel;for(let e=0;e<l;e++){var u,c=s[e],h=c.boundingVolume,A=c.rangeDataList,A=o.baseUri+A,p=c.rangeList,f=c.rangeMode,d=c.geoMap;for(u in 0!==p&&(c=new x(a,o,h,A,p,f),o.children.push(c),a._cache.add(c)),d)d.hasOwnProperty(u)&&o.renderEntities.push(d[u]);t=Math.min(t,p),i=Math.max(i,p),r=f}o.isRootTile&&(o.lodRangeData=r===w.Pixel?t/2:2*i,o.lodRangeMode=r)}n.selectedFrame=0,n.contentState=g.READY,n.contentReadyPromise.resolve(t)}else n.contentState=g.FAILED,n.contentReadyPromise.reject()}function Ie(e,t,i){return Math.max(Cesium.Math.normalize(e,t,i)-Cesium.Math.EPSILON7,0)}function Se(e,t,i){e*=Math.pow(10,t);return parseInt(e)*Math.pow(10,i)}x.prototype.updateVisibility=function(e,t){var i,r,n=this.parent,n=Cesium.defined(n)?n.visibilityPlaneMask:Cesium.CullingVolume.MASK_INDETERMINATE;this.distanceToCamera=this.distanceToTile(e),this.centerZDepth=this.distanceToTileCenter(e),this.pixel=this.getPixel(e),this.geometryError=this.getGeometryError(e),this.visibilityPlaneMask=this.visibility(e,n),this._screenSpaceError=this.getScreenSpaceError(e,!1),this.visible=this.visibilityPlaneMask!==Cesium.CullingVolume.MASK_OUTSIDE&&this.distanceToCamera>=t.visibleDistanceMin&&this.distanceToCamera<=t.visibleDistanceMax&&t.show,this.priorityDeferred=(n=this,t=(t=e).camera,e=n.boundingVolume.boundingSphere,i=e.radius,r=Cesium.Cartesian3.multiplyByScalar(t.directionWC,n.centerZDepth,b),r=Cesium.Cartesian3.add(t.positionWC,r,b),r=Cesium.Cartesian3.subtract(r,e.center,b),void(i<Cesium.Cartesian3.magnitude(r)?(r=Cesium.Cartesian3.normalize(r,b),r=Cesium.Cartesian3.multiplyByScalar(r,i,b),i=Cesium.Cartesian3.add(e.center,r,b),e=Cesium.Cartesian3.subtract(i,t.positionWC,b),r=Cesium.Cartesian3.normalize(e,b),n.foveatedFactor=1-Math.abs(Cesium.Cartesian3.dot(t.directionWC,r))):n.foveatedFactor=0))},x.prototype.requestContent=function(){let t=this,i=this.layer;var e,r=this.contentResource.clone();let n=new Cesium.Request({throttle:!0,throttleByServer:!0,type:Cesium.RequestType.TILES3D,priorityFunction:function(){return e.priority},serverKey:(e=this).serverKey});this.request=n,r.request=n;var o,r=r.fetchArrayBuffer();if(!Cesium.defined(r))return!1;this.contentState=g.LOADING,this.contentReadyPromise=Cesium.defer();o=this;let s=function(e){o.contentState=g.FAILED,o?.contentReadyPromise&&o.contentReadyPromise.reject(e)};return r.then(function(e){t.isDestroyed()?s():Me(i,t,e)}).catch(function(e){n.state===Cesium.RequestState.CANCELLED?t.contentState=g.UNLOADED:s(e)}),!0},x.prototype.updatePriority=function(e,t){var i=e._minimumPriority,e=e._maximumPriority,r=Se(Ie(this.foveatedFactor,i.foveatedFactor,e.foveatedFactor),4,4),n=Se(1-Ie(this.pixel,i.pixel,e.pixel),4,8),i=Ie(this.distanceToCamera,i.distance,e.distance),e=Se(i,4,0);this.priority=r+n+e},x.prototype.update=function(t,i){this.commandDirty=!1,this.clippingPlanes!==i.clippingPlanes&&(this.commandDirty=!0,this.clippingPlanes=i.clippingPlanes);for(let e=0;e<this.renderEntities.length;e++){var r=this.renderEntities[e];this.commandDirty&&(r.shaderProgramToCreate.enqueue(0),r.colorCommand=void 0,r.ready=!1),r.update(t,i)}},x.prototype.free=function(){this.contentState=g.UNLOADED,this.request=void 0,this.cacheNode=void 0,this.priorityHolder=void 0,this.contentReadyPromise=void 0,this.priorityHolder=void 0;for(let e=0,t=this.renderEntities.length;e<t;e++)this.renderEntities[e].destroy();this.renderEntities.length=0,this.children.length=0},x.prototype.isDestroyed=function(){return!1},x.prototype.destroy=function(){return this.free(),Cesium.destroyObject(this)};var Pe=x;function Te(){this._stack=[]}function Le(e,t){return 0===t.distanceToCamera&&0===e.distanceToCamera?t.centerZDepth-e.centerZDepth:t.distanceToCamera-e.distanceToCamera}function De(e,t,i){t.selectedFrame!==i.frameNumber&&t.renderable&&(e._selectedTiles.push(t),t.selectedFrame=i.frameNumber)}function E(e,t,i){t.requestedFrame!==i.frameNumber&&t.contentState===g.UNLOADED&&(e._requestTiles.push(t),t.requestedFrame=i.frameNumber)}function Fe(e,t,i){t.processFrame===i.frameNumber||t.contentState!==g.READY||t.renderable||(t.processFrame=i.frameNumber,e._processTiles.push(t))}function Ne(e,t,i){t.touchedFrame!==i.frameNumber&&(e._cache.touch(t),t.touchedFrame=i.frameNumber)}function Oe(e,t,i){var r,n;r=r=t,e=e=e,(n=n=i).updatedVisibilityFrame!==e.frameNumber&&(n.updatedVisibilityFrame=e.frameNumber,n.updateVisibility(e,r)),i.wasMinPriorityChild=!1,i.priorityHolder=i,n=i,(e=t)._maximumPriority.distance=Math.max(n.distanceToCamera,e._maximumPriority.distance),e._minimumPriority.distance=Math.min(n.distanceToCamera,e._minimumPriority.distance),e._maximumPriority.depth=Math.max(n.depth,e._maximumPriority.depth),e._minimumPriority.depth=Math.min(n.depth,e._minimumPriority.depth),e._maximumPriority.foveatedFactor=Math.max(n.foveatedFactor,e._maximumPriority.foveatedFactor),e._minimumPriority.foveatedFactor=Math.min(n.foveatedFactor,e._minimumPriority.foveatedFactor),e._maximumPriority.pixel=Math.max(n.pixel,e._maximumPriority.pixel),e._minimumPriority.pixel=Math.min(n.pixel,e._minimumPriority.pixel),i.shouldSelect=!1,i.selected=!1}function Re(e){return e.skipLevelOfDetail&&!e._allTilesAdditive}function Ue(t,i,r){for(;i.length;){var n=i.pop(),o=(Re(t)&&(o=r,h=void 0,(s=n)._ancestorWithContent=void 0,s._ancestorWithContentAvailable=void 0,h=s.parent,Cesium.defined(h))&&(o=h.contentState!==g.UNLOADED||h._requestedFrame===o.frameNumber,s._ancestorWithContent=o?h:h._ancestorWithContent,s._ancestorWithContentAvailable=h.contentAvailable?h:h._ancestorWithContentAvailable),n.parent),s=!Cesium.defined(o)||o.refines;let e=!1;h=t;c=!(e=0!==(c=n).children.length&&(c.lodRangeMode===w.Pixel?c.pixel/h.lodRangeScale>c.lodRangeData:c.lodRangeMode===w.GeometryError?c.geometryError>h._minGeometryError:c.distanceToCamera*h.lodRangeScale<c.lodRangeData)?function(e,t,i,r){let n;var o=t.children,s=o.length;for(n=0;n<s;++n)Oe(r,e,o[n]);o.sort(Le);let a=!0,l=!1,u=-1,c=Number.MAX_VALUE;for(n=0;n<s;++n){var h=o[n],h=(h.foveatedFactor<c&&(u=n,c=h.foveatedFactor),h.visible?(i.push(h),l=!0):(E(e,h,r),Ne(e,h,r),Fe(e,h,r)),h.renderable);a=a&&h}if(l||(a=!1),-1!==u){var A=o[u],p=(A.wasMinPriorityChild=!0,(t.wasMinPriorityChild||t.isRootTile)&&c<=t.priorityHolder.foveatedFactor?t.priorityHolder:t);for(p.foveatedFactor=Math.min(A.foveatedFactor,p.foveatedFactor),p.distanceToCamera=Math.min(A.distanceToCamera,p.distanceToCamera),n=0;n<s;++n)o[n].priorityHolder=p}return a}(t,n,i,r)&&s:e)&&s;t._dynamicScreenSpaceError?n._screenSpaceError>t._maximumScreenSpaceError&&(E(t,n,r),c)&&De(t,n,r):Re(t)?c?(E(t,n,r),De(t,n,r)):(a=t,u=void 0,u=(l=n)._ancestorWithContent,Cesium.defined(u)&&l._screenSpaceError<u._screenSpaceError/a.skipScreenSpaceErrorFactor&&l.depth>u.depth+a.skipLevels&&E(t,n,r)):(E(t,n,r),c&&De(t,n,r)),Fe(t,n,r),Ne(t,n,r),n.refines=e}var a,l,u,c,s,o,h}Te.prototype.schedule=function(e,t){var i=this._stack,r=e,n=i,o=t;for(let e=n.length=0,t=r._rootTiles.length;e<t;e++){var s=r._rootTiles[e];Oe(o,r,s),s.visible&&n.push(s)}Ue(e,i,t);var a=e,l=t,u=a._requestTiles,c=u.length;for(let e=0;e<c;++e)u[e].updatePriority(a,l)};var ke=Te;function B(){this._list=new Cesium.DoublyLinkedList,this._sentinel=this._list.add(),this._trimTiles=!1}B.prototype.reset=function(){this._list.splice(this._list.tail,this._sentinel)},B.prototype.touch=function(e){e=e.cacheNode;Cesium.defined(e)&&this._list.splice(this._sentinel,e)},B.prototype.add=function(e){Cesium.defined(e.cacheNode)||(e.cacheNode=this._list.add(e))},B.prototype.unloadTile=function(e,t,i){var r=t.cacheNode;Cesium.defined(r)&&(this._list.remove(r),t.cacheNode=void 0,i(e,t))},B.prototype.unloadTiles=function(e,t){var i=this._trimTiles,r=(this._trimTiles=!1,this._list),n=1024*e.maximumMemoryUsage*1024,o=this._sentinel;let s=r.head;for(;s&&s!==o&&(e.totalMemoryUsageInBytes>n||i);){var a=s.item;s=s.next,this.unloadTile(e,a,t)}},B.prototype.trim=function(){this._trimTiles=!0};var He=B,M=Object.freeze({RESET:0,SetColor:1,SELECTED:2,HIDE:4,OFFSET:8,CLIP:16,BLOOM:32,ALL:255});function Qe(){this._fillForeColor=new Cesium.Color,this._lineColor=new Cesium.Color,this._lineWidth=1,this._bottomAltitude=0,this._pointSize=1,this._pointColor=new Cesium.Color}Object.defineProperties(Qe.prototype,{fillForeColor:{get:function(){return this._fillForeColor},set:function(e){Cesium.Check.typeOf.object("fillForeColor value",e),Cesium.Color.clone(e,this._fillForeColor)}},bottomAltitude:{get:function(){return this._bottomAltitude},set:function(e){Cesium.Check.typeOf.number("bottomAltitude value",e),this._bottomAltitude!==e&&(this._bottomAltitude=e,this._dirty=!0)}},altitudeMode:{get:function(){return this._altitudeMode},set:function(e){Cesium.Check.typeOf.number("altitudeMode value",e),this._altitudeMode=e}},lineColor:{get:function(){return this._lineColor},set:function(e){Cesium.Check.typeOf.object("line color",e),Cesium.Color.clone(e,this._lineColor)}},lineWidth:{get:function(){return this._lineWidth},set:function(e){Cesium.Check.typeOf.number("line width",e),this._lineWidth=e}},pointSize:{get:function(){return this._pointSize},set:function(e){Cesium.Check.typeOf.number("point size",e),this._pointSize=e}},pointColor:{get:function(){return this._pointColor},set:function(e){Cesium.Check.typeOf.object("point color",e),Cesium.Color.clone(e,this._pointColor)}}});var Ve=Qe;function S(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),Cesium.Check.defined("options.url",e.url),Cesium.Check.defined("options.context",e.context),this.id=Cesium.createGuid(),this.name=e.name,this.nameCn=e.nameCn,this.context=e.context,this._url=void 0,this._basePath=void 0,this._baseResource=void 0,this.modelMatrix=new Cesium.Matrix4,this.invModelMatrix=new Cesium.Matrix4,this._visibleDistanceMax=Cesium.defaultValue(e.maxVisibleDistance,Number.MAX_VALUE),this._visibleDistanceMin=Cesium.defaultValue(e.minVisibleDistance,0),this._lodRangeScale=Cesium.defaultValue(e.lodRangeScale,1),this._selectedColor=new Cesium.Color(.7,.7,1,1),this.fileType=void 0,this._position=void 0,this._rectangle=void 0,this._rootTiles=[],this._schuduler=new ke,this._selections=[],this._objsOperationList={},this._requestTiles=[],this._processTiles=[],this._selectedTiles=[],this._cache=new He,this._maximumMemoryUsage=Cesium.defaultValue(e.maximumMemoryUsage,-1),this._totalMemoryUsageInBytes=Cesium.defaultValue(e.totalMemoryUsageInBytes,0),this._vertexCompressionType=void 0,this._style3D=new Ve,this._maximumPriority={foveatedFactor:-Number.MAX_VALUE,depth:-Number.MAX_VALUE,distance:-Number.MAX_VALUE,pixel:-Number.MAX_VALUE},this._minimumPriority={foveatedFactor:Number.MAX_VALUE,depth:Number.MAX_VALUE,distance:Number.MAX_VALUE,pixel:Number.MAX_VALUE},this._readyPromise=Cesium.defer(),this.show=Cesium.defaultValue(e.show,!0),this.debugShowBoundingVolume=Cesium.defaultValue(e.debugShowBoundingVolume,!1),this.loadConfig(e.url),this._allTilesAdditive=!0,this._skipLevelOfDetail=Cesium.defaultValue(e.skipLevelOfDetail,!1),this._skipLevels=Cesium.defaultValue(e.skipLevels,1),this._skipScreenSpaceErrorFactor=Cesium.defaultValue(e.skipScreenSpaceErrorFactor,16),this._screenSpaceError=0,this._dirDiffuseWeight=Cesium.defaultValue(e.dirDiffuseWeight,1),this._baseColorWithAlpha=Cesium.defaultValue(e.baseColorWithAlpha,new Cesium.Color(1,1,1,1)),this._dynamicScreenSpaceError=Cesium.defaultValue(e.maximumScreenSpaceError,!1),this._maximumScreenSpaceError=Cesium.defaultValue(e.maximumScreenSpaceError,16),this._minGeometryError=Cesium.defaultValue(e.minGeometryError,16),this._clippingPlanes=void 0,this._clippingPlanesMatrix=Cesium.Matrix4.IDENTITY,this._clippingPlanesMatrixDirty=!0}function Ge(e,t){e.updateObjsOperation(t.ids,t)}function ze(e,t){return e.priority-t.priority}function We(e,t){t.free()}function qe(e){e._cache.unloadTiles(e,We)}Object.defineProperties(S.prototype,{skipLevelOfDetail:{get:function(){return this._skipLevelOfDetail},set:function(e){this._skipLevelOfDetail=e}},skipLevels:{get:function(){return this._skipLevels},set:function(e){this.skipLevels=e}},skipScreenSpaceErrorFactor:{get:function(){return this._skipScreenSpaceErrorFactor},set:function(e){this.skipScreenSpaceErrorFactor=e}},ready:{get:function(){return 0<this._rootTiles.length}},readyPromise:{get:function(){return this._readyPromise}},rectangle:{get:function(){return this._rectangle}},visibleDistanceMax:{get:function(){return this._visibleDistanceMax},set:function(e){Cesium.Check.typeOf.number("max visible distance",e),this._visibleDistanceMax=e}},visibleDistanceMin:{get:function(){return this._visibleDistanceMin},set:function(e){Cesium.Check.typeOf.number("min visible distance",e),this._visibleDistanceMin=e}},lodRangeScale:{get:function(){return this._lodRangeScale},set:function(e){Cesium.Check.typeOf.number("set layer lod range scale",e),this._lodRangeScale=e}},totalMemoryUsageInBytes:{get:function(){return this._totalMemoryUsageInBytes},set:function(e){this._totalMemoryUsageInBytes=e}},maximumMemoryUsage:{get:function(){return this._maximumMemoryUsage},set:function(e){this._maximumMemoryUsage=e}},style3D:{get:function(){return this._style3D},set:function(e){this._style3D=e}},dirDiffuseWeight:{get:function(){return this._dirDiffuseWeight},set:function(e){this._dirDiffuseWeight=e}},baseColorWithAlpha:{get:function(){return this._baseColorWithAlpha},set:function(e){this._baseColorWithAlpha=e}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){Cesium.ClippingPlaneCollection.setOwner(e,this,"_clippingPlanes")}},clippingPlanesMatrix:{get:function(){var e;return this._clippingPlanesMatrixDirty&&(e=Cesium.Matrix4.multiply(this.context.uniformState.view3D,this.modelMatrix,new Cesium.Matrix4),e=Cesium.Matrix4.multiply(e,this.clippingPlanes.modelMatrix,new Cesium.Matrix4),e=Cesium.Matrix4.inverseTranspose(e,new Cesium.Matrix4),this._clippingPlanesMatrix=e,this._clippingPlanesMatrixDirty=!1),this._clippingPlanesMatrix}}}),S.prototype.loadConfig=function(e){let a=this;Promise.resolve(e).then(e=>{var e=Cesium.Resource.createIfNeeded(e),t=e.getBaseUri(!0);return a._url=e.url,a._basePath=t,(a._baseResource=e).fetchJson()}).then(function(e){a._allTilesAdditive="REPLACE"!==e.lodType.toUpperCase();var t=e.extensions,t=(a.fileType=t["s3m:FileType"],a._vertexCompressionType=t["s3m:VertexCompressionType"],e.position.x),i=e.position.y,r=e.position.z,n=(a._position=Cesium.Cartesian3.fromDegrees(t,i,r),a.modelMatrix=Cesium.Transforms.eastNorthUpToFixedFrame(a._position),a.invModelMatrix=Cesium.Matrix4.inverse(a.modelMatrix,a.invModelMatrix),a._rectangle=Cesium.Rectangle.fromDegrees(e.geoBounds.left,e.geoBounds.bottom,e.geoBounds.right,e.geoBounds.top),e.heightRange&&(a._minHeight=e.heightRange.min,a._maxHeight=e.heightRange.max),e.wDescript&&(t=e.wDescript.range,a._minWValue=t.min,a._maxWValue=t.max),e.tiles||e.rootTiles);for(let e=0,t=n.length;e<t;e++){var o=n[e],s=o.url,o={box:o.boundingbox},o=new Pe(a,void 0,o,s);o.isRootTile=!0,a._cache.add(o),a._rootTiles.push(o)}a._readyPromise.resolve(a)}).catch(function(e){a._readyPromise.reject(e)})},S.prototype._tranverseRenderEntity=function(i,r){var n=[];for(let e=0,t=this._rootTiles.length;e<t;e++){var o=this._rootTiles[e];n.push(o)}for(;n.length;){var s=n.pop();for(let e=0,t=s.renderEntities.length;e<t;e++){var a=s.renderEntities[e];a.ready&&r(a,i)}for(let e=0,t=s.children.length;e<t;e++)n.push(s.children[e])}},S.prototype._updateObjsOperation=function(e){this._tranverseRenderEntity({ids:e},Ge)},S.prototype._setObjsOperationType=function(i,r){Cesium.Check.defined("set Objs Operation ids",i),Cesium.Check.defined("set Objs Operation operationType",r),Array.isArray(i)||(i=[i]);var n=new Cesium.AssociativeArray;for(let e=0,t=i.length;e<t;e++){var o,s=i[e];Cesium.defined(s)&&(o=Cesium.defaultValue(this._objsOperationList[s],0))!==r&&(o|=r,this._objsOperationList[s]=o,n.set(s,o))}0<n.length&&this._updateObjsOperation(n._hash)},S.prototype._removeObjsOperationType=function(i,e){Cesium.Check.defined("set Objs Operation ids",i),Array.isArray(i)||(i=[i]);var r=M.ALL^e,n=new Cesium.AssociativeArray;for(let e=0,t=i.length;e<t;e++){var o=i[e],s=this._objsOperationList[o];Cesium.defined(s)&&((s&=r)===M.RESET?delete this._objsOperationList[o]:this._objsOperationList[o]=s,n.set(o,s))}0<n.length&&this._updateObjsOperation(n._hash)},S.prototype.releaseSelection=function(){this._selections.length<1||(this._removeObjsOperationType(this._selections,M.SELECTED),this._selections.length=0)},S.prototype.setSelection=function(e){Cesium.Check.defined("setSelection ids",e),Array.isArray(e)||(e=[e]),this.releaseSelection(),this._selections=this._selections.concat(e),this._setObjsOperationType(e,M.SELECTED)},S.prototype.prePassesUpdate=function(e){var t;this.ready&&(t=this._clippingPlanes,this._clippingPlanesMatrixDirty=!0,Cesium.defined(t)&&t.enabled&&t.update(e),e.newFrame)&&(this._cache.reset(),this._requestTiles.length=0,this._processTiles.length=0,this._selectedTiles.length=0)},S.prototype.postPassesUpdate=function(e){this.ready&&qe(this)},S.prototype.update=function(e){if(this.ready){this._schuduler.schedule(this,e);var t=this._requestTiles,i=t.length;t.sort(ze);for(let e=0;e<i;++e)t[e].requestContent();var r=this,n=e,o=r._processTiles,s=o.length;for(let e=0;e<s;++e)o[e].update(n,r);var a=this,l=e,u=a._selectedTiles,c=u.length;for(let e=0;e<c;e++)u[e].update(l,a)}},S.prototype.isDestroyed=function(){return!1},S.prototype.destroy=function(){return this._cache.reset(),qe(this),this._rootTiles.length=0,this._requestTiles.length=0,this._processTiles.length=0,this._selectedTiles.length=0,Cesium.destroyObject(this)};var Ke=S},3418:function(e,t,i){"use strict";i.d(t,{Z:function(){return a}});var t=i(1133),r=i(8726),n=i(9745);var o=new class{constructor(){this._parentLayer=null,this._viewer=null}load(e,t){this._parentLayer=t,this._viewer=t.viewer,e._asset&&e._asset.labelFile&&this.getData(e)}getData(e){fetch(e.basePath.split("/?")[0]+"/"+e._asset.labelFile).then(e=>e.json()).then(e=>{this.showLabels(e.objects.components),this._parentLayer._addInnerSetVisibleHandler(this.handleLayerShow.bind(this._parentLayer))})}showLabels(e){let i=n.Z.getGeographic();e.forEach(e=>{var t=new Cesium.Cartesian3(Number(e.position.split(",")[0]),Number(e.position.split(",")[1]),Number(e.position.split(",")[2])),t=(Cesium.Label.enableRightToLeftDetection=!0,Cesium.Cartographic.fromCartesian(t)),t={position:i.toCartesian({lng:Number(Cesium.Math.toDegrees(t.longitude).toFixed(8)),lat:Number(Cesium.Math.toDegrees(t.latitude).toFixed(8)),alt:Number(t.height.toFixed(2))}),point:{color:Cesium.Color.RED,pixelSize:10},label:{text:e.value.split(";")[e.value.split(";").length-1],font:e.style,fillColor:Cesium.Color.BLACK,backgroundColor:this.handleColorType(e.color),showBackground:!0,style:Cesium.LabelStyle.FILL,outlineWidth:2,verticalOrigin:Cesium.VerticalOrigin.CENTER,horizontalOrigin:Cesium.HorizontalOrigin.LEFT}};this._parentLayer.addEntity(t)})}handleLayerShow(t){return this._entities.forEach(e=>{e.show=t}),!0}handleColorType(e){var t=e.split(","),i=new Array(t.length).fill(0);for(let e=0;e<t.length;e++)i[e]=+t[e]/255;return new Cesium.Color(...i)}};class s extends t.Z{static layerType="013000";constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this.initialize(e)}initialize(e){var t={layerType:s.layerType,urls:[]};if("string"==typeof e.urls&&(e.urls=[e.urls]),Object.assign(this.agMetaData,t,e),this.agMetaData.url&&this.agMetaData.urls.push(this.agMetaData.url),!this.agMetaData.urls?.length)throw new Cesium.DeveloperError("The urls of layer is required.");this._isLoadData=!1,this._isAddViewer=!1,this._loadData()}setStyle(e){for(var t=new Cesium.Cesium3DTileStyle(e),i=0;i<this._primitives.length;i++)this._primitives[i].style=t}_loadData(){if(!this._isLoadData){var e=[];for(const i of this.agMetaData.urls){var t=r.Z.add3DTileset(i,this.agMetaData.tilesetOption,this.agMetaData.styleManagerId,this.agMetaData);e.push(t)}this.loadDataPromise=Promise.allSettled(e).then(e=>{for(const i of e){var t;"fulfilled"===i.status&&(t=i.value)&&(t.agMetaData=this.agMetaData,this._primitives.push(t),o.load(t,this))}this._isLoadData=!0})}}zoomToLayer(){0<this._primitives?.length?this.viewer.flyTo(this._primitives[0]):console.warn("暂时无法定位图层！")}}var a=s},2800:function(e,t,i){"use strict";class r extends i(1133).Z{static layerType="115000";constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this._initialize(e)}_initialize(e){var t={layerType:r.layerType,minimumLevel:0,maximumLevel:18};if(Object.assign(this.agMetaData,t,e),!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.");this._isLoadData=!1,this._isAddViewer=!1,this._loadData()}_loadData(){var e;this._isLoadData||(e=new Cesium.UrlTemplateImageryProvider(this.agMetaData),this._imageryLayerProviders.push(e),this.loadDataPromise=Promise.resolve(e),this._isLoadData=!0)}}t.Z=r},4263:function(e,t,i){"use strict";class r extends i(1133).Z{static layerType="070100";constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this._initialize(e)}_initialize(e){var t={layerType:r.layerType,url:"",spatialReference:{wkid:"4326"},layerIndex:void 0,token:"AuvSu8hcBnN9Abj0qlbwc4ug5N_ztRnKTSaf9dfYFazXhUof_2Xpq6Y3rN5NAZIr",culture:"zh-Hans",mapStyle:void 0};if(Object.assign(this.agMetaData,t,e),!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.");this._isLoadData=!1,this._isAddViewer=!1,this._loadData()}_loadData(){this._isLoadData||(this._getUrlQueryParams(this.agMetaData.url),this.agMetaData.key=this.agMetaData.token,this.loadDataPromise=Cesium.BingMapsImageryProvider.fromUrl(this.agMetaData.url,this.agMetaData).then(e=>{this._imageryLayerProviders.push(e),this._isLoadData=!0}))}_getUrlQueryParams(e){let r={url:e};e.includes("?")&&(e=e.split("?"),r.url=e[0],(e=e[1].split("&")).length)&&(e.forEach(e=>{var t,i=e.indexOf("=");0<=i&&(t=e.slice(0,i),e=e.slice(i+1),r[t]=e)}),Object.assign(this.agMetaData,r))}}t.Z=r},7637:function(e,t,i){"use strict";var r=i(7720),n=i(9359),o=i(4723),s=i(812),a=i(7517),l=i(6344),u=i(142),c=i(1710);class h extends r.Z{static layerType="010300";constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this._initialize(e),this.rectangle=null,this.currentRectangle=null,this.customStyle=Cesium.defaultValue(e.customStyle,null),this._isChangeAlpha=!1,this._alpha=1,this.isUpdated=!0,this._dataSourceObj={}}_initialize(e){var t={layerType:h.layerType,url:"",layerTable:"",spatialReference:{wkid:"4326"},crs:"EPSG:4326",waitTime:500,queryParameters:{maxFeatures:1e3,version:"1.0.0",outputFormat:"application/json"}};Object.assign(this.agMetaData,t,e),this.agMetaData.url?this.agMetaData.layerTable?(this.agMetaData.queryParameters.typeName=this.agMetaData.layerTable,t=this._getUrlQueryParams(this.agMetaData.url),this.agMetaData.url=t.url,t.queryParameters.maxFeatures&&(this.agMetaData.queryParameters.maxFeatures=t.queryParameters.maxFeatures),t.queryParameters.propertyName&&(this.agMetaData.queryParameters.propertyName=t.queryParameters.propertyName),t.queryParameters.idField&&this.agMetaData.queryParameters.propertyName&&(this.agMetaData.queryParameters.propertyName+=","+t.queryParameters.idField,this.agMetaData.queryParameters.idField=t.queryParameters.idField),t.queryParameters.token&&(this.agMetaData.queryParameters.token=t.queryParameters.token),this._isLoadData=!1,this._isAddViewer=!1,this._loadData()):console.error("AgWFSLayer需要layerTable",this.agMetaData):console.error("AgDynamicWFSLayer需要url",this.agMetaData)}_loadData(){if(!this._isLoadData){this._getStyle(this.agMetaData),this.crs=new Cesium.CRSSupport(this.agMetaData.spatialReference),this.wfsQuery=new n.Z(this.agMetaData.url,this.agMetaData.crs,this.agMetaData.queryParameters.version);const e=this;this.updateEvent=function(){e._update()},this.viewer.camera.moveEnd.addEventListener(this.updateEvent),this.loadDataPromise=this._getLayerExtent(this.agMetaData.url,this.agMetaData.layerTable).then(e=>{e=JSON.parse(JSON.stringify(e));this.rectangle=this.crs.getRectangleFromExtent(e),this.rectangle=this._expandRectangle(this.rectangle),this._isLoadData=!0},e=>(console.error("AgDynamicWFSLayer图层范围获取失败",e),null))}}_addViewerUpdateHandle(){this._update()}async _getStyle(e){var t;e.styleManagerId?this.serverStyle=new s.Z(this):(t=new a.Z,this.legendStyle=await t.getStyleFromLegendStyle(e))}_update(){if(this._isAddViewer&&this.isLayerVisible&&this.isUpdated){var t=c.Z.getViewExtent(this.viewer);if(this.currentRectangle=t?Cesium.Rectangle.intersection(t,this.rectangle):this.rectangle,this.agMetaData.queryParameters?.cql_filter&&/BBOX/.test(this.agMetaData.queryParameters?.cql_filter.toUpperCase())){t=this.agMetaData.queryParameters.cql_filter.toUpperCase().replace(/[\r\n]/g,"").replace(/\s+/g,"");let e=/BBOX\((.*?)\)/g.exec(t);e=e[1].split(",");t=Cesium.Rectangle.fromDegrees(e[1],e[2],e[3],e[4]);this.currentRectangle?this.currentRectangle=Cesium.Rectangle.intersection(this.currentRectangle,t):this.currentRectangle=t}this.currentRectangle&&(this.isUpdated=!1,this.queryBbox=this._getViewBbox(),this._updateLayer())}}async _updateLayer(){var e=this.agMetaData.queryParameters?.cql_filter&&""!==this.agMetaData.queryParameters?.cql_filter;let t=(await this.wfsQuery.getFeatureByExtentArray(this.agMetaData.layerTable,this.queryBbox,{...this.agMetaData.queryParameters},e).catch(e=>(console.error("AgDynamicWFSLayer图层查询失败",this.agMetaData,e),null)))?.data;t&&t.features&&t.features.length?(o.Z.findCrsByName("4326").transfromData(this.agMetaData,t),Cesium.GeoJsonDataSource.load(t,{clampToGround:!0}).then(t=>{this.updateEvent&&this.isLayerVisible&&(this._changeDefaultBillborad2Point(t),t.name=this.id,t.agMetaData=this.agMetaData,(t.layer=this)._updateDataSource(t,this.id,this.agMetaData).then(e=>{setTimeout(()=>{this._lastDataSouce&&(this.viewer.dataSources.remove(this._lastDataSouce),this._dataSource.splice(0,1)),this._lastDataSouce=t,this.isUpdated=!0,this._dataSourceObj.dataSource=t},this.agMetaData.waitTime)}))}).catch(e=>{console.error("AgDynamicWFSLayer的GeoJSON加载失败",this.agMetaData,t,e)})):this.isUpdated=!0}_updateDataSource(i,r,n){return new Promise((e,t)=>{this.addDatasource(i,r),this.customStyle?l.Z.setDataStoreStyle(i,this.customStyle):this.serverStyle?(this.serverStyle.setStyle(i,n.styleManagerId),this._isChangeAlpha&&u.Z.setDataSourceEntityOpacity(i,this._alpha)):this.legendStyle?l.Z.setDataStoreStyle(i,this.legendStyle):this._isChangeAlpha&&u.Z.setDataSourceEntityOpacity(i,this._alpha),e(i)})}watchDataSource(t){let i;Object.defineProperty(this._dataSourceObj,"dataSource",{get(){return i},set(e){i=e,t(e)}})}_getLayerExtent(t,o){return new Promise((n,e)=>{new Cesium.Resource({url:t+"?request=GetCapabilities&service=WFS&layers="+o+(this.agMetaData.queryParameters.token?"&token="+this.agMetaData.queryParameters.token:""),queryParameters:{}}).fetch().then(e=>{var t,i,r=(new DOMParser).parseFromString(e,"text/html").documentElement.getElementsByTagName("FeatureType");for(let e=0;e<r.length;e++)if(r[e].getElementsByTagName("Name")[0].firstChild.data==o)return i=r[e].getElementsByTagName("ows:LowerCorner")[0].textContent.split(" "),t=r[e].getElementsByTagName("ows:UpperCorner")[0].textContent.split(" "),i={xmin:parseFloat(i[0]),ymin:parseFloat(i[1]),xmax:parseFloat(t[0]),ymax:parseFloat(t[1])},void n(i)})})}_getViewBbox(){return this._rectangleToBbox(this.currentRectangle)}_rectangleToBbox(e){e=this.crs.getExtentFromRectangle(e);return[e.xmin,e.ymin,e.xmax,e.ymax]}setOpacity(e){var t;this._alpha!=e&&(this._isChangeAlpha=!0,this._alpha=e,(t=this.customStyle||this.legendStyle)&&(this._changeStyleOpacity(t,e),this.customStyle=t),u.Z.setDataSourceEntityOpacity(this._dataSource,e))}_changeStyleOpacity(e,t){for(var i in e)e.hasOwnProperty(i)&&(e[i]instanceof Cesium.Color?e[i]=u.Z.getColor(e[i],t):e[i]instanceof Object&&this._changeStyleOpacity(e[i],t))}_expandRectangle(e,t=6){var t=Math.pow(10,t),i=Math.floor(e.west*t)/t,r=Math.floor(e.south*t)/t,n=Math.ceil(e.east*t)/t,e=Math.ceil(e.north*t)/t;return new Cesium.Rectangle(i,r,n,e)}dispose(){this.updateEvent&&(this.viewer.camera.moveEnd.removeEventListener(this.updateEvent),this.updateEvent=null),this.removeAll();let i=this;return new Promise(function(e,t){e(i)})}}t.Z=h},1673:function(e,t,i){"use strict";var r=i(1133),n=i(9359),o=i(1710);class s extends r.Z{static layerType="030200,010200";constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this._initialize(e),this.rectangle=null,this.currentRectangle=null,this.lastImagerLayer=null,this.imagerLayer=null,this.isUpdated=!0}_initialize(e){var t={layerType:s.layerType,url:"",layerTable:"",spatialReference:{wkid:"4326"},crs:"CRS:84",layerIndex:void 0,waitTime:50,queryParameters:{width:1280,height:1280,version:"1.3.0",format:"image/png",transparent:!0,styles:""}};if(e.cql_filter&&(t.queryParameters.cql_filter=e.cql_filter),Object.assign(this.agMetaData,t,e),!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.");if(!this.agMetaData.layerTable)throw new Cesium.DeveloperError("The name of layer or sublayers is required.");this._isLoadData=!1,this._isAddViewer=!1,this._loadData()}_loadData(){var e;this._isLoadData||((e=this._getUrlQueryParams(this.agMetaData.url)).queryParameters.width&&(this.agMetaData.queryParameters.width=e.queryParameters.width),e.queryParameters.height&&(this.agMetaData.queryParameters.height=e.queryParameters.height),e.queryParameters.cql_filter&&(this.agMetaData.queryParameters.height=e.queryParameters.cql_filter),this.crs=new Cesium.CRSSupport(this.agMetaData.spatialReference),this.wfsQuery=new n.Z(this.agMetaData.queryUrl,this.agMetaData.crs,this.agMetaData.queryParameters.version,this.agMetaData.queryParameters),this.loadDataPromise=this._getLayerExtent(e).then(e=>{e?(this.rectangle=e,this.currentRectangle=e):this.currentRectangle=o.Z.getViewExtent(this.viewer),this.agMetaData.queryParameters.bbox=this._getBboxFromRectangle(this.currentRectangle);var t=this;return this.updateEvent=function(){t._update()},this.viewer.camera.moveEnd.addEventListener(this.updateEvent),this._isLoadData=!0,this},()=>(console.error("图层范围获取失败"),null)))}_addViewerUpdateHandle(){this._update()}_getUrlQueryParams(e){let r={url:e,queryParameters:{}};return this.agMetaData.queryParameters.layers=this.agMetaData.layerTable,this.agMetaData.version&&(this.agMetaData.queryParameters.version=this.agMetaData.version),this.agMetaData.crs&&(this.agMetaData.queryParameters.crs=this.agMetaData.crs),e.includes("?")&&(e=e.split("?"),r.url=e[0],(e=e[1].split("&")).length)&&(e.forEach(e=>{var t,i=e.indexOf("=");0<=i&&(t=e.slice(0,i),e=e.slice(i+1),r.queryParameters[t]=e)}),Object.assign(this.agMetaData.queryParameters,r.queryParameters)),r.url.endsWith("/")&&(r.url=r.url.slice(0,-1)),r.url.endsWith("ows")&&(r.url=r.url.slice(0,-3)+"wms"),this.agMetaData.queryUrl=r.url,r}_update(){var e;this._isAddViewer&&this.isLayerVisible&&this.isUpdated&&(e=o.Z.getViewExtent(this.viewer),this.currentRectangle=e?Cesium.Rectangle.intersection(e,this.rectangle):this.rectangle,this.currentRectangle)&&(this.isUpdated=!1,this.agMetaData.queryParameters.bbox=this._getViewBbox(),this._updateImageHeight(this.currentRectangle),this._updateLayer())}async _updateLayer(){let e=this,t=this.agMetaData.queryUrl+"?request=getmap";for(var i in this.agMetaData.queryParameters)t+="&"+i+"="+this.agMetaData.queryParameters[i];var r=await Cesium.SingleTileImageryProvider.fromUrl(t,{rectangle:this.currentRectangle});this.imagerLayer&&(r.alpha=this.imagerLayer.alpha),this.imagerLayer=this.addImagery(r,this.agMetaData.layerIndex),setTimeout(function(){e.lastImagerLayer&&(e.viewer.imageryLayers.remove(e.lastImagerLayer),e._imageryLayers.splice(0,1)),e.lastImagerLayer=e.imagerLayer,e.isUpdated=!0},e.agMetaData.waitTime)}async _getLayerExtent(){var e=await new Cesium.Resource({url:this.agMetaData.url,queryParameters:{request:"GetCapabilities",service:"WMS",version:this.agMetaData.queryParameters.version||this.agMetaData.version,layers:this.agMetaData.layerTable}}).fetch(),i=(new DOMParser).parseFromString(e,"text/xml"),r=this.agMetaData.layerTable.split(","),n={xmin:void 0,ymin:void 0,xmax:void 0,ymax:void 0};for(let t=0,e=r.length;t<e;t++){let e=r[t];0<=e.indexOf(":")&&(e=e.split(":")[1]);var o=i.evaluate(`//*[local-name()="Layer"]/*[local-name()="Name"][contains(., "${e}")]`,i,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE),s=o.snapshotLength;for(let e=0;e<s;e++){var a=o.snapshotItem(e).parentNode.getElementsByTagName("BoundingBox");for(let e=0,t=a.length;e<t;e++){var l=a[e],u=l.getAttribute("SRS")?"SRS":"CRS";if(l.getAttribute(u)===this.agMetaData.crs){let e,t,i,r;r="1.3.0"==this.agMetaData.queryParameters.version&&this.agMetaData.crs.includes("EPSG")?(e=Number(l.getAttribute("miny")),t=Number(l.getAttribute("maxy")),i=Number(l.getAttribute("minx")),Number(l.getAttribute("maxx"))):(e=Number(l.getAttribute("minx")),t=Number(l.getAttribute("maxx")),i=Number(l.getAttribute("miny")),Number(l.getAttribute("maxy"))),n.xmin=!n.xmin||e<n.xmin?e:n.xmin,n.xmax=!n.xmax||t>n.xmax?t:n.xmax,n.ymin=!n.ymin||i<n.ymin?i:n.ymin,n.ymax=!n.ymax||r>n.ymax?r:n.ymax}}}}return this.crs.getRectangleFromExtent(n)}_getViewBbox(){var e=this.crs.getExtentFromRectangle(this.currentRectangle);return e.xmin+","+e.ymin+","+e.xmax+","+e.ymax}_getBboxFromRectangle(e){return Cesium.Math.toDegrees(e.west)+","+Cesium.Math.toDegrees(e.south)+","+Cesium.Math.toDegrees(e.east)+","+Cesium.Math.toDegrees(e.north)}_updateImageHeight(e){e=(e.north-e.south)/(e.east-e.west);this.agMetaData.queryParameters.width||(this.agMetaData.queryParameters.width=this.agMetaData.width),this.agMetaData.queryParameters.height=Math.round(e*this.agMetaData.queryParameters.width)}zoomToLayer(){this.rectangle&&this.viewer.camera.setView({destination:this.rectangle})}async pickFeatures(e){e=this._getQueryPolyonByScreenPosition(e),e=await this.wfsQuery.intersectsPolygon(this.agMetaData.layerTable,e);return e&&e.features&&e.features.length?{data:e.features[0],properties:e.features[0].properties,imageryLayer:this}:[]}_getQueryPolyonByScreenPosition(e,t=5){var i=this.viewer.scene,r=Math.max(0,e.x-t),n=Math.min(i.canvas.clientWidth,e.x+t),o=Math.max(0,e.y-t),e=Math.min(i.canvas.clientHeight,e.y+t),t=i.camera.getPickRay(new Cesium.Cartesian2(r,o)),r=i.camera.getPickRay(new Cesium.Cartesian2(r,e)),e=i.camera.getPickRay(new Cesium.Cartesian2(n,e)),n=i.camera.getPickRay(new Cesium.Cartesian2(n,o));return[i.globe.pick(t,i),i.globe.pick(r,i),i.globe.pick(e,i),i.globe.pick(n,i)]}dispose(){this.updateEvent&&this.viewer.camera.moveEnd.removeEventListener(this.updateEvent),this.removeAll();let i=this;return new Promise(function(e,t){e(i)})}}t.Z=s},4499:function(e,t){"use strict";t.Z=class i{static layerType="021500";get id(){return this.agMetaData.id}set id(e){this.agMetaData.id=e}constructor(e){e=Cesium.defaultValue(e,{}),this.viewer=Cesium.defaultValue(e.viewer,CIM.viewer),this.agMetaData={id:Cesium.createGuid()},this._terrainLayerProvider=void 0,this._initialize(e)}_initialize(e){var t={layerType:i.layerType,url:"",requestWaterMask:!0,requestVertexNormals:!0,requestMetadata:void 0,ellipsoid:void 0,credit:void 0};if(Object.assign(this.agMetaData,t,e),!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.");this._isLoadData=!1,this._isAddViewer=!1,this._loadData()}_loadData(){var e;this._isLoadData||(e=new Cesium.ArcGISTiledElevationTerrainProvider(this.agMetaData),this._terrainLayerProvider=e,this.loadDataPromise=Promise.resolve(e),this._isLoadData=!0)}_addToViewer(e){this._isAddViewer||(this._layerTree=e||CIM.layerTree,this.addViewerPromise=this.loadDataPromise.then(()=>{this._layerTree.uncheckAllTerrain(this.agMetaData.id),this.viewer.terrainProvider=this._terrainLayerProvider,this._isAddViewer=!0}))}remove(){this.viewer.terrainProvider=new Cesium.EllipsoidTerrainProvider}dispose(){let i=this;return this.remove(),new Promise(function(e,t){e(i)})}}},7073:function(e,t,i){"use strict";var r=i(7720),n=i(8727),o=i(4723),s=i(812),a=i(7030),l=i(6344);class u extends r.Z{static layerType="021200";constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this._initialize(e)}_initialize(e){var t={layerType:u.layerType,url:"",spatialReference:{wkid:"4326"},queryParameters:{returnGeometry:!0,where:"1=1",f:"pjson",outFields:"*"}};Object.assign(this.agMetaData,t,e),this.agMetaData.url?this.agMetaData.layerTable?(t=this._getUrlQueryParams(this.agMetaData.url),this.agMetaData.url=t.url,t.queryParameters.outFields&&(this.agMetaData.queryParameters.outFields=t.queryParameters.outFields),t.queryParameters.idField&&this.agMetaData.queryParameters.propertyName&&(this.agMetaData.queryParameters.outFields+=","+t.queryParameters.idField,this.agMetaData.queryParameters.idField=t.queryParameters.idField),this._isLoadData=!1,this._isAddViewer=!1,this._loadData()):console.error("AgGeoSceneFeatureLayer需要layerTable",this.agMetaData):console.error("AgGeoSceneFeatureLayer需要url",this.agMetaData)}_loadData(){var e;this._isLoadData||(e=Cesium.Resource.fetchJson({url:this.agMetaData.url+`/${this.agMetaData.layerTable}/query?`,queryParameters:this.agMetaData.queryParameters}),this.loadDataPromise=e.then(async t=>{let i=n.Z.getDataFromArcgis(t);o.Z.findCrsByName("4326").transfromData(this.agMetaData,i);var e=await Cesium.GeoJsonDataSource.load(i,{clampToGround:!0}).catch(e=>(console.error("AgGeoSceneFeatureLayer的GeoJSON加载失败",this.agMetaData,t,i,e),null));if(e)return e.name=this.id,e.agMetaData=this.agMetaData,(e.layer=this)._changeDefaultBillborad2Point(e),this._setStyle(e),this._dataSource.push(e),this._isLoadData=!0,e},e=>(console.error("AgGeoSceneFeatureLayer图层查询失败",this.agMetaData,e),null)))}_setStyle(t){this.agMetaData.styleManagerId?new s.Z(this).setStyle(t,this.agMetaData.styleManagerId):this.agMetaData.customStyle?this.setStyle(this.agMetaData.customStyle):(new a.Z).getStyleFromGeosceneStyle(this.agMetaData).then(e=>{e&&l.Z.setDataStoreStyle(t,e)}).catch(e=>{console.error("AgGeoSceneFeatureLayer无法获取图层的默认图例样式，将使用cesium原始样式",this.agMetaData,e)})}}t.Z=u},7566:function(e,t,i){"use strict";class r extends i(1133).Z{static layerType="021300,021400,021600";constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this._initialize(e)}_initialize(e){var t={layerType:r.layerType,urls:[],spatialReference:{wkid:"4326"},token:void 0};if("string"==typeof e.urls&&(e.urls=[e.urls]),Object.assign(this.agMetaData,t,e),this.agMetaData.url&&this.agMetaData.urls.push(this.agMetaData.url),!this.agMetaData.urls?.length)throw new Cesium.DeveloperError("The urls of layer is required.");this._isLoadData=!1,this._isAddViewer=!1,this._loadData()}_loadData(){if(!this._isLoadData){var e=[];for(const i of this.agMetaData.urls){var t=Cesium.I3SDataProvider.fromUrl(i,{name:this.agMetaData.text});e.push(t)}this.loadDataPromise=Promise.allSettled(e).then(e=>{for(const i of e){var t;"fulfilled"===i.status&&(t=i.value)&&(t.agMetaData=this.agMetaData,this._primitives.push(t))}this._isLoadData=!0}),this._innerSetVisibleHandler=this._setI3SLayerVisible}}zoomToLayer(){if(!this.rectangle&&this._primitives?.length)for(let e=0;e<this._primitives.length;e++)this._primitives[e]._extent&&(this.rectangle?this.rectangle=Cesium.Rectangle.union(this.rectangle,this._primitives[e]._extent):this.rectangle=this._primitives[e]._extent);if(this.rectangle){let e=this.rectangle;var t,i;1==this._primitives?.length&&"Building"==this._primitives[0].layerType&&(t=Cesium.Rectangle.center(this._primitives[0]._extent),i=this._primitives[0]._data.layers[0].fullExtent.zmax+50,e=Cesium.Cartesian3.fromRadians(t.longitude,t.latitude,i)),this.viewer.camera.flyTo({destination:e})}else console.warn("暂时无法定位图层！")}_setI3SLayerVisible(t){this.isLayerVisible=t;for(let e=this._primitives.length-1;-1<e;e--){this._primitives[e].show=t;var i=this._primitives[e].layers;for(let e=0;e<i.length;e++)i[e].tileset&&(i[e].tileset.show=t)}return!1}}t.Z=r},7:function(e,t,i){"use strict";var r=i(1133),h=i(9745),A=i(1710),p=i(8727);class n extends r.Z{static layerType="021101";constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this._initialize(e)}_initialize(e){var t={layerType:n.layerType,url:"",spatialReference:{wkid:"4326"},layerIndex:void 0,token:void 0,tileWidth:256,tileHeight:256,tileOriginX:void 0,tileOriginY:void 0,centerLon:void 0,centerLat:void 0,usePreCachedTilesIfAvailable:!0};if(Object.assign(this.agMetaData,t,e),!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.");this._checkServiceJson(),this._isLoadData=!1,this._isAddViewer=!1,this._isPick=!1,this._loadData()}async _loadData(){if(!this._isLoadData){if(this.agMetaData.token&&"{}"==JSON.stringify(this.agMetaData.token)&&(this.agMetaData.token=null),this.agMetaData.data){var i=JSON.parse(JSON.parse(this.agMetaData.data).senceExtendData);for(let t=0;t<i.length;t++)if(""!=i[t].key){let e=i[t].value;"boolean"==i[t].explain&&(e=Boolean(e)),"number"==i[t].explain&&(e=Number(e)),"json"==i[t].explain&&(e=JSON.parse(e)),this.agMetaData[i[t].key]=e}}this.loadDataPromise=Cesium.ArcGisMapServerImageryProvider.fromUrl(this.agMetaData.url,this.agMetaData).then(e=>(e.enablePickFeatures=!1,this._imageryLayerProviders.push(e),this._isLoadData=!0,e))}}async _checkServiceJson(){var e=this.agMetaData.url+"?f=pjson",e=new Cesium.Resource({url:e});try{var t=await e.fetch();-1<(t=JSON.parse(t)).capabilities.indexOf("Query")&&(this._isPick=!0),t.fullExtent&&(this._fullExtent=t.fullExtent)}catch(e){console.error(e)}}zoomToLayer(){var e;this._fullExtent?(e=this.agMetaData.mapParam.mapParamReferenceValue,e=JSON.parse(e),e=new Cesium.CRSSupport(e).getRectangleFromExtent(this._fullExtent),this.viewer.camera.flyTo({destination:e})):this._imageryLayerProviders?.length&&(e=this._imageryLayerProviders[0]._rectangle,this.viewer.camera.setView({destination:e}))}async pickFeatures(e){if(!this._isPick)return[];var t=[];for(const i of await this._identity(e))t.push({data:i,properties:i.properties,imageryLayer:this});return t}async _identity(e){var e=this.viewer.scene.pickPosition(e),e=h.Z.getGlobalCartesian().toGeographic(e),{east:t,north:i,south:r,west:n}=A.Z.getViewExtent(this.viewer),t=Cesium.Math.toDegrees(t),i=Cesium.Math.toDegrees(i),r=Cesium.Math.toDegrees(r),n=Cesium.Math.toDegrees(n),o=this.agMetaData.url+"/identify",e={geometry:e.lng+", "+e.lat,geometryType:"esriGeometryPoint",tolerance:2,imageDisplay:"256,256,96",mapExtent:n+`,${r},${t},`+i,layers:"visible",f:"pjson"},n=new Cesium.Resource({url:o,queryParameters:e});let s=[];try{var a=await n.fetch(),a=JSON.parse(a);s=a.results}catch(e){return console.error(e),[]}var l=[];for(const c of s){var u=p.Z.arcgisToGeojson(c);l.push(u)}return l}}t.Z=n},2614:function(e,t,i){"use strict";i.d(t,{Z:function(){return l}});var t=i(1133),r=i(1710),n=i(9644),o=i.n(n);var a=class{constructor(e,t,i){if(this.viewer=e,!t)throw new Cesium.DeveloperError("The url of query is required.");if(this.layerUrlParams="",t.includes("?")){e=t.split("?");this.layerUrl=e[0],this.layerUrlParams=e[1]}else{let e=t;"/"===e[e.length-1]&&(e=e.slice(0,e.length-1)),this.layerUrl=e}i instanceof Cesium.CRSSupport?this.crs=i:i&&i.spatialReference&&(this.crs=new Cesium.CRSSupport(i.spatialReference))}queryFeatureByPolygon(i,r){if(i){r=r||{};let e=this.layerUrl,t=(e=Cesium.defined(r.subLayerName)?e+"/"+r.subLayerName:e)+"/query?where=1%3D1&outFields=*&f=json&geometryType=esriGeometryEnvelope&geometry="+i;r.outSR&&(t+="&outSR="+encodeURIComponent(r.outSR)),this.layerUrlParams&&(t=t+"&"+this.layerUrlParams);i={spatialRel:r.spatialRel,distance:r.distance,units:r.units};return o().get(t,{params:i})}}queryFeatureByPoint(i,r){if(i){r=r||{};let e=this.layerUrl,t=e=Cesium.defined(r.subLayerName)?e+"/"+r.subLayerName:e;layerName,r&&r.outSR&&(t+="&outSR="+encodeURIComponent(r.outSR)),this.layerUrlParams&&(t=t+"&"+this.layerUrlParams);i={spatialRel:r.spatialRel,distance:r.distance,units:r.units};return o().get(t,{params:i})}}buildQueryPolyonByCursor(e,t=5){var i=this.viewer.scene,r=Math.max(0,e.x-t),n=Math.min(i.canvas.clientWidth,e.x+t),o=Math.max(0,e.y-t),i=Math.min(i.canvas.clientHeight,e.y+t);return this.buildQueryPointByCursor({x:r,y:o})+","+this.buildQueryPointByCursor({x:n,y:i})}buildQueryPointByCursor(e){var t=this.viewer.scene,e=t.camera.getPickRay(new Cesium.Cartesian2(e.x,e.y)),e=t.globe.pick(e,t);return this.buildQueryPointByCartesianPosition(e)}buildQueryPointByCartesianPosition(e){var t,e=Cesium.Cartographic.fromCartesian(e),e=[Cesium.Math.toDegrees(e.longitude),Cesium.Math.toDegrees(e.latitude)];return this.crs?(t=this.crs._WGS84ToPosition(e))[0]+","+t[1]:e[0]+","+e[1]}};class s extends t.Z{static layerType="021102";constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this._initialize(e),this.initialExtent=null,this.rectangle=null,this.currentRectangle=null,this.lastImagerLayer=null,this.imagerLayer=null,this.isUpdated=!0,this.layerLegend=null}_initialize(e){var t=this.viewer.container.clientWidth,t={layerType:s.layerType,url:"",layerTable:"",spatialReference:{wkid:"4326"},layerIndex:void 0,waitTime:50,imageMaxWidth:t,imageMaxHeight:t,queryParameters:{f:"json",bbox:"",dpi:96,transparent:!0,size:"",format:"png32",layers:"",bboxSR:"4326",imageSR:"4326",layerDefs:""}};if(Object.assign(this.agMetaData,t,e),!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.");if(!this.agMetaData.layerTable)throw new Cesium.DeveloperError("The name of layer or sublayers is required.");this.agMetaData?.mapParam?.mapParamExtent&&(t=this.agMetaData.mapParam.mapParamExtent.split(","),this.initialExtent={},this.initialExtent.xmin=Number(t[0]),this.initialExtent.ymin=Number(t[1]),this.initialExtent.xmax=Number(t[2]),this.initialExtent.ymax=Number(t[3])),this.agMetaData.queryParameters.layers="show:"+this.agMetaData.layerTable,this.agMetaData.queryParameters.size=this.agMetaData.imageMaxWidth+","+this.agMetaData.imageMaxHeight,this.agMetaData.token&&(this.agMetaData.queryParameters.token=this.agMetaData.token),this.crs=new Cesium.CRSSupport(this.agMetaData.spatialReference),"4326"!==this.crs.wkid&&(this.agMetaData.queryParameters.bboxSR=JSON.stringify(this.agMetaData.spatialReference),this.agMetaData.queryParameters.imageSR=this.agMetaData.queryParameters.bboxSR),this._isLoadData=!1,this._isAddViewer=!1,this._loadData()}_loadData(){var e;this._isLoadData||(e=this._getUrlQueryParams(this.agMetaData.url),this.loadDataPromise=this._getLayerExtent(e).then(e=>{this.rectangle=e;var t=this;return this.updateEvent=function(){t._update()},this.viewer.camera.moveEnd.addEventListener(this.updateEvent),this._isLoadData=!0,this},()=>(console.error("图层范围获取失败"),null)))}_getUrlQueryParams(e){let r={url:e,queryParameters:{f:"json"}};return e.includes("?")&&(e=e.split("?"),r.url=e[0],(e=e[1].split("&")).length)&&(e.forEach(e=>{var t,i=e.indexOf("=");0<=i&&(t=e.slice(0,i),e=e.slice(i+1),r.queryParameters[t]=e)}),Object.assign(this.agMetaData.queryParameters,r.queryParameters)),r.url.endsWith("/")&&(r.url=r.url.slice(0,-1)),this.agMetaData.queryUrl=r.url,this.agMetaData.extraParams=r.queryParameters,r}_addViewerUpdateHandle(){this._update()}_update(){if(this._isAddViewer&&this.isLayerVisible&&this.isUpdated){let t=this;var e=r.Z.getViewExtent(this.viewer);t.currentRectangle=e?Cesium.Rectangle.intersection(e,t.rectangle):t.rectangle,t.currentRectangle&&(this.isUpdated=!1,t.agMetaData.queryParameters.bbox=t._getViewBbox(),t._getImage().then(function(e){e.error||t.updateEvent&&t.isLayerVisible&&t._updateLayer(e)}))}}async _updateLayer(e){var t=this,e=e.extent,e=("4326"!=e.spatialReference.wkid?t.currentRectangle=t.crs.getRectangleFromExtent(e):t.currentRectangle=Cesium.Rectangle.fromDegrees(e.xmin,e.ymin,e.xmax,e.ymax),await Cesium.SingleTileImageryProvider.fromUrl(t.imgUrl,{rectangle:t.currentRectangle}));this.imagerLayer&&(e.alpha=this.imagerLayer.alpha),this.imagerLayer=this.addImagery(e,this.agMetaData.layerIndex),setTimeout(function(){t.lastImagerLayer&&(t.viewer.imageryLayers.remove(t.lastImagerLayer),t._imageryLayers.splice(0,1)),t.lastImagerLayer=t.imagerLayer,t.isUpdated=!0},50)}_getViewBbox(){var e=this.crs.getExtentFromRectangle(this.currentRectangle);return e.xmin+","+e.ymin+","+e.xmax+","+e.ymax}_getImage(){return new Promise((i,e)=>{var t=this.agMetaData.queryUrl+"/export";let r=JSON.parse(JSON.stringify(this.agMetaData.queryParameters)),n=Cesium.Resource.createIfNeeded(t);t=n.getDerivedResource({queryParameters:r});let o=this;t.fetchJsonp().then(function(t){r.f="image",n.getDerivedResource({queryParameters:r}).fetchImage().then(e=>{o.imgUrl=e.src,i(t)})})})}_getLayerExtent(t){let r=this;return new Promise((i,e)=>{new Cesium.Resource({url:t.url,queryParameters:t.queryParameters}).fetchJsonp().then(function(e){let t;t=r.initialExtent||e.fullExtent;e=r.crs.getRectangleFromExtent(t);i(e)})})}async pickFeatures(e){var t=[],i=this.agMetaData.layerTable.split(",");if(!isNaN(i[0])){var r,n=new a(this.viewer,this.agMetaData.queryUrl,this.crs),o=n.buildQueryPolyonByCursor(e),s={};this.crs&&this.crs.spatialReference&&(s.outSR=JSON.stringify(this.crs.spatialReference));for(let e=0;e<i.length;e++)isNaN(i[e])||(s.subLayerName=Number(i[e]),(r=await n.queryFeatureByPolygon(o,s)).data&&r.data.features.length&&(r.data.features[0].geometryType=r.data.geometryType,r.data.displayFieldName?r.data.features[0].value=r.data.features[0].attributes[r.data.displayFieldName]:r.data.features[0].value=r.data.features[0].attributes[r.data.fields[0].name],t.push({data:r.data.features[0],properties:r.data.features[0].attributes,imageryLayer:this})));return t}}async getLegendData(e){return Cesium.defined(this.layerLegend)||await this.getLegend(),e&&e(this.layerLegend,this),!0}getLegend(){this.layerLegend={};let t=new Cesium.Resource({url:this.agMetaData.queryUrl+"/legend",queryParameters:this.agMetaData.extraParams}),a=this;return new Promise(e=>{t.fetchJson().then(function(i){if(i&&i.layers&&i.layers.length){var r=a.agMetaData.layerTable.split(","),n=[];for(let e=0;e<r.length;e++){let t=Number(r[e]);var o=i.layers.find(e=>e.layerId==t);if(o&&o.legend)for(let e=0;e<o.legend.length;e++){var s=o.legend[e].label||o.layerName;n.push({label:s,value:o.legend[e].values?o.legend[e].values[0]:s,imageUrl:"data:image/png;base64,"+o.legend[e].imageData,height:o.legend[e].height,width:o.legend[e].width})}}a.layerLegend.legend={legendList:n},e(!0)}e(!1)})})}zoomToLayer(){this.rectangle&&this.viewer.camera.setView({destination:this.rectangle})}dispose(){this.updateEvent&&(this.viewer.camera.moveEnd.removeEventListener(this.updateEvent),this.updateEvent=null),this.removeAll();let i=this;return new Promise(function(e,t){e(i)})}}var l=s},8491:function(e,t,i){"use strict";class r extends i(1133).Z{static layerType="090100";constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this._initialize(e)}_initialize(e){var t={layerType:r.layerType,url:"",spatialReference:{wkid:"4326"},layerIndex:void 0,username:void 0,token:"pk.eyJ1IjoianVsaWExMjMzIiwiYSI6ImNsYzc0YTJ6bTBlbDczd3AyeGlkYzc4YnAifQ.nrwjs3oUknyvExygWCEe5w",styleId:"ckmvg2hdp0hlw17r1272s7lfx",minimumLevel:0,maximumLevel:void 0};if(Object.assign(this.agMetaData,t,e),!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.");if(!this.agMetaData.layerTable)throw new Cesium.DeveloperError("The name of layer or sublayers is required.");this._isLoadData=!1,this._isAddViewer=!1,this._loadData()}_loadData(){var e;this._isLoadData||(this._getUrlQueryParams(this.agMetaData.url),this.agMetaData.username=this.agMetaData.layerTable,this.agMetaData.accessToken=this.agMetaData.token,e=new Cesium.MapboxStyleImageryProvider(this.agMetaData),this._imageryLayerProviders.push(e),this.loadDataPromise=Promise.resolve(e),this._isLoadData=!0)}_getUrlQueryParams(e){let r={url:e};e.includes("?")&&(e=e.split("?"),r.url=e[0],(e=e[1].split("&")).length)&&(e.forEach(e=>{var t,i=e.indexOf("=");0<=i&&(t=e.slice(0,i),e=e.slice(i+1),r[t]=e)}),Object.assign(this.agMetaData,r))}zoomToLayer(){var e;this._imageryLayerProviders?.length&&(e=this._imageryLayerProviders[0]?._rectangle)&&this.viewer.camera.setView({destination:e})}}t.Z=r},4420:function(e,t,i){"use strict";var r=i(1133),n=i(8726),s=i(2053);class o extends r.Z{static layerType="015000";constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this.initialize(e)}initialize(e){var t={layerType:o.layerType,url:"",layerTable:void 0};if(Object.assign(this.agMetaData,t,e),!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.");this._isLoadData=!1,this._isAddViewer=!1,this._loadData()}_loadData(){this._isLoadData||(this.loadDataPromise=this.add(this.agMetaData,this.agMetaData.tilesetOption).then(()=>{this._isLoadData=!0}))}async add(e,t){var r=await s.Z.getData(e.url);if(r){let i=[];if("7"===r.sourceType)i=this.handleSpacePackage(e.layerTable,r.children);else{var n=r["children"];for(let e=0,t=n.length;e<t;e++){var o=n[e];o.show=0===e,i.push(o)}}this.addTilesFun({curLayerStatus:i,tileSetOption:t,res:r,ly:e}),this._innerSetVisibleHandler=this.handlePackageLayer}}handleSpacePackage(e,i){if(!e)return i.forEach(e=>{e.isSpace=!0,e.show=!0}),i;let r=[],t=[];return e.split(";").forEach(t=>{i.forEach(e=>{e.id===t&&(e.show=!0,r.push(e))})}),(t=r.concat(this.getDifference(r,i))).forEach(e=>e.isSpace=!0),t}addTilesFun(i){var r=JSON.parse(JSON.stringify(i.res.children));i.curLayerStatus.forEach(async e=>{e.layerId=i.ly.id,e.url=e.path||e.contentPath,e.stateChildrens=r,e.layerSourceType=i.res.sourceType;var t=await n.Z.add3DTileset(e.url,i.tileSetOption);t&&(!1===e.show&&(t.show=!1),t.agMetaData=e,this._primitives.push(t))})}handlePackageLayer(t){for(let e=0;e<this._primitives.length;e++)t?this._primitives[e].agMetaData.isSpace?this._primitives[e].show=!!this._primitives[e].agMetaData.show:(this._primitives[0].show=t,this._primitives.forEach((e,t)=>{0<t&&(e.show=!1)})):this._primitives[e].show=t;return!1}getDifference(e,t){let i={},r={};e.forEach(e=>{i[e.id]=e}),t.forEach(e=>{r[e.id]=e});var n,o,s=[];for(n in i)r[n]||(i[n].show=!1,s.push(i[n]));for(o in r)i[o]||(r[o].show=!1,s.push(r[o]));return s}}t.Z=o},7665:function(e,t,i){"use strict";var r=i(1133),u=i(53),o=i(3829),n=i(7830),h=i.n(n);let A=new(i(8778).Z);class s extends r.Z{static layerType="019500";constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this.layerType=s.layerType,this.url=e?.url,this.data=[],this.agMetaData={...this.agMetaData,url:this.url,layerType:this.layerType},this.viewer=e?.viewer||CIM.viewer,this._cacheDatas=new Map,this._labels=[],this._removeEventListener=void 0,this._handleWheelListener()}throttle(i,r){var n=Date.now();return function(){var e=arguments,t=Date.now();r<=t-n&&(i.apply(this,e),n=Date.now())}}async _init(){await this._requestRoadData(),this._dataToLabels();var t=[];for(let e=0;e<this._labels.length;e++){var i=this._labels[e],i=this.createLabelEntity(i.label,i.position,i.angle,i.isColumn);t.push(i)}return t}async _addToViewer(){var e=await this._init();if(this._entities=e,!this._isAddViewer){for(let e=this._entities.length-1;-1<e;e--)this.viewer.entities.add(this._entities[e]);this._isAddViewer=!0}}async _requestRoadData(){var i=A.get(this.viewer.scene.camera);let r=[];for(let e=0,t=i.length;e<t;e++){var{x:n,y:o,level:s}=i[e],a=this._cacheDatas.get(n+`/${o}/`+s);if(a)r=[...r,...a];else{var l=(await new Cesium.Resource({url:this.url+`&z=${s}&x=${n}&y=`+o}).fetchJson())["content"];if(l){var u=[];for(let e=0;e<l.length;e++){var c=l[e],c=h().parse(c.the_geom),c={name:l[e].name,the_geom:c};r.push(c),u.push(c)}this._cacheDatas.set(n+`/${o}/`+s,u)}}}this.data=r}_dataToLabels(){var i=[];for(let e=0,t=this.data.length;e<t;e++){var r=this.data[e],{coordinates:n,type:o}=r.the_geom;if("LineString"===o){var{angle:s,position:a,isColumn:l}=this._computeAngle(n);i.push({position:a,label:r.name,angle:s,isColumn:l})}else if("MultiLineString"===o)for(let e=0,t=n.length;e<t;e++){var u=n[e],{angle:u,position:c,isColumn:h}=this._computeAngle(u);i.push({position:c,label:r.name,angle:u,isColumn:h})}}this._labels=i}_handleWheelListener(e){const t=this;this._removeEventListener=this.viewer.scene.camera.changed.addEventListener(this.throttle(()=>{t.removeAll(),t._isAddViewer=!1,t._addToViewer()},1e3))}_computeAngle(e){var t=Math.floor(e.length/2)-1,i=e[t],e=e[1+t],t=o.point(i),e=o.point(e),t=o.rhumbBearing(t,e);let r=(t=o.bearingToAzimuth(t))-90,n=(180<t&&(r+=180),!1);0<=t&&t<=45?(n=!0,r+=90):135<t&&t<=180?(n=!0,r-=90):180<t&&t<=225?(n=!0,r+=90):315<t&&t<=360&&(n=!0,r-=90);e=Cesium.Math.toDegrees(0),t=this.viewer.camera.heading,t=Cesium.Math.toDegrees(t);return(315<Math.abs(t)&&Math.abs(t)<=360||0<Math.abs(t)&&Math.abs(t)<=45)&&!(315<Math.abs(e)&&Math.abs(e)<=360||0<Math.abs(e)&&Math.abs(e)<=45)||(225<Math.abs(t)&&Math.abs(t)<=315&&!(225<Math.abs(e)&&Math.abs(e)<=315)?(r+=270,n=!n):135<Math.abs(t)&&Math.abs(t)<=225&&!(135<Math.abs(e)&&Math.abs(e)<=225)?(r+=180,n=!n):45<Math.abs(t)&&Math.abs(t)<135&&!(45<Math.abs(e)&&Math.abs(e)<=135)&&(r+=90,n=!n)),{position:i,angle:r,isColumn:n}}createLabelEntity(e,t,i=0,r=!1){var n=(0,u.Z)(e,{padding:2,fill:!0,fillColor:Cesium.Color.RED,font:"60px sans-serif",column:r}),o=Cesium.Cartesian3.fromDegrees(t[0],t[1],0),s=Cesium.Math.toRadians(i),a=Cesium.Math.toRadians(0),l=Cesium.Math.toRadians(0),s=new Cesium.HeadingPitchRoll(s,a,l),a=Cesium.Transforms.headingPitchRollQuaternion(o,s),l=new Cesium.Entity({position:o,orientation:a,plane:{plane:new Cesium.Plane(Cesium.Cartesian3.UNIT_Z,0),dimensions:new Cesium.Cartesian2(n.width,n.height),material:new Cesium.ImageMaterialProperty({image:n,transparent:!0}),outline:!1,clampToGround:!0,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND}});return l._roadLabel=e,l._roadPosition=t,l._heading=this.viewer.camera.heading,l._angle=i,l._isColumn=r,l._isRoadText=!0,l}dispose(){let i=this;return this._isAddViewer?(Cesium.defined(this._removeEventListener)&&(this._removeEventListener(),this._removeEventListener=void 0),this.removeAll(),new Promise(function(e,t){e(i)})):new Promise(function(e,t){e(i)})}}t.Z=s},1049:function(e,t,i){"use strict";var r=i(1133),o=i(2053),n=i(3924);class s extends r.Z{static layerType="113200";constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this.initialize(e)}initialize(e){if(Object.assign(this.agMetaData,e),this.agMetaData.layerType=s.layerType,!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.");this._isLoadData=!1,this._isAddViewer=!1,this._loadData()}_loadData(){this._isLoadData||(this.loadDataPromise=new Promise(n=>{var e=this.agMetaData.url;if(this._checkIsServerSet(e)){let r=e.substr(0,e.lastIndexOf("/"));Cesium.Resource.createIfNeeded(e).fetchJson().then(t=>{for(let e=0;e<t.items.length;e++){var i=r+t.items[e],i=o.Z.getProxyUrl(i),i=this._loadS3M(i);n(i)}})}else{e=o.Z.getProxyUrl(e),e=this._loadS3M(e);n(e)}}))}_loadS3M(e){var i={url:e,...this.agMetaData.tilesetOption,context:this.viewer.scene._context,nameCn:this.agMetaData.nameCn};if(this.agMetaData.data){var r=JSON.parse(JSON.parse(this.agMetaData.data).senceExtendData);for(let t=0;t<r.length;t++)if(""!=r[t].key){let e=r[t].value;"boolean"==r[t].explain&&(e=Boolean(e)),"number"==r[t].explain&&(e=Number(e)),"json"==r[t].explain&&(e=JSON.parse(e)),i[r[t].key]=e}}e=new n.Z(i);return e.agMetaData=this.agMetaData,this._primitives.push(e),this._isLoadData=!0,e}_checkIsServerSet(e){return!!e.endsWith("json")}getPosition(){return new Promise((t,e)=>{var i=this.agMetaData.url;Cesium.Resource.createIfNeeded(i).fetchJson().then(function(e){t(e.geoBounds)})})}zoomToLayer(){this.rectangle?this.viewer.camera.setView({destination:this.rectangle}):this._primitives[0]?._rectangle?this.viewer.camera.setView({destination:this._primitives[0]._rectangle}):this.getPosition().then(e=>{this.rectangle=Cesium.Rectangle.fromDegrees(e.left,e.bottom,e.right,e.top),this.viewer.camera.setView({destination:this.rectangle})})}setStyle(e){for(var t=new Cesium.Cesium3DTileStyle(e),i=0;i<this._primitives.length;i++)this._primitives[i].style=t}}t.Z=s},6559:function(e,t){"use strict";t.Z=class i{static layerType="111800";get id(){return this.agMetaData.id}set id(e){this.agMetaData.id=e}constructor(e){e=Cesium.defaultValue(e,{}),this.viewer=Cesium.defaultValue(e.viewer,CIM.viewer),this.agMetaData={id:Cesium.createGuid()},this.imageryLayer=null,this.rectangle=null,this._initialize(e)}_initialize(e){var t={layerType:i.layerType,url:""};if(Object.assign(this.agMetaData,t,e),!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.");this._isLoadData=!1,this._isAddViewer=!1,this._loadData()}_loadData(){var e;this._isLoadData||(e={url:this.agMetaData.url},this.agMetaData.maximumLevel&&(e.maximumLevel=this.agMetaData.maximumLevel),this.agMetaData.minimumLevel&&(e.minimumLevel=this.agMetaData.minimumLevel),this.superMapImageryProvider=new SuperMap3D.SuperMapImageryProvider(e),this._isLoadData=!0,this.loadDataPromise=Promise.resolve(this.superMapImageryProvider))}_addToViewer(e){this._isAddViewer||(this.imageryLayer=this.viewer.imageryLayers.addImageryProvider(this.superMapImageryProvider),this._isAddViewer=!0)}zoomToLayer(){this.rectangle?this.viewer.camera.setView({destination:this.rectangle}):this.addViewerPromise=this.loadDataPromise.then(()=>{var e=this.imageryLayer.getImageryRectangle();e&&(this.rectangle=e,this.viewer.camera.setView({destination:this.rectangle}))})}remove(){this.imageryLayer&&this.viewer.imageryLayers.remove(this.imageryLayer)}dispose(){let i=this;return this.remove(),new Promise(function(e,t){e(i)})}}},4508:function(e,t){"use strict";t.Z=class i{static layerType="113210";get id(){return this.agMetaData.id}constructor(e){e=Cesium.defaultValue(e,{}),this.viewer=Cesium.defaultValue(e.viewer,CIM.viewer),this.agMetaData={id:Cesium.createGuid()},this.s3mTilesLayers=null,this.rectangle=null,this._initialize(e),this.cameraParams=null}_initialize(e){var t={layerType:i.layerType,url:""};Object.assign(this.agMetaData,t,e),this.agMetaData.url?(this._isLoadData=!1,this._isAddViewer=!1):console.error("AgSuperMapS3MTilesLayer需要url",this.agMetaData)}_addToViewer(e,t){var i;t._isLoadData?(this.addViewerPromise=this.setVisible(t.loadDataPromise,!0),this.loadDataPromise=t.loadDataPromise):this._isLoadData||(i="config"==this.agMetaData.url.split("/").pop()?this.viewer.scene.addS3MTilesLayerByScp(this.agMetaData.url):this.viewer.scene.open(this.agMetaData.url,{autoSetView:!1}),this.loadDataPromise=i,this.addViewerPromise=i.then(e=>{e.constructor===Array?this.s3mTilesLayers=e:this.s3mTilesLayers=[e],t._isLoadData=!0,this._isLoadData=!0,this._isAddViewer=!0}).catch(e=>{console.error(e),this._isLoadData=!1,this._isAddViewer=!1}),t.loadDataPromise=i)}setVisible(e,t){return e.then(e=>{e.constructor===Array&&0<e.length?e.forEach(e=>{e.show=t}):e.show=t}).catch(e=>{})}zoomToLayer(){var e;this.cameraParams?CIM.viewer.camera.flyTo(this.cameraParams):(e=this.agMetaData.url+"/scenes.json",Cesium.Resource.fetchJson({url:e}).then(e=>{e.length&&e[0].path?Cesium.Resource.fetchJson({url:e[0].path+".json"}).then(e=>{e&&e.camera?(e={destination:Cesium.Cartesian3.fromDegrees(e.camera.longitude,e.camera.latitude,e.camera.altitude),orientation:{heading:Cesium.Math.toRadians(e.camera.heading),pitch:Cesium.Math.toRadians(e.camera.tilt-90),roll:0}},this.cameraParams=e,CIM.viewer.camera.flyTo(e)):console.warn("无法定位，数据缺少camera字段！")}).catch(e=>console.error(e)):console.warn("无法定位，数据缺少path字段！")}).catch(e=>console.error(e)))}remove(){this.setVisible(this.loadDataPromise,!1)}dispose(){let i=this;return this.remove(),new Promise(function(e,t){e(i)})}}},115:function(e,t){"use strict";t.Z=class i{static layerType="114000";get id(){return this.agMetaData.id}constructor(e){e=Cesium.defaultValue(e,{}),this.viewer=Cesium.defaultValue(e.viewer,CIM.viewer),this.agMetaData={id:Cesium.createGuid()},this.superMapTerrainProvider=null,this._initialize(e)}_initialize(e){var t={layerType:i.layerType,url:""};if(Object.assign(this.agMetaData,t,e),!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.");this._isLoadData=!1,this._isAddViewer=!1,this._loadData()}_loadData(){this._isLoadData||(this.superMapTerrainProvider=new SuperMap3D.SuperMapTerrainProvider({url:this.agMetaData.url,isSct:!0,invisibility:!0}),this._isLoadData=!0,this.loadDataPromise=this.superMapTerrainProvider.readyPromise)}_addToViewer(e){this._isAddViewer||(this._layerTree=e||CIM.layerTree,this.addViewerPromise=this.loadDataPromise.then(()=>{this._layerTree.uncheckArcGISTiledElevationTerrain(),this.viewer.terrainProvider=this.superMapTerrainProvider,this._isAddViewer=!0}))}remove(){this.viewer.terrainProvider=new Cesium.EllipsoidTerrainProvider}zoomToLayer(){this.superMapTerrainProvider.readyPromise.then(()=>{this.superMapTerrainProvider&&this.superMapTerrainProvider._rectangle&&this.viewer.camera.setView({destination:this.superMapTerrainProvider._rectangle})})}dispose(){let i=this;return this.remove(),new Promise(function(e,t){e(i)})}}},8560:function(e,t,i){"use strict";var r=i(7720),n=i(812),o=i(4723);class s extends r.Z{static layerType="110310";constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this.rectangle=null,this._initialize(e)}_initialize(e){var t={layerType:s.layerType,url:"",layerTable:"",spatialReference:{wkid:"4326"},queryParameters:{REQUEST:"GetFeature",MAXFEATURES:5e3,VERSION:"1.0.0",SERVICE:"WFS",OUTPUTFORMAT:"json"}};Object.assign(this.agMetaData,t,e),this.agMetaData.url?this.agMetaData.layerTable?("2.0.0"==this.agMetaData.version?(this.agMetaData.queryParameters.VERSION=this.agMetaData.version,this.agMetaData.queryParameters.TYPENAMES=this.agMetaData.layerTable):this.agMetaData.queryParameters.TYPENAME=this.agMetaData.layerTable,t=this._getUrlQueryParams(this.agMetaData.url),this.agMetaData.url=t.url,t.queryParameters.maxFeatures&&(this.agMetaData.queryParameters.MAXFEATURES=t.queryParameters.maxFeatures),t.queryParameters.propertyName&&(this.agMetaData.queryParameters.PROPERTYNAME=t.queryParameters.propertyName),t.queryParameters.idField&&this.agMetaData.queryParameters.propertyName&&(this.agMetaData.queryParameters.propertyName+=","+t.queryParameters.idField,this.agMetaData.queryParameters.idField=t.queryParameters.idField),this._isLoadData=!1,this._isAddViewer=!1,this._loadData()):console.error("AgSuperMapWFSLayer需要layerTable",this.agMetaData):console.error("AgSuperMapWFSLayer需要url",this.agMetaData)}_loadData(){this._isLoadData||(this.loadDataPromise=Cesium.Resource.fetchJson({url:this.agMetaData.url,queryParameters:this.agMetaData.queryParameters}).then(async t=>{o.Z.findCrsByName("4326").transfromData(this.agMetaData,t);var e=await Cesium.GeoJsonDataSource.load(t,{clampToGround:!0}).catch(e=>(console.error("AgSuperMapWFSLayer的GeoJSON加载失败",this.agMetaData,t,e),null));if(e)return e.name=this.id,e.agMetaData=this.agMetaData,(e.layer=this)._changeDefaultBillborad2Point(e),this._setStyle(e),this._dataSource.push(e),this._isLoadData=!0,this.rectangle||(this.crs=new Cesium.CRSSupport(this.agMetaData.spatialReference),this.loadDataPromise=this._getLayerExtent(this.agMetaData.url,this.agMetaData.layerTable).then(e=>{e=JSON.parse(JSON.stringify(e));this.rectangle=this.crs.getRectangleFromExtent(e),this.rectangle=this._expandRectangle(this.rectangle)})),e},e=>(console.error("AgWFSLayer图层查询失败",this.agMetaData,e),null)))}_getLayerExtent(t,n){return new Promise((r,e)=>{new Cesium.Resource({url:t+"?request=GetCapabilities&service=WFS&layers="+n,queryParameters:{}}).fetch().then(e=>{var t,i=(new DOMParser).parseFromString(e,"text/html").documentElement.getElementsByTagName("FeatureType");for(let e=0;e<i.length;e++)if(i[e].getElementsByTagName("Name")[0].firstChild.data==n)return t={xmin:parseFloat(i[e].getElementsByTagName("latlongboundingbox")[0].attributes.minx.value),ymin:parseFloat(i[e].getElementsByTagName("latlongboundingbox")[0].attributes.miny.value),xmax:parseFloat(i[e].getElementsByTagName("latlongboundingbox")[0].attributes.maxx.value),ymax:parseFloat(i[e].getElementsByTagName("latlongboundingbox")[0].attributes.maxy.value)},void r(t)})})}_expandRectangle(e,t=6){var t=Math.pow(10,t),i=Math.floor(e.west*t)/t,r=Math.floor(e.south*t)/t,n=Math.ceil(e.east*t)/t,e=Math.ceil(e.north*t)/t;return new Cesium.Rectangle(i,r,n,e)}_setStyle(e){this.agMetaData.styleManagerId?new n.Z(this).setStyle(e,this.agMetaData.styleManagerId):this.agMetaData.customStyle&&this.setStyle(this.agMetaData.customStyle)}}t.Z=s},8490:function(e,t,i){"use strict";class r extends i(1133).Z{static layerType="110200";constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this._initialize(e)}_initialize(e){var t={layerType:r.layerType,url:"",layerTable:"",spatialReference:{wkid:"4326"},crs:"EPSG:4326",layerIndex:void 0,queryParameters:{request:"GetMap",version:"1.1.1",service:"WMS",format:"image/png",transparent:!0,style:""}};if(Object.assign(this.agMetaData,t,e),!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.");if(!this.agMetaData.layerTable)throw new Cesium.DeveloperError("The name of layer or sublayers is required.");this.agMetaData.version&&(this.agMetaData.queryParameters.version=this.agMetaData.version),"1.1.1"==this.agMetaData.queryParameters.version||"1.1.0"==this.agMetaData.queryParameters.version?this.agMetaData.queryParameters.srs=this.agMetaData.crs:this.agMetaData.queryParameters.crs=this.agMetaData.crs,this._isLoadData=!1,this._isAddViewer=!1,this._loadData()}_loadData(){if(!this._isLoadData){let t=this._getUrlQueryParams(this.agMetaData.url);if(this.crs=new Cesium.CRSSupport(this.agMetaData.spatialReference),[102100,102113,3857,900913].includes(this.crs.wkid))this.agMetaData.tilingScheme=new Cesium.WebMercatorTilingScheme;else{if(![4326,4490].includes(this.crs.wkid))return void console.error(`The spatial Reference of EPSG:${this.crs.wkid} is not supported!`);this.agMetaData.tilingScheme=new Cesium.GeographicTilingScheme}this.loadDataPromise=this._getLayerExtent(t).then(e=>{this.rectangle=e;e=new Cesium.WebMapServiceImageryProvider({url:t.url,layers:this.agMetaData.layerTable,tilingScheme:this.agMetaData.tilingScheme,parameters:this.agMetaData.queryParameters});return this._imageryLayerProviders.push(e),this._isLoadData=!0,e},()=>(console.error(`Fail to get capabilities of this layer of ${this.agMetaData.url}!`),null))}}_getUrlQueryParams(e){let r={url:e,queryParameters:{}};return e.includes("?")&&(e=e.split("?"),r.url=e[0],(e=e[1].split("&")).length)&&(e.forEach(e=>{var t,i=e.indexOf("=");0<=i&&(t=e.slice(0,i),e=e.slice(i+1),r.queryParameters[t]=e)}),Object.assign(this.agMetaData.queryParameters,r.queryParameters)),r.url.endsWith("/")&&(r.url=r.url.slice(0,-1)),this.agMetaData.queryUrl=r.url,r}_getLayerExtent(t){let a=this;return new Promise((s,e)=>{new Cesium.Resource({url:t.url+"?request=GetCapabilities&service=WMS",queryParameters:t.queryParameters}).fetch().then(function(e){var t=(new DOMParser).parseFromString(e,"text/html").documentElement.getElementsByTagName("Layer"),i=a.agMetaData.layerTable;for(let e=0;e<t.length;e++){var r=t[e].getElementsByTagName("Name")[0].firstChild.data;if(r==a.agMetaData.layerTable||r==i){var n=t[e].getElementsByTagName("BoundingBox");for(let e=0;e<n.length;e++){var o=n[e].getAttribute("SRS")?"srs":"crs";if(n[e].getAttribute(o)||n[e].getAttribute(o)==a.agMetaData.crs){o={xmin:parseFloat(n[e].getAttribute("minx")),ymin:parseFloat(n[e].getAttribute("miny")),xmax:parseFloat(n[e].getAttribute("maxx")),ymax:parseFloat(n[e].getAttribute("maxy"))},o=a.crs.getRectangleFromExtent(o);s(o);break}}}}})})}zoomToLayer(){this.rectangle&&this.viewer.camera.flyTo({destination:this.rectangle})}}t.Z=r},2499:function(e,t,i){"use strict";class r extends i(5875).Z{static layerType="110100";constructor(e){super(e)}_initialize(e){var t={layerType:r.layerType,url:"",spatialReference:{wkid:"4326"},layerIndex:void 0,token:void 0,tileWidth:256,tileHeight:256,matrixWidth:2,matrixHeight:1,tileOriginX:void 0,tileOriginY:void 0,tile0Resolution:void 0,tileMatrixLabels:[],tileMatrixSet:"EPSG:4326",style:"",format:"image/png",minimumLevel:0,maximumLevel:void 0};if(Object.assign(this.agMetaData,t,e),!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.");if(!this.agMetaData.layerTable)throw new Cesium.DeveloperError("The name of layer or sublayers is required.");if(!this.agMetaData.tileMatrixSet)throw new Cesium.DeveloperError("The tileMatrixSet of layer is required.");this._isLoadData=!1,this._isAddViewer=!1,this._loadData()}_loadData(){if(!this._isLoadData){var e=this._getUrlQueryParams(this.agMetaData.url),e=new Cesium.Resource({url:e.url+"?request=GetCapabilities&service=WMTS&version=1.0.0",queryParameters:e.queryParameters});let a=this;this.loadDataPromise=e.fetch().then(function(e){var e=(new DOMParser).parseFromString(e,"text/html"),t=e.documentElement.getElementsByTagName("Layer");for(let e=0;e<t.length;e++){var i=t[e].getElementsByTagName("Layer");if(!i.length)if(t[e].getElementsByTagName("ows:Identifier")[0].firstChild.data==a.agMetaData.layerTable){a.agMetaData.style||(i=t[e].getElementsByTagName("Style")[0].firstChild.data.match(/>.*</))?.length&&(a.agMetaData.style=i[0].slice(1,-1));i=t[e].getElementsByTagName("ows:BoundingBox")[0];if(i){let e=i.getElementsByTagName("ows:LowerCorner")[0].firstChild.data,t=i.getElementsByTagName("ows:UpperCorner")[0].firstChild.data;e=e.split(" "),t=t.split(" "),a.boundingBoxRectangle=Cesium.Rectangle.fromDegrees(e[0],e[1],t[0],t[1])}}}var r=e.documentElement.getElementsByTagName("TileMatrixSet");for(let e=0;e<r.length;e++){var n=r[e].getElementsByTagName("ows:Identifier");if(n.length&&n[0].firstChild.data==a.agMetaData.tileMatrixSet){var o=r[e].getElementsByTagName("TileMatrix");let t=0;if(a.agMetaData.tileMatrixLabels?.length){for(let e=0;e<o.length;e++)if(o[e].getElementsByTagName("ows:Identifier")[0].firstChild.data==a.agMetaData.tileMatrixLabels[0]){t=e;break}}else{a.agMetaData.tileMatrixLabels=[];for(let e=0;e<o.length;e++)a.agMetaData.tileMatrixLabels.push(o[e].getElementsByTagName("ows:Identifier")[0].firstChild.data)}var n=new Cesium.CRSSupport(a.agMetaData.spatialReference),s=(a.agMetaData.matrixWidth=parseInt(o[t].getElementsByTagName("MatrixWidth")[0].textContent),a.agMetaData.matrixHeight=parseInt(o[t].getElementsByTagName("MatrixHeight")[0].textContent),a.agMetaData.tileWidth=parseInt(o[t].getElementsByTagName("TileWidth")[0].textContent),a.agMetaData.tileHeight=parseInt(o[t].getElementsByTagName("TileHeight")[0].textContent),Cesium.defined(a.agMetaData.tile0Resolution)||(s=Number(o[t].getElementsByTagName("ScaleDenominator")[0].textContent),a.agMetaData.tile0Resolution=n.scaleDenominator2Resolution(s)),Cesium.defined(a.agMetaData.tileOriginY)&&Cesium.defined(a.agMetaData.tileOriginX)||(n=o[t].getElementsByTagName("TopLeftCorner")[0].textContent.split(" "),Math.abs(Number(n[0]))<Math.abs(Number(n[1]))?(a.agMetaData.tileOriginY=Number(n[0]),a.agMetaData.tileOriginX=Number(n[1])):(a.agMetaData.tileOriginY=Number(n[1]),a.agMetaData.tileOriginX=Number(n[0]))),a.agMetaData.tile0Resolution*a.agMetaData.tileWidth*a.agMetaData.matrixWidth),n=a.agMetaData.tile0Resolution*a.agMetaData.tileHeight*a.agMetaData.matrixHeight,n=(a.agMetaData.tileRectangle=Cesium.Rectangle.fromDegrees(a.agMetaData.tileOriginX,a.agMetaData.tileOriginY-n,a.agMetaData.tileOriginX+s,a.agMetaData.tileOriginY),a.agMetaData.tilingScheme=new Cesium.GeographicTilingScheme({numberOfLevelZeroTilesX:a.agMetaData.matrixHeight,numberOfLevelZeroTilesY:a.agMetaData.matrixWidth,rectangle:a.agMetaData.tileRectangle}),Object.assign({},a.agMetaData,{layer:a.agMetaData.layerTable,tileMatrixSetID:a.agMetaData.tileMatrixSet})),n=new Cesium.WebMapTileServiceImageryProvider(n);return a._imageryLayerProviders.push(n),a._isLoadData=!0,n}}})}}zoomToLayer(){this.boundingBoxRectangle&&this.viewer.camera.setView({destination:this.boundingBoxRectangle})}}t.Z=r},8270:function(e,t,i){"use strict";class r extends i(1133).Z{static layerType="050100";constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this._initialize(e)}_initialize(e){var t={layerType:r.layerType,spatialReference:{wkid:4490},layerIndex:void 0,format:"image/jpeg",style:"default",minimumLevel:0,maximumLevel:18,subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],tileMatrixLabels:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],layer:"",tileMatrixSetID:""};if(Object.assign(this.agMetaData,t,e),!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.");this._isLoadData=!1,this._isAddViewer=!1,this._loadData()}_loadData(){if(!this._isLoadData){if(this.crs=new Cesium.CRSSupport(this.agMetaData.spatialReference),[102100,102113,3857,900913].includes(this.crs.wkid))this.agMetaData.tilingScheme=new Cesium.WebMercatorTilingScheme({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2});else{if(![4326,4490].includes(this.crs.wkid))return void console.error(`The spatial Reference of EPSG:${this.crs.wkid} is not supported!`);this.agMetaData.tilingScheme=new Cesium.GeographicTilingScheme}var e=new Cesium.WebMapTileServiceImageryProvider(this.agMetaData);this._imageryLayerProviders.push(e),this.loadDataPromise=Promise.resolve(e),this._isLoadData=!0}}}t.Z=r},5205:function(e,t){"use strict";t.Z=class i{static layerType="014000";get id(){return this.agMetaData.id}set id(e){this.agMetaData.id=e}constructor(e){e=Cesium.defaultValue(e,{}),this.viewer=Cesium.defaultValue(e.viewer,CIM.viewer),this.agMetaData={id:Cesium.createGuid()},this._terrainLayers=[],this._terrainLayerProviders=[],this._initialize(e)}_initialize(e){var t={layerType:i.layerType,url:"",requestWaterMask:!0,requestVertexNormals:!0,requestMetadata:void 0,ellipsoid:void 0,credit:void 0};if(Object.assign(this.agMetaData,t,e),!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.");this._isLoadData=!1,this._isAddViewer=!1,this._loadData()}_loadData(){this._isLoadData||(this._getUrlQueryParams(this.agMetaData.url),this.terrainLayerCollection=new Cesium.cesiumTerrainLayerCollection(this.viewer),this.loadDataPromise=this.terrainLayerCollection.createCesiumTerrainProvider(this.agMetaData).then(e=>{this._terrainLayerProviders.push(e),this._isLoadData=!0}))}_addToViewer(e){this._isAddViewer||(this._layerTree=e||CIM.layerTree,this.addViewerPromise=this.loadDataPromise.then(()=>{this._layerTree.uncheckArcGISTiledElevationTerrain(this.agMetaData.id);for(let e=this._terrainLayerProviders.length-1;-1<e;e--){var t=this.terrainLayerCollection._addProcess(this.agMetaData,this._terrainLayerProviders[e]);this._terrainLayers.push(t)}this._isAddViewer=!0}))}zoomToLayer(){var e;this._terrainLayerProviders?.length&&(e=this._terrainLayerProviders[0]?._rectangle)&&this.viewer.camera.setView({destination:e})}_getUrlQueryParams(e){(e=e.endsWith("layer.json")?e.slice(0,-10):e).endsWith("/")&&e.slice(0,-1)}remove(){if(this.terrainLayerCollection)for(let e=this._terrainLayers.length-1;-1<e;e--)this.terrainLayerCollection.remove(this._terrainLayers[e])}dispose(){let i=this;return this.remove(),new Promise(function(e,t){e(i)})}}},7201:function(e,t,i){"use strict";var r=i(1133),n=i(9359);class o extends r.Z{static layerType="010201";static defaultOptions={layerType:o.layerType,url:"",layerTable:"",spatialReference:{wkid:"4326"},crs:"CRS:84",layerIndex:void 0,tileWidth:256,tileHeight:256,subdomains:"abc",queryParameters:{request:"GetMap",version:"1.3.0",service:"WMS",format:"image/png",transparent:!0,style:""}};constructor(e){super((e=e||{})?.viewer||CIM.viewer),this.agMetaData={...this.agMetaData,...o.defaultOptions,...e},this._isLoadData=!1,this._isAddViewer=!1,this._initialize(e)}_initialize(){if(!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.");if(!this.agMetaData.layerTable)throw new Cesium.DeveloperError("The name of layer or sublayers is required.");this.agMetaData.version&&(this.agMetaData.queryParameters.version=this.agMetaData.version),"1.1.1"==this.agMetaData.queryParameters.version||"1.1.0"==this.agMetaData.queryParameters.version?this.agMetaData.queryParameters.srs=this.agMetaData.crs:this.agMetaData.queryParameters.crs=this.agMetaData.crs,this._loadData()}_loadData(){if(!this._isLoadData){let t=this._getUrlQueryParams(this.agMetaData.url);if(this.wfsQuery=new n.Z(this.agMetaData.queryUrl,this.agMetaData.crs,this.agMetaData.queryParameters.version,this.agMetaData.queryParameters),this.crs=new Cesium.CRSSupport(this.agMetaData.spatialReference),[102100,102113,3857,900913].includes(this.crs.wkid))this.agMetaData.tilingScheme=new Cesium.WebMercatorTilingScheme;else{if(![4326,4490].includes(this.crs.wkid))return void console.error(`The spatial Reference of EPSG:${this.crs.wkid} is not supported!`);this.agMetaData.tilingScheme=new Cesium.GeographicTilingScheme}const i=this;this.loadDataPromise=this._getLayerExtent().then(e=>{i.rectangle=e;e=new Cesium.WebMapServiceImageryProvider({url:t.url,layers:i.agMetaData.layerTable,tilingScheme:i.agMetaData.tilingScheme,parameters:i.agMetaData.queryParameters,tileWidth:i.agMetaData.tileWidth,tileHeight:i.agMetaData.tileHeight,subdomains:i.agMetaData.subdomains});return i._imageryLayerProviders.push(e),i._isLoadData=!0,e},()=>(console.error(`Fail to get capabilities of this layer of ${i.agMetaData.url}!`),null))}}_getUrlQueryParams(e){let r={url:e,queryParameters:{}};return e.includes("?")&&(e=e.split("?"),r.url=e[0],(e=e[1].split("&")).length)&&(e.forEach(e=>{var t,i=e.indexOf("=");0<=i&&(t=e.slice(0,i),e=e.slice(i+1),r.queryParameters[t]=e)}),Object.assign(this.agMetaData.queryParameters,r.queryParameters)),this.agMetaData.queryUrl=r.url,r}async _getLayerExtent(){var e=await new Cesium.Resource({url:this.agMetaData.url,queryParameters:{request:"GetCapabilities",service:"WMS",version:this.agMetaData.queryParameters.version,layers:this.agMetaData.layerTable}}).fetch(),i=(new DOMParser).parseFromString(e,"text/xml"),r=this.agMetaData.layerTable.split(","),n={xmin:void 0,ymin:void 0,xmax:void 0,ymax:void 0};for(let t=0,e=r.length;t<e;t++){let e=r[t];0<=e.indexOf(":")&&(e=e.split(":")[1]);var o=i.evaluate(`//*[local-name()="Layer"]/*[local-name()="Name"][contains(., "${e}")]`,i,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE),s=o.snapshotLength;for(let e=0;e<s;e++){var a=o.snapshotItem(e).parentNode.getElementsByTagName("BoundingBox");for(let e=0,t=a.length;e<t;e++){var l=a[e],u=l.getAttribute("SRS")?"SRS":"CRS";if(l.getAttribute(u)===this.agMetaData.crs){let e,t,i,r;r="1.3.0"==this.agMetaData.queryParameters.version&&this.agMetaData.crs.includes("EPSG")?(e=Number(l.getAttribute("miny")),t=Number(l.getAttribute("maxy")),i=Number(l.getAttribute("minx")),Number(l.getAttribute("maxx"))):(e=Number(l.getAttribute("minx")),t=Number(l.getAttribute("maxx")),i=Number(l.getAttribute("miny")),Number(l.getAttribute("maxy"))),n.xmin=!n.xmin||e<n.xmin?e:n.xmin,n.xmax=!n.xmax||t>n.xmax?t:n.xmax,n.ymin=!n.ymin||i<n.ymin?i:n.ymin,n.ymax=!n.ymax||r>n.ymax?r:n.ymax}}}}return this.crs.getRectangleFromExtent(n)}async pickFeatures(e){e=this._getQueryPolyonByScreenPosition(e),e=await this.wfsQuery.intersectsPolygon(this.agMetaData.layerTable,e);return e&&e.features&&e.features.length?{data:e.features[0],properties:e.features[0].properties,imageryLayer:this}:[]}_getQueryPolyonByScreenPosition(e,t=5){var i=this.viewer.scene,r=Math.max(0,e.x-t),n=Math.min(i.canvas.clientWidth,e.x+t),o=Math.max(0,e.y-t),e=Math.min(i.canvas.clientHeight,e.y+t),t=i.camera.getPickRay(new Cesium.Cartesian2(r,o)),r=i.camera.getPickRay(new Cesium.Cartesian2(r,e)),e=i.camera.getPickRay(new Cesium.Cartesian2(n,e)),n=i.camera.getPickRay(new Cesium.Cartesian2(n,o));return[i.globe.pick(t,i),i.globe.pick(r,i),i.globe.pick(e,i),i.globe.pick(n,i)]}zoomToLayer(){this.rectangle&&this.viewer.camera.flyTo({destination:this.rectangle})}}t.Z=o},3998:function(e,t,i){"use strict";i.d(t,{Z:function(){return p}});var r=i(8726),t=i(1133);var l=new class{constructor(){this.ZeroLevelGridLengthX=1e3,this.ZeroLevelGridLengthY=1e3}getScreenCoordinate(){var e=agcim.camera.camera.getViewExtent(CIM.viewer),t=Cesium.Rectangle.subsample(e),i=[];for(let e=0;e<t.length;e++)i[e]=agcim.maths.coordinate.getGlobalCartesian().toGeographic(new Cesium.Cartesian3(t[e].x,t[e].y,t[e].z));return i}getEdgeBlock(t,i){var r=[];for(let e=0;e<t.length;e++)r[e]=this.coordinateToBlock(t[e],i);return r}coordinateToBlock(e,t){return this.getIndexByLatLon(e,t)}getBlockSubdivision(e){var r=[],t=[],i=[],n=(e.forEach(e=>{t.push(e.x),i.push(e.y)}),Math.max(...t)),o=Math.max(...i),s=Math.min(...t),a=Math.min(...i);for(let i=0;i<=5;i++){var l=Math.floor(s/Math.pow(2,i)),u=Math.floor(n/Math.pow(2,i)),c=Math.floor(a/Math.pow(2,i)),h=Math.floor(o/Math.pow(2,i));for(let t=l;t<=u;t++)for(let e=c;e<=h;e++)r.push({x:t,y:e,z:i})}return r}getIndexByLatLon(e,t,i=0){var r=agcim.maths.coordinate.getGeographic().toCartesian({lng:t.x,lat:t.y,alt:0}),r=Cesium.Transforms.eastNorthUpToFixedFrame(r),n=new Cesium.Cartesian3(this.ZeroLevelGridLengthX*(i+1),this.ZeroLevelGridLengthY*(i+1),0),r=Cesium.Matrix4.multiplyByPoint(r,n,new Cesium.Cartesian3),n=agcim.maths.coordinate.getGlobalCartesian().toGeographic({x:r.x,y:r.y,z:r.z}),r=n.lng-t.x,n=n.lat-t.y;return{x:Math.floor((e.lng-t.x)/r),y:Math.floor((e.lat-t.y)/n),z:i}}getDistance(e,t,i,r){e=Degree2rad(e),t=Degree2rad(t),i=Degree2rad(i),t-=Degree2rad(r);return 2*Math.asin(Math.sqrt(Math.pow(Math.sin((e-i)/2),2)+Math.cos(e)*Math.cos(i)*Math.pow(Math.sin(t/2),2)))*6378137}degree2rad(e){return e*Math.PI/180}rad2degree(e){return 180*e/Math.PI}lati_to_meter(e){return e/1.57891e-7}longti_to_meter(e,t){return e/1.56785e-7*Math.abs(Math.cos(t))}meter_to_lati(e){return 1.57891e-7*e}meter_to_longti(e,t){return 1.56785e-7*e/Math.cos(t)}testLatToMeter(e){return this.EARTH_RADIUS*e}testLonToMeter(e,t){return 2*Math.asin(Math.abs(Math.cos(t)*Math.sin(e/2)))*6378137}};var n=class{constructor(e){this.screenLayers=[],this.timers={},this.index=e}getUrl(e,t,i){return e+"/models-rest/bim-rest/whiteModel/preview?x="+t.x+"&y="+t.y+"&z="+t.z+"&city="+i}isContainInScreen(t){return this.screenLayers.some(e=>e==decodeURI(t))}showHiddencontrol(e){for(const i of e._primitives){var t=this.isContainInScreen(i._url);e.setVisible(i._url,t),t?this.cancelRemoveDelay(i._id):this.delayRemove(i._id,i._url)}e.tilesStyle&&e.setStyle(e.tilesStyle),CIM.viewer.scene.requestRender()}delayRemove(e,t){this.timers[e]||this.index&&this.index.layer&&(this.timers[e]=setTimeout(()=>{this.index.removeRouteLoadMap(t),this.index.layer.removeChildLayer(e)},3e4))}cancelRemoveDelay(e){this.timers[e]&&(clearTimeout(this.timers[e]),delete this.timers[e])}};var o=class{constructor(){this.request=agcim.net.axiosWraper,this.ip=""}setIP(e){var t=new RegExp(/(\w+):\/\/([^/:]+)(:\d*)?/),e=e.match(t)[0];this.ip=""+e}async getRouteMap(e){return(await this.request.getDataByGet(this.ip+"/models-rest/bim-rest/whiteModel/routeMap?city="+e)).content}async getRouteMapCity(e){return this.request.getDataByGet(this.ip+"{whiteModel}/whiteModelIndex/check?polygon="+e)}async getAllCities(){return(await this.request.getDataByGet(this.ip+"/models-rest/bim-rest/whiteModelIndex/get")).content}},s=i(4239);let u,c;var a=class{constructor(e){this._updateBind=this.update.bind(this),this.layer=e,this.routeMap={},this.routeLoadMap={},this.allCities=null,this.timers={}}async init(){(u=new o).setIP(this.layer.agMetaData.url),c=new n(this),this.allCities=await u.getAllCities()}async run(){await this.init(this.layer.agMetaData.url),CIM.viewer.camera.moveEnd.addEventListener(this._updateBind),this.update()}async update(){15e4<CIM.viewer.camera._positionCartographic.height||await this.renderModel()}async renderModel(){var t,e=l.getScreenCoordinate(),i=this.getRouterMapCities_3();c.screenLayers=[];for(t of i){this.routeMap[t.city]||(this.routeMap[t.city]=await u.getRouteMap(t.city)),this.routeLoadMap[t.city]||(this.routeLoadMap[t.city]={});var r=new Cesium.Cartesian2(t.baseLongitude,t.baseLatitude),r=l.getEdgeBlock(e,r),n=l.getBlockSubdivision(r);for(let e=0;e<n.length;e++){var o,s=n[e],a=this.computedKey(s);this.routeMap[t.city][a]&&(this.routeLoadMap[t.city][a]?o=c.getUrl(this.layer.agMetaData.url,s,t.city):(this.routeLoadMap[t.city][a]=1,o=c.getUrl(this.layer.agMetaData.url,s,t.city),this.layer.addTilesFun(o)),c.screenLayers.push(o))}}setTimeout(()=>{c.showHiddencontrol(this.layer)},100)}async getRouterMapCities(e){e=this.concatCoordinates(e),e=await u.getRouteMapCity(e);return e.content||[]}getRouterMapCities_2(){var e,t=[],i=agcim.camera.camera.getViewExtent(CIM.viewer);for(e of this.allCities){var r=new Cesium.Rectangle(e.minX,e.minY,e.maxX,e.maxY);Cesium.Rectangle.simpleIntersection(i,r)&&t.push(e)}return t}getRouterMapCities_3(){var e,t=[];for(e of this.allCities){var i=s.Z.getBoundingSphereByDegree(e.minX,e.minY,e.maxX,e.maxY);-1!=CIM.viewer.camera.frustum._offCenterFrustum._cullingVolume.computeVisibility(i)&&t.push(e)}return t}computedKey(e){return e.x+"/"+e.y+"/"+e.z}computedKeyByUrl(e){var t=new Object;if(-1!=e.indexOf("?"))for(var i=e.substr(e.indexOf("?")+1).split("&"),r=0;r<i.length;r++)t[i[r].split("=")[0]]=decodeURI(i[r].split("=")[1]);return{city:t.city,key:t.x+"/"+t.y+"/"+t.z}}removeRouteLoadMap(e){e=this.computedKeyByUrl(e);this.routeLoadMap[e.city][e.key]=0}concatCoordinates(t){var i="";for(let e=0;e<t.length;e++)i=i+t[e].lng+","+t[e].lat+",";return i=i.slice(0,i.length-1)}removeServerData(){this.dispose(),this.removeEvent()}removeEvent(){CIM.viewer.camera.moveEnd.removeEventListener(this._updateBind)}dispose(){this.layer=null,this.allCities=null,this.routeMap={},this.routeLoadMap={},this.removeEvent()}};let h;class A extends t.Z{static layerType="019100";get id(){return this.agMetaData.id}set id(e){this.agMetaData.id=e}constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this.agMetaData={id:Cesium.createGuid()},this._initialize(e)}_initialize(e){var t={layerType:A.layerType,url:""};if(Object.assign(this.agMetaData,t,e),!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.")}_addToViewer(){(h=new a(this)).run()}isLayerAdded(t){return this._primitives.some(e=>e._url==t||e._id==t)}async addTilesFun(e){this.isLayerAdded(e)||(e=await r.Z.add3DTileset(e))&&this.addPrimitive(e)}removeChildLayer(t){var e=this._primitives,i=e.findIndex(e=>e._id==t||e._url==t);this.viewer.scene.primitives.remove(e[i]),e.splice(i,1)}setVisible(t){for(let e=0;e<this._primitives.length;e++)this._primitives[e].show=t}setStyle(e){for(var t=new Cesium.Cesium3DTileStyle(e),i=0;i<this._primitives.length;i++)this._primitives[i].style=t;this.tilesStyle=e}remove(){h.removeServerData(),this.removeAll()}dispose(){let i=this;return this.remove(),new Promise(function(e,t){e(i)})}}var p=A},5573:function(e,t,i){"use strict";i.d(t,{Z:function(){return h}});t=i(3998);var r=class{constructor(e){this.screenLayers=[],this.timers={},this.index=e}isContainInScreen(t){return this.screenLayers.some(e=>e==decodeURI(t))}showHiddencontrol(e){for(const i of e._primitives){var t=this.isContainInScreen(i._url);e.setVisible(i._url,t),t?this.cancelRemoveDelay(i._id):this.delayRemove(i._id,i._url)}e.tilesStyle&&e.setStyle(e.tilesStyle),CIM.viewer.scene.requestRender()}delayRemove(e,t){this.timers[e]||(this.timers[e]=setTimeout(()=>{if(!index||!index.layer)return index.removeRouteLoadMap(t);this.index.layer.removeChildLayer(e),this.index.removeRouteLoadMap(t)},3e4))}cancelRemoveDelay(e){this.timers[e]&&(clearTimeout(this.timers[e]),delete this.timers[e])}};var n=class{constructor(){this.request=agcim.net.axiosWraper,this.ip=""}setIP(e){var t=new RegExp(/(\w+):\/\/([^/:]+)(:\d*)?/),e=e.match(t)[0];this.ip=""+e}async getAllOps(){return(await this.request.getDataByGet(this.ip+"/models-rest/bim-rest/bimUnity/routeMap")).content}},o=i(4239);let s,a;var l=class{constructor(e){this.status=0,this._updateBind=this.update.bind(this),this.layer=e,this.routeMap={},this.routeLoadMap={},this.AllOps=null}async init(){s=new n,this.AllOps=await s.getAllOps(),a=new r(this)}async run(e){if(this.status)return this.layer?void this.removeEvent():void this.dispose();await this.init(),this.status=1,CIM.viewer.camera.moveEnd.addEventListener(this._updateBind),this.update()}async update(){1500<CIM.viewer.camera._positionCartographic.height||await this.renderModel()}async renderModel(){var e,t=this.getRouterMapCities_3();a.screenLayers=[];for(e of t)this.routeLoadMap[e.path]?a.screenLayers.push(e.path):(this.routeLoadMap[e.path]=1,a.screenLayers.push(e.path),this.layer.addTilesFun(e.path));setTimeout(()=>{a.showHiddencontrol(this.layer)},100)}async getRouterMapCities(e){e=this.concatCoordinates(e),e=await s.getRouteMapCity(e);return e.content||[]}getRouterMapCities_2(){var e,t=[],i=agcim.camera.camera.getViewExtent(CIM.viewer);for(e of this.AllOps){var r=new Cesium.Rectangle(e.minX,e.minY,e.maxX,e.maxY);Cesium.Rectangle.simpleIntersection(i,r)&&t.push(e)}return t}getRouterMapCities_3(){var e,t=[];for(e of this.AllOps){var i=o.Z.getBoundingSphereByDegree(e.minX,e.minY,e.maxX,e.maxY);-1!=CIM.viewer.camera.frustum._offCenterFrustum._cullingVolume.computeVisibility(i)&&t.push(e)}return t}computedKey(e){return e.x+"/"+e.y+"/"+e.z}removeRouteLoadMap(e){this.routeLoadMap[e]=0}concatCoordinates(t){var i="";for(let e=0;e<t.length;e++)i=i+t[e].lng+","+t[e].lat+",";return i=i.slice(0,i.length-1)}removeEvent(){this.status=0,CIM.viewer.camera.moveEnd.removeEventListener(this._updateBind)}dispose(){this.layer=null,this.allCities=null,this.routeMap={},this.routeLoadMap={},this.removeEvent()}};let u;class c extends t.Z{static layerType="019300";get id(){return this.agMetaData.id}set id(e){this.agMetaData.id=e}constructor(e){super(e=Cesium.defaultValue(e,{})),this.agMetaData={id:Cesium.createGuid()},this._initialize(e)}_initialize(e){var t={layerType:c.layerType,url:""};if(Object.assign(this.agMetaData,t,e),!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.")}_addToViewer(){(u=new l(this)).run()}remove(){u.dispose(),this.removeAll()}dispose(){let i=this;return this.remove(),new Promise(function(e,t){e(i)})}}var h=c},8928:function(e,t,i){"use strict";i.d(t,{Z:function(){return h}});t=i(3998);var r=class{constructor(e){this.screenLayers=[],this.timers={},this.index=e}isContainInScreen(t){return this.screenLayers.some(e=>e==decodeURI(t))}showHiddencontrol(e){for(const i of e._primitives){var t=this.isContainInScreen(i._url);e.setVisible(i._url,t),t?this.cancelRemoveDelay(i._id):this.delayRemove(i._id,i._url)}e.tilesStyle&&e.setStyle(e.tilesStyle),CIM.viewer.scene.requestRender()}delayRemove(e,t){this.timers[e]||this.index&&this.index.layer&&(this.timers[e]=setTimeout(()=>{this.index.layer.removeChildLayer(e),this.index.removeRouteLoadMap(t)},3e4))}cancelRemoveDelay(e){this.timers[e]&&(clearTimeout(this.timers[e]),delete this.timers[e])}};var n=class{constructor(){this.request=agcim.net.axiosWraper,this.ip=""}setIP(e){var t=new RegExp(/(\w+):\/\/([^/:]+)(:\d*)?/),e=e.match(t)[0];this.ip=""+e}async getAllOps(){return(await this.request.getDataByGet(this.ip+"/models-rest/bim-rest/obliqueHelp/routeMap")).content}},o=i(4239);let s,a;var l=class{constructor(e){this._updateBind=this.update.bind(this),this.layer=e,this.routeMap={},this.routeLoadMap={},this.AllOps=null}async init(){(s=new n).setIP(this.layer.agMetaData.url),a=new r(this),this.AllOps=await s.getAllOps()}async run(){await this.init(),CIM.viewer.camera.moveEnd.addEventListener(this._updateBind),this.update()}async update(){1e4<CIM.viewer.camera._positionCartographic.height||await this.renderModel()}async renderModel(){var e,t=this.getRouterMapCities_3();a.screenLayers=[];for(e of t)this.routeLoadMap[e.path]?a.screenLayers.push(e.path):(this.routeLoadMap[e.path]=1,a.screenLayers.push(e.path),this.layer.addTilesFun(e.path));setTimeout(()=>{a.showHiddencontrol(this.layer)},100)}async getRouterMapCities(e){e=this.concatCoordinates(e),e=await s.getRouteMapCity(e);return e.content||[]}getRouterMapCities_2(){var e,t=[],i=agcim.camera.camera.getViewExtent(CIM.viewer);for(e of this.AllOps){var r=new Cesium.Rectangle(e.minX,e.minY,e.maxX,e.maxY);Cesium.Rectangle.simpleIntersection(i,r)&&t.push(e)}return t}getRouterMapCities_3(){var e,t=[];for(e of this.AllOps){var i=o.Z.getBoundingSphereByDegree(e.minX,e.minY,e.maxX,e.maxY);-1!=CIM.viewer.camera.frustum._offCenterFrustum._cullingVolume.computeVisibility(i)&&t.push(e)}return t}computedKey(e){return e.x+"/"+e.y+"/"+e.z}removeRouteLoadMap(e){this.routeLoadMap[e]=0}concatCoordinates(t){var i="";for(let e=0;e<t.length;e++)i=i+t[e].lng+","+t[e].lat+",";return i=i.slice(0,i.length-1)}removeEvent(){CIM.viewer.camera.moveEnd.removeEventListener(this._updateBind)}removeServerData(){this.dispose(),this.removeEvent()}dispose(){this.layer=null,this.allCities=null,this.routeMap={},this.routeLoadMap={},this.removeEvent()}};let u;class c extends t.Z{static layerType="019200";get id(){return this.agMetaData.id}set id(e){this.agMetaData.id=e}constructor(e){super(e=Cesium.defaultValue(e,{})),this.agMetaData={id:Cesium.createGuid()},this._initialize(e)}_initialize(e){var t={layerType:c.layerType,url:""};if(Object.assign(this.agMetaData,t,e),!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.")}_addToViewer(){(u=new l(this)).run()}remove(){u.removeServerData(),this.removeAll()}dispose(){let i=this;return this.remove(),new Promise(function(e,t){e(i)})}}var h=c},2398:function(e,t,i){"use strict";i.d(t,{Z:function(){return _}});var t=i(1133),r=i(2053);var n=class{constructor(e){var t=new RegExp(/(\w+):\/\/([^/:]+)(:\d*)?/),e=e.match(t)[0];this.requestIP=""+e}async getPOIData(e){return await r.Z.getData(this.requestIP+"/models-rest/bim-rest/poi/get",e,{Authorization:""})}async getPOICount(e){return(await r.Z.getData(this.requestIP+"/models-rest/bim-rest/poi/count",e)).content}getPOIPreviewByType(e){return this.requestIP+"/models-rest/bim-rest/poi/preview/"+e}getPOIPreviewByCode(e){return this.requestIP+"/models-rest/bim-rest/poi/preview/"+e}},o=i(8778);let c={"090101":{color:"rgb(255, 255, 255)",border:"rgb(164, 113, 73)"},"090102":{color:"rgb(255, 255, 255)",border:"rgb(0, 0, 0)"},"090103":{color:"rgb(128, 71, 21)",border:"rgb(255, 255, 255)"},"090104":{color:"rgb(255, 255, 255)",border:"rgb(0, 0, 0)"},"050902":{color:"rgb(117, 131, 145)",border:"rgb(255, 255, 255)"},"050401":{color:"rgb(56, 72, 109)",border:"rgb(255, 255, 255)"},"050402":{color:"rgb(56, 72, 109)",border:"rgb(255, 255, 255)"},"050403":{color:"rgb(56, 72, 109)",border:"rgb(255, 255, 255)"},"050404":{color:"rgb(255, 255, 255)",border:"rgb(56, 72, 109)"},"051001":{color:"rgb(255, 255, 255)",border:"rgb(0, 0, 0)",icon:"red-point"},"051002":{color:"rgb(255, 255, 255)",border:"rgb(0, 0, 0)",icon:"red-point"},"051004":{color:"rgb(255, 255, 255)",border:"rgb(0, 0, 0)",icon:"red-point"},"030201":{color:"rgb(255, 255, 255)",border:"rgb(128, 0, 128)"},"000000":{color:"rgb(255, 255, 255)",border:"rgb(0, 0, 0)"}},h={},A=null;var s=class{constructor(){this.storeUnExistImgData={},this.defaultStyle={canvasWidth:135,canvasHeight:30,iconWidth:20,fontSize:14,lineWidth:3}}setServerRequest(e){A=e}async getPOIImage(l,u,t){return new Promise(async(s,e)=>{t=t&&JSON.parse(t);u.value&&JSON.parse(u.value).icon;h[u.type]=await A.getPOIPreviewByType(u.type),h[u.type]||(this.storeUnExistImgData[""]=1);let a=new Image;a.setAttribute("crossOrigin","Anonymous"),a.src=h[u.type]||"",u.name||(u.name="未知"),a.styleTemp=t,a.onload=()=>{var e,t,{canvas:i,ctx:r}=this.initCanvas(),n=this.defaultStyle.iconWidth||20;let o=void 0;a.styleTemp&&(o=a.styleTemp),"object"!=typeof h[u.type]&&(h[u.type]=a),o?o&&Boolean(o?.style?.icon?.image)&&(this.drawCustomIcon(u.type,r)||(t=o?.style?.icon?.width?Number(o?.style?.icon?.width):n,e=o?.style?.icon?.height?Number(o?.style?.icon?.height):n,r.drawImage(a,0,0,t,e))):this.drawCustomIcon(u.type,r)||r.drawImage(a,0,0,n,n),o?o&&Boolean(o?.style?.text?.text)&&(t=o?.style?.icon?.width?Number(o?.style?.icon?.width):n,this.drawPOIText(r,u,i.width,i.height,t,o?.style?.text)):this.drawPOIText(r,u,i.width,i.height,n),s({image:i.toDataURL("image/png"),position:agcim.maths.coordinate.getGeographic().toCartesian({lng:l.lon,lat:l.lat,alt:l.alt||0}),width:i.width,height:i.height})},a.onerror=()=>{h[u.type]=null;var{canvas:e,ctx:t}=this.initCanvas();this.drawCustomIcon(u.type,t),this.drawPOIText(t,u,e.width,e.height,20),s({image:e.toDataURL("image/png"),position:agcim.maths.coordinate.getGeographic().toCartesian({lng:l.lon,lat:l.lat,alt:0}),width:e.width,height:e.height}),this.storeUnExistImgData[""]=1}})}initCanvas(){var e=document.createElement("canvas"),t=(e.width=this.defaultStyle.canvasWidth||125,e.height=this.defaultStyle.canvasHeight||35,e.getContext("2d"));return{canvas:e,ctx:t}}drawCustomIcon(t,i){if(c[t]&&c[t].icon){let e=!1;switch(c[t].icon){case"circle":i.fillStyle="white",i.arc(12,12,4.8,0,2*Math.PI),i.fill(),i.moveTo(14.4,12),i.arc(12,12,2.4,0,2*Math.PI),i.stroke(),e=!0;break;case"rect":i.fillStyle="black",i.rect(10,6,7.3,7.3),i.stroke(),i.fillStyle="white",i.fillRect(10,6,7.25,7.25),i.fillStyle="black",i.fillRect(11.6,7.6,3.7,3.7),e=!0;break;case"red-point":i.fillStyle="red",i.arc(12,12,2,2,2*Math.PI),i.fill(),e=!0;break;case"none":e=!0}return e}return!1}drawPOIText(t,i,e,r,n,o){if(!o||Boolean(o?.text)){var s=this.defaultStyle.fontSize||14,o=(t.font=(o?.text?.font||s)+"px Arial",t.fillStyle=o?.color||(c[i.type]?c[i.type].color:"white"),t.strokeStyle=o?.border?.color||(c[i.type]?c[i.type].border:"black"),t.lineWidth=o?.border?.width||this.defaultStyle.lineWidth||3,t.measureText(i.name).width),e=e-n+2,a=Math.ceil(o/e),l=parseInt(i.name.length/(o/e));if(o<e)t.strokeText(i.name,n+2,r/2),t.fillText(i.name,n+2,r/2);else for(let e=0;e<a;e++){var u=i.name.substr(e*l,l);t.strokeText(u,n+2,r/a*e+s),t.fillText(u,n+2,r/a*e+s)}}}},l=i(3829),g=i(8151),m=i(53);let a=new s,p=null,u=new o.Z;var f=class{constructor(e){this.status=0,this.layer=e,this._updateBind=this.update.bind(this),this.routeLoadMap={},this.pickerHelper=null,this.recordGridKey={},this.recordNeedGrid={},this.saveParent=[],this.timeout=null,this.currentLevel=0,this.currentHeight=0,this.previousHeight=0,p=new n(this.layer.agMetaData.url),a.setServerRequest(p),this.datasource=new Cesium.CustomDataSource,this.layer.addDatasource(this.datasource),this.clusterConfig={enabled:!0,pixelRange:2,minimumClusterSize:2},this.flag=0,this.handlerScreenSpace=null,this.roadCallProperty=new Map,this.setClustering(),this.setAvoidLalelOverlap()}handleWheelListener(t){this.handlerScreenSpace=new Cesium.ScreenSpaceEventHandler(CIM.viewer.scene.canvas),this.handlerScreenSpace.setInputAction(e=>{t(e)},Cesium.ScreenSpaceEventType.WHEEL)}fucWheel(e){this.update(e=e<0?1:2)}setClustering(){let a=this;var e=this.datasource;e.clustering.enabled=!1,e.clustering.pixelRange=this.clusterConfig.pixelRange,e.clustering.minimumClusterSize=this.clusterConfig.minimumClusterSize,e.clustering.clusterEvent.addEventListener(function(e,t){let i=null,r=(e.forEach(e=>{(!i||e.info.z<i)&&(i=e.info.z)}),[]);e.forEach(e=>{e.info.z===i&&(e=l.point([e.info.lon,e.info.lat]),r.push(e))});var n=l.featureCollection(r),o=l.center(n),s=null;e.forEach(e=>{var t=l.point([e.info.lon,e.info.lat]);l.distance(t,o,{units:"miles"});s=e}),t.label.show=!1,t.billboard.image=s.billboard.image._value,t.billboard.width=s.billboard.width._value,t.billboard.height=s.billboard.height._value,t.billboard.show=i===a.currentLevel,t.billboard.heightReference=Cesium.HeightReference.CLAMP_TO_GROUND,t.billboard.horizontalOrigin=Cesium.HorizontalOrigin.LEFT,t.billboard.verticalOrigin=Cesium.VerticalOrigin.BOTTOM,t.point.position=s.position._value})}setAvoidLalelOverlap(){let o=this.datasource;const s=this;this._removeEventListener&&this._removeEventListener(),this._removeEventListener=CIM.viewer.camera.changed.addEventListener(()=>{var e,t=o.entities.values,i=[],r=[];for(let e=0;e<t.length;e++){var n=t[e];(n?._customInfo?._isRoadText?r:i).push(n)}0!==i.length&&(e=i[0].label&&0<i[0].label.text._value.length?"label":"billboard",s.avoidLalelOverlap(i,10,10,e)),s.updateRenderRoadLabel(r)})}avoidLalelOverlap(t,i,r,o="billboard"){if(t&&0!==t.length){var s=[];for(let n=0;n<t.length;n++){var a=t[n];if(!a.position)throw new Cesium.RuntimeError("entity position is undefined");var l=Cesium.SceneTransforms.wgs84ToDrawingBufferCoordinates(CIM.viewer.scene,a.position._value);if(l){var u,c=a.billboard;let e,t;if("billboard"===o&&(e=c.width._value??c.width,t=c.height._value??c.height,u=c.scale??1,e*=u,t*=u),"label"===o&&(u=(0,m.Z)(a.label.text._value,{font:a.label.font._value}),e=u.width,t=u.height,a.label.width=e,a.label.height=t),!e)throw new Cesium.RuntimeError("width is undefined");if(!t)throw new Cesium.RuntimeError("height is undefined");let i=l.x;var h=c.horizontalOrigin?c.horizontalOrigin._value:Cesium.HorizontalOrigin.CENTER;h===Cesium.HorizontalOrigin.RIGHT?i-=e:h===Cesium.HorizontalOrigin.CENTER&&(i-=e/2);let r=l.y;h=c.verticalOrigin._value||Cesium.VerticalOrigin.CENTER;h===Cesium.VerticalOrigin.BOTTOM||h===Cesium.VerticalOrigin.BASELINE?r-=t/2:h===Cesium.VerticalOrigin.TOP&&(r+=t/2),l&&s.push({index:n,entity:a,coord:{x:i,y:r},hide:!1})}}var n=new g.Z(s.length,64,Uint32Array);for(let e=0;e<s.length;e++)n.add(s[e].coord.x,s[e].coord.y);n.finish();for(let e=0;e<t.length;e++){var A=t[e];"billboard"===o?A.billboard.show=!0:"label"===o&&(A.label.show=!0)}for(let e=0;e<s.length;e++){var p=s[e];if(!p.hide){let e;"billboard"===o&&(e=this.getScreenSpaceBoundingBox(p.entity.billboard,p.coord,i,r)),"label"===o&&(e=this.getScreenSpaceBoundingBox(p.entity.label,p.coord,i,r));var f=n.range(e.minx,e.miny,e.maxx,e.maxy);for(let e=0;e<f.length;e++){var d=s[f[e]];p.coord.x===d.coord.x&&p.coord.y===d.coord.y||("billboard"===o?d.entity.billboard.show=!1:"label"===o&&(d.entity.label.show=!1),d.hide=!0)}}}}}getScreenSpaceBoundingBox(e,t,i=0,r=0){var n=e.width,o=e.height,e=e.scale??1,s=t.x,t=t.y;return{minx:s-i,maxx:s+(n*=e)+i,miny:t-(o*=e)-r,maxy:t+o+r}}resetClustering(){this.datasource.clustering.enabled=!1}changeDatasource(e,t,i){2<=Math.abs(t-i)||(t=t||this.currentLevel,e?0!==this.datasource.entities._entities._array.length&&(0===this.datasource.entities._entities._array.filter(e=>e.info.z===t).length?this.changeDatasource(e,t-1,i):this.datasource.entities._entities._array.forEach(e=>{e.info.z!=t?e.show=!1:e.show=!0})):0!==this.datasource.entities._entities._array.length&&(t<7&&(t-=1),0===this.datasource.entities._entities._array.filter(e=>e.info.z===t).length?this.changeDatasource(e,t+1,i):this.datasource.entities._entities._array.forEach(e=>{e.info.z!=t?e.show=!1:e.show=!0})))}showCurrentLevel(e,i){for(var r in this.routeLoadMap){var n=Number(r.split("/")[2]);if(1===e){let t=!1;n===i&&this.routeLoadMap[r].datasources&&(this.routeLoadMap[r].datasources.forEach(e=>{e.billboard.show=!0,t=!0}),t||this.showCurrentLevel(e,i+1))}else{let t=!1;n===i&&this.routeLoadMap[r].datasources&&(this.routeLoadMap[r].datasources.forEach(e=>{e.billboard.show=!0,t=!0}),t||this.showCurrentLevel(e,i-1))}}}init(){if(CIM.viewer.scene.requestRenderMode=!1,CIM.viewer.scene.postProcessStages.fxaa.enabled=!1,CIM.viewer.cesiumWidget._supportsImageRenderingPixelated){for(var e=window.devicePixelRatio;2<=e;)e/=2;CIM.viewer.resolutionScale=e}}run(){let t=this;if(this.status)return this.layer&&!CIM.layerTree.getLayerById(this.layer.id)?(this.dispose(),void this.run()):void this.removeEvent();this.init(),this.status=1;this.previousHeight=CIM.viewer.camera.positionCartographic.height,this.listenerFunc=e=>{clearTimeout(this.timeout),this.timeout=setTimeout(()=>{e=e<0?1:2,t._updateBind(e)},100),t.removeDataSource()},CIM.viewer.camera.changed.addEventListener(this.listenerFunc),this.handleWheelListener(this.fucWheel.bind(this))}async update(e){var t,i,r;CIM.layerTree.getLayerById(this.layer.id)?(this.recordNeedGrid={},t=u.get(CIM.viewer.scene.camera),e=e||this.checkUpOrDown(),this.flag=e,i=null,r=null,this.datasource.entities._entities._array.forEach(e=>{(!i||e.info.z<i)&&(i=e.info.z),(!r||e.info.z>r)&&(r=e.info.z)}),t.length&&await this.getDataByGridPosition(t),1===this.flag?this.changeDatasource(!1,this.currentLevel,this.currentLevel):2===this.flag&&this.changeDatasource(!0,this.currentLevel,this.currentLevel)):this.dispose()}async getDataByGridPosition(t){var e=this;this.currentLevel=t[0].level,this.currentLevel!=this.preLevel&&(this.preLevel=this.currentLevel);for(let e=0;e<t.length;e++)this.currentLevel=this.currentLevel<t[e].level?t[e].level:this.currentLevel;this.currentLevel<=8?this.resetClustering():8<this.currentLevel&&!this.datasource.clustering.enabled&&this.setClustering(),this.saveParent=[];var i,r=[],n=[];for(i of t){var o={x:i.x,y:i.y,z:i.level};r.push({pos:this.getRelation(o,2),position:h})}this.currentHeight=CIM.viewer.camera.positionCartographic.height;var s,a=this.checkUpOrDown();this.flag=a;for(s of t){var l,u,c,h=s.x+"/"+s.y+"/"+s.level,A={x:s.x,y:s.y,z:s.level};this.routeLoadMap[h]?this.getDataSource(h).length?(this.routeLoadMap[h].loadTime=(new Date).getTime(),this.recordNeedGrid[h]=1,n.push(this.getRelation(A))):1==a&&this.getGridDataByInherit(A,!0,0):(this.routeLoadMap[h]={loadTime:(new Date).getTime(),datasources:[]},A.s=1,l=(u=await p.getPOIData(A)).content,u=u.style||{},l&&0!=l.length?(this.recordNeedGrid[h]=1,n.push(this.getRelation(A)),await e.renderLabel(l,h,u),c=null,e.datasource.entities._entities._array.forEach(e=>{(!c||e.info.z<c)&&(c=e.info.z)}),1===e.flag?e.changeDatasource(!1,e.currentLevel,e.currentLevel):2===e.flag&&e.changeDatasource(!0,e.currentLevel,e.currentLevel)):this.routeLoadMap[h]=2)}}hiddenMaxLevel(i){var r=[];for(let t=0;t<i.length;t++){var n=i[t],o=this.getDataSource(n.str);let e=!0;n.skipCheck||(e=this.checkFourChild(n),n.skipCheck=!1,e&&(n.skipCheck=!0)),0<o.length&&e&&(o[0].show=!1);o=this.getRelation(n);1<o.z&&(o.skipCheck=n.skipCheck,r.push(o))}r.length&&this.hiddenMaxLevel(r)}checkFourChild(e){var t=this.getRelation(e,2);let i=0;for(let e=0;e<t.length;e++){var r=this.getDataSource(t[e].str);0!==r.length&&0!==r[0].entities.values.length&&i++}return 2<i}hiddenMinLevel(e){for(var t in this.routeLoadMap)e<Number(t.split("/")[2])&&this.routeLoadMap[t].datasources&&0<(t=this.getDataSource(t)).length&&(t[0].show=!1)}checkUpOrDown(){let e;return this.currentHeight>this.previousHeight?e=1:this.currentHeight<this.previousHeight&&(e=2),this.previousHeight=this.currentHeight,e}getDataSource(e){return CIM.viewer.dataSources.getByName(e)}getRelation(t,e=1){var i,r;if(1===e)return e=Math.ceil(t.x/2),i=Math.ceil(t.y/2),{x:e=e===t.x/2?t.x/2:e-1,y:i=i===t.y/2?t.y/2:i-1,z:r=t.z-1,str:e+`/${i}/`+r};var n=[];for(let e=0;e<4;e++){var o=2*t.x+e%2,s=2*t.y+(1<e?1:0),a=t.z+1;n.push({x:o,y:s,z:a,str:o+`/${s}/`+a})}return n}getGridData(n,e){return new Promise(async(t,e)=>{if(this.routeLoadMap[n]){if("number"==typeof this.routeLoadMap[n])return t([]);var i=this.routeLoadMap[n].datasources;i.entities&&i.entities.values&&i.entities.values.length&&(this.routeLoadMap[n].loadTime=(new Date).getTime()),t(i?.entities?.values)}else{var i=n.split("/"),i={x:i[0],y:i[1],z:i[2],s:1},i=await p.getPOIData(i),r=i.content,i=i.style||{};if(!r||0==r.length)return this.routeLoadMap[n]=2,t([]);this.routeLoadMap[n]={loadTime:(new Date).getTime(),datasources:[]},this.renderLabel(r,n,i).then(()=>{if("number"==typeof this.routeLoadMap[n])return t([]);var e=this.routeLoadMap[n].datasources;e.entities&&e.entities.values&&e.entities.values.length&&(this.routeLoadMap[n].loadTime=(new Date).getTime()),t(e?.entities?.values)})}})}getGridDataByInherit(n,o){return new Promise((t,e)=>{let i=this.getRelation(n);var r=i.str;this.saveParent.includes(r)||(this.saveParent.push(r),this.getGridData(r,o).then(e=>{!e?.length&&1<i.z?this.getGridDataByInherit({x:i.x,y:i.y,z:i.z},o):t()}))})}renderLabel(r,n,o){return new Promise((i,e)=>{var t=this.datasource;this.routeLoadMap[n].datasources=t;for(let t of r)a.getPOIImage({lon:t.lon,lat:t.lat},t,o[t.type]).then(e=>{t.agmGeometry?this.renderRoadLabel(t,n):(t.heightReference=Cesium.HeightReference.CLAMP_TO_GROUND,(e=new agcim.geometry.Billboard(t.name,e.position,e.image,{...t,width:e.width,height:e.height})).agBillboard.billboard.horizontalOrigin=Cesium.HorizontalOrigin.LEFT,e.agBillboard.info=t,e.scale=1,this.routeLoadMap[n].datasources.entities.add(e.agBillboard)),i()});this.recordGridKey[n]=1})}renderPoint(i){for(let e=0,t=i.length;e<t;e++){var r=i[e],r=new Cesium.Entity({name:"点",position:Cesium.Cartesian3.fromDegrees(r.lon,r.lat,0),point:{pixelSize:5,color:Cesium.Color.RED,outlineColor:Cesium.Color.WHITE,outlineWidth:2}});CIM.viewer.entities.add(r)}}renderRoadLabel(i,r){var n=JSON.parse(i.agmGeometry)["entities"];for(let e=0,t=n.length;e<t;e++){var o=n[e],{position:s,angle:a,isColumn:l}=this.computeAngle(o.geometry.startPoint,o.geometry.endPoint),s=this.createRoadLabelEntity(i.name,s,a,l);s.info=i,s._customInfo={...s._customInfo,startPoint:o.geometry.startPoint,endPoint:o.geometry.endPoint},this.routeLoadMap[r].datasources.entities.add(s)}}computeAngle(e,t){var i=l.point(e),t=l.point(t),i=l.rhumbBearing(i,t);let r=(i=l.bearingToAzimuth(i))-90,n=(180<i&&(r+=180),!1);0<=i&&i<=45?(n=!0,r+=90):135<i&&i<=180?(n=!0,r-=90):180<i&&i<=225?(n=!0,r+=90):315<i&&i<=360&&(n=!0,r-=90);t=Cesium.Math.toDegrees(0),i=CIM.viewer.camera.heading,i=Cesium.Math.toDegrees(i);return(315<Math.abs(i)&&Math.abs(i)<=360||0<Math.abs(i)&&Math.abs(i)<=45)&&!(315<Math.abs(t)&&Math.abs(t)<=360||0<Math.abs(t)&&Math.abs(t)<=45)||(225<Math.abs(i)&&Math.abs(i)<=315&&!(225<Math.abs(t)&&Math.abs(t)<=315)?(r+=270,n=!n):135<Math.abs(i)&&Math.abs(i)<=225&&!(135<Math.abs(t)&&Math.abs(t)<=225)?r+=180:45<Math.abs(i)&&Math.abs(i)<135&&!(45<Math.abs(t)&&Math.abs(t)<=135)&&(r+=90,n=!n)),{position:e,angle:r,isColumn:n}}createRoadLabelEntity(e,t,i=0,r=!1){var r=(0,m.Z)(e,{padding:2,fill:!0,fillColor:Cesium.Color.RED,font:"30px sans-serif",column:r}),t=Cesium.Cartesian3.fromDegrees(t[0],t[1],0),i=Cesium.Math.toRadians(i),n=Cesium.Math.toRadians(0),o=Cesium.Math.toRadians(0),i=new Cesium.HeadingPitchRoll(i,n,o),n=Cesium.Transforms.headingPitchRollQuaternion(t,i);const s=Cesium.createGuid();this.roadCallProperty.set(s,{img:r,orientation:n});o=new Cesium.Entity({position:t,orientation:new Cesium.CallbackProperty(()=>{var e=this.roadCallProperty.get(s)["orientation"];return e},!1),plane:{plane:new Cesium.Plane(Cesium.Cartesian3.UNIT_Z,0),dimensions:new Cesium.CallbackProperty(()=>{var e=this.roadCallProperty.get(s)["img"];return new Cesium.Cartesian2(e.width,e.height)},!1),material:new Cesium.ImageMaterialProperty({image:new Cesium.CallbackProperty(()=>{var e=this.roadCallProperty.get(s)["img"];return e},!1),transparent:!0}),outline:!1,clampToGround:!0,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND}});return o._customInfo={_isRoadText:!0,name:e,roadCallPropertyKey:s},o}updateRenderRoadLabel(t){for(let e=0;e<t.length;e++){var{startPoint:i,endPoint:r,name:n,roadCallPropertyKey:o}=t[e]._customInfo,{position:i,angle:r,isColumn:s}=this.computeAngle(i,r),n=(0,m.Z)(n,{padding:2,fill:!0,fillColor:Cesium.Color.RED,font:"30px sans-serif",column:s}),s=Cesium.Cartesian3.fromDegrees(i[0],i[1],0),i=Cesium.Math.toRadians(r),r=Cesium.Math.toRadians(0),a=Cesium.Math.toRadians(0),i=new Cesium.HeadingPitchRoll(i,r,a),r=Cesium.Transforms.headingPitchRollQuaternion(s,i);this.roadCallProperty.set(o,{orientation:r,img:n})}}removeDataSource(){var t,e=(new Date).getTime();for(t in this.routeLoadMap)if(this.routeLoadMap[t].loadTime&&3e4<=e-this.routeLoadMap[t].loadTime&&this.routeLoadMap[t].datasources){var i=this.getDataSource(t);for(let e=0;e<i.length;e++)CIM.viewer.dataSources.remove(i[e]),this.layer._dataSource.splice(e,1),delete this.routeLoadMap[t]}}filterGrid(){for(var e in this.recordGridKey)this.recordNeedGrid[e]&&(this.routeLoadMap[e].loadTime=(new Date).getTime(),e,this.getDataSource(e)[0].show=!0)}removeEvent(){this.status=0,CIM.viewer.camera.changed.removeEventListener(this.listenerFunc),this.handlerScreenSpace.removeInputAction(Cesium.ScreenSpaceEventType.WHEEL)}dispose(){this.layer=null,this.removeEvent(),this.removeDataSource(),this.pickerHelper&&(this.pickerHelper.off(),this.pickerHelper=null),CIM.viewer.scene.requestRenderMode=!0,CIM.viewer.scene.postProcessStages.fxaa.enabled=!0,CIM.viewer.resolutionScale=1,this._removeEventListener&&(this._removeEventListener(),this._removeEventListener=void 0)}};let d;class y extends t.Z{static layerType="019400";get id(){return this.agMetaData.id}set id(e){this.agMetaData.id=e}constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this.agMetaData={id:Cesium.createGuid()},this._initialize(e)}_initialize(e){var t={layerType:y.layerType,url:""};if(Object.assign(this.agMetaData,t,e),!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.")}_addToViewer(){(d=new f(this)).run()}remove(){d.dispose(),this.removeAll()}dispose(){let i=this;return this.remove(),new Promise(function(e,t){e(i)})}}var _=y},7720:function(e,t,i){"use strict";class r extends i(1133).Z{constructor(e){super(e)}_changeDefaultBillborad2Point(e){for(const t of e.entities.values)t.billboard&&(t.billboard=void 0,t.point={pixelSize:3,color:Cesium.Color.RED,outlineColor:Cesium.Color.WHITE,outlineWidth:1,disableDepthTestDistance:Number.POSITIVE_INFINITY})}_getUrlQueryParams(e){let r={url:e,queryParameters:{}};return e.includes("?")&&(e=e.split("?"),r.url=e[0],(e=e[1].split("&")).length)&&e.forEach(e=>{var t,i=e.indexOf("=");0<=i&&(t=e.slice(0,i),e=e.slice(i+1),r.queryParameters[t]=e)}),r.url.endsWith("/")&&(r.url=r.url.slice(0,-1)),r}zoomToLayer(){this.rectangle?this.viewer.camera.flyTo({destination:this.rectangle}):this._dataSource&&0<this._dataSource.length&&this.viewer.flyTo(this._dataSource[0])}}t.Z=r},1979:function(e,t,i){"use strict";var r=i(7720),n=i(9359),o=i(812),s=i(7517),a=i(6344),l=i(4723);class u extends r.Z{static layerType="040003, 030300, 010301";constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this.initialize(e)}initialize(e){var t={layerType:u.layerType,url:"",spatialReference:{wkid:"4326"},queryParameters:{service:"WFS",request:"GetFeature",version:"1.0.0",outputFormat:"application/json",maxFeatures:5e3,count:5e3}};Object.assign(this.agMetaData,t,e),this.agMetaData.url||this.agMetaData.dataSource?this.agMetaData.url&&!this.agMetaData.layerTable?console.error("AgWFSLayer需要layerTable",this.agMetaData):(this.agMetaData.queryParameters.typeName=this.agMetaData.layerTable,t=this._getUrlQueryParams(this.agMetaData.url),this.agMetaData.url=t.url,t.queryParameters.maxFeatures&&(this.agMetaData.queryParameters.maxFeatures=t.queryParameters.maxFeatures),t.queryParameters.propertyName&&(this.agMetaData.queryParameters.propertyName=t.queryParameters.propertyName),t.queryParameters.idField&&this.agMetaData.queryParameters.propertyName&&(this.agMetaData.queryParameters.propertyName+=","+t.queryParameters.idField,this.agMetaData.queryParameters.idField=t.queryParameters.idField),t.queryParameters.token&&(this.agMetaData.queryParameters.token=t.queryParameters.token),this._isLoadData=!1,this._isAddViewer=!1,this._loadData()):console.error("AgWFSLayer需要url或dataSource",this.agMetaData)}_loadData(){var e;if(!this._isLoadData)return this.agMetaData.dataSource?(this._loadDataSource(this.agMetaData.dataSource,this.id),this._isLoadData=!0,this.loadDataPromise=Promise.resolve(),this.agMetaData.dataSource):(e=new n.Z(this.agMetaData.url,this.agMetaData.crs,this.agMetaData.queryParameters.version),void(this.loadDataPromise=e.queryProperty(this.agMetaData.layerTable,void 0,this.agMetaData.queryParameters.propertyName,this.agMetaData.queryParameters).then(async t=>{l.Z.findCrsByName("4326").transfromData(this.agMetaData,t);var e=await Cesium.GeoJsonDataSource.load(t,{clampToGround:!0}).catch(e=>(console.error("AgWFSLayer的GeoJSON加载失败",this.agMetaData,t,e),null));if(e)return this._changeDefaultBillborad2Point(e),this._loadDataSource(e,this.id),this._isLoadData=!0,e},e=>(console.error("AgWFSLayer图层查询失败",this.agMetaData,e),null))))}_loadDataSource(e,t){e.name=t,e.agMetaData=this.agMetaData,(e.layer=this)._dataSource.push(e),this._setStyle(e)}_setStyle(t){var e;this.agMetaData.styleManagerId?((e=new o.Z(this)).setStyle(t,this.agMetaData.styleManagerId),this._serveStyle=e):this.agMetaData.customStyle?this.setStyle(this.agMetaData.customStyle):(new s.Z).getStyleFromLegendStyle(this.agMetaData).then(e=>{e&&a.Z.setDataStoreStyle(t,e)}).catch(e=>{console.error("AgWFSLayer无法获取图层的默认图例样式，将使用cesium原始样式",this.agMetaData,e)})}removeAll(){super.removeAll(),this._serveStyle&&this._serveStyle.removeStyle()}}t.Z=u},5875:function(e,t,i){"use strict";class r extends i(1133).Z{static layerType="030100,010100";constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this._initialize(e)}_initialize(e){var t={layerType:r.layerType,url:"",spatialReference:{wkid:"4326"},layerIndex:void 0,token:void 0,tileWidth:256,tileHeight:256,matrixWidth:2,matrixHeight:1,tileOriginX:void 0,tileOriginY:void 0,tile0Resolution:void 0,tileMatrixLabels:[],tileMatrixSet:"EPSG:4326",style:"",format:"image/png",minimumLevel:0,maximumLevel:void 0};if(Object.assign(this.agMetaData,t,e),!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.");if(!this.agMetaData.layerTable)throw new Cesium.DeveloperError("The name of layer or sublayers is required.");if(!this.agMetaData.tileMatrixSet)throw new Cesium.DeveloperError("The tileMatrixSet of layer is required.");this._isLoadData=!1,this._isAddViewer=!1,this._loadData()}_loadData(){if(!this._isLoadData){var e=this._getUrlQueryParams(this.agMetaData.url),e=new Cesium.Resource({url:e.url+"?request=GetCapabilities&service=WMTS&version=1.0.0&layers="+this.agMetaData.layerTable,queryParameters:e.queryParameters});let a=this;this.loadDataPromise=e.fetch().then(function(e){var e=(new DOMParser).parseFromString(e,"text/html"),t=e.documentElement.getElementsByTagName("Layer");for(let e=0;e<t.length;e++){var i=t[e].getElementsByTagName("Layer");if(!i.length)if(t[e].getElementsByTagName("ows:Identifier")[0].firstChild.data==a.agMetaData.layerTable&&!a.agMetaData.style){i=t[e].getElementsByTagName("Style")[0].firstChild.data.match(/>.*</),i=(i?.length&&(a.agMetaData.style=i[0].slice(1,-1)),t[e].getElementsByTagName("ows:WGS84BoundingBox")[0]);if(i){let e=i.getElementsByTagName("ows:LowerCorner")[0].firstChild.data,t=i.getElementsByTagName("ows:UpperCorner")[0].firstChild.data;e=e.split(" "),t=t.split(" "),a.boundingBoxRectangle=Cesium.Rectangle.fromDegrees(e[0],e[1],t[0],t[1])}}}var r=e.documentElement.getElementsByTagName("TileMatrixSet");for(let e=0;e<r.length;e++){var n=r[e].getElementsByTagName("ows:Identifier");if(n.length&&n[0].firstChild.data==a.agMetaData.tileMatrixSet){var o=r[e].getElementsByTagName("TileMatrix");let t=0;if(a.agMetaData.tileMatrixLabels?.length){for(let e=0;e<o.length;e++)if(o[e].getElementsByTagName("ows:Identifier")[0].firstChild.data==a.agMetaData.tileMatrixLabels[0]){t=e;break}}else{a.agMetaData.tileMatrixLabels=[];for(let e=0;e<o.length;e++)a.agMetaData.tileMatrixLabels.push(o[e].getElementsByTagName("ows:Identifier")[0].firstChild.data)}var n=new Cesium.CRSSupport(a.agMetaData.spatialReference),s=(a.agMetaData.matrixWidth=parseInt(o[t].getElementsByTagName("MatrixWidth")[0].textContent),a.agMetaData.matrixHeight=parseInt(o[t].getElementsByTagName("MatrixHeight")[0].textContent),a.agMetaData.tileWidth=parseInt(o[t].getElementsByTagName("TileWidth")[0].textContent),a.agMetaData.tileHeight=parseInt(o[t].getElementsByTagName("TileHeight")[0].textContent),Number(o[t].getElementsByTagName("ScaleDenominator")[0].textContent)),s=(a.agMetaData.tile0Resolution=n.scaleDenominator2Resolution(s),Cesium.defined(a.agMetaData.tileOriginY)&&Cesium.defined(a.agMetaData.tileOriginX)||(s=o[t].getElementsByTagName("TopLeftCorner")[0].textContent.split(" "),Math.abs(Number(s[0]))<Math.abs(Number(s[1]))?(a.agMetaData.tileOriginY=Number(s[0]),a.agMetaData.tileOriginX=Number(s[1])):(a.agMetaData.tileOriginY=Number(s[1]),a.agMetaData.tileOriginX=Number(s[0]))),a.agMetaData.tilingScheme=n.updateTilingScheme(a.agMetaData),Object.assign({},a.agMetaData,{layer:a.agMetaData.layerTable,tileMatrixSetID:a.agMetaData.tileMatrixSet})),n=new Cesium.WebMapTileServiceImageryProvider(s);return a._imageryLayerProviders.push(n),a._isLoadData=!0,n}}})}}_getUrlQueryParams(e){let r={url:e,queryParameters:{}};return e.includes("?")&&(e=e.split("?"),r.url=e[0],(e=e[1].split("&")).length)&&e.forEach(e=>{var t,i=e.indexOf("=");0<=i&&(t=e.slice(0,i),e=e.slice(i+1),r.queryParameters[t]=e)}),r.url.endsWith("/")&&(r.url=r.url.slice(0,-1)),r}zoomToLayer(){this.boundingBoxRectangle&&this.viewer.camera.setView({destination:this.boundingBoxRectangle})}}t.Z=r},7180:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";var _featureLayer__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1133),_net_axiosWraper__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2053),_wfsUtils_wfsLayerEntityHelper__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1756),_wfsUtils_wfsLayerStyleFromServer__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(812),_styleUtils_layerStyleUtils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(6344),_wfsUtils_wfsLayerStyleFromLegend__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(7517),_wfsUtils_wfsLayerStyleFromGeoscene__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(7030);class WFSLayer extends _featureLayer__WEBPACK_IMPORTED_MODULE_0__.Z{constructor(e){super(e),this._viewer=e,this._styleOfServerData=null,this.geometryType=""}add(t,e,i){t.name=e,this.addDatasource(t),this.setDefualtStyle(t),i&&(i.styleManagerId?this.setConfigStyle(t,i.styleManagerId):(["030300","010300","110310"].includes(i.layerType)&&(new _wfsUtils_wfsLayerStyleFromLegend__WEBPACK_IMPORTED_MODULE_5__.Z).getStyleFromLegendStyle(i).then(e=>{_styleUtils_layerStyleUtils__WEBPACK_IMPORTED_MODULE_4__.Z.setDataStoreStyle(t,e)}),["021200"].includes(i.layerType)&&(new _wfsUtils_wfsLayerStyleFromGeoscene__WEBPACK_IMPORTED_MODULE_6__.Z).getStyleFromGeosceneStyle(i).then(e=>{_styleUtils_layerStyleUtils__WEBPACK_IMPORTED_MODULE_4__.Z.setDataStoreStyle(t,e)})))}add3d(e,t,i){e.id=t,i.styleManagerId&&this.setConfigStyle(e,i.styleManagerId)}update(e,n){for(var t=this._dataSource[0].entities.values,i=e.features,r=_styleUtils_layerStyleUtils__WEBPACK_IMPORTED_MODULE_4__.Z.getStyleLabel(this._styleOfServerData),o=_styleUtils_layerStyleUtils__WEBPACK_IMPORTED_MODULE_4__.Z.getStyleContent(this._styleOfServerData),s=!1,a=0;a<i.length;a++){var l=i[a].name;window.debugId&&l==window.debugId&&(console.log("存在"+l),s=!0)}window.debugId&&0==s&&console.log("不存在"+l);for(var u=[],a=0;a<t.length;a++){var c=(A=t[a]).properties.id._value,h=i.findIndex(e=>e.name==c);h<0?(u.push(A),A.show=!1):(A.name=c,A.show=!0,i.splice(h,1))}for(a=0;a<u.length&&a<i.length;a++){var A,l=i[a].name,p=i[a].geometry.coordinates,p=((A=u[a]).show=!0,A.name=l,_wfsUtils_wfsLayerEntityHelper__WEBPACK_IMPORTED_MODULE_2__.Z.updateGeometry(this,A,p,o),i[a].properties);A.properties=p,A.label&&r&&(A.label.text=p[r])}if(!(u.length>=i.length)){var f=i.slice(u.length,i.length);let r=this;var d,g={};for(d in e)g[d]=e[d];g.numberMatched=f.length,g.numberReturned=f.length,g.totalFeatures=f.length,g.features=f,Cesium.GeoJsonDataSource.load(g,{clampToGround:!0}).then(e=>{for(var t=0;t<e.entities._entities.length;t++){var i=e.entities._entities._array[t];r._dataSource[0].entities.add(i)}r.setDefualtStyle(r._dataSource[0]),n.styleManagerId&&r.setConfigStyle(r._dataSource[0],n.styleManagerId)})}}setDefualtStyle(e){(new WFSLayerDefaultStyle).setStyle(e)}setConfigStyle(e,t){new _wfsUtils_wfsLayerStyleFromServer__WEBPACK_IMPORTED_MODULE_3__.Z(this).setStyle(e,t)}getLegendData(i){if(0==this._dataSource.length)return null;let r=this;var n=this._dataSource[0].agMetaData;return n&&n.styleManagerId?(_net_axiosWraper__WEBPACK_IMPORTED_MODULE_1__.Z.getData(agcim.net.apiPath.styleConfig_get,{id:n.styleManagerId}).then(function(e){var t;e.success&&e.content&&(e=JSON.parse(e.content.styleMgrInfo),t=new WFSLayerLegendHelper,r.title=n.nameCn,i(t.parseUniqueLegend(e),r))}),!0):null}}class WFSLayerLegendHelper{parseUniqueLegend(data){if(!data.uniqueValueInfos)return null;var legendObj={},list=[];data.legendTitle&&(legendObj.title=data.legendTitle);for(var i=0;i<data.uniqueValueInfos.length;i++)list.push({style:data.uniqueValueInfos[i].style,lineType:data.uniqueValueInfos[i].lineType,value:data.uniqueValueInfos[i].legendName||data.uniqueValueInfos[i].value,material:eval(data.uniqueValueInfos[i].material).toCssColorString()});return legendObj.legendList=list,{legend:legendObj}}}class WFSLayerDefaultStyle{setStyle(e){for(var t=e.entities.values,i=0;i<t.length;i++){var r=t[i];r.polygon&&(r.polygon.outline=!0,r.polygon.extrudedHeight=0)}}}__webpack_exports__.Z=WFSLayer},4239:function(e,t){"use strict";t.Z=new class{getBoundingSphere(e){return Cesium.BoundingSphere.fromPoints(e)}degreeToCartesian3(e,t,i,r){return Cesium.Rectangle.subsample({west:e,south:t,east:i,north:r})}getBoundingSphereByDegree(e,t,i,r){e=this.degreeToCartesian3(e,t,i,r);return this.getBoundingSphere(e)}}},8778:function(e,t){"use strict";class a{constructor(){this.level=0,this.minLat=0,this.maxLat=0,this.minLon=0,this.maxLon=0,this.x=0,this.y=0,this.center={},this.tileBoxCenterCartesian=null}getCenter(){this.center={lng:(this.minLon+this.maxLon)/2,lat:(this.minLat+this.maxLat)/2,alt:0};return{center:this.center,getDistanceTo:this.getDistanceTo.bind(this)}}getDistanceTo(e){e=agcim.maths.coordinate.getCartographic().toCartesian(e);return this.tileBoxCenterCartesian=agcim.maths.coordinate.getGeographic().toCartesian(this.center),Cesium.Cartesian3.distance(e,this.tileBoxCenterCartesian)}}t.Z=class{get(e){this.visibleTiles={max:0};for(var t=0;t<2;t++){var i,r=new a,n=(r.minLat=-90,r.maxLat=90,r.minLon=-180,r.maxLon=0,r.level=0,r.x=0,r.y=0,new a),o=(n.minLat=-90,n.maxLat=90,n.minLon=0,n.maxLon=180,n.level=0,n.x=1,n.y=0,this.isVisible(e,r),this.isVisible(e,n),[]);for(i in this.visibleTiles)"max"!==i&&o.push({x:this.visibleTiles[i].x,y:this.visibleTiles[i].y,level:this.visibleTiles[i].level});return o}}isVisible(t,e){var i=e.getCenter(),r=(e.maxLon-e.minLon)*Math.PI*6371004,i=i.getDistanceTo(t.positionCartographic),n=this.isContains(e),o=`${e.x}/${e.y}/`+e.level;if(0!==n.visible&&1!==n.visible)return delete this.visibleTiles[o],!1;if(r/42<i)this.visibleTiles[o]=e,this.visibleTiles.max=e.level>this.visibleTiles.max?e.level:this.visibleTiles.max,e.obb=n.obb,this.removeChild(e);else if(!(20<e.level)){this.removeParentAndOther(o);var s=[new a,new a,new a,new a];s[2].minLat=(e.maxLat+e.minLat)/2,s[2].minLon=e.minLon,s[2].maxLat=e.maxLat,s[2].maxLon=(e.maxLon+e.minLon)/2,s[2].level=e.level+1,s[2].x=2*e.x,s[2].y=2*e.y,s[0].minLat=e.minLat,s[0].minLon=e.minLon,s[0].maxLat=(e.maxLat+e.minLat)/2,s[0].maxLon=(e.maxLon+e.minLon)/2,s[0].level=e.level+1,s[0].x=2*e.x,s[0].y=2*e.y+1,s[1].minLat=(e.maxLat+e.minLat)/2,s[1].minLon=(e.maxLon+e.minLon)/2,s[1].maxLat=e.maxLat,s[1].maxLon=e.maxLon,s[1].level=e.level+1,s[1].x=2*e.x+1,s[1].y=2*e.y,s[3].minLat=e.minLat,s[3].minLon=(e.maxLon+e.minLon)/2,s[3].maxLat=(e.maxLat+e.minLat)/2,s[3].maxLon=e.maxLon,s[3].level=e.level+1,s[3].x=2*e.x+1,s[3].y=2*e.y+1;for(let e=0;e<s.length;e++)this.isVisible(t,s[e])}}removeParentAndOther(e){for(var t in delete this.visibleTiles[e],this.visibleTiles)2<Math.abs(this.visibleTiles[t].level-this.visibleTiles.max)&&delete this.visibleTiles[t]}removeChild(t){for(let e=0;e<4;e++){var i=e<2?2*t.x:2*t.x+1,r=2*t.x+e%2;delete this.visibleTiles[i+`/${r}/`+(t.level+1)]}}isContains(e){var t=CIM.agcimScene._viewer.scene.frameState.cullingVolume,i=agcim.maths.coordinate.getGeographic().toCartesian({lng:e.minLon,lat:e.minLat,alt:0}),r=agcim.maths.coordinate.getGeographic().toCartesian({lng:e.maxLon,lat:e.maxLat,alt:0}),n=agcim.maths.coordinate.getGeographic().toCartesian({lng:e.minLon,lat:e.maxLat,alt:0}),e=agcim.maths.coordinate.getGeographic().toCartesian({lng:e.maxLon,lat:e.minLat,alt:0}),i=Cesium.BoundingSphere.fromPoints([i,n,r,e]);return{visible:t.computeVisibility(i),obb:i}}}},1618:function(e,t){"use strict";t.Z=new class{getEntitiesByEntityId(e,t){let i=[];return i.push(e.entities.getById(t)),e.dataSources._dataSources.forEach(e=>{i.push(e.entities.getById(t))}),i.filter(e=>null!=e)}getcoordsByEntity(e){var t={};return e._polygon?t.polygon=e._polygon._hierarchy.getValue().positions:e._polyline?t.polyline=e._polyline._positions.getValue()||e._polyline._positions._value:e._position&&(t.position=e._position.getValue()),t}}},1133:function(e,t,i){"use strict";var r=i(2175),a=i(142),n=i(5255);t.Z=class{get id(){return this.agMetaData.id}constructor(e){this.agMetaData={id:Cesium.createGuid()},this._entities=[],this._primitives=[],this._dataSource=[],this._imageryLayers=[],this._imageryLayerProviders=[],this.viewer=e,this._toDisposing=!1,this._toDispisingTime=null,this._innerAfterDisposeHandler=null,this._innerSetVisibleHandler=null,this.isLayerVisible=!0}addEntity(e){e=(new r.Z).checkColor(e),e=this.viewer.entities.add(e);return this._entities.push(e),e}addPrimitive(i,e){return e?new Promise((e,t)=>{this.viewer.scene.primitives.add(i).readyPromise.then(()=>{this._primitives.push(i),e(i)})}):(this.viewer.scene.primitives.add(i),this._primitives.push(i),i)}addDatasource(e){return this.viewer.dataSources.add(e),this._dataSource.push(e),e}addImagery(e,t){var i=this.viewer.imageryLayers.addImageryProvider(e,t);return this.viewer.scene.globe._imageryLayerCollectionExcavation.addImageryProvider(e,t),this._imageryLayers.push(i),i}_addToViewer(){this._isAddViewer||(this.addViewerPromise=this.loadDataPromise.then(()=>{for(let e=this._entities.length-1;-1<e;e--)this.viewer.entities.add(this._entities[e]);for(let e=this._primitives.length-1;-1<e;e--)this.viewer.scene.primitives.add(this._primitives[e]);for(let e=this._dataSource.length-1;-1<e;e--)this.viewer.dataSources.add(this._dataSource[e]);for(let e=this._imageryLayerProviders.length-1;-1<e;e--)this.addImagery(this._imageryLayerProviders[e],this.agMetaData.layerIndex);return this._isAddViewer=!0,this._addViewerUpdateHandle&&this._addViewerUpdateHandle(),this}))}removeEntity(e){return!!this.viewer.entities.remove(e)&&(this._entities.splice(this._entities.indexOf(e),1),!0)}removePrimitive(e){return!!this.viewer.scene.primitives.remove(e)&&(this._primitives.splice(this._primitives.indexOf(e),1),!0)}removeAll(t){t=t||!0;for(let e=this._entities.length-1;-1<e;e--)this.viewer.entities.remove(this._entities[e]);for(let e=this._primitives.length-1;-1<e;e--)this.viewer.scene.primitives.remove(this._primitives[e]);for(let e=this._dataSource.length-1;-1<e;e--)this.viewer.dataSources.remove(this._dataSource[e]);for(let e=this._imageryLayers.length-1;-1<e;e--)this.viewer.imageryLayers.remove(this._imageryLayers[e],t);this._entities.splice(0,this._entities.length),this._primitives.splice(0,this._primitives.length),this._dataSource.splice(0,this._dataSource.length),this._imageryLayers.splice(0,this._imageryLayers.length),this._innerAfterDisposeHandler&&this._innerAfterDisposeHandler()}dispose(r){if(0!=(r=null==r?0:r)){this.setVisible(!1),this._toDisposing=!0;let i=this;return new Promise(function(e,t){i._toDispisingTime=setTimeout(()=>{i.removeAll(!0),e(i)},r)})}{this.removeAll(!0);let i=this;return new Promise(function(e,t){e(i)})}}setVisible(t){if(this.isLayerVisible!==t){this.isLayerVisible=t;let e=!0;if(e=this._innerSetVisibleHandler?this._triggerInnerSetVisibleHandler(t):e){for(let e=this._entities.length-1;-1<e;e--)this._entities[e].show=t;for(let e=this._primitives.length-1;-1<e;e--)this._primitives[e].show=t;for(let e=this._dataSource.length-1;-1<e;e--){this._dataSource[e].show=t;var i=this._dataSource[e]._primitives?._primitives;if(i)for(var r=0;r<i.length;r++)i[r].show=t}for(let e=this._imageryLayers.length-1;-1<e;e--)this._imageryLayers[e].show=t}}}_addInnerSetVisibleHandler(e){var t;null===this._innerSetVisibleHandler?this._innerSetVisibleHandler=[]:Array.isArray(this._innerSetVisibleHandler)||((t=[])[0]=this._innerSetVisibleHandler,this._innerSetVisibleHandler=t),this._innerSetVisibleHandler.push(e)}_triggerInnerSetVisibleHandler(e){let t=!0;if(Array.isArray(this._innerSetVisibleHandler))for(var i=0;i<this._innerSetVisibleHandler.length;i++)t=this._innerSetVisibleHandler[i](e);else t=this._innerSetVisibleHandler(e);return t}setOpacity(i){for(let e=this._imageryLayers.length-1;-1<e;e--)this._imageryLayers[e].alpha=i;for(let e=this._primitives.length-1;-1<e;e--)if(null==this._primitives[e].style){var t=new Cesium.Cesium3DTileStyle({color:"color('white', "+i+")",show:!0});this._primitives[e].style=t}else if(this._primitives[e].style&&(null==this._primitives[e].style._color||this._primitives[e].style._color._expression)){t=new Cesium.Cesium3DTileStyle({color:"color('white', "+i+")",show:!0});this._primitives[e].style=t}else if(this._primitives[e].style&&this._primitives[e].style._color&&this._primitives[e].style._color._conditions){var r=new Cesium.Cesium3DTileStyle,n=this._primitives[e].style.color._conditions.valueOf(),o=[];for(let e=0;e<n.length;e++){var s=n[e];for(let t=0;t<s.length;t++){let e=s[t];-1!=e.indexOf("rgba")?e=(e=e.slice(0,e.lastIndexOf(",")+1))+i+")":-1!=e.indexOf("rgb")&&(e=(e=e.replace(")",","+i+")")).replace(/rgb/,"rgba")),s[t]=e}o.push(s)}r.color={conditions:o},this._primitives[e].style=r}a.Z.setDataSourceEntityOpacity(this._dataSource,i)}setStyle(e){n.Z.setStyle(this,e)}getLegendData(){return null}cancelDispose(){this._toDispisingTime&&(window.clearTimeout(this._toDispisingTime),this._toDispisingTime=null),this._toDisposing=!1,this.setVisible(!0)}updateBoundingSpere(e){this._boundingSphere?this._boundingSphere=Cesium.BoundingSphere.union(this._boundingSphere,e,new Cesium.BoundingSphere):this._boundingSphere=e}zoomToLayer(){this._boundingSphere?this.viewer.camera.flyToBoundingSphere(this._boundingSphere):0<this._entities.length?this.viewer.zoomTo(this._entities):0<this._primitives.length?this.viewer.flyTo(this._primitives[0]):0<this._dataSource.length&&this.viewer.flyTo(this._dataSource[0])}}},7681:function(e,t){"use strict";t.Z=new class{constructor(){}getModelMatrix(e){return e._content?e.primitive._root.transform:e.id?e.primitive.modelMatrix:void 0}getModelTransform(e){return e.root?e.root.transform:e.modelMatrix||(e.position?e.computeModelMatrix(new Cesium.JulianDate):void 0)}getModelMatrixInTime(e,t,i){var r=new Cesium.Matrix3;if(e){var n,o=Cesium.Property.getValueOrUndefined(e.position,t,new Cesium.Cartesian3);if(Cesium.defined(o))return n=Cesium.Cartographic.fromCartesian(o),o=Cesium.Cartesian3.fromRadians(n.longitude,n.latitude,n.height),n=Cesium.Property.getValueOrUndefined(e.orientation,t,new Cesium.Quaternion),Cesium.defined(n)?Cesium.Matrix4.fromRotationTranslation(Cesium.Matrix3.fromQuaternion(n,r),o,i):Cesium.Transforms.eastNorthUpToFixedFrame(o,void 0,i)}}getTilesetFeatureObjectIdField(e){var t="objectid";return t=e instanceof Cesium.Cesium3DTileFeature&&e.tileset.asset.generatetool&&0<=e.tileset.asset.generatetool.indexOf("cesiumlab")?"name":t}getTilesetFeatureObjectIdValue(e){var t=this.getTilesetFeatureObjectIdField(e);return e.getProperty(t)?e.getProperty(t):e.getProperty("revitID")}updateModeMatrix(){}}},5255:function(e,t,i){"use strict";i(1133);var n=i(6344);t.Z=new class{constructor(){}setStyle(e,t){var i=e;if(i._styleOfServerData=t,i._dataSource)for(var r=0;r<i._dataSource.length;r++)t["3d"]?n.Z.set3dTilesStyle(i._dataSource[r],t["3d"]):n.Z.setDataStoreStyle(i._dataSource[r],t);i._entities&&n.Z.setEntitiesStyle(i._entities,t)}}},6344:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";var _renderer_clusterRenderer__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(8610),_styleBillboard__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(5121),_styleLabel__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3367),_stylePoint__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(636),_styleEllipsoid__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(4975),_styleCylinder__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(7051),_stylePolylineVolume__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(26),_styleModel__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(8146),_wfsUtils_wfsLayerStyleClassBreak__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(2312);class layerStyleUtils{constructor(){this._viewer=null,this._needFields=[]}setDataStoreStyle(e,t){var i;t.uniqueValueInfos?this.setUniqueValueStyle(e,t):(i=null,e&&e.entities&&e.entities.values&&(i=e.entities.values,t.billboard&&t.billboard.cluster&&_renderer_clusterRenderer__WEBPACK_IMPORTED_MODULE_0__.Z.setRenderer(e,t.billboard.cluster),t.classBreakInfos?(_wfsUtils_wfsLayerStyleClassBreak__WEBPACK_IMPORTED_MODULE_8__.Z.setStyle(i,t),this.setEntityOtherStyle(i,t)):this.setEntitiesStyle(i,t)))}setEntitiesStyle(entities,styleConfig){for(var i=0;i<entities.length;i++){var entity=entities[i],material,height,positions,height,material,material;entity.polygon&&(material=eval(styleConfig.material),height=null==entity.properties.height?void 0:Number(entity.properties.height),height=null==styleConfig.useHeight||styleConfig.useHeight?height:void 0,entity.polygon.extrudedHeight=styleConfig.extrudedHeight||(styleConfig.extrudedHeightField?entity.properties[styleConfig.extrudedHeightField]:styleConfig.height||entity.height),entity.polygon.material=material,entity.polygon.perPositionHeight=styleConfig.perPositionHeight,entity.polygon.outline=styleConfig.outline,entity.polygon.outlineColor=styleConfig.outlineColor,entity.polygon.outlineWidth=styleConfig.outlineWidth,entity.polygon.height=this.isNumber(styleConfig.height)?Number(styleConfig.height):height,entity.polygon.heightReference=eval(styleConfig.heightReference),1==entity.polygon.heightReference&&(entity.polygon.height=void 0),entity.polygon.perPositionHeight=null!=styleConfig.perPositionHeight&&styleConfig.perPositionHeight,entity.polygon.classificationType=eval(styleConfig.classificationType),styleConfig.showLine)&&(positions=entity.polygon.hierarchy._value.positions,entity.polyline=new Cesium.PolylineGraphics({positions:positions,material:eval(styleConfig.outlineColor),width:styleConfig.outlineWidth||1,classificationType:eval(styleConfig.classificationType),clampToGround:!eval(entity.polygon.perPositionHeight._value)})),entity.polyline&&!styleConfig.showLine&&(entity.polyline.material=eval(styleConfig.material),entity.polyline.width=eval(styleConfig.outlineWidth),entity.polyline.classificationType=eval(styleConfig.classificationType),entity.polyline.arcType=eval(styleConfig.arcType),entity.polyline.clampToGround=eval(styleConfig.clampToGround),styleConfig.lineType?("PolylineDash"==styleConfig.lineType?material=new Cesium.PolylineDashMaterialProperty({color:eval(styleConfig.material),dashPattern:eval(styleConfig.dashPattern),dashLength:eval(styleConfig.dashLength)}):"PolylineArrow"==styleConfig.lineType&&(material=new Cesium.PolylineArrowMaterialProperty(eval(styleConfig.material)),entity.polyline.width=10),entity.polyline.material=material):entity.polyline.material=eval(styleConfig.material),entity.polylineVolume)&&entity.polylineVolume.positions&&(entity.polyline.positions=entity.polylineVolume.positions,entity.polylineVolume=null)}this.setEntityOtherStyle(entities,styleConfig)}setEntityOtherStyle(e,t){let i=null;for(var r=0;r<e.length;r++){var n=e[r];i=_styleBillboard__WEBPACK_IMPORTED_MODULE_1__.Z.setStyle(n,t,i),_styleLabel__WEBPACK_IMPORTED_MODULE_2__.Z.setStyle(n,t),_stylePoint__WEBPACK_IMPORTED_MODULE_3__.Z.setStyle(n,t),_styleEllipsoid__WEBPACK_IMPORTED_MODULE_4__.Z.setStyle(n,t),_styleCylinder__WEBPACK_IMPORTED_MODULE_5__.Z.setStyle(n,t),_stylePolylineVolume__WEBPACK_IMPORTED_MODULE_6__.Z.setStyle(n,t),_styleModel__WEBPACK_IMPORTED_MODULE_7__.Z.setStyle(n,t)}}setUniqueValueStyle(dataSource,styleConfig){var entities=dataSource.entities.values,field=styleConfig.field;let lastSibleBillboard=null,defaultStyle=null;for(let k=0;k<styleConfig.uniqueValueInfos.length;k++)if("default"==styleConfig.uniqueValueInfos[k].value){defaultStyle=styleConfig.uniqueValueInfos[k];break}for(var i=0;i<entities.length;i++){var entity=entities[i];if(entity.billboard=void 0,entity.properties[field]){let uniqueStyle=defaultStyle;for(var k=0,material,material;k<styleConfig.uniqueValueInfos.length;k++)if(entity.properties[field]._value==styleConfig.uniqueValueInfos[k].value){uniqueStyle=styleConfig.uniqueValueInfos[k];break}uniqueStyle&&(entity.polygon&&(entity.polygon.outline=!0,entity.polygon.extrudedHeight=this.isNumber(uniqueStyle.extrudedHeight)?Number(uniqueStyle.extrudedHeight):uniqueStyle.extrudedHeightField?entity.properties[uniqueStyle.extrudedHeightField]:uniqueStyle.extrudedHeight||void 0,entity.polygon.material=eval(uniqueStyle.material),entity.polygon.outlineColor=eval(uniqueStyle.outlineColor),entity.polygon.outlineWidth=uniqueStyle.outlineWidth,entity.polygon.height=uniqueStyle.height,entity.polygon.heightReference=eval(uniqueStyle.heightReference),1==entity.polygon.heightReference&&(entity.polygon.height=void 0),entity.polygon.perPositionHeight=null!=uniqueStyle.perPositionHeight&&uniqueStyle.perPositionHeight,entity.polygon.classificationType=eval(uniqueStyle.classificationType)),entity.polyline&&(entity.polyline.material=eval(uniqueStyle.material),entity.polyline.width=eval(uniqueStyle.outlineWidth),entity.polyline.classificationType=eval(uniqueStyle.classificationType),entity.polyline.arcType=eval(styleConfig.arcType),entity.polyline.clampToGround=eval(styleConfig.clampToGround),uniqueStyle.lineType)&&("PolylineDash"==uniqueStyle.lineType?material=new Cesium.PolylineDashMaterialProperty({color:eval(uniqueStyle.material)}):"PolylineArrow"==uniqueStyle.lineType&&(material=new Cesium.PolylineArrowMaterialProperty(eval(uniqueStyle.material))),entity.polyline.width=eval(uniqueStyle.outlineWidth)||10,entity.polyline.material=material),lastSibleBillboard=_styleBillboard__WEBPACK_IMPORTED_MODULE_1__.Z.setStyle(entity,uniqueStyle,lastSibleBillboard),_styleLabel__WEBPACK_IMPORTED_MODULE_2__.Z.setStyle(entity,uniqueStyle),_stylePoint__WEBPACK_IMPORTED_MODULE_3__.Z.setStyle(entity,uniqueStyle),_styleModel__WEBPACK_IMPORTED_MODULE_7__.Z.setStyle(entity,uniqueStyle),_stylePolylineVolume__WEBPACK_IMPORTED_MODULE_6__.Z.setStyle(entity,uniqueStyle))}}styleConfig.cluster&&_renderer_clusterRenderer__WEBPACK_IMPORTED_MODULE_0__.Z.setRenderer(dataSource,styleConfig.cluster)}getStyleLabel(e){if(e&&e.content){e=JSON.parse(e.content.information);if(e.label)return e.label.text}return null}getStyleContent(e){return e&&e.content?JSON.parse(e.content.information):null}addNeedsFields(e){for(var t=0;t<e.length;t++)this._needFields.indexOf(e[t])<0&&this._needFields.push(e[t])}isNumber(e){return!(!/^\d+(\.\d+)?$/.test(e)&&!/^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$/.test(e))}}__webpack_exports__.Z=new layerStyleUtils},142:function(e,t){"use strict";t.Z=new class{setDataSourceEntityOpacity(i,r){if(i&&i.length)for(let t=i.length-1;-1<t;t--)if(i[t].entities&&i[t].entities.values&&i[t].entities.values.length)for(let e=i[t].entities.values.length-1;-1<e;e--){var n=i[t].entities.values[e];n.polygon&&(n.polygon.material&&(n.polygon.material=this.getColor(n.polygon.material.color,r)),n.polygon.outlineColor)&&(n.polygon.outlineColor=this.getColor(n.polygon.outlineColor,r)),n.polyline&&n.polyline.material&&n.polyline.material.color&&(n.polyline.material=this.getColor(n.polyline.material.color,r)),n.point&&(n.point.color&&(n.point.color=this.getColor(n.point.color,r)),n.point.outlineColor)&&(n.point.outlineColor=this.getColor(n.point.outlineColor,r))}}getColor(e,t){return e._value?Cesium.Color.fromAlpha(e._value,t):e.alpha?Cesium.Color.fromAlpha(e,t):void 0}}},5121:function(__unused_webpack_module,__webpack_exports__){"use strict";class StyleBillboard{setStyle(entity,styleConfig,lastSibleBillboard){var img;if(styleConfig.billboard)return entity.billboard||(entity.billboard=new Cesium.BillboardGraphics),entity.point&&(entity.point=null),entity.cylinder&&(entity.cylinder=null),entity.ellipsoid&&(entity.ellipsoid=null),entity.model&&(entity.model=null),lastSibleBillboard?entity.billboard=lastSibleBillboard.clone():(styleConfig.billboard.scale&&(entity.billboard.scale=styleConfig.billboard.scale),styleConfig.billboard.heightReference&&(entity.billboard.heightReference=eval(styleConfig.billboard.heightReference)),styleConfig.billboard.color&&(entity.billboard.color=eval(styleConfig.billboard.color)),styleConfig.billboard.rotation&&(entity.billboard.rotation=styleConfig.billboard.rotation),styleConfig.billboard.sizeInMeters&&(entity.billboard.sizeInMeters=styleConfig.billboard.sizeInMeters),styleConfig.billboard.width&&(entity.billboard.width=styleConfig.billboard.width),styleConfig.billboard.height&&(entity.billboard.height=styleConfig.billboard.height),styleConfig.billboard.translucencyByDistance&&(entity.billboard.translucencyByDistance=eval(styleConfig.billboard.translucencyByDistance)),styleConfig.billboard.pixelOffsetScaleByDistance&&(entity.billboard.pixelOffsetScaleByDistance=eval(styleConfig.billboard.pixelOffsetScaleByDistance)),styleConfig.billboard.imageSubRegion&&(entity.billboard.imageSubRegion=eval(styleConfig.billboard.imageSubRegion)),styleConfig.billboard.alignedAxis&&(entity.billboard.alignedAxis=eval(styleConfig.billboard.alignedAxis)),styleConfig.billboard.pixelOffset&&(entity.billboard.pixelOffset=eval(styleConfig.billboard.pixelOffset)),styleConfig.billboard.pixelOffset&&(entity.billboard.alignedAxis=eval(styleConfig.billboard.pixelOffset)),styleConfig.billboard.eyeOffset&&(entity.billboard.eyeOffset=eval(styleConfig.billboard.eyeOffset)),styleConfig.billboard.horizontalOrigin&&(entity.billboard.horizontalOrigin=eval(styleConfig.billboard.horizontalOrigin)),styleConfig.billboard.verticalOrigin&&(entity.billboard.verticalOrigin=eval(styleConfig.billboard.verticalOrigin)),styleConfig.billboard.scaleByDistance&&(entity.billboard.scaleByDistance=eval(styleConfig.billboard.scaleByDistance)),styleConfig.billboard.distanceDisplayCondition&&(entity.billboard.distanceDisplayCondition=eval(styleConfig.billboard.distanceDisplayCondition)),styleConfig.billboard.disableDepthTestDistance&&(entity.billboard.disableDepthTestDistance=eval(styleConfig.billboard.disableDepthTestDistance)),styleConfig.billboard.show&&(entity.billboard.show=styleConfig.billboard.show),styleConfig.heightDisplayCondition&&(entity.billboard.scaleByDistance=new Cesium.NearFarScalar(15e3,0,15e4,1))),styleConfig.billboard.image&&(styleConfig.billboard.field?(img=styleConfig.billboard.image.replace("{field}",entity.properties[styleConfig.billboard.field]),new Promise(function(e){var t=new Image;t.src=img,t.onerror=function(e){entity.billboard.image=styleConfig.billboard.otherImage}}),entity.billboard.image=img):entity.billboard.image=styleConfig.billboard.image),entity.billboard}}__webpack_exports__.Z=new StyleBillboard},7051:function(__unused_webpack_module,__webpack_exports__){"use strict";class StyleCylinder{constructor(){}setStyle(entity,styleConfig){if(styleConfig.cylinder){var cylinderInfo=this.parseCylinderInfo(entity,styleConfig);if(eval(styleConfig.cylinder.markHeight)){let ellipsoid=this._viewer.scene.globe.ellipsoid,cartesian3=entity.position._value,cartograhphic=ellipsoid.cartesianToCartographic(cartesian3),lat=Cesium.Math.toDegrees(cartograhphic.latitude),lng=Cesium.Math.toDegrees(cartograhphic.longitude),position=new Cesium.Cartesian3.fromDegrees(lng,lat,entity.properties.height._value);entity.position._value=position}var centerpoint=null;entity.billboard&&(centerpoint=entity.position._value,entity.billboard=null),entity.point&&(centerpoint=entity.position._value,entity.point=null),entity.label&&(centerpoint=entity.position._value,entity.label=null),entity.ellipsoid&&(centerpoint=entity.position._value,entity.ellipsoid=null);let position1=Cesium.Cartographic.fromCartesian(centerpoint),str=(styleConfig.cylinder.height&&(position1.height=entity.properties[styleConfig.cylinder.height]._value),entity.position=Cesium.Cartesian3.fromRadians(position1.longitude,position1.latitude,position1.height),entity.cylinder=cylinderInfo,entity.id);var index=str.lastIndexOf(".");str=str.substring(index+1,str.length),-1==str.indexOf("_")?entity.cylinder.show=!0:entity.cylinder.show=!1}}parseCylinderInfo(entity,styleConfig){var cylinderInfo={};if(cylinderInfo.scale=styleConfig.cylinder.scale||1,"number"==typeof styleConfig.cylinder.length?cylinderInfo.length=styleConfig.cylinder.length:cylinderInfo.length=entity.properties[styleConfig.cylinder.length]*cylinderInfo.scale,cylinderInfo.topRadius=eval(styleConfig.cylinder.topRadius),cylinderInfo.bottomRadius=eval(styleConfig.cylinder.bottomRadius),cylinderInfo.heightReference=eval(styleConfig.cylinder.heightReference),cylinderInfo.fill=eval(styleConfig.cylinder.fill),cylinderInfo.material=eval(styleConfig.cylinder.material),cylinderInfo.outline=eval(styleConfig.cylinder.outline),cylinderInfo.outlineColor=eval(styleConfig.cylinder.outlineColor),cylinderInfo.outlineWidth=eval(styleConfig.cylinder.outlineWidth),cylinderInfo.numberOfVerticalLines=eval(styleConfig.cylinder.numberOfVerticalLines),cylinderInfo.slices=eval(styleConfig.cylinder.slices),cylinderInfo.shadows=eval(styleConfig.cylinder.shadows),styleConfig.cylinder.distanceDisplayCondition){var distanceDisplayCondition=styleConfig.cylinder.distanceDisplayCondition,fieldValue=entity.properties[distanceDisplayCondition.field]._value;for(let i=0;i<distanceDisplayCondition.condition.length;i++){var contition=distanceDisplayCondition.condition[i].value;if("<"==contition.split(" ")[0]){if(fieldValue<contition.split(" ")[1]){cylinderInfo.distanceDisplayCondition=eval(distanceDisplayCondition.condition[i].distance);break}}else if(">="==contition.split(" ")[0]&&fieldValue>=contition.split(" ")[1]){cylinderInfo.distanceDisplayCondition=eval(distanceDisplayCondition.condition[i].distance);break}}}return cylinderInfo}}__webpack_exports__.Z=new StyleCylinder},4975:function(__unused_webpack_module,__webpack_exports__){"use strict";class StyleEllipsoid{setStyle(entity,styleConfig){if(styleConfig.ellipsoid){var ellipsoidInfo=this.parseEllipsoidInfo(entity,styleConfig);if(eval(styleConfig.ellipsoid.markHeight)){let ellipsoid=this._viewer.scene.globe.ellipsoid,cartesian3=entity.position._value,cartograhphic=ellipsoid.cartesianToCartographic(cartesian3),lat=Cesium.Math.toDegrees(cartograhphic.latitude),lng=Cesium.Math.toDegrees(cartograhphic.longitude),position=new Cesium.Cartesian3.fromDegrees(lng,lat,entity.properties.height._value);entity.position._value=position}var centerpoint=null;entity.billboard&&(centerpoint=entity.position._value,entity.billboard=null),entity.point&&(centerpoint=entity.position._value,entity.point=null),entity.cylinder&&(centerpoint=entity.position._value,entity.cylinder=null);let position1=Cesium.Cartographic.fromCartesian(centerpoint),str=(styleConfig.ellipsoid.height&&(position1.height=entity.properties[styleConfig.ellipsoid.height]._value),entity.position=Cesium.Cartesian3.fromRadians(position1.longitude,position1.latitude,ellipsoidInfo.radii.z),entity.ellipsoid=ellipsoidInfo,entity.id);var index=str.lastIndexOf(".");str=str.substring(index+1,str.length),-1==str.indexOf("_")?entity.ellipsoid.show=!0:entity.ellipsoid.show=!1}}parseEllipsoidInfo(entity,styleConfig){var ellipsoidInfo={};if(ellipsoidInfo.radii=eval(styleConfig.ellipsoid.radii),ellipsoidInfo.innerRadii=eval(styleConfig.ellipsoid.innerRadii),ellipsoidInfo.minimumClock=eval(styleConfig.ellipsoid.minimumClock),ellipsoidInfo.maximumClock=eval(styleConfig.ellipsoid.maximumClock),ellipsoidInfo.minimumCone=eval(styleConfig.ellipsoid.minimumCone),ellipsoidInfo.maximumCone=eval(styleConfig.ellipsoid.maximumCone),ellipsoidInfo.heightReference=eval(styleConfig.ellipsoid.heightReference),ellipsoidInfo.fill=eval(styleConfig.ellipsoid.fill),ellipsoidInfo.material=eval(styleConfig.ellipsoid.material),ellipsoidInfo.outline=eval(styleConfig.ellipsoid.outline),ellipsoidInfo.outlineColor=eval(styleConfig.ellipsoid.outlineColor),ellipsoidInfo.outlineWidth=eval(styleConfig.ellipsoid.outlineWidth),ellipsoidInfo.stackPartitions=eval(styleConfig.ellipsoid.stackPartitions),ellipsoidInfo.slicePartitions=eval(styleConfig.ellipsoid.slicePartitions),ellipsoidInfo.subdivisions=eval(styleConfig.ellipsoid.subdivisions),ellipsoidInfo.subdivisions=eval(styleConfig.ellipsoid.subdivisions),ellipsoidInfo.distanceDisplayCondition=eval(styleConfig.ellipsoid.distanceDisplayCondition),styleConfig.ellipsoid.distanceDisplayCondition){var distanceDisplayCondition=styleConfig.ellipsoid.distanceDisplayCondition,fieldValue=entity.properties[distanceDisplayCondition.field]._value;for(let i=0;i<distanceDisplayCondition.condition.length;i++){var contition=distanceDisplayCondition.condition[i].value;if("<"==contition.split(" ")[0]){if(fieldValue<contition.split(" ")[1]){ellipsoidInfo.distanceDisplayCondition=eval(distanceDisplayCondition.condition[i].distance);break}}else if(">="==contition.split(" ")[0]&&fieldValue>=contition.split(" ")[1]){ellipsoidInfo.distanceDisplayCondition=eval(distanceDisplayCondition.condition[i].distance);break}}}return ellipsoidInfo}}__webpack_exports__.Z=new StyleEllipsoid},3367:function(__unused_webpack_module,__webpack_exports__){"use strict";class StyleLabel{setStyle(entity,styleConfig){if(styleConfig.label){var labelInfo=this.parseLableInfo(entity,styleConfig);if(eval(styleConfig.label.markHeight)){let ellipsoid=this._viewer.scene.globe.ellipsoid,cartesian3=entity.position._value,cartograhphic=ellipsoid.cartesianToCartographic(cartesian3),lat=Cesium.Math.toDegrees(cartograhphic.latitude),lng=Cesium.Math.toDegrees(cartograhphic.longitude),position=new Cesium.Cartesian3.fromDegrees(lng,lat,entity.properties.height._value);entity.position._value=position}var centerpoint=entity.position._value||entity.position.getValue(),pointsArray,centerpoint,pointsArray,pointsArray;entity.polygon&&(pointsArray=entity.polygon.hierarchy.getValue(Cesium.JulianDate.now()).positions,centerpoint=Cesium.BoundingSphere.fromPoints(pointsArray).center),entity.polyline&&(pointsArray=entity.polyline.positions._value||entity.polyline.positions.getValue(),centerpoint=pointsArray[Math.round(pointsArray.length/2)]),entity.polygon&&(pointsArray=entity.polygon.hierarchy.getValue(Cesium.JulianDate.now()).positions,centerpoint=Cesium.BoundingSphere.fromPoints(pointsArray).center),entity.billboard&&(centerpoint=entity.position._value,labelInfo.pixelOffset||(labelInfo.pixelOffset=new Cesium.Cartesian3(0,8,20)),styleConfig.heightDisplayCondition)&&(entity.billboard.scaleByDistance=new Cesium.NearFarScalar(15e3,0,15e4,1));let position1=Cesium.Cartographic.fromCartesian(centerpoint),str=(styleConfig.label.height&&(position1.height=entity.properties[styleConfig.label.height]._value),entity.position=Cesium.Cartesian3.fromRadians(position1.longitude,position1.latitude,position1.height),entity.label=labelInfo,entity.id);var index=str.toString().lastIndexOf(".");if(0<=index){str=str.substring(index+1,str.length);let splitArr=str.split("_");splitArr.length<=1||isNaN(splitArr[splitArr.length-1])?entity.label.show=!0:entity.label.show=!1}}}parseLableInfo(entity,styleConfig){var labelInfo={};if(labelInfo.text=entity.properties[styleConfig.label.text],labelInfo.font=styleConfig.label.font,labelInfo.style=eval(styleConfig.label.style),labelInfo.fillColor=eval(styleConfig.label.fillColor),labelInfo.backgroundColor=eval(styleConfig.label.backgroundColor),labelInfo.showBackground=eval(styleConfig.label.showBackground),labelInfo.outlineColor=eval(styleConfig.label.outlineColor),labelInfo.outlineWidth=eval(styleConfig.label.outlineWidth),labelInfo.horizontalOrigin=eval(styleConfig.label.horizontalOrigin),labelInfo.verticalOrigin=eval(styleConfig.label.verticalOrigin),labelInfo.heightReference=eval(styleConfig.label.heightReference),labelInfo.scaleByDistance=eval(styleConfig.label.scaleByDistance),labelInfo.pixelOffset=eval(styleConfig.label.pixelOffset),styleConfig.label.disableDepthTestDistance&&(labelInfo.disableDepthTestDistance=eval(styleConfig.label.disableDepthTestDistance)),styleConfig.label.distanceDisplayCondition){var distanceDisplayCondition=styleConfig.label.distanceDisplayCondition,fieldValue=entity.properties[distanceDisplayCondition.field]._value;for(let i=0;i<distanceDisplayCondition.condition.length;i++){var contition=distanceDisplayCondition.condition[i].value;if("<"==contition.split(" ")[0]){if(fieldValue<contition.split(" ")[1]){labelInfo.distanceDisplayCondition=eval(distanceDisplayCondition.condition[i].distance);break}}else if(">="==contition.split(" ")[0]&&fieldValue>=contition.split(" ")[1]){labelInfo.distanceDisplayCondition=eval(distanceDisplayCondition.condition[i].distance);break}}}return labelInfo}}__webpack_exports__.Z=new StyleLabel},8146:function(__unused_webpack_module,__webpack_exports__){"use strict";class StyleModel{setStyle(t,i){if(i.model){t.billboard&&(t.billboard=null),t.point&&(t.point=null),t.cylinder&&(t.cylinder=null),t.ellipsoid&&(t.ellipsoid=null);var r=this.parseLableInfo(t,i);t.model=r,i.orientation&&(t.orientation=i.orientation);let e=t.id;r=e.toString().lastIndexOf(".");0<=r&&(-1==(e=e.substring(r+1,e.length)).indexOf("_")?t.model.show=!0:t.model.show=!1)}}parseLableInfo(entity,styleConfig){var modelInfo={};if(modelInfo.uri=styleConfig.model.uri,modelInfo.heightReference=eval(styleConfig.model.heightReference),modelInfo.minimumPixelSize=eval(styleConfig.model.minimumPixelSize),modelInfo.maximumScale=eval(styleConfig.model.maximumScale),modelInfo.scale=eval(styleConfig.model.scale),styleConfig.model.color&&(modelInfo.model.color=styleConfig.model.color),styleConfig.model.distanceDisplayCondition){var distanceDisplayCondition=styleConfig.model.distanceDisplayCondition,fieldValue=entity.properties[distanceDisplayCondition.field]._value;for(let i=0;i<distanceDisplayCondition.condition.length;i++){var contition=distanceDisplayCondition.condition[i].value;if("<"==contition.split(" ")[0]){if(fieldValue<contition.split(" ")[1]){modelInfo.distanceDisplayCondition=eval(distanceDisplayCondition.condition[i].distance);break}}else if(">="==contition.split(" ")[0]&&fieldValue>=contition.split(" ")[1]){modelInfo.distanceDisplayCondition=eval(distanceDisplayCondition.condition[i].distance);break}}}return modelInfo}}__webpack_exports__.Z=new StyleModel},636:function(__unused_webpack_module,__webpack_exports__){"use strict";class StylePoint{setStyle(entity,styleConfig){if(styleConfig.point){var centerpoint=entity.position._value;if(centerpoint){if(eval(styleConfig.point.markHeight)){let ellipsoid=this._viewer.scene.globe.ellipsoid,cartograhphic=ellipsoid.cartesianToCartographic(centerpoint),lat=Cesium.Math.toDegrees(cartograhphic.latitude),lng=Cesium.Math.toDegrees(cartograhphic.longitude),position=new Cesium.Cartesian3.fromDegrees(lng,lat,entity.properties.height._value);entity.position._value=position}entity.billboard&&(entity.billboard=null),entity.cylinder&&(entity.cylinder=null),entity.ellipsoid&&(entity.ellipsoid=null);let position1=Cesium.Cartographic.fromCartesian(centerpoint);styleConfig.point.height&&(position1.height=entity.properties[styleConfig.point.height]._value),entity.position=Cesium.Cartesian3.fromRadians(position1.longitude,position1.latitude,position1.height);var pointInfo=this.parsePointInfo(entity,styleConfig);entity.point=pointInfo;let str=entity.id;var index=str.toString().lastIndexOf(".");0<=index&&(str=str.substring(index+1,str.length),-1==str.indexOf("_")?entity.point.show=!0:entity.point.show=!1)}}}parsePointInfo(entity,styleConfig){var pointInfo={};if(pointInfo.pixelSize=styleConfig.point.pixelSize,pointInfo.heightReference=eval(styleConfig.point.heightReference),pointInfo.color=eval(styleConfig.point.color),pointInfo.outlineColor=eval(styleConfig.point.outlineColor),pointInfo.outlineWidth=eval(styleConfig.point.outlineWidth),pointInfo.scaleByDistance=eval(styleConfig.point.scaleByDistance),pointInfo.translucencyByDistance=eval(styleConfig.point.translucencyByDistance),styleConfig.point.disableDepthTestDistance&&(pointInfo.disableDepthTestDistance=eval(styleConfig.point.disableDepthTestDistance)),styleConfig.point.distanceDisplayCondition){var distanceDisplayCondition=styleConfig.point.distanceDisplayCondition,fieldValue=entity.properties[distanceDisplayCondition.field]._value;for(let i=0;i<distanceDisplayCondition.condition.length;i++){var contition=distanceDisplayCondition.condition[i].value;if("<"==contition.split(" ")[0]){if(fieldValue<contition.split(" ")[1]){pointInfo.distanceDisplayCondition=eval(distanceDisplayCondition.condition[i].distance);break}}else if(">="==contition.split(" ")[0]&&fieldValue>=contition.split(" ")[1]){pointInfo.distanceDisplayCondition=eval(distanceDisplayCondition.condition[i].distance);break}}}return pointInfo}}__webpack_exports__.Z=new StylePoint},26:function(__unused_webpack_module,__webpack_exports__){"use strict";class StylePolylineVolume{setStyle(e,t){var i;t.polylineVolume&&(t=this.polylineVolumeConfig(t),i=this.computePolylineLength(e),i=Math.ceil(i/10),t.material&&t.material.repeat&&(t.material.repeat._value.x=i),e.polylineVolume=t,e.polylineVolume.positions=e.polyline.positions,e.polyline=null)}computePolylineLength(e){var t=e._polyline._positions._value||e._polyline._positions.getValue();let i=0;for(let e=0;e<t.length-1;e++){var r=Cesium.Cartesian3.distance(t[e],t[e+1]);i+=r}return i}polylineVolumeConfig(styleConfig){let polylineVolumeConfigInfo={};for(var key in styleConfig.polylineVolume)if("shape"===key){if(-1<styleConfig.polylineVolume[key].indexOf("compute")){let params=styleConfig.polylineVolume[key].match(/[0-9]+([.]{1}[0-9]+){0,1}/g),paramsArr=params;polylineVolumeConfigInfo[key]=1==paramsArr.length?this.computeCircle(paramsArr[0]):this.computeStar(...paramsArr)}else if(styleConfig.polylineVolume[key].length){let shape=[];for(var item of styleConfig.polylineVolume[key])shape.push(eval(item));polylineVolumeConfigInfo[key]=shape}}else polylineVolumeConfigInfo[key]=eval(styleConfig.polylineVolume[key]);return polylineVolumeConfigInfo}computeCircle(e){for(var t=[],i=0;i<360;i++){var r=Cesium.Math.toRadians(i);t.push(new Cesium.Cartesian2(e*Math.cos(r),e*Math.sin(r)))}return t}computeStar(e,t,i){for(var r=Math.PI/e,n=2*e,o=new Array(n),s=0;s<n;s++){var a=s%2==0?t:i;o[s]=new Cesium.Cartesian2(Math.cos(s*r)*a,Math.sin(s*r)*a)}return o}}__webpack_exports__.Z=new StylePolylineVolume},8727:function(e,t){"use strict";t.Z=new class{getRegion(i){return new Promise((t,e)=>{Cesium.Resource.createIfNeeded(i).fetch().then(function(e){e=(new DOMParser).parseFromString(e,"text/html").getElementsByClassName("rbody")[0].getElementsByTagName("ul")[1].innerHTML.split("<br>");t({west:e[0].split("XMin: ")[1],east:e[2].split("XMax: ")[1],south:e[1].split("YMin: ")[1],north:e[3].split("YMax: ")[1]})})})}getDataFromArcgis(e){for(var t=e.features,i={crs:{type:"name",properties:{name:"urn:ogc:def:crs:EPSG::4326"}},features:[],numberMatched:t.length,numberReturned:t.length,timeStamp:"2021-03-23T11:54:08.140Z",totalFeatures:t.length,type:"FeatureCollection"},r=0;r<t.length;r++){var n=this.arcgisToGeojson(t[r],{id:r});i.features.push(n)}return i}arcgisToGeojson(e,t){var i={};return(t=t||{}).idAttribute=t.idAttribute||void 0,"number"==typeof e.x&&"number"==typeof e.y&&(i.type="Point",i.coordinates=[e.x,e.y],(e.z||e.m)&&i.coordinates.push(e.z),e.m)&&i.coordinates.push(e.m),e.points&&(i.type="MultiPoint",i.coordinates=e.points.slice(0)),e.paths&&(1===e.paths.length?(i.type="LineString",i.coordinates=e.paths[0].slice(0)):(i.type="MultiLineString",i.coordinates=e.paths.slice(0))),e.rings&&(i=this._convertRingsToGeoJSON(e.rings.slice(0))),(e.compressedGeometry||e.geometry||e.attributes)&&(i.type="Feature",e.compressedGeometry&&(e.geometry={paths:[this._decompressGeometry(e.compressedGeometry)]}),i.geometry=e.geometry?this.arcgisToGeojson(e.geometry,t):null,i.properties=e.attributes?this._clone(e.attributes):null,i.id=t.id,"undefined"==i.id)&&e.attributes&&(i.id=e.attributes[t.idAttribute]||e.attributes.OBJECTID||e.attributes.FID),i}async parseAsPolygonHierarchy(e,n=0){var i=[];return e.forEach(e=>{e=Cesium.GeoJsonDataSource.load(e);i.push(e)}),new Promise(t=>{Promise.all(i).then(e=>{var i=[];e.forEach(e=>{e=e.entities.values;let r=[],t=[];e.forEach(e=>{e.polygon.hierarchy._value.positions.forEach(e=>{var t=Cesium.Cartographic.fromCartesian(e),i=Cesium.Math.toDegrees(t.longitude),t=Cesium.Math.toDegrees(t.latitude);e=Cesium.Cartesian3.fromDegrees(i,t,n),r.push(e)}),e.polygon.hierarchy._value.holes.forEach(r=>{r.positions.forEach((e,t)=>{var e=Cesium.Cartographic.fromCartesian(e),i=Cesium.Math.toDegrees(e.longitude),e=Cesium.Math.toDegrees(e.latitude),i=Cesium.Cartesian3.fromDegrees(i,e,n);r.positions[t]=i}),t.push(r)})}),i.push({positions:r,holes:t})}),t(i)})})}_closeRing(e){return this._pointsEqual(e[0],e[e.length-1])||e.push(e[0]),e}_pointsEqual(e,t){for(var i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}_ringIsClockwise(e){for(var t,i=0,r=0,n=e.length,o=e[r];r<n-1;r++)i+=((t=e[r+1])[0]-o[0])*(t[1]+o[1]),o=t;return 0<=i}_coordinatesContainCoordinates(e,t){var i=this._arraysIntersectArrays(e,t),e=this._coordinatesContainPoint(e,t[0]);return!(i||!e)}_coordinatesContainPoint(e,t){for(var i=!1,r=-1,n=e.length,o=n-1;++r<n;o=r)(e[r][1]<=t[1]&&t[1]<e[o][1]||e[o][1]<=t[1]&&t[1]<e[r][1])&&t[0]<(e[o][0]-e[r][0])*(t[1]-e[r][1])/(e[o][1]-e[r][1])+e[r][0]&&(i=!i);return i}_edgeIntersectsEdge(e,t,i,r){var n=(r[0]-i[0])*(e[1]-i[1])-(r[1]-i[1])*(e[0]-i[0]),o=(t[0]-e[0])*(e[1]-i[1])-(t[1]-e[1])*(e[0]-i[0]),r=(r[1]-i[1])*(t[0]-e[0])-(r[0]-i[0])*(t[1]-e[1]);if(0!=r){i=n/r,t=o/r;if(0<=i&&i<=1&&0<=t&&t<=1)return!0}return!1}_arraysIntersectArrays(e,t){if(this._isNumber(e[0][0])){if(this._isNumber(t[0][0])){for(var i=0;i<e.length-1;i++)for(var r=0;r<t.length-1;r++)if(this._edgeIntersectsEdge(e[i],e[i+1],t[r],t[r+1]))return!0}else for(var n=0;n<t.length;n++)if(this._arraysIntersectArrays(e,t[n]))return!0}else for(var o=0;o<e.length;o++)if(this._arraysIntersectArrays(e[o],t))return!0;return!1}_isNumber(e){return!isNaN(parseFloat(e))&&isFinite(e)}_convertRingsToGeoJSON(e){for(var t,i=[],r=[],n=0;n<e.length;n++){var o=this._closeRing(e[n].slice(0));o.length<4||(this._ringIsClockwise(o)?i.push([o]):r.push(o))}for(var s=[];r.length;){for(var a=r.pop(),l=!1,u=i.length-1;0<=u;u--)if(t=i[u][0],this._coordinatesContainCoordinates(t,a)){i[u].push(a),l=!0;break}l||s.push(a)}for(;s.length;){a=s.pop();var c=!1;for(u=i.length-1;0<=u;u--)if(t=i[u][0],this._arraysIntersectArrays(t,a)){i[u].push(a),c=!0;break}c||i.push([a.reverse()])}return 1===i.length?{type:"Polygon",coordinates:i[0]}:{type:"MultiPolygon",coordinates:i}}_decompressGeometry(e){for(var t,i,r=0,n=0,o=[],s=e.match(/((\+|\-)[^\+\-]+)/g),a=parseInt(s[0],32),l=1;l<s.length;l+=2)r=t=parseInt(s[l],32)+r,i=parseInt(s[l+1],32)+n,o.push([t/a,(n=i)/a]);return o}_clone(e){var t,i={};for(t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return i}}},7007:function(e,t,i){"use strict";var r=i(9644),a=i.n(r);t.Z=new class{getPointData(e,t){(t=t||{}).useId=null==t.useId||t.useId;for(var i={crs:{type:"name",properties:{name:"urn:ogc:def:crs:EPSG::4326"}},features:[],numberMatched:e.length,numberReturned:e.length,timeStamp:"2021-03-23T11:54:08.140Z",totalFeatures:e.length,type:"FeatureCollection"},r=0;r<e.length;r++){var n,o={type:"Feature",name:e[r].id,geometry:{type:"Point",coordinates:[e[r].x,e[r].y]},geometry_name:"the_geom",properties:{}};for(n in t.useId&&(o.id=e[r].id),e[r])"x"!=n&&"y"!=n&&(o.properties[n]=e[r][n]);i.features.push(o)}return i}getPolgyonData(t,i){(i=i||{}).useId=null==i.useId||i.useId,i.geometryType=null==i.geometryType?"MultiPolygon":i.geometryType;var r={crs:{type:"name",properties:{name:"urn:ogc:def:crs:EPSG::4326"}},features:[],numberMatched:t.length,numberReturned:t.length,timeStamp:"2021-06-01T11:54:08.140Z",totalFeatures:t.length,type:"FeatureCollection"};for(let e=0;e<t.length;e++){var n=t[e].the_geom,o=[],s={type:"Feature",name:t[e].id,geometry:{type:i.geometryType,coordinates:[]},geometry_name:"the_geom",properties:{}},a=(i.useId&&(s.id=t[e].id),this._parsePolygonString(n));for(let e=0;e<a.length;e++)o.push(a[e]);s.geometry.coordinates.push(o),delete t[e].the_geom,s.properties=t[e],r.features.push(s)}return r}_parsePolygonString(e){var r=[];if("ParsedArray"==this._getThegeomType(e))return e;var n=this._getGeoJSONBody(e).split(")), ((");for(let e=0;e<n.length;e++)if(-1!=n[e].indexOf("), (")){let t=[];n[e].split(")), ((").forEach(e=>{-1!=e.indexOf("), (")&&e.split("), (").forEach(e=>{let i=[];e.split(", ").forEach(e=>{var e=e.split(" "),t=[];t.push(Number(e[0])),t.push(Number(e[1])),i.push(t)}),t.push(i)})}),r.push(t[0])}else{let i=[];n[e].split(", ").forEach(e=>{var e=e.split(" "),t=[];t.push(Number(e[0])),t.push(Number(e[1])),i.push(t)}),r.push(i)}return r}getPolylineData(t,i){(i=i||{}).useId=null==i.useId||i.useId;var r={crs:{type:"name",properties:{name:"urn:ogc:def:crs:EPSG::4326"}},features:[],numberMatched:t.length,numberReturned:t.length,timeStamp:"2021-06-01T11:54:08.140Z",totalFeatures:t.length,type:"FeatureCollection"};for(let e=0;e<t.length;e++){var n=t[e].the_geom,o={type:"Feature",name:t[e].id,geometry:{type:"MultiLineString",coordinates:[]},geometry_name:"the_geom",properties:{}},n=(i.useId&&(o.id=t[e].id),this._parsePolylineString(n));o.geometry.coordinates=n,delete t[e].the_geom,o.properties=t[e],r.features.push(o)}return r}_parsePolylineString(e){if("ParsedArray"==this._getThegeomType(e))return e;var t=[],r=this._getGeoJSONBody(e).split(")), ((");for(let e=0;e<r.length;e++){let i=[];r[e].split(", ").forEach(e=>{var e=e.split(" "),t=[];t.push(Number(e[0])),t.push(Number(e[1])),i.push(t)}),t.push(i)}return t}getDataType_v1(e){if(0!=e.length)return e[0].the_geom&&e[0].the_geom.startsWith("MULTIPOLYGON")?"Polygon":e[0].the_geom&&e[0].the_geom.startsWith("MULTILINESTRING")?"Line":"Point"}getRegion(e){e=e.url+"/getExtent?tableName="+e.layerTable;return a().get(e)}addRFSLayer(e,r,t,n,o){let s=this;e={method:"POST",url:e,data:t,timeout:3e5};a()(e).then(e=>{var t,e=e.data,i=e.content.length,e=e.content;i<=0||(i=null,"Point"==(t=s.getDataType_v1(e))?i=s.getPointData(e,{useId:!1}):"Polygon"==t?i=s.getPolgyonData(e,{useId:!1}):"Line"==t&&(i=s.getPolylineData(e,{useId:!1})),0==n?o&&o(i,r,{geometryType:t}):Cesium.GeoJsonDataSource.load(i,{clampToGround:!0}).then(e=>{o&&o(e,r,{geometryType:t})}))})}_getGeoJSONBody(e){for(var t=e.indexOf("(");"("==e[t];)t++;return e.slice(t,e.length-3).trim()}_getThegeomType(e){if("string"==typeof e){if(e.startsWith("MULTIPOLYGON"))return"WKTString";if(e.startsWith("POLYGON"))return"WKTString";if(e.startsWith("POLYLINE"))return"WKTString"}if(Array.isArray(e)){e=e[0];if(Array.isArray(e))return"ParsedArray"}}getLineonData(e,t){return console.warn("方法名称写错了，请使用getPolylineData().该方法在1.1.2版本失效"),this.getPolylineData(e,t)}}},922:function(e,t){"use strict";t.Z=class{constructor(e){this.url=e}getRegion(o){return new Promise((n,e)=>{Cesium.Resource.createIfNeeded(this.url+(this.url.includes("?")?"&":"?")+"request=GetCapabilities&service=WMTS&version=1.0.0").fetch().then(function(e){for(var t,i=(new DOMParser).parseFromString(e,"text/html").documentElement.getElementsByTagName("Layer"),r=0;r<i.length;r++)if(i[r].getElementsByTagName("ows:Identifier")[0].firstChild.data==o)return t=i[r].getElementsByTagName("ows:WGS84BoundingBox")[0],void n({west:t.getElementsByTagName("ows:LowerCorner")[0].firstChild.data.split(" ")[0],east:t.getElementsByTagName("ows:UpperCorner")[0].firstChild.data.split(" ")[0],south:t.getElementsByTagName("ows:LowerCorner")[0].firstChild.data.split(" ")[1],north:t.getElementsByTagName("ows:UpperCorner")[0].firstChild.data.split(" ")[1]})})})}}},8726:function(e,t,i){"use strict";i.d(t,{Z:function(){return r}});var c=i(2053);var n=new class{GetSphericalHarmonicCoefficients(){var e=Cesium.Cartesian3;return[new e(1.234709620475769,1.221461296081543,1.273156881332397),new e(1.135921120643616,1.171217799186707,1.287644743919373),new e(1.245193719863892,1.245591878890991,1.282818794250488),new e(-1.106930732727051,-1.112522482872009,-1.153198838233948),new e(-1.086226940155029,-1.079731941223145,-1.101912498474121),new e(1.189834713935852,1.185906887054443,1.214385271072388),new e(.01778045296669,.02013735473156,.025313569232821),new e(-1.086826920509338,-1.084611177444458,-1.111204028129578),new e(-.05241484940052,-.048303380608559,-.041960217058659)]}GetSphericalHarmonicCoefficientsquattro_canti_1k(){var e=Cesium.Cartesian3;return[new e(.480460941791534,.545602560043335,.777453422546387),new e(.404375612735748,.50021755695343,.785370171070099),new e(.094253242015839,.150258764624596,.243699923157692),new e(.066926345229149,.054583258926868,.079833894968033),new e(.077907599508762,.068002544343472,.101118102669716),new e(.052639842033386,.122856169939041,.229518577456474),new e(.010107322596014,.001822891179472,-.015145411714911),new e(-.081941060721874,-.076143972575665,-.070121936500072),new e(-.055667392909527,-.083531759679317,-.155052781105042)]}update(e){e.sphericalHarmonicCoefficients=this.GetSphericalHarmonicCoefficientsquattro_canti_1k(),e.specularEnvironmentMaps="static/layers/quattro_canti_1k.ktx2?id=1"}},h=i(1735);var A=new class{constructor(){}setModelColor(e){if(e._asset&&e._asset.colorParams)if(e.customShader)for(var t in e._asset.colorParams)e.customShader.uniforms["u_"+t]=e._asset.colorParams[t];else e.customShader=this.createDataShader(e._asset.colorParams)}setModelLighting(e,i){if(Cesium.defined(i)){let t={};try{t=JSON.parse(i.data)}catch(e){t=i}Cesium.defined(t.luminanceAtZenith)&&""!==t.luminanceAtZenith&&(e.imageBasedLighting.luminanceAtZenith=Number.parseFloat(t.luminanceAtZenith)),Cesium.defined(t.maximumScreenSpaceError)&&""!==t.maximumScreenSpaceError&&(e.maximumScreenSpaceError=Number.parseFloat(t.maximumScreenSpaceError)),Cesium.defined(t.imageBasedLightingFactor)&&""!==t.imageBasedLightingFactor&&(i=Number.parseFloat(t.imageBasedLightingFactor),e.imageBasedLighting.imageBasedLightingFactor.x=i,e.imageBasedLighting.imageBasedLightingFactor.y=i),Cesium.defined(t.specularEnvironmentMaps)&&""!==t.specularEnvironmentMaps&&(e.imageBasedLighting.specularEnvironmentMaps=t.specularEnvironmentMaps)}}createDataShader(e){e=e||{brightness:1,contrast:1,hue:0,saturation:1};return new Cesium.CustomShader({uniforms:{u_brightness:{value:e.brightness,type:Cesium.UniformType.FLOAT},u_contrast:{value:e.contrast,type:Cesium.UniformType.FLOAT},u_hue:{value:e.hue,type:Cesium.UniformType.FLOAT},u_saturation:{value:e.saturation,type:Cesium.UniformType.FLOAT}},fragmentShaderText:`
                vec3 lerpColor(vec3 col1,vec3 col2, float value){
                    vec3 newCol = vec3 ((col1.r * (1.0 - value) + col2.r * value), (col1.g * (1.0 - value) + col2.g * value), (col1.b * (1.0 - value) + col2.b * value));
                    return newCol;
                }
                void fragmentMain(FragmentInput fsInput, inout czm_modelMaterial material) {

                //hue色相计算
                float angle = u_hue * 3.14159265;
                float s = sin(angle), c = cos(angle);
                vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;
                // float len = length(material.diffuse);
                vec3 color = vec3(
                dot(material.diffuse, weights.xyz),
                dot(material.diffuse, weights.zxy),
                dot(material.diffuse, weights.yzx)
                );

                //brigtness亮度直接乘以一个系数,调整亮度
                color *= u_brightness;
                //saturation饱和度:首先根据公式计算同等亮度情况下饱和度最低的值：
                    float gray = 0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
                //获取在饱和度最低的图像和原图之间差值
                color = lerpColor(vec3(gray, gray, gray), color, u_saturation);
                //contrast对比度:首先计算对比度最低的值
                //获取对比度最低的图像和原图之间差值
                color = lerpColor(vec3(0.5, 0.5, 0.5), color, u_contrast);
                material.diffuse = color;
            }`})}};var r=new class{constructor(){this._tileVisibleCallback=void 0,this._customShader=void 0,this._tilesLayerSubDomainHelper=void 0}getBIMTreeDataUrl(e){var t=e.lastIndexOf("/");return e.substr(0,t)+"/info/index.json"}getBIMTreeData(e){e=this.getBIMTreeDataUrl(e);return c.Z.getData(e)}async add3DTileset(e,t,i,r={}){var e=c.Z.getProxyUrl(e),n=(this._tilesLayerSubDomainHelper||(this._tilesLayerSubDomainHelper=new h.Z),{url:e,shadows:Cesium.ShadowMode.ENABLED,preloadFlightDestinations:!0,preferLeaves:!0,skipLevelOfDetail:!0,immediatelyLoadDesiredLevelOfDetail:!0,skipScreenSpaceErrorFactor:1e4,skipLevels:100,loadSiblings:!0,dynamicScreenSpaceError:!0});if(t)for(var o in t)n[o]=t[o];this._tilesLayerSubDomainHelper.update(r,n);try{var s=await Cesium.Cesium3DTileset.fromUrl(e,n)}catch(e){return console.error("3dtileset初始化失败",n,e),null}if(s._domains=r?.domains,i&&this.setConfigStyle(s,i),A.setModelLighting(s,r),A.setModelColor(s),s?._asset?.tilesetParams){var a,l=s._asset.tilesetParams;for(a in l)!n[a]&&l[a]&&(s[a]=l[a])}if(r?.data){var u=JSON.parse(JSON.parse(r.data).senceExtendData);for(let t=0;t<u.length;t++)if(""!=u[t].key){let e=u[t].value;"boolean"==u[t].explain&&(e=Boolean(e)),"number"==u[t].explain&&(e=Number(e)),s[u[t].key]=e}}return s}loadDefaultStyle(t,e){c.Z.getData(c.Z.getSibleFileUrl(e,"tileset.config.json")).then(function(e){e.tileStyle&&(e=new Cesium.Cesium3DTileStyle(e.tileStyle),t.style=e)})}setConfigStyle(i,e){let r=this;c.Z.getData(agcim.net.apiPath.styleConfig_get,{id:e}).then(function(e){var t;e.success&&e.content&&e.content.styleMgrInfo&&(0==(e=e.content.styleMgrInfo).indexOf("{")?((t=JSON.parse(e)).specularEnvironmentMaps&&n.update(i),i.initialTilesLoaded.addEventListener(function(){var e=new Cesium.Cesium3DTileStyle(t);i.style=e})):(i.style=null,r.setCustomShader(i,e)))})}_initVisibleEvent(e){this._tileVisibleCallback||(this._tileVisibleCallback=e.tileVisible.addEventListener(this._updateTile,this))}_updateTile(e){var r=e.content;for(let e=0;e<r.featuresLength;e++){let t=r.getFeature(e),i=t.content._model;this._properties&&this._properties.length&&this._properties.forEach(e=>{t.hasProperty(e.key)&&t.getProperty(e.key)===e.keyValue&&t.setProperty(e.propertyName,e.propertyValue)}),this._customShader&&i&&i._sourcePrograms&&i._rendererResources&&(Object.keys(i._sourcePrograms).forEach(e=>{e=i._sourcePrograms[e];i._rendererResources.sourceShaders[e.fragmentShader]=this._customShader}),i._shouldRegenerateShaders=!0)}}setCustomShader(e,t){return this._customShader=t,this._initVisibleEvent(e),this}setPosition(e,t,i,r){var n=new Cesium.Matrix3,o=new Cesium.HeadingPitchRoll(Math.PI,Math.PI,Math.PI),n=Cesium.Matrix3.fromHeadingPitchRoll(o,n),o=Cesium.Matrix4.multiplyByTranslation(Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(i,t,r)),new Cesium.Cartesian3,new Cesium.Matrix4);Cesium.Matrix4.multiplyByMatrix3(o,n,o),e._root.transform=o}getAgcimServerStoreDataInfo(e){e=e.split("::");return"AgCIMServer"==e[0]&&"3dtiles"==e[1]?c.Z.getData("/agserver/rest/3dtiles/getDetails?id="+e[2]):null}}},1735:function(e,t){"use strict";t.Z=class{constructor(){}update(e,t){if(e&&0!==Object.keys(e).length)return 0<e?.domains?.length&&(t.url=this.changeUrl(t.url,e?.domains[0]),t._domains=e?.domains),t}changeUrl(e,t){var i;return e&&(null!=this.getIp(i=t)&&(i=this.getIp(t)),t=null!=this.getIp(e)?this.getIp(e):e,e.replace(t,i).toString())}getIp(e){var t=/(\/\/(\S*)\/)/;return e.match(t)&&(e=e.match(t)[0].substring(2,e.match(t)[0].length-1)).substring(0,e.indexOf("/"))||null}updateGateWay(e){let t=null;try{e.data&&(t=JSON.parse(e.data))}catch(e){console.error(e)}return"1"===t?.apisix&&""!=e.serverCluster&&null!=e.serverCluster&&null!=e.serverCluster&&(e.domains=e.serverCluster.split(",")),e}}},53:function(e,t){"use strict";const y=Cesium.defaultValue,_=Cesium.defined,v=Cesium.Color,C=Cesium.DeveloperError;let w;t.Z=function(t,e){if(!_(t))throw new C("text is required.");if(""!==t){e=y(e,y.EMPTY_OBJECT);var i=y(e.font,"10px sans-serif"),r=y(e.stroke,!1),n=y(e.fill,!0),o=y(e.strokeWidth,1),s=y(e.backgroundColor,v.TRANSPARENT),a=y(e.padding,0),l=2*a,u=document.createElement("canvas"),c=(u.width=1,u.height=1,u.style.font=i,u.getContext("2d",{willReadFrequently:!0})),h=(_(w)||(_(c.imageSmoothingEnabled)?w="imageSmoothingEnabled":_(c.mozImageSmoothingEnabled)?w="mozImageSmoothingEnabled":_(c.webkitImageSmoothingEnabled)?w="webkitImageSmoothingEnabled":_(c.msImageSmoothingEnabled)&&(w="msImageSmoothingEnabled")),c.font=i,c.lineJoin="round",c.lineWidth=o,c[w]=!1,u.style.visibility="hidden",document.body.appendChild(u),function(o,s,a,l,u){var c=o.measureText(s);if(!/\S/.test(s))return{width:c.width,height:0,ascent:0,descent:0,minx:0};{var h=document.defaultView.getComputedStyle(o.canvas).getPropertyValue("font-size").replace("px",""),A=document.createElement("canvas"),p=c.width+100|0,f=3*h,h=f/2,d=(A.width=p,A.height=f,A.getContext("2d")),g=(d.font=a,d.fillStyle="white",d.fillRect(0,0,A.width+1,A.height+1),l&&(d.strokeStyle="black",d.lineWidth=o.lineWidth,d.strokeText(s,50,h)),u&&(d.fillStyle="black",d.fillText(s,50,h)),d.getImageData(0,0,p,f).data),m=g.length,y=4*p;let e,t,i,r;for(e=0;e<m;++e)if(255!==g[e]){i=e/y|0;break}for(e=m-1;0<=e;--e)if(255!==g[e]){r=e/y|0;break}let n=-1;for(e=0;e<p&&-1===n;++e)for(t=0;t<f;++t){var _=4*e+t*y;if(255!==g[_]||255!==g[1+_]||255!==g[2+_]||255!==g[3+_]){n=e;break}}return{width:c.width,height:r-i,ascent:h-i,descent:r-h,minx:n-50}}}(c,t,i,r,n)),A=-(u.dimensions=h).minx,p=Math.ceil(h.width)+A+l,f=h.height+l,d=f-(f-h.ascent+a)+l;if(u.width=e?.column?f:p,u.height=e?.column?p:f,c.font=i,c.lineJoin="round",c.lineWidth=o,c[w]=!1,s!==v.TRANSPARENT&&(c.fillStyle=s.toCssColorString(),c.fillRect(0,0,u.width,u.height)),r){h=y(e.strokeColor,v.BLACK);if(c.strokeStyle=h.toCssColorString(),e.column)for(let e=0;e<t.length;e++){document.defaultView.getComputedStyle(c.canvas).getPropertyValue("font-size").replace("px","");var g=(u.height-l)/t.length;c.strokeText(t,A+a,d+g*e)}else c.strokeText(t,A+a,d)}if(n){p=y(e.fillColor,v.WHITE);if(c.fillStyle=p.toCssColorString(),e.column)for(let e=0;e<t.length;e++){document.defaultView.getComputedStyle(c.canvas).getPropertyValue("font-size").replace("px","");var m=(u.height-l)/t.length;c.fillText(t[e],A+a,d+m*e)}else c.fillText(t,A+a,d)}return document.body.removeChild(u),u.style.visibility="",u}}},1756:function(e,t){"use strict";t.Z=new class{updateGeometry(e,t,i,r){if("Polygon"==e.geometryType){for(var n=[],o=0;o<i.length;o++)for(var s=0;s<i[o].length;s++){n=[];for(var a=0;a<i[o][s].length;a++)n.push(i[o][s][a][0]),n.push(i[o][s][a][1])}var l=Cesium.Cartesian3.fromDegreesArray(n);t.polygon.hierarchy=new Cesium.PolygonHierarchy(l,[])}else if("Line"==e.geometryType){for(n=[],o=0;o<i[0].length;o++)n.push(i[0][o][0],i[0][o][1]);l=new Cesium.Cartesian3.fromDegreesArray(n);t.polyline.positions=l}else this.updateGeometryByStyle(t,i,r)||(e=Cesium.Cartesian3.fromDegrees(i[0],i[1]),t.position=e)}updateGeometryByStyle(e,t,i){var r;return!!i&&null!=(i=i.label.height)&&(t=Cesium.Cartesian3.fromDegrees(t[0],t[1]),(""+i).startsWith("{")?(r=i.substr(1,i.length-2),t.height=e.properties[r]._value):t.height=parseFloat(i),void(e.position=Cesium.Cartesian3.fromRadians(t.longitude,t.latitude,t.height)))}}},2312:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";var _styleUtils_styleBillboard__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5121),_styleUtils_styleLabel__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3367),_styleUtils_stylePoint__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(636),_styleUtils_styleEllipsoid__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(4975),_styleUtils_styleCylinder__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(7051),_styleUtils_stylePolylineVolume__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(26),_styleUtils_styleModel__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(8146);class WfsLayerStyleClassBreak{setStyle(entities,styleConfig){if(styleConfig.classBreakInfos)for(var field=styleConfig.field,defaultIndex=(this.initialize(styleConfig),this.getDefaultIndex(styleConfig)),i=0;i<entities.length;i++){var entity=entities[i],height,index,classBreakItem,material,material,material,lastSibleBillboard;entity.properties[field]&&(height=null==entity.properties[field]?void 0:Number(entity.properties[field]),index=this.getClassBreakIndex(styleConfig,height,defaultIndex),classBreakItem=styleConfig.classBreakInfos[index],entity.polygon&&(material=classBreakItem.materialInstance,entity.polygon.outline=classBreakItem.outline,entity.polygon.extrudedHeight=isNaN(classBreakItem.extrudedHeight)?styleConfig.extrudedHeightField?entity.properties[styleConfig.extrudedHeightField]:styleConfig.extrudedHeight||void 0:Number(classBreakItem.extrudedHeight),entity.polygon.material=material,entity.polygon.outlineColor=classBreakItem.outlineColorInstance,entity.polygon.outlineWidth=classBreakItem.outlineWidth,entity.polygon.height=isNaN(styleConfig.height)?height:Number(styleConfig.height),entity.polygon.heightReference=eval(styleConfig.heightReference),1==entity.polygon.heightReference&&(entity.polygon.height=void 0),entity.polygon.perPositionHeight=null!=styleConfig.perPositionHeight&&styleConfig.perPositionHeight,entity.polygon.classificationType=eval(styleConfig.classificationType)),entity.polyline&&(entity.polyline.material=eval(classBreakItem.material),entity.polyline.width=eval(classBreakItem.outlineWidth),entity.polyline.classificationType=eval(classBreakItem.classificationType),classBreakItem.lineType?("PolylineDash"==classBreakItem.lineType?material=new Cesium.PolylineDashMaterialProperty({color:eval(classBreakItem.material),dashPattern:eval(classBreakItem.dashPattern),dashLength:eval(classBreakItem.dashLength)}):"PolylineArrow"==classBreakItem.lineType&&(material=new Cesium.PolylineArrowMaterialProperty(eval(classBreakItem.material)),entity.polyline.width=10),entity.polyline.material=material):entity.polyline.material=eval(classBreakItem.material),entity.polylineVolume)&&entity.polylineVolume.positions&&(entity.polyline.positions=entity.polylineVolume.positions,entity.polylineVolume=null),lastSibleBillboard=_styleUtils_styleBillboard__WEBPACK_IMPORTED_MODULE_0__.Z.setStyle(entity,classBreakItem,lastSibleBillboard),_styleUtils_styleModel__WEBPACK_IMPORTED_MODULE_6__.Z.setStyle(entity,classBreakItem),_styleUtils_styleLabel__WEBPACK_IMPORTED_MODULE_1__.Z.setStyle(entity,classBreakItem),_styleUtils_stylePoint__WEBPACK_IMPORTED_MODULE_2__.Z.setStyle(entity,classBreakItem),_styleUtils_styleEllipsoid__WEBPACK_IMPORTED_MODULE_3__.Z.setStyle(entity,classBreakItem),_styleUtils_styleCylinder__WEBPACK_IMPORTED_MODULE_4__.Z.setStyle(entity,classBreakItem),_styleUtils_stylePolylineVolume__WEBPACK_IMPORTED_MODULE_5__.Z.setStyle(entity,classBreakItem))}}initialize(styleConfig){for(var defaultIndex=0,i=0;i<styleConfig.classBreakInfos.length;i++){var item=styleConfig.classBreakInfos[i];item.material&&(item.materialInstance=eval(item.material)),item.outlineColor&&(item.outlineColorInstance=eval(item.outlineColor)),"default"==item.name&&(defaultIndex=i)}}getDefaultIndex(e){for(var t=0;t<e.classBreakInfos.length;t++)if("default"==e.classBreakInfos[t].name)return t;return 0}getClassBreakIndex(e,t,i){let r=i;for(var n=0;n<e.classBreakInfos.length;n++){var o=e.classBreakInfos[n].minValue,s=e.classBreakInfos[n].maxValue;(isNaN(o)&&!isNaN(s)&&t<s||isNaN(s)&&!isNaN(o)&&o<=t||!isNaN(o)&&!isNaN(s)&&o<=t&&t<s)&&(r=n)}return r}}__webpack_exports__.Z=new WfsLayerStyleClassBreak},7030:function(e,t){"use strict";t.Z=class{constructor(){this.drawingInfo=null}async getGeosceneStyleInfo(e){e=await Cesium.Resource.createIfNeeded(e.url).getDerivedResource({queryParameters:{f:"json"}}).fetchJsonp();e&&e.drawingInfo&&(this.drawingInfo=e.drawingInfo)}async getStyleFromGeosceneStyle(e){return this.drawingInfo||await this.getGeosceneStyleInfo(e),this.drawingInfo?((e=this.drawingInfo.renderer)&&e.type&&("uniqueValue"==e.type?this.entityStyles=this.getUniqueValueStyleFromGeosceneStyle(e):"classBreaks"==e.type?this.entityStyles=this.getClassBreakStyleFromGeosceneStyle(e):this.entityStyles=this.getSimpleStyleFromGeosceneStyle(e.symbol)),this.drawingInfo.labelingInfo&&this.getLabelStyleFromGeosceneStyle(this.drawingInfo.labelingInfo,this.entityStyles),this.entityStyles):null}getUniqueValueStyleFromGeosceneStyle(t){var e,i={};if(i.field=t.field1,i.uniqueValueInfos=[],t.uniqueValueInfos)for(let e=0;e<t.uniqueValueInfos.length;e++){var r=this.getSimpleStyleFromGeosceneStyle(t.uniqueValueInfos[e].symbol);r.value=t.uniqueValueInfos[e].value,i.uniqueValueInfos.push(r)}return t.defaultSymbol&&((e=this.getSimpleStyleFromGeosceneStyle(t.defaultSymbol)).value="default",i.uniqueValueInfos.push(e)),i}getClassBreakStyleFromGeosceneStyle(t){var e,i={};i.field=t.field,i.classBreakInfos=[];let r=Number(t.minValue)||0;if(t.classBreakInfos)for(let e=0;e<t.classBreakInfos.length;e++){var n=this.getSimpleStyleFromGeosceneStyle(t.classBreakInfos[e].symbol);n.minValue=r,n.maxValue=Number(t.classBreakInfos[e].classMaxValue),i.classBreakInfos.push(n),r=n.maxValue}return t.defaultSymbol&&((e=this.getSimpleStyleFromGeosceneStyle(t.defaultSymbol)).name="default",i.classBreakInfos.push(e)),i}getLabelStyleFromGeosceneStyle(t,i={}){i.label=i.label||{};for(let e=0;e<t.length;e++){var r,n,o=t[e];if(o.labelExpression?(n=o.labelExpression.indexOf("["),r=o.labelExpression.indexOf("]"),0<=n&&0<=r&&(i.label.text=o.labelExpression.slice(n+1,r))):o.labelExpressionInfo&&(n=o.labelExpressionInfo.expression).includes("$")&&(i.label.text=n.slice(n.indexOf(".")+1)),o.labelPlacement&&(o.labelPlacement.includes("Above")?i.label.verticalOrigin=Cesium.VerticalOrigin.BOTTOM:o.labelPlacement.includes("Below")?i.label.verticalOrigin=Cesium.VerticalOrigin.TOP:i.label.verticalOrigin=Cesium.VerticalOrigin.CENTER,o.labelPlacement.includes("Left")?i.label.horizontalOrigin=Cesium.HorizontalOrigin.LEFT:o.labelPlacement.includes("Right")?i.label.horizontalOrigin=Cesium.HorizontalOrigin.RIGHT:i.label.horizontalOrigin=Cesium.HorizontalOrigin.CENTER),o.symbol){this.getStyleFromTextSymbol(o.symbol,i);break}}}getSimpleStyleFromGeosceneStyle(e){var t;if(e)return t={},"esriSMS"==e.type&&this.getStyleFromSimpleMarkerSymbol(e,t),"esriPMS"==e.type&&this.getStyleFromPictureMarkerSymbol(e,t),"esriSLS"==e.type&&this.getStyleFromSimpleLineSymbol(e,t),"esriSFS"==e.type&&this.getStyleFromSimpleFillSymbol(e,t),e.type,"esriTS"==e.type&&this.getStyleFromTextSymbol(e,t),t}getStyleFromTextSymbol(e,t={}){t.label=t.label||{},e.font&&(t.label.font="",e.font.style&&(t.label.font=e.font.style),e.font.weight&&(t.label.font=t.label.font.concat(" "+e.font.weight)),e.font.size&&(t.label.font=t.label.font.concat(" "+e.font.size+"px")),e.font.family)&&(t.label.font=t.label.font.concat(" "+e.font.family)),e.color&&(t.label.fillColor=Cesium.Color.fromBytes(e.color[0],e.color[1],e.color[2],e.color[3])),e.backgroundColor&&0!=e.backgroundColor[3]&&(t.label.showBackground=!0,t.label.backgroundColor=Cesium.Color.fromBytes(e.backgroundColor[0],e.backgroundColor[1],e.backgroundColor[2],e.backgroundColor[3])),e.borderLineColor&&(t.label.outlineColor=Cesium.Color.fromBytes(e.borderLineColor[0],e.borderLineColor[1],e.borderLineColor[2],e.borderLineColor[3])),e.borderLineSize&&(t.label.outlineWidth=Number(e.borderLineSize)),!t.label.hasOwnProperty("horizontalOrigin")&&e.horizontalAlignment&&("left"==e.horizontalAlignment?t.label.horizontalOrigin=Cesium.HorizontalOrigin.LEFT:"right"==e.horizontalAlignment?t.label.horizontalOrigin=Cesium.HorizontalOrigin.RIGHT:t.label.horizontalOrigin=Cesium.HorizontalOrigin.CENTER),t.label.hasOwnProperty("verticalOrigin")||(t.label.verticalOrigin=Cesium.VerticalOrigin.BOTTOM,e.verticalAlignment&&("bottom"==e.verticalAlignment?t.label.verticalOrigin=Cesium.VerticalOrigin.BOTTOM:"baseline"==e.verticalAlignment?t.label.verticalOrigin=Cesium.VerticalOrigin.BASELINE:"middle"==e.verticalAlignment?t.label.verticalOrigin=Cesium.VerticalOrigin.CENTER:t.label.verticalOrigin=Cesium.VerticalOrigin.TOP)),(e.xoffset||e.yoffset)&&(t.billboard.pixelOffset=new Cesium.Cartesian2(e.xoffset||0,e.yoffset||0)),t.label.scaleByDistance=new Cesium.NearFarScalar(15e3,1.5,15e4,1),t.label.heightReference=Cesium.HeightReference.CLAMP_TO_GROUND}getStyleFromSimpleMarkerSymbol(e,t={}){var i;return t.point={},e.color&&(t.point.color=Cesium.Color.fromBytes(e.color[0],e.color[1],e.color[2],e.color[3])),e.size&&(t.point.pixelSize=e.size),e.outline&&(e.outline.color&&(i=e.outline.color,t.point.outlineColor=Cesium.Color.fromBytes(i[0],i[1],i[2],i[3])),t.point.outlineWidth=e.outline.width),t}getStyleFromPictureMarkerSymbol(e,t={}){var i;return e.imageData&&(t.billboard={},i=e.contentType||"image/png",t.billboard.image="data:"+i+";base64,"+e.imageData,e.height&&(t.billboard.height=Number(e.height)),e.width&&(t.billboard.width=Number(e.width)),e.rotation&&(t.billboard.rotation=Cesium.Math.toRadians(Number(e.angle)),t.billboard.alignedAxis=Cesium.Cartesian3.ZERO),e.xoffset||e.yoffset)&&(t.billboard.pixelOffset=new Cesium.Cartesian2(e.xoffset||0,e.yoffset||0)),t}getStyleFromSimpleLineSymbol(e,t={}){return e.color&&(t.material=Cesium.Color.fromBytes(e.color[0],e.color[1],e.color[2],e.color[3])),t.outlineWidth=Number(e.width),e.style&&"esriSLSSolid"!=e.style&&("esriSLSNull"==e.style?t.outlineWidth=0:(t.lineType="PolylineDash","esriSLSDot"==e.style&&(t.dashPattern=parseInt("1100110011001100",2)),"esriSLSDashDot"==e.style&&(t.dashPattern=parseInt("1111111100011000",2)),"esriSLSDashDotDot"==e.style&&(t.dashPattern=parseInt("1111110011001100",2)))),t}getStyleFromSimpleFillSymbol(e,t={}){var i;return e.color&&(t.material=Cesium.Color.fromBytes(e.color[0],e.color[1],e.color[2],e.color[3])),e.outline&&(t.outline=!0,e.outline.color&&(i=e.outline.color,t.outlineColor=Cesium.Color.fromBytes(i[0],i[1],i[2],i[3])),t.outlineWidth=Number(e.outline.width)),t}}},7517:function(e,t,i){"use strict";var r=i(2053);t.Z=class{constructor(){this.legendInfo=null}async getLegendStyle(e){var t={layer:e.layerTable,service:"WMS",request:"GetLegendGraphic",format:"application/json"},e=(e.queryParameters?.token&&(t.token=e.queryParameters?.token),await r.Z.getData(e.url,t));e&&(this.legendInfo=e.Legend)}async getStyleFromLegendStyle(e){if(this.legendInfo||await this.getLegendStyle(e),!this.legendInfo||!this.legendInfo.length)return null;var t,i=this.legendInfo[0].rules;for(let e=0;e<i.length;e++)return i[e].filter?0<=i[e].filter.indexOf(" =")?this.entityStyles=this.getUniqueValueStyleFromLegendStyle(i):this.entityStyles=this.getClassBreakStyleFromLegendStyle(i):(t=i[e].symbolizers,this.entityStyles=this.getSimpleStyleFromLegendStyle(t)),this.entityStyles}getUniqueValueStyleFromLegendStyle(t){var i={};i.field=t[0].filter.split('"')[1],i.uniqueValueInfos=[];for(let e=0;e<t.length;e++){var r=this.getSimpleStyleFromLegendStyle(t[e].symbolizers);t[e].filter?(t[e].name?r.value=t[e].name:r.value="default",i.uniqueValueInfos.push(r)):Object.assign(i,r)}return i}getClassBreakStyleFromLegendStyle(t){var i={};i.field=t[0].filter.split("[")[1].split(" ")[0],i.classBreakInfos=[];for(let e=0;e<t.length;e++){var r,n=this.getSimpleStyleFromLegendStyle(t[e].symbolizers);t[e].filter?(r=t[e].filter.match(/\d+/g))&&r.length&&(2==r.length?(n.minValue=Number(r[0]),n.maxValue=Number(r[1])):0<=t[e].filter.indexOf("<")?n.maxValue=Number(r[0]):0<=t[e].filter.indexOf(">")&&(n.minValue=Number(r[0])),i.classBreakInfos.push(n)):Object.assign(i,n)}return i}getSimpleStyleFromLegendStyle(t){var i={};for(let e=0;e<t.length;e++){var r,n,o,s=t[e];s.Polygon&&((r=s.Polygon).fill&&(i.material=Cesium.Color.fromAlpha(Cesium.Color.fromCssColorString(r.fill),Number(r["fill-opacity"]||1))),r.stroke)&&(i.outline=!0,i.outlineColor=Cesium.Color.fromAlpha(Cesium.Color.fromCssColorString(r.stroke),Number(r["stroke-opacity"]||1)),i.outlineWidth=Number(r["stroke-width"])),s.Line&&((r=s.Line).stroke&&(i.material=Cesium.Color.fromAlpha(Cesium.Color.fromCssColorString(r.stroke),Number(r["stroke-opacity"]||1)),r["stroke-dasharray"])&&(i.lineType="PolylineDash",2<=(o=r["stroke-dasharray"].split(" ")).length)&&(n=16-(o=Math.round(16/(Number(o[0])+Number(o[1]))*Number(o[0]))),o="1".repeat(o)+"0".repeat(n),i.dashPattern=parseInt(o,2)),r["stroke-width"])&&(i.outlineWidth=Number(r["stroke-width"])),s.Point&&(n=s.Point).url&&(i.billboard={},i.billboard.image=n.url,n.size&&(i.billboard.height=Number(n.size),i.billboard.width=Number(n.size)),n.rotation)&&(i.billboard.rotation=Cesium.Math.toRadians(Number(n.rotation))),s.Text&&(o=s.Text,i.label={},o.label&&(i.label.text=o.label[0]),o.fonts&&(s=o.fonts instanceof Array?o.fonts[0]:o.fonts,i.label.font="",s["font-style"]&&(i.label.font=s["font-style"]),s["font-weight"]&&(i.label.font=i.label.font.concat(" "+s["font-weight "])),s["font-size"]&&(i.label.font=i.label.font.concat(" "+s["font-size"]+"px")),s["font-family"])&&(s=s["font-family"]instanceof Array?s["font-family"][0]:s["font-family"],i.label.font=i.label.font.concat(" "+s)),o.fill&&(i.label.fillColor=Cesium.Color.fromAlpha(Cesium.Color.fromCssColorString(o.fill),Number(o["fill-opacity"]||1))),i.label.verticalOrigin=Cesium.VerticalOrigin.BOTTOM,o["label-placement"]&&((s=o["label-placement"])["x-anchor"]&&(s["x-anchor"]<.5?i.label.horizontalOrigin=Cesium.HorizontalOrigin.LEFT:.5<s["x-anchor"]?i.label.horizontalOrigin=Cesium.HorizontalOrigin.RIGHT:i.label.horizontalOrigin=Cesium.HorizontalOrigin.CENTER),s["y-anchor"]&&(0==s["y-anchor"]?i.label.verticalOrigin=Cesium.VerticalOrigin.BOTTOM:s["y-anchor"]<.5?i.label.verticalOrigin=Cesium.VerticalOrigin.BASELINE:.5==s["y-anchor"]?i.label.verticalOrigin=Cesium.VerticalOrigin.CENTER:i.label.verticalOrigin=Cesium.VerticalOrigin.TOP),s["x-displacement"]||s["y-displacement"])&&(i.pixelOffset=new Cesium.Cartesian2(0,0),i.pixelOffset.x=s["x-displacement"]||0,i.pixelOffset.y=s["y-displacement"]||0),i.label.scaleByDistance=new Cesium.NearFarScalar(15e3,1.5,15e4,1),i.label.heightReference=Cesium.HeightReference.CLAMP_TO_GROUND)}return i}}},812:function(e,t,i){"use strict";var n=i(6344),o=i(3355),u=i(3418),s=i(2053);t.Z=class{constructor(e){this.parentLayer=e,n.Z._viewer=e._viewer,this._viewer=e._viewer}setStyle(t,e){let i=this.parentLayer,r=this;var n=i._styleOfServerData;n?r._setStyleOfData(t,n,i):s.Z.getData(agcim.net.apiPath.styleConfig_get,{id:e}).then(function(e){i._styleOfServerData=e,r._setStyleOfData(t,e,i)})}_setStyleOfData(t,i,r){if(i.success&&i.content&&i.content.styleMgrInfo){i=JSON.parse(i.content.styleMgrInfo);if(i["3d"])this.set3dTilesStyle(t,i["3d"]);else if(i.NormalWaterStyle){var e=new o.Z.NormalWaterStyle;e.clearPrePrimitives(r),e.setWaterStyleByDataSource(t,r,i.NormalWaterStyle)}else if(i.NormalPolyLinePrimitiveStyle){e=new o.Z.NormalPolyLinePrimitiveStyle;e.clearPrePrimitives(r),e.setNormalPolyLineStyleByDataSource(t,r,i.NormalPolyLinePrimitiveStyle)}else if(i.TrailLinkPolyLineVolumePrimitiveStyle){e=new o.Z.TrailLinkPolyLineVolumePrimitiveStyle;e.clearPrePrimitives(r),e.setTrialLinkPolyLineVolumeStyleByDataSource(t,r,i.TrailLinkPolyLineVolumePrimitiveStyle)}else if(i.TrailLinkPolyLinePrimitiveStyle){e=new o.Z.TrailLinkPolyLinePrimitiveStyle;e.clearPrePrimitives(r),e.setTrialLinkPolyLineStyleByDataSource(t,r,i.TrailLinkPolyLinePrimitiveStyle)}else if(i.TrailLinkWallPrimitiveStyle){e=new o.Z.TrailLinkWallPrimitiveStyle;e.clearPrePrimitives(r),e.setTrialLinkWallStyleByDataSource(t,r,i.TrailLinkWallPrimitiveStyle)}else if(i.NormalPolygonPrimitiveStyle){e=new o.Z.NormalPolygonPrimitiveStyle;e.clearPrePrimitives(r),e.setNormalPolygonStyleByDataSource(t,r,i.NormalPolygonPrimitiveStyle)}else if(i.reflectWater){let e=new o.Z.ReflectWaterStyle;(this._reflectWater=e).clearPrePrimitives(r),e.setWaterStyleByDataSource(t,r,i.reflectWater),setTimeout(()=>{e.addReflect()},50)}else n.Z.setDataStoreStyle(t,i)}}removeStyle(){this._reflectWater&&this._reflectWater.removeReflect()}set3dTilesStyle(t,e,r){var s=this._viewer;let a=t.features,l=(r&&(a=t.arr),null);var i=CIM.layerTree._aglayers;for(let e=i.length-1;0<e;e--)if(t.id==i[e].id){l=CIM.layerTree._aglayers[e]._primitives;break}for(let i=0;i<a.length;i++){let n=a[i].coordinates,o=a[i],t=(r?delete o.url:(n=a[i].geometry.coordinates,o=a[i].properties),!1);for(let e=0;e<l.length;e++)if(l[e].agMetaData.id==a[i].id){t=!0;break}t||new u.Z(this._viewer).add(e.url,o,e.styleManagerId).readyPromise.then(function(e){var t=Cesium.Cartographic.fromCartesian(e.boundingSphere.center),i=Cesium.Cartesian3.fromRadians(t.longitude,t.latitude,t.height),r=s.scene.globe.ellipsoid,t=Cesium.Cartographic.fromDegrees(n[0],n[1],n[2]||o.height),r=r.getCartographic().toCartesian(t),t=Cesium.Cartesian3.subtract(r,i,new Cesium.Cartesian3);e.modelMatrix=Cesium.Matrix4.fromTranslation(t),e.agMetaData=o,l.push(e)})}}}},4764:function(e,t,i){"use strict";i.d(t,{Z:function(){return d}});var r=i(3829),n=i(9745);var t=new class{getGridPoints(e,t,i="meters"){let r=this,n=r.polygon(e);var e=r.turf.bbox(n),o=[];return r.turf.pointGrid(e,t,{units:i}).features.forEach(e=>{e=r.turf.getCoord(e);r.turf.booleanWithin(r.turf.point(e),n)&&o.push(e)}),o.map(e=>Cesium.Cartesian3.fromDegrees(e[0],e[1]))}getExportMethods(){return["getGridPoints"]}},o=i(6511);function w(e,t,i){if(null!==e)for(var r,n,o,s=0,a=e.type,l="FeatureCollection"===a,u="Feature"===a,c=l?e.features.length:1,h=0;h<c;h++)for(var A,p,f=(p=!!(A=l?e.features[h].geometry:u?e.geometry:e)&&"GeometryCollection"===A.type)?A.geometries.length:1,d=0;d<f;d++){var g=0,m=0,y=p?A.geometries[d]:A;if(null!==y){var _=y.coordinates,v=y.type,C=!i||"Polygon"!==v&&"MultiPolygon"!==v?0:1;switch(v){case null:break;case"Point":if(!1===t(_,s,h,g,m))return!1;s++,g++;break;case"LineString":case"MultiPoint":for(r=0;r<_.length;r++){if(!1===t(_[r],s,h,g,m))return!1;s++,"MultiPoint"===v&&g++}"LineString"===v&&g++;break;case"Polygon":case"MultiLineString":for(r=0;r<_.length;r++){for(n=0;n<_[r].length-C;n++){if(!1===t(_[r][n],s,h,g,m))return!1;s++}"MultiLineString"===v&&g++,"Polygon"===v&&m++}"Polygon"===v&&g++;break;case"MultiPolygon":for(r=0;r<_.length;r++){for("MultiPolygon"===v&&(m=0),n=0;n<_[r].length;n++){for(o=0;o<_[r][n].length-C;o++){if(!1===t(_[r][n][o],s,h,g,m))return!1;s++}m++}g++}break;case"GeometryCollection":for(r=0;r<y.geometries.length;r++)if(!1===w(y.geometries[r],t,i))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}function s(e){return e&&e.constructor===Object}var a=function(e,t){if(!s(t=t||{}))throw new Error("options is invalid");var i=t.precision,n=t.coordinates,t=t.mutate,i=null==i||isNaN(i)?6:i,n=null==n||isNaN(n)?3:n;if(!e)throw new Error("<geojson> is required");if("number"!=typeof i)throw new Error("<precision> must be a number");if("number"!=typeof n)throw new Error("<coordinates> must be a number");!1!==t&&void 0!==t||(e=JSON.parse(JSON.stringify(e)));var o=Math.pow(10,i);return w(e,function(e){var t=e,i=o,e=n;t.length>e&&t.splice(e,t.length);for(var r=0;r<t.length;r++)t[r]=Math.round(t[r]*i)/i}),e};function l(e,t,i){var r={type:"Feature"};return 0!==(i=void 0===i?{}:i).id&&!i.id||(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.properties=t||{},r.geometry=e,r}function u(e){return"Feature"===e.type?e.geometry:e}class c{static transformCartesian3(e){e=n.Z.getGlobalCartesian().toGeographic(e);return[e.lng,e.lat]}static bboxToCartesian3(e){e=[[e[0],e[1]],[e[2],e[1]],[e[2],e[3]],[e[0],e[3]]];return n.Z.getGeographic().toCartesianArray(e)}static point(e){return r.point(c.transformCartesian3(e))}static lineString(e){return r.lineString(c.transformCoordsArray(e))}static polygon(e){e=JSON.parse(JSON.stringify(e)),e=c.closePolygeoCartesian3s(e);return r.polygon([c.transformCoordsArray(e)])}static feature(e){return 2==e.length?c.lineString(e):2<e.length?c.polygon(e):c.point(e)}static getArea(e){return r.area(e)}static getCenter(e){var e=r.center(e),t=r.getCoord(e);return{geometry:e,coor:t,cartesian3:Cesium.Cartesian3.fromDegrees(t[0],t[1])}}static getCenterCartesian3s(e){e=c.feature(e);return c.getCenter(e).cartesian3}static getCoords(e){return r.getCoords(e)}static getCoordsCartesian3(e){return c.getCoords(e).map(e=>e.map(e=>n.Z.getGeographic().toCartesianArray(e)))}static transformCoordsArray(e){return n.Z.getGlobalCartesian().toGeographicArray(e).map(e=>[e.lng,e.lat])}static featurecoorToWfsWGS84Stsring(e){var t=c.turf.getCoords(e);if("Point"===e.geometry.type)return t.join();if("LineString"===e.geometry.type)return t.reduce((e,t)=>e.join()+" "+t.join());if("Polygon"===e.geometry.type){let i="";return t.forEach(t=>{if(t.length%2!=0){for(let e=0;e<t.length-1;e++)i+=t[e].join()+" "+t[e+1].join()+" ",e++;i+=t[t.length-1].join()}else for(let e=0;e<t.length;e++)i+=t[e].join()+" "+t[e+1].join()+" ",e++}),i}}static intersect(e,t){return r.intersect(r.polygon(e),r.polygon(t))}static intersect2(e,t){var e=u(e),t=u(t),i=new o.GeoJSONReader,e=i.read(a(e)),i=i.read(a(t)),t=o.OverlayOp.intersection(e,i);return t.isEmpty()?null:l((new o.GeoJSONWriter).write(t))}static booleanContains(e,t){return r.booleanContains(e,t)}static intersectCartesian3s(e,t){return r.intersect(c.polygon(e),c.polygon(t))}static lineIntersectCartesian3s(e,t){return 0<r.lineIntersect(c.feature(e),c.feature(t)).features.length}static booleanContainsByCartesian3s(e,t){return c.booleanContains(c.feature(e),c.feature(t))}static nearestPointOnLineCartesian32d(e,t,i){e=c.point(e),t=c.lineString([t,i]),i=r.nearestPointOnLine(t,e,{units:"kilometers"}),t=r.getCoord(i);return Cesium.Cartesian3.fromDegrees(t[0],t[1])}static nearestPointOnLineCartesian33d(e,t,i){e=c.nearestPointOnLineCartesian32d(e,t,i),e=r.distance(c.point(e),c.point(t))/r.distance(c.point(t),c.point(i),{units:"kilometers"}),i=Cesium.Cartesian3.subtract(i,t,new Cesium.Cartesian3),i=Cesium.Cartesian3.multiplyByScalar(i,e,new Cesium.Cartesian3);return Cesium.Cartesian3.add(i,t,new Cesium.Cartesian3)}static closePolygeoCartesian3s(e){return Cesium.Cartesian3.equals(e[0],e[e.length-1])||e.push(e[0]),e}static isPointInPolygon(e,t){e=this.point(e),t=this.polygon(t);return r.booleanPointInPolygon(e,t)}static getLineStepPoints(e,t,i="meters"){e=c.turf.lineChunk(c.lineString(e),t,{units:i}).features.map(e=>{e=c.turf.getCoords(e);return Cesium.Cartesian3.fromDegrees(e[0][0],e[0][1])});return console.log(e),e}}for(var h=[t],A=0;A<h.length;A++)for(var p=h[A].getExportMethods(),f=0;f<p.length;f++)c[p[f]]=h[A][p[f]];c.turf=r;var d=c},9745:function(e,t,i){"use strict";i.d(t,{Z:function(){return m}});var r=class{constructor(){}toCartesian(e){e=Cesium.Cartesian3.fromDegrees(e.lng,e.lat,e.alt);return{x:e.x,y:e.y,z:e.z}}toCartesianArray(e){return e[0].lng&&e[0].lat?e.map(e=>this.toCartesian(e)):2==e[0].length?e.map(e=>Cesium.Cartesian3.fromDegrees(e[0],e[1])):3==e[0].length?e.map(e=>Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2])):void 0}fromCartesian(e){e=new Cesium.Cartesian3(e.x,e.y,e.z),e=Cesium.Cartographic.fromCartesian(e);return{lat:Cesium.Math.toDegrees(e.latitude),lng:Cesium.Math.toDegrees(e.longitude),alt:e.height}}};var n=class{constructor(){}toCartesian(e){return Cesium.Cartographic.toCartesian(e)}toGeographic(e){var t=Cesium.Math.toDegrees(e.latitude);return{lng:Cesium.Math.toDegrees(e.longitude),lat:t,alt:e.height}}toWebMercator(e,t){return t=t||CIM.viewer,new Cesium.WebMercatorProjection(t.scene.globe.ellipsoid).project(e)}};var o=class{constructor(){}toCartographic(e){return Cesium.Cartographic.fromCartesian(e)}toGeographic(e){e=Cesium.Cartographic.fromCartesian(e);return(new n).toGeographic(e)}toWebMercator(e,t){t=t||CIM.viewer;e=Cesium.Cartographic.fromCartesian(e);return(new n).toWebMercator(e,t)}toScreen(e,t){return t=t||CIM.viewer,Cesium.SceneTransforms.wgs84ToWindowCoordinates(t.scene,e,new Cesium.Cartesian2)}toCartographicArray(e){return e.map(e=>this.toCartographic(e))}toGeographicArray(e){return e.map(e=>this.toGeographic(e))}changePointHeight(e,t){e=this.toGeographic(e);return e.alt=t,(new r).toCartesian(e)}changePointAddHeight(e,t){e=this.toGeographic(e);return e.alt+=t,(new r).toCartesian(e)}};var s=class{constructor(e){e instanceof Cesium.Matrix4?this._transform=e:e instanceof Cesium.Cartesian3&&(this._transform=Cesium.Transforms.eastNorthUpToFixedFrame(e)),this._transform&&(this._transformInverse=Cesium.Matrix4.inverse(this._transform,new Cesium.Matrix4))}toGlobalCartesian(e){return Cesium.Matrix4.multiplyByPoint(this._transform,e,new Cesium.Cartesian3)}toGlobalCartesianArray(e){return e.map(e=>this.toGlobalCartesian(e))}fromGlobalCartesian(e){return Cesium.Matrix4.multiplyByPoint(this._transformInverse,e,new Cesium.Cartesian3)}fromGlobalCartesianArray(e){return e.map(e=>this.fromGlobalCartesian(e))}};var a=class{constructor(){}toCartesian(e,t){e=(t=t||CIM.viewer).camera.getPickRay(e);return t.scene.globe.pick(e,t.scene)}toWebMercator(e,t){t=t||CIM.viewer;e=this.toCartesian(e,t);return(new o).toWebMercator(e,t)}fromCartesian(e,t){return(new o).toScreen(e,t)}};var l=class{constructor(){}toCartographic(e,t){return t=t||CIM.viewer,new Cesium.WebMercatorProjection(t.scene.globe.ellipsoid).unproject(e)}toCartesian(e,t){t=t||CIM.viewer;e=this.toCartographic(e,t);return(new n).toCartesian(e)}};var c=class{constructor(){this.CenterL_GuangZhou=113.18,this.CenterL_ZhuHai=113.55,this.ellip_CGCS2000={a:6378137,b:6356752.31414,f:1/298.257222101},this.ProjectionPara={CenterL:114,ZoneWide:3,ZoneNo:38,False_Easting:5e5,False_Northing:0}}toLngLat(e,t,i,r){for(var n,o=t,t=e,r=Object.assign({},this.ellip_CGCS2000,r),e=("string"==typeof i&&(i=this._wktToObj(i)),Object.assign({},this.ProjectionPara,i)),i=r.a||0,r=(r.b,r.f||0),r=Math.sqrt(2*r-Math.pow(r,2)),s=r/Math.sqrt(1-r*r),a=1+.75*Math.pow(r,2)+45/64*Math.pow(r,4)+175/256*Math.pow(r,6)+11025/16384*Math.pow(r,8)+43659/65536*Math.pow(r,10)+693693/1048576*Math.pow(r,12),l=3/8*Math.pow(r,2)+15/32*Math.pow(r,4)+525/1024*Math.pow(r,6)+2205/4096*Math.pow(r,8)+72765/131072*Math.pow(r,10)+297297/524288*Math.pow(r,12),u=15/256*Math.pow(r,4)+105/1024*Math.pow(r,6)+2205/16384*Math.pow(r,8)+10395/65536*Math.pow(r,10)+1486485/8388608*Math.pow(r,12),c=35/3072*Math.pow(r,6)+105/4096*Math.pow(r,8)+10395/262144*Math.pow(r,10)+55055/1048576*Math.pow(r,12),h=(Math.pow(r,8),Math.pow(r,10),Math.pow(r,12),Math.pow(r,10),Math.pow(r,12),Math.pow(r,12),i*(1-Math.pow(r,2))*a*Math.PI/180),A=i*(1-Math.pow(r,2))*l,p=i*(1-Math.pow(r,2))*u,f=i*(1-Math.pow(r,2))*c,d=o/h;d=(n=d)*Math.PI/180,d=(o-(-A*Math.sin(2*d)+p*Math.sin(4*d)-f*Math.sin(6*d)))/h,!(Math.abs(d-n)<1e-7););var d=d*Math.PI/180,a=Math.pow(s,2)*Math.pow(Math.cos(d),2),l=Math.tan(d),u=Math.sqrt(1-Math.pow(r*Math.sin(d),2)),c=i*(1-Math.pow(r,2))/Math.pow(u,3),s=(t=t%1e6-e.False_Easting%1e6)/(i/u),r=e.ZoneWide||3,i=e.ZoneNo||parseInt(g/r)+1,u=e.CenterL||i*r-r/2,e=m.toRadians(u)+(s-(1+2*l*l+a)*Math.pow(s,3)/6+(5+28*l*l+24*Math.pow(l,4)+6*a+8*a*Math.pow(l,2))*Math.pow(s,5)/120)/Math.cos(d),g=Math.round(1e11*m.toDegrees(e,!1))/1e11,i=d-l/(2*c)*t*s*(1-(5+3*l*l+a-9*a*Math.pow(l,2))*Math.pow(s,2)/12+(61+90*l*l+45*Math.pow(l,4))*Math.pow(s,4)/360);return{lng:g,lat:Math.round(1e11*m.toDegrees(i,!1))/1e11}}fromLngLat(e,t,i,r){"string"==typeof i&&(i=this._wktToObj(i));var r=Object.assign({},this.ellip_CGCS2000,r),i=Object.assign({},this.ProjectionPara,i),n=r.a||0,r=(r.b,r.f||0),o=i.ZoneWide||3,s=i.ZoneNo||parseInt(e/o)+1,s=i.CenterL||s*o-o/2,o=Math.sqrt(2*r-Math.pow(r,2)),r=o/Math.sqrt(1-o*o),t=m.toRadians(t,!1),e=m.toRadians(e,!1),r=Math.pow(r,2)*Math.pow(Math.cos(t),2),a=Math.tan(t),l=Math.sqrt(1-Math.pow(o*Math.sin(t),2)),l=(Math.pow(o,2),Math.pow(l,3),n/l),e=e-m.toRadians(s,!1),s=Math.pow(e,2),u=n*(1-Math.pow(o,2))*(1.00505250559297*t-.00253155620900066*Math.sin(2*t)+265690155540381e-20*Math.sin(4*t)-3.47007559905787e-9*Math.sin(6*t)+491654216666515e-26*Math.sin(8*t)-726313725279022e-29*Math.sin(10*t)+107400991193683e-31*Math.sin(12*t)),n=(u=n*(1-Math.pow(o,2))*(1.00505250559297*t-.00253155620900066*Math.sin(2*t)+265690155540381e-20*Math.sin(4*t)),Math.pow(Math.cos(t),2),Math.pow(r,2),Math.pow(Math.cos(t),2),Math.pow(a,4),Math.pow(Math.cos(t),4),Math.pow(s,2),u+l*Math.sin(t)*Math.cos(t)*s*(.5+(5-a*a+9*r+4*Math.pow(r,2))*Math.pow(Math.cos(t),2)*s/24+(61-58*a*a+Math.pow(a,4))/720*Math.pow(Math.cos(t),4)*Math.pow(s,2))),o=l*Math.cos(t)*e*(1+(1-a*a+r)*Math.pow(Math.cos(t),2)*s/6+(5-18*a*a+Math.pow(a,4)+14*r-58*r*a*a)*Math.pow(Math.cos(t),4)*Math.pow(s,2)/120);return{X:o+=i.False_Easting,Y:n}}_wktToObj(e){var e=e.split(/[\s\,\"\[\]]+/),t={},e=(t.CenterL=parseFloat(this._findStringInWKT(e,"Central_Meridian")||0),t.False_Easting=parseFloat(this._findStringInWKT(e,"False_Easting")||0),t.False_Northing=parseFloat(this._findStringInWKT(e,"False_Northing")||0),this._findStringInWKT(e,"PROJCS")),e=(-1===e.indexOf("3_Degree")?t.ZoneWide=6:t.ZoneWide=3,e.split("_"));return-1===e.indexOf("Zone")?t.ZoneNo=3==t.ZoneWide?t.CenterL/3:(t.CenterL+3)/6:t.ZoneNo=e[e.length-1],t}_findStringInWKT(e,t){t=e.indexOf(t);if(0<=t)return e[t+1]}};var u=class{constructor(){this.ellip_CGCS200={a:6378137,b:6356752.31414,f:1/298.257222101,e:.0818191910428},this.ProjectionPara={CenterL:113.2833333333,ZoneWide:3,ZoneNo:38,False_Easting:5e5,False_Northing:0},this.fourTransPra={scale:.999997756396785,rotationAngle:.0044099861111111,DX:-199995.893159972,DY:-16.6491077492992}}toCGCS2000LngLat(e,t){e=this.toCGCS2000XY(e,t);return(new c).toLngLat(e.X,e.Y,this.ProjectionPara,this.ellip_CGCS200)}toCGCS2000XY(e,t){var i={X:e,Y:t},r=i.X,i=i.Y-2e5,n=this.fourTransPra.scale,o=this.fourTransPra.rotationAngle*Math.PI/180,s=this.fourTransPra.DX,a=this.fourTransPra.DY,l=n*Math.cos(o),n=n*Math.sin(o);return e=(l*i+n*r-l*s-n*a)/(Math.pow(l,2)+Math.pow(n,2)),{X:(t=(l*r-n*i+n*s-l*a)/(Math.pow(l,2)+Math.pow(n,2)))+460020,Y:e+2329620}}fromCGCS2000LngLat(e,t){e=(new c).fromLngLat(e,t,this.ProjectionPara,this.ellip_CGCS200);return this.fromCGCS2000XY(e.X,e.Y)}fromCGCS2000XY(e,t){var i={X:e-460020,Y:t-2329620},r=i.Y,i=i.X,n=this.fourTransPra.scale,o=this.fourTransPra.rotationAngle*Math.PI/180,s=this.fourTransPra.DX,a=this.fourTransPra.DY,l=n*Math.cos(o),n=n*Math.sin(o);return{X:t=l*i+n*r+a,Y:(e=l*r-n*i+s)+2e5}}};var h=class{constructor(){}toGCJ02(e,t){var i=52.35987755982988,e=(e=+e)-.0065,t=(t=+t)-.006,r=Math.sqrt(e*e+t*t)-2e-5*Math.sin(t*i),t=Math.atan2(t,e)-3e-6*Math.cos(e*i);return{lng:r*Math.cos(t),lat:r*Math.sin(t)}}};var A=class{constructor(){this.ee=.006693421622965943,this.pi=3.141592653589793,this.a=6378245,this.x_pi=52.35987755982988}toBaidu09LngLat(e,t){var i=Math.sqrt(e*e+t*t)+2e-5*Math.sin(t*this.x_pi),t=Math.atan2(t,e)+3e-6*Math.cos(e*this.x_pi);return{lng:i*Math.cos(t)+.0065,lat:i*Math.sin(t)+.006}}toWGS84LngLat(e,t){var i=this._transformlat(e-105,t-35),r=this._transformlng(e-105,t-35),n=t/180*this.pi,o=Math.sin(n),o=1-this.ee*o*o,s=Math.sqrt(o),i=180*i/(this.a*(1-this.ee)/(o*s)*this.pi);return{lng:2*e-(e+180*r/(this.a/s*Math.cos(n)*this.pi)),lat:2*t-(t+i)}}toCGCS2000LngLat(e,t){var i=Math,r=Math.PI,n=(new c).ellip_CGCS2000,o=n.a,n=2*n.f,s=this._transformlat(e-105,t-35),a=this._transformlng(e-105,t-35),l=t/180*r,u=i.sin(l);return s=180*s/(o*(1-n)/((u=1-n*u*u)*(n=i.sqrt(u)))*r),{lng:2*e-(e+180*a/(o/n*i.cos(l)*r)),lat:2*t-(t+s)}}_transformlat(e,t){var i=2*e-100+3*t+.2*t*t+.1*e*t+.2*Math.sqrt(Math.abs(e));return(i+=2*(20*Math.sin(6*e*this.pi)+20*Math.sin(2*e*this.pi))/3)+2*(20*Math.sin(t*this.pi)+40*Math.sin(t/3*this.pi))/3+2*(160*Math.sin(t/12*this.pi)+320*Math.sin(t*this.pi/30))/3}_transformlng(e,t){t=300+e+2*t+.1*e*e+.1*e*t+.1*Math.sqrt(Math.abs(e));return(t+=2*(20*Math.sin(6*e*this.pi)+20*Math.sin(2*e*this.pi))/3)+2*(20*Math.sin(e*this.pi)+40*Math.sin(e/3*this.pi))/3+2*(150*Math.sin(e/12*this.pi)+300*Math.sin(e/30*this.pi))/3}};var m=new class{constructor(){}getGeographic(){return new r}getCartographic(){return new n}getGlobalCartesian(){return new o}getLocalCartesian(e){return new s(e)}getScreen(){return new a}getWebMercator(){return new l}getGaussKruger(){return new c}getGZ2000(){return new u}getBaidu09(){return new h}getGCJ02(){return new A}toRadians(e){return e*Math.PI/180}toDegrees(e){return 180*e/Math.PI}commomCoordinateTransform(e,t){let i,r,n;return e instanceof Cesium.Cartesian3?(i=e,r=this.getGlobalCartesian().toCartographic(e),n=this.getGlobalCartesian().toGeographic(e)):e instanceof Cesium.Cartographic?(i=this.getCartographic().toCartesian(e),r=e,n=this.getGlobalCartesian().toGeographic(i)):"lat"in e&&"lng"in e?(i=this.getGeographic().toCartesian(e),r=this.getGlobalCartesian().toCartographic(i),n=e):e instanceof Cesium.Matrix4?(i=Cesium.Matrix4.getTranslation(e,new Cesium.Cartesian3),r=this.getGlobalCartesian().toCartographic(i),n=this.getGlobalCartesian().toGeographic(i)):e instanceof Cesium.Cartesian2&&(i=this.getScreen().toCartesian(t,e))&&(r=this.getGlobalCartesian().toCartographic(i),n=this.getGlobalCartesian().toGeographic(i)),{cartesian3:i,cartographic:r,geographic:n}}Cartesian3_to_WGS84(e){console.warn("本方法将在1.3.0删除。请使用getGlobalCartesian()进行转换");e=new Cesium.Cartesian3(e.x,e.y,e.z),e=Cesium.Cartographic.fromCartesian(e);return{lat:Cesium.Math.toDegrees(e.latitude),lng:Cesium.Math.toDegrees(e.longitude),alt:e.height}}WGS84_to_Cartesian3(e){console.warn("本方法将在1.3.0删除。请使用getGeographic()进行转换");e=Cesium.Cartesian3.fromDegrees(e.lng,e.lat,e.alt);return{x:e.x,y:e.y,z:e.z}}cartographicToCartesian(e){return console.warn("本方法将在1.3.0删除。请使用getCartographic()进行转换"),Cesium.Cartographic.toCartesian(e)}cartesian3ToCartographic(e,t="Radians"){var i;return console.warn("本方法将在1.3.0删除。请使用getGlobalCartesian()进行转换"),"Radians"==t?i=Cesium.Cartographic.fromCartesian(e):"Degrees"==t&&(i=Cesium.Cartographic.fromCartesian(e),i=this.degreeCartographic(i)),i}cartesian3ToCartographicMany(e,t="Degrees"){return console.warn("本方法将在1.3.0删除。请使用getGlobalCartesian()进行转换"),e.map(e=>this.cartesian3ToCartographic(e,t))}WGS84ArraysToCartesian3(e){return console.warn("本方法将在1.3.0删除。请使用getGeographic()进行转换"),e.map(e=>Cesium.Cartesian3.fromDegrees(e[0],e[1]))}WGS84s_to_Cartesian3(e){return console.warn("本方法将在1.3.0删除。请使用getGeographic()进行转换"),e.map(e=>this.getGeographic().toCartesian(e))}cartographicToCartesian3(e){return console.warn("本方法将在1.3.0删除。请使用getCartographic()进行转换"),e.longitude?Cesium.Cartesian3.fromRadians(e.longitude,e.latitude,e.height):Cesium.Cartesian3.fromDegrees(e.lng,e.lat,e.alt)}cartographicToMercatorCartesian3(e,t){return console.warn("本方法将在1.3.0删除。请使用getCartographic()进行转换"),new Cesium.WebMercatorProjection(e.scene.globe.ellipsoid).project(t)}mercatorCartesian3ToCartographic(e,t){return console.warn("本方法将在1.3.0删除。请使用getWebMercator()进行转换"),new Cesium.WebMercatorProjection(e.scene.globe.ellipsoid).unproject(t)}cartesianToMercator(e,t){console.warn("本方法将在1.3.0删除。请使用getGlobalCartesian()进行转换");t=Cesium.Cartographic.fromCartesian(t);return this.cartographicToMercatorCartesian3(e,t)}mercatorToCartesian(e,t){console.warn("本方法将在1.3.0删除。请使用getWebMercator()进行转换");t=new Cesium.Cartesian3(t.x,t.y,t.z),e=this.mercatorCartesian3ToCartographic(e,t),t=this.degreeCartographic(e);return Cesium.Cartesian3.fromDegrees(t.lng,t.lat,t.alt)}degreeCartographic(e){console.warn("本方法将在1.3.0删除。请使用getCartographic()进行转换");var t=Cesium.Math.toDegrees(e.latitude);return{lng:Cesium.Math.toDegrees(e.longitude),lat:t,alt:e.height}}changePointHeight(e,t){console.warn("本方法将在1.3.0删除。请使用getGlobalCartesian()进行转换");e=this.cartesian3ToCartographic(e,"Degrees");return e.alt=t,this.cartographicToCartesian3(e)}changePointAddHeight(e,t){console.warn("本方法将在1.3.0删除。请使用getGlobalCartesian()进行转换");e=this.cartesian3ToCartographic(e,"Degrees");return e.alt+=t,this.cartographicToCartesian3(e)}cartesian3sToWfsWGS84Stsring(e){console.warn("本方法将在1.3.0删除。请使用agcim.wfs.WFSQueryHelper()进行转换");e=e.map(e=>this.getGlobalCartesian().toGeographic(e));{var i=e;let t="";for(let e=0;e<i.length;e++)t+=i[e].lng+","+i[e].lat+" ";return t}}}},7014:function(e,t,i){"use strict";i.d(t,{Z:function(){return P}});var t=i(7017),n=i(9745);var r=class{encode(e,t){}decode(e,t){}};var o=new class extends r{constructor(){super(),this.MINLAT=-90,this.MAXLAT=90,this.MINLNG=-180,this.MAXLNG=180,this.numbits=15,this.minLat,this.minLng,this.digits=["0","1","2","3","4","5","6","7","8","9","b","c","d","e","f","g","h","j","k","m","n","p","q","r","s","t","u","v","w","x","y","z"],this.setMinLatLng()}computeGeoHash(e){for(var t=[],i=this.getExtend(e),r=(i.maxX-i.minX)/this.minLng,n=(i.maxY-i.minY)/this.minLat,o=0;o<n;o++)for(var s=0;s<r;s++){var a=i.minX+this.minLng*s,l=i.minY+this.minLat*o,l=this.encode(l,a);t.push(l)}return t}encode(e,t){for(var i=this.getBits(e,-90,90),r=this.getBits(t,-180,180),n=[],o=0;o<this.numbits;o++)n.push(r[o]),n.push(i[o]);return this.getBase32(n.join(""))}decode(e){for(var t="",i=0;i<e.length;i++){for(var r=e.substring(i,i+1),n=this.digits.indexOf(r).toString(2);n.length<5;)n="0"+n;t+=n}for(var o=t.split(""),s=[],a=[],i=0;i<2*this.numbits;i+=2)s.push(o[i]);for(i=1;i<2*this.numbits;i+=2)a.push(o[i]);var l=this.getDegree(s,-180,180),u=this.getDegree(a,-90,90);return new Cesium.Cartesian2(l,u)}getDegree(e,t,i){for(var r,n=0;n<e.length;n++)r=(t+i)/2,"1"==e[n]?t=r:i=r;return t}setMinLatLng(){this.minLat=this.MAXLAT-this.MINLAT;for(var e=0;e<this.numbits;e++)this.minLat/=2;this.minLng=this.MAXLNG-this.MINLNG;for(e=0;e<this.numbits;e++)this.minLng/=2}getBits(e,t,i){for(var r=[],n=0;n<this.numbits;n++){var o=(t+i)/2;o<=e?(r.push(1),t=o):(r.push(0),i=o)}return r.join("")}getBase32(e){for(var t=[],i=0;i<2*this.numbits/5;i++){var r=e.substring(5*i,5*(i+1)),r=parseInt(r,2),r=this.digits[r];t.push(r)}return t.join("")}getGrid(e,t,i){for(var r=0;r<this.numbits;r++){var n=(t+i)/2;n<=e?t=n:i=n}return{min:t,max:i}}getExtend(e){var t=this.getGrid(e.minX,-180,180).min,i=this.getGrid(e.maxX,-180,180).max,r=this.getGrid(e.minY,-90,90).min;return{maxX:i,maxY:this.getGrid(e.maxY,-90,90).max,minX:t,minY:r}}},s=i(4764);var a=new class{constructor(){this.ellip_CGCS200={a:6378137,b:6356752.31414,f:1/298.257222101},this.ProjectionPara={CenterL:113.2833333333,ZoneWide:3,ZoneNo:38,False_Easting:5e5,False_Northing:0},this.fourTransPra={scale:.999997756396785,rotationAngle:.0044099861111111,DX:-199995.893159972,DY:-16.6491077492992}}BL2XY(e,t,i,r){console.warn("本方法将在1.3.0删除。请使用coordinate.getGaussKruger()进行转换");var i=Object.assign({},this.ellip_CGCS200,i),r=Object.assign({},this.ProjectionPara,r),n=i.a||0,i=(i.b,i.f||0),o=r.ZoneWide||3,s=r.ZoneNo||parseInt(t/o)+1,s=r.CenterL||s*o-o/2,o=Math.sqrt(2*i-Math.pow(i,2)),i=o/Math.sqrt(1-o*o),i=(e=this.Degree2Radian(e,!1),t=this.Degree2Radian(t,!1),Math.pow(i,2)*Math.pow(Math.cos(e),2)),a=Math.tan(e),l=Math.sqrt(1-Math.pow(o*Math.sin(e),2)),l=(Math.pow(o,2),Math.pow(l,3),n/l),t=t-this.Degree2Radian(s,!1),s=Math.pow(t,2),u=n*(1-Math.pow(o,2))*(1.00505250559297*e-.00253155620900066*Math.sin(2*e)+265690155540381e-20*Math.sin(4*e)-3.47007559905787e-9*Math.sin(6*e)+491654216666515e-26*Math.sin(8*e)-726313725279022e-29*Math.sin(10*e)+107400991193683e-31*Math.sin(12*e)),n=(u=n*(1-Math.pow(o,2))*(1.00505250559297*e-.00253155620900066*Math.sin(2*e)+265690155540381e-20*Math.sin(4*e)),Math.pow(Math.cos(e),2),Math.pow(i,2),Math.pow(Math.cos(e),2),Math.pow(a,4),Math.pow(Math.cos(e),4),Math.pow(s,2),u+l*Math.sin(e)*Math.cos(e)*s*(.5+(5-a*a+9*i+4*Math.pow(i,2))*Math.pow(Math.cos(e),2)*s/24+(61-58*a*a+Math.pow(a,4))/720*Math.pow(Math.cos(e),4)*Math.pow(s,2))),o=l*Math.cos(e)*t*(1+(1-a*a+i)*Math.pow(Math.cos(e),2)*s/6+(5-18*a*a+Math.pow(a,4)+14*i-58*i*a*a)*Math.pow(Math.cos(e),4)*Math.pow(s,2)/120);return{X:o+=r.False_Easting,Y:n}}G2000BLtoGZ2000XYZ(e,t,i,r){console.warn("本方法将在1.3.0删除。请使用coordinate.getGZ2000()进行转换");e=this.BL2XY(e,t,i,r);return this.G2000XYtoGZ2000XYZ(e.X,e.Y,i,r)}G2000XYtoGZ2000XYZ(e,t,i,r){return console.warn("本方法将在1.3.0删除。请使用coordinate.getGZ2000()进行转换"),this.G2000XYtoGZ2000XYZTransformPoint({X:e-460020,Y:t-2329620})}G2000XYtoGZ2000XYZTransformPoint(e){var t=e.Y,e=e.X,i=this.fourTransPra.scale,r=this.fourTransPra.rotationAngle*Math.PI/180,n=this.fourTransPra.DX,o=this.fourTransPra.DY,s=i*Math.cos(r),i=i*Math.sin(r);return{X:s*e+i*t+o,Y:s*t-i*e+n+2e5}}GZ2000XYtoG2000XYZTransformPoint(e,t){var i={X:e,Y:t},r=i.X,i=i.Y-2e5,n=this.fourTransPra.scale,o=this.fourTransPra.rotationAngle*Math.PI/180,s=this.fourTransPra.DX,a=this.fourTransPra.DY,l=n*Math.cos(o),n=n*Math.sin(o);return e=(l*i+n*r-l*s-n*a)/(Math.pow(l,2)+Math.pow(n,2)),{X:t=(l*r-n*i+n*s-l*a)/(Math.pow(l,2)+Math.pow(n,2)),Y:e}}GZ2000XYtoG2000XYZ(e,t,i,r){console.warn("本方法将在1.3.0删除。请使用coordinate.getGZ2000()进行转换");e=this.GZ2000XYtoG2000XYZTransformPoint(e,t);return{X:e.X+460020,Y:e.Y+2329620}}GZ2000XYtoG2000BL(e,t,i,r){console.warn("本方法将在1.3.0删除。请使用coordinate.getGZ2000()进行转换");e=this.GZ2000XYtoG2000XYZ(e,t,i,r);return this.XY2BL(e.X,e.Y,i,r)}XY2BL(e,t,i,r){console.warn("本方法将在1.3.0删除。请使用coordinate.getGaussKruger()进行转换");for(var n,o=t,t=e,i=Object.assign({},this.ellip_CGCS200,i),r=Object.assign({},this.ProjectionPara,r),e=i.a||0,i=(i.b,i.f||0),i=Math.sqrt(2*i-Math.pow(i,2)),s=i/Math.sqrt(1-i*i),a=1+.75*Math.pow(i,2)+45/64*Math.pow(i,4)+175/256*Math.pow(i,6)+11025/16384*Math.pow(i,8)+43659/65536*Math.pow(i,10)+693693/1048576*Math.pow(i,12),l=3/8*Math.pow(i,2)+15/32*Math.pow(i,4)+525/1024*Math.pow(i,6)+2205/4096*Math.pow(i,8)+72765/131072*Math.pow(i,10)+297297/524288*Math.pow(i,12),u=15/256*Math.pow(i,4)+105/1024*Math.pow(i,6)+2205/16384*Math.pow(i,8)+10395/65536*Math.pow(i,10)+1486485/8388608*Math.pow(i,12),c=35/3072*Math.pow(i,6)+105/4096*Math.pow(i,8)+10395/262144*Math.pow(i,10)+55055/1048576*Math.pow(i,12),h=(Math.pow(i,8),Math.pow(i,10),Math.pow(i,12),Math.pow(i,10),Math.pow(i,12),Math.pow(i,12),e*(1-Math.pow(i,2))*a*Math.PI/180),A=e*(1-Math.pow(i,2))*l,p=e*(1-Math.pow(i,2))*u,f=e*(1-Math.pow(i,2))*c,d=o/h;d=(n=d)*Math.PI/180,d=(o-(-A*Math.sin(2*d)+p*Math.sin(4*d)-f*Math.sin(6*d)))/h,!(Math.abs(d-n)<1e-7););var d=d*Math.PI/180,a=Math.pow(s,2)*Math.pow(Math.cos(d),2),l=Math.tan(d),u=Math.sqrt(1-Math.pow(i*Math.sin(d),2)),c=e*(1-Math.pow(i,2))/Math.pow(u,3),s=e/u,i=r.ZoneWide||3,e=r.ZoneNo||parseInt(g/i)+1,u=r.CenterL||e*i-i/2,i=(t=1e6<t?t-1e6*e-r.False_Easting%1e6:t%1e6-r.False_Easting%1e6)/s,e=this.Degree2Radian(u,!1)+(i-(1+2*l*l+a)*Math.pow(i,3)/6+(5+28*l*l+24*Math.pow(l,4)+6*a+8*a*Math.pow(l,2))*Math.pow(i,5)/120)/Math.cos(d),g=Math.round(1e11*this.Radian2Degree(e,!1))/1e11,r=d-l/(2*c)*t*i*(1-(5+3*l*l+a-9*a*Math.pow(l,2))*Math.pow(i,2)/12+(61+90*l*l+45*Math.pow(l,4))*Math.pow(i,4)/360);return{B:Math.round(1e11*this.Radian2Degree(r,!1))/1e11,L:g}}gcj02toG2000(e,t){var i,r,n,o=Math,s=Math.PI,a=this.ellip_CGCS200,l=a.a,a=2*a.f;return n=2*(i=e-105)-100+3*(r=t-35)+.2*r*r+.1*i*r+.2*Math.sqrt(Math.abs(i)),i=(n+=2*(20*Math.sin(6*i*s)+20*Math.sin(2*i*s))/3)+2*(20*Math.sin(r*s)+40*Math.sin(r/3*s))/3+2*(160*Math.sin(r/12*s)+320*Math.sin(r*s/30))/3,n=function(e,t){t=300+e+2*t+.1*e*e+.1*e*t+.1*o.sqrt(o.abs(e));return(t+=2*(20*o.sin(6*e*s)+20*o.sin(2*e*s))/3)+2*(20*o.sin(e*s)+40*o.sin(e/3*s))/3+2*(150*o.sin(e/12*s)+300*o.sin(e/30*s))/3}(e-105,t-35),i=180*i/(l*(1-a)/((a=1-a*(a=o.sin(r=t/180*s))*a)*(a=o.sqrt(a)))*s),[2*e-(e+180*n/(l/a*o.cos(r)*s)),2*t-(t+i)]}bd09togcj02(e,t){var i=52.35987755982988,e=(e=+e)-.0065,t=(t=+t)-.006,r=Math.sqrt(e*e+t*t)-2e-5*Math.sin(t*i),t=Math.atan2(t,e)-3e-6*Math.cos(e*i);return[r*Math.cos(t),r*Math.sin(t)]}Degree2Radian(e,t){return(e=t?this.Ang60ToAng100(e):e)*Math.PI/180}Ang60ToAng100(e){Ang2Ms(e);return Math.round()}Radian2Degree(e,t){e=180*e/Math.PI;return e=1==t?Ang100ToAng60(e):e}};var l=class{constructor(e,t){this.levelIndex=e,this.longitudeSplit=t[0],this.latitudeSplit=t[1]}getSplit(e){return 0==e?this.longitudeSplit:this.latitudeSplit}};var c=class{constructor(e,t,i){this.minLon=e.lng,this.minLat=e.lat,this.maxLon=t.lng,this.maxLat=t.lat,this.minAlt=null==e.alt?0:e.alt,this.maxAlt=null==t.alt?0:t.alt,this.isDegree=i}toRadians(){var e,t;return this.isDegree&&(e=Cesium.Cartographic.fromDegrees(this.minLon,this.minLat),t=Cesium.Cartographic.fromDegrees(this.maxLon,this.maxLat),this.minLon=e.longitude,this.minLat=e.latitude,this.maxLon=t.longitude,this.maxLat=t.latitude,this.isDegree=!1),this}CartesiantoDegrees(e,t){e=n.Z.getWgs84().formCartesian3(e),t=n.Z.getWgs84().formCartesian3(t);return this.minLon=e.lng,this.minLat=e.lat,this.maxLon=t.lng,this.maxLat=t.lat,this.minAlt=e.alt,this.maxAlt=t.alt,this.isDegree=!0,this}getCenter(){var e,t,i,r;if(this.isDegree)return r=Cesium.Cartographic.fromDegrees(this.minLon,this.minLat,this.minAlt),e=.5*((i=Cesium.Cartographic.fromDegrees(this.maxLon,this.maxLat,this.maxAlt)).longitude+r.longitude),t=.5*(i.latitude+r.latitude),i=.5*(i.height+r.height),r=new Cesium.Cartographic(e,t,i),n.Z.getCartographic().toGeographic(r)}getLongitudeSpan(){return Math.abs(this.maxLon-this.minLon)}getLatitudeSpan(){return Math.abs(this.maxLat-this.minLat)}getHeigthSpan(){return Math.abs(this.maxAlt-this.minAlt)}};var u=class{constructor(e,t){e=new c({lng:e.minLon,lat:e.minLat,alt:e.minAlt},{lng:e.maxLon,lat:e.maxLat,alt:e.maxLat},!0);this.boundingBox=e.toRadians(),t&&11<=t.length?this.meshArray=t:this.meshArray=[[90,44],[6,4],[.5,.5],[.25,10/60],[1/60,1/60],[4/3600,4/3600],[2/3600,2/3600],[1/14400,1/14400],[1/115200,1/115200*2],[1/921600,1/921600],[1/7372800,1/7372800]]}judgeLodMesh(e){for(var t=this.boundingBox.getLongitudeSpan(),i=this.boundingBox.getLatitudeSpan(),r=10,n=10,o=0;o<this.meshArray.length;o++)if(t>=agcim.maths.coordinate.toRadians(this.meshArray[o][0])){r=o;break}for(o=0;o<this.meshArray.length;o++)if(i>=agcim.maths.coordinate.toRadians(this.meshArray[o][1])){n=o;break}var s=0,s=e?r<n?r:n:r<n?n:r;return this.boundingBox.getLatitudeSpan()==Math.PI?new l(0,[90,44]):new l(s,this.meshArray[s])}judgeHeightLodMesh(){for(var e=this.boundingBox.getHeigthSpan(),t=1;t<this.meshArray.length;t++){var i=this.getExtrudeHeight(1,this.meshArray[t][0]),r=this.getExtrudeHeight(1,this.meshArray[t-1][0]);if(i<e&&e<r)return new l(t,this.meshArray[t])}return new l(10,this.meshArray[10])}getExtrudeHeight(e,t){var i=Math.PI/180,t=Number(t);return 6378137*Math.pow(1+i,(e-1)*t)*(Math.pow(1+i,t)-1)}};var p=new class{constructor(){this.coordinate=[],this.corners=[],this.code=[],this.cellNum="ABCDEFGHIJKLMNOPQRSTUV",this.indexNum=[0,6,9,10,14,18,19,22,25,28,31]}getPlanarBeidouCode(e,t,i){this.code=[],this.coordinate=[e[0],e[1]];var e=this,r=[e.computeFirstLod,e.computeSecondeLod,e.computeThirdLod,e.computeForthLod,e.computeFifthLod,e.computeSixthLod,e.computeSeventhLod,e.computeEightthLod,e.computeNinthLod,e.computeTenthLod];if(0==i)for(var n=0;n<10;n++)r[n].apply(this);else for(n=0;n<t;n++)r[n].apply(this);return this.code}computeFirstLod(){0<=this.coordinate[1]?this.code.push("N"):this.code.push("S");var e=Math.abs(parseInt(this.coordinate[1]/4))+1,t=parseInt(this.coordinate[0]/6)+31,t=(this.coordinate[0]<0&&--t,this.code.push(""+t+this.cellNum[e-1]),6*(t-1)-180);this.corners.push([t,4*(e-1)])}computeSecondeLod(){var e=this.corners[this.corners.length-1],e=this.computeCornerAndCell(e,[.5,.5],[12,8]);this.code.push(""+e[0].toString(16)+e[1])}computeThirdLod(){var e=this.corners[this.corners.length-1],e=this.computeCornerAndCell(e,[.25,10/60],[2,3]);this.code.push(e[0]+2*e[1])}computeForthLod(){var e=this.corners[this.corners.length-1],e=this.computeCornerAndCell(e,[1/60,1/60],[15,10]);this.code.push(""+e[0].toString(16)+e[1])}computeFifthLod(){var e=this.corners[this.corners.length-1],e=this.computeCornerAndCell(e,[4/3600,4/3600],[15,15]);this.code.push(""+e[0].toString(16)+e[1].toString(16))}computeSixthLod(){var e=this.corners[this.corners.length-1],e=this.computeCornerAndCell(e,[2/3600,2/3600],[2,2]);this.code.push(e[0]+2*e[1])}computeSeventhLod(){var e=this.corners[this.corners.length-1],e=this.computeCornerAndCell(e,[1/14400,1/14400],[8,8]);this.code.push(""+e[0]+e[1])}computeEightthLod(){var e=this.corners[this.corners.length-1],e=this.computeCornerAndCell(e,[1/115200,1/115200],[8,8]);this.code.push(""+e[0]+e[1])}computeNinthLod(){var e=this.corners[this.corners.length-1],e=this.computeCornerAndCell(e,[1/921600,1/921600],[8,8]);this.code.push(""+e[0]+e[1])}computeTenthLod(){var e=this.corners[this.corners.length-1],e=this.computeCornerAndCell(e,[1/7372800,1/7372800],[8,8]);this.code.push(""+e[0]+e[1])}computeCornerAndCell(e,t,i){for(var r=0,n=e[0];n<e[0]+i[0]*t[0];n+=t[0]){for(var o=0,s=e[1];s<e[1]+i[1]*t[1];s+=t[1]){var a=this.coordinate[0]>n&&this.coordinate[1]>s,l=this.coordinate[0]<n+t[0]&&this.coordinate[1]<s+t[1];if(a&&l)return this.corners.push([n,s]),[0<=e[0]?r:i[0]-1-r,0<=e[1]?o:i[1]-1-o];o++}r++}}};var f=new class{constructor(){this.indexNum=[0,6,9,10,14,18,19,22,25,28,31]}getHeightBeidouCode(e,t,i){e=this.heightComputeFormula(e,i);return this.handleBeidouHeightCode(t,e.heightMeshNum,e.isdown)}heightComputeFormula(e,t){var i=Math.PI/180,r=!1,e=(t<0&&(t=-t,r=!0),1/e[0]*(Math.log10((t+6378137)/6378137)/Math.log10(1+i)));return{heightMeshNum:parseInt(e),isdown:r}}getHeightBeidouCodeAnOtherMethod(e,t,i){for(var r=!1,n=(i<0&&(i=-i,r=!0),e[0]*Math.PI/180),o=0,s=0,a=Math.pow(2,this.indexNum[t]),l=0;l<a;l++)if(i<=(o+=6378137*n*Math.pow(1+n,l))){s=l;break}return this.handleBeidouHeightCode(t,s,r)}handleBeidouHeightCode(e,t,i){for(var t=new Number(t),r=Array(32).fill(0),n=Array.from(t.toString(2)),o=0,s=n.length-1;0<=s;s--)r[r.length-1-o++]=parseInt(n[s]);var t=r.slice(r.length-(this.indexNum[e]+1),r.length),a=this.convertHeightByBit32(r),e=a.slice(a.length-1-e,a.length);return i&&(e[0]=1),{codeBit:t,codeTrans:e}}convertHeightByBit32(e){var t=e[0],i=e[6]*Math.pow(2,0)+e[5]*Math.pow(2,1)+e[4]*Math.pow(2,2)+e[3]*Math.pow(2,3)+e[2]*Math.pow(2,4)+e[1]*Math.pow(2,5),r=e[9]*Math.pow(2,0)+e[8]*Math.pow(2,1)+e[7]*Math.pow(2,2),n=e[10],o=e[14]*Math.pow(2,0)+e[13]*Math.pow(2,1)+e[12]*Math.pow(2,2)+e[11]*Math.pow(2,3),s=e[18]*Math.pow(2,0)+e[17]*Math.pow(2,1)+e[16]*Math.pow(2,2)+e[15]*Math.pow(2,3),a=e[19],l=e[22]*Math.pow(2,0)+e[21]*Math.pow(2,1)+e[20]*Math.pow(2,2),u=e[25]*Math.pow(2,0)+e[24]*Math.pow(2,1)+e[23]*Math.pow(2,2),c=e[28]*Math.pow(2,0)+e[27]*Math.pow(2,1)+e[26]*Math.pow(2,2),e=e[31]*Math.pow(2,0)+e[30]*Math.pow(2,1)+e[29]*Math.pow(2,2);return[t,i<10?"0"+i:i,r,n,o=o.toString(16).toUpperCase(),s=s.toString(16).toUpperCase(),a,l,u,c,e]}getFullHeightBeidouCode(e){var t=Math.PI/180,i=!1,e=(e<0&&(e=-e,i=!0),Math.log10((e+6378137)/6378137)/Math.log10(1+t)*7372800),e=parseInt(e),t=this.getBits(e);return t[0]=i?1:0,{N_in_32:e,Bits32:t,BeidouHeight:this.getHeightCode(t),codeTrans:this.getHeightCode(t).split("-")}}getBits(e){for(var t=[],i=1,r=0;r<32;r++)t[31-r]=(e&i)>>r,i*=2;return t}getBitsAs0X(e){for(var t="",i=0;i<32;i+=4)t+=e[i]+""+e[i+1]+e[i+2]+e[i+3]+" ";return t}getBitAsInt(e){for(var t=0,i=e.length-1;-1<i;i--)t+=e[i]<<e.length-1-i;return t}getHeightCode(e){var t=this.getBitAsInt([e[29],e[30],e[31]]),i=this.getBitAsInt([e[26],e[27],e[28]]),r=this.getBitAsInt([e[23],e[24],e[25]]),n=this.getBitAsInt([e[20],e[21],e[22]]),o=this.getBitAsInt([e[19]]),s=this.getBitAsInt([e[15],e[16],e[17],e[18]]),a=this.getBitAsInt([e[11],e[12],e[13],e[14]]),l=this.getBitAsInt([e[10]]),u=this.getBitAsInt([e[7],e[8],e[9]]),c=this.getBitAsInt([e[1],e[2],e[3],e[4],e[5],e[6]]);return(this.getBitAsInt([e[0]])+"-"+(c<10?"0"+c:c)+"-"+u+"-"+l+"-"+a+"-"+s+"-"+o+"-"+n+"-"+r+"-"+i+"-"+t).toUpperCase()}},h=i(1752);var A=new class{constructor(){}getElementEntityCode(e,t,i,r){var e=agcim.maths.coordinate.getWgs84().formCartesian3(e),t=agcim.maths.coordinate.getWgs84().formCartesian3(t),n=p.getPlanarBeidouCode([e.lng,e.lat],i.levelIndex,!1),o=p.getPlanarBeidouCode([t.lng,t.lat],i.levelIndex,!1),e=this.judegePlanarCorss(e,t,i),s=[];if(e){for(var t=r.getCenter(),a=p.getPlanarBeidouCode([t.lng,t.lat],i.levelIndex,!1),l=i.levelIndex+1;l<a.length;l++)3==a[l].length?a[l]="XXX":2==a[l].length?a[l]="XX":a[l]="X";return{entityCode:a,leftUpCornerPlanarCode:n,rightDownCornerPlanarCode:o,isCross:e,levelInfo:i}}for(var u=!0,l=0;l<n.length;l++){if(n[l]!=o[l]){u&&n[l][0]==o[l][0]&&(2==n[l].length&&s.push(n[l][0]+"X"),3==n[l].length&&n[l][1]==o[l][1]&&s.push(""+n[l][0]+n[l][1]+"X"),u=!1),u&&2<=n[l].length&&n[l][1]==o[l][1]&&(2==n[l].length&&s.push("X"+n[l][1]),3==n[l].length&&(n[l][2]==o[l][2]?s.push("X"+n[l][1]+n[l][2]):s.push(s.push("XX"+n[l][2]))),u=!1);for(l=s.length;l<n.length;l++)3==n[l].length?s.push("XXX"):2==n[l].length?s.push("XX"):s.push("X");break}s.push(n[l])}return{entityCode:s,leftUpCornerPlanarCode:n,rightDownCornerPlanarCode:o,isCross:e,levelInfo:i}}judegePlanarCorss(e,t,i){for(var r=[[90,44],[6,4],[.5,.5],[.25,10/60],[1/60,1/60],[4/3600,4/3600],[2/3600,2/3600],[1/14400,1/14400],[1/115200,1/115200],[1/921600,1/921600],[1/7372800,1/7372800]],n=0;n<i.levelIndex;n++){var o=parseInt(e.lng/r[n][0]),s=parseInt(t.lng/r[n][0]),a=parseInt(e.lat/r[n][1]),l=parseInt(t.lat/r[n][1]);if(o!=s||a!=l)return!0}return!1}};var d=new class{constructor(){}getElementEntityCode(e,t){var i=e.levelIndex,r=f.getHeightBeidouCode([1/7372800,1/7372800],10,t.minAlt),n=f.getHeightBeidouCode([1/7372800,1/7372800],10,t.maxAlt),o=this.judgeHeightCorss(t.minAlt,t.maxAlt,e);if(o){for(var t=t.getCenter(),s=f.getHeightBeidouCode([e.longitudeSplit,e.latitudeSplit],i,t.alt),a=s.codeTrans.length;a<11;a++)s.codeTrans[a]="X";return{heightCodeEntityCode:s,heightEntityMinCode:r,heightEntityMaxCode:n,isCross:o,levelInfo:e}}for(var l=[],a=0;a<r.codeTrans.length;a++){if(r.codeTrans[a]!=n.codeTrans[a]){for(;a<11;a++)l.push("X");break}l.push(r.codeTrans[a])}return{heightCodeEntityCode:l,heightEntityMinCode:r,heightEntityMaxCode:n,isCross:o,levelInfo:e}}judgeHeightCorss(e,t,i){for(var r=[[90,44],[6,4],[.5,.5],[.25,10/60],[1/60,1/60],[4/3600,4/3600],[2/3600,2/3600],[1/14400,1/14400],[1/115200,1/115200],[1/921600,1/921600],[1/7372800,1/7372800]],n=0;n<=i.levelIndex;n++){var o=f.heightComputeFormula(r[n],e),s=f.heightComputeFormula(r[n],t);if(o.heightMeshNum!=s.heightMeshNum)return!0}return!1}getElementBoundingbox(e){var t=e.planarPoints,e=e.maxPoint,i=Math.max.apply(Math,t.map(e=>e.x)),r=Math.max.apply(Math,t.map(e=>e.y)),n=Math.min.apply(Math,t.map(e=>e.x)),o=Math.min.apply(Math,t.map(e=>e.y));return new c({lng:n,lat:o,alt:t[0].z},{lng:i,lat:r,alt:e.z},!1)}};var w=new class{constructor(){}dePlanarBeidouCode(e){var t,i,r,n,o=Array.from("ABCDEFGHIJKLMNOPQRSTUV");if(!(e.length<4))return t=Array.from(e.substring(1)).findIndex(e=>isNaN(Number(e))),r=[],n=6*((i=e.substring(1,t+2)).substring(0,i.length-1)-1)-180,r[0]=n<0?6+n:n,"N"==e[0]?r[1]=4*o.findIndex(e=>e==i[i.length-1]):r[1]=4*o.findIndex(e=>e==i[i.length-1])*-1,n=e.substring(t+2,t+4),r[0]+=r[0]<0?.5*parseInt(n[0],16)*-1:.5*parseInt(n[0],16),r[1]+=r[1]<0?.5*n[1]*-1:.5*n[1],(t+=3)>e.length-1?{position:r,levelInfo:{level:2,levelValue:[.5,.5]}}:(o=e.substring(t+1,t+2),r[0]+=r[0]<0?.25*(o[0]-2*parseInt(o[0]/2))*-1:.25*(o[0]-2*parseInt(o[0]/2)),r[1]+=r[1]<0?10/60*parseInt(o[0]/2)*-1:10/60*parseInt(o[0]/2),(t+=2)>e.length-1?{position:r,levelInfo:{level:3,levelValue:[.25,10/60]}}:(n=e.substring(t,t+2).toLowerCase(),this.getCodePostition(r,[parseInt(n[0],16),parseInt(n[1],16)],[1/60,1/60]),(t+=2)>e.length-1?{position:r,levelInfo:{level:4,levelValue:[1/60,1/60]}}:(o=e.substring(t,t+2).toLowerCase(),this.getCodePostition(r,[parseInt(o[0],16),parseInt(o[1],16)],[4/3600,4/3600]),(t+=2)>e.length-1?{position:r,levelInfo:{level:5,levelValue:[4/3600,4/3600]}}:(n=e.substring(t,t+1),r[0]+=r[0]<0?2/3600*(n[0]-2*parseInt(n[0]/2))*-1:2/3600*(n[0]-2*parseInt(n[0]/2)),r[1]+=r[1]<0?2/3600*parseInt(n[0]/2)*-1:2/3600*parseInt(n[0]/2),(t+=1)>e.length-1?{position:r,levelInfo:{level:6,levelValue:[2/3600,2/3600]}}:(o=e.substring(t,t+2),this.getCodePostition(r,[o[0],o[1]],[1/14400,1/14400]),(t+=2)>e.length-1?{position:r,levelInfo:{level:7,levelValue:[1/14400,1/14400]}}:(n=e.substring(t,t+2),this.getCodePostition(r,[n[0],n[1]],[1/115200,1/115200]),(t+=2)>e.length-1?{position:r,levelInfo:{level:8,levelValue:[1/115200,1/115200]}}:(o=e.substring(t,t+2),this.getCodePostition(r,[o[0],o[1]],[1/921600,1/921600]),(t+=2)>e.length-1?{position:r,levelInfo:{level:9,levelValue:[1/921600,1/921600]}}:(n=e.substring(t,t+2),this.getCodePostition(r,[n[0],n[1]],[1/7372800,1/7372800]),{position:r,levelInfo:{level:9,levelValue:[1/7372800,1/7372800]}}))))))))}deHeigthFromHeightCode(e,t){e=new Number(e);return this.ComputeHeightFromGround(e,t)}ComputeHeightFromGround(e,t){var i=Math.PI/180;return{totalHeight:6378137*(Math.pow(1+i,e*t)-1),perHeight:6378137*Math.pow(1+i,(e-1)*t)*(Math.pow(1+i,t)-1)}}getCodePostition(e,t,i){e[0]+=e[0]<0?t[0]*i[0]*-1:t[0]*i[0],e[1]+=e[1]<0?t[1]*i[1]*-1:t[1]*i[1]}};var g=new class{constructor(){this.cellBoundingbox=null,this.cellName=null,this.cellGeometry=null}getRenderObject(e,t,i,r,n,o){var s=this.computeCenter(i);let a=p.getPlanarBeidouCode([s.lng,s.lat],r).join("");a=a.toLocaleUpperCase();var l={lng:i[0],lat:i[1]},u={lng:i[4],lat:i[5]},l=(this.cellBoundingbox=new c(l,u,!0),i=this.getTessellationPoints(i),{id:e,name:t,polygon:{hierarchy:Cesium.Cartesian3.fromDegreesArray(i),material:Cesium.Color.WHITE.withAlpha(.1),outline:!1,outlineWidth:1,outlineColor:Cesium.Color.RED},polyline:{positions:Cesium.Cartesian3.fromDegreesArray(i),width:1,material:o.cellColor,show:!0,clampToGround:!0},position:agcim.maths.coordinate.getGeographic().toCartesian(s),label:{text:a,verticalOrigin:Cesium.VerticalOrigin.TOP,font:"14px sans-serif",fillColor:o.labelColor,show:n,disableDepthTestDistance:Number.POSITIVE_INFINITY}});return 8<r&&(l.label=null),l.planeCode=a,this.cellName=t,this.cellGeometry=i,l}labelTextHandle(e){var t,i,r,n;return void 0===e||""==e?"":(i=(t=(e=String(e)).indexOf("."))<0?e:e.substring(0,t),(r=n=0)<t&&0<(t=(n=60*(n="0"+e.substring(t))+"").indexOf("."))&&(r="0"+n.substring(t),n=n.substring(0,t),t=(r=60*r+"").indexOf("."),r=r.substring(0,t+4),r=parseFloat(r).toFixed(2)),n||r?n&&!r?i+"°"+n+"′":n&&r?i+"°"+n+"′"+r+"″":void 0:i+"°")}computeCenter(t){var i=[];for(let e=0;e<t.length;e+=2){var r={lng:t[e],lat:t[e+1],alt:0};i.push(agcim.maths.coordinate.getGeographic().toCartesian(r))}var e=Cesium.BoundingSphere.fromPoints(i).center;return agcim.maths.coordinate.getGlobalCartesian().toGeographic(e)}getLerpData(e,t,i){for(var r=[],n=parseInt(i[0]/t[0]),o=parseInt(i[1]/t[1]),s=0;s<4;s++)if(s%2==0)for(var a=0;a<t[0];a++)0==s?r.push(e[2*s]+n*a,e[2*s+1]):2==s&&r.push(e[2*s]-n*a,e[2*s+1]);else for(a=0;a<t[1];a++)1==s?r.push(e[2*s],e[2*s+1]+o*a):3==s&&r.push(e[2*s],e[2*s+1]-o*a);return r}needTessellationPolygon(){return 90<=this.cellBoundingbox.getLongitudeSpan()&&44<=this.cellBoundingbox.getLatitudeSpan()}getTessellationPoints(e){return e=this.needTessellationPolygon()?this.getLerpData(e,[10,10],[90,44]):e}dispose(){}};var m=class{constructor(e,t,i){this.twoDimensionMeshLevel=e,this.levelValue=t,this.n=i,this.cellGeometry=null,this.hightCode=null,this.renderColor=Cesium.Color.AQUAMARINE.withAlpha(.4)}build(t,e,i){var r=t[0].lng,n=t[0].lat,o=t[2].lng,s=t[2].lat,a=[];for(let e=0;e<t.length;e++)a.push(agcim.maths.coordinate.getGeographic().toCartesian(t[e]));for(var l=Cesium.BoundingSphere.fromPoints(a).center,l=agcim.maths.coordinate.getGlobalCartesian().toGeographic(l),u={name:`mesh${r}-${n}-${o}-`+s,rectangle:{coordinates:Cesium.Rectangle.fromDegrees(r,n,o,s),material:Cesium.Color.AQUAMARINE.withAlpha(.4),extrudedHeight:i,height:e,outline:!0,outlineColor:Cesium.Color.WHITE}},r=.5*(e+i),c=(u.heightCode=f.getFullHeightBeidouCode(r),f.getHeightBeidouCodeAnOtherMethod(this.levelValue,this.twoDimensionMeshLevel,r),p.getPlanarBeidouCode([l.lng,l.lat],this.twoDimensionMeshLevel)),h=[],A=0;A<c.length;A++)h.push(c[A]),h.push(u.heightCode.codeTrans[A]);return u.finalBeidouCode=h.join("").toUpperCase(),u.planeCode=u.finalBeidouCode.toLocaleUpperCase(),u}distrory(){}};var y=class{constructor(e,t,i,r){this.featureLayer=e,this.cells=[],this.polygon=t,this.meshLevel=i,this.twoDimensionMeshLevel=0,this.wgs84Position=[],this.meshConfig=r,this.transformPosition(),this.upCount=0,this.downCount=0}getExtrudeHeight(e,t){var i=Math.PI/180,t=Number(t);return 6378137*Math.pow(1+i,(e-1)*t)*(Math.pow(1+i,t)-1)}transformPosition(e){var t,i=[];for(t of e||this.polygon)i.push(agcim.maths.coordinate.getGlobalCartesian().toGeographic(t));return this.wgs84Position=i}startExecute(e,t){this.cells=[],this.twoDimensionMeshLevel=t,this.upCount=1,this.upExtrude(e,t)}upExtrude(e,t){var i=this.wgs84Position,r=e+this.getExtrudeHeight(this.upCount,this.meshLevel[0]),n=new m(this.twoDimensionMeshLevel,this.meshLevel,t+1),i=(this.featureLayer.addEntity(n.build(i,e,r)),this.cells.push(n),Number(this.meshConfig.heightNum));this.upCount<i?(this.upCount++,this.computeArea(t+1,r),this.upExtrude(r,t+1)):this.meshConfig.openUnderground&&(this.downCount=1,this.downExtrude(0,0))}downExtrude(e,t){this.transformPosition();var i=this.wgs84Position,r=e-this.getExtrudeHeight(t,this.meshLevel[0]),n=new m(this.twoDimensionMeshLevel,this.meshLevel,t),i=(this.featureLayer.addEntity(n.build(i,r,e)),this.cells.push(n),Number(this.meshConfig.undergroundNum));this.downCount<i&&(this.downCount++,this.computeArea(t-1,-e,1),this.downExtrude(r,t-1))}computeArea(e,t,i){var r,n=this.getExtrudeHeight(e,this.meshLevel[0]),o=[];for(r of this.wgs84Position){let e=i?-(t+n):t+n;o.push(Cesium.Cartesian3.fromDegrees(r.lng,r.lat,e))}this.transformPosition(o)}remove(e){for(var t=0;t<this.cells.length;t++)e.remove(this.cells[t].cellGeometry)}remove(e){for(var t=0;t<this.cells.length;t++)e.remove(this.cells[t].cellGeometry)}},_=i(1133);var v=class{constructor(e){this.planeTable=e,this.beidouLevel=null,this.columns=[],this.featureLayer=null}addColumn(e,t,i,r){this.featureLayer||(this.featureLayer=new _.Z(r));r=[this.beidouLevel.getSplit(0),this.beidouLevel.getSplit(1)],e=new y(this.featureLayer,e,r,i);this.columns.push(e),e.startExecute(0,t)}removeColumn(e){var t=this.columns.indexOf(e);e.remove(this.featureLayer),this.columns.splice(t,1)}removeAll(e){this.featureLayer||(this.featureLayer=new _.Z(e)),this.featureLayer.removeAll(),this.columns=[]}};r=new class extends r{constructor(){super(),this.beidouHeightTable=new v}encode(e,t){for(var e=new c({lng:e.lng,lat:e.lat,alt:e.alt},{lng:t.lng,lat:t.lat,alt:t.alt},!0),t=new u(e).judgeLodMesh().levelIndex,e=e.getCenter(),i=p.getPlanarBeidouCode([e.lng,e.lat],t),r=f.getFullHeightBeidouCode(e.alt),n=[],o=0;o<i.length;o++)n.push(i[o]),n.push(r.codeTrans[o]);return{locationCode:i,heightCode:r,finalBeidouCode:n}}encodeWithLevelIndex(e,t,i){for(var e=new c({lng:e.lng,lat:e.lat,alt:e.alt},{lng:t.lng,lat:t.lat,alt:t.alt},!0),t=(new u(e).judgeLodMesh(),e.getCenter()),r=p.getPlanarBeidouCode([t.lng,t.lat],i),n=f.getFullHeightBeidouCode(t.alt),o=[],s=0;s<r.length;s++)o.push(r[s]),o.push(n.codeTrans[s]);return{locationCode:r,heightCode:n,finalBeidouCode:o}}decode(e,t){var i,r;return t.isThreeD?(t=this.handleCode(e),i=(r=w.dePlanarBeidouCode(t.planarCode.join(""))).levelInfo.levelValue[0],{positionInfo:r,heightInfo:w.deHeigthFromHeightCode(t.heightCode.join(""),i)}):{positionInfo:r=w.dePlanarBeidouCode(e)}}async encodeEntityCode(e){var e=await this.getElementBoundingbox(e),t=e.elementDegrees,e=e.boundingArray,i=new u(t),r=i.judgeLodMesh(),e=A.getElementEntityCode(e[3],e[1],r,t),r=i.judgeHeightLodMesh();return{entityPlanarCode:e,entityHeightCode:d.getElementEntityCode(r,t)}}async getElementBoundingbox(e){var t=await h.Z.entityBus.fromFeature(e),e=e.getPropertyIds().find(e=>"objectid"==e),e=(t.entityId=e,await t.getWorldBoundingBox()),t=e.planarPoints;return{elementDegrees:new c({lng:t[0].x,lat:t[0].y,alt:t[0].z},{lng:t[2].x,lat:t[2].y,alt:t[2].z},!1).CartesiantoDegrees(t[0],e.maxPoint),boundingArray:t}}handleCode(t){var i,r=t.length,n=[],o=[];for(let e=0;e<t.length;)0==e&&(n.push(t[e]),o.push(t[e+1]),e+=2),2==e&&(i=Array.from(t.substring(1)).findIndex(e=>isNaN(Number(e))),n.push(t.substring(2,i+2)),o.push(t.substring(5,i+4)),e=i+4),7==e&&(n.push(t.substring(e,e+2)),o.push(t.substring(e+2,e+3)),e+=3),10==e&&(n.push(t[e]),o.push(t[e+1]),e+=2),12==e&&(n.push(t.substring(e,e+2)),o.push(t.substring(e+2,e+3)),e+=3),15==e&&(n.push(t.substring(e,e+2)),o.push(t.substring(e+2,e+3)),e+=3),r>=e+1&&18==e&&(n.push(t[e]),o.push(t[e+1]),e+=2),r>=e+2&&(n.push(t.substring(e,e+2)),o.push(t[e+2]),e+=3);return{planarCode:n,heightCode:o}}getBoundingbox(e,t){var i=new c(e,t,!0),i=new u(i).judgeLodMesh(),e=new c(e,t,!0);return{viewBoundingbox:e=0==i.index?new c({lng:-180,lat:-88},{lng:180,lat:88},!0):e,levelInfo:i}}getBoundingboxWithMeshArray(e,t,i){var r=new c(e,t,!0),r=new u(r,i).judgeLodMesh(),i=new c(e,t,!0);return{viewBoundingbox:i=0==r.index?new c({lng:-180,lat:-88},{lng:180,lat:88},!0):i,levelInfo:r}}renderGrid(e,t,i,r=[],n,o){var s=e.levelInfo.getSplit(0),a=e.levelInfo.getSplit(1),l=(this.beidouHeightTable.beidouLevel=e.levelInfo,e.levelInfo.levelIndex);if(!this.meshVisible(i,t))for(var u=this.getGridPositions(e.viewBoundingbox,s,a,t),c=0;c<u.length;c++){var h=u[c].entityId,h=g.getRenderObject(h,h,u[c].polygonPositions,l,n,o);h.level=l,r.push(h),t.addEntity(h)}}meshVisible(e,t){return e.camera.positionCartographic.height<5||(15e3<e.camera.positionCartographic.height||(e=agcim.maths.coordinate.toDegrees(e.camera.pitch),32<(e=Math.abs(e)))?!(t.show=!0):e<31||void 0)}getGridPositions(e,t,i,r){for(var n=[],e=this.getPositions(e,t,i),o=e.langs,s=e.lats,a=this.updateGrid(o,s,r),l=0;l<o.length-1;l++)for(var u=0;u<s.length-1;u++){var c,h=o[l]+","+s[u];a.includes(h)||(c=[o[l],s[u],o[l+1],s[u],o[l+1],s[u+1],o[l],s[u+1]],n.push({entityId:h,polygonPositions:c}))}return n}getPositions(e,t,i){var r=[],n=[],o=parseInt(e.minLon/t),s=parseInt(e.minLat/i),a=(o-1)*t,l=(s-1)*i,u=parseInt(e.maxLon/t)-o+2,c=parseInt(e.maxLat/i)-s+2;90==t&&44==i&&(u-=2,c-=2,a=o*t,l=s*i);for(var h=0;h<=u;h++)r.push(a+t*h);for(h=0;h<=c;h++)n.push(l+i*h);return{langs:r,lats:n}}updateGrid(t,i,r){var n=r._entities,o=[],s=[];for(let e=0;e<n.length;e++){var a=n[e].name.split(","),l=n[e].id;(t.includes(Number(a[0]))&&i.includes(Number(a[1]))?(n[e].show=!0,n[e].polygon.outlineColor=Cesium.Color.WHITE,o):s).push(l)}for(let e=0;e<s.length;e++){var u=s[e],u=CIM.viewer.entities.getById(u);r.removeEntity(u)}return o}};var C=new class{constructor(){}renderCenterPlanarMesh(e){var t=new agcim.geometry.Polygon,i=e.pointInfo,e=e.code,t=(t.createEntity(i.positionts),t.entity),i=(t.polygon.outlineColor=Cesium.Color.WHITE,t.polygon.fill=!1,t.polygon.outlineWidth=1,agcim.maths.coordinate.getWgs84().toCartesian3(i.pointCenter)),e={text:e,verticalOrigin:Cesium.VerticalOrigin.TOP,font:"14px sans-serif",fillColor:Cesium.Color.WHITE};return t.position=i,t.label=e,t}getPlanarEntityPositions(e,t,i){for(var r=[],n=[[4,4],[60,22],[12,8],[2,3],[15,10],[15,15],[2,2],[8,8],[8,8],[8,8],[8,8]],o=[[90,44],[6,4],[.5,.5],[.25,10/60],[1/60,1/60],[4/3600,4/3600],[2/3600,2/3600],[1/14400,1/14400],[1/115200,1/115200],[1/921600,1/921600],[1/7372800,1/7372800]],s=!0,a=0;a<t.length-1;a++)if(t[a]!=i[a]){s=!1;break}if(s){var l=e.findIndex(e=>-1!=e.indexOf("X")),u=e.slice(0,l).join(""),c=w.antiGetBeidouCode(u,!1),h=e[l],A=c.positionInfo.levelInfo.level,p=n[A+1][0],f=n[A+1][1];if("X"==h[0]&&"X"==h[1])for(a=0;a<p;a++)for(var d=c.positionInfo.position[0]+a*o[A+1][0],g=0;g<f;g++){var m={position:[d,c.positionInfo.position[1]+g*o[A+1][1]],levelInfo:{levelValue:o[A+1],levelIndex:A+1}},y={pointInfo:this.getPostions(m),code:u+""+a+g};r.push(y)}else if("X"==h[0]&&"X"!=h[1])for(a=0;a<p;a++){m={position:[d=c.positionInfo.position[0]+a*o[A+1][0],c.positionInfo.position[1]+h[1]*o[A+1][1]],levelInfo:{levelValue:o[A+1],levelIndex:A+1}},y={pointInfo:this.getPostions(m),code:u+(""+a+h[1])};r.push(y)}}else for(var _=-1==(_=e.findIndex(e=>-1!=e.indexOf("X")))?e.length-1:_-1,l=t.slice(0,1+_).join(""),n=i.slice(0,1+_).join(""),v=w.dePlanarBeidouCode(l),C=w.dePlanarBeidouCode(n),a=v.position[0];a<=C.position[0]+o[_][0];a+=o[_][0])for(d=a,g=v.position[1];g>=C.position[1];g-=o[_][1]){m={position:[d,g],levelInfo:{levelValue:o[_],levelIndex:_}},y={pointInfo:this.getPostions(m),code:""};r.push(y)}return r}getPostions(e){var t=e.levelInfo.levelValue[0],i=e.levelInfo.levelValue[1],r={lng:e.position[0],lat:e.position[1],alt:0},n={lng:0<r.lng?r.lng+t:r.lng+-1*t,lat:r.lat,alt:0},o={lng:0<r.lng?r.lng+t:r.lng+-1*t,lat:0<r.lat?r.lat+i:r.lat+-1*i,alt:0},s={lng:r.lng,lat:0<r.lat?r.lat+i:r.lat+-1*i,alt:0};return{positionts:Cesium.Cartesian3.fromDegreesArray([r.lng,r.lat,n.lng,n.lat,o.lng,o.lat,s.lng,s.lat]),pointCenter:{lng:r.lng+.5*t,lat:r.lat+.5*i,alt:0},levelInfo:e.levelInfo}}};var x=new class{constructor(){}getCurrentHeightNum(e,t,i){var r=[[90,44],[6,4],[.5,.5],[.25,10/60],[1/60,1/60],[4/3600,4/3600],[2/3600,2/3600],[1/14400,1/14400],[1/115200,1/115200],[1/921600,1/921600],[1/7372800,1/7372800]],e=r[e],r=r[t.length-1],n=w.deHeigthFromHeightCode(t,r[0]),t=w.deHeigthFromHeightCode(parseInt(t)+i,r[0]),i=6378137*(Math.pow(1+Math.PI/180,e[0])-1),r=f.heightComputeFormula(e,n.totalHeight+.5*i),n=f.heightComputeFormula(e,t.totalHeight-.5*i);return[r.heightMeshNum,n.heightMeshNum]}},b=i(2325);var E=new class{constructor(){this.planarMeshEntities=[],this.entity=null,this.heightObjectEntities=[],this.planarObjectEntities=[]}getRenderPlanarObjects(e,t,i){for(var r=C.getPlanarEntityPositions(e,t,i),n=[],o=0;o<r.length;o++){var s=C.renderCenterPlanarMesh(r[o]);n.push(s)}return this.planarObjectEntities=n}getRenderHeightObjects(e,t,i,r,n,o){for(var s=C.getPlanarEntityPositions(e,t,i),e=r.findIndex(e=>"X"==e),t=(r=r.slice(0,e)).length,i=r[t-1]==n[t-1]&&r[t-1]==o[t-1],a=null,l=s[0].pointInfo.levelInfo.levelIndex,u=(a=i?x.getCurrentHeightNum(l,r.join(""),1):(r[e-1]>n[e-1]&&(r=n.slice(0,e)),i=parseInt(o[t-1])-parseInt(n[t-1]),x.getCurrentHeightNum(l,r.join(""),1+i)),[]),c=0;c<s.length;c++)for(var h=s[c].pointInfo.levelInfo.levelValue,A=s[c].pointInfo.positionts,p=a[0];p<=a[1];p++){var f=w.deHeigthFromHeightCode(p,h[0]),d=new b.Z;d.createEntity(A,f.totalHeight,f.totalHeight+f.perHeight,Cesium.Color.AQUAMARINE.withAlpha(.4)),u.push(d.entity)}return this.heightObjectEntities=u}destroy(){this.planarMeshEntities=[],this.entity=null,this.heightObjectEntities=[],this.planarObjectEntities=[]}},B=i(3829);class M{constructor(e){this.viewer=e,this.featureLayer=new agcim.layer.FeatureLayer(this.viewer),this.colorCache={}}getBbox(e){var t,e=B.polygon([e]),e=B.bbox(e),i=[];for(t of B.bboxPolygon(e).geometry.coordinates[0]){var r=agcim.maths.coordinate.WGS84_to_Cartesian3({lng:t[0],lat:t[1]});i.push(r)}return this.getBoxCoord(i)}getBoxCoord(e){let t=[],i=[];e.forEach(e=>{e=Cesium.Cartographic.fromCartesian(e);t.push(Cesium.Math.toDegrees(e.longitude)),i.push(Cesium.Math.toDegrees(e.latitude))}),t.sort((e,t)=>e-t),i.sort((e,t)=>e-t);var e=t[0],r=t[t.length-1],n=i[0],o=i[i.length-1],s=[];return s.push(Cesium.Cartesian3.fromDegrees(e,n)),s.push(Cesium.Cartesian3.fromDegrees(e,o)),s.push(Cesium.Cartesian3.fromDegrees(r,o)),s.push(Cesium.Cartesian3.fromDegrees(r,n)),s}getMaxRect(e){var t,e=B.polygon([e]),e=B.bbox(e),i=[];for(t of B.bboxPolygon(e).geometry.coordinates[0]){var r=agcim.maths.coordinate.WGS84_to_Cartesian3({lng:t[0],lat:t[1]});i.push(r)}let n=[],o=[];i.forEach(e=>{e=Cesium.Cartographic.fromCartesian(e);n.push(Cesium.Math.toDegrees(e.longitude)),o.push(Cesium.Math.toDegrees(e.latitude))}),n.sort((e,t)=>e-t),o.sort((e,t)=>e-t);var e=n[0],s=n[n.length-1];return[e,o[0],s,o[o.length-1]]}renderEntityMeshWithPoints(e,t,i=[1,2],r=8,n=Cesium.Color.GREEN){var o=this.getEntityPositions(e,t,r);this.featureLayer&&this.featureLayer.removeAll();for(var s=0;s<o.length;s++)for(var a=o[s].pointInfo.levelInfo.levelValue,l=o[s].pointInfo.positionts,u=i[0];u<=i[1];u++){var c=agcim.maths.BeidouEncoder_DeCodes.deHeigthFromHeightCode(u,a[0]),h=new agcim.geometry.RectangleBox;o[s].minPoint.alt=c.totalHeight,o[s].maxPoint.alt=c.totalHeight+c.perHeight,h.createEntity(l,c.totalHeight,c.totalHeight+c.perHeight,n||Cesium.Color.AQUAMARINE.withAlpha(.4)),h.addToLayer(this.featureLayer),this.viewer.scene.requestRender()}}getEntityPositions(e,t,i){for(var r,n={level:8,levelValue:[8680555555555556e-21,8680555555555556e-21]},o=[],s=[[90,44],[6,4],[.5,.5],[.25,10/60],[1/60,1/60],[4/3600,4/3600],[2/3600,2/3600],[1/14400,1/14400],[1/115200,1/115200],[1/921600,1/921600],[1/7372800,1/7372800]],e=(e=agcim.maths.coordinate.Cartesian3_to_WGS84(e),t=agcim.maths.coordinate.Cartesian3_to_WGS84(t),{levelInfo:n,position:[e.lng,e.lat]}),n={levelInfo:n,position:[t.lng,t.lat]},a=this.getCellRegions(e,n,s,i),l=a.iMin;l<=a.iMax;l+=a.iStep)for(var u=l,c=a.jMax;c>=a.jMin;c-=a.jStep){var h=c,h=this.getPostions({position:[u,h],levelInfo:{levelValue:s[i],levelIndex:i}});o.push({pointInfo:h,code:""})}for(r of o){var A=r.pointInfo;let t=[];A.positionts.forEach(e=>{t.push(agcim.maths.coordinate.Cartesian3_to_WGS84(e))});var p=agcim.maths.coordinate.Cartesian3_to_WGS84(A.positionts[1]),A=agcim.maths.coordinate.Cartesian3_to_WGS84(A.positionts[3]);r.minPoint=p,r.maxPoint=A}return o}renderEntityMeshWithPointsAndHeights(e,t,i=[0,100],r=8,n=Cesium.Color.GREEN,o=3){for(var s=this.getEntityPositions(e,t,r),a=[Math.round(this.computeHeightNumber(i[0],s[0].pointInfo.levelInfo.levelValue[0])),Math.round(this.computeHeightNumber(i[1],s[0].pointInfo.levelInfo.levelValue[0]))],l=(this.featureLayer&&this.featureLayer.removeAll(),[]),u=0;u<s.length;u++)for(var c=s[u].pointInfo.levelInfo.levelValue,h=s[u].pointInfo.positionts,A=a[0];A<=a[1];A++){var o=agcim.maths.BeidouEncoder_DeCodes.deHeigthFromHeightCode(A,c[0]),p=new agcim.geometry.RectangleBox,f=s[u].minPoint,d=(f.alt=o.totalHeight,s[u].maxPoint);d.alt=o.totalHeight+o.perHeight,p.createEntity(h,o.totalHeight,o.totalHeight+o.perHeight,n||Cesium.Color.AQUAMARINE.withAlpha(.4),this.createBeidouCode(f,d,r),{bdm:this.createBeidouCode(f,d,r),heightNum:A}),l.push({bdm:this.createBeidouCode(f,d,r),heightNum:A,positions:h}),p.addToLayer(this.featureLayer),this.viewer.scene.requestRender()}return l}computeHeightNumber(e,t){var i=Math.PI/180;return e/(6378137*Math.pow(1+i,0*t)*(Math.pow(1+i,t)-1))}createBeidouCode(e,t,i){for(var r=agcim.maths.BeidouEncoder.encodeWithLevelIndex(e,t,i),n=[],o=0;o<r.locationCode.length;o++)n.push(r.locationCode[o]),n.push(r.heightCode.codeTrans[o]);return n.join("").toUpperCase()}getProperSplit(e,t,i,r){if(r<=0)return-1;r>=i.length&&(r=i.length-1);var n=Math.abs((t.position[0]-e.position[0])/i[r][0]),o=Math.abs((t.position[1]-e.position[1])/i[r][1]);return 10<n||10<o?0<=(n=this.getProperSplit(e,t,i,r-1))?n:-1:r}getCellRegions(e,t,i,r){var n=t.position[0]+i[r][0],o=(Math.abs(t.position[0]-e.position[0])<1e-8&&(n=t.position[0]),t.position[1]-i[r][1]);return Math.abs(t.position[1]-e.position[1])<1e-8&&(o=t.position[1]),{iMin:e.position[0],iMax:n,iStep:i[r][0],jMax:e.position[1],jMin:o,jStep:i[r][1]}}getPostions(e){var t=e.levelInfo.levelValue[0],i=e.levelInfo.levelValue[1],r={lng:e.position[0],lat:e.position[1],alt:0},n={lng:0<r.lng?r.lng+t:r.lng+-1*t,lat:r.lat,alt:0},o={lng:0<r.lng?r.lng+t:r.lng+-1*t,lat:0<r.lat?r.lat+i:r.lat+-1*i,alt:0},s={lng:r.lng,lat:0<r.lat?r.lat+i:r.lat+-1*i,alt:0};return{positionts:Cesium.Cartesian3.fromDegreesArray([r.lng,r.lat,n.lng,n.lat,o.lng,o.lat,s.lng,s.lat]),pointCenter:{lng:r.lng+.5*t,lat:r.lat+.5*i,alt:0},levelInfo:e.levelInfo}}dispose(){this.featureLayer.removeAll()}changeColorWithBeiDouCodeArr(e,t){for(var i of e){var r=this.viewer.entities.getById(i);r&&(this.colorCache[i]={color:r.rectangle.material.color._value.clone()}),r.rectangle.material.color=t}}resetColorWithBeiDouCodeArr(e){for(var t of e){var i=this.viewer.entities.getById(t);i&&this.colorCache[t].color&&(i.rectangle.material.color=this.colorCache[t].color)}}}class I{constructor(e,t){this.viewer=e||this.viewer,this.storeDepthState=null,this.gridFeatureLayer=new agcim.layer.FeatureLayer(this.viewer),this.planeTable=[],this.gridShow=!0,this.cellColor=t?.cellColor||Cesium.Color.WHITE,this.labelColor=t?.labelColor||Cesium.Color.WHITE,this.meshArray=[[90,44],[6,4],[.5,.5],[.25,10/60],[1/60,1/60],[4/3600,4/3600],[2/3600,2/3600],[1/14400,1/14400],[1/115200,1/115200*2],[1/921600,1/921600],[1/7372800,1/7372800]]}changeGridShow(e){this.gridShow=e}openDMeshesEvent(){this.viewer.scene.requestRenderMode=!1,this.viewer.camera.moveStart.removeEventListener(this.updateEvent,this),this.viewer.camera.moveEnd.removeEventListener(this.stopUpdate,this),this.viewer.camera.moveStart.addEventListener(this.updateEvent,this),this.viewer.camera.moveEnd.addEventListener(this.stopUpdate,this)}stopUpdate(){clearInterval(this.updateInterval),this.updateInterval=null}updateEvent(){this.updateInterval||(this.updateInterval=setInterval(()=>{this.updateGrid()},this.updateTime))}updateGrid(){var e=agcim.camera.camera.getScreenCornerCoordinates(this.viewer),t=(e[3].lng<e[1].lng?e[3]:e[1]).lng,i=(e[3].lat<e[1].lat?e[3]:e[1]).lat,r=(e[3].lng>e[1].lng?e[3]:e[1]).lng,e=(e[3].lat>e[1].lat?e[3]:e[1]).lat,t=agcim.maths.BeidouEncoder.getBoundingbox({lng:t,lat:i},{lng:r,lat:e},!0);null===this.storeDepthState&&(this.storeDepthState=this.viewer.scene.globe.depthTestAgainstTerrain,this.viewer.scene.globe.depthTestAgainstTerrain=!1),agcim.maths.BeidouEncoder.renderGrid(t,this.gridFeatureLayer,this.viewer,this.planeTable,this.gridShow,{cellColor:this.cellColor,labelColor:this.labelColor})}setMeshArray(e){this.meshArray=e}openDMeshesEventWithMeshArray(e){e&&11<=e.length&&(this.meshArray=e),this.viewer.scene.requestRenderMode=!1,this.viewer.camera.moveStart.removeEventListener(this.updateEventWithMeshArray,this),this.viewer.camera.moveEnd.removeEventListener(this.stopUpdateWithMeshArray,this),this.viewer.camera.moveStart.addEventListener(this.updateEventWithMeshArray,this),this.viewer.camera.moveEnd.addEventListener(this.stopUpdateWithMeshArray,this)}updateEventWithMeshArray(){this.updateIntervalWithMeshArray||(this.updateIntervalWithMeshArray=setInterval(()=>{this.updateGridWithMeshArray()},this.updateTime))}updateGridWithMeshArray(){var e=agcim.camera.camera.getScreenCornerCoordinates(this.viewer),t=(e[3].lng<e[1].lng?e[3]:e[1]).lng,i=(e[3].lat<e[1].lat?e[3]:e[1]).lat,r=(e[3].lng>e[1].lng?e[3]:e[1]).lng,e=(e[3].lat>e[1].lat?e[3]:e[1]).lat,t=agcim.maths.BeidouEncoder.getBoundingboxWithMeshArray({lng:t,lat:i},{lng:r,lat:e},this.meshArray);null===this.storeDepthState&&(this.storeDepthState=this.viewer.scene.globe.depthTestAgainstTerrain,this.viewer.scene.globe.depthTestAgainstTerrain=!1),agcim.maths.BeidouEncoder.renderGrid(t,this.gridFeatureLayer,this.viewer,this.planeTable,this.gridShow,{cellColor:this.cellColor,labelColor:this.labelColor})}stopUpdateWithMeshArray(){clearInterval(this.updateIntervalWithMeshArray),this.updateIntervalWithMeshArray=null}dispose(){this.gridFeatureLayer.removeAll(),this.planeTable=[],this.viewer.camera.moveStart.removeEventListener(this.updateEvent,this),this.viewer.camera.moveEnd.removeEventListener(this.stopUpdate,this),this.viewer.camera.moveStart.removeEventListener(this.updateEventWithMeshArray,this),this.viewer.camera.moveEnd.removeEventListener(this.stopUpdateWithMeshArray,this),this.viewer.scene.globe.depthTestAgainstTerrain=this.storeDepthState,this.storeDepthState=null}}class S{constructor(){}encode(e,t=10){var i={lng:e.lng+14e-8,lat:e.lat+14e-8,alt:e.alt},e=agcim.maths.BeidouEncoder.encodeWithLevelIndex(e,i,t);return{qrCode:e.locationCode.join("").toUpperCase(),tdCode:e.finalBeidouCode.join("").toUpperCase()}}}var P={math:t.Z,coordinate:n.Z,geoHash:o,BeidouEncoder:r,BeidouRender:E,TurfHelper:s.Z,coordTrans:a,RenderPlanarMesh:C,BeidouEncoder_DeCodes:w,BeidouHelper:class{constructor(e,t){this.viewer=e,this.threeDGrid=new M(e),this.twoDGrid=new I(e,t),this.codingTools=new S,this.beidouHeightTable=agcim.maths.BeidouEncoder.beidouHeightTable,this.cellColor=t?.cellColor||Cesium.Color.WHITE,this.labelColor=t?.labelColor||Cesium.Color.WHITE}}}},7017:function(e,i,r){"use strict";r.d(i,{Z:function(){return _}});var l=r(9745);i=new class{getDistance(e,t){var i,r,n;return Array.isArray(e)?(i=Math.pow(t[0]-e[0],2),r=Math.pow(t[1]-e[1],2),n=Math.pow(t[2]-e[2],2),Math.sqrt(i+r+n)):Cesium.Cartesian3.distance(e,t)}getDistances(t,i){i=i||[];var r=0;for(let e=0;e<t.length-1;e++){var n=this.getDistance(t[e],t[e+1]);r+=n,i.push(n)}return r}getLength(i){if(i instanceof Array&&0<i.length){let t=0;for(let e=0;e<i.length;e++)t+=i[e]*i[e];return Math.sqrt(t)}if(i instanceof Object){let e=0;return"x"in i&&(e+=i.x*i.x),"y"in i&&(e+=i.y*i.y),"z"in i&&(e+=i.z*i.z),Math.sqrt(e)}throw new Error("unrecognized vector")}getDistanceOfWGS84(e,t,i,r){e=Degree2rad(e),t=Degree2rad(t),i=Degree2rad(i),t-=Degree2rad(r);return 2*Math.asin(Math.sqrt(Math.pow(Math.sin((e-i)/2),2)+Math.cos(e)*Math.cos(i)*Math.pow(Math.sin(t/2),2)))*EARTH_RADIUS}getExportMethods(){return["getDistance","getDistances","getLength"]}};var n=new class{getTilesetTransfrom(e){return e._root.transform}getRotationFromTileset(e){e=e._root.transform;return this.getRotationFromTransform(e)}getRotationFromTransform(e){var t=Cesium.Matrix4.getMatrix3(e,new Cesium.Matrix3),e=Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Matrix4.getTranslation(e,new Cesium.Cartesian3)),e=Cesium.Matrix4.getMatrix3(e,new Cesium.Matrix3),e=Cesium.Matrix3.inverse(e,new Cesium.Matrix3);return Cesium.Matrix3.multiply(e,t,new Cesium.Matrix3)}getExportMethods(){return["getTilesetTransfrom","getRotationFromTransform","getRotationFromTileset"]}};var o=new class{getCurrentExtend(t){var i,r=t.canvas.clientWidth,n=t.canvas.clientHeight,o=CIM.viewer.scene.globe.ellipsoid,s={lb:t.camera.pickEllipsoid(new Cesium.Cartesian2(0,0),o),lt:t.camera.pickEllipsoid(new Cesium.Cartesian2(0,n),o),rb:t.camera.pickEllipsoid(new Cesium.Cartesian2(r,0),o),rt:t.camera.pickEllipsoid(new Cesium.Cartesian2(r,n),o)};for(i in s)if(!s[i]){var a=null,l=0,u=0;switch(i){case"lt":u=n;break;case"rb":l=r;break;case"rt":l=r,u=n}let e=0;for(;!a;)0==i.indexOf("l")?l+=10:l-=10,1==i.indexOf("b")?u+=10:u-=10,a=t.camera.pickEllipsoid(new Cesium.Cartesian2(l,u),o),e++;s[i]=a}return s}isViewExtendDifferent(e,t,i){var r=["lb","lt","rt","rb"];i=i||.05*this.getDistance(e.lb,e.rt);for(var n=0;n<r.length;n++){var o=e[r[n]],s=t[r[n]];if(this.getDistance(o,s)>i)return!0}return!1}getExportMethods(){return["getCurrentExtend","isViewExtendDifferent"]}};var s=new class{transpose(i){var r=new Array(i[0].length).fill(0).map(e=>new Array(i.length).fill(0));for(let t=0;t<r.length;t++)for(let e=0;e<r[0].length;e++)r[t][e]=i[e][t];return r}inverse(e){if(e[0].length!==e.length)throw new Error;var i=this.det(e),r=this.adjoint(e);console.log(JSON.stringify(i));for(let t=0;t<r.length;t++)for(let e=0;e<r.length;e++)r[t][e]/=i}inverseMatrix3(e){e=new Cesium.Matrix3(e[0][0],e[1][0],e[2][0],e[0][1],e[1][1],e[2][1],e[0][2],e[1][2],e[2][2]),e=Cesium.Matrix3.inverse(e,new Cesium.Matrix3);return[[e[0],e[3],e[6]],[e[1],e[4],e[7]],[e[2],e[5],e[8]]]}multiply(r,n){if(r[0].length!==n.length)throw new Error;var e=r.length,o=r[0].length;let s=n[0].length;var a=new Array(e).fill(0).map(e=>new Array(s).fill(0));for(let i=0;i<e;i++)for(let t=0;t<s;t++)for(let e=0;e<o;e++)a[i][t]+=r[i][e]*n[e][t];return a}multiplyByColumn(i,r){var e=i.length,n=(i[0].length,r.length),o=new Array(e).fill(0);for(let t=0;t<e;t++)for(let e=0;e<n;e++)o[t]+=i[t][e]*r[e];return o}det(r){if(r.length!==r[0].length)throw new Error;let n=r.length,e=0;if(3<n)for(let i=0;i<n;i++){var o=new Array(n-1).fill(0).map(e=>new Array(n-1).fill(0));for(let t=0;t<n-1;t++)for(let e=0;e<n-1;e++)e<i?o[t][e]=r[t+1][e]:o[t][e]=r[t+1][e+1];e+=r[0][i]*Math.pow(-1,0+i)*this.det(o)}else 3===n?e=r[0][0]*r[1][1]*r[2][2]+r[0][1]*r[1][2]*r[2][0]+r[0][2]*r[1][0]*r[2][1]-r[0][2]*r[1][1]*r[2][0]-r[0][1]*r[1][0]*r[2][2]-r[0][0]*r[1][2]*r[2][1]:2===n?e=r[0][0]*r[1][1]-r[0][1]*r[1][0]:1===n&&(e=r[0][0]);return e}adjoint(r){if(r[0].length!==r.length)throw new Error;let t=r.length;var n=new Array(t).fill(0).map(e=>new Array(t).fill(0));for(let e=0;e<t;e++)for(let i=0;i<t;i++){var o=[];for(let t=0;t<r.length;t++)if(t!==e){var s=[];for(let e=0;e<r.length;e++)e!==i&&s.push(r[t][e]);o.push(s)}n[e][i]=Math.pow(-1,e+i)*this.det(o)}return this.transpose(n)}};var a=new class{getPlaneByLSM(t){if(!(t.length<3)){var i=[],r=[];for(let e=0;e<t.length;e++)i[e]=[t[e].x,t[e].y,1],r[e]=t[e].z;var e=s.transpose(i),n=s.multiply(e,i),n=s.inverseMatrix3(n),n=s.multiply(n,e),e=s.multiplyByColumn(n,r),n=Math.sqrt(e[0]*e[0]+e[1]*e[1]+1),e=new Cesium.Cartesian3(e[0]/n,e[1]/n,-1/n);return Cesium.Cartesian3.normalize(e,e),e}}getPlaneByCrossProduct(e){var t;if(!(e.length<3))return t=Cesium.Cartesian3.subtract(e[0],e[1],new Cesium.Cartesian3),e=Cesium.Cartesian3.subtract(e[2],e[1],new Cesium.Cartesian3),Cesium.Cartesian3.cross(t,e,new Cesium.Cartesian3)}projectPointsAtPlane2(t,e,i,r){var n=[],o=Cesium.Plane.fromPointNormal(Cesium.Cartesian3.ZERO,i),i=Cesium.Matrix4.IDENTITY;i=r?(r=Cesium.Matrix4.getMatrix3(r,new Cesium.Matrix3),Cesium.Matrix4.fromRotationTranslation(r,e,new Cesium.Matrix4)):Cesium.Transforms.eastNorthUpToFixedFrame(e),Cesium.Plane.transform(o,i,o);for(let e=0;e<t.length;e++){var s=Cesium.Plane.projectPointOntoPlane(o,t[e],new Cesium.Cartesian3);n.push(s)}return n}projectPointsAtPlane(e,t,i){for(var r=t.x,n=t.y,o=t.z,s=-1*(r*i.x+n*i.y+o*i.z),a=r*r+n*n+o*o,l=[],u=0;u<e.length;u++){var c=-(e[u].x*r+e[u].y*n+e[u].z*o+s)/a;l.push(new Cesium.Cartesian3(e[u].x+c*r,e[u].y+c*n,e[u].z+c*o))}return l}getPointInPlane(e,t){var i=this.getNormalVector(t[0],t[1],t[2]),r=e[0].x-e[1].x,n=e[0].y-e[1].y,o=e[0].z-e[1].z,r=this._getLinePlaneIntersectionPoint({x:r,y:n,z:o},e[0],i,t[0]);return r||!1}projectToPlane(e,t,i,r){var e=new Cesium.Cartesian3(t.x-e.x,t.y-e.y,t.z-e.z),i=new Cesium.Cartesian3(t.x-i.x,t.y-i.y,t.z-i.z),e=Cesium.Cartesian3.cross(e,i,new Cesium.Cartesian3),n=e.x,o=e.y,s=e.z,a=n*t.x+o*t.y+s*t.z;if(a=-a,0==Array.isArray(r))return i=-(n*r.x+o*r.y+s*r.z+a),i/=n*n+o*o+s*s,new Cesium.Cartesian3(r.x+i*n,r.y+i*o,r.z+i*s);for(var l=[],u=0;u<r.length;u++){var c=-(n*r[u].x+o*r[u].y+s*r[u].z+a),c=(c/=n*n+o*o+s*s,new Cesium.Cartesian3(r[u].x+c*n,r[u].y+c*o,r[u].z+c*s));l.push(c)}return l}_getLinePlaneIntersectionPoint(e,i,r,n){var o=e.x,s=e.y,e=e.z,a=i.x,l=i.y,i=i.z,u=r.x,c=r.y,r=r.z,h=n.x,A=n.y,n=n.z,p=o*u+s*c+e*r,f={};if(0!=p)return t=((h-a)*u+(A-l)*c+(n-i)*r)/p,f.x=a+o*t,f.y=l+s*t,f.z=i+e*t,f}getDistancePoint2Plane(e,t,i){var r=i.x,n=i.y,i=i.z,t=-1*(r*t.x+n*t.y+i*t.z),o=r*r+n*n+i*i;return Math.abs(e.x*r+e.y*n+e.z*i+t)/Math.sqrt(o)}getExportMethods(){return["getPlaneByLSM","getPlaneByCrossProduct","projectPointsAtPlane","getPointInPlane","projectToPlane","getDistancePoint2Plane"]}},c=r(8698);r=new class{computeIntersectPoint(e,t,i){var r=c.Z.subtract(e[0],e[1]),n=c.Z.subtract(t[0],t[1]),t=c.Z.subtract(t[1],e[1]),o=r.x*n.y-r.y*n.x,s=r.x*n.z-r.z*n.x,a=r.y*n.z-r.z*n.y;let l,u;if(1e-9<Math.abs(o))l=(t.x*n.y-t.y*n.x)/o;else if(1e-9<Math.abs(s))l=(t.x*n.z-t.z*n.x)/s;else{if(!(1e-9<Math.abs(a)))return null;l=(t.y*n.z-t.z*n.y)/a}return u=1e-9<Math.abs(n.x)?(l*r.x-t.x)/n.x:1e-9<Math.abs(n.y)?(l*r.y-t.y)/n.y:(l*r.z-t.z)/n.z,0==i&&(l<0||1<l||u<0||1<u)?null:Math.abs(l)<1e-9?e[1]:Math.abs(1-l)<1e-9?e[0]:c.Z.add(c.Z.multiplyByScalar(r,l),e[1])}getRotationByPoints(e,t,i){var r,n,t=Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3),e=(Cesium.Cartesian3.normalize(t,t),Cesium.Cartesian3.cross(i,t,new Cesium.Cartesian3)),i=Math.acos(Cesium.Cartesian3.dot(i,t)/Cesium.Cartesian3.magnitude(i)/Cesium.Cartesian3.magnitude(t));return 0==i||0==(t=Cesium.Cartesian3.magnitude(e))?Cesium.Matrix3.IDENTITY:(r=-e.x/t,n=-e.y/t,e=e.z/t,(t=new Cesium.Matrix3)[0]=Math.cos(i)+r*r*(1-Math.cos(i)),t[1]=r*n*(1-Math.cos(i)-e*Math.sin(i)),t[2]=n*Math.sin(i)+r*e*(1-Math.cos(i)),t[3]=e*Math.sin(i)+r*n*(1-Math.cos(i)),t[4]=Math.cos(i)+n*n*(1-Math.cos(i)),t[5]=-r*Math.sin(i)+n*e*(1-Math.cos(i)),t[6]=-n*Math.sin(i)+r*e*(1-Math.cos(i)),t[7]=r*Math.sin(i)+n*e*(1-Math.cos(i)),t[8]=Math.cos(i)+e*e*(1-Math.cos(i)),t)}getExportMethods(){return["computeIntersectPoint","getRotationByPoints"]}};var u=new class{isClockwise(e){if(0!=e.length){if(e[0]instanceof Cesium.Cartesian3)for(var t=0,i=0,r=e.length,n=e[i];i<r-1;i++)t+=((o=e[i+1]).x-n.x)*(o.y+n.y),n=o;else for(var o,t=0,i=0,r=e.length,n=e[i];i<r-1;i++)t+=((o=e[i+1])[0]-n[0])*(o[1]+n[1]),n=o;return 0<=t}}isPolygonContains(e,t){if(!e)return!1;for(var i,r,n,o=e.length,s=e,a=s[0],l=s[o-1],u=(Math.abs(a.x-l.x)<1e-4&&Math.abs(a.y-l.y)<1e-4&&Math.abs(a.z-l.z)<1e-4&&--o,0),c=0;c<o;c++){var a=s[c],l=s[(c+1)%s.length],h=a.x>l.x,A=a.x>t.x,p=l.x>t.x;A!=p?(n=l.y-a.y,i=a.x-l.x,r=-n*a.x-i*a.y,(n=n*t.x+i*t.y+r)<0&&h&&u++,0<n&&0==h&&u++):0==A&&0==p&&(h&&l.x==t.x&&u++,0==h)&&a.x==t.x&&u++}return u%2==1}isPolygonContainsPolygon(e,t){var i=Cesium.BoundingRectangle.fromPoints(e),r=Cesium.BoundingRectangle.fromPoints(t);if(i.x>r.x||i.y>r.y)return!1;if(i.x+i.width<r.x+r.width)return!1;if(i.y+i.height<r.y+r.height)return!1;for(var n=0;n<t.length;n++)if(0==this.isPolygonContains(e,t[n]))return!1;for(n=0;n<e.length;n++)for(var o=[e[n],e[(n+1)%e.length]],s=0;s<t.length;s++){var a=t[s],l=t[(s+1)%t.length];if(this.computeIntersectPoint(o,[a,l],!1))return!1}return!0}isPolygonExteriorPolygon(e,t){var i=Cesium.BoundingRectangle.fromPoints(e),r=Cesium.BoundingRectangle.fromPoints(t);if(!(i.x+i.width<r.x||i.y+i.height<r.y||r.x+r.width<i.x||r.y+r.height<i.y)){for(var n=0;n<t.length;n++)if(this.isPolygonContains(e,t[n]))return!1;for(n=0;n<e.length;n++)if(this.isPolygonContains(t,e[n]))return!1;for(n=0;n<e.length;n++)for(var o=[e[n],e[(n+1)%e.length]],s=0;s<t.length;s++){var a=t[s],l=t[(s+1)%t.length];if(this.computeIntersectPoint(o,[a,l],!1))return!1}}return!0}getExportMethods(){return["isClockwise","isPolygonContains","isPolygonContainsPolygon","isPolygonExteriorPolygon"]}};var h=new class{getArea(i,e="kilometer"){console.warn("该方法计算复杂，将在@1.1.5删除");let r=0;for(let t=0;t<i.length-2;t++){var n=(t+1)%i.length,o=(t+2)%i.length;let e=this.computeAngle(i[0],i[n],i[o]);var s=this.judgeDirection([i[0],i[n],i[o]]),s=(e=(e=s?360-e:e)*Math.PI/180,this.getDistance(i[0],i[n])),n=this.getDistance(i[n],i[o]);r+=s*n*Math.sin(e)/2}switch(e){case"kilometer":return Math.abs(r/1e6);case"meter":return Math.abs(r);default:return Math.abs(r/1e6)}}getArea2(e,t="kilometer"){let i=0;var r=this.projectToPlaneX0Y(e[0],e[1],e[2],e);for(let e=0;e<r.length;e++){var n=(e+1)%r.length;i+=(r[e].y+r[n].y)*(r[e].x-r[n].x)/2}switch(t){case"kilometer":return Math.abs(i/1e6);case"meter":return Math.abs(i);default:return Math.abs(i/1e6)}}judgeDirection(t){var i=[];for(let e=0;e<t.length;e++){var r=l.Z.getGlobalCartesian().toCartographic(t[e]);i.push(r)}var e=i[0].longitude,n=i[0].latitude,o=i[1].longitude,s=i[1].latitude,a=i[2].longitude;return 0<(o-e)*(i[2].latitude-s)-(s-n)*(a-o)}getExportMethods(){return["getArea","getArea2","judgeDirection"]}};var A=class{constructor(e){e instanceof Cesium.Matrix4?this._transform=e:e instanceof Cesium.Cartesian3&&(this._transform=Cesium.Transforms.eastNorthUpToFixedFrame(e)),this._transformInverse=Cesium.Matrix4.inverse(this._transform,new Cesium.Cartesian3)}transformToLocal(t){var i=[];for(let e=0;e<t.length;e++){var r=Cesium.Matrix4.multiplyByPoint(this._transformInverse,t[e],new Cesium.Cartesian3);i.push(r)}return i}transformToWorld(t){var i=[];for(let e=0;e<t.length;e++){var r=Cesium.Matrix4.multiplyByPoint(this._transform,t[e],new Cesium.Cartesian3);i.push(r)}return i}};var p=new class{computeTransform(e){return this.computeTransformFromAngle(e,0)}computeTransformFromAngle(e,t){var i=Cesium.Transforms.eastNorthUpToFixedFrame(e),i=Cesium.Matrix4.getMatrix3(i,new Cesium.Matrix3),i=Cesium.Matrix3.multiply(i,Cesium.Matrix3.fromRotationZ(Cesium.Math.toRadians(t)),new Cesium.Matrix3);return Cesium.Matrix4.fromRotationTranslation(i,e,new Cesium.Matrix4)}getExportMethods(){return["computeTransform","computeTransformFromAngle"]}};for(var f=new class{_get3DArc(e,t,i,r){(2<e.length||2<t.length)&&(e=[e[0],e[1],0],t=[t[0],t[1],0]);let n=[];if(r<=0)n.push(...e,...t);else if(1===r)n.push(...e,(e[0]+t[0])/2,(e[1]+t[1])/2,i,...t);else{(n=[]).push(...e,0);var o=this._getMidXY(e,t,r),s=this._getMidH(o,i,e,t);for(let e=0;e<r;e++)n.push(o[2*e],o[2*e+1],s[e]);n.push(...t,0)}return n}_getMidH(e,t){var i=[],r=[e[0],e[1]],n=[e[2],e[3]],o=e.length/2,s=this.getDistance(r,n);let a=[],l=[],u=(l=[s*(1+o),0],t/((a=o%2==1?[s*(Math.floor(o/2)+1),t]:[s*o/2+s/2,t])[0]*(a[0]-l[0])));for(let e=0;e<o;e++){var c=s*(e+1),c=u*c*c-u*c*l[0];i.push(c)}return i}computeMidPoint(e,t){return Cesium.Cartesian3.midpoint(e,t,new Cesium.Cartesian3(0,0,0))}_getMidXY(e,t,i){var r=[],n=(t[0]-e[0])/(i+1),o=(t[1]-e[1])/(i+1),s=e[0],a=e[1];for(let e=0;e<i;e++)r.push(s+(e+1)*n,a+(e+1)*o);return r}computeFootPoint(e,t,i){e=l.Z.getGlobalCartesian().toCartographic(e),t=l.Z.getGlobalCartesian().toCartographic(t);var r=(i=l.Z.getGlobalCartesian().toCartographic(i)).latitude-t.latitude,n=t.longitude-i.longitude,i=i.longitude*t.latitude-t.longitude*i.latitude;return r*r+n*n<1e-13?l.Z.getCartographic().toCartesian(t):Math.abs(r*e.longitude+n*e.latitude+i)<1e-13?l.Z.getCartographic().toCartesian(e):(t=(n*n*e.longitude-r*n*e.latitude-r*i)/(r*r+n*n),i=(-r*n*e.longitude+r*r*e.latitude-n*i)/(r*r+n*n),r=e.height,l.Z.getCartographic().toCartesian({longitude:t,latitude:i,height:r}))}projectToPlaneX0Y(e,t,i,r){var n=new Cesium.Cartesian3(t.x-e.x,t.y-e.y,t.z-e.z),o=new Cesium.Cartesian3(t.x-i.x,t.y-i.y,t.z-i.z),i=Cesium.Cartesian3.cross(n,o,new Cesium.Cartesian3),s=i.x,a=i.y,l=i.z,u=s*t.x+a*t.y+l*t.z,i=(u=-u,Cesium.Cartesian3.cross(n,o,new Cesium.Cartesian3)),o=Cesium.Cartesian3.cross(i,n,o),n=Cesium.Cartesian3.normalize(n,n);if(o=Cesium.Cartesian3.normalize(o,o),i=Cesium.Cartesian3.normalize(i,i),0==Array.isArray(r))return t=-(s*r.x+a*r.y+l*r.z+u),t=((i={x:r.x+(t/=s*s+a*a+l*l)*s-e.x,y:r.y+t*a-e.y,z:r.z+t*l-e.z}).x*n.y-i.y*n.x)/(o.x*n.y-o.y*n.x),i=(i.x*o.y-i.y*o.x)/(n.x*o.y-n.y*o.x),new Cesium.Cartesian3(i,t,0);for(var c=[],h=0;h<r.length;h++){var A=-(s*r[h].x+a*r[h].y+l*r[h].z+u),A=(A/=s*s+a*a+l*l,{x:r[h].x+A*s-e.x,y:r[h].y+A*a-e.y,z:r[h].z+A*l-e.z}),p=(A.x*n.y-A.y*n.x)/(o.x*n.y-o.y*n.x),A=(A.x*o.y-A.y*o.x)/(n.x*o.y-n.y*o.x);c.push(new Cesium.Cartesian3(A,p,0))}return c}getRoutingPath(e){for(var t=[],i=1,r=e.paths[0][0];;){for(var n=!1,o=50,s=[0,0],a=180;0==n;){var l=e.paths[0][i],u=r,c=Math.sqrt((l[0]-u[0])*(l[0]-u[0])+(l[1]-u[1])*(l[1]-u[1]));if(0==c)return t;if(o<=c||i==e.paths[0].length-1){c=o/c;s[0]=(c=1<c?1:c)*(l[0]-u[0])+u[0],s[1]=c*(l[1]-u[1])+u[1],n=!0,r=s,360<(a=(a=180*-Math.atan2(l[1]-u[1],l[0]-u[0])/Math.PI+90)<0?360+a:a)&&(a-=360)}else{if(r=l,++i>=e.paths[0].length)return t;e.paths[0][i],o-=20}}t.push({pos:s,dir:a})}}getRoutingInterpolation(e,t){t=t||20;for(var i=[],r=0,n=1;n<e.length;n++){for(var o=e[n],s=e[n-1],a=Math.sqrt((o[0]-s[0])*(o[0]-s[0])+(o[1]-s[1])*(o[1]-s[1])),l=1,u=0;t*l<r+a;){var c=(t*l-r)/a,h={x:o[0]*c+s[0]*(1-c),y:o[1]*c+s[1]*(1-c),z:0};null!=o[2]&&(h.z=o[2]*c+s[2]*(1-c)),u=180*-Math.atan2(o[1]-s[1],o[0]-s[0])/Math.PI+90,i.push({pos:h,dir:u,index:n-1}),l++}r+=a-t*(l-1),n==e.length-1&&(u=180*-Math.atan2(o[1]-s[1],o[0]-s[0])/Math.PI+90,i.push({pos:{x:o[0],y:o[1],z:null==o[2]?0:o[2]},dir:u,index:n}))}return i}computeAngle(e,t,i){var r=e.x-t.x,n=e.y-t.y,e=e.z-t.z,o=i.x-t.x,s=i.y-t.y,i=i.z-t.z,t=Math.sqrt(r*r+n*n+e*e),a=Math.sqrt(o*o+s*s+i*i),r=180*Math.acos((r*o+n*s+e*i)/(t*a))/Math.PI;return r||0}getNormalVector(e,t,i){var r=(t.y-e.y)*(i.z-e.z)-(t.z-e.z)*(i.y-e.y),n=(t.z-e.z)*(i.x-e.x)-(t.x-e.x)*(i.z-e.z),t=(t.x-e.x)*(i.y-e.y)-(t.y-e.y)*(i.x-e.x);return new Cesium.Cartesian3(r,n,t)}getHeading(e,t){var i=Cesium.Transforms.eastNorthUpToFixedFrame(e),t=Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3),e=Cesium.Matrix4.multiplyByPointAsVector(Cesium.Matrix4.inverse(i,new Cesium.Matrix4),t,new Cesium.Cartesian3),i=Cesium.Cartesian3.normalize(e,new Cesium.Cartesian3),t=Math.atan2(i.y,i.x)-Cesium.Math.PI_OVER_TWO;return Cesium.Math.TWO_PI-Cesium.Math.zeroToTwoPi(t)}getPitch(e,t){var i=Cesium.Transforms.eastNorthUpToFixedFrame(e),t=Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3),e=Cesium.Matrix4.multiplyByPointAsVector(Cesium.Matrix4.inverse(i,i),t,t);return Cesium.Cartesian3.normalize(e,e),Cesium.Math.PI_OVER_TWO-Cesium.Math.acosClamped(e.z)}getHeight(e){var t=Cesium.Cartographic.fromCartesian(e[0]),e=Cesium.Cartographic.fromCartesian(e[1]).height-t.height;return Math.abs(e)}computePartOffset(e,t,i){e=Cesium.Matrix4.inverse(e,new Cesium.Matrix4),t=Cesium.Matrix4.multiplyByPoint(e,t,new Cesium.Cartesian3),e=Cesium.Matrix4.multiplyByPoint(e,i,new Cesium.Cartesian3);return new Cesium.Cartesian3(e.x-t.x,e.y-t.y,e.z-t.z)}getAngleFromMatrix(e){var t,i,r=Math.sqrt(e[0]*e[0]+e[3]*e[3]),r=r<1e-6?(t=Math.atan2(-e[5],e[4]),i=Math.atan2(-e[6],r),0):(t=Math.atan2(e[7],e[8]),i=Math.atan2(-e[6],r),Math.atan2(e[3],e[0]));return new Cesium.Cartesian3(t*(180/Math.PI),i*(180/Math.PI),r*(180/Math.PI))}computeScale(e){var t=e.canvas.clientWidth,i=e.canvas.clientHeight,r=e.camera.getPickRay(new Cesium.Cartesian2(t/2|0,(i-1)/2)),t=e.camera.getPickRay(new Cesium.Cartesian2(1+t/2|0,(i-1)/2)),i=e.globe,r=i.pick(r,e),t=i.pick(t,e);if(Cesium.defined(r)&&Cesium.defined(t))return e=i.ellipsoid.cartesianToCartographic(r),r=i.ellipsoid.cartesianToCartographic(t),(i=new Cesium.EllipsoidGeodesic).setEndPoints(e,r),i.surfaceDistance}keepDecimal(e,t=2,i=!0){return isNaN(e)?NaN:isNaN(t)||t<0||100<t?e:(e=(Math.round(e*Math.pow(10,t))/Math.pow(10,t)).toFixed(t),i?parseFloat(e):e)}getDirection(e,t){t=Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3);return Cesium.Cartesian3.normalize(t,t)}translateByDistance(e,t,i){t=Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3);return this.translateByDirection(e,t,i)}translateByDistanceSalar(e,t,i){var t=Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3),r=Cesium.Cartesian3.magnitude(t),t=Cesium.Cartesian3.multiplyByScalar(t,i/r,new Cesium.Cartesian3);return Cesium.Cartesian3.add(e,t,new Cesium.Cartesian3)}translateByDirection(e,t,i){t=Cesium.Cartesian3.normalize(t,new Cesium.Cartesian3),t=Cesium.Cartesian3.multiplyByScalar(t,i,new Cesium.Cartesian3);return Cesium.Cartesian3.add(e,t,new Cesium.Cartesian3)}createLocalCoordinateHelper(e){return new A(e)}},d=[i,n,o,a,r,u,h,p],g=0;g<d.length;g++)for(var m=d[g].getExportMethods(),y=0;y<m.length;y++)f[m[y]]=d[g][m[y]];var _=f},8706:function(e,t){"use strict";t.Z=new class{get _agcim_server_bim_rest(){return this._agcim_server_bim}set _agcim_server_bim_rest(e){this._agcim_server_bim=e}get _agcim_server_wps_rest(){return this._wps_rest}set _agcim_server_wps_rest(e){this._wps_rest=e}get _agcim_server_meta_rest(){return this._agcloud_meta}set _agcim_server_meta_rest(e){this._agcloud_meta=e}get _agcim_server_dynamic_rest(){return this._dynamic_rest}set _agcim_server_dynamic_rest(e){this._dynamic_rest=e}get _agcim_server_models_rest(){return this._models_rest}set _agcim_server_models_rest(e){this._models_rest=e}constructor(){this._agcim_viewer_rest="/agcim-viewer-rest",this._opus_portal_rest="/opus-portal-rest",this._opus_front_sso="/opus-front-sso",this._agcim_server_bim="/bim-rest",this._wps_rest="/wps-rest",this._agcloud_meta="/agcloud-meta",this._dynamic_rest="/dynamic-rest",this._models_rest="/models-rest",this._agcim_datastore_admin_rest="/agcim-datastore-admin-rest",this._loginAuth="",this.reloadPath()}setOuterKeywords(e){this.outerKeywords=e;e=top.location.href;function i(e){var t=/(\/\/(\S*)\/)/;return e.match(t)&&(e=e.match(t)[0].substring(2,e.match(t)[0].length-1)).substring(0,e.indexOf("/"))||null}this.isInOuter=function(e,t){e=null!=i(e)?i(e):e;t=null!=i(t)?i(t):t;return e===t}(e,this.outerKeywords)}setLoginAuth(e){this._loginAuth=e}setAgcimViewerRest(e){"/"===e[e.length-1]?this._agcim_viewer_rest=e.slice(0,e.length-1):this._agcim_viewer_rest=e,this.reloadPath()}setOpusPortalRest(e){"/"===e[e.length-1]?this._opus_portal_rest=e.slice(0,e.length-1):this._opus_portal_rest=e,this.reloadPath()}setOpusFrontSSO(e){"/"===e[e.length-1]?this._opus_front_sso=e.slice(0,e.length-1):this._opus_front_sso=e,this.reloadPath()}setAgcimServerBIM(e){"/"===e[e.length-1]?this._agcim_server_bim=e.slice(0,e.length-1):this._agcim_server_bim=e,this.reloadPath()}setWpsRest(e){"/"===e[e.length-1]?this._wps_rest=e.slice(0,e.length-1):this._wps_rest=e,this.reloadPath()}setAgcloudMeta(e){"/"===e[e.length-1]?this._agcloud_meta=e.slice(0,e.length-1):this._agcloud_meta=e,this.reloadPath()}setDynamicRest(e){"/"===e[e.length-1]?this._dynamic_rest=e.slice(0,e.length-1):this._dynamic_rest=e,this.reloadPath()}setDatastoreAdminRest(e){"/"===e[e.length-1]?this._agcim_datastore_admin_rest=e.slice(0,e.length-1):this._agcim_datastore_admin_rest=e,this.reloadPath()}setModelsRest(e){"/"===e[e.length-1]?this._models_rest=e.slice(0,e.length-1):this._models_rest=e,this.reloadPath()}getAgcimViewerRest(){return this._agcim_viewer_rest}reloadPath(){this.login=this._opus_front_sso+"/authentication/form",this.styleConfig_get=this._agcim_viewer_rest+"/configManager/styleConfig/get",this.styleConfig_find=this._agcim_viewer_rest+"/configManager/styleConfig/find",this.styleConfig_add=this._agcim_viewer_rest+"/configManager/styleConfig/add",this.styleConfig_update=this._agcim_viewer_rest+"/configManager/styleConfig/update",this.styleConfig_delete=this._agcim_viewer_rest+"/configManager/styleConfig/delete",this.project_getProjectLayerTree=this._agcim_viewer_rest+"/project/getProjectLayerTree",this.project_getProjectInfo=this._agcim_viewer_rest+"/project/getProjectInfo",this.project_findMapParamById=this._agcim_viewer_rest+"/param/findMapParamById",this.dic_getByTypeCodeAndItemName=this._agcim_viewer_rest+"/dic/getByTypeCodeAndItemName",this.dic_getAgDicByTypeCode=this._agcim_viewer_rest+"/dic/getByTypeCode",this.layer_config_selectByLayerId=this._agcim_viewer_rest+"/layer/config/selectByLayerId",this.layer_config_selectNoPageByLayerId=this._agcim_viewer_rest+"/layer/config/selectNoPageByLayerId",this.io_jsonstore_save=this._agcim_viewer_rest+"/io/jsonstore/save",this.io_jsonstore_update=this._agcim_viewer_rest+"/io/jsonstore/update",this.io_jsonstore_deleteById=this._agcim_viewer_rest+"/io/jsonstore/deleteById",this.io_jsonstore_getByDomainAndUsage=this._agcim_viewer_rest+"/io/jsonstore/getByDomainAndUsage",this.io_imagestore_getByDomainAndUsage=this._agcim_viewer_rest+"/io/imagestore/getByDomainAndUsage",this.io_imagestore_save=this._agcim_viewer_rest+"/io/imagestore/save",this.io_imagestore_add=this._agcim_viewer_rest+"/io/imagestore/add",this.io_imagestore_update=this._agcim_viewer_rest+"/io/imagestore/update",this.io_imagestore_deleteById=this._agcim_viewer_rest+"/io/imagestore/deleteById?",this.io_imagestore_updateImage=this._agcim_viewer_rest+"/io/imagestore/uploadImage",this.io_imagestore_selectAuthPageByDirId=this._agcim_viewer_rest+"/io/imagestore/selectAuthPageByDirId",this.io_imagestore_dragSort=this._agcim_viewer_rest+"/io/imagestore/dragSort",this.io_imagestore_convertImageTypes=this._agcim_viewer_rest+"/io/imagestore/convertImageTypes",this.io_imagestore_selectInitialSpotByUser=this._agcim_viewer_rest+"/io/imagestore/selectInitialSpotByUser",this.io_imagestore_selectAuthPageByDirCode=this._agcim_viewer_rest+"/io/imagestore/selectAuthPageByDirCode",this.io_dirimagestore_treeByCode=this._agcim_viewer_rest+"/dirimagestore/treeByCode",this.io_dirimagestore_addDirImage=this._agcim_viewer_rest+"/dirimagestore/add",this.io_dirimagestore_updateDirImage=this._agcim_viewer_rest+"/dirimagestore/update",this.io_dirimagestore_deleteDirImage=this._agcim_viewer_rest+"/dirimagestore/delete",this.io_dirimagestore_dirDragSort=this._agcim_viewer_rest+"/dirimagestore/dragSort",this.io_dirimagestore_deleteCascadeList=this._agcim_viewer_rest+"/dirimagestore/deleteCascadeList",this.keyvalue_save=this._agcim_viewer_rest+"/keyvalue/save",this.func_findFuncByUser=this._agcim_viewer_rest+"/ag/widget/auth/findWidgetByUser",this.checkCodeIsUnique=this._agcim_viewer_rest+"/widget/levels/checkCodeIsUnique",this.findWidgetByCode=this._agcim_viewer_rest+"/widget/levels/getByCode",this.saveOrUpdataWidgetDataByCode=this._agcim_viewer_rest+"/widget/levels/updateByCode",this.saveOrUpdataAllWidgetData=this._agcim_viewer_rest+"/widget/levels/updateBaseInfo",this.keyvalue_findKeyValue=this._agcim_viewer_rest+"/keyvalue/findKeyValue",this.form_commit=this._opus_front_sso+"/authentication/form",this.curr_opus_login_user=this._opus_portal_rest+"/opus/front/om/users/currOpusLoginUser",this.upload_layer_picture=this._agcim_viewer_rest+"/upload/layer_picture/",this.configManager_widgetAssetsTable=this._agcim_viewer_rest+"/configManager/widgetAssetsTable",this.bim_check_statistics=this._agcim_server_bim+"/agsupport/applicationManager/bimCheck/statistics",this.bim_dentity_find=this._agcim_server_bim+"/agsupport/BIM/dentity/find",this.bim_dentity_preview=this._agcim_server_bim+"/agsupport/BIM/dentity/preview",this.bim_dentitya_filter=this._agcim_server_bim+"/agsupport/BIM/dentitya/filter",this.bim_dentitya_find=this._agcim_server_bim+"/agsupport/BIM/dentitya/find",this.bim_dentitya_shortFind=this._agcim_server_bim+"/agsupport/BIM/dentitya/shortFind",this.bim_dentitya_statistics=this._agcim_server_bim+"/agsupport/BIM/dentitya/statistics",this.bim_project_dentity_find=this._agcim_server_bim+"/BIM/dentity/find",this.bim_project_get=this._agcim_server_bim+"/agsupport/BIM/Project/get",this.bim_project_find=this._agcim_server_bim+"/agsupport/BIM/Project/find",this.bim_component_find=this._agcim_server_bim+"/agsupport/BIM/Component/find",this.bim_component_preview=this._agcim_server_bim+"/agsupport/BIM/Component/preview",this.bim_materials_find=this._agcim_server_bim+"/agsupport/BIM/materials/find",this.bim_materials_statistics=this._agcim_server_bim+"/agsupport/BIM/materials/statistics",this.bimParamethy_building_get=this._agcim_server_bim+"/agsupport/bimParamethy/building/get",this.bimParamethy_dentity_get=this._agcim_server_bim+"/agsupport/bimParamethy/dentity/get",this.bimParamethy_dentity_find=this._agcim_server_bim+"/agsupport/bimParamethy/dentity/find",this.bimParamethy_dentity_getMaterial=this._agcim_server_bim+"/agsupport/bimParamethy/dentity/getMaterial",this.bimParamethy_dentity_getGeometry=this._agcim_server_bim+"/agsupport/bimParamethy/dentity/getGeometry",this.bimParamethy_dentity_filter=this._agcim_server_bim+"/agsupport/bimParamethy/dentity/filter",this.bimCost_statistics_get=this._agcim_server_bim+"/agsupport/bimParamethy/building/statisticalPrice51",this.bimParamethy_project=this._agcim_server_bim+"/agsupport/bimParamethy/project/tree",this.configManager_componentCatagoryConfig_tree=this._agcim_server_bim+"/agsupport/configManager/componentCatagoryConfig/tree",this.dic_getAgDicByTypeCode_buildingModelType=this._agcim_server_bim+"/agsupport/dic/getAgDicByTypeCode/BUILDING_MODEL_TYPE",this.bimParamethy_getBIMAdjoinPoint=this._agcim_server_bim+"/rest/bimParamethy/dentity/getBIMAdjoinPoint",this.dic_getByTypeCode_componentType=this._agcim_viewer_rest+"/dic/getByTypeCode/COMPONENT_TYPE",this.bimParamethy_building_list=this._agcim_server_bim+"/bimParamethy/building/list",this.bimParamethy_dentity_listEntity=this._agcim_server_bim+"/bimParamethy/dentity/listEntity",this.bimParamethy_dentity_listMaterial=this._agcim_server_bim+"/bimParamethy/dentity/listMaterial",this.bimDrawing_findDraw=this._agcim_server_bim+"/rest/bimDrawing/findDraw",this.bimDrawing_distance=this._agcim_server_bim+"/rest/bimDrawing/distance",this.bim_project_preview=this._agcim_server_bim+"/agsupport/BIM/Project/preview",this.bim_scheme_get=this._agcim_server_bim+"/agsupport/BIM/scheme/get",this.group_visual_tree=this._agcim_viewer_rest+"/gallery/group/visual/tree",this.group_visual_add=this._agcim_viewer_rest+"/gallery/group/visual/add",this.group_visual_reName=this._agcim_viewer_rest+"/gallery/group/visual/reName",this.group_visual_delete=this._agcim_viewer_rest+"/gallery/group/visual/delete",this.group_gallerys=this._agcim_viewer_rest+"/gallery/group/gallerys",this.visual_delete=this._agcim_viewer_rest+"/gallery/local/visual/delete",this.marker_getMarkers=this._agcim_viewer_rest+"/marker/getMarkers",this.marker_saveMarker=this._agcim_viewer_rest+"/marker/saveMarker",this.marker_deleteMarker=this._agcim_viewer_rest+"/marker/deleteMarker",this.marker_shareMarker=this._agcim_viewer_rest+"/marker/shareMarker",this.marker_user=this._agcim_viewer_rest+"/user/lazy/tree/org/user",this.user_usersByOrgId=this._agcim_viewer_rest+"/user/usersByOrgId",this.apisix_hosts=this._agcim_viewer_rest+"/apisix/hosts.do",this.getArcgisToken=this._agcim_viewer_rest+"/project/getArcgisToken",this.getLayerFieldsByDirLayerId=this._agcim_viewer_rest+"/field/getLayerFieldsByDirLayerId",this.bsc_rest="/bsc-rest/bsc/att/new/downLoadFiles",this.styleList=this._agcim_viewer_rest+"/style/findStyleList",this.uploadFile=this._agcim_viewer_rest+"/viwer/att/upload.do",this.scene_treeAgViwSceneGroup=this._agcim_viewer_rest+"/scene/group/treeAgViwSceneGroup",this.scene_saveOrUpdate=this._agcim_viewer_rest+"/scene/group/saveOrUpdate",this.scene_delAgViwSceneGroupBySceneGroupId=this._agcim_viewer_rest+"/scene/group/delAgViwSceneGroupBySceneGroupId",this.scene_project_saveOrUpdate=this._agcim_viewer_rest+"/scene/saveOrUpdate",this.scene_project_listByPage=this._agcim_viewer_rest+"/scene/listByPage",this.scene_project_delAgViwSceneBySceneId=this._agcim_viewer_rest+"/scene/delAgViwSceneBySceneId",this.scene_exportAgViwScene=this._agcim_viewer_rest+"/scene/exportAgViwScene",this.scene_importAgViwScene=this._agcim_viewer_rest+"/scene/importAgViwScene",this.style_findStyleListPage=this._agcim_viewer_rest+"/style/findStyleListPage",this.geo_entity_getEntityByDlstbsm=this._wps_rest+"/geo/entity/getEntityByDlstbsm",this.geo_entity_getEntityByTybsm=this._wps_rest+"/geo/entity/getEntityByTybsm",this.geo_entity_getEntityByDlstflm=this._wps_rest+"/geo/entity/getEntityByDlstflm",this.geo_entity_treeAndCount=this._wps_rest+"/geo/entity/treeAndCount",this.geo_entity_countTy=this._wps_rest+"/geo/entity/countTy",this.analysis_clusterDbscan=this._wps_rest+"/srv/cluster/analysis/clusterDbscan",this.meta_getCatalogTree=this._agcloud_meta+"/meta/rescenter/catalog/tree",this.dynamic_saveFeature=this._dynamic_rest+"/acs/layer/saveFeature",this.dynamic_updateFeature=this._dynamic_rest+"/acs/layer/updateFeature",this.dynamic_deleteFeature=this._dynamic_rest+"/acs/layer/deleteFeature",this.getMetadata=this._agcim_viewer_rest+"/dir/findLayerByLayerId",this.common_search=this._agcim_datastore_admin_rest+"/ag/dts/es/doc/search"}}},2053:function(e,t,i){"use strict";var o=i(3259);t.Z=new class{constructor(){this.proxyKeys=[],this.getConfigProxyUrl(),this.token=null,this.baseURL=null,this.header=null,this.timeout=null}setToken(e){this.token=e}setBaseUrl(e){this.baseURL=e}setHeader(e){this.header=e}setTimeout(e){this.timeout=e}put(e,t){e=this.getProxyUrl(e);return o.Z.put(e,t,{timeout:3e5})}getConfigProxyUrl(e,t){let r=this;r.proxyKeys=[],t&&(t=e||CIM_LAYERTREE_NAME,o.Z.get(agcim.net.apiPath.projectManager_get+"?name="+t).then(function(e){if(e.success){var t=JSON.parse(e.content).netConfig;for(let e=0;e<t.length;e++){var i={};i[t[e].key]=t[e].value,r.proxyKeys.push(i)}}}))}getProxyUrl(e){for(var t=e,i=0;i<this.proxyKeys.length;i++)if(e.startsWith(this.proxyKeys[i].pre)){t=""+e.substring(this.proxyKeys[i].pre.length+1);break}return t}getData(e,t,i){e=this.getProxyUrl(e);return i?o.Z.get(e,{params:t,headers:i}):o.Z.get(e,{params:t})}getDataByGet(e,t){var i={method:"get",url:this.getProxyUrl(e),timeout:3e5};if(this.header&&(i.headers=this.header),t)for(var r in t)i[r]=t[r];return(0,o.Z)(i)}getDataByPost(e,t,i){var r={method:"POST",url:this.getProxyUrl(e),data:t,timeout:3e5};if(this.header&&(r.headers=this.header),i)for(var n in i)r[n]=i[n];return(0,o.Z)(r)}delete(e,t){e=this.getProxyUrl(e);return this.getDataByPost(e,t)}uploadFile(e,t,i){var e=this.getProxyUrl(e),r=new FormData;return r.append("file",t),(0,o.Z)({url:e,method:"post",headers:{"Content-Type":"multipart/form-data"},timeout:3e5,data:r})}getSibleFileUrl(e,t){return e.substr(0,e.lastIndexOf("/"))+"/"+t}downFile(e,t){e=this.getProxyUrl(e);return o.Z.post(e,t,{responseType:"blob",headers:{"content-type":"application/json"}})}}},3259:function(e,t,i){"use strict";var r=i(9644),i=i.n(r)().create({timeout:1e4,withCredentials:!1});function n(){localStorage.removeItem("access_token"),localStorage.removeItem("token_getTime")}i.defaults.retry=4,i.defaults.retryDelay=500,i.defaults.headers.post["Content-Type"]='application/x-www-form-urlencoded;charset="ISO-8859-1"',i.defaults.headers.post.Accept="application/json; charset=utf-8",i.interceptors.request.use(e=>{var t;return null==e.headers.Authorization&&(t="bearer "+localStorage.getItem("access_token"),e.headers.Authorization=t),e},e=>Promise.error(e)),i.interceptors.response.use(e=>{if("401"!=e.status&&"403"!=e.status)return Promise.resolve(e.data);n()},e=>{if(e.response)switch(e.response.status){case 401:n();case 403:n()}return Promise.reject(e.response.data)}),t.Z=i},2276:function(e,t){"use strict";t.Z=class{constructor(e){this.material=e.material,this.created=!1,this.editAble=!1,this._primitive=null,this._geometry=null,this._isGround=Cesium.defaultValue(e.isGround,!1),this._isCustomPrimitiveTag=!0,this.geometryType=e.geometryType,this.vs=Cesium.defaultValue(e.vs,null),this.fs=Cesium.defaultValue(e.fs,null),this.reflectAble=!1}setTranslation(e,t,i,r){var e=Cesium.Transforms.eastNorthUpToFixedFrame(e),n=new Cesium.Matrix4,t=(Cesium.Matrix4.setTranslation(Cesium.Matrix4.IDENTITY,new Cesium.Cartesian3(t,i,r),n),Cesium.Matrix4.multiply(e,n,e));return Cesium.Matrix4.getTranslation(t,new Cesium.Cartesian3)}setVS(e){this.vs=e}setFS(e=`
        in vec3 v_positionMC;
        in vec3 v_positionEC;
        in vec2 v_st;
        czm_material material; 
        czm_materialInput materialInput;
        void main()
        {
            vec3 positionMC = (czm_inverseModelView * vec4(v_positionEC, 1.0)).xyz;
            //在相机坐标系下,材质的法向量
            vec3 normalEC = normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0))); 
            #ifdef FACE_FORWARD
                normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);
            #endif
            materialInput.s = v_st.s;
            vec3 positionToEyeEC = -v_positionEC;
            materialInput.positionToEyeEC = positionToEyeEC;
            materialInput.st = v_st;
            materialInput.normalEC = normalEC;
            // 根据材质的模型坐标，相机坐标系下的材质的法线向量，生成转换到相机坐标系的矩阵：
            materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC); 
            material = czm_getMaterial(materialInput);
            out_FragColor = vec4(37.0/256.0,66.0/256.0,180.0/256.0,1.0);//
        }
    `){this.fs=e}setEditAble(e){this.editAble=e}replaceFragmentShaderSource(e){this._primitive&&(this._primitive.appearance.fragmentShaderSource=e)}replaceVertexShaderSource(e){this._primitive&&(this._primitive.appearance.vertexShaderSource=e)}replaceMaterial(e){this._primitive&&(this._primitive.appearance.material=e)}replaceUniforms(e){this._primitive&&(this._primitive.appearance.material._uniforms=e)}combineUniforms(e){this._primitive&&(this._primitive.appearance.material._uniforms=Cesium.combine(this._primitive.appearance.material._uniforms,e))}setMaterial(e){this.material=e}setGeometry(e){this._geometry=e}getGeometry(){return this._geometry}generateInstance(){let t=[];var e;return this._geometry instanceof Array?this._geometry.forEach(e=>{e=new Cesium.GeometryInstance({geometry:e});t.push(e)}):(e=new Cesium.GeometryInstance({geometry:this._geometry}),t.push(e)),t}generatePrimitive(){let e=void 0,t=void 0;return"polygon"===this.geometryType||"polylineVolume"===this.geometryType||"wall"===this.geometryType?t=new Cesium.EllipsoidSurfaceAppearance({flat:"polylineVolume"===this.geometryType,material:this.material,vertexShaderSource:this.vs,fragmentShaderSource:this.fs,translucent:!0,renderState:{cull:!1},aboveGround:!1}):"polyline"===this.geometryType&&(t=new Cesium.PolylineMaterialAppearance({material:this.material})),e=this._isGround?new("polyline"!==this.geometryType?Cesium.GroundPrimitive:Cesium.GroundPolylinePrimitive)({geometryInstances:this.generateInstance(),releaseGeometryInstances:!0,appearance:t}):new Cesium.Primitive({geometryInstances:this.generateInstance(),releaseGeometryInstances:!0,appearance:t,asynchronous:!1,show:!0})}clearPrePrimitives(t){for(let e=t._primitives.length-1;-1<e;e--)t._primitives[e]._isCustomPrimitiveTag&&(t.viewer.scene.primitives.remove(t._primitives[e]),t._primitives[e].destroy(),t._primitives.splice(t._primitives.indexOf(t._primitives[e]),1))}update(e){this.created&&!this.editAble||(this._primitive=this.generatePrimitive(),this.agMetaData&&(this._primitive.agMetaData=this.agMetaData),this.created=!0,this.editAble=!1),this._primitive.update(e)}destroy(){this._primitive=null}}},8321:function(e,t,i){"use strict";class r extends i(2276).Z{constructor(e){e.geometryType="polyline",super(e),this.isGround=e.isGround,this._polylinePositions=[]}setPolyLineGeometry(t){this._polylinePositions=[];let r=void 0;if(this.isGround)t instanceof Array?(r=[],t.forEach(e=>{e.positions.forEach(e=>{this._polylinePositions.push(e)});e=new Cesium.GroundPolylineGeometry({positions:e.positions,width:e.width,vertexFormat:Cesium.PolylineMaterialAppearance.VERTEX_FORMAT});r.push(e)})):(t.positions.forEach(e=>{this._polylinePositions.push(e)}),r=new Cesium.GroundPolylineGeometry({positions:t.positions,width:t.width,vertexFormat:Cesium.PolylineMaterialAppearance.VERTEX_FORMAT}));else if(t instanceof Array)r=[],t.forEach(t=>{t.positions.forEach(e=>{this._polylinePositions.push(e)});for(let e=0;e<t.positions.length;e++){var i=t.positions[e];t.positions[e]=super.setTranslation(i,0,0,t.offsetHeight)}var e=new Cesium.PolylineGeometry({positions:t.positions,width:t.width,vertexFormat:Cesium.PolylineMaterialAppearance.VERTEX_FORMAT});r.push(e)});else{t.positions.forEach(e=>{this._polylinePositions.push(e)});for(let e=0;e<t.positions.length;e++){var i=t.positions[e];t.positions[e]=super.setTranslation(i,0,0,t.offsetHeight)}r=new Cesium.PolylineGeometry({positions:t.positions,width:t.width})}super.setGeometry(r),super.setEditAble(!0)}ZoomToMeanCenter(e){var t=new Cesium.Cartesian3(0,0,0),i=this._polylinePositions,r=i.length;for(let e=0;e<r;++e)t.x+=i[e].x,t.y+=i[e].y,t.z+=i[e].z;t.x/=r,t.y/=r,t.z/=r,e.camera.setView({destination:super.setTranslation(t,0,0,3e3)})}}t.Z=r},308:function(e,t,i){"use strict";var r=i(2276),n=i(6252);class o extends r.Z{constructor(e){e.geometryType="polylineVolume",super(e),this._polylinePositions=[]}setPolyLineVolumeGeometry(t){let r=void 0;if(t instanceof Array)r=[],t.forEach(t=>{t.positions.forEach(e=>{this._polylinePositions.push(e)});for(let e=0;e<t.positions.length;e++){var i=t.positions[e];t.positions[e]=super.setTranslation(i,0,0,t.radius+t.offsetHeight)}var e=new Cesium.PolylineVolumeGeometry({vertexFormat:Cesium.VertexFormat.ALL,polylinePositions:t.positions,shapePositions:this.computeCircle(t.radius)});r.push(e)});else{t.positions.forEach(e=>{this._polylinePositions.push(e)});for(let e=0;e<t.positions.length;e++){var i=t.positions[e];t.positions[e]=super.setTranslation(i,0,0,t.radius+t.offsetHeight)}r=new Cesium.PolylineVolumeGeometry({vertexFormat:Cesium.VertexFormat.ALL,polylinePositions:t.positions,shapePositions:this.computeCircle(t.radius)})}super.setGeometry(r),super.setEditAble(!0)}ZoomToMeanCenter(e){var t=this._polylinePositions;n.Z.ZoomToBoxCenter(e,t)}computeCircle(t=1e3){var i=[];for(let e=0;e<360;e++){var r=Cesium.Math.toRadians(e);i.push(new Cesium.Cartesian2(t*Math.cos(r),t*Math.sin(r)))}return i}}t.Z=o},5098:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";var _CustomPolyLinePrimitive_CustomPolyLinePrimitive__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(8321);const defaultMaterial=Cesium.Material.fromType("Color",{color:new Cesium.Color(1,1,1,1)});class NormalPolyLinePrimitiveStyle{constructor(e={}){this.isGround=Cesium.defaultValue(e.isGround,!1),this._material=Cesium.defaultValue(e.material,defaultMaterial),this.offsetHeight=Cesium.defaultValue(e.offsetHeight,10),this.width=Cesium.defaultValue(e.width,2),this.material=this.setMaterial(this._material),this.primitive=void 0}getOptions(){return{isGround:this.isGround,material:this.material,width:this.width,offsetHeight:this.offsetHeight}}_initConfig(e){this.isGround=Cesium.defaultValue(e.isGround,this.isGround),this._material=Cesium.defaultValue(e.material,this.material),this.width=Cesium.defaultValue(e.width,this.width),this.offsetHeight=Cesium.defaultValue(e.offsetHeight,this.width),this.material=this.setMaterial(this._material)}parseConfig(e){e&&this._initConfig(e)}setOffsetHeight(e){this.offsetHeight=e,this.primitive&&(e=this._getPolyLinePosition(dataSource,this.width,this.offsetHeight),this.primitive.setPolyLineGeometry(e))}setNormalPolyLineStyleByDataSource(e,t,i){this._dataSource=e,i&&this.parseConfig(i);i=this._getPolyLinePosition(e,this.width,this.offsetHeight);e.show=!1,this.addPrimitve(t,i)}_getPolyLinePosition(e,t,i){var r,n=e.entities.values,o=[];for(let e=0;e<n.length;e++)n[e].polyline&&((r={}).positions=n[e].polyline._positions._value,r.width=t,r.offsetHeight=i,o.push(r));return o}setMaterial(material){return"string"!=typeof material?this.material=material:material.includes("Cesium.Material")?this.material=eval(material):this.material=new Cesium.Material(material),this.material}addPrimitve(e,t){this.featureLayer=e,this.primitive=new _CustomPolyLinePrimitive_CustomPolyLinePrimitive__WEBPACK_IMPORTED_MODULE_0__.Z(this.getOptions()),this.primitive.setPolyLineGeometry(t),this.featureLayer instanceof agcim.layer.FeatureLayer&&this.featureLayer.addPrimitive(this.primitive)}clearPrePrimitives(t){for(let e=t._primitives.length-1;-1<e;e--)t._primitives[e]._isCustomPrimitiveTag&&(t.viewer.scene.primitives.remove(t._primitives[e]),t._primitives[e].destroy(),t._primitives.splice(t._primitives.indexOf(t._primitives[e]),1))}destroy(){this.primitive&&(this.featureLayer.viewer.scene.primitives.remove(this.primitive),this.primitive.destroy(),this.featureLayer=void 0)}}__webpack_exports__.Z=NormalPolyLinePrimitiveStyle},2596:function(e,t){"use strict";t.Z=class{constructor(e={}){this.color=Cesium.defaultValue(e.color,new Cesium.Color(1,0,0,1)),this.timeSpeed=Cesium.defaultValue(e.timeSpeed,.01),this.repeat=Cesium.defaultValue(e.repeat,new Cesium.Cartesian2(1,1)),this.image=Cesium.defaultValue(e.image,Cesium.Material.DefaultImageId),this.flowdirection=Cesium.defaultValue(e.flowdirection,0),Cesium.Material.PolylineTrailLinkType="PolylineTrailLink",Cesium.Material.PolylineTrailLinkImage=this.image,Cesium.Material.PolylineTrailLinkSource=`czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);
    vec2 v_st = materialInput.st;
    vec3 fragToCameraVector = (czm_view * vec4(czm_viewerPositionWC,1.0)).xyz + materialInput.positionToEyeEC;
    float distance = length(fragToCameraVector);
    float visiableFactor = clamp(((30000.0-distance)/30000.0),-1.0,1.0);
    float repeatBydistance = clamp((30000.0 - czm_eyeHeight)/30000.0,0.1,1.0);
    float repeatX  = repeat.x * repeatBydistance;
    vec4 colorImage = texture(image, vec2(fract(v_st.s * repeatX - czm_frameNumber * timeSpeed), v_st.t));
    if(colorImage.r > 0.0) {
        material.alpha = colorImage.a;
        material.diffuse = colorImage.rgb; //color.rgb *
    }
     else{
        material.diffuse = color.rgb;
        material.alpha = color.a;
    }
    return material;
}`,Cesium.Material._materialCache.addMaterial(Cesium.Material.PolylineTrailLinkType,{fabric:{type:Cesium.Material.PolylineTrailLinkType,uniforms:{color:this.color,repeat:this.repeat,image:Cesium.Material.PolylineTrailLinkImage,timeSpeed:this.timeSpeed,flowdirection:this.flowdirection},source:Cesium.Material.PolylineTrailLinkSource},translucent:function(){return!0}}),this.material=Cesium.Material.fromType("PolylineTrailLink")}}},5280:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";var _PolylineTrailLinkMaterial__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2596),_CustomPolyLinePrimitive_CustomPolyLinePrimitive__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(8321);class TrailLinkPolyLinePrimitiveStyle{constructor(e={}){this._initConfig(e),this.primitive=void 0}_initConfig(e){this.isGround=Cesium.defaultValue(e.isGround,!1),this._color=Cesium.defaultValue(e.color,Cesium.Color.RED),this.color=this._setColor(this._color),this.timeSpeed=Number(Cesium.defaultValue(e.timeSpeed,.01)),this.repeat=Cesium.defaultValue(e.repeat,new Cesium.Cartesian2(1,1)),this.image=Cesium.defaultValue(e.image,Cesium.Material.DefaultImageId),this.offsetHeight=Number(Cesium.defaultValue(e.offsetHeight,0,0)),this.width=Number(Cesium.defaultValue(e.width,10)),this.flowdirection=Cesium.defaultValue(e.flowdirection,0),this.material=new _PolylineTrailLinkMaterial__WEBPACK_IMPORTED_MODULE_0__.Z(this.getOptions()).material}_setColor(color){return"string"!=typeof color?this.color=color:color.includes("Cesium.Color")?this.color=eval(color):this.color=new Cesium.Color(color),this.color}getOptions(){return{color:this.color,width:this.width,timeSpeed:this.timeSpeed,image:this.image,material:this.material,isGround:this.isGround,offsetHeight:this.offsetHeight,repeat:this.repeat,flowdirection:this.flowdirection}}setColor(e){this._setColor(e),this.primitive&&this.primitive.setMaterial(new _PolylineTrailLinkMaterial__WEBPACK_IMPORTED_MODULE_0__.Z(this.getOptions()).material)}setTimeSpeed(e){this.timeSpeed=Number(Cesium.defaultValue(e,this.timeSpeed)),this.primitive&&this.primitive.setMaterial(new _PolylineTrailLinkMaterial__WEBPACK_IMPORTED_MODULE_0__.Z(this.getOptions()).material)}setImage(e){this.image=e,this.primitive&&this.primitive.setMaterial(new _PolylineTrailLinkMaterial__WEBPACK_IMPORTED_MODULE_0__.Z(this.getOptions()).material)}setWidth(e){this.width=e,this.primitive&&this.primitive.setMaterial(new _PolylineTrailLinkMaterial__WEBPACK_IMPORTED_MODULE_0__.Z(this.getOptions()).material)}setOffsetHeight(e){this.offsetHeight=e,this.primitive&&(e=this._getPolyLinePosition(dataSource,this.width,this.offsetHeight),this.primitive.setPolyLineGeometry(e))}parseConfig(e){e&&this._initConfig(e)}setTrialLinkPolyLineStyleByDataSource(e,t,i){this._dataSource=e,i&&this.parseConfig(i);i=this._getPolyLinePosition(e,this.radius,this.offsetHeight);e.show=!1,this.addPrimitve(t,i)}_getPolyLinePosition(e,t,i){var r,n,o=e.entities.values,s=[];for(let e=0;e<o.length;e++)o[e].polyline&&(r={},n=o[e].polyline._positions._value,r.positions=n,r.radius=t,r.offsetHeight=i,s.push(r));return s}addPrimitve(e,t){this.featureLayer=e,this.primitive=new _CustomPolyLinePrimitive_CustomPolyLinePrimitive__WEBPACK_IMPORTED_MODULE_1__.Z(this.getOptions()),this.primitive.setPolyLineGeometry(t),this.featureLayer instanceof agcim.layer.FeatureLayer&&this.featureLayer.addPrimitive(this.primitive)}clearPrePrimitives(t){for(let e=t._primitives.length-1;-1<e;e--)t._primitives[e]._isCustomPrimitiveTag&&(t.viewer.scene.primitives.remove(t._primitives[e]),t._primitives[e].destroy(),t._primitives.splice(t._primitives.indexOf(t._primitives[e]),1))}destroy(){this.primitive&&(this.featureLayer.viewer.scene.primitives.remove(this.primitive),this.primitive.destroy(),this.featureLayer=void 0),this._dataSource=void 0,this.isGround=void 0,this._color=void 0,this.color=void 0,this.timeSpeed=void 0,this.image=void 0,this.offsetHeight=void 0,this.radius=void 0,this.material=void 0}}__webpack_exports__.Z=TrailLinkPolyLinePrimitiveStyle},5650:function(e,t){"use strict";t.Z=class{constructor(e={}){this.color=Cesium.defaultValue(e.color,new Cesium.Color(1,0,0,1)),this.timeSpeed=Cesium.defaultValue(e.timeSpeed,.01),this.image=Cesium.defaultValue(e.image,Cesium.Material.DefaultImageId),this.repeat=Cesium.defaultValue(e.repeat,new Cesium.Cartesian2(1,1)),this.flowdirection=Cesium.defaultValue(e.flowdirection,0),Cesium.Material.PolylineTrailLinkType="PolylineTrailLink",Cesium.Material.PolylineTrailLinkImage=this.image,Cesium.Material.PolylineTrailLinkSource=`czm_material czm_getMaterial(czm_materialInput materialInput)
{
czm_material material = czm_getDefaultMaterial(materialInput);
vec2 v_st = materialInput.st;
vec3 fragToCameraVector = (czm_view * vec4(czm_viewerPositionWC,1.0)).xyz + materialInput.positionToEyeEC;
float distance = length(fragToCameraVector);
float visiableFactor = clamp(((30000.0-distance)/30000.0),-1.0,1.0);
float repeatBydistance = clamp((30000.0 - czm_eyeHeight)/30000.0,0.1,1.0);
float repeatX  = repeat.x * repeatBydistance;
vec4 colorImage = texture(image, vec2(fract(v_st.s * repeatX - czm_frameNumber * timeSpeed), v_st.t));
if(colorImage.r > 0.0) {
    material.alpha = colorImage.a;
    material.diffuse = colorImage.rgb; //color.rgb *
}
 else{
    material.diffuse = color.rgb;
    material.alpha = color.a;
}
return material;
}`,Cesium.Material._materialCache.addMaterial(Cesium.Material.PolylineTrailLinkType,{fabric:{type:Cesium.Material.PolylineTrailLinkType,uniforms:{color:this.color,repeat:this.repeat,image:Cesium.Material.PolylineTrailLinkImage,timeSpeed:this.timeSpeed,flowdirection:this.flowdirection},source:Cesium.Material.PolylineTrailLinkSource},translucent:function(){return!0}}),this.material=Cesium.Material.fromType("PolylineTrailLink")}}},974:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";var _PolylineTrailLinkMaterial__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(5650),_CustomPolyLineVolumePrimitive_CustomPolyLineVolumePrimitive__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(308);class TrailLinkPolyLineVolumePrimitiveStyle{constructor(e={}){this._initConfig(e),this.primitive=void 0}_initConfig(e){this.isGround=Cesium.defaultValue(e.isGround,!1),this._color=Cesium.defaultValue(e.color,Cesium.Color.RED),this.color=this._setColor(this._color),this.timeSpeed=Number(Cesium.defaultValue(e.timeSpeed,.01)),this.repeat=Cesium.defaultValue(e.repeat,new Cesium.Cartesian2(1,1)),this.image=Cesium.defaultValue(e.image,Cesium.Material.DefaultImageId),this.offsetHeight=Number(Cesium.defaultValue(e.offsetHeight,0,0)),this.radius=Number(Cesium.defaultValue(e.radius,10)),this.flowdirection=Cesium.defaultValue(e.flowdirection,0),this.material=new _PolylineTrailLinkMaterial__WEBPACK_IMPORTED_MODULE_1__.Z(this.getOptions()).material}_setColor(color){return"string"!=typeof color?this.color=color:color.includes("Cesium.Color")?this.color=eval(color):this.color=new Cesium.Color(color),this.color}getOptions(){return{color:this.color,radius:this.radius,timeSpeed:this.timeSpeed,image:this.image,material:this.material,isGround:this.isGround,offsetHeight:this.offsetHeight,repeat:this.repeat,flowdirection:this.flowdirection}}setRepeat(e){this.repeat=e,this.primitive&&this.primitive.setMaterial(new _PolylineTrailLinkMaterial__WEBPACK_IMPORTED_MODULE_1__.Z(this.getOptions()).material)}setFlowdirection(e){this.flowdirection=e,this.primitive&&this.primitive.setMaterial(new _PolylineTrailLinkMaterial__WEBPACK_IMPORTED_MODULE_1__.Z(this.getOptions()).material)}setColor(e){this._setColor(e),this.primitive&&this.primitive.setMaterial(new _PolylineTrailLinkMaterial__WEBPACK_IMPORTED_MODULE_1__.Z(this.getOptions()).material)}setTimeSpeed(e){this.timeSpeed=Number(Cesium.defaultValue(e,this.timeSpeed)),this.primitive&&this.primitive.setMaterial(new _PolylineTrailLinkMaterial__WEBPACK_IMPORTED_MODULE_1__.Z(this.getOptions()).material)}setImage(e){this.image=e,this.primitive&&this.primitive.setMaterial(new _PolylineTrailLinkMaterial__WEBPACK_IMPORTED_MODULE_1__.Z(this.getOptions()).material)}setRadius(e){this.radius=e,this.primitive&&this.primitive.setMaterial(new _PolylineTrailLinkMaterial__WEBPACK_IMPORTED_MODULE_1__.Z(this.getOptions()).material)}setOffsetHeight(e){this.offsetHeight=e,this.primitive&&(e=this._getPolyLinePosition(dataSource,this.radius,this.offsetHeight),this.primitive.setPolyLineVolumeGeometry(e))}parseConfig(e){e&&this._initConfig(e)}setTrialLinkPolyLineVolumeStyleByDataSource(e,t,i){this._dataSource=e,i&&this.parseConfig(i);i=this._getPolyLinePosition(e,this.radius,this.offsetHeight);e.show=!1,this.addPrimitve(t,i)}_getPolyLinePosition(e,t,i){var r,n,o=e.entities.values,s=[];for(let e=0;e<o.length;e++)o[e].polyline&&(r={},n=o[e].polyline._positions._value,r.positions=n,r.radius=t,r.offsetHeight=i,s.push(r));return s}addPrimitve(e,t){this.featureLayer=e,this.primitive=new _CustomPolyLineVolumePrimitive_CustomPolyLineVolumePrimitive__WEBPACK_IMPORTED_MODULE_0__.Z(this.getOptions()),this.primitive.setPolyLineVolumeGeometry(t),this.featureLayer instanceof agcim.layer.FeatureLayer&&this.featureLayer.addPrimitive(this.primitive)}clearPrePrimitives(t){for(let e=t._primitives.length-1;-1<e;e--)t._primitives[e]._isCustomPrimitiveTag&&(t.viewer.scene.primitives.remove(t._primitives[e]),t._primitives[e].destroy(),t._primitives.splice(t._primitives.indexOf(t._primitives[e]),1))}destroy(){this.primitive&&(this.featureLayer.viewer.scene.primitives.remove(this.primitive),this.primitive.destroy(),this.featureLayer=void 0),this._dataSource=void 0,this.isGround=void 0,this._color=void 0,this.color=void 0,this.timeSpeed=void 0,this.image=void 0,this.offsetHeight=void 0,this.radius=void 0,this.material=void 0}}__webpack_exports__.Z=TrailLinkPolyLineVolumePrimitiveStyle},6421:function(e,t,i){"use strict";var r=i(2276),n=i(6252);class o extends r.Z{constructor(e){e.geometryType="polygon",super(e),this.isGround=e.isGround,this.isGround||(this.height=e.height,this.extrudedHeight=e.extrudedHeight),this._polygonPositions=[]}setPolygonGeometry(e){this._polygonPositions=[];let t=void 0;this.isGround?e instanceof Array?(t=[],e.forEach(e=>{e.positions.forEach(e=>{this._polygonPositions.push(e)});e=new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(e.positions,e.holes)});t.push(e)})):(e.positions.forEach(e=>{this._polygonPositions.push(e)}),t=new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(e.positions,e.holes)})):e instanceof Array?(t=[],e.forEach(e=>{e.positions.forEach(e=>{this._polygonPositions.push(e)});e=new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(e.positions,e.holes),vertexFormat:Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,extrudedHeight:this.extrudedHeight,height:this.height});t.push(e)})):(e.positions.forEach(e=>{this._polygonPositions.push(e)}),t=new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(e.positions,e.holes),vertexFormat:Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,extrudedHeight:this.extrudedHeight,height:this.height})),super.setGeometry(t),super.setEditAble(!0)}setTranslation(e,t,i,r){var e=Cesium.Transforms.eastNorthUpToFixedFrame(e),n=new Cesium.Matrix4,t=(Cesium.Matrix4.setTranslation(Cesium.Matrix4.IDENTITY,new Cesium.Cartesian3(t,i,r),n),Cesium.Matrix4.multiply(e,n,e));return Cesium.Matrix4.getTranslation(t,new Cesium.Cartesian3)}ZoomToMeanCenter(e){var t=this._polygonPositions;n.Z.ZoomToBoxCenter(e,t)}setHeight(e){this.isGround||(this.height=e,super.setEditAble(!0))}setExtrudedHeight(e){this.isGround||(this.extrudedHeight=e,super.setEditAble(!0))}}t.Z=o},4257:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";var _CustomPolygonPrimitive_CustomPolygonPrimitive__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6421);const defaultMaterial=Cesium.Material.fromType("Color",{color:new Cesium.Color(1,1,1,1)});class NormalPolygonPrimitiveStyle{constructor(e={}){this.isGround=Cesium.defaultValue(e.isGround,!1),this._material=Cesium.defaultValue(e.material,defaultMaterial),this.isGround||(this.height=Number(Cesium.defaultValue(e.height,0)),this.extrudedHeight=Number(Cesium.defaultValue(e.extrudedHeight,10))),this.material=this.setMaterial(this._material),this.primitive=void 0}_initConfig(e){this.isGround=Cesium.defaultValue(e.isGround,this.isGround),this.isGround||(this.height=Number(Cesium.defaultValue(e.height,this.height)),this.extrudedHeight=Number(Cesium.defaultValue(e.extrudedHeight,this.extrudedHeight))),this._material=Cesium.defaultValue(e.material,this.material),this.material=this.setMaterial(this._material)}getOptions(){return{isGround:this.isGround,material:this.material,height:this.height,extrudedHeight:this.extrudedHeight}}parseConfig(e){e&&this._initConfig(e)}setNormalPolygonStyleByDataSource(e,t,i){this._dataSource=e,i&&this.parseConfig(i);i=this._getPolygonPosition(e);e.show=!1,this.addPrimitve(t,i)}_getPolygonPosition(e){var t=e.entities.values,i=[];this._pointsArray=[];for(let e=0;e<t.length;e++)if(t[e].polygon){var r=t[e].polygon.hierarchy._value,n=(this._pointsArray.push(r),r.positions),o=r.holes,s=[];if(0<o.length)for(let e=0;e<o.length;e++)s.push(new Cesium.PolygonHierarchy(o[e].positions));i.push({positions:n,holes:s})}return i}setMaterial(material){return"string"!=typeof material?this.material=material:material.includes("Cesium.Material")?this.material=eval(material):this.material=new Cesium.Material(material),this.material}setHeight(e){this.isGround||(this.height=Number(e),this.primitive&&this.primitive.setHeight(e))}setExtrudedHeight(e){this.isGround||(this.extrudedHeight=Number(e),this.primitive&&this.primitive.setExtrudedHeight(e))}addPrimitve(e,t){this.featureLayer=e,this.material&&(this.primitive=new _CustomPolygonPrimitive_CustomPolygonPrimitive__WEBPACK_IMPORTED_MODULE_0__.Z(this.getOptions()),this.primitive.setPolygonGeometry(t),this.featureLayer instanceof agcim.layer.FeatureLayer)&&this.featureLayer.addPrimitive(this.primitive)}clearPrePrimitives(t){for(let e=t._primitives.length-1;-1<e;e--)t._primitives[e]._isCustomPrimitiveTag&&(t.viewer.scene.primitives.remove(t._primitives[e]),t._primitives[e].destroy(),t._primitives.splice(t._primitives.indexOf(t._primitives[e]),1))}destroy(){this.primitive&&(this.featureLayer.viewer.scene.primitives.remove(this.primitive),this.primitive.destroy(),this.featureLayer=void 0)}}__webpack_exports__.Z=NormalPolygonPrimitiveStyle},8061:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";var _CustomPolygonPrimitive_CustomPolygonPrimitive__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6421),_WaterGlslSource__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4167);class NormalWaterStyle{constructor(e={}){this.frequency=Number(Cesium.defaultValue(e.frequency,3e3)),this.animationSpeed=Number(Cesium.defaultValue(e.animationSpeed,.01)),this.amplitude=Number(Cesium.defaultValue(e.amplitude,3)),this.specularIntensity=Number(Cesium.defaultValue(e.specularIntensity,1)),this._baseWaterColor=Cesium.defaultValue(e.baseWaterColor,"rgba(37,66,180,1.0)"),this.alpha=Number(Cesium.defaultValue(e.alpha,.7)),this.setWaterColor(this._baseWaterColor),this.waterNormalMap=Cesium.defaultValue(e.waterNormalMap,Cesium.defaultValue(Cesium.buildModuleUrl("Assets/Textures/waterNormals.jpg"),Cesium.Material.DefaultImageId)),this.repeatX=Number(Cesium.defaultValue(e.repeatX,1)),this.repeatY=Number(Cesium.defaultValue(e.repeatY,1)),this.flowdirection=Number(Cesium.defaultValue(e.flowdirection,5)),this.flowSpeed=Number(Cesium.defaultValue(e.flowSpeed,1)),this.isGround=Cesium.defaultValue(e.isGround,!1),this.isGround||(this.height=Number(Cesium.defaultValue(e.height,0)),this.extrudedHeight=Number(Cesium.defaultValue(e.extrudedHeight,10))),this.vs=Cesium.defaultValue(e.vs,null),this.fs=Cesium.defaultValue(e.fs,null),this.primitive=void 0}getPrimitive(){return this.primitive}_initConfig(e){this.frequency=Number(Cesium.defaultValue(e.frequency,this.frequency)),this.animationSpeed=Number(Cesium.defaultValue(e.animationSpeed,this.animationSpeed)),this.amplitude=Number(Cesium.defaultValue(e.amplitude,this.amplitude)),this.specularIntensity=Number(Cesium.defaultValue(e.specularIntensity,this.specularIntensity)),this.alpha=Number(Cesium.defaultValue(e.alpha,this.alpha)),this.baseWaterColor=Cesium.defaultValue(e.baseWaterColor,this.baseWaterColor),this.waterNormalMap=Cesium.defaultValue(e.waterNormalMap,this.waterNormalMap),this.repeatX=Number(Cesium.defaultValue(e.repeatX,this.repeatX)),this.repeatY=Number(Cesium.defaultValue(e.repeatY,this.repeatY)),this.flowdirection=Number(Cesium.defaultValue(e.flowdirection,this.flowdirection)),this.flowSpeed=Number(Cesium.defaultValue(e.flowSpeed,this.flowSpeed)),this.isGround=Cesium.defaultValue(e.isGround,this.isGround),this.isGround||(this.height=Number(Cesium.defaultValue(e.height,this.height)),this.extrudedHeight=Number(Cesium.defaultValue(e.extrudedHeight,this.extrudedHeight))),this.vs=Cesium.defaultValue(e.vs,this.vs),this.fs=Cesium.defaultValue(e.fs,this.fs)}parseConfig(lyConfig){if(lyConfig){if(lyConfig.baseWaterColor){let baseWaterColor=lyConfig.baseWaterColor;baseWaterColor.includes("#")||baseWaterColor.includes("rgb")||baseWaterColor.includes("rgba")||(lyConfig.baseWaterColor=eval(baseWaterColor))}this._initConfig(lyConfig)}}setWaterStyleByDataSource(e,t,i){i&&this.parseConfig(i);i=this._getPolygonHierarchy(e);e.show=!1,this.addPrimitve(t,i),this.primitive.agMetaData=e.agMetaData}_getPolygonHierarchy(e){var t=e.entities.values,i=[];this._pointsArray=[];for(let e=0;e<t.length;e++)if(t[e].polygon){var r=t[e].polygon.hierarchy._value,n=(this._pointsArray.push(r),r.positions),o=r.holes,s=[];if(0<o.length)for(let e=0;e<o.length;e++)s.push(new Cesium.PolygonHierarchy(o[e].positions));i.push({positions:n,holes:s})}return i}addPrimitve(e,t){this.featureLayer=e,this.viewer=e.viewer,this.primitive=new _CustomPolygonPrimitive_CustomPolygonPrimitive__WEBPACK_IMPORTED_MODULE_0__.Z({isGround:this.isGround,height:this.height,extrudedHeight:this.extrudedHeight,material:this.getWaterMaterial()}),this.primitive.setPolygonGeometry(t),this.featureLayer instanceof agcim.layer.FeatureLayer&&this.featureLayer.addPrimitive(this.primitive)}getWaterMaterial(){return this._setWaterMaterial({waterNormalMap:this.waterNormalMap,frequency:this.frequency,animationSpeed:this.animationSpeed,amplitude:this.amplitude,specularIntensity:this.specularIntensity,baseWaterColor:this.baseWaterColor,repeatX:this.repeatX,repeatY:this.repeatY,flowdirection:this.flowdirection,flowSpeed:this.flowSpeed})}setFrequency(e){this.frequency=Number(e),this.primitive&&this.primitive.setMaterial(this.setWaterMaterial())}setAnimationSpeed(e){this.animationSpeed=Number(e),this.primitive&&this.primitive.setMaterial(this.setWaterMaterial())}setAmplitude(e){this.amplitude=Number(e),this.primitive&&this.primitive.setMaterial(this.setWaterMaterial())}setSpecularIntensity(e){this.specularIntensity=Number(e),this.primitive&&this.primitive.setMaterial(this.setWaterMaterial())}setWaterColor(e){e&&("string"!=typeof e?this.baseWaterColor=e:e.includes("#")?this.baseWaterColor=Cesium.Color.fromCssColorString(e).withAlpha(this.alpha):e.includes("rgba")?this.baseWaterColor=Cesium.Color.fromCssColorString(e):e.includes("rgb")&&(this.baseWaterColor=Cesium.Color.fromCssColorString(e).withAlpha(this.alpha)),this.primitive)&&this.primitive.setMaterial(this.setWaterMaterial())}setWaterNormalMap(e){this.waterNormalMap=Cesium.defaultValue(e,Cesium.defaultValue(Cesium.buildModuleUrl("Assets/Textures/waterNormals.jpg"),Cesium.Material.DefaultImageId))}setRepeatX(e){this.repeatX=Number(Cesium.defaultValue(e,1))}setRepeatY(e){this.repeatY=Number(Cesium.defaultValue(e,1))}setFlowdirection(e){this.flowdirection=Number(Cesium.defaultValue(e,5))}setFlowSpeed(e){this.flowSpeed=Number(Cesium.defaultValue(e,1))}setIsGround(e){this.isGround=Cesium.defaultValue(e,!1)}setAlpha(e){this.alpha=e,this.primitive&&this.primitive.setMaterial(this.setWaterMaterial())}setHeight(e){this.isGround||(this.height=Number(e),this.primitive&&this.primitive.setHeight(e))}setExtrudedHeight(e){this.isGround||(this.extrudedHeight=Number(e),this.primitive&&this.primitive.setExtrudedHeight(e))}setVs(e){this.vs=e}setFs(e){this.fs=e}_setWaterMaterial(e){return new Cesium.Material({fabric:{type:"Water",uniforms:{baseWaterColor:e.baseWaterColor||new Cesium.Color.fromBytes(105,180,105,60),normalMap:e.waterNormalMap,frequency:e.frequency,animationSpeed:e.animationSpeed,amplitude:e.amplitude,specularIntensity:e.specularIntensity,repeat:{x:e.repeatX,y:e.repeatY},flowdirection:e.flowdirection,flowSpeed:e.flowSpeed},source:e.repeatX&&e.repeatY?_WaterGlslSource__WEBPACK_IMPORTED_MODULE_1__.Z:null}})}setWaterMaterial(e){this.waterNormalMap=e.waterNormalMap,this.frequency=e.frequency,this.animationSpeed=e.animationSpeed,this.amplitude=e.amplitude,this.specularIntensity=e.specularIntensity,this.baseWaterColor=e.baseWaterColor,this.repeatX=e.repeatX,this.repeatY=e.repeatY,this.flowdirection=e.flowdirection,this.flowSpeed=e.flowSpeed}clearPrePrimitives(t){for(let e=t._primitives.length-1;-1<e;e--)t._primitives[e]._isCustomPrimitiveTag&&(t.viewer.scene.primitives.remove(t._primitives[e]),t._primitives[e].destroy(),t._primitives.splice(t._primitives.indexOf(t._primitives[e]),1))}dispose(){this.primitive&&(this.featureLayer.viewer.scene.primitives.remove(this.primitive),this.primitive.destroy(),this.featureLayer=void 0),this.viewer=void 0}}__webpack_exports__.Z=NormalWaterStyle},4167:function(e,t){"use strict";t.Z=`
uniform sampler2D specularMap;
uniform sampler2D normalMap;
uniform vec4 baseWaterColor;
uniform vec4 blendColor;
uniform vec2 repeat;
uniform float frequency;
uniform float animationSpeed;
uniform float amplitude;
uniform float specularIntensity;
uniform float fadeFactor;
uniform float flowdirection;
uniform float flowSpeed;

czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);

    float time = czm_frameNumber * animationSpeed;

    // fade is a function of the distance from the fragment and the frequency of the waves
    float fade = max(1.0, (length(materialInput.positionToEyeEC) / 10000000000.0) * frequency * fadeFactor);

    float specularMapValue = texture(specularMap, materialInput.st).r;

    vec2 v_st = materialInput.st;

    //法线贴图动画uv //重复采样贴图
    if(repeat.x/repeat.y > 1.0){
        v_st = vec2(fract(v_st.s * floor(repeat.x/repeat.y)), fract(v_st.t * 1.0));
    }else if(repeat.y/repeat.x > 1.0){
        v_st = vec2(fract(v_st.s * 1.0), fract(v_st.t * floor(repeat.y/repeat.x)));
    }
    
    //东：0.0,南：1.0,西：2.0,北：3.0; 无方向：5.0
    if(flowdirection == 0.0) {
        v_st = vec2(fract((v_st.s - time*flowSpeed)), v_st.t);
    } else if(flowdirection == 1.0) {
        v_st = vec2(v_st.s, fract((v_st.t-time*flowSpeed)));
    } else if(flowdirection == 2.0) {
        v_st = vec2(fract((v_st.s + time*flowSpeed)), v_st.t);
    } else if(flowdirection == 3.0) {
        v_st = vec2(v_st.s, fract((v_st.t+time*flowSpeed)));
    } 
    // note: not using directional motion at this time, just set the angle to 0.0;
    vec4 noise = czm_getWaterNoise(normalMap,  v_st * frequency, time, 0.0);
    vec3 normalTangentSpace = noise.xyz * vec3(1.0, 1.0, (1.0 / amplitude));

    // fade out the normal perturbation as we move further from the water surface
    normalTangentSpace.xy /= fade;

    // attempt to fade out the normal perturbation as we approach non water areas (low specular map value)
    normalTangentSpace = mix(vec3(0.0, 0.0, 50.0), normalTangentSpace, specularMapValue);

    normalTangentSpace = normalize(normalTangentSpace);

    // get ratios for alignment of the new normal vector with a vector perpendicular to the tangent plane
    float tsPerturbationRatio = clamp(dot(normalTangentSpace, vec3(0.0, 0.0, 1.0)), 0.0, 1.0);

    // fade out water effect as specular map value decreases
    material.alpha = mix(blendColor.a, baseWaterColor.a, specularMapValue) * specularMapValue;

    // base color is a blend of the water and non-water color based on the value from the specular map
    // may need a uniform blend factor to better control this
    material.diffuse = mix(blendColor.rgb, baseWaterColor.rgb, specularMapValue);

    // diffuse highlights are based on how perturbed the normal is
    material.diffuse += (0.1 * tsPerturbationRatio);

    material.diffuse = material.diffuse;

    material.normal = normalize(materialInput.tangentToEyeMatrix * normalTangentSpace);

    material.specular = specularIntensity;
    material.shininess = 10.0;

    return material;
}
`},259:function(e,t,i){"use strict";class r extends i(2276).Z{constructor(e){e.geometryType="wall",super(e),this.isGround=e.isGround,this._polylinePositions=[]}setWallGeometry(t){this._polylinePositions=[];let r=void 0;if(this.isGround)t instanceof Array?(r=[],t.forEach(e=>{e.positions.forEach(e=>{this._polylinePositions.push(e)});e=new Cesium.WallGeometry({positions:e.positions,maximumHeights:e.maximumHeights,minimumHeights:e.minimumHeights});r.push(e)})):(t.positions.forEach(e=>{this._polylinePositions.push(e)}),r=new Cesium.WallGeometry({positions:t.positions,maximumHeights:t.maximumHeights,minimumHeights:t.minimumHeights}));else if(t instanceof Array)r=[],t.forEach(t=>{t.positions.forEach(e=>{this._polylinePositions.push(e)});for(let e=0;e<t.positions.length;e++){var i=t.positions[e];t.positions[e]=super.setTranslation(i,0,0,t.offsetHeight)}var e=new Cesium.WallGeometry({maximumHeights:t.maximumHeights,minimumHeights:t.minimumHeights,positions:t.positions});r.push(e)});else{t.positions.forEach(e=>{this._polylinePositions.push(e)});for(let e=0;e<t.positions.length;e++){var i=t.positions[e];t.positions[e]=super.setTranslation(i,0,0,t.offsetHeight)}r=new Cesium.WallGeometry({positions:t.positions,maximumHeights:t.maximumHeights,minimumHeights:t.minimumHeights})}super.setGeometry(r),super.setEditAble(!0)}ZoomToMeanCenter(e){var t=new Cesium.Cartesian3(0,0,0),i=this._polylinePositions,r=i.length;for(let e=0;e<r;++e)t.x+=i[e].x,t.y+=i[e].y,t.z+=i[e].z;t.x/=r,t.y/=r,t.z/=r,e.camera.setView({destination:super.setTranslation(t,0,0,3e3)})}}t.Z=r},6182:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";var _WallTrailLinkMaterial__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(852),_CustomWallPrimitive_CustomWallPrimitive__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(259);class TrailLinkWallPrimitiveStyle{constructor(e={}){this._initConfig(e),this.primitive=void 0}_initConfig(e){this.isGround=Cesium.defaultValue(e.isGround,!1),this._color=Cesium.defaultValue(e.color,Cesium.Color.RED),this.color=this._setColor(this._color),this.timeSpeed=Number(Cesium.defaultValue(e.timeSpeed,.005)),this.repeat=Cesium.defaultValue(e.repeat,new Cesium.Cartesian2(1,1)),this.image=Cesium.defaultValue(e.image,Cesium.Material.DefaultImageId),this.minimumHeight=Number(Cesium.defaultValue(e.minimumHeight,0)),this.maximumHeight=Number(Cesium.defaultValue(e.maximumHeight,this.minimumHeight+70)),this.flowdirection=Cesium.defaultValue(e.flowdirection,0),this.material=new _WallTrailLinkMaterial__WEBPACK_IMPORTED_MODULE_0__.Z(this.getOptions()).material}_setColor(color){return"string"!=typeof color?this.color=color:color.includes("Cesium.Color")?this.color=eval(color):this.color=new Cesium.Color(color),this.color}getOptions(){return{color:this.color,timeSpeed:this.timeSpeed,image:this.image,material:this.material,isGround:this.isGround,repeat:this.repeat,flowdirection:this.flowdirection,minHeight:this.minHeight,maxHeight:this.maxHeight}}setColor(e){this._setColor(e),this.primitive&&this.primitive.setMaterial(new _WallTrailLinkMaterial__WEBPACK_IMPORTED_MODULE_0__.Z(this.getOptions()).material)}setTimeSpeed(e){this.timeSpeed=Number(Cesium.defaultValue(e,this.timeSpeed)),this.primitive&&this.primitive.setMaterial(new _WallTrailLinkMaterial__WEBPACK_IMPORTED_MODULE_0__.Z(this.getOptions()).material)}setImage(e){this.image=e,this.primitive&&this.primitive.setMaterial(new _WallTrailLinkMaterial__WEBPACK_IMPORTED_MODULE_0__.Z(this.getOptions()).material)}parseConfig(e){e&&this._initConfig(e)}setTrialLinkWallStyleByDataSource(e,t,i){this._dataSource=e,i&&this.parseConfig(i);i=this._getPolyLinePosition(e,this.minimumHeight,this.maximumHeight);e.show=!1,this.addPrimitve(t,i)}_getPolyLinePosition(e,r,n){var o=e.entities.values,s=[];for(let i=0;i<o.length;i++)if(o[i].polyline){var a={},l=o[i].polyline._positions._value;let e=[],t=[];l.forEach(()=>{r&&e.push(r),n&&t.push(n)}),a.positions=l,a.minimumHeights=e,a.maximumHeights=t,s.push(a)}return s}addPrimitve(e,t){this.featureLayer=e,this.primitive=new _CustomWallPrimitive_CustomWallPrimitive__WEBPACK_IMPORTED_MODULE_1__.Z(this.getOptions()),this.primitive.setWallGeometry(t),this.featureLayer instanceof agcim.layer.FeatureLayer&&this.featureLayer.addPrimitive(this.primitive)}clearPrePrimitives(t){for(let e=t._primitives.length-1;-1<e;e--)t._primitives[e]._isCustomPrimitiveTag&&(t.viewer.scene.primitives.remove(t._primitives[e]),t._primitives[e].destroy(),t._primitives.splice(t._primitives.indexOf(t._primitives[e]),1))}destroy(){this.primitive&&(this.featureLayer.viewer.scene.primitives.remove(this.primitive),this.primitive.destroy(),this.featureLayer=void 0),this._dataSource=void 0,this.isGround=void 0,this._color=void 0,this.color=void 0,this.timeSpeed=void 0,this.image=void 0,this.material=void 0}}__webpack_exports__.Z=TrailLinkWallPrimitiveStyle},852:function(e,t){"use strict";t.Z=class{constructor(e={}){this.color=Cesium.defaultValue(e.color,new Cesium.Color(1,0,0,1)),this.timeSpeed=Cesium.defaultValue(e.timeSpeed,.01),this.repeat=Cesium.defaultValue(e.repeat,new Cesium.Cartesian2(1,1)),this.image=Cesium.defaultValue(e.image,Cesium.Material.DefaultImageId),this.flowdirection=Cesium.defaultValue(e.flowdirection,0),Cesium.Material.WallTrailLinkMaterialType="WallTrailLinkMaterial",Cesium.Material.WallTrailLinkMaterialImage=this.image,Cesium.Material.WallTrailLinkMaterialSource=`czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);
    vec2 v_st = materialInput.st;
    vec4 colorImage;
    //0.0 1.0 左右动画 2.0 3.0 上下动画
    if(flowdirection==0.0){
        colorImage = texture(image, vec2(fract(v_st.s * repeat.x - czm_frameNumber * timeSpeed), v_st.t));
    }else if(flowdirection==1.0){
        colorImage = texture(image, vec2(fract(v_st.s * repeat.x + czm_frameNumber * timeSpeed), v_st.t));
    }else if(flowdirection==2.0){
        colorImage = texture(image, vec2(fract(v_st.t * repeat.x - czm_frameNumber * timeSpeed), v_st.t));
    }else if(flowdirection==3.0){
        colorImage = texture(image, vec2(fract(v_st.t * repeat.x + czm_frameNumber * timeSpeed), v_st.t));
    }
    if(colorImage.r > 0.0) {
        material.alpha = colorImage.a;
        material.diffuse = colorImage.rgb; //color.rgb *
    }
     else{
        material.diffuse = color.rgb;
        material.alpha = 0.0;
    }
    // material.alpha = colorImage.a;
    // material.diffuse = 0.5 * color.rgb + 0.5 * colorImage.rgb;
    return material;
}`,Cesium.Material._materialCache.addMaterial(Cesium.Material.WallTrailLinkMaterialType,{fabric:{type:Cesium.Material.WallTrailLinkMaterialType,uniforms:{color:this.color,repeat:this.repeat,image:Cesium.Material.WallTrailLinkMaterialImage,timeSpeed:this.timeSpeed,flowdirection:this.flowdirection},source:Cesium.Material.WallTrailLinkMaterialSource},translucent:function(){return!0}}),this.material=Cesium.Material.fromType("WallTrailLinkMaterial")}}},6252:function(e,t){"use strict";t.Z=new class{constructor(){}getBoxCoord(e){let t=[],i=[];e.forEach(e=>{e=Cesium.Cartographic.fromCartesian(e);t.push(Cesium.Math.toDegrees(e.longitude)),i.push(Cesium.Math.toDegrees(e.latitude))}),t.sort((e,t)=>e-t),i.sort((e,t)=>e-t);var e=t[0],r=t[t.length-1],n=i[0],o=i[i.length-1],s=[];return s.push(Cesium.Cartesian3.fromDegrees(e,n)),s.push(Cesium.Cartesian3.fromDegrees(e,o)),s.push(Cesium.Cartesian3.fromDegrees(r,o)),s.push(Cesium.Cartesian3.fromDegrees(r,n)),s}getBoxRectangle(e){let t=[],i=[];e.forEach(e=>{e=Cesium.Cartographic.fromCartesian(e);t.push(e.longitude),i.push(e.latitude)}),t.sort((e,t)=>e-t),i.sort((e,t)=>e-t);var e=t[0],r=t[t.length-1],n=i[0],o=i[i.length-1];return new Cesium.Rectangle(e,n,r,o)}ZoomToBoxCenter(e,t){t=this.getBoxCoord(t),t=this.getBoxRectangle(t);e.camera.setView({destination:t})}}},3355:function(e,t,i){"use strict";i.d(t,{Z:function(){return c}});var t=i(4257),r=i(8061);var d=class{constructor(e={}){this.type=Cesium.defaultValue(e.type,"AgFlowWater"),this.waterTexture=Cesium.defaultValue(e.waterTexture,Cesium.Material.DefaultImageId),this.normalMap=Cesium.defaultValue(e.waterNormalMap,Cesium.Material.DefaultImageId),this.baseWaterColor=Cesium.defaultValue(e.baseWaterColor,new Cesium.Color(.2,.3,.6,1)),this.blendColor=Cesium.defaultValue(e.blendColor,new Cesium.Color(0,1,.699,1)),this.frequency=Cesium.defaultValue(e.frequency,10),this.animationSpeed=Cesium.defaultValue(e.animationSpeed,.01),this.amplitude=Cesium.defaultValue(e.amplitude,1),this.specularIntensity=Cesium.defaultValue(e.specularIntensity,.5),this.fadeFactor=Cesium.defaultValue(e.fadeFactor,1),this.flowdirection=Cesium.defaultValue(e.flowdirection,5),Cesium.Material._materialCache.addMaterial(this.type,{fabric:{type:this.type,uniforms:{normalMap:this.normalMap,waterTexture:this.waterTexture,baseWaterColor:this.baseWaterColor,blendColor:this.blendColor,frequency:this.frequency,animationSpeed:this.animationSpeed,amplitude:this.amplitude,specularIntensity:this.specularIntensity,fadeFactor:this.fadeFactor,flowdirection:this.flowdirection},source:`
uniform sampler2D normalMap;
uniform sampler2D waterTexture;
uniform vec4 baseWaterColor;
uniform vec4 blendColor;
uniform float frequency;
uniform float animationSpeed;
uniform float amplitude;
uniform float flowdirection; //水流方向 
uniform float specularIntensity;
uniform float fadeFactor; //衰减因子


vec4 getBaseWaterColor(){
    return baseWaterColor;
} 
float private_getSpecularOfMaterial(vec3 lightDirectionEC, vec3 toEyeEC, vec3 normalEC, float shininess) {
    //return czm_getSpecular(lightDirectionEC, toEyeEC, normal, shininess);
    vec3 toReflectedLight = reflect(-lightDirectionEC, normalEC);
    float specular = max(dot(toReflectedLight, toEyeEC), 0.000000001);
    // pow has undefined behavior if both parameters <= 0.
    // Prevent this by making sure shininess is at least czm_epsilon2.
    return pow(specular, shininess);
}
czm_material czm_getMaterial(czm_materialInput materialInput) {
    czm_material material = czm_getDefaultMaterial(materialInput); //获取默认的材质

    float time = czm_frameNumber * animationSpeed; // 动画的时间频率/ 10000.0

    // fade is a function of the distance from the fragment and the frequency of the waves  衰减是片元和水波频率之间的距离的函数
    float fade = max(1.0, (length(materialInput.positionToEyeEC) / 10000000000.0) * frequency * fadeFactor);

    //float specularMapValue = texture(specularMap, materialInput.st).r;
    //计算高光
    float specularMapValue = private_getSpecularOfMaterial(czm_sunDirectionEC, materialInput.positionToEyeEC, materialInput.normalEC, 0.0001);
    //specularMapValue = min(specularMapValue, 0.8);
    //specularMapValue = fract((specularMapValue ));
    vec2 st = materialInput.st;
    // note: not using directional motion at this time, just set the angle to 0.0;
    // vec4 noise = czm_getWaterNoise(normalMap, materialInput.st * frequency, time, 0.0);
    //设置流向
    vec4 noise;
    if(flowdirection == 0.0) {
        noise = czm_getWaterNoise(normalMap, vec2(fract((st.s - time)), st.t) * frequency, time, 0.0);
    } else if(flowdirection == 1.0) {
        noise = czm_getWaterNoise(normalMap, -vec2(fract((st.s + time)), st.t) * frequency, time, 0.0);
    } else if(flowdirection == 2.0) {
        noise = czm_getWaterNoise(normalMap, vec2(st.s, fract((st.t - time))) * frequency, time, 0.0);
    } else if(flowdirection == 3.0) {
        noise = czm_getWaterNoise(normalMap, -vec2(st.s, fract((st.t + time))) * frequency, time, 0.0);
    } else {
        noise = czm_getWaterNoise(normalMap, vec2(fract(st.s * 10.0), fract(st.t * 1.0)) * frequency, time, 0.0);
    }

    //z方向上的动态振动
    vec3 normalTangentSpace = noise.xyz * vec3(1.0, 1.0, (1.0 / amplitude )); 
    // 当我们离水面越远时，减弱正常的扰动
    // fade out the normal perturbation as we move further from the water surface
    normalTangentSpace.xy /= fade;

    // attempt to fade out the normal perturbation as we approach non water areas (low specular map value)
    // 当我们接近非水域时，尝试淡出正常扰动（低镜面反射贴图值）
    normalTangentSpace = mix(vec3(0.0, 0.0, 10.0), normalTangentSpace, specularMapValue);
    //单位化
    normalTangentSpace = normalize(normalTangentSpace);
    // 获取新法向量与垂直于切平面的向量对齐的比率
    // get ratios for alignment of the new normal vector with a vector perpendicular to the tangent plane
    float tsPerturbationRatio = clamp(dot(normalTangentSpace, vec3(0.0, 0.0, 1.0)), 0.0, 1.0);

    // fade out water effect as specular map value decreases
    material.alpha = mix(blendColor.a, baseWaterColor.a, specularMapValue) * specularMapValue;

    // base color is a blend of the water and non-water color based on the value from the specular map
    // may need a uniform blend factor to better control this
    material.diffuse = mix(blendColor.rgb, baseWaterColor.rgb, specularMapValue);

    //diffuse highlights are based on how perturbed the normal is
    material.diffuse += (0.1 * tsPerturbationRatio);

    material.diffuse =  material.diffuse;
    //变回相机坐标系下的法向量
    material.normal = normalize(materialInput.tangentToEyeMatrix * normalTangentSpace);

    material.specular = specularIntensity;
    material.shininess = 20.0;
    // material.emission = vec3(0.5);
    return material;
}
`},translucent:e=>{e=e.uniforms;return e.baseWaterColor.alpha<1||e.blendColor.alpha<1}}),this.material=Cesium.Material.fromType(this.type)}};class n{constructor(e){this._viewer=e.viewer,this._reflectView=void 0,this._skyView=void 0,this._reflectListener=void 0,this._reflectTexture=void 0,this._reflectSkyTexture=void 0,this.customPrimitive=void 0,this._options=e,this.enable=!1}closelayerIdsStartOnReflection(e){e instanceof Array&&0!==e.length&&e.forEach(e=>{CIM.layerTree.layerTreeDom.setLayerCheck(e,!1)})}showLayersEndOnReflection(e){e instanceof Array&&0!==e.length&&e.forEach(e=>{CIM.layerTree.layerTreeDom.setLayerCheck(e,!0)})}createView(e,t){let i=new Cesium.BoundingRectangle(0,0,e.context.drawingBufferWidth,e.context.drawingBufferHeight),r=new Cesium.View(e,t,i);return r.sceneFramebuffer.begin=function(){return r.sceneFramebuffer.clear(e.context,r.passState,Cesium.Color.TRANSPARENT),r.sceneFramebuffer.update(e.context,i,e.highDynamicRange),r.passState.framebuffer=r.sceneFramebuffer.getFramebuffer(),r.passState},r}getUniformMapByName(e,t){for(var i in e)if(0===i.indexOf(t))return i;return t}getWaterHeightAndWidth(e){let t=[],i=[];e.forEach(e=>{e=Cesium.Cartographic.fromCartesian(e);t.push(Cesium.Math.toDegrees(e.longitude)),i.push(Cesium.Math.toDegrees(e.latitude))}),t.sort((e,t)=>e-t),i.sort((e,t)=>e-t);var e=t[0],r=t[t.length-1],n=i[0];return{WaterHeight:i[i.length-1]-n,WaterWidth:r-e}}getBoxCoord(e){let t=[],i=[];e.forEach(e=>{e=Cesium.Cartographic.fromCartesian(e);t.push(Cesium.Math.toDegrees(e.longitude)),i.push(Cesium.Math.toDegrees(e.latitude))}),t.sort((e,t)=>e-t),i.sort((e,t)=>e-t);var e=t[0],r=t[t.length-1],n=i[0],o=i[i.length-1],s=[];return s.push(Cesium.Cartesian3.fromDegrees(e,n)),s.push(Cesium.Cartesian3.fromDegrees(e,o)),s.push(Cesium.Cartesian3.fromDegrees(r,o)),s.push(Cesium.Cartesian3.fromDegrees(r,n)),s}getBoxRectangle(e){let t=[],i=[];e.forEach(e=>{e=Cesium.Cartographic.fromCartesian(e);t.push(e.longitude),i.push(e.latitude)}),t.sort((e,t)=>e-t),i.sort((e,t)=>e-t);var e=t[0],r=t[t.length-1],n=i[0],o=i[i.length-1];return new Cesium.Rectangle(e,n,r,o)}stopReflectionByBoundingSphere(e,t){e.camera.distanceToBoundingSphere(t)>+t.radius||(e.frameState.cullingVolume.computeVisibility(t),Cesium.Intersect.OUTSIDE)}IsBeyondOBBMaxDistance(e,t){let i=!1;var r=CIM.viewer.scene.camera.position,e=Cesium.OrientedBoundingBox.distanceSquaredTo(e,r),r=Math.sqrt(e);return i=t<r?!0:i}addReflection(e){if(this.customPrimitive=e,this.customPrimitive){var e=new d(this._options).material,e=(this.customPrimitive._primitive.appearance.material=e,this.customPrimitive._primitive.appearance._vertexShaderSource=`
            //in属性只读，只出现在顶点着色器中
            //顶点坐标
            in vec3 position3DHigh;
            in vec3 position3DLow;
            // in vec3 position;
            //batchId
            in float batchId;
            //纹理顶点
            in vec2 st;
            //顶点颜色
            // in vec4 color;
            //顶点法线
            in vec3 normal;

            out vec3 v_positionEC;
            out vec3 v_normalEC;
            out vec2 v_st;
            out vec4 v_color;   
            out vec3 v_positionMC;
           
            void main(){
                v_positionMC = position3DHigh + position3DLow;
                vec4 positionWC  = czm_computePosition(); //世界坐标
                // v_positionMC = czm_inverseModel * positionWC; //模型坐标
                v_positionEC = (czm_modelViewRelativeToEye * positionWC).xyz; //相机坐标
                // v_color = color; //顶点颜色
                v_st = st; //纹理坐标
                v_normalEC = czm_normal * normal;//相机坐标下的法线
                gl_Position = czm_modelViewProjectionRelativeToEye * positionWC;
            }
`,this.customPrimitive._primitive.appearance._fragmentShaderSource=`
in vec3 v_positionMC;
in vec3 v_positionEC;
in vec2 v_st;
czm_material material; 
czm_materialInput materialInput;
vec3 lightVector1;
//求光照方向与片元法向量的点积，两个向量角度越大，散射因子越小，使用max避免出现负数没有意义
float czm_getLambertDiffuse1(vec3 lightDirectionEC, vec3 normalEC)
{
    return max(dot(lightDirectionEC, normalEC), 0.0);
}
float czm_private_getLambertDiffuseOfMaterial1(vec3 lightDirectionEC, czm_material material)
{
    return czm_getLambertDiffuse1(lightDirectionEC, material.normal);
}
//镜面反射光因子
float czm_getSpecular1(vec3 lightDirectionEC, vec3 toEyeEC, vec3 normalEC, float shininess)
{
    vec3 toReflectedLight = reflect(-lightDirectionEC, normalEC);
    float specular = max(dot(toReflectedLight, toEyeEC), 0.0);

    // pow has undefined behavior if both parameters <= 0. 
    // Prevent this by making sure shininess is at least czm_epsilon2.
    return pow(specular, max(shininess, czm_epsilon2));
}

float czm_private_getSpecularOfMaterial1(vec3 lightDirectionEC, vec3 toEyeEC, czm_material material)
{
    return czm_getSpecular1(lightDirectionEC, toEyeEC, material.normal, material.shininess);
}
vec4 czm_phong1(vec3 toEye, czm_material material, vec3 lightDirectionEC)
{
    // Diffuse from directional light sources at eye (for top-down)
    float diffuse = czm_private_getLambertDiffuseOfMaterial1(vec3(0.0, 0.0, 1.0), material);
    if (czm_sceneMode == czm_sceneMode3D) {
        // (and horizon views in 3D)
        diffuse += czm_private_getLambertDiffuseOfMaterial1(vec3(0.0, 1.0, 0.0), material);
    }

	

    float specular = czm_private_getSpecularOfMaterial1(lightDirectionEC, toEye, material);
	float specularStrength = 0.5;
	vec3 specular1 = specularStrength * specular * czm_lightColor;

    // Temporary workaround for adding ambient.
	// 
	vec3 waterColor = vec3(64.0/255.0, 157.0/255.0, 253.0/255.0);
    vec3 materialDiffuse = waterColor * 0.5 * czm_lightColor; //材质本身的颜色 * 因子 * 光照颜色

	vec3 diffuse1 = materialDiffuse * diffuse * czm_lightColor; //散射的颜色 = 材质的颜色 * 散射因子 * 光的颜色

	// vec3 ambient = ambientStrength * lightColor;
    // vec3 result = ambient * objectColor;
    vec3 ambient = materialDiffuse;//环境光=材质本身的颜色
    // vec3 color = ambient + material.emission; // 光热的颜色？
    // color += materialDiffuse * diffuse * czm_lightColor;
    // color += material.specular * specular * czm_lightColor;
	vec3 color = (ambient + material.emission + diffuse1 + specular1) * czm_lightColor; //冯氏光照

    return vec4(color, material.alpha);
}


//一块光滑的平面不会出现漫反射的，只有镜面反射高光的现象

void main()
{
    vec3 positionMC = (czm_inverseModelView * vec4(v_positionEC, 1.0)).xyz;

    
	
    //在相机坐标系下,材质的法向量
	vec3 normalEC = normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0))); 
	#ifdef FACE_FORWARD
		normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);
	#endif
	materialInput.s = v_st.s;
    vec3 positionToEyeEC = -v_positionEC;
	materialInput.positionToEyeEC = positionToEyeEC;
	materialInput.st = v_st;
	materialInput.str = vec3(v_st, 0.0);
	materialInput.normalEC = normalEC;
    // 根据材质的模型坐标，相机坐标系下的材质的法线向量，生成转换到相机坐标系的矩阵：
	materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC); 
    // czm_material material = czm_getMaterial(materialInput);
    material = czm_getMaterial(materialInput);
    // lightVector1 = (czm_view * vec4(czm_sunPositionWC,1.0)).xyz - v_positionEC.xyz;
    // lightVector1 = normalize(lightVector1);
    // #ifdef FLAT
    //     out_FragColor = vec4(material.diffuse + material.emission, material.alpha); //czm_lightDirectionEC
    // #else
    //     out_FragColor = czm_phong(normalize(positionToEyeEC), material, lightVector1);
    // #endif
    out_FragColor = getBaseWaterColor(); //
}`,this.customPrimitive._polygonPositions),{WaterHeight:s,WaterWidth:a}=this.getWaterHeightAndWidth(e),l=this.customPrimitive._primitive.appearance,u=l.material,c=this._viewer.scene,h=this.getBoxCoord(e),A=h.length,p=new Cesium.Cartesian3(0,0,0);for(let e=0;e<A;++e)p.x+=h[e].x,p.y+=h[e].y,p.z+=h[e].z;p.x/=A,p.y/=A,p.z/=A;let t=Cesium.BoundingSphere.fromPoints(h);e=Cesium.Cartesian3.normalize(p,new Cesium.Cartesian3);let i=new Cesium.Camera(c),r=(i.frustum.far=c.camera.frustum.far,i.frustum.near=.1,i.frustum.fov=c.camera.frustum.fov,this._reflectView=this.createView(c,i),this._skyView=this.createView(c,i),new Cesium.Cesium3DTilePassState({pass:Cesium.Cesium3DTilePass.PICK}));var f=new Cesium.Plane(Cesium.Cartesian3.UNIT_Z,0);Cesium.Plane.fromPointNormal(p,e,f);let n=new Cesium.Matrix4(-2*f.normal.x*f.normal.x+1,-2*f.normal.x*f.normal.y,-2*f.normal.x*f.normal.z,-2*f.normal.x*f.distance,-2*f.normal.y*f.normal.x,-2*f.normal.y*f.normal.y+1,-2*f.normal.y*f.normal.z,-2*f.normal.y*f.distance,-2*f.normal.z*f.normal.x,-2*f.normal.z*f.normal.y,-2*f.normal.z*f.normal.z+1,-2*f.normal.z*f.distance,0,0,0,1),o={_uniforms:l.material._uniforms,appearance:l,camera:i,reflection_Matrix4:n,WaterHeight:s,WaterWidth:a,_material:u,_reflectTexture:this._reflectTexture,_reflectSkyTexture:this._reflectSkyTexture,dayBaseWaterColor:this._options.dayBaseWaterColor,nightBaseWaterColor:this._options.nightBaseWaterColor,morning:this._options.morning,night:this._options.night,reflectIndesity:this._options.reflectIndesity,baseWaterColor:this._options.baseWaterColor,dayReflectIndesity:this._options.dayReflectIndesity,nightReflectIndesity:this._options.nightReflectIndesity,distortion:this._options.distortion,foamIntensity:this._options.foamIntensity};this._reflectListener=this._reflectListener&&this._reflectListener(),this._reflectListener=c.postUpdate.addEventListener(e=>{this._options.baseWaterColor=5<=this._options.morning&&this._options.night<=19?this._options.dayBaseWaterColor:this._options.nightBaseWaterColor,e._defaultView!==this._reflectView&&e._defaultView===e.view&&(Cesium.defined(this._reflectTexture)&&this.stopReflectionByBoundingSphere(e,t),this._reflectView.viewport.width===e.context.drawingBufferWidth&&this._reflectView.viewport.height===e.context.drawingBufferHeight||((i=new Cesium.Camera(e)).frustum.far=e.camera.frustum.far,i.frustum.near=.1,i.frustum.fov=e.camera.frustum.fov,this._reflectView=this.createView(e,i),this._reflectView.destroy(),this._skyView=this.createView(e,i),this._skyView.destroy()),i=this.setReflectCameraView(e,n,i),o.camera=i,this.startBuildingSceneFrameBufferTexture(this.customPrimitive._primitive,e,i,r),o._reflectTexture=this._reflectTexture,this.startEnvironmentSceneFrameBufferTexture(this.customPrimitive._primitive,e,i,r),o._reflectSkyTexture=this._reflectSkyTexture)}),this.replaceShader(o),this._viewer.scene.requestRender()}}hidePrimitive(t){var i=t.primitives.length;for(let e=0;e<i;e++){var r=t.primitives.get(e);r&&r.show&&(r.show=!1)}}showPrimitive(t){var i=t.primitives.length;for(let e=0;e<i;e++){var r=t.primitives.get(e);r&&!r.show&&(r.show=!0)}}startBuildingSceneFrameBufferTexture(e,t,i,r){var n=t.globe.show,o=(t.globe.show=!1,e.show=!1,t._hdr);let s=void 0;t.skyAtmosphere&&t.skyAtmosphere.show&&(s=t.skyAtmosphere.show);var a,l=t.sun.show,u=t.skyBox.show;t._hdr=!1,t.skyBox.show=!0,t.sun.show=!0,t.view=this._reflectView,this._reflectView&&this._reflectView.sceneFramebuffer&&this._reflectView.sceneFramebuffer.begin&&(a=this._reflectView.sceneFramebuffer.begin(),t.jobScheduler.disableThisFrame(),t.updateFrameState(),t.frameState.invertClassification=!1,t.frameState.passes.render=!0,t.frameState.passes.pick=!1,t.frameState.passes.offscreen=!0,t.frameState.tilesetPassState=r,t.frameState.camera=i,t.frameState.cullingVolume=i.frustum.computeCullingVolume(i.positionWC,i.directionWC,i.upWC),t.context.uniformState.update(t.frameState),t.updateEnvironment(),r=Cesium.Color.fromCssColorString(this._options.baseWaterColor),t.updateAndExecuteCommands(a,r),t.resolveFramebuffers(a),t.view=t.defaultView,t.frameState.frameNumber=Cesium.Math.incrementWrap(t.frameState.frameNumber,15e6,1),t.context.endFrame(),t.globe.show=n,e.show=!0,t._hdr=o,s&&(t.skyAtmosphere.show=s),t.skyBox.show=u,t.sun.show=l,this._reflectView.sceneFramebuffer._colorTexture?this._reflectTexture=this._reflectView.sceneFramebuffer._colorTexture:this._reflectTexture=this._reflectView.sceneFramebuffer._colorFramebuffer._colorTextures[0])}startEnvironmentSceneFrameBufferTexture(e,t,i,r){var n=t.globe.show,o=(t.globe.show=!1,e.show=!1,t._hdr);let s=void 0;t.skyAtmosphere&&t.skyAtmosphere.show&&(s=t.skyAtmosphere.show,t.skyAtmosphere.show=!1);var a,l=t.sun.show,u=t.skyBox.show;t._hdr=!1,t.skyBox.show=!0,t.sun.show=!0,t.view=this._skyView,this._skyView&&this._skyView.sceneFramebuffer&&this._skyView.sceneFramebuffer.begin&&(a=this._skyView.sceneFramebuffer.begin(),t.jobScheduler.disableThisFrame(),t.updateFrameState(),t.frameState.invertClassification=!1,t.frameState.passes.render=!0,t.frameState.passes.pick=!1,t.frameState.passes.offscreen=!0,t.frameState.tilesetPassState=r,t.frameState.camera=i,t.frameState.cullingVolume=i.frustum.computeCullingVolume(i.positionWC,i.directionWC,i.upWC),t.context.uniformState.update(t.frameState),t.updateEnvironment(),t.updateAndExecuteCommands(a,Cesium.Color.TRANSPARENT),t.resolveFramebuffers(a),t.view=t.defaultView,t.frameState.frameNumber=Cesium.Math.incrementWrap(t.frameState.frameNumber,15e6,1),t.context.endFrame(),t.globe.show=n,e.show=!0,t._hdr=o,s&&(t.skyAtmosphere.show=s),t.skyBox.show=u,t.sun.show=l,this._skyView.sceneFramebuffer._colorTexture?this._reflectSkyTexture=this._skyView.sceneFramebuffer._colorTexture:this._reflectSkyTexture=this._skyView.sceneFramebuffer._colorFramebuffer._colorTextures[0])}replaceShader(e){var t=this.getUniformMapByName(e._uniforms,"animationSpeed"),i=this.getUniformMapByName(e._uniforms,"normalMap"),r=this.getUniformMapByName(e._uniforms,"frequency"),n=this.getUniformMapByName(e._uniforms,"flowdirection"),o=Cesium.ShaderSource.replaceMain(e.appearance._vertexShaderSource,"czm_water_main"),o=(e.appearance._vertexShaderSource=o+"\n"+` 
            uniform mat4 rttProjectionMatrix;       
            uniform mat4 rttViewMatrix;       
            uniform mat4 reflectMatrix;   
            out vec4 v_uv1;           
           
            void main()       
            {       
                    czm_water_main();          
                    mat4 modelView = rttViewMatrix * reflectMatrix * czm_model;   // 视图变换矩阵 * 反射矩阵 * 世界坐标变换矩阵
                    modelView[3][0] = 0.0;           
                    modelView[3][1] = 0.0;           
                    modelView[3][2] = 0.0;
                    v_uv1 = rttProjectionMatrix * modelView * czm_computePosition(); //  投影矩阵 * 视图和世界变换矩阵 * 世界坐标 
            }   `,Cesium.ShaderSource.replaceMain(e.appearance._fragmentShaderSource,"czm_water_main")),o=(e.appearance._fragmentShaderSource=o+"\n"+`   
                uniform sampler2D rt_texture; 
                uniform sampler2D rt_SkyTexture; 
                uniform float _distortion; 
                uniform float _foamIntensity; 
                uniform float WaterWidth; 
                uniform float WaterHeight; 
                uniform float _reflectIndesity; 
                uniform float _nightReflectIndesity; 
                uniform float _dayReflectIndesity; 
                uniform float _morning; 
                uniform float _night; 
                uniform vec4 _baseWaterColor; 
                uniform vec4 _dayBaseWaterColor; 
                uniform vec4 _nightBaseWaterColor;

                in vec4 v_uv1;
                const float specularReflectivity = 0.6;
                const float minBlueness = 0.5;
                const float fresnelReflective = 2.0;
                const vec2 lightBias = vec2(0.3, 0.8);
                const vec3 lightColour = vec3(1.0, 0.95, 0.95);

                const vec3 lightColor = vec3(1.0, 1.0, 1.0);
                const float shineDamper = 20.0;
                const float reflectivity = 0.4;
                float time1 = 0.0;
                vec3 _LightWaterColor= (vec3(0.,214.,10.)/255.);

                
                //计算光源的高光,只能算是水面的散射
                vec3 calcSpecularLighting(vec3 toCameraVector, vec3 toLightVector, vec3 normal){
                    vec3 halfVector = normalize(normalize(toCameraVector) + normalize(toLightVector));
                    float specular = max(dot(halfVector, normal), 0.0);
                    specular = pow(specular, shineDamper);
                    //这里的高光没有混合物体的颜色
                    vec3 specularHighlight = lightColor * specular * reflectivity; // mix(lightColor,vec3(0.1,0.1,0.1),0.5)
                    return specularHighlight;
                }
                //计算高光值
                float calcSpecularValue(vec3 toCameraVector, vec3 toLightVector, vec3 normal){
                    vec3 halfVector = normalize(normalize(toCameraVector) + normalize(toLightVector));
                    float specular = max(dot(halfVector, normal), 0.0);
                    specular = pow(specular, shineDamper);
                    return specular;
                }
                //计算光源的反射颜色
                vec3 calculateDiffuseLighting(vec3 toLightVector, vec3 normal){
                    float brightness = max(dot(toLightVector, normal), 0.0);
                    return lightColour * brightness ;//(lightColour * lightBias.x) + (brightness * lightColour * lightBias.y);
                }
                //获取环境光
                vec3 getAmbient(vec3 objectColor){
                    float ambientStrength = 0.2;
                    vec3 ambient = ambientStrength * lightColour;
                    vec3 result = ambient * objectColor;
                    return result;
                }
                //计算漫反射光照颜色
                vec3 getLightDiffuse(vec3 waterColor,vec3 lightDir,vec3 normal){
                    float diffuse = max(dot(normal, lightDir), 0.0);
                    vec3 materialDiffuse = waterColor * 1.0 * lightColour; //材质本身的颜色 * 因子 * 光照颜色
                    vec3 diffuse1 = materialDiffuse * diffuse * lightColour; //散射的颜色 = 材质的颜色 * 散射因子 * 光的颜色
                    // vec3 diffuse1 = diffuse * lightColour; //散射的颜色 = 材质的颜色 * 散射因子 * 光的颜色
                    return diffuse1;
                }

                float _czm_getLambertDiffuse(vec3 lightDirectionEC, vec3 normalEC)
                {
                    return max(dot(lightDirectionEC, normalEC), 0.0);
                }

                float _czm_getSpecular(vec3 lightDirectionEC, vec3 toEyeEC, vec3 normalEC, float shininess)
                {
                    vec3 toReflectedLight = reflect(-lightDirectionEC, normalEC);
                    float specular = max(dot(toReflectedLight, toEyeEC), 0.0);

                    // pow has undefined behavior if both parameters <= 0.
                    // Prevent this by making sure shininess is at least czm_epsilon2.
                    return pow(specular, max(shininess, czm_epsilon2));
                }

                vec4 _czm_phong(vec3 toEye, vec3 objColor,float specularItensity, vec3 normal,float shininess, vec3 lightDirectionEC)
                {
                    // Diffuse from directional light sources at eye (for top-down)
                    float diffuse = _czm_getLambertDiffuse(vec3(0.0, 0.0, 1.0), normal);
                    if (czm_sceneMode == czm_sceneMode3D) {
                        // (and horizon views in 3D)
                        diffuse += _czm_getLambertDiffuse(vec3(0.0, 1.0, 0.0), normal);
                    }

                    float specular = _czm_getSpecular(lightDirectionEC, toEye, normal,shininess);

                    // Temporary workaround for adding ambient.
                    vec3 materialDiffuse = objColor * 0.5;

                    vec3 ambient = materialDiffuse;
                    vec3 color = ambient;
                    color += materialDiffuse * diffuse * czm_lightColor;
                    color += specularItensity * specular * czm_lightColor; //这是法线贴图凹凸感的高光

                    return vec4(color, 1.0);
                }

                //计算高光，镜面光照
                vec3 getSpecular(vec3 viewDir,vec3 reflectDir){
                    float specularStrength = 0.6;
                    float spec = max(dot(viewDir, reflectDir), 0.0);
                    spec = pow(spec, 32.0);
                    vec3 specular = specularStrength * spec * lightColour;
                    return specular;
                }
                //半反射的高光
                vec3 getBlinnPhongSpecular(vec3 normal,vec3 viewDir,vec3 lightDir){
                    // float specularStrength = 1.0;
                    vec3 halfwayDir = normalize(lightDir + viewDir);
                    float spec = pow(max(dot(normal, halfwayDir), 0.0), 128.0);
                    vec3 specular = spec * lightColor;
                    return specular;
                }
                //计算菲涅尔反射因子
                // float calculateFresnel(vec3 pass_toCameraVector,vec3 pass_normal){
                //     vec3 viewVector = normalize(pass_toCameraVector);
                //     vec3 normal = normalize(pass_normal);
                //     // float refractiveFactor = dot(viewVector, normal);
                //     float refractiveFactor = pow(max(dot(normal, viewVector), 0.0), fresnelReflective);
                //     // refractiveFactor = pow(refractiveFactor, fresnelReflective);
                //     // return clamp(refractiveFactor, 0.0, 1.0);
                //     return refractiveFactor;
                // }
                float calculateFresnel(vec3 eyeDirection,vec3 surfaceNormal){
                    float theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );
					   float rf0 = 0.02;
					   float reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0);
                    return reflectance;
                }
                //反射高光
                vec3 getNewSpecular(vec3 normal,vec3 viewDir,vec3 lightDir){
                    float specularStrength = 0.5;
                    vec3 reflectDir = reflect(-lightDir, normal);
                    float spec = pow(max(dot(viewDir, reflectDir), 0.0), 128.0);
                    vec3 specular = specularStrength * spec * lightColor;
                    return specular;
                }
                
                //生成泡沫
                //泡沫强度转泡沫颜色
                vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod) {
                    return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) + 50. * pow(foamPixelIntensity, 23.0)) * dayMod;
                }
                //法向量转泡沫强度
                float normals2FoamIntensity(vec3 n, float waveStrength){
                    float normalizationFactor =  max(0.015, waveStrength);
                    return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
                }

                void sunLight(  vec3 surfaceNormal,  vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {
                    vec3 reflection = normalize( reflect( -czm_lightDirectionEC, surfaceNormal ) );
                    float direction = max( 0.0, dot( eyeDirection, reflection ) );
                    specularColor += pow( direction, shiny ) * lightColor * spec; //高光颜色
                    diffuseColor += max( dot( czm_lightDirectionEC, surfaceNormal ), 0.0 ) * lightColor * diffuse;
                }
            
                //对于获取噪声要获取-1,1之间
                vec4 _czm_getWaterNoise(sampler2D normalMap,  vec2 uv, float time, float angleInRadians)
                {
                    float cosAngle = cos(angleInRadians) ;
                    float sinAngle = sin(angleInRadians) ;

                    // time dependent sampling directions
                    vec2 s0 = vec2(1.0/17.0, 0.0); //从右到左流向
                    vec2 s1 = vec2(-1.0/29.0, 0.0); //从左到右流向
                    vec2 s2 = vec2(1.0/101.0, 1.0/59.0); //从右上角到左下角流向
                    vec2 s3 = vec2(-1.0/109.0, -1.0/57.0); //从左下角到右上角流向

                    // rotate sampling direction by specified angle  旋转角度
                    s0 = vec2((cosAngle * s0.x) - (sinAngle * s0.y), (sinAngle * s0.x) + (cosAngle * s0.y)); 
                    s1 = vec2((cosAngle * s1.x) - (sinAngle * s1.y), (sinAngle * s1.x) + (cosAngle * s1.y));
                    s2 = vec2((cosAngle * s2.x) - (sinAngle * s2.y), (sinAngle * s2.x) + (cosAngle * s2.y));
                    s3 = vec2((cosAngle * s3.x) - (sinAngle * s3.y), (sinAngle * s3.x) + (cosAngle * s3.y));

                    vec2 uv0 = (uv/103.0) + (time * s0);
                    vec2 uv1 = uv/107.0 + (time * s1) + vec2(0.23);
                    vec2 uv2 = uv/vec2(897.0, 983.0) + (time * s2) + vec2(0.51);
                    vec2 uv3 = uv/vec2(991.0, 877.0) + (time * s3) + vec2(0.71);

                    // uv = fract(uv + cosAngle * time); (texture(normalMap, uv))+
                    uv0 = fract(uv0);
                    uv1 = fract(uv1);
                    uv2 = fract(uv2);
                    uv3 = fract(uv3);
                    vec4 noise = 
                                (texture(normalMap, uv0)) +
                                (texture(normalMap, uv1)) +
                                (texture(normalMap, uv2)) +
                                (texture(normalMap, uv3));

                    // average and scale to between -1 and 1
                    return ((noise / 4.0) - 0.5) * 2.0;
                }

                void main()       
                {       
                        czm_water_main();
                        // out_FragColor = vec4(37.0/256.0,66.0/256.0,180.0/256.0,1.0);//
                        // return;
                        //动画时间
                        float time = czm_frameNumber * ${t};
                        //片元到相机的向量
                        vec3 fragToCameraVector = (czm_view * vec4(czm_viewerPositionWC,1.0)).xyz - v_positionEC.xyz;
                        float distance = length(fragToCameraVector);
                        //单位化方向，片元到相机的方向向量
                        vec3 viewDir = normalize(fragToCameraVector);
                        
                        //反射贴图强弱
                        float _reflectVisibleBydistance = clamp((50000.0 - czm_eyeHeight)/50000.0,0.0,1.0);
                        float _reflectVisibleByEyeHeight = clamp((50000.0 - czm_eyeHeight)/50000.0,0.5,1.0);

                        float _reflectVisibleBydistance1 = clamp((50000.0 - distance)/50000.0,0.0,1.0);

                        vec2 st;
                        //法线贴图动画uv //重复采样贴图
                        if(WaterWidth/WaterHeight > 1.0){
                            st = vec2(fract(v_st.s * floor(WaterWidth/WaterHeight)), fract(v_st.t * 1.0));
                        }else{
                            st = vec2(fract(v_st.s * 1.0), fract(v_st.t * floor(WaterHeight/WaterWidth)));
                        }
                        
                        vec2 _st = st;
                        //东：0.0,南：1.0,西：2.0,北：3.0;
                        //  st = vec2(fract((st.s - time/1000.0)), st.t);
                        if(${n} == 0.0) {
                            st = vec2(fract((st.s - time/1000.0)), st.t);
                        } else if(${n} == 1.0) {
                            st = vec2(st.s, fract((st.t-time/1000.0)));
                        } else if(${n} == 2.0) {
                            st = vec2(fract((st.s + time/1000.0)), st.t);
                        } else if(${n} == 3.0) {
                            st = vec2(st.s, fract((st.t+time/1000.0)));
                        } 

                        //菲涅尔反射的颜色
                        //从顶点传来的在反射坐标系下的uv坐标
                        vec2 coord = (v_uv1.xy / v_uv1.w) * 0.5 + 0.5; 
                        if(coord.x < 0.0 || coord.x > 1.0) {             
                            return;           
                        } else if(coord.y < 0.0 || coord.y > 1.0) {
                            return;           
                        }  
                        vec2 staticCoord = coord;
                        //获取扰动坐标的变化量
                        vec4 noise = _czm_getWaterNoise(${i}  , st  * ${r} / 10.0 , time, 0.0) * 0.5 + 0.5;  //* _reflectVisibleByEyeHeight/10.0 /10.0
                        noise *=_reflectVisibleByEyeHeight * _reflectVisibleBydistance1;
                        vec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );
                        vec4 _flow = _czm_getWaterNoise(${i}  , st  * ${r} , time, 0.0) * 0.5 + 0.5;  // * _reflectVisibleByEyeHeight 
                        vec3 distortion3 = surfaceNormal.xyz * ( 0.001 + 1.0 / distance ) * 5.0;
                        // _flow.xyz += (distortion3 * _reflectVisibleByEyeHeight * _reflectVisibleBydistance1);

                        _flow.xyz *= _reflectVisibleByEyeHeight * _reflectVisibleBydistance1 * _distortion;

                        //菲涅尔反射因子
                        // float fresnelFactor = calculateFresnel(viewDir,normalize(_flow.xyz));
                        float fresnelFactor = calculateFresnel(viewDir,normalize(materialInput.normalEC));
                        // float fresnelFactor = (fresnelFactor1*0.8+fresnelFactor2*0.2);
                        // float fresnelFactor = 0.6 + 0.98 * pow(1.0 - dot(normalize(_flow.xyz), viewDir), 5.0);

                        //将扰动坐标的变化量加到原来的uv坐标上
                        coord.xy += noise.xy * 0.01 * _reflectVisibleByEyeHeight * _reflectVisibleBydistance1 * _distortion;
                        //基本颜色
                        vec4 baseWaterColor = _baseWaterColor;
                        //采样反射建筑贴图的颜色
                        vec4 reflectColour = texture(rt_texture, coord); 
                        vec2 rt_SkyTextureUV = (v_uv1.xy / v_uv1.w) * 0.5 + 0.5; 
                        rt_SkyTextureUV += noise.xy * 0.01;
                        vec4 reflectSkyColour = texture(rt_SkyTexture, rt_SkyTextureUV); 
                        // out_FragColor = reflectSkyColour1;

                        //这里受到CPU的控制的图层显示影响，故不用此方法了
                        //采样反射天空盒贴图的颜色
                        //相机到片元的向量
                        // vec3 camera2FragVector =  v_positionEC.xyz - (czm_view * vec4(czm_viewerPositionWC,1.0)).xyz;
                        //单位化方向，片元到相机的方向向量
                        // vec3 camera2FragVectorNormalized = normalize(camera2FragVector);
                        // vec3 reflectVector = reflect(camera2FragVectorNormalized, normalize(materialInput.normalEC));
                        // vec4 reflectSkyColour = textureCube(czm_environmentMap, reflectVector);

                        // out_FragColor = reflectSkyColour;
                        float reflectIndesity = _reflectIndesity;
                    
                        if(czm_globeTime.x>=_morning && czm_globeTime.x<_night){
                            reflectIndesity = _dayReflectIndesity;
                            baseWaterColor = _dayBaseWaterColor;
                        }else{
                            reflectIndesity = _nightReflectIndesity;
                            baseWaterColor = _nightBaseWaterColor;
                        }
                    
                        //6000米内才有水波纹的效果
                        if(_reflectVisibleBydistance<=0.0){
                            out_FragColor = baseWaterColor;
                            out_FragColor.xyz *= reflectIndesity;

                        }else{
                            baseWaterColor.xyz *= reflectIndesity;
                            reflectSkyColour.xyz *=  reflectIndesity;
                            reflectColour.xyz *= reflectIndesity;

                            // vec3 diffuseLight = vec3(0.0);
                            // vec3 specularLight = vec3(0.0);
                            // vec3 sunColor = vec3(1.0);
                            // vec3 waterColor = baseWaterColor.xyz;//vec3(0.0,30.0/256.0,15.0/256.0);
                            // sunLight(_flow.xyz, viewDir, 100.0, 2.0, 0.5, diffuseLight, specularLight);

                            // vec3 scatter = max(0.0, dot(_flow.xyz, viewDir)) * waterColor; //水的颜色深浅
                            // vec3 mask = (sunColor * diffuseLight * 0.3 + scatter);//mask
                            // vec3 reflectionSampleMix =  vec3( 0.1 ) + reflectColour.xyz * 0.9 + reflectColour.xyz * specularLight;//reflection
                            // vec3 albedo = mix(mask,reflectionSampleMix,fresnelFactor);
                            // out_FragColor.xyz = albedo;

                            //菲涅尔混合
                            //vec4 waterAndSkyColor = vec4(baseWaterColor.xyz * 0.95 + reflectSkyColour.xyz * 0.05,1.0); //reflectSkyColour; // mix(reflectSkyColour,baseWaterColor,fresnelFactor) ;//
                            //常规混合
                            // fresnelFactor = clamp((1.0 - fresnelFactor)/fresnelFactor,0.0,1.0);
                            vec3 waterAndSkyColor =  mix(baseWaterColor.xyz,reflectSkyColour.xyz*0.5,fresnelFactor); //reflectSkyColour;
                            // out_FragColor.xyz = waterAndSkyColor;
                            out_FragColor.xyz = baseWaterColor.xyz;
                            // out_FragColor = reflectSkyColour;
                            vec3 whiteColor;
                            if(czm_globeTime.x>=_morning && czm_globeTime.x<_night){
                                out_FragColor.xyz = mix(out_FragColor.xyz,reflectColour.xyz,fresnelFactor);
                                //光照的方向，太阳到片元向量
                                vec3 lightVector = (czm_view * vec4(czm_sunPositionWC,1.0)).xyz - v_positionEC.xyz;
                                // vec3 normalEC = normalize(czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));
                                vec3 toLightVector = normalize(lightVector);
                               
                                //冯氏光照
                                //czm_lightDirectionEC 平行光或者称为定向光 ,specularItensity
                                vec4 _phongColor =  _czm_phong(viewDir,out_FragColor.xyz,0.15, normalize(materialInput.tangentToEyeMatrix * _flow.xyz), 1.0, czm_lightDirectionEC);
                                out_FragColor = _phongColor;
    
                                //加高光
                                vec3 specular = getNewSpecular(normalize(materialInput.normalEC),viewDir,toLightVector); //高光镜面反射 
                                // vec3 specular = getNewSpecular(normalize( _flow.xyz),viewDir,toLightVector); //高光镜面反射 
                                 //mix(out_FragColor, vec4(0, 0.3, 0.5, 1.0), 0.2)
    
                                //加泡沫
                                float foamIntensityExternal = 0.5 * _reflectVisibleBydistance;
                                //泡沫的强度跟法向量有关
                                // normalize(materialInput.tangentToEyeMatrix * normalTangentSpace)
                                float foamIntensity = normals2FoamIntensity(normalize( _flow.xyz),_foamIntensity );
                                // out_FragColor +=  vec4(specular * 0.8 * foamIntensity, 0.0);
                                //加高光
                                out_FragColor +=  vec4(specular, 0.0); //mix(out_FragColor, vec4(0, 0.3, 0.5, 1.0), 0.2)
                                

                                vec3 skyZenitColor = vec3(.52,.68,.9);
                                float upDotL = max(dot(normalize(_flow.xyz), toLightVector), 0.0);
                                float daytimeMod = 0.1 + upDotL * 0.9;
                                vec3 foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
                                out_FragColor+=vec4(foam,0.0);
                            }else{
                                out_FragColor.xyz =  (reflectColour.xyz + reflectSkyColour.xyz)*0.6;
                            }
                        }
                }   
            `,{rt_texture:function(){return e._reflectTexture},rt_SkyTexture:function(){return e._reflectSkyTexture},rttProjectionMatrix:function(){return e.camera.frustum.projectionMatrix},rttViewMatrix:function(){return e.camera.viewMatrix},reflectMatrix:function(){return e.reflection_Matrix4},WaterHeight:function(){return e.WaterHeight},WaterWidth:function(){return e.WaterWidth},_baseWaterColor:function(){return"string"==typeof e.baseWaterColor?Cesium.Color.fromCssColorString(e.baseWaterColor):e.baseWaterColor},_reflectIndesity:function(){return Number(e.reflectIndesity)},_dayReflectIndesity:function(){return Number(e.dayReflectIndesity)},_nightReflectIndesity:function(){return Number(e.nightReflectIndesity)},_dayBaseWaterColor:function(){return"string"==typeof e.dayBaseWaterColor?Cesium.Color.fromCssColorString(e.dayBaseWaterColor):e.dayBaseWaterColor},_nightBaseWaterColor:function(){return"string"==typeof e.nightBaseWaterColor?Cesium.Color.fromCssColorString(e.nightBaseWaterColor):e.nightBaseWaterColor},_morning:function(){return Number(e.morning)},_night:function(){return Number(e.night)},_distortion:function(){return Number(e.distortion)},_foamIntensity:function(){return Number(e.foamIntensity)}});e._material._uniforms=Cesium.combine(e._material._uniforms,o)}setReflectCameraView(e,t,i){var r=new Cesium.Cartesian3,n=new Cesium.Cartesian3,o=new Cesium.Cartesian3,s=e.camera.positionWC,a=e.camera.directionWC,e=e.camera.upWC;return Cesium.Matrix4.multiplyByPoint(t,s,r),Cesium.Cartesian3.multiplyByScalar(a,100,n),Cesium.Cartesian3.add(s,n,n),Cesium.Matrix4.multiplyByPoint(t,n,n),Cesium.Cartesian3.subtract(n,r,n),Cesium.Cartesian3.normalize(n,n),Cesium.Cartesian3.multiplyByScalar(e,100,o),Cesium.Cartesian3.add(s,o,o),Cesium.Matrix4.multiplyByPoint(t,o,o),Cesium.Cartesian3.subtract(o,r,o),Cesium.Cartesian3.normalize(o,o),i.setView({destination:r,orientation:{direction:n,up:o}}),i}clear(){this._reflectListener&&(this._reflectListener(),this._reflectListener=void 0),this._reflectView&&(this._reflectView.destroy(),this._reflectView=void 0),this.customPrimitive=void 0,this._viewer.scene.requestRender()}}class o extends r.Z{constructor(e={}){super(e),this.reflect=void 0,this._initConfig(e)}_initConfig(e){this.baseWaterColor=Cesium.defaultValue(e.baseWaterColor,"rgba(37,66,180, 1.0)"),this.nightBaseWaterColor=Cesium.defaultValue(e.nightBaseWaterColor,"rgba(0,0,51,1.0)"),this.dayBaseWaterColor=Cesium.defaultValue(e.dayBaseWaterColor,"rgba(37,66,180, 1.0)"),this.specularIntensity=Cesium.defaultValue(e.specularIntensity,.8),this.nightReflectIndesity=Cesium.defaultValue(e.nightReflectIndesity,.47),this.dayReflectIndesity=Cesium.defaultValue(e.dayReflectIndesity,.8),this.reflectIndesity=Cesium.defaultValue(e.reflectIndesity,.9),this.night=Cesium.defaultValue(e.night,19),this.morning=Cesium.defaultValue(e.morning,6),this.distortion=Cesium.defaultValue(e.distortion,1),this.foamIntensity=Cesium.defaultValue(e.foamIntensity,.78),this.layerIds=Cesium.defaultValue(e.layerIds,[])}addReflect(){this.reflect=new n(this);var e=super.getPrimitive();e&&(this.reflect.addReflection(e),this.viewer.scene.requestRender())}removeReflect(){this.reflect&&this.reflect.clear()}}var s=o,a=i(5098),l=i(974),u=i(5280),i=i(6182),c={NormalPolygonPrimitiveStyle:t.Z,NormalWaterStyle:r.Z,ReflectWaterStyle:s,NormalPolyLinePrimitiveStyle:a.Z,TrailLinkPolyLineVolumePrimitiveStyle:l.Z,TrailLinkPolyLinePrimitiveStyle:u.Z,TrailLinkWallPrimitiveStyle:i.Z}},8610:function(__unused_webpack_module,__webpack_exports__){"use strict";class agClusterRenderer{constructor(e){this._viewer=e,this.singleDigitPins=null,this.defaultIconCache={}}setRenderer(e,t){e.clustering.enabled=!0,e.clustering.pixelRange=t.pixelRange,e.clustering.minimumClusterSize=t.minimumClusterSize,this.removeListener=void 0,this.pinBuilder=new Cesium.PinBuilder,this.pin100=this.pinBuilder.fromText("100+",Cesium.Color.BLUEVIOLET,48).toDataURL(),this.pin50=this.pinBuilder.fromText("50+",Cesium.Color.RED,48).toDataURL(),this.pin40=this.pinBuilder.fromText("40+",Cesium.Color.ORANGE,48).toDataURL(),this.pin30=this.pinBuilder.fromText("30+",Cesium.Color.YELLOW,48).toDataURL(),this.pin20=this.pinBuilder.fromText("20+",Cesium.Color.GREEN,48).toDataURL(),this.pin10=this.pinBuilder.fromText("10+",Cesium.Color.BLUE,48).toDataURL(),this.singleDigitPins=new Array(8);for(var i=0;i<this.singleDigitPins.length;++i)this.singleDigitPins[i]=this.pinBuilder.fromText(""+(i+2),Cesium.Color.VIOLET,48).toDataURL();this.customStyle(e,t)}customStyle(dataSource,clusterConfig){let _this=this,pixelRange=(Cesium.defined(this.removeListener)?(this.removeListener(),this.removeListener=void 0):this.removeListener=dataSource.clustering.clusterEvent.addEventListener(function(clusteredEntities,cluster){cluster.label.clusteredEntities=clusteredEntities,cluster.billboard.clusteredEntities=clusteredEntities,cluster.label.show=!1,cluster.billboard.show=!0;let verticalOrigin=Cesium.VerticalOrigin.BOTTOM,heightReference=(Cesium.defined(eval(clusterConfig.verticalOrigin))&&(verticalOrigin=eval(clusterConfig.verticalOrigin)),Cesium.HeightReference.CLAMP_TO_GROUND),count=(Cesium.defined(eval(clusterConfig.heightReference))&&(heightReference=eval(clusterConfig.heightReference)),cluster.billboard.verticalOrigin=verticalOrigin,cluster.billboard.heightReference=heightReference,cluster.billboard.disableDepthTestDistance=Number.POSITIVE_INFINITY,clusterConfig.scale&&(cluster.billboard.scale=clusterConfig.scale),clusterConfig.pixelOffset&&(cluster.billboard.pixelOffset=clusterConfig.pixelOffset),clusteredEntities.length),size=clusterConfig.size||32;if("classBreaksImg"==clusterConfig.type){let clusterImgArray=clusterConfig.clusterImgArray;for(let i=0,len=clusterImgArray?.length;i<len;i++)if(clusterImgArray[i]?.equalValue==count||clusterImgArray[i]?.minValue<=count&&(!clusterImgArray[i].maxValue||clusterImgArray[i].maxValue>=count)){cluster.billboard.image=clusterImgArray[i].img;break}}else if("uniqueValueImg"==clusterConfig.type){let clusterImg=clusterConfig.clusterImg;if(clusterImg)cluster.billboard.image=clusterImg;else{let text=String(count),color=(count>=Math.pow(10,12)?text=Math.floor(count/Math.pow(10,12))+"兆":count>=Math.pow(10,8)?text=Math.floor(count/Math.pow(10,8))+"亿":count>=Math.pow(10,4)&&(text=Math.floor(count/Math.pow(10,4))+"万"),eval(clusterConfig.fillColor)||"#6495ed91"),imageStyle=(color instanceof Cesium.Color&&(color=color.toCssHexString()),{fillColor:color}),fontStyle=clusterConfig.label?.fontStyle||"normal",fontFamily=clusterConfig.label?.fontFamily||"sans-serif",textStyle=(color=eval(clusterConfig.label?.fillColor)||Cesium.Color.WHITE,color instanceof Cesium.Color&&(color=color.toCssHexString()),{fillColor:color,font:`${fontStyle} ${size/2}px `+fontFamily,textAlign:"center",textBaseline:"middle"}),id=JSON.stringify([size,imageStyle,textStyle,text]);_this.defaultIconCache[id]||(_this.defaultIconCache[id]=_this.createCircleIcon(size,imageStyle,textStyle,text)),cluster.billboard.image=_this.defaultIconCache[id]}cluster.billboard.width=size,cluster.billboard.height=size}else if("uniqueValueDefault"==clusterConfig.type){let color=eval(clusterConfig.fillColor)||Cesium.Color.BLUEVIOLET;cluster.billboard.image=_this.pinBuilder.fromText(count,color,size).toDataURL()}else 100<=count?cluster.billboard.image=_this.pin100:50<=count?cluster.billboard.image=_this.pin50:40<=count?cluster.billboard.image=_this.pin40:30<=count?cluster.billboard.image=_this.pin30:20<=count?cluster.billboard.image=_this.pin20:10<=count?cluster.billboard.image=_this.pin10:cluster.billboard.image=_this.singleDigitPins[count-2]}),dataSource.clustering.pixelRange);dataSource.clustering.pixelRange=0,dataSource.clustering.pixelRange=pixelRange}createCircleIcon(e,t,i,r){var n=document.createElement("canvas"),o=n.getContext("2d");return n.width=e,n.height=e,o.beginPath(),o.arc(e/2,e/2,e/2,0,2*Math.PI,!1),o.closePath(),o.fillStyle=t.fillColor,o.fill(),o.fillStyle=i.fillColor,o.font=i.font,o.textAlign=i.textAlign,o.textBaseline=i.textBaseline,o.fillText(r,e/2,e/2),n.toDataURL()}}__webpack_exports__.Z=new agClusterRenderer},2175:function(e,t){"use strict";t.Z=class{constructor(){this.color=null}getColor(e="#000"){let t;try{Array.isArray(e)?t=Cesium.Color.fromBytes(...e):"string"==typeof e&&e.constructor==String&&(t=Cesium.Color.fromCssColorString(e))}catch(e){}return t}checkColor(e){var t,i,r=["fillColor","outlineColor","backgroundColor","Color","material"];for(t in e)for(var n in e[t])-1<r.indexOf(n)&&(i=this.getColor(e[t][n]),e[t][n]=i||e[t][n]);return e}dispose(){this.color=null}}},8477:function(e,t,i){var r;r=function(){var u,n={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},o=(u=n.defaultRadius,e.prototype={_organiseData:function(e,t){var i=e[this._xField],r=e[this._yField],n=this._radi,o=this._data,s=this._max,a=this._min,l=e[this._valueField]||1,e=e.radius||this._cfgRadius||u,n=(o[i]||(o[i]=[],n[i]=[]),o[i][r]?o[i][r]+=l:(o[i][r]=l,n[i][r]=e),o[i][r]);return s<n?(t?this.setDataMax(n):this._max=n,!1):n<a?(t?this.setDataMin(n):this._min=n,!1):{x:i,y:r,value:l,radius:e,min:a,max:s}},_unOrganizeData:function(){var e,t=[],i=this._data,r=this._radi;for(e in i)for(var n in i[e])t.push({x:e,y:n,radius:r[e][n],value:i[e][n]});return{min:this._min,max:this._max,data:t}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(){if(0<arguments[0].length)for(var e=arguments[0],t=e.length;t--;)this.addData.call(this,e[t]);else{var i=this._organiseData(arguments[0],!0);i&&(0===this._data.length&&(this._min=this._max=i.value),this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[i]}))}return this},setData:function(e){var t=e.data,i=t.length;this._data=[],this._radi=[];for(var r=0;r<i;r++)this._organiseData(t[r],!1);return this._max=e.max,this._min=e.min||0,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},removeData:function(){},setDataMax:function(e){return this._max=e,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setDataMin:function(e){return this._min=e,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setCoordinator:function(e){this._coordinator=e},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}},e);function e(e){this._coordinator={},this._data=[],this._radi=[],this._min=10,this._max=1,this._xField=e.xField||e.defaultXField,this._yField=e.yField||e.defaultYField,this._valueField=e.valueField||e.defaultValueField,e.radius&&(this._cfgRadius=e.radius)}function s(e){var t,i=e.gradient||e.defaultGradient,r=(e=document.createElement("canvas")).getContext("2d"),n=(e.width=256,e.height=1,r.createLinearGradient(0,0,256,1));for(t in i)n.addColorStop(t,i[t]);return r.fillStyle=n,r.fillRect(0,0,256,1),r.getImageData(0,0,256,1).data}function t(e){var t=e.container,i=this.shadowCanvas=document.createElement("canvas"),r=this.canvas=e.canvas||document.createElement("canvas"),n=(this._renderBoundaries=[1e4,1e4,0,0],getComputedStyle(e.container)||{});r.className="heatmap-canvas",this._width=r.width=i.width=e.width||+n.width.replace(/px/,""),this._height=r.height=i.height=e.height||+n.height.replace(/px/,""),this.shadowCtx=i.getContext("2d"),this.ctx=r.getContext("2d"),r.style.cssText=i.style.cssText="position:absolute;left:0;top:0;",t.style.position="relative",t.appendChild(r),this._palette=s(e),this._templates={},this._setStyles(e)}i=!(t.prototype={renderPartial:function(e){0<e.data.length&&(this._drawAlpha(e),this._colorize())},renderAll:function(e){this._clear(),0<e.data.length&&(this._drawAlpha(function(e){for(var t=[],i=e.min,r=e.max,n=e.radi,e=e.data,o=Object.keys(e),s=o.length;s--;)for(var a=o[s],l=Object.keys(e[a]),u=l.length;u--;){var c=l[u],h=e[a][c],A=n[a][c];t.push({x:a,y:c,value:h,radius:A})}return{min:i,max:r,data:t}}(e)),this._colorize())},_updateGradient:function(e){this._palette=s(e)},updateConfig:function(e){e.gradient&&this._updateGradient(e),this._setStyles(e)},setDimensions:function(e,t){this._width=e,this._height=t,this.canvas.width=this.shadowCanvas.width=e,this.canvas.height=this.shadowCanvas.height=t},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height),this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(e){this._blur=0==e.blur?0:e.blur||e.defaultBlur,e.backgroundColor&&(this.canvas.style.backgroundColor=e.backgroundColor),this._width=this.canvas.width=this.shadowCanvas.width=e.width||this._width,this._height=this.canvas.height=this.shadowCanvas.height=e.height||this._height,this._opacity=255*(e.opacity||0),this._maxOpacity=255*(0==e.maxOpacity?e.maxOpacity:e.maxOpacity||e.defaultMaxOpacity),this._minOpacity=255*(e.minOpacity||e.defaultMinOpacity),this._useGradientOpacity=!!e.useGradientOpacity},_drawAlpha:function(e){for(var t,i,r,n,o,s=this._min=e.min,a=this._max=e.max,l=(e=e.data||[]).length,u=1-this._blur;l--;){var c,h=e[l],A=h.x,p=h.y,f=h.radius,h=Math.min(h.value,a),A=A-f,p=p-f,d=this.shadowCtx,g=(this._templates[f]?c=this._templates[f]:this._templates[f]=(t=f,i=u,o=g=n=r=void 0,r=document.createElement("canvas"),n=r.getContext("2d"),o=g=t,r.width=r.height=2*t,1==i?(n.beginPath(),n.arc(g,o,t,0,2*Math.PI,!1),n.fillStyle="rgba(0,0,0,1)",n.fill()):((i=n.createRadialGradient(g,o,t*i,g,o,t)).addColorStop(0,"rgba(0,0,0,1)"),i.addColorStop(1,"rgba(0,0,0,0)"),n.fillStyle=i,n.fillRect(0,0,2*t,2*t)),c=r),(h-s)/(a-s));d.globalAlpha=g<.01?.01:g,d.drawImage(c,A,p),A<this._renderBoundaries[0]&&(this._renderBoundaries[0]=A),p<this._renderBoundaries[1]&&(this._renderBoundaries[1]=p),A+2*f>this._renderBoundaries[2]&&(this._renderBoundaries[2]=A+2*f),p+2*f>this._renderBoundaries[3]&&(this._renderBoundaries[3]=p+2*f)}},_colorize:function(){for(var e=this._renderBoundaries[0],t=this._renderBoundaries[1],i=this._renderBoundaries[2]-e,r=this._renderBoundaries[3]-t,n=this._width,o=this._height,s=this._opacity,a=this._maxOpacity,l=this._minOpacity,u=this._useGradientOpacity,n=this.shadowCtx.getImageData(e=e<0?0:e,t=t<0?0:t,i=n<e+i?n-e:i,r=o<t+r?o-t:r),c=n.data,h=c.length,A=this._palette,p=3;p<h;p+=4){var f=c[p],d=4*f;d&&(f=0<s?s:f<a?f<l?l:f:a,c[p-3]=A[d],c[p-2]=A[1+d],c[p-1]=A[2+d],c[p]=u?A[3+d]:f)}n.data=c,this.ctx.putImageData(n,e,t),this._renderBoundaries=[1e3,1e3,0,0]},getValueAt:function(e){var e=this.shadowCtx.getImageData(e.x,e.y,1,1).data[3],t=this._max,i=this._min;return Math.abs(t-i)*(e/255)>>0},getDataURL:function(){return this.canvas.toDataURL()}});var i,a,l=i="canvas2d"===n.defaultRenderer?t:i,c=function(){for(var e={},t=arguments.length,i=0;i<t;i++){var r,n=arguments[i];for(r in n)e[r]=n[r]}return e},r=(h.prototype={on:function(e,t,i){var r=this.cStore;r[e]||(r[e]=[]),r[e].push(function(e){return t.call(i,e)})},emit:function(e,t){var i=this.cStore;if(i[e])for(var r=i[e].length,n=0;n<r;n++)(0,i[e][n])(t)}},a=h,A.prototype={addData:function(){return this._store.addData.apply(this._store,arguments),this},removeData:function(){return this._store.removeData&&this._store.removeData.apply(this._store,arguments),this},setData:function(){return this._store.setData.apply(this._store,arguments),this},setDataMax:function(){return this._store.setDataMax.apply(this._store,arguments),this},setDataMin:function(){return this._store.setDataMin.apply(this._store,arguments),this},configure:function(e){return this._config=c(this._config,e),this._renderer.updateConfig(this._config),this._coordinator.emit("renderall",this._store._getInternalData()),this},repaint:function(){return this._coordinator.emit("renderall",this._store._getInternalData()),this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(e){return this._store.getValueAt?this._store.getValueAt(e):this._renderer.getValueAt?this._renderer.getValueAt(e):null}},A);function h(){this.cStore={}}function A(){var t,e,i=this._config=c(n,arguments[0]||{});if(this._coordinator=new a,i.plugin){var r=i.plugin;if(!n.plugins[r])throw new Error("Plugin '"+r+"' not found. Maybe it was not registered.");var r=n.plugins[r];this._renderer=new r.renderer(i),this._store=new r.store(i)}else this._renderer=new l(i),this._store=new o(i);r=(t=this)._renderer,i=t._coordinator,e=t._store,i.on("renderpartial",r.renderPartial,r),i.on("renderall",r.renderAll,r),i.on("extremachange",function(e){t._config.onExtremaChange&&t._config.onExtremaChange({min:e.min,max:e.max,gradient:t._config.gradient||t._config.defaultGradient})}),e.setCoordinator(i)}return{create:function(e){return new r(e)},register:function(e,t){n.plugins[e]=t}}},e.exports?e.exports=r():void 0!==(i="function"==typeof(r=r)?r.call(t,i,t,e):r)&&(e.exports=i)},8105:function(e,t,i){"use strict";var r=i(2800),n=i(7637),o=i(1673),s=i(7073),a=i(7),l=i(7566),u=i(2614),c=i(3418),h=i(1049),A=i(5875),p=i(1979),f=i(8560),d=i(8490),g=i(2499),m=i(5205),y=i(4499),_=i(4263),v=i(8491),C=i(8270),w=i(4420),x=i(6559),b=i(115),E=i(4508),B=i(2398),M=i(3998),I=i(8928),S=i(5573),P=i(7201),i=i(7665);t.Z=[r.Z,n.Z,o.Z,s.Z,a.Z,l.Z,u.Z,c.Z,h.Z,A.Z,p.Z,f.Z,d.Z,g.Z,m.Z,y.Z,_.Z,v.Z,C.Z,w.Z,x.Z,b.Z,E.Z,B.Z,M.Z,I.Z,S.Z,P.Z,i.Z]},9608:function(e,t,i){"use strict";i.d(t,{Z:function(){return f}});var l=i(7180),o=i(7017),s=i(9745),u=i(7007),a=i(2053);var n=new class{get(e){return a.Z.getData(agcim.net.apiPath.styleConfig_get,{id:e})}getNeedFields(e){var t;if(e&&0!=e.length)return t=this.get(e),new Promise(function(i,e){t.then(function(e){var e=JSON.parse(e.content.styleMgrInfo),t=[];e.label.text&&t.push(e.label.text),e.label.height&&t.push(e.label.height),i(t)})})}};class r extends l.Z{constructor(t,e,i){super(t),this.ly=e,this._parentThis=i,this._updateBind=this.update.bind(this),this._genLayer=null,this._isUpdating=!1,this._lastUpdatingTime=0,this._isCreated=!1,this._fields=e.rfsFields||[],this.maxVisibleHeight=e.maxVisibleHeight||1500,this._lastViewExtent=null;let r=this;i=n.getNeedFields(e.styleManagerId);i?i.then(function(e){r._fields=r._fields.concat(e),r.beginListenUpdate(t)}):this.beginListenUpdate(t)}beginListenUpdate(e){e.camera.moveEnd.removeEventListener(this._updateBind),e.camera.moveEnd.addEventListener(this._updateBind)}update(){if(!(0==this.isLayerVisible||this._genLayer&&0==this._genLayer.isLayerVisible))if(this._viewer.camera.positionCartographic.height>this.maxVisibleHeight)this._isCreated&&(this._genLayer._dataSource[0].show=!1);else{if(this._genLayer)for(let e=0;e<this._parentThis._aglayers.length;e++)if(this._parentThis._aglayers[e].id===this._genLayer.id&&this._parentThis._aglayers[e]._toDisposing)return;if(this._isUpdating)3e4<Date.now()-this._lastUpdatingTime&&(this._isUpdating=!1);else{var s=this.ly;let n=this._parentThis,o=this;this._isUpdating=!0,this._lastUpdatingTime=Date.now();var e=s.url,t=(0==e.endsWith("/")&&(e+="/"),e+="filter",this.getFilterRegion()),i=JSON.stringify(this._fields),r=this.getLodLevel(t),a=new FormData;a.append("tableName",s.layerTable),a.append("geometry",t),a.append("level",r),a.append("outFields",i.substr(1,i.length-2)),u.Z.addRFSLayer(e,s.id,a,!this._isCreated,function(e,t,i){var r;o._isUpdating=!1,o._lastUpdatingTime=Date.now(),0!=n._isLayerIdExists(t)&&null!=e&&(r=!1,o._genLayer?(o._genLayer._dataSource[0].show=!0,o._genLayer.update(e,s),r=!1,o.triggerFastViewUpdate(o)):(r=!0,o._genLayer=new l.Z(o.viewer),o._genLayer.geometryType=i.geometryType,o._genLayer._innerAfterDisposeHandler=function(){o._viewer.camera.moveEnd.removeEventListener(o._updateBind),o.isLayerVisible=!1},o._isCreated=!0,i=o._genLayer,"3D"==s.featureType?i.add3d(e,t,s):i.add(e,t,s),i.id=s.id,e.agMetaData=s,r&&(n._aglayers.push(i),n.triggleLayerShowHandler(i,!0,s),n.triggleLayerAddHandler(i,s))),o.viewer.scene.requestRender())})}}}getFilterRegion(){for(var e=[],t=o.Z.getCurrentExtend(this.viewer.scene),i=(this._lastViewExtent=t,["lb","lt","rt","rb","lb"]),r=0;r<i.length;r++){var n=i[r],n=s.Z.getGlobalCartesian().toGeographic(t[n]);e.push(n.lng),e.push(n.lat)}return e}getLodLevel(e){var t={lng:e[2],lat:e[3],alt:0},e={lng:e[4],lat:e[5],alt:0},t=s.Z.getGeographic().toCartesian(t),e=s.Z.getGeographic().toCartesian(e),t=o.Z.getDistance(t,e);return 1e3<t?2:2e3<t?1:0}triggerFastViewUpdate(e){var t;e._lastViewExtent&&(t=o.Z.getCurrentExtend(e.viewer.scene),o.Z.isViewExtendDifferent(t,e._lastViewExtent))&&e._updateBind()}}var c=r;class h{constructor(e){this.serverUrl=e.serverUrl,this.options=e}downloadImage(e){var t,i=JSON.parse(JSON.stringify(e));for(t in i)i[t]=agcim.maths.coordinate.toDegrees(i[t]);var r,n={};for(r in this.options)n[r]=this.options[r];return n=Object.assign({},n,{X:i.west,Y:i.north,height:i.north-i.south,width:i.east-i.west}),a.Z.getDataByPost(this.serverUrl,n)}}var A=class{constructor(e,t){var i=t.serverUrl.split("://"),i=(this.maxViewHeight=t.maxViewHeight||2500,i[0]+"://"+i[1].split("/")[0]);this._updateBind=this.update.bind(this,i),this._viewer=e,this.request=new h(t),this.beginListenUpdate(e),this._singleTileLayer=null,this._lastUpdatingTime=0,this._lastWantRender=!1,this._lastUpdateTick=0,this._isUpdating=!1}beginListenUpdate(e){e.camera.percentageChanged=.4,e.camera.changed.addEventListener(this._updateBind),this._lastUpdateTick=setInterval(this._updateLastHolding,2e3)}update(o){if(!(this._viewer.camera.positionCartographic.height>this.maxViewHeight)&&0!=this.isLayerVisible){console.log("AgDynamicImageLayer Try To Update");var e=Date.now();if(e-this._lastUpdatingTime<500||this._isUpdating)this._lastWantRender=!0;else{let i=new Date,r=(console.log("AgDynamicImageLayer Try To Update  ..2"),this._lastUpdatingTime=e,this._lastWantRender=!1,this._isUpdating=!0,agcim.camera.camera.getViewExtent(this._viewer)),n=this;this.request.downloadImage(r).then(async function(e){n._isUpdating=!1;var t=new Date;console.log("AgDynamicImageLayer 后台裁剪图片用时："+((t-i)/1e3).toFixed(2)),e.Item&&(t=n._handleParams(r,e.Item),e=await Cesium.SingleTileImageryProvider.fromUrl(o+e.Item.split("?")[0],{rectangle:t}),n._singleTileLayer&&n._removeLayer(),(n._singleTileLayer=e).show=n.isLayerVisible,n._viewer.imageryLayers.addImageryProvider(e))})}}}_handleParams(e,t){t=t.split("?")[1].split("&");let i={};t.forEach(e=>{e=e.split("=");i[e[0]]=e[1]});var t=i.offsetX*i.xc,r=i.offsetY*i.yc,t=t<0?Number(i.ox):Number(i.ox)+t,r=0<r?Number(i.oy):Number(i.oy)+r,n=t+i.drawWidth*i.xc,o=r+i.drawHeight*i.yc;return e.west=agcim.maths.coordinate.toRadians(t),e.east=agcim.maths.coordinate.toRadians(n),e.south=agcim.maths.coordinate.toRadians(o),e.north=agcim.maths.coordinate.toRadians(r),e}_updateLastHolding(){this._lastWantRender&&update()}_removeLayer(){let i=this;this._viewer.imageryLayers.remove(i._singleTileLayer),i._singleTileLayer&&this._viewer.imageryLayers._layers.forEach((e,t)=>{e._imageryProvider.url===i._singleTileLayer.url&&(i._singleTileLayer=null,i._viewer.imageryLayers.remove(e))})}setVisible(e){this.isLayerVisible=e,this._singleTileLayer&&(this._singleTileLayer.show=e)}dispose(){return new Promise((e,t)=>{this._viewer.camera.changed.removeEventListener(this._updateBind),this._removeLayer(),clearInterval(this._lastUpdateTick),e()})}};class p{constructor(){this.supportTypes=""}add(e,t,i){console.error("未实现add方法")}}var f=[new class extends p{constructor(){super(),this.supportTypes="011102"}add(e,t,i){e=new A(e,{serverUrl:t.url,inputfile:t.inputfile});e.id=t.id,i._aglayers.push(e),i.triggleLayerShowHandler(e,!0),i.triggleLayerAddHandler(e,t)}},new class extends p{constructor(){super(),this.supportTypes="010500"}add(e,t,i){new c(e,t,i)}}]},2111:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";var _layerLoader__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(9608),_layerTreeDom__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(9342),_utils_layerTreeMonitor__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(5789),_utils_serverLayersIdHelper__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5432),_subFunctions_layerTree_zoomTo__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(9753),_layer_utils_tilesLayerSubDomainHelper__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(1735),_utils_layerConfigHelper__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(3585),_layerClass__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(8105);class LayerTree{constructor(e){this._viewer=e||CIM.viewer,this._layerTreeData={},this._aglayers=[],this._aglayerIds=[],this._onLayerShowHandlers=[],this._onLayerAddHandlers=[],this.layerTreeDom=void 0,this._layerTreeZoom=new _subFunctions_layerTree_zoomTo__WEBPACK_IMPORTED_MODULE_3__.Z(this),this._tilesLayerSubDomainHelper=void 0,this.layerClassList=_layerClass__WEBPACK_IMPORTED_MODULE_5__.Z}loadInitializeLayers(e){if(this.layerTreeDom=new _layerTreeDom__WEBPACK_IMPORTED_MODULE_6__.Z({viewer:this._viewer,layerTree:this}),e&&(_utils_serverLayersIdHelper__WEBPACK_IMPORTED_MODULE_2__.Z.initialize(e),e)&&e.content)for(var t=0;t<e.content[0].children.length;t++)this._loadLayerFromServer(this._viewer,e.content[0].children[t])}_loadLayerFromServer(e,t){if(0<t?.layers?.length)for(let e=0;e<t?.layers?.length;e++){var i;"2"===t.layers[e].proxyType&&(t.layers[e].defaultVersion=t.layers[e].layerVersion.split(",")[0],i=t.layers[e].url,t.layers[e].url=i+t.layers[e].layerAggregateName+"/tileset.json?layerName="+t.layers[e].text+"&version="+t.layers[e].defaultVersion),this._layerTreeData[t.layers[e].id]=t.layers[e]}for(var r=0;r<t?.children?.length;r++)this._loadLayerFromServer(e,t.children[r])}async loadLayer(layerConfig,viewer){let layerClass=this.layerClassList.find(e=>e.layerType.includes(layerConfig.layerType));if(!layerClass)return console.warn("不支持创建图层"+layerConfig.layerType),null;let options=_utils_layerConfigHelper__WEBPACK_IMPORTED_MODULE_4__.Z.updateLayerConfig(layerConfig),layer=("010300"==layerConfig.layerType&&0==eval(layerConfig.baseColor)&&(layerClass=this.layerClassList.find(e=>e.layerType.includes("010301"))),options.viewer=viewer,new layerClass(options));return this.add(layer,layerConfig)}async addMany(t,i){var r=[];i=i||CIM.viewer;for(let e=0;e<t.length;e++){var n,o=t[e];this._checkCancelDispose(o)?(n=this.getLayerById(o),r.push(n)):this._layerTreeData[o]?(n=await this.loadLayer(this._layerTreeData[o],i),r.push(n)):(console.warn("图层树不存在id"+o),r.push(null))}return r}addLayer(t,i){if(!this._checkCancelDispose(t)){var r,n=t.layerType,o=window.origin.replace("http://","");for(let e=0;e<_layerLoader__WEBPACK_IMPORTED_MODULE_0__.Z.length;e++)if(-1!=_layerLoader__WEBPACK_IMPORTED_MODULE_0__.Z[e].supportTypes.indexOf(n)&&this._aglayerIds.indexOf(t.id)<0)return _utils_serverLayersIdHelper__WEBPACK_IMPORTED_MODULE_2__.Z.has(t.id)&&!this._aglayerIds.includes(t.id)&&this._aglayerIds.push(t.id),r={userId:CIM_USER_ID,userName:CIM_USER_NAME,layerId:t.id,layerUrl:t.url,layerName:t.nameCn,serverIp:o},this._tilesLayerSubDomainHelper||(this._tilesLayerSubDomainHelper=new _layer_utils_tilesLayerSubDomainHelper__WEBPACK_IMPORTED_MODULE_7__.Z),t=this._tilesLayerSubDomainHelper.updateGateWay(t),_utils_layerTreeMonitor__WEBPACK_IMPORTED_MODULE_1__.Z.postLayerInfo(r),void _layerLoader__WEBPACK_IMPORTED_MODULE_0__.Z[e].add(i,t,this)}}async add(e,t){return this._checkCancelDispose(e)?(console.warn("存在尚未移除完的图层"+e.id,e),this.getLayerById(e.id)):this._aglayerIds.includes(e.id)?(console.warn("存在重复图层id"+e.id,e),this.getLayerById(e.id)):(e._addToViewer(this,t),this._aglayerIds.push(e.id),this._aglayers.push(e),this.triggleLayerShowHandler(e,!0),this.triggleLayerAddHandler(e,e.agMetaData),await e.addViewerPromise.then(),e)}_checkCancelDispose(e){var t=e.id||e;for(let e=0;e<this._aglayers.length;e++)if(this._aglayers[e].id==t&&this._aglayerIds.indexOf(t)<0&&this._aglayers[e].cancelDispose)return this._aglayers[e].cancelDispose(),this._aglayerIds.push(t),this.triggleLayerShowHandler(t,!0),!0;return!1}removeMany(e){for(var t of e)this.removeLayerById(t)}uncheckAllTerrain(e){var t,i=this._aglayers,r=[];for(t in i)!i[t].agMetaData||"014000"!=i[t].agMetaData.layerType&&"021500"!=i[t].agMetaData.layerType||i[t].id!=e&&r.push(i[t].id);this.removeMany(r)}uncheckArcGISTiledElevationTerrain(){var e,t=this._aglayers,i=[];for(e in t)t[e].agMetaData&&"021500"==t[e].agMetaData.layerType&&t[e].id!=excludeId&&i.push(t[e].id);this.removeMany(i)}removeAll(){var e,t=[];for(e in this._layerTreeData)t.push(e);this.removeMany(t)}removeLayerById(e,t=2e3){var i=this.getLayerById(e);return i?(this.removeLayer(i,t),!0):(this._removeLayerId(e),!1)}removeLayer(e,t){let i=this;i.isLayerExist(e)&&(i._removeLayerId(e.id),this.triggleLayerShowHandler(e,!1),e.dispose(t).then(function(){i._removeLayerRef(e)}))}_removeLayerId(e){for(var t=this._aglayerIds.length-1;-1<t;t--)this._aglayerIds[t]==e&&this._aglayerIds.splice(t,1)}_isLayerIdExists(e){if(_utils_serverLayersIdHelper__WEBPACK_IMPORTED_MODULE_2__.Z.has(e))return 0<=this._aglayerIds.indexOf(e)}getLayerById(t){for(let e=0;e<this._aglayers.length;e++)if(this._aglayers[e].id==t)return this._aglayers[e];return null}getLayerByText(e){for(var t in this._layerTreeData)if(this._layerTreeData[t].nameCn==e)return this._layerTreeData[t];return null}isLayerExist(e){var t=this._aglayerIds;return!!(e&&e.id&&0<=t.indexOf(e.id))}_removeLayerRef(e){for(var t=this._aglayers.length-1;-1<t;t--)if(this._aglayers[t]==e)return void this._aglayers.splice(t,1)}setLayerOpacityById(e,t){e=this.getLayerById(e);return!!e&&(e.setOpacity(t),!0)}setLayerVisibleByTreeNodeText(e,t){this.vueDom&&this.vueDom.setLayerVisibleByTreeNodeText(e,t)}addLayerShowHandler(e){this._onLayerShowHandlers.indexOf(e)<0&&this._onLayerShowHandlers.push(e)}removeLayerShowHandler(e){e=this._onLayerShowHandlers.indexOf(e);0<=e&&this._onLayerShowHandlers.splice(e,1)}triggleLayerShowHandler(e,t){for(var i=0;i<this._onLayerShowHandlers.length;i++)this._onLayerShowHandlers[i](e,t)}addLayerAddHandler(e){this._onLayerAddHandlers.indexOf(e)<0&&this._onLayerAddHandlers.push(e)}removeLayerAddHandler(e){e=this._onLayerAddHandlers.indexOf(e);0<=e&&this._onLayerAddHandlers.splice(e,1)}triggleLayerAddHandler(e,t){for(var i=0;i<this._onLayerAddHandlers.length;i++)this._onLayerAddHandlers[i](e,t)}zoomToLayerById(e,t){this._layerTreeZoom.zoomToLayerById(e,t)}zoomToLayer(e,t){this._layerTreeZoom.zoomToLayer(e,t)}addLayerLoader(e){_layerLoader__WEBPACK_IMPORTED_MODULE_0__.Z.push(e)}}__webpack_exports__.Z=LayerTree},9342:function(e,t){"use strict";t.Z=class{constructor(e){this.viewer=e.viewer||CIM.viewer,this.layerTree=e.layerTree||CIM.layerTree}setParentHandler(e){this.parentHandler=e}getCheckedLayerIds(){return this.parentHandler.checkedKeys}findTreeNode(e,t){if(e){for(var i=e.$children,r=0;r<i.length;r++){if(i[r].dataRef&&i[r].dataRef.id==t)return i[r];var n=this.findTreeNode(i[r],t);if(n)return n}return null}}setLayerViewCheck(e,t){if(t){for(var i=this.layerTree._aglayerIds,r=[],n=e.length-1;-1<n;n--)i.indexOf(e[n])<0&&r.push(e[n]);this.layerTree.addMany(r,this.viewer)}else{for(r=[],n=(i=this.layerTree._aglayerIds).length-1;-1<n;n--)0<=e.indexOf(i[n])&&r.push(i[n]);this.layerTree.removeMany(r,this.viewer)}}setLiveLayerViewCheck(e,t){if(t){for(var i=this.layerTree._aglayerIds,r=[],n=e.length-1;-1<n;n--)i.indexOf(e[n])<0&&r.push(e[n]);this.layerTree.addMany(r,this.viewer)}else{for(r=[],n=(i=this.layerTree._aglayerIds).length-1;-1<n;n--)e.indexOf(i[n])<0&&r.push(i[n]);this.layerTree.removeMany(r,this.viewer)}}setLayerCheck(e,t){if(this.parentHandler){var i=this.findTreeNode(this.parentHandler,e);if((i=i||{checked:t,dataRef:this.layerTree._layerTreeData[e]}).dataRef){var r=[],n=[];if(t){n.push(e);for(var o=0;o<this.parentHandler.checkedKeys.length;o++){var s=this.parentHandler.checkedKeys[o];r.push(this.layerTree._layerTreeData[s]),n.indexOf(s)<0&&n.push(s)}this.parentHandler.onCheck(n,{checked:t,node:i}),this.parentHandler.checkedKeys.includes(e)||this.parentHandler.checkedKeys.push(e)}else{for(o=0;o<this.parentHandler.checkedKeys.length;o++){s=this.parentHandler.checkedKeys[o];r.push(this.layerTree._layerTreeData[s]),n.indexOf(s)<0&&n.push(s)}var a=n.indexOf(e);0<=a&&n.splice(a,1),this.parentHandler.onCheck(n,{checked:t,node:i}),0<=(a=this.parentHandler.checkedKeys.indexOf(e))&&this.parentHandler.checkedKeys.splice(a,1)}}}else this.handlePrevTreeLoad(e,t)}handlePrevTreeLoad(e,t){this.setLayerViewCheck([e],t)}}},9753:function(e,t,i){"use strict";i.d(t,{Z:function(){return c}});var r=i(7171),o=i(1710),n=(i(1049),i(7007)),s=i(4723),a=i(922),l=i(7014);var u=new class{zoomToLayerById(e,t,i){var r=e._layerTreeData[t];return this.zoomToLayer(e,r,t,i)}zoomToLayer(e,t,i,r){return!(!t||((e=e.getLayerById(i))&&e.zoomToLayer?(e.zoomToLayer(),0):(i=t.layerType||t.agMetaData?.layerType,this.containsSupportType("040203, 040003, 030300",i)?(this.zoomToWFSLayer(t,r),0):this.containsSupportType("010500",i)?(this.zoomToRFSLayer(t,r),0):this.containsSupportType("113200",i)?(this.zoomToS3MLayer(e,r),0):this.containsSupportType("020200,020202,021101,021102, 020302,021300,021400",i)?(this.zoomToArcGISLayer(e,r),0):this.containsSupportType("021500",i)?(this.zoomToArcGISTerrainLayer(e),0):this.containsSupportType("050002, 050003, 030100, 010100,110100",i)?(this.zoomToWMTSLayer(e,r),0):this.containsSupportType("021101",i)?(this.zoomToImageLayer(e,r),0):this.containsSupportType("030200, 010200,110200",i)?(this.zoomToWMSLayer(e,r),0):this.containsSupportType("011102",i)?(this.zoomToDynamicImageLayer(e,r),0):!this.containsSupportType("113210",i)||(this.zoomToSuperMapS3MTilesLayer(e,r),0))))}containsSupportType(e,t){return 0<=e.indexOf(t)}zoomToWFSLayer(e,t){var i=(i=e.url.indexOf("?"))<0?e.url.length:i;new r.Z(e.url.substr(0,i)).getLayerExtent(e.layerTable).then(function(e){o.Z.setCameraByRectangle(CIM.viewer,e[0],e[1],e[2],e[3],t)})}zoomToRFSLayer(e,i){n.Z.getRegion(e).then(function(e){var t,e=e.data;e.content&&e.content.east?(t=e.content,o.Z.setCameraByRectangle(CIM.viewer,t.west,t.south,t.east,t.north,i)):o.Z.setCameraByRectangle(CIM.viewer,e[0],e[1],e[2],e[3],i)})}zoomToS3MLayer(e){if(e){const t=CIM.viewer.scene.postRender.addEventListener(()=>{e._primitives[0].ready&&(CIM.viewer.camera.flyToBoundingSphere(e._primitives[0].boundingSphere),t())})}}zoomToWMTSLayer(t,i){var e;t.agMetaData&&(t.agMetaData.viewRectangle?(e=t.agMetaData.viewRectangle,o.Z.setCameraByRectangle(CIM.viewer,e.west,e.south,e.east,e.north,i)):new a.Z(t.agMetaData.url).getRegion(t.agMetaData.layerTable).then(e=>{t.agMetaData.viewRectangle=e,o.Z.setCameraByRectangle(CIM.viewer,e.west,e.south,e.east,e.north,i)}))}zoomToArcGISLayer(e,t){var i;e.agMetaData&&e.agMetaData.viewRectangle?(i=e.agMetaData.viewRectangle,o.Z.setCameraByRectangle(CIM.viewer,i.west,i.south,i.east,i.north,t)):e._imageryLayers&&(i=e._imageryLayers[0]._imageryProvider._rectangle,o.Z.setCameraByRectangle(CIM.viewer,Cesium.Math.toDegrees(i.west),Cesium.Math.toDegrees(i.south),Cesium.Math.toDegrees(i.east),Cesium.Math.toDegrees(i.north),t))}zoomToArcGISTerrainLayer(e,t){var i;e.agMetaData&&e.agMetaData.viewRectangle?(i=e.agMetaData.viewRectangle,o.Z.setCameraByRectangle(CIM.viewer,i.west,i.south,i.east,i.north,t)):e._viewer.terrainProvider&&(i=e._viewer.terrainProvider._rectangle,o.Z.setCameraByRectangle(CIM.viewer,Cesium.Math.toDegrees(i.west),Cesium.Math.toDegrees(i.south),Cesium.Math.toDegrees(i.east),Cesium.Math.toDegrees(i.north),t))}zoomToImageLayer(e){var t;e&&0!=(e=e._imageryLayers).length&&(e[0]._imageryProvider._selectedCS?(t=s.Z.findCrsByName(e[0]._imageryProvider._selectedCS.crsName).getViewShift(),t=agcim.maths.coordinate.getWebMercator().toCartographic(new Cesium.Cartesian3(t.x,t.y,3e5),CIM.viewer),t=Cesium.Cartesian3.fromRadians(t.longitude,t.latitude,t.height),CIM.viewer.camera.setView({destination:t})):(t=e[0].getImageryRectangle(),e=Cesium.Rectangle.fromDegrees(t.west,t.south,t.east,t.north),CIM.viewer.camera.setView({destination:e})))}zoomToWMSLayer(e,t){e.agMetaData&&e.agMetaData.rectangle&&(e=e.agMetaData.rectangle,o.Z.setCameraByRectangle(CIM.viewer,e.west,e.south,e.east,e.north,t))}zoomToDynamicImageLayer(e,t){if(e._singleTileLayer){var i,r=e._singleTileLayer._tilingScheme._rectangle,n={};for(i in r)n[i]=l.Z.coordinate.toDegrees(r[i]);o.Z.setCameraByRectangle(CIM.viewer,n.west,n.south,n.east,n.north,t)}}zoomToSuperMapS3MTilesLayer(e){e.zoomToLayer()}};var c=class{constructor(e){this._layerTree=e}zoomToLayerById(e,t){if(u.zoomToLayerById(this._layerTree,e,t))return!0;this._defualtZoomToLayer(e)}zoomToLayer(e,t){if(u.zoomToLayer(this._layerTree,e,e.id,t))return!0;this._defualtZoomToLayer(e.id)}_defualtZoomToLayer(e){var t=this._layerTree.getLayerById(e);if(t){e=t._imageryLayers;if(e&&e[0]){e=e[0].getImageryRectangle(),e=Cesium.Rectangle.fromDegrees(e.west,e.south,e.east,e.north);this._layerTree._viewer.camera.setView({destination:e})}else{var i=["_primitives","_entities","_dataSource"];for(let e=0;e<i.length;e++)if(t[i[e]]&&0<t[i[e]].length){if("_primitives"===i[e]&&t[i[e]][0]._isCustomPrimitiveTag)return void t[i[e]][0].ZoomToMeanCenter(CIM.viewer);this._layerTree._viewer.flyTo(t[i[e]][0])}}return!0}}}},3585:function(e,t,i){"use strict";i.d(t,{Z:function(){return a}});var o=i(1735),r=i(2053),n=i(8706);var s=new class{constructor(){this.sitesTokenArray=[]}async initialize(){let t=this;await this.getSitesToken().then(e=>{e&&e.success&&(t.sitesTokenArray=e.content)})}async getTokenBySiteId(t){this.sitesTokenArray.length||await this.initialize();for(let e=0;e<this.sitesTokenArray.length;e++)if(this.sitesTokenArray[e].id==t)return this.sitesTokenArray[e].token;return null}async getTokenBySiteName(t){this.sitesTokenArray.length||await this.initialize();for(let e=0;e<this.sitesTokenArray.length;e++)if(this.sitesTokenArray[e].site==t)return this.sitesTokenArray[e].token;return null}getSitesToken(){return new Promise(async(t,i)=>{await r.Z.getData(n.Z.getArcgisToken).then(e=>{(e.success?t:i)(e)},e=>{i(e)})})}};var a=new class{updateLayerConfig(t){let i=null;try{i=JSON.parse(JSON.stringify(t))}catch(e){console.log(e),i=t}if(i.data){let e={};try{e=JSON.parse(i.data)}catch(e){console.log(e)}e.tileSize&&(i.tileWidth=parseFloat(e.tileSize)),e.tileSize&&(i.tileHeight=parseFloat(e.tileSize)),e.coordinateSystem&&(i.crs=e.coordinateSystem),e.dataVersion&&(i.version=e.dataVersion),e.tileMatrixSet&&(i.tileMatrixSet=e.tileMatrixSet)}if(i.mapParam){if(i.mapParam?.mapParamReferenceValue)try{i.spatialReference=JSON.parse(i.mapParam.mapParamReferenceValue)}catch(e){console.log(e)}if(0<Number(i.mapParam?.mapParamMaxZoom)&&(i.maximumLevel=Number(i.mapParam.mapParamMaxZoom)),0<Number(i.mapParam?.mapParamMinZoom)&&(i.minimumLevel=Number(i.mapParam.mapParamMaxZoom)),0<i.mapParam?.mapParamCutMapOrigin?.indexOf(",")&&(i.tileOriginX=parseFloat(i.mapParam.mapParamCutMapOrigin.split(",")[0]),i.tileOriginY=parseFloat(i.mapParam.mapParamCutMapOrigin.split(",")[1])),0<i.mapParam?.mapParamCenter?.indexOf(",")&&(i.centerLon=parseFloat(i.mapParam.mapParamCenter.split(",")[0]),i.centerLat=parseFloat(i.mapParam.mapParamCenter.split(",")[1])),i.mapParam?.mapParamScales)try{var r=JSON.parse(i.mapParam.mapParamScales);if(0<r?.length){i.tile0Resolution=parseFloat(r[0].resolution),i.tileMatrixLabels=[];for(let e=0;e<r.length;e++)i.tileMatrixLabels.push(r[e].level)}}catch{var n=i.mapParam.mapParamScales.split(",");if(0<n?.length){i.tile0Resolution=parseFloat(n[0]),i.tileMatrixLabels=[];for(let e=0;e<n.length;e++)i.tileMatrixLabels.push(e)}}}return i.siteId&&(i.token=s.getTokenBySiteId(i.siteId)),this._tilesLayerSubDomainHelper||(this._tilesLayerSubDomainHelper=new o.Z),(i=this._tilesLayerSubDomainHelper.updateGateWay(i)).specular&&""!=i.specular&&(i.tilesetOption=i.tilesetOption||{},i.tilesetOption.lightColor=JSON.parse(i.specular)),i}}},5789:function(e,t,i){"use strict";var r=i(3259),n=i(9126),o=i.n(n);t.Z=new class{constructor(){this.enable=!1}postLayerInfo(e){0!=this.enable&&r.Z.post(agcim.net.apiPath.dir_clickLayer,o().stringify(e)).then(function(){})}}},5432:function(e,t){"use strict";t.Z=new class{constructor(){this._serverLayersIds=[]}initialize(e){if(e&&e.content)for(var t=0;t<e.content[0].children?.length;t++)this.traversal(e.content[0].children[t])}traversal(t){if(0<t.layers?.length)for(let e=0;e<t.layers.length;e++)this._serverLayersIds.push(t.layers[e].id);for(var e=0;e<t.children?.length;e++)this.traversal(t.children[e])}has(e){return 0<=this._serverLayersIds.indexOf(e)}}},8698:function(e,t){"use strict";t.Z=new class{constructor(){}subtract(e,t){return Cesium.Cartesian3.subtract(e,t,new Cesium.Cartesian3(0,0,0))}add(e,t){return Cesium.Cartesian3.add(e,t,new Cesium.Cartesian3(0,0,0))}normalize(e){return 0==e.x&&0==e.y?new Cesium.Cartesian3(0,0,0):Cesium.Cartesian3.normalize(e,new Cesium.Cartesian3(0,0,0))}cross(e,t){return Cesium.Cartesian3.cross(e,t,new Cesium.Cartesian3(0,0,0))}multiplyByScalar(e,t){return Cesium.Cartesian3.multiplyByScalar(e,t,new Cesium.Cartesian3(0,0,0))}}},9359:function(e,t,i){"use strict";i.d(t,{Z:function(){return n}});var t=i(9644),s=i.n(t),r=i(9745);class n{constructor(e,t="EPSG:4326",i="1.1.0",r){this.url=e,this.coordinateSystemName=t,this.version=i,this.options=r||{}}async getCapabilities(){return s().get(this.url,{params:{service:"wfs",version:this.version,request:"GetCapabilities",outputFormat:"application/json"}})}async getFeatureByExtentArray(e="",t=[],i={},r=!1){var n,o;if(0!=t.length)return t=t.join()+","+this.coordinateSystemName,e={service:"wfs",version:this.version,request:"GetFeature",maxFeatures:2e3,count:2e3,outputFormat:"application/json",typeName:e,srsName:"EPSG:4326"},r?/BBOX/.test(i.cql_filter.toUpperCase())?(r=i.cql_filter.replace(/[\r\n]/g,""),n=/BBOX\((.*?)\)/g.exec(r)[1].split(","),o=t.split(","),n[1]=o[0],n[2]=o[1],n[3]=o[2],n[4]=o[3],o=r.replace(/BBOX\((.*?)\)/g,`BBOX(${n.join(",")})`),i.cql_filter=o):(r=t.split(","),i?.cql_filter_geometry_field||console.error("cql_filter 几何筛选对应几何字段未设置，使用默认shape_geom"),n=`BBOX(${i?.cql_filter_geometry_field||"shape_geom"},${r[0]},${r[1]},${r[2]},${r[3]})`,i.cql_filter=i.cql_filter+" AND "+n):e.bbox=t,o=Object.assign(e,i),i.maxFeatures?o.count=i.maxFeatures:i.count&&(o.maxFeatures=i.count),s().get(this.url,{params:o})}async describeFeatureType(e="",t={}){if(0!=e.length)return e={service:"wfs",version:this.version,request:"DescribeFeatureType",outputFormat:"application/json",typeName:e},e=Object.assign(e,t),s().get(this.url,{params:e})}async queryProperty(e,t,i,r={}){if(0!=e.length)return e={service:"wfs",version:this.version,request:"GetFeature",outputFormat:"application/json",typeName:e,cql_filter:t,maxFeatures:r.maxFeatures,count:r.maxFeatures,sortBy:r.sortBy,propertyName:i,srsName:"EPSG:4326"},t=Object.assign(e,r),r.maxFeatures?t.count=r.maxFeatures:r.count&&(t.maxFeatures=r.count),(await s().get(this.url,{params:t})).data}async _queryFeatrue(e="",t,i={}){if(0!=e.length)return e={service:"wfs",version:this.version,request:"GetFeature",outputFormat:"application/json",typeName:e,FILTER:t,srsName:"EPSG:4326"},t=Object.assign(e,i),(await s().get(this.url,{params:t})).data}async intersectsPoint(e="",t,i,r={}){if(i=i||await this.getGeometryName(e),0!=e.length&&t&&0!=i.length)return i='<Filter xmlns="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml"><Intersects><PropertyName>'+i+'</PropertyName><gml:Point srsName="'+this.coordinateSystemName+'"><gml:coordinates>'+this.cartesian3sToWfsCrsString([t])+"</gml:coordinates></gml:Point></Intersects></Filter>",this._queryFeatrue(e,i,r)}async intersectsLine(e="",t=[],i,r={}){if(!(0==e.length||t.length<2||0==i.length))return i='<Filter xmlns="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml"><Intersects><PropertyName>'+i+'</PropertyName><gml:LineString srsName="'+this.coordinateSystemName+'"><gml:coordinates>'+this.cartesian3sToWfsCrsString(t)+"</gml:coordinates></gml:LineString></Intersects></Filter> ",this._queryFeatrue(e,i,r)}async intersectsPolygon(e="",t=[],i,r={}){if(i=i||await this.getGeometryName(e),!(0==e.length||t.length<2||0==i.length))return i='<Filter xmlns="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml"><Intersects><PropertyName>'+i+'</PropertyName><gml:Polygon srsName="'+this.coordinateSystemName+'"><gml:exterior><gml:LinearRing  srsName="'+this.coordinateSystemName+'"><gml:coordinates>'+this.wfsQueryPolygon(t)+"</gml:coordinates></gml:LinearRing></gml:exterior></gml:Polygon></Intersects></Filter>",this._queryFeatrue(e,i,r)}async containsPolygon(e="",t=[],i,r={}){if(i=i||await this.getGeometryName(e),!(0==e.length||t.length<2||0==i.length))return i='<Filter xmlns="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml"><Within><PropertyName>'+i+'</PropertyName><gml:Polygon srsName="'+this.coordinateSystemName+'"><gml:exterior><gml:LinearRing  srsName="'+this.coordinateSystemName+'"><gml:coordinates>'+this.wfsQueryPolygon(t)+"</gml:coordinates></gml:LinearRing></gml:exterior></gml:Polygon></Within></Filter>",this._queryFeatrue(e,i,r)}async queryFeatureBySpatialRelationshipCQL(e,t,i="INTERSECTS",r){r=r||await this.getGeometryName(e);e={request:"GetFeature",version:"1.0.0",typeName:e,outputFormat:"application/json",cql_filter:i.toUpperCase()+`(${r}, ${t})`,srsName:"EPSG:4326"};return s().get(this.url,{params:e})}wfsQueryPolygon(e=[]){if(!(e.length<3))return e[0].equals(e.length-1)||e.push(e[0]),this.cartesian3sToWfsCrsString(e)}cartesian3sToWfsCrsString(e){if(this.options.spatialReference){let t=new Cesium.CRSSupport(this.options.spatialReference);var i=e.map(e=>{e=r.Z.getGlobalCartesian().toGeographic(e),e=t._WGS84ToPosition([e.lng,e.lat]);return{lng:e[0],lat:e[1]}});return this.wfsGeometryString(i)}return this.cartesian3sToWfsWGS84Stsring(e)}cartesian3sToWfsWGS84Stsring(e){e=e.map(e=>r.Z.getGlobalCartesian().toGeographic(e));return this.wfsGeometryString(e)}wfsGeometryString(t){let i="";for(let e=0;e<t.length;e++)i+=t[e].lng+","+t[e].lat+" ";return i}async getGeometryName(e){if(this.geomNameList||(this.geomNameList={}),this.geomNameList[e])return this.geomNameList[e];let t="the_geom";var i={service:"wfs",version:"1.1.0",request:"GetFeature",maxFeatures:1,count:1,outputFormat:"application/json",typeName:e,srsName:"EPSG:4326"},i=await s().get(this.url,{params:i});return i&&i.data&&i.data.features&&i.data.features.length&&(t=i.data.features[0].geometry_name,this.geomNameList[e]=t),t}async getFeature(e){var t={service:"wfs",version:"1.1.0",request:"GetFeature",maxFeatures:1,count:1,outputFormat:"application/json",typeName:"",cql_filter:"1=1",startIndex:0,sortBy:"",srsName:"EPSG:4326"},e=(Object.assign(t,e),await s().get(this.url,{params:t}));return e}}},7171:function(e,t,i){"use strict";i.d(t,{Z:function(){return o}});var t=i(9644),r=i.n(t),n=i(4764);class o{constructor(e,t="1.1.0"){this.url=e,this.version=t}async getCapabilities(e="application/json"){return r().get(this.url,{params:{service:"wfs",version:this.version,request:"GetCapabilities",outputFormat:e}})}async getLayerExtent(t){var e,i,r=await this.getCapabilities("xml"),r=(new DOMParser).parseFromString(r.data,"text/xml"),r=Object.values(r.querySelectorAll("FeatureType")).find(e=>e.innerHTML.includes(t));if(r)return e=[],i=r.innerHTML.split("<ows:LowerCorner>")[1].split("</ows:LowerCorner>")[0],r=r.innerHTML.split("<ows:UpperCorner>")[1].split("</ows:UpperCorner>")[0],e.push(i.split(" ")),e.push(r.split(" ")),e.flat(1).map(e=>Number.parseFloat(e))}async describeFeatureType(e,t={}){if(0!=e.length)return e={service:"wfs",version:this.version,request:"DescribeFeatureType",outputFormat:"application/json",typename:e},e=Object.assign(e,t),r().get(this.url,{params:e})}async execute(e){var t={service:"wfs",version:this.version,request:"GetFeature"},t=Object.assign(t,e);return(await r().get(this.url,{params:t})).data}async executeForCount(e){var e=Object.assign(e,{outputFormat:"text/xml; subtype=gml/2.1.2",resulttype:"hits"}),e=await this.execute(e),t=document.createElement("div");return t.innerHTML=e,{count:Number.parseInt(t.children[0].getAttribute("numberOfFeatures"))}}async executeForExtent(e){e=await this.execute(e);let t=[1/0,1/0,-1/0,-1/0];return e.features.forEach(e=>{e=n.Z.turf.bbox(e);t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[2]),t[3]=Math.max(t[3],e[3])}),{count:e.features.length,extent:t}}async executeForIds(e){return(await this.execute(e)).features.map(e=>e.id)}}},2401:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";var _net_axiosWraper__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2053);class widgetConfigHelper{getConfig(e,r){e=agcim.net.apiPath.widgetConfig_getConfigList+"?code="+e;_net_axiosWraper__WEBPACK_IMPORTED_MODULE_0__.Z.getData(e).then(e=>{var t={},i={};if(e.content.forEach(function(e){e.isActive&&(t[e.configKey]=e.configValue,i[e.configKey]=e.configType)}),r)try{r(t,i)}catch(e){console.warn("加载微件配置错误:"+e)}})}getConfigTo(widgetCode,configToStore,finishHandler){this.getConfig(widgetCode,function(configKeyValue,configKeyType){for(var name in configKeyValue)try{if("float"==configKeyType[name])configToStore[name]=parseFloat(configKeyValue[name]);else if("point"==configKeyType[name])configToStore[name]=eval("("+configKeyValue[name]+")");else if("array-str"==configKeyType[name])configToStore[name]=configKeyValue[name].split(",");else if("array-float"==configKeyType[name]){var str=configKeyValue[name].split(",");configToStore[name]=[];for(var i=0;i<str.length;i++)configToStore[name].push(parseFloat(str[i]))}else configToStore[name]=configKeyValue[name]}catch(e){console.warn("不能解析widgetConfigHelper:"+name)}if(configToStore.endSetConfig&&configToStore.endSetConfig(),finishHandler)try{finishHandler(configKeyValue)}catch(e){console.warn("加载微件配置错误:"+e)}return configToStore})}setInitSence(t,i){if(t&&(t.position&&i.camera.flyTo({destination:new Cesium.Cartesian3(t.position.arr[0],t.position.arr[1],t.position.arr[2]),orientation:{heading:t.position.heading,roll:t.position.roll,pitch:t.position.pitch}}),t.layer))for(let e=0;e<t.layer.length;e++){var r=CIM.layerTree.getLayerByText(t.layer[e]),n=CIM.layerTree._aglayerIds;r&&r.id&&-1==n.indexOf(r.id)&&CIM.layerTree.addLayer(r,i)}}}__webpack_exports__.Z=new widgetConfigHelper},3260:function(){},8151:function(e,t,i){"use strict";i.d(t,{Z:function(){return n}});const l=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class n{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");var[t,i]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");t=i>>4;if(1!=t)throw new Error(`Got v${t} data when expected v1.`);var r,t=l[15&i];if(t)return[i]=new Uint16Array(e,2,1),[r]=new Uint32Array(e,4,1),new n(r,i,t,e);throw new Error("Unrecognized array type.")}constructor(e,t=64,i=Float64Array,r){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;var n=l.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,s=e*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(n<0)throw new Error(`Unexpected typed array class: ${i}.`);r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+n]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){var i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=t,i}finish(){var e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return function e(t,i,r,n,o,s){if(o-n<=r)return;const a=n+o>>1;p(t,i,a,n,o,s);e(t,i,r,n,a-1,1-s);e(t,i,r,1+a,o,1-s)}(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,r,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");for(var{ids:o,coords:s,nodeSize:e}=this,a=[0,o.length-1,0],l=[];a.length;){var u=a.pop()||0,c=a.pop()||0,h=a.pop()||0;if(c-h<=e)for(let e=h;e<=c;e++){var A=s[2*e],p=s[2*e+1];t<=A&&A<=r&&i<=p&&p<=n&&l.push(o[e])}else{var f=h+c>>1,d=s[2*f],g=s[2*f+1];t<=d&&d<=r&&i<=g&&g<=n&&l.push(o[f]),(0===u?t<=d:i<=g)&&(a.push(h),a.push(f-1),a.push(1-u)),(0===u?d<=r:g<=n)&&(a.push(1+f),a.push(c),a.push(1-u))}}return l}within(t,i,e){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");for(var{ids:r,coords:n,nodeSize:o}=this,s=[0,r.length-1,0],a=[],l=e*e;s.length;){var u=s.pop()||0,c=s.pop()||0,h=s.pop()||0;if(c-h<=o)for(let e=h;e<=c;e++)d(n[2*e],n[2*e+1],t,i)<=l&&a.push(r[e]);else{var A=h+c>>1,p=n[2*A],f=n[2*A+1];d(p,f,t,i)<=l&&a.push(r[A]),(0===u?t-e<=p:i-e<=f)&&(s.push(h),s.push(A-1),s.push(1-u)),(0===u?p<=t+e:f<=i+e)&&(s.push(1+A),s.push(c),s.push(1-u))}}return a}}function p(i,r,n,o,s,a){for(;o<s;){600<s-o&&(l=s-o+1,u=n-o+1,h=Math.log(l),c=.5*Math.exp(2*h/3),h=.5*Math.sqrt(h*c*(l-c)/l)*(u-l/2<0?-1:1),p(i,r,n,Math.max(o,Math.floor(n-u*c/l+h)),Math.min(s,Math.floor(n+(l-u)*c/l+h)),a));var l,u,c,h,A=r[2*n+a];let e=o,t=s;for(f(i,r,o,n),r[2*s+a]>A&&f(i,r,o,s);e<t;){for(f(i,r,e,t),e++,t--;r[2*e+a]<A;)e++;for(;r[2*t+a]>A;)t--}r[2*o+a]===A?f(i,r,o,t):f(i,r,++t,s),t<=n&&(o=t+1),n<=t&&(s=t-1)}}function f(e,t,i,r){o(e,i,r),o(t,2*i,2*r),o(t,2*i+1,2*r+1)}function o(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function d(e,t,i,r){e-=i,i=t-r;return e*e+i*i}},9521:function(e){"use strict";e.exports=JSON.parse('{"name":"axios","version":"0.21.4","description":"Promise based HTTP client for the browser and node.js","main":"index.js","scripts":{"test":"grunt test","start":"node ./sandbox/server.js","build":"NODE_ENV=production grunt build","preversion":"npm test","version":"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json","postversion":"git push && git push --tags","examples":"node ./examples/server.js","coveralls":"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","fix":"eslint --fix lib/**/*.js"},"repository":{"type":"git","url":"https://github.com/axios/axios.git"},"keywords":["xhr","http","ajax","promise","node"],"author":"Matt Zabriskie","license":"MIT","bugs":{"url":"https://github.com/axios/axios/issues"},"homepage":"https://axios-http.com","devDependencies":{"coveralls":"^3.0.0","es6-promise":"^4.2.4","grunt":"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1","karma":"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2","minimist":"^1.2.0","mocha":"^8.2.1","sinon":"^4.5.0","terser-webpack-plugin":"^4.2.3","typescript":"^4.0.5","url-search-params":"^0.10.0","webpack":"^4.44.2","webpack-dev-server":"^3.11.0"},"browser":{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},"jsdelivr":"dist/axios.min.js","unpkg":"dist/axios.min.js","typings":"./index.d.ts","dependencies":{"follow-redirects":"^1.14.0"},"bundlesize":[{"path":"./dist/axios.min.js","threshold":"5kB"}]}')}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];return void 0!==t||(t=__webpack_module_cache__[e]={exports:{}},__webpack_modules__[e].call(t.exports,t,t.exports,__webpack_require__)),t.exports}__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=function(e,t){for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};!function(){"use strict";var e={},O=(__webpack_require__.r(e),__webpack_require__.d(e,{EmissiveEffect:function(){return xe},FlowFloodLightEffect:function(){return Be},FlowLightEffect:function(){return we},HeightHierarchyEffect:function(){return Me},LimitHeightEffect:function(){return Ie},MultipleFeatureEffect:function(){return be},MultipleImageEffect:function(){return Ee},MultipleLightEffect:function(){return Se},VideoEffect:function(){return ve},WhiteModelEffect:function(){return _e}}),{}),R=(__webpack_require__.r(O),__webpack_require__.d(O,{SkyBox:function(){return $o}}),{}),U=(__webpack_require__.r(R),__webpack_require__.d(R,{Particle:function(){return as},ParticleSystem:function(){return ws},TargetEmitter:function(){return Bs}}),{}),k=(__webpack_require__.r(U),__webpack_require__.d(U,{Weather:function(){return bo}}),{}),H=(__webpack_require__.r(k),__webpack_require__.d(k,{CreateDiffuseMaterial:function(){return Ms},CreateDotMaterial:function(){return Is},CreateDynamicColor:function(){return Ss},CreateFlowMaterial:function(){return Ps},CreateFlowWater:function(){return Ts},CreateLightMaterial:function(){return Ls},CreateMagmaMaterial:function(){return Ns},CreatePbrMetallicRoughnessMaterial:function(){return Os.Z},CreateSparklyMaterial:function(){return Ds},CreateStarfieldMaterial:function(){return Fs}}),{});__webpack_require__.r(H),__webpack_require__.d(H,{CircleColorfulMaterialProperty:function(){return Ca},CircleSpiralMaterialProperty:function(){return ya},CircleWaveMaterialProperty:function(){return Pa},DiffuseMaterialProperty:function(){return qs},DotProperty:function(){return Zs},DynamicColorProperty:function(){return Js},EllipsoidElectricMaterialProperty:function(){return ba},EllipsoidFadeMaterialProperty:function(){return Ma},FlowMaterialProperty:function(){return ta},LightMaterialProperty:function(){return oa},LineFlowMaterialProperty:function(){return da},PbrMetallicRoughnessMaterialProperty:function(){return Aa.Z},PolylineTrailLinkMaterialProperty:function(){return Da},SparklyProperty:function(){return la},StarfieldProperty:function(){return ha}}),__webpack_require__(5989);var Q={lineGrowth:class{constructor(e,t){this.points=[];for(var i,r=0;r<t.length;r++)t[r]instanceof Cesium.Cartesian3?this.points.push(t[r]):(i=Cesium.Cartesian3.fromDegrees(t[r][0],t[r][1],0),this.points.push(i));this._viewer=e,this._stopTime=null,this.entity=[],this._lastRoundTime=null,this._startTime=null,this._currentFakeTime=new Cesium.JulianDate}start(){var e=this._viewer;let i=this;var r=this.createSampleProperty(this.points),n=[],t=Cesium.Color.fromBytes(10,100,200,200),t=e.entities.add({polyline:{name:"annimaPolyline",positions:new Cesium.CallbackProperty(function(e){var t;return r.property?(t=null,(t=i._lastRoundTime?(i._currentFakeTime=i.getRoundTime(e,i),r.property.getValue(i._currentFakeTime)):r.property.getValue(e))?(n.push(t),n):(i._lastRoundTime=e.clone(),n=[])):null},!1),width:5,material:t}});this.entity.push(t),this.setRunTimeRange(e,r,6e3)}getRoundTime(e,t){return Cesium.JulianDate.addSeconds(t._startTime,Cesium.JulianDate.secondsDifference(e,t._lastRoundTime),t._currentFakeTime)}setRunTimeRange(e,t){var i=e.clock.currentTime,t=(this._startTime=i,Cesium.JulianDate.addSeconds(i,t,new Cesium.JulianDate));e.clock.startTime=i.clone(),e.clock.stopTime=t.clone(),e.clock.clockRange=Cesium.ClockRange.LOOP_STOP,this._stopTime=t,e.clock.shouldAnimate=!0}stop(){for(let e=0;e<this.entity.length;e++)this._viewer.entities.remove(this.entity[e])}createSampleProperty(e){for(var t=0,i=0;i<e.length-1;i++)t+=Cesium.Cartesian3.distance(e[i],e[i+1]);for(var r=this._viewer.clock.currentTime,n=new Cesium.SampledPositionProperty,o=0,i=1;i<e.length;i++){1==i&&n.addSample(r,e[i-1]);o+=Cesium.Cartesian3.distance(e[i],e[i-1])/5e3;var s=Cesium.JulianDate.addSeconds(r,o,new Cesium.JulianDate);n.addSample(s,e[i])}return{property:n,startTime:r,allTime:t/5e3}}}},V=__webpack_require__(1710),G={camera:V.Z},z=__webpack_require__(8610);var W=new class{setMaterialFromImage(e,t){e.appearance.material=new Cesium.Material({fabric:{type:"Image",uniforms:{image:t}}})}setOpacity(e,t){e.appearance.material.uniforms.color.alpha=t}setTilesetColor(e,t){e.content&&e.content._model&&(e.color=t?new Cesium.Color(t.red,t.green,t.blue,t.alpha):Cesium.Color.WHITE)}setTilesetModelColor(e,t){e.content&&e.content._model&&(e.content._model.color=t?new Cesium.Color(t.red,t.green,t.blue,t.alpha):Cesium.Color.WHITE)}};var q=class{constructor(){this._lastFeature=null}isThisType(e){return e.primitive instanceof agcim.layer.AgS3MTilesLayer||e.primitive instanceof SuperMap3D.S3MTilesLayer}highlight(e,t,i){(this._lastFeature=e).primitive._selectedColor=i,e.primitive.setSelection(e.id)}remove(e,t){this._lastFeature&&this._lastFeature.primitive.releaseSelection()}},n=__webpack_require__(1133);var K=class{constructor(){this.cur3MTile={feature:null,originalColor:null},this.highLightedTilesets=[]}isThisType(e){return e instanceof Cesium.Cesium3DTileFeature}highlight(e,t,i,r){Cesium.defined(r)&&e.hasProperty(r)?this.highlightFeatures(e,r,i):this.highlightFeature(e,i)}highlightFeature(e,t=Cesium.Color.fromCssColorString("#40a9ff91")){var i=this.cur3MTile;if(e!==i.feature){null!=i.feature&&(i.feature.color=i.originalColor);try{var r=t;i.originalColor=Cesium.Color.clone(e.color),(i.feature=e).color=Cesium.Color.clone(r,e.color)}catch(e){}}}highlightFeatures(e,t="OBJECTID",i='color("#40a9ff91")'){e instanceof Cesium.Cesium3DTileFeature&&e.hasProperty(t)&&(i instanceof Cesium.Color&&(i=`color('${i.toCssHexString()}')`),this.highLightedTilesets.forEach(e=>{e.style=new Cesium.Cesium3DTileStyle}),t=["${"+t+"}=== '"+e.getProperty(t)+"'",i],e.content.tileset.style=new Cesium.Cesium3DTileStyle,e.content.tileset.style.color={conditions:[t]},this.highLightedTilesets.push(e.content.tileset))}remove(){if(this.cur3MTile.feature){if(this.cur3MTile.feature.tileset.isDestroyed())return;this.cur3MTile.feature.color=this.cur3MTile.originalColor,this.cur3MTile={feature:null,originalColor:null}}this.highLightedTilesets.forEach(e=>{e.style=new Cesium.Cesium3DTileStyle})}};var j=class{constructor(){this._lastFeature=null,this._lastFeatureApperance=null}isThisType(e){e=e.primitive;return!!e&&!!e.appearance}highlight(e,t,i=Cesium.Color.RED){this._lastFeature=e,this._lastFeatureApperance=e.primitive.appearance;var r=e.primitive.appearance,n=`vec4(${i.red},${i.green},${i.blue},${i.alpha})`;r instanceof Cesium.PerInstanceColorAppearance?(n=new Cesium.PerInstanceColorAppearance({translucent:r.translucent,flat:!1,fragmentShaderSource:`#define FACE_FORWARD
in vec3 v_positionEC;
in vec3 v_normalEC;
in vec4 v_color;

              void main()
{
vec3 positionToEyeEC = -v_positionEC;
vec3 normalEC = normalize(v_normalEC);

                  #ifdef FACE_FORWARD
normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);
#endif

                  vec4 color = czm_gammaCorrect(v_color);
czm_materialInput materialInput;
materialInput.normalEC = normalEC;

                  materialInput.positionToEyeEC = positionToEyeEC;
czm_material material = czm_getDefaultMaterial(materialInput);

                  material.diffuse = color.rgb;
material.alpha = color.a;
out_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC)+${n};
}
`}),e.primitive.appearance=n):r instanceof Cesium.MaterialAppearance&&(this._lastColor=e.primitive.appearance.material.uniforms.color,e.primitive.appearance.material.uniforms.color=Cesium.Color.fromAlpha(i,.3))}remove(e,t){this._lastFeature&&(this._lastFeature.primitive.appearance instanceof Cesium.MaterialAppearance?this._lastFeature.primitive.appearance.material.uniforms.color=this._lastColor:this._lastFeature.primitive.appearance=this._lastFeatureApperance)}};var Z=class extends class{constructor(){this._featureLayer=null,this._unrealBloomProcessStage=null}addBoxHighlight(e,t,i,r){e=new agcim.geometry.Polygon("房间",e,{material:r&&r.material?r.material:Cesium.Color.YELLOW.withAlpha(.4),heightReference:Cesium.HeightReference.NONE,perPositionHeight:!0,outline:!0,fill:!0,extrudedHeight:t,outlineColor:r.outlineColor||Cesium.Color.RED});this._featureLayer||(this._featureLayer=new n.Z(i)),e.addToLayer(this._featureLayer),null==this._unrealBloomProcessStage&&(this._unrealBloomProcessStage=i.scene.postProcessStages.add(new Cesium.UnrealBloomProcessStage)),this._unrealBloomProcessStage.addBloomObject(e.entity),r.outlineColor&&(this._unrealBloomProcessStage.luminosityColor=r.outlineColor)}addLineHighlight(e,t,i){this._featureLayer||(this._featureLayer=new n.Z(t)),this._featureLayer.addEntity({polyline:{positions:e,width:10,material:new Cesium.PolylineGlowMaterialProperty({color:Cesium.Color.DEEPSKYBLUE,glowPower:.25})}})}remove(e){this._featureLayer&&(this._featureLayer.removeAll(!0),this._featureLayer.dispose(),this._featureLayer=null,e.scene.postProcessStages=[])}}{constructor(){super(),this.curEntity=null,this.cur3MTile={feature:null,originalColor:null},this._subItems=[new q,new j,new K]}add(e,t,i,r){if(Cesium.defined(e)){e.primitive instanceof Cesium.Model?this.highlight3D(e.primitive):e.id&&this.highlight2D(e,i);for(var n=0;n<this._subItems.length;n++){var o=this._subItems[n];if(o.isThisType(e))return void o.highlight(e,t,i,r)}}else this.remove(t)}highlight3D(e,t=Cesium.Color.fromCssColorString("#40a9ff91")){var i=this.cur3MTile;if(e!==i.feature){null!=i.feature&&(i.feature.color=i.originalColor);try{var r=t;i.originalColor=Cesium.Color.clone(e.color),(i.feature=e).color=Cesium.Color.clone(r,e.color)}catch(e){}}}highlight2D(e,t){this.setEntity(e.id,t)}setEntity(i,r){var n=[{type:"scale",list:["billboard","point"]},{type:"fillColor",list:["label"]},{type:"material",list:["box","rectangle","corridor","cylinder","ellipse","ellipsoid","path","plane","polygon","polyline","polylineVolume","wall"]}];for(let t=0;t<n.length;t++){var o=n[t].list;for(let e=0;e<o.length;e++)if(i[o[e]]){if(this.curEntity==i[o[e]])return;null!=this.curEntity&&(this.curEntity.material=this.curEntity.material0,this.curEntity.scale=this.curEntity.scale0,this.curEntity.fillColor=this.curEntity.fillColor0);var s=i[o[e]];return void this[n[t].type](s,r)}}}material(e,t=Cesium.Color.YELLOW){t instanceof Cesium.Color&&(e.material0=e.material,e.material=t,this.curEntity=e)}scale(e,t=1.5){t instanceof Number&&(e.scale0=e.scale,e.scale=t,this.curEntity=e)}fillColor(e,t=Cesium.Color.YELLOW){t instanceof Cesium.Color&&(e.fillColor0=e.fillColor,e.fillColor=t,this.curEntity=e)}remove(e){super.remove(e),this.cur3MTile.feature&&(this.cur3MTile.feature.color=this.cur3MTile.originalColor,this.cur3MTile={feature:null,originalColor:null}),this.curEntity&&(this.curEntity.material=this.curEntity.material0,this.curEntity.scale=this.curEntity.scale0,this.curEntity.fillColor=this.curEntity.fillColor0,this.curEntity=null);for(var t=0;t<this._subItems.length;t++)this._subItems[t].remove(e,this)}};var t=class{initialize(){function e(e,t,i){if(s=e,this.param=i,e=this._initCameraParam(),this.optionType={Color:1,Image:2,Video:3},this.near=e.near||.1,e=e||{},this.viewer=t,this._cameraPosition=e.cameraPosition,this._cameraEndPosition=e.cameraEndPosition,this._position=e.position,this.type=e.type,this._alpha=e.alpha||1,this.url=e.url,this.color=e.color,this._debugFrustum=s.defaultValue(e.debugFrustum,!0),this._aspectRatio=e.aspectRatio||this._getWinWidHei(),this._camerafov=e.fov||s.Math.toDegrees(this.viewer.scene.camera.frustum.fov),this.texture=e.texture||new s.Texture({context:this.viewer.scene.context,source:{width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])},flipY:!1}),this._videoPlay=s.defaultValue(e.videoPlay,!0),this.defaultShow=s.defaultValue(e.show,!0),this.cameraPosition&&this.position){switch(this.type){default:case this.optionType.Video:this.activeVideo(this.url);break;case this.optionType.Image:this.activePicture(this.url),this.deActiveVideo();break;case this.optionType.Color:this.activeColor(this.color),this.deActiveVideo()}this._createShadowMap(),this._getOrientation(),this._addCameraFrustum(),this._addPostProcess(),this.viewer.scene.primitives.add(this)}else console.log("初始化失败：请确认相机位置与视点位置正确!")}var s=null;return Object.defineProperties(e.prototype,{alpha:{get:function(){return this._alpha},set:function(e){return this._alpha=e}},aspectRatio:{get:function(){return this._aspectRatio},set:function(e){this._aspectRatio=e,this._changeVideoWidHei()}},debugFrustum:{get:function(){return this._debugFrustum},set:function(e){this._debugFrustum=e,this.cameraFrustum.show=e}},fov:{get:function(){return this._camerafov},set:function(e){this._camerafov=e,this._changeCameraFov()}},cameraPosition:{get:function(){return this._cameraPosition},set:function(e){e&&(this._cameraPosition=e,this._changeCameraPos())}},cameraEndPosition:{get:function(){return this._cameraEndPosition},set:function(e){e&&(this._cameraEndPosition=e,this._changeCameraPos())}},position:{get:function(){return this._position},set:function(e){e&&(this._position=e,this._changeViewPos())}},videoPlay:{get:function(){return this._videoPlay},set:function(e){this._videoPlay=Boolean(e),this._videoEle&&(this.videoPlay?this._videoEle.paly():this._videoEle.pause())}},params:{get:function(){var e={};return e.type=this.type,this.type==this.optionType.Color?e.color=this.color:e.url=this.url,e.position=this.position,e.cameraPosition=this.cameraPosition,e.fov=this.fov,e.aspectRatio=this.aspectRatio,e.alpha=this.alpha,e.debugFrustum=this.debugFrustum,e}},show:{get:function(){return this.defaultShow},set:function(e){this.defaultShow=Boolean(e),this._switchShow()}}}),e.prototype._initCameraParam=function(){var e=function(e,t){t=t.scene.globe.ellipsoid.cartesianToCartographic(e);return{latitude:s.Math.toDegrees(t.latitude),longitude:s.Math.toDegrees(t.longitude),altitude:t.height}}(this.param.position,CIM.viewer),e=s.Cartesian3.fromDegrees(e.longitude,e.latitude,e.altitude),t=s.Cartesian3.fromDegrees(+this.param.position.x,+this.param.position.y,+this.param.position.z),i=s.Cartesian3.fromDegrees(+this.param.endPosition.x,+this.param.endPosition.y,+this.param.endPosition.z);return{type:3,url:this.param.url,cameraPosition:t,cameraEndPosition:i,position:e,alpha:this.param.alpha,near:this.param.near,fov:this.param.fov,debugFrustum:this.param.debugFrustum}},e.prototype._clearShadowMap=function(){this.viewer.scene.postProcessStages.remove(this.postProcess),this.viewer.scene.primitives.remove(this.cameraFrustum),this._createShadowMap(this.cameraPosition,this.position)},e.prototype._getWinWidHei=function(){var e=this.viewer.scene;return e.canvas.clientWidth/e.canvas.clientHeight},e.prototype._changeCameraFov=function(){this.viewer.scene.postProcessStages.remove(this.postProcess),this.viewer.scene.primitives.remove(this.cameraFrustum),this._createShadowMap(this.cameraPosition,this.position),this._getOrientation(),this._addPostProcess()},e.prototype._changeVideoWidHei=function(){this.viewer.scene.postProcessStages.remove(this.postProcess),this.viewer.scene.primitives.remove(this.cameraFrustum),this._createShadowMap(this.cameraPosition,this.position),this._getOrientation(),this._addPostProcess()},e.prototype._changeCameraPos=function(){this.viewer.scene.postProcessStages.remove(this.postProcess),this.viewer.scene.primitives.remove(this.cameraFrustum),this.viewShadowMap.destroy(),this.cameraFrustum.destroy(),this._createShadowMap(this.cameraPosition,this.position),this._getOrientation(),this._addPostProcess()},e.prototype._changeViewPos=function(){this.viewer.scene.postProcessStages.remove(this.postProcess),this.viewer.scene.primitives.remove(this.cameraFrustum),this.viewShadowMap.destroy(),this.cameraFrustum.destroy(),this._createShadowMap(this.cameraPosition,this.position),this._getOrientation(),this._addPostProcess()},e.prototype._switchShow=function(){this.show?this.postProcess||this._addPostProcess():(this.viewer.scene.postProcessStages.remove(this.postProcess),delete this.postProcess,this.postProcess=null),this.cameraFrustum.show=this.show},e.prototype._createVideoEle=function(e){this.videoId="visualDomId";var t=document.createElement("SOURCE"),i=(t.type="video/mp4",t.src=e,document.createElement("SOURCE")),e=(i.type="video/quicktime",i.src=e,document.createElement("VIDEO"));return e.setAttribute("autoplay",!0),e.setAttribute("loop",!0),e.setAttribute("crossorigin",!0),e.appendChild(t),e.appendChild(i),this._videoEle=e},e.prototype.activeVideo=function(e){var t,i=this._createVideoEle(e),r=this;i&&(this.type=r.optionType.Video,t=this.viewer,this.activeVideoListener||(this.activeVideoListener=function(){r.videoTexture&&r.videoTexture.destroy(),r.videoTexture=new s.Texture({context:t.scene.context,source:i,width:1,height:1,pixelFormat:s.PixelFormat.RGBA,pixelDatatype:s.PixelDatatype.UNSIGNED_BYTE})}),t.clock.onTick.addEventListener(this.activeVideoListener))},e.prototype.deActiveVideo=function(){this.activeVideoListener&&(this.viewer.clock.onTick.removeEventListener(this.activeVideoListener),delete this.activeVideoListener)},e.prototype.activePicture=function(e){this.videoTexture=this.texture;var t=this,i=new Image;i.onload=function(){t.type=t.optionType.Image,t.videoTexture=new s.Texture({context:t.viewer.scene.context,source:i})},i.onerror=function(){console.log("图片加载失败:"+e)},i.src=e},e.prototype.locate=function(){var e=s.clone(this.cameraPosition);s.clone(this.position);this.viewer.Camera.position=e,this.viewer.Camera.setView({orientation:this.param.orientation})},e.prototype.update=function(e){this.viewShadowMap&&this.viewer.scene.frameState.shadowMaps.push(this.viewShadowMap)},e.prototype.destroy=function(){this.viewer.scene.postProcessStages.remove(this.postProcess),this.viewer.scene.primitives.remove(this.cameraFrustum),this.activeVideoListener&&this.viewer.clock.onTick.removeEventListener(this.activeVideoListener),this.activeVideoListener&&delete this.activeVideoListener,delete this.postProcess,delete this.viewShadowMap,delete this.color,delete this.viewDis,delete this.cameraPosition,delete this.position,delete this.alpha,delete this._camerafov,delete this._cameraPosition,delete this._cameraEndPosition,delete this.videoTexture,delete this.cameraFrustum,delete this._videoEle,delete this._debugFrustum,delete this._position,delete this._aspectRatio,delete this.url,delete this.orientation,delete this.texture,delete this.videoId,delete this.type,this.viewer.scene.primitives.remove(this),delete this.viewer},e.prototype._createShadowMap=function(){var e=this.cameraPosition,t=this.cameraEndPosition,i=this.position,r=this.viewer.scene,n=new s.Camera(r),t=(n.position=e,n.setView({orientation:this.param.orientation}),e.x==t.x&&e.y==t.y?n.direction=s.Cartesian3.subtract(i,e,new s.Cartesian3(0,0,0)):n.direction=s.Cartesian3.normalize(s.Cartesian3.subtract(t,e,new s.Cartesian3),new s.Cartesian3),s.Cartesian3.distance(i,e));this.viewDis=t,n.frustum=new s.PerspectiveFrustum({fov:this.fov,aspectRatio:this.aspectRatio,near:this.near,far:t}),this.viewShadowMap=new s.ShadowMap({lightCamera:n,enable:!1,isPointLight:!1,isSpotLight:!0,cascadesEnabled:!1,context:r.context,pointLightRadius:t})},e.prototype._getOrientation=function(){var e=this.cameraPosition,t=this.position,t=s.Cartesian3.normalize(s.Cartesian3.subtract(t,e,new s.Cartesian3),new s.Cartesian3),i=(s.Cartesian3.normalize(e,new s.Cartesian3),new s.Camera(this.viewer.scene)),i=(i.setView({direction:t,orientation:this.param.orientation}),i.position=e,t=i.directionWC,e=i.upWC,i.rightWC),r=new s.Cartesian3,n=new s.Matrix3,o=new s.Quaternion,i=s.Cartesian3.negate(i,r),r=n,n=(s.Matrix3.setColumn(r,0,i,r),s.Matrix3.setColumn(r,1,e,r),s.Matrix3.setColumn(r,2,t,r),s.Quaternion.fromRotationMatrix(r,o));return this.orientation=n},e.prototype.creacteGeometry=function(e,t){var e=e/2,t=t/2,e=new Float64Array([e,0,t,-e,0,t,-e,0,-t,e,0,-t]),t=new Float32Array([1,1,0,1,0,0,1,0]),i=new Uint16Array([0,1,2,0,2,3]);return this._createGeometry(e,t,i)},e.prototype._createGeometry=function(e,t,i){return new s.Geometry({attributes:{position:new s.GeometryAttribute({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:e}),normal:new s.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:new Float32Array([255,0,0,255,0,0,255,0,0,255,0,0])}),st:new s.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:t})},indices:i,primitiveType:s.PrimitiveType.TRIANGLES,vertexFormat:new s.VertexFormat({position:!0,color:!0}),boundingSphere:s.BoundingSphere.fromVertices(e)})},e.prototype._addCameraFrustum=function(){this.cameraFrustum=new s.Primitive({geometryInstances:new s.GeometryInstance({geometry:new s.FrustumOutlineGeometry({origin:this.cameraPosition,orientation:this.orientation,frustum:this.viewShadowMap._lightCamera.frustum,_drawNearPlane:!0}),attributes:{color:s.ColorGeometryInstanceAttribute.fromColor(new s.Color(0,.5,.5))}}),appearance:new s.PerInstanceColorAppearance({translucent:!1,flat:!0}),asynchronous:!1,show:this.debugFrustum&&this.show})},e.prototype._addPostProcess=function(){var t=this,i=t.viewShadowMap._isPointLight?t.viewShadowMap._pointBias:t.viewShadowMap._primitiveBias;console.log(t.viewShadowMap),console.log(i),this.postProcess=new s.PostProcessStage({fragmentShader:`
        uniform float mixNum;
        uniform sampler2D colorTexture;
        uniform sampler2D stcshadow; 
        uniform sampler2D videoTexture;
        uniform sampler2D depthTexture;
        uniform mat4 _shadowMap_matrix; 
        uniform vec4 shadowMap_lightPositionEC; 
        uniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness;
        uniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth; 
        in vec2 v_textureCoordinates;
        vec4 toEye(in vec2 uv, in float depth){    
            vec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0));    
            vec4 posInCamera =czm_inverseProjection * vec4(xy, depth, 1.0);    
            posInCamera =posInCamera / posInCamera.w;   
            return posInCamera;
        }
        float getDepth(in vec4 depth){
                float z_window = czm_unpackDepth(depth);
                z_window = czm_reverseLogDepth(z_window);
                float n_range = czm_depthRange.near;
                float f_range = czm_depthRange.far;
                return (2.0 * z_window - n_range - f_range) / (f_range - n_range);
            }
            float _czm_sampleShadowMap(sampler2D shadowMap, vec2 uv){
                return texture(shadowMap, uv).r;
            }
            float _czm_shadowDepthCompare(sampler2D shadowMap, vec2 uv, float depth){    
                return step(depth, _czm_sampleShadowMap(shadowMap, uv));
            }
            float _czm_shadowVisibility(sampler2D shadowMap, czm_shadowParameters shadowParameters){
                float depthBias = shadowParameters.depthBias;    
                float depth = shadowParameters.depth;    
                float nDotL = shadowParameters.nDotL;    
                float normalShadingSmooth = shadowParameters.normalShadingSmooth;    
                float darkness = shadowParameters.darkness;    
                vec2 uv = shadowParameters.texCoords;    
                depth -= depthBias;    
                vec2 texelStepSize = shadowParameters.texelStepSize;    
                float radius = 1.0;   
                float dx0 = -texelStepSize.x * radius;
                float dy0 = -texelStepSize.y * radius;
                float dx1 = texelStepSize.x * radius;    
                float dy1 = texelStepSize.y * radius;   
                float visibility =(    
                    _czm_shadowDepthCompare(shadowMap, uv, depth)    
                    + _czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy0), depth) 
                    + _czm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy0), depth) 
                    + _czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy0), depth) 
                    + _czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, 0.0), depth) 
                    + _czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, 0.0), depth) 
                    + _czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy1), depth) 
                    + _czm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy1), depth) 
                    + _czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy1), depth)   
                ) * (1.0 / 9.0);
                return visibility;
            }
            vec3 pointProjectOnPlane(in vec3 planeNormal, in vec3 planeOrigin, in vec3 point){
                vec3 v01 = point -planeOrigin;
                float d = dot(planeNormal, v01) ;
                return (point - planeNormal * d);
            }
            float ptm(vec3 pt){
                return sqrt(pt.x*pt.x + pt.y*pt.y + pt.z*pt.z);
            }
            void main() { 
                const float PI = 3.141592653589793;    
                vec4 color = texture(colorTexture, v_textureCoordinates);
                vec4 currD = texture(depthTexture, v_textureCoordinates);   
                if(currD.r>=1.0){        
                    out_FragColor = color;       
                    return;    
                }
                float depth = getDepth(currD);
                vec4 positionEC = toEye(v_textureCoordinates, depth);
                vec3 normalEC = vec3(1.0);
                czm_shadowParameters shadowParameters;
                shadowParameters.texelStepSize = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy;
                shadowParameters.depthBias = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z;
                shadowParameters.normalShadingSmooth = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w;
                shadowParameters.darkness = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w;
                shadowParameters.depthBias *= max(depth * 0.01, 1.0);
                vec3 directionEC = normalize(positionEC.xyz - shadowMap_lightPositionEC.xyz);
                float nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0);
                vec4 shadowPosition = _shadowMap_matrix * positionEC;
                shadowPosition /= shadowPosition.w; 
                if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0))))  { 
                    out_FragColor = color;
                    return;
                }
                shadowParameters.texCoords = shadowPosition.xy;
                shadowParameters.depth = shadowPosition.z;
                shadowParameters.nDotL = nDotL;
                float visibility = _czm_shadowVisibility(stcshadow, shadowParameters);
                vec4 videoColor = texture(videoTexture,shadowPosition.xy);
                if(visibility==1.0){
                    out_FragColor = mix(color,vec4(videoColor.xyz,1.0),mixNum*videoColor.a);
                }else{
                    out_FragColor=color;
                }
            } `,uniforms:{mixNum:function(){return 1},stcshadow:function(){return t.viewShadowMap._shadowMapTexture},videoTexture:function(){return t.videoTexture},_shadowMap_matrix:function(){return t.viewShadowMap._shadowMapMatrix},shadowMap_lightPositionEC:function(){return t.viewShadowMap._lightPositionEC},shadowMap_texelSizeDepthBiasAndNormalShadingSmooth:function(){var e=new s.Cartesian2;return e.x=1/t.viewShadowMap._textureSize.x,e.y=1/t.viewShadowMap._textureSize.y,s.Cartesian4.fromElements(e.x,e.y,i.depthBias,i.normalShadingSmooth,this.combinedUniforms1)},shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness:function(){return s.Cartesian4.fromElements(i.normalOffsetScale,t.viewShadowMap._distance,t.viewShadowMap.maximumDistance,t.viewShadowMap._darkness,this.combinedUniforms2)}}}),this.viewer.scene.postProcessStages.add(this.postProcess)},e}};var Y=class{constructor(e){this.style=new Cesium.Cesium3DTileStyle,this.tileset=e}addShowCondition(e){var t=[],e=(t.push([e,!0]),this._getRestCondition("show",e,this.tileset));e.length<=0&&e.push([!0,!0]),t=t.concat(e),this.setShowStyle(t)}addHideCondition(e){var t=[],e=(t.push([e,!1]),this._getRestCondition("show",e,this.tileset));e.length<=0&&e.push([!0,!0]),t=t.concat(e),this.setShowStyle(t)}addShowByKeyValue(e,t,i){var r=null,r="number"==typeof t?"${"+e+"}==="+t:"${"+e+"}==='"+t+"'";i?this.addShowCondition(r):this.addHideCondition(r)}resetVisible(e){var t=[];t.push([!0,e]),this.setShowStyle(t)}setShowStyle(e){this.style=new Cesium.Cesium3DTileStyle,this.tileset.style?this.style.color=this.tileset.style.color:this.style.color=void 0,this.style.show={conditions:e},this.tileset.style=this.style}addColorStyle(e,t,i=1){var r=[],t=(r.push([e,`color('${t}',${i})`]),this._getRestCondition("color",e,this.tileset));t.length<=0&&t.push([!0,"color('WHITE')"]),r=r.concat(t),this.setColorStyle(r)}addColorStyleByKeyValue(e,t,i){var r=null,r="number"==typeof t?"${"+e+"}==="+t:"${"+e+"}==='"+t+"'";this.addColorStyle(r,i)}removeColorCondition(e){var t=[],e=this._getRestCondition("color",e);e.length<=0&&e.push([!0,"color('WHITE')"]),t=t.concat(e),this.setColorStyle(t)}resetColorStyle(e="WHITE",t=1){var i=[];i.push([!0,`color('${e}',${t})`]),this.setColorStyle(i)}setColorStyle(e){this.style=new Cesium.Cesium3DTileStyle,this.tileset.style?this.style.show=this.tileset.style.show:this.style.show=void 0,this.style.color={conditions:e},this.tileset.style=this.style}setOpacityByFloor(e,t,i){var r=[],t="${"+t+"}==='"+i+"'",i=(r.push([t,`color('WHITE',${e})`]),this._getRestCondition("color",t,this.tileset));i.length<=0&&i.push([!0,"color('WHITE')"]),r=r.concat(i),this.setColorStyle(r)}setOpacity(t){this.style=new Cesium.Cesium3DTileStyle,this.tileset.style?this.style.show=this.tileset.style.show:this.style.show=void 0;var i=[];if(this.tileset.style)if(this.tileset.style.color&&this.tileset.style.color._conditions){var r=this.tileset.style.color._conditions;for(let e=0;e<r.length;e++){var n=this._parseColor(r[e][1]);i.push([r[e][0],`color(${n},${t})`])}}else this.tileset.style.color&&this.tileset.style.color._expression?(n=this._parseColor(this.tileset.style.color._expression),i.push([!0,`color(${n},${t})`])):i.push([!0,`color('WHITE',${t})`]);else i.push([!0,`color('WHITE',${t})`]);this.style.color={conditions:i},this.tileset.style=this.style}_parseColor(e){var t=e.indexOf("("),i=e.indexOf(","),r=e.indexOf(")");return 0<i?e.substr(t+1,i-t-1):e.substr(t+1,r-t-1)}_getRestCondition(e,t){var i=null;if(!this.tileset.style)return[];if("color"==e?i=this.tileset.style.color:"show"==e&&(i=this.tileset.style.show),!i)return[];var r=-1,e=[];if(i._conditions){var n=i._conditions;for(let e=0;e<n.length;e++)n[e][0]==t&&(r=e);0<=r&&n.splice(r,1),e=e.concat(n)}else i._expression&&e.push([!0,i._expression]);return e}},X=__webpack_require__(2175);var J,$,ee,te,i=class{constructor(e){this.samples=e||[{.2:"rgba(35,164,235,1)",.3:"rgba(28,235,168,1)",.4:"rgba(15,255,0,1)",.6:"rgba(255,255,0,1)",.8:"rgba(255,126,0,1)",.95:"rgba(255,73,0,1)",1:"rgba(243,55,17,1)"}],this._imageData=null}buildFromSample(e){var t,i=document.createElement("canvas").getContext("2d"),r=i.createLinearGradient(0,0,256,1),n=this.samples[e];for(t in n)r.addColorStop(t,n[t]);i.fillStyle=r,i.fillRect(0,0,256,1),this._imageData=i.getImageData(0,0,256,1).data}getColor(e,t){var i=parseInt(255*e*4),r=this._imageData[i+3];return[this._imageData[i],this._imageData[i+1],this._imageData[i+2],r=t?e:r]}};function ie(e,t,i,h,A,p){var r,n,o,{Pass:s,defined:a,PerspectiveFrustum:l,PerspectiveOffCenterFrustum:u,OrthographicFrustum:c,OrthographicOffCenterFrustum:f}=Cesium,d=(J=J||new l,$=$||new u,ee=ee||new c,te=te||new f,e._us),l=d._frameState.camera,g=l._scene,m=g._view.frustumCommandsList,y=m.length,_=g._globeTranslucencyState,v=_.translucent;function C(e,t,i,r){var n,o,s,a,l,u,c;p&&!p(e,t)||(h&&A?(n=e,o=h,s=A,a=t,l=i,u=r,c=Cesium.defined,a=t._frameState,t=n.derivedCommands,c(t)&&(a.useLogDepth&&c(t.logDepth)&&(n=t.logDepth.command),c((t=n.derivedCommands)[o]))&&(n=t[o][s]).execute(l,u)):e.execute(i,r))}for(var w=a(l.frustum.fov)?l.frustum.clone(J):a(l.frustum.infiniteProjectionMatrix)?l.frustum.clone($):a(l.frustum.width)?l.frustum.clone(ee):l.frustum.clone(te),x=0;x<y;++x){var b=y-x-1,E=m[b],B=i.framebuffer;if(i.framebuffer=t,w.near=0!=b?E.near*g.opaqueFrustumNearOffset:E.near,w.far=E.far,d.updateFrustum(w),d.updatePass(s.GLOBE),o=E.commands[s.GLOBE],n=E.indices[s.GLOBE],v)_.executeGlobeCommands(E,C,globeTranslucencyFramebuffer,g,i);else for(r=0;r<n;++r)C(o[r],g,e,i);for(d.updatePass(s.CESIUM_3D_TILE),o=E.commands[s.CESIUM_3D_TILE],n=E.indices[s.CESIUM_3D_TILE],r=0;r<n;++r)C(o[r],g,e,i);for(d.updatePass(s.OPAQUE),o=E.commands[s.OPAQUE],n=E.indices[s.OPAQUE],r=0;r<n;++r)C(o[r],g,e,i);for(d.updatePass(s.TRANSLUCENT),o=E.commands[s.TRANSLUCENT],n=E.indices[s.TRANSLUCENT],r=0;r<n;++r)C(o[r],g,e,i);i.framebuffer=B}}const re=`
vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}

vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}

const float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)
const float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)

const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );

const float ShiftRight8 = 1. / 256.;

vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8; // tidy overflow
	return r * PackUpscale;
}

float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}

vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}

// NOTE: viewZ/eyeZ is < 0 when in front of the camera per OpenGL conventions

float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}

// NOTE: https://twitter.com/gonnavis/status/1377183786949959682

float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}
`,ne="uniform sampler2D czm_selectedIdTexture; \nuniform float czm_selectedIdTextureStep; \nuniform float czm_selectedIdTextureWidth; \nbool czm_selected(vec4 id) \n{ \n    bool selected = false;\n    for (int i = 0; i < 1024000; i++) \n    { \n        vec4 selectedId = texture(czm_selectedIdTexture, vec2((float(i) + 0.5) * czm_selectedIdTextureStep, 0.5)); \n        if (all(equal(id, selectedId))) \n        { \n            return true; \n        } \n       if(float(i)>czm_selectedIdTextureWidth)break;\n    } \n    return false; \n} \n\n";function oe(e){const{defaultValue:n,BoundingRectangle:t,Pass:R,Sampler:o,DrawCommand:U,Color:h,ShaderSource:_,defined:v,ClearCommand:k,RenderState:A,Texture:p,PixelDatatype:s,PixelFormat:a,Framebuffer:H}=Cesium;this._selectedIdTexture=null;let{name:Q,vertexShader:C,fragmentShader:w,uniforms:f,renderStateProcess:d,beforeUpdate:g,renderType:m,textureScale:i,pixelFormat:V,pixelDatatype:G,sampler:z,viewportScale:r,shaderRedefine:x,overrideViewport:l}=e,b="renderPass_"+Q.replace(/[\.\\\/\-]/g,"_"),E=`czm_non_${b}_main`,B=`czm_${b}_main`,y="_cache_"+b,M=b+"Command",I=null,u=null,c=null,S=null,P,T=new k({color:h.TRANSPARENT,depth:1}),L=new t,D=this;if(l&&t.clone(l,L),x=x||"add",m=m||"all",(i=i||1)<0||8<i)throw new Cesium.DeveloperError("CesiumRenderPass：textureScale必须大于0小于等于8");function W(e,t,i,r){var n=e.shaderCache.getDerivedShaderProgram(t,b);if(!v(n)){var o=t._attributeLocations,s=t.fragmentShaderSource,a=t.vertexShaderSource,l=t._vertexShaderText,u=(y=s.sources).length,c=!!S&&function(){if(S){var e=S.selected||S.parentSelected;if(e.length)return e}}(),h=ne,A=/texture2D\s?\(\s?tile_pickTexture\s?,\s?tile_featureSt\s?\)/.test(i),i=(h+="in"!=r||A?`
bool czm_selected(){ 
    return czm_selected(${i}); 
}`:`
in float me_isSelected;
bool czm_selected(){
    bool isSelected= me_isSelected>0.0000001;
    if(!isSelected){
        isSelected= czm_selected(${i});
    }
    return isSelected;
}
    `,ne+`
out float me_isSelected;
bool czm_selected(){
    return czm_selected(${i});
}
`),p=!1,f=!1;if(/in\s?vec3\s?normal\s?;/.test(l)||/\n\s?vec3\s?normal\s?;/.test(l)?p=!0:/out\s?vec3\s?v_normal\s?;/.test(l)&&(f=!0),w){var d=!1;for(m=0;m<u;++m)if(/vec4\s?packDepthToRGBA\s?\(/.test(y[m])){d=!0;break}for(var l=(d?"":re)+(c?h:"")+_.replaceMain(w,B)+"void main() \n{ \n"+("replace"!=x?`    ${E}(); 
`:"")+`    ${B}(); 
`+"} \n",g=new Array(u+1),m=0;m<u;++m)g[m]=_.replaceMain(y[m],E);g[u]=l,p?s.defines.push("HAS_NORMAL"):f&&s.defines.push("HAS_V_NORMAL"),s=new _({sources:g,defines:s.defines})}if(C||w){var y,u=(y=a.sources).length,d=!1;for(m=0;m<u;++m)if(/vec4\s?packDepthToRGBA\s?\(/.test(y[m])){d=!0;break}c=c&&"out"==r&&!A,p?a.defines.push("HAS_NORMAL"):f&&a.defines.push("HAS_V_NORMAL");for(h=(d?"":re)+(c?i:"")+_.replaceMain(C||"void main(){}",B)+"void main() \n{ \n"+("replace"!=x?`    ${E}(); 
`:"")+(c?"    me_isSelected=czm_selected()?1.:0.;\n":"")+`    ${B}(); 
`+"} \n",g=new Array(u+1),m=0;m<u;++m)g[m]=_.replaceMain(y[m],E);g[u]=h,a=new _({sources:g,defines:a.defines})}n=e.shaderCache.createDerivedShaderProgram(t,b,{vertexShaderSource:a,fragmentShaderSource:s,attributeLocations:o})}return n}function q(t,i,r){var n,o,s=t,a=i._frameState,l=t.derivedCommands;if(v(l)){let e=(l=(t=a.useLogDepth&&v(l.logDepth)?l.logDepth.command:t).derivedCommands).renderPass;v(l.renderPass)||(e=l.renderPass={}),v(e[M])&&(n=e[M].shaderProgram,o=e[M].renderState),e[M]=U.shallowClone(t,e[M]),v(n)&&e.shaderProgramId===t.shaderProgram.id?(e[M].shaderProgram=n,e[M].renderState=o):(a=t.shaderProgram,l=s._pickIdQualifier=new RegExp("uniform\\s?vec4\\s?"+t.pickId,"g").test(a._fragmentShaderText)?"uniform":"in",e[M].shaderProgram=W(r,a,t.pickId,l),e[M].renderState=(n=i,o=t.renderState,n._renderPassCache=n._renderPassCache||{},n._renderPassCache[y]=n._renderPassCache[y]||{},s=(n=n._renderPassCache[y])[o.id],v(s)||(r=A.getState(o),"function"==typeof d&&d.call(D,r),s=A.fromCache(r),n[o.id]=s),s),e.shaderProgramId=t.shaderProgram.id);var u,c=e[M].uniformMap;if(!c.__created&&(c.czm_selectedIdTexture=function(){return S._selectedIdTexture},c.czm_selectedIdTextureWidth=function(){return S._selectedIdTexture?S._selectedIdTexture.width:0},c.czm_selectedIdTextureStep=function(){return S._selectedIdTexture?1/S._selectedIdTexture.width:-1},f))for(var h in c.__created=!0,f)f.hasOwnProperty(h)&&("function"!=typeof f[h]?c[h]=function(t){return function(){var e=f[t];return"function"==typeof e?e():e}}(h):c[h]=f[h],"string"==typeof(u=c[h]())||u instanceof p||u instanceof HTMLImageElement||u instanceof HTMLCanvasElement||u instanceof HTMLVideoElement)&&(c[h+"Dimensions"]=function(t,i){return function(){var e=t[i]();if(v(e))return e.dimensions}}(c,h))}}function F(e,t,i){var r=t.width,t=t.height;u&&u.width===r&&u.height===t&&i===P||(P=i,u&&(u.destroy(),I.destroy(),I=void 0,u=void 0),c&&(c.destroy(),c=void 0),u=new p({context:e,width:r,height:t,pixelFormat:n(V,a.RGBA),pixelDatatype:n(G,s.FLOAT),sampler:n(z,o.NEAREST)}),c=new p({context:e,width:r,height:t,pixelFormat:a.DEPTH_COMPONENT,pixelDatatype:s.UNSIGNED_SHORT,sampler:o.NEAREST}),I=new H({colorTextures:[u],context:e,destroyAttachments:!1,depthTexture:c}))}function N(e){l||(L=t.clone(e.viewport,L),r?(L.x=L.width*r.x,L.y=L.height*r.y,L.width*=r.width,L.height*=r.height):(L.width*=i,L.height*=i));e=Object.assign({},e.passState);return e.viewport=L,e}function O(e,t){var i=e._us._frameState.camera._scene,r=i._view;try{if(C||w){for(var n,o=N(r),s=("function"==typeof g&&g.call(D,i,t),F(e,L,i.hdr,r.sceneFramebuffer),i),a=s._view.frustumCommandsList,l=a.length,u=0;u<l;++u)for(var c=a[l-u-1],h=0;h<c.commands.length;h++){var A=c.commands[h],p=c.indices[h];if(!S||h!=R.GLOBE)for(n=0;n<p;++n)q(A[n],s,s._context)}ie(e,I,o,"renderPass",M,"all"!=m&&S&&S._selectedIdTexture?K:null)}else{var f=N(r);"function"==typeof g&&g.call(D,i,t),F(e,L,i.hdr,r.sceneFramebuffer),ie(e,I,f)}}catch(e){console.error(e)}}function K(e,t){var i=S&&(S.selected||S.parentSelected);if(!S||!i||!i.length)return!1;if(!e.pickId||"uniform"!=e._pickIdQualifier)return!0;let r=!0,n=e.owner;var o="selected"==m;if(n&&n.isObject3D){for(let e=0;e<i.length;e++)if(i[e]==n)return o;return!o}var s=e.uniformMap;if(s[e.pickId]){var a=s[e.pickId]();r=!o;for(let e=0;e<i.length;e++){var l=i[e],u=l.pickId?[l.pickId]:l.pickIds||l._pickIds;for(let e=0;e<u.length;e++){var c=u[e];if(c.color==a||h.equals(c.color,a))return o}}}return r}function j(e){var t;I&&(t=e._us._frameState.camera._scene._view,T.framebuffer=I,T.execute(e,t.passState),T.framebuffer=void 0)}this.update=O,this.clear=j,Object.defineProperties(this,{texture:{get(){return u}},depthTexture:{get(){return c}},stage:{get(){return S},set(e){if(S!=e)if(S&&D.prevStageUpdate&&(S.update=D.prevStageUpdate,D.prevStageUpdate=null,D.prevStageExecute=null),S=e){let r=S.update;D.prevStageUpdate=r,S.update=function(e,t){var i;j(e),r.call(S,e,t),S.enabled&&(!C&&!w||(i=S.selected||S.parentSelected)&&i.length)&&O(e,t)}}}}})}const se="\nin vec2 v_textureCoordinates;\nuniform sampler2D colorTexture;\nuniform vec2 colorTextureDimensions;\nuniform vec2 direction;\nuniform float kernelRadius;\n\nfloat gaussianPdf(in float x, in float sigma) {\n    return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n}\nvoid main() {    vec2 vUv=v_textureCoordinates;\n    vec2 invSize = 1.0 / colorTextureDimensions;    float weightSum = gaussianPdf(0.0, kernelRadius);    vec4 diffuseSum = texture( colorTexture, vUv) * weightSum;    vec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);    vec2 uvOffset = delta;    for( int i = 1; i <= MAX_RADIUS; i ++ ) {        float w = gaussianPdf(uvOffset.x, kernelRadius);        vec4 sample1 = texture( colorTexture, vUv + uvOffset);        vec4 sample2 = texture( colorTexture, vUv - uvOffset);        diffuseSum += ((sample1 + sample2) * w);        weightSum += (2.0 * w);        uvOffset += delta;    }    out_FragColor = diffuseSum/weightSum;}";function ae(e,t,i,r){var n,{Cartesian2:o,PostProcessStage:s,PostProcessStageComposite:a,PostProcessStageSampleMode:l}=Cesium,u=new o(1,0),o=new o(0,1),t={defines:{MAX_RADIUS:t},fragmentShader:se};{var c=t;let e=[];for(const h in c.defines)c.defines.hasOwnProperty(h)&&(n=c.defines[h],e.push("#define "+h+" "+n));e=e.join("\n")+"\n",c.fragmentShader&&(c.fragmentShader=e+c.fragmentShader),c.vertexShader&&(c.vertexShader=e+c.vertexShader)}return new a({name:e,stages:[new s({name:e+"_x_direction",fragmentShader:t.fragmentShader,textureScale:r,forcePowerOfTwo:!0,uniforms:{kernelRadius:i,direction:u},sampleMode:l.LINEAR}),new s({name:e+"_y_direction",fragmentShader:t.fragmentShader,textureScale:r,forcePowerOfTwo:!0,uniforms:{kernelRadius:i,direction:o},sampleMode:l.LINEAR})],inputPreviousStageTexture:!0})}class le{constructor(e,t){var{visibleEdgeColor:t,hiddenEdgeColor:i}=t;this.viewer=e,this.stage=function(e){e=e||"OutlineEffect";var{PostProcessStage:t,PostProcessStageComposite:i,Sampler:r,TextureMagnificationFilter:n,TextureMinificationFilter:o}=Cesium;let s=2,a=12*Math.PI/180,l=!1,u=!1,c=Cesium.Color.WHITE.clone(),h=Cesium.Color.DARKRED.clone(),A=!1,p=1,f=3,d=!1,g=new oe({name:e+"Pass",vertexShader:`
        out vec3 vOutlineNormal;
        void main(){
            #ifdef HAS_NORMAL
                vOutlineNormal = normal;
            #else
                #ifdef HAS_V_NORMAL
                    vOutlineNormal = v_normal;
                #else
                    vOutlineNormal=vec3(0.);
                #endif
            #endif
        }
        `,fragmentShader:`
        in vec3 vOutlineNormal;
        void main(){
            if(!czm_selected())discard; 
            if(length(vOutlineNormal)>0.)out_FragColor=vec4( vOutlineNormal ,out_FragColor.a); 
        }
        `,sampler:new r({minificationFilter:o.LINEAR,magnificationFilter:n.LINEAR})});function m(e){Object.defineProperties(e,{showGlow:{get(){return A},set(e){A=e}},edgeGlow:{get(){return p},set(e){p=e}},edgeStrength:{get(){return f},set(e){f=e}},thresholdAngle:{get(){return a},set(e){a=e}},showOutlineOnly:{get(){return u},set(e){u=e}},edgeOnly:{get(){return d},set(e){d=e}},useSingleColor:{get(){return l},set(e){l=e}},outlineWidth:{get(){return s},set(e){s=e}},visibleEdgeColor:{get(){return c},set(e){c=e}},hiddenEdgeColor:{get(){return h},set(e){h=e}}})}return r=new t({name:e+"Mask",uniforms:{outlineWidth(){return s},devicePixelRatio:devicePixelRatio,thresholdAngle:function(){return a},useSingleColor:function(){return l},showOutlineOnly:function(){return u},visibleEdgeColor:function(){return c},hiddenEdgeColor:function(){return h},maskTexture(){return g.texture},maskDepthTexture(){return g.depthTexture}},fragmentShader:`
        uniform sampler2D colorTexture;
        uniform vec2 colorTextureDimensions;
        uniform sampler2D depthTexture;

        uniform sampler2D maskTexture;
        uniform sampler2D maskDepthTexture;
        uniform float thresholdAngle;
        uniform bool showOutlineOnly;
         
        uniform float outlineWidth;
        uniform float devicePixelRatio;
        uniform vec3 visibleEdgeColor;
        uniform vec3 hiddenEdgeColor;
        uniform bool useSingleColor;

        in vec2 v_textureCoordinates;
  
        float lengthSq(vec3 v){
            return v.x * v.x + v.y * v.y + v.z * v.z;
        }
        float normal_angleTo(vec3 a,vec3 b){
            float denominator =  sqrt(  lengthSq(a) * lengthSq(b) );
            if ( denominator == 0. ) return czm_pi / 2.;
            float theta = dot(a, b ) / denominator;
            // clamp, to handle numerical problems
            return  acos(  clamp( theta, - 1., 1. ) );
        }

        float compareNormal(vec4 n1,vec4 n2){
              if(  abs (  normal_angleTo( n1.xyz , n2.xyz ) ) < thresholdAngle ){
                  return 0.;
              }else{
                  return 1.;
              }
        }
 
        float compareDepth(const in vec2 uv){
            float maskDepth = czm_readDepth( maskDepthTexture, uv);
            float nonDepth = czm_readDepth( depthTexture, uv);
            return maskDepth>nonDepth?1.:0.;
        }

        void main(){

            vec2 vUv=v_textureCoordinates;

            // vec4 color = texture( colorTexture, vUv); 
            vec4 maskColor = texture( maskTexture, vUv);
             
            if( maskColor.a < 0.0001){
                // out_FragColor =color;
                discard;
                return;
            }

            vec2 invSize = outlineWidth / colorTextureDimensions;
            vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);
 
            vec4 c1 = texture( maskTexture, vUv + uvOffset.xy);
            vec4 c2 = texture( maskTexture, vUv - uvOffset.xy);
            vec4 c3 = texture( maskTexture, vUv + uvOffset.yw);
            vec4 c4 = texture( maskTexture, vUv - uvOffset.yw);
            
            float d;
            if(showOutlineOnly){
                float diff1 = (c1.a - c2.a)*0.5;
                float diff2 = (c3.a - c4.a)*0.5;
                d = length( vec2(diff1, diff2) );
            }
            else{ 
                float diff1 = compareNormal(c1,c2)*0.5;
                float diff2 = compareNormal(c3,c4)*0.5;
                d = length( vec2(diff1, diff2) );
            }
                    
            if(useSingleColor==false){
                float dp1 = compareDepth( vUv + uvOffset.xy);
                float dp2 = compareDepth( vUv - uvOffset.xy);
                float dp3 = compareDepth( vUv + uvOffset.yw);
                float dp4 = compareDepth( vUv - uvOffset.yw);
            
                float a1 = min(dp1, dp2);
                float a2 = min(dp3, dp4);
                float visibilityFactor = min(a1, a2);
                vec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;
            
                // out_FragColor =color+ vec4( edgeColor , 1. ) * vec4(d);
                out_FragColor = vec4( edgeColor , 1. ) * vec4(d);
            }else{
                // out_FragColor =color+ vec4( visibleEdgeColor , 1. ) * vec4(d);
                out_FragColor =  vec4( visibleEdgeColor , 1. ) * vec4(d);
            }
        }
        `}),g.stage=r,o=ae(e+"Blur1",4,1,.75),n=new i({name:e+"BlurComposite",stages:[r,o,ae(e+"Blur2",4,4,.5)],inputPreviousStageTexture:!0}),m(i=new i({name:e+"Composite",stages:[n,new t({name:e+"Additive",uniforms:{showGlow:function(){return A},edgeGlow:function(){return p},edgeStrength:function(){return f},edgeOnly(){return d},maskTexture(){return g.texture},lineTexture:r.name,edgeTexture1:o.name,edgeTexture2:n.name},fragmentShader:`
        uniform sampler2D colorTexture;
        uniform sampler2D edgeTexture1;
        uniform sampler2D edgeTexture2;
        uniform sampler2D lineTexture;
        uniform sampler2D maskTexture;
        uniform bool showGlow;
        uniform float edgeGlow;
        uniform bool edgeOnly;
        uniform float edgeStrength;

        in vec2 v_textureCoordinates;
        void main(){
            
            vec2 vUv =v_textureCoordinates;
            vec4 edgeColor=texture( lineTexture, vUv);
            vec4 color=texture( colorTexture, vUv);
            float opacity=1.;
            if(edgeOnly){
                vec4 maskColor=texture( maskTexture, vUv);
                opacity=1.-maskColor.a;
                out_FragColor = maskColor;
                return;
            }
  
            if(showGlow){
                float visFactor= czm_selected()?1.:0.;
                vec4 edgeValue1 = texture(edgeTexture1, vUv);
                vec4 edgeValue2 = texture(edgeTexture2, vUv);
                vec4 glowColor = edgeValue1 + edgeValue2 * edgeGlow;
                out_FragColor = opacity * color + edgeColor + edgeStrength * (1. - edgeColor.r) * glowColor;
            }
            else{
                out_FragColor = opacity * color + edgeColor;
            }
        }
        `})],inputPreviousStageTexture:!1})),i._uniforms=i._uniforms||{},m(i._uniforms),i}(Cesium.createGuid()),this.stage.visibleEdgeColor=t||Cesium.Color.fromCssColorString("green"),this.stage.hiddenEdgeColor=i||Cesium.Color.fromCssColorString("#4d4d4d"),this.stage.selected=[],this.stage.enabled=!1,this.viewer.postProcessStages.add(this.stage)}add(e){e&&e.primitive&&(e=this._dealWithPick(e)),this.stage.enabled=!0,this.isContains(e)||(Array.isArray(e)?this.stage.selected=e:this.stage.selected.push(e))}isContains(t){return-1<this.stage.selected.findIndex(e=>e.pickId.key===t.pickId.key)}_dealWithPick(i){if(i&&i.primitive){let e=i.primitive._pickIds,t=i.pickId;return t||e||!i.content||(e=i.content._model._pickIds),t||(i.id?e&&(t=e.find(e=>e.object==i)):e&&(t=e[0])),{pickId:t}}}remove(t){t&&t.primitive&&(t=this._dealWithPick(t));var e=this.stage.selected.findIndex(e=>e.pickId.key===t.pickId.key);this.stage.selected.splice(e,1)}removeAll(){this.stage.selected=[]}destroyed(){this.viewer.postProcessStages.remove(this.stage)}}Object.defineProperties(le.prototype,{showGlow:{get(){return this.stage.showGlow},set(e){this.stage.showGlow=e}},edgeGlow:{get(){return this.stage.edgeGlow},set(e){this.stage.edgeGlow=e}},edgeStrength:{get(){return this.stage.edgeStrength},set(e){this.stage.edgeStrength=e}},thresholdAngle:{get(){return this.stage.thresholdAngle},set(e){this.stage.thresholdAngle=e}},showOutlineOnly:{get(){return this.stage.showOutlineOnly},set(e){this.stage.showOutlineOnly=e}},edgeOnly:{get(){return this.stage.edgeOnly},set(e){this.stage.edgeOnly=e}},useSingleColor:{get(){return this.stage.useSingleColor},set(e){this.stage.useSingleColor=e}},outlineWidth:{get(){return this.stage.outlineWidth},set(e){this.stage.outlineWidth=e}},visibleEdgeColor:{get(){return this.stage.visibleEdgeColor},set(e){this.stage.visibleEdgeColor=e}},hiddenEdgeColor:{get(){return this.stage.hiddenEdgeColor},set(e){this.stage.hiddenEdgeColor=e}}});var r=le;let ue={base64ToBlob(e){let t=e.split(","),i=t[0].match(/:(.*?);/)[1],r=atob(t[1]),n=r.length,o=new Uint8Array(n);for(;n--;)o[n]=r.charCodeAt(n);return new Blob([o],{type:i})},async base64ToUint8Array(e){e=ue.base64ToBlob(e);return ue.blobToUint8Array(e)},async base64ToImage(r){return new Promise((e,t)=>{let i=new Image;i.setAttribute("crossOrigin","anonymous"),i.src=r,i.onload=()=>{e(i)}})},async blobToUint8Array(e){let i=new FileReader;return i.readAsArrayBuffer(e),new Promise((t,e)=>{i.onload=e=>{e=e.target.result,e=new Uint8Array(e);t(e)}})},async blobToBase64(r){return new Promise((e,t)=>{const i=new FileReader;i.readAsDataURL(r),i.onload=()=>e(i.result),i.onerror=e=>t(e)})},uint8ArrayToBase64(t,e,i){var r=document.createElement("canvas"),n=(r.width=e,r.height=i,r.getContext("2d")),o=n.createImageData(e,i),s=o.data.length;for(let e=0;e<s;e+=4)o.data[e+0]=t[e],o.data[e+1]=t[e+1],o.data[e+2]=t[e+2],o.data[e+3]=t[e+3];return n.putImageData(o,0,0),r.toDataURL()},uint8ArrayToBlob(e,t){return new Blob([e],{type:t})},arrayBufferToBase64(e){let t="";var i=new Uint8Array(e),r=i.byteLength;for(let e=0;e<r;e++)t+=String.fromCharCode(i[e]);return window.btoa(t)},async imaUrlToUint8Array(e){e=await ue.imgUrlToBase64(e),e=ue.base64ToBlob(e);return await ue.blobToUint8Array(e)},async imgUrlToBase64(i,r="image/png"){let n=document.createElement("canvas"),o=n.getContext("2d"),s=new Image;return s.crossOrigin="Anonymous",new Promise((t,e)=>{s.onload=function(){n.width=s.width,n.height=s.height,o.drawImage(s,0,0);var e=n.toDataURL(r);t(e),n=null},s.src=i})},async fileToBase64AndImage(r){return new Promise((i,e)=>{var t=new FileReader;t.readAsDataURL(r),t.onload=function(){let e=this.result,t=new Image;t.setAttribute("crossOrigin","anonymous"),t.src=e,t.onload=()=>{i({image:t,base64:e})}}})},flipY(t,e,i){var r=e*i*4,n=new Uint8Array(r),o=4*e,s=(i-1)*o;for(let e=0;e<r;e+=o)n.set(t.subarray(e,e+o),s-e);return n},createObjectURL(e){return URL.createObjectURL(e)}};var ce=ue;var he=class{constructor(e){this.viewer=e,this._textures={}}parse(e){var t,i={},r=this._getDefaultTextrueOptions(e);for(t in e)if("metallicRoughness"===t||"pbrMetallicRoughness"===t||"specularGlossiness"===t)for(var n in i[t]={},e[t])e[t][n]instanceof Cesium.ModelComponents.TextureReader?i[t][n]=this.parseTextureReader(e[t][n]):n.includes("Texture")&&!e[t][n]?i[t][n]=this.createTextureReaderObject(r):i[t][n]=e[t][n];else"emissiveTexture"===t||"normalTexture"===t||"occlusionTexture"===t?e[t]&&e[t]instanceof Cesium.ModelComponents.TextureReader?i[t]=this.parseTextureReader(e[t]):i[t]=this.createTextureReaderObject(r):("emissiveFactor"!==t||e[t]||(e[t]=new Cesium.Cartesian3),i[t]=e[t]);return i}parseTextureReader(e){var t=e.texture;return{channels:e.channels,texCoord:e.texCoord,textureOptions:{width:t.width,height:t.width,flipY:t.flipY,pixelFormat:t.pixelFormat,pixelDatatype:t.pixelDatatype,sampler:{wrapS:t.sampler.wrapS,wrapT:t.sampler.wrapT,minificationFilter:t.sampler.minificationFilter,magnificationFilter:t.sampler.magnificationFilter},source:pe.textureToImage(this.viewer,t),hasMipmap:t._hasMipmap},transform:e.transform}}_getDefaultTextrueOptions(e){let t={width:512,height:512,flipY:!1,hasMipmap:!1};var i,r,n=[];for(i in e)if(e[i])if("metallicRoughness"===i||"pbrMetallicRoughness"===i||"specularGlossiness"===i)for(var o in e[i])e[i][o]&&e[i][o]instanceof Cesium.ModelComponents.TextureReader&&n.push(e[i][o]);else("emissiveTexture"===i||"normalTexture"===i||"occlusionTexture"===i)&&e[i]instanceof Cesium.ModelComponents.TextureReader&&n.push(e[i]);return 0<n.length&&(r=n[0].texture,t={width:r._width,height:r._height,flipY:r._flipY,hasMipmap:r._hasMipmap,pixelFormat:r._pixelFormat,pixelDatatype:r._pixelDatatype,sampler:{wrapS:r.sampler.wrapS,wrapT:r.sampler.wrapT,minificationFilter:r.sampler.minificationFilter,magnificationFilter:r.sampler.magnificationFilter}}),t}createTextureReaderObject(e){return{channels:"",texCoord:0,textureOptions:{width:e.width,height:e.height,flipY:e.flipY,pixelFormat:e.pixelFormat,pixelDatatype:e.pixelDatatype,sampler:e.sampler,source:"",hasMipmap:e.hasMipmap},transform:Cesium.Matrix3.IDENTITY}}createTextureReader(e,t){return e.texture=this.createTexture(t),e}createTexture(e){var{textureOptions:e,id:t,source:i}=e,r=this.viewer.scene.context;let n=this._textures[t];return i instanceof Image?(n&&n!==r.defaultTexture&&n.destroy(),n=new Cesium.Texture({context:r,width:e.width,height:e.height,source:i,flipY:!0,pixelFormat:e.pixelFormat,pixelDatatype:e.pixelDatatype,sampler:new Cesium.Sampler(e.sampler)}),e.hasMipmap&&n.generateMipmap()):i instanceof HTMLVideoElement&&(n&&n!==r.defaultTexture?n.copyFrom({source:i}):n=2<=i.readyState?new Cesium.Texture({context:r,width:1,height:1,source:i,flipY:!1,pixelFormat:6408,pixelDatatype:5121}):r.defaultTexture,this._textures[t]=n),n}destroyed(){Cesium.destroyObject(this)}};class Ae{constructor(e,t){this.viewer=e,this._parseMaterial=new he(e),this.materials={};let i=[];this.name,this.tileSet,t instanceof Cesium.Cesium3DTileFeature?(i=this.getContentsByFeatrue(t),this.name=t.tileset._asset.name,this.tileSet=t.tileset):t instanceof Cesium.Cesium3DTileset?(i=this.getContentsByTileset(t),this.name=t._asset.name,this.tileSet=t):t instanceof Cesium.Model&&(i=[t],this.tileSet=t),this.getMaterials(i),this.textures={},this.getTextrues(),this._postUpdate}async setMaterial(e,r){let n=this.getMaterial(e),a=this;if(n){for(let i in r)if(!Cesium.defined(r[i])||r[i]&&r[i].textureOptions&&""===r[i].textureOptions.source)n[i]=void 0;else if("metallicRoughness"===i||"pbrMetallicRoughness"===i||"specularGlossiness"===i)for(let t in r[i])Cesium.defined(r[i][t])&&(r[i][t]&&r[i][t].textureOptions&&r[i][t].textureOptions.source&&""===r[i][t].textureOptions.source?r[i][t]=void 0:t.includes("Texture")&&r[i][t].textureOptions&&r[i][t].textureOptions.source&&""!=r[i][t].textureOptions.source?await o(r[i][t],e+i+t,e=>{n[i][t]=e}):n[i][t]=r[i][t]);else i.includes("Texture")&&r[i].textureOptions&&r[i].textureOptions.source&&""!=r[i].textureOptions.source?await o(r[i],e+i,e=>{n[i]=e}):n[i]=r[i];this.resetDrawCommands()}else console.warn("没有找到对应材质");async function o(e,t,i){var r=e.textureOptions.source,n=Object.assign({},e.textureOptions,{source:r});let o=Object.assign({},e,{textureOptions:n,id:t}),s=new Cesium.ModelComponents.TextureReader;"string"==typeof r?(e=await ce.base64ToImage(r),o.source=e,i(a._parseMaterial.createTextureReader(s,o))):r instanceof HTMLVideoElement&&(a._postUpdate&&a._postUpdate(),a._postUpdate=a.viewer.scene._postUpdate.addEventListener(()=>{i(a._parseMaterial.createTextureReader(s,o))}))}}resetDrawCommands(){var e=this.tileSet;let t;e instanceof Cesium.Cesium3DTileset?t=this.getContentsByTileset(e):e instanceof Cesium.Model&&(t=[e]);for(let e=0;e<t.length;e++)t[e].resetDrawCommands()}getMaterial(e){return this.materials[e]}parseMaterial(e){e=this.getMaterial(e);return this._parseMaterial.parse(e)}packPBRMaterial(){var e=Object.values(this.materials);Ae.packPBRMaterial(e)}getContentsByTileset(e){let t=[];e._root.children.map(e=>{e.children&&0<e.children.length?t=Array.prototype.concat(e.children):t.push(e)});let i=[];return t.map(e=>{e._content instanceof Cesium.Composite3DTileContent?e._content._contents.forEach(e=>{i.push(e._model)}):i.push(e._content._model)}),i}getContentsByFeatrue(e){let t=[];return e._content instanceof Cesium.Composite3DTileContent?e._content._contents.forEach(e=>{t.push(e._model)}):t.push(e._content._model),t}getPrimitives(e){let t=[];return e.forEach(e=>{t=Array.prototype.concat(t,e.primitives)}),t}getModelByInstanced3DModel3DTileContent(e,t=[]){return e._modelInstanceCollection._instances.map(e=>{t.push(e.model)}),t}getMaterials(r){for(let i=0;i<r.length;i++)this.getPrimitives(r[i]._sceneGraph._components.nodes).map((e,t)=>{t=r[i]._resource._url+"-"+t;this.materials[t]=e.material})}getTextrues(){var e=Object.values(this.materials);let i=Object.keys(this.materials);e.forEach((e,t)=>{t=i[t]+"-";e.emissiveTexture&&e.emissiveTexture instanceof Cesium.ModelComponents.TextureReader&&(this.textures[t+"material.emissiveTexture.texture"]=e.emissiveTexture.texture),e.normalTexture&&e.normalTexture instanceof Cesium.ModelComponents.TextureReader&&(this.textures[t+"material.normalTexture.texture"]=e.normalTexture.texture),e.occlusionTexture&&e.occlusionTexture instanceof Cesium.ModelComponents.TextureReader&&(this.textures[t+"material.occlusionTexture.texture"]=e.occlusionTexture.texture),e.metallicRoughness.baseColorTexture&&e.metallicRoughness.baseColorTexture instanceof Cesium.ModelComponents.TextureReader&&(this.textures[t+"material.metallicRoughness.baseColorTexture.texture"]=e.metallicRoughness.baseColorTexture.texture),e.metallicRoughness.metallicRoughnessTexture&&e.metallicRoughness.metallicRoughnessTexture instanceof Cesium.ModelComponents.TextureReader&&(this.textures[t+"material.metallicRoughness.metallicRoughnessTexture.texture"]=e.metallicRoughness.metallicRoughnessTexture.texture),e.specularGlossiness&&(e.specularGlossiness.diffuseTexture&&e.specularGlossiness.diffuseTexture instanceof Cesium.ModelComponents.TextureReader&&(this.textures[t+"material.specularGlossiness.diffuseTexture.texture"]=e.specularGlossiness.diffuseTexture.texture),e.specularGlossiness.specularGlossinessTexture)&&e.specularGlossiness.specularGlossinessTexture instanceof Cesium.ModelComponents.TextureReader&&(this.textures[t+"material.specularGlossiness.specularGlossinessTexture.texture"]=e.specularGlossiness.specularGlossinessTexture.texture),e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture instanceof Cesium.ModelComponents.TextureReader&&(this.textures[t+"material.pbrMetallicRoughness.baseColorTexture.texture"]=e.pbrMetallicRoughness.baseColorTexture.texture)})}replaceTextrueToMaterial(i,r){var e=Object.values(this.materials);let n=Object.keys(this.materials);e.forEach((e,t)=>{t=n[t]+"-";t+"material.emissiveTexture.texture"==i&&(e.emissiveTexture.texture=r),t+"material.normalTexture.texture"==i&&(e.normalTexture.texture=r),t+"material.occlusionTexture.texture"==i&&(e.occlusionTexture.texture=r),t+"material.metallicRoughness.baseColorTexture.texture"==i&&(e.metallicRoughness.baseColorTexture.texture=r),t+"material.metallicRoughness.metallicRoughnessTexture.texture"==i&&(e.metallicRoughness.metallicRoughnessTexture.texture=r),t+"material.specularGlossiness.diffuseTexture.texture"==i&&(e.specularGlossiness.diffuseTexture.texture=r),t+"material.specularGlossiness.specularGlossinessTexture.texture"==i&&(e.specularGlossiness.specularGlossinessTexture.texture=r),t+"material.pbrMetallicRoughness.baseColorTexture.texture"==i&&(e.pbrMetallicRoughness.baseColorTexture.texture=r)})}textureToImage(e){return Ae.textureToImage(this.viewer,e)}flipY(e,t,i){return ce.flipY(e,t,i)}changeTextrue(o,e,s){let a=this.viewer,l=new Image;l.setAttribute("crossOrigin","anonymous"),l.src=e,l.onload=()=>{try{var e=this.textures[o],t=e._width,i=e._height,r=this.resizeImage(l,t,i),n=new Cesium.Texture({context:a.scene.context,width:t,height:i,source:r,flipY:!1,pixelFormat:e.pixelFormat,pixelDatatype:e.pixelDatatype,sampler:new Cesium.Sampler({wrapS:e.sampler.wrapS,wrapT:e.sampler.wrapT,minificationFilter:e.sampler.minificationFilter,magnificationFilter:e.sampler.magnificationFilter})});e._hasMipmap&&n.generateMipmap(),this.replaceTextrueToMaterial(o,n),s&&s(n)}catch(e){console.warn(e)}}}resizeImage(e,t,i){var r=document.createElement("canvas");return r.width=t,r.height=i,r.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height),r}downTextures(){var t=this.viewer,i=Object.values(this.textures);for(let e=0;e<i.length;e++){var r=document.createElement("a");r.style.display="none",r.href=Ae.textureToImage(t,i[e]),r.download="图片",document.body.appendChild(r),r.click(),document.body.removeChild(r)}}destroyed(){this.textures=null,this.materials=null,this._postUpdate&&this._postUpdate(),this._parseMaterial.destroyed(),Cesium.destroyObject(this)}}Ae.textureToImage=(e,t,i,r)=>{var n=new Cesium.Framebuffer({context:e.scene.context,colorTextures:t?[t]:void 0,depthTexture:i||void 0,depthStencilTexture:r||void 0}),o=(t||i||r)._width,s=(t||i||r)._height;let a=e.scene.context.readPixels({x:0,y:0,framebuffer:n,width:o,height:s});return(t||i||r)._flipY&&(a=ce.flipY(a,o,s)),ce.uint8ArrayToBase64(a,o,s)},Ae.packPBRMaterial=e=>{console.log(e)};var pe=Ae;const{PostProcessStage:fe,PostProcessStageComposite:de,PostProcessStageSampleMode:ge,createGuid:me}=Cesium;var ye=class{constructor(e,t={}){this.viewer=e,this.id=t.id||me();var e=Cesium.defaultValue(t.contrast,150),i=Cesium.defaultValue(t.brightness,.3),r=Cesium.defaultValue(t.delta,1),n=Cesium.defaultValue(t.sigma,2),t=Cesium.defaultValue(t.stepSize,1);const o=new fe({name:"czm_bloom_contrast_bias"+this.id,fragmentShader:`
uniform sampler2D colorTexture;
uniform float contrast;
uniform float brightness;

in vec2 v_textureCoordinates;

void main(void)
{
    vec3 sceneColor = texture(colorTexture, v_textureCoordinates).xyz;
#ifdef CZM_SELECTED_FEATURE
if (czm_selected()) {
  sceneColor = czm_RGBToHSB(sceneColor);
    sceneColor.z += brightness;
    sceneColor = czm_HSBToRGB(sceneColor);

    float factor = (259.0 * (contrast + 255.0)) / (255.0 * (259.0 - contrast));
    sceneColor = factor * (sceneColor - vec3(0.5)) + vec3(0.5);
    out_FragColor = vec4(sceneColor, 1.0);
}
  
#endif
    out_FragColor = vec4(sceneColor, 1.0);

}`,uniforms:{contrast:e,brightness:i}}),s=this._createBlur("czm_bloom_blur"+this.id,r,n,t);e=new de({name:"czm_bloom_contrast_bias_blur"+this.id,stages:[o,s]}),i=new fe({name:"czm_bloom_generate_composite"+this.id,fragmentShader:`
uniform sampler2D colorTexture;
uniform sampler2D bloomTexture;


in vec2 v_textureCoordinates;

void main(void)
{
    vec4 color = texture(colorTexture, v_textureCoordinates);

#ifdef CZM_SELECTED_FEATURE
    if (czm_selected()) {
         vec4 bloom = texture(bloomTexture, v_textureCoordinates);
         out_FragColor =  bloom + color;   
        return;
    }
#endif
    out_FragColor = color;
    
}`,uniforms:{bloomTexture:e.name}}),r={},Object.defineProperties(r,{contrast:{get:function(){return o.uniforms.contrast},set:function(e){o.uniforms.contrast=e}},brightness:{get:function(){return o.uniforms.brightness},set:function(e){o.uniforms.brightness=e}},delta:{get:function(){return s.uniforms.delta},set:function(e){s.uniforms.delta=e}},sigma:{get:function(){return s.uniforms.sigma},set:function(e){s.uniforms.sigma=e}},stepSize:{get:function(){return s.uniforms.stepSize},set:function(e){s.uniforms.stepSize=e}}}),n=new de({name:"czm_bloom"+this.id,stages:[e,i],inputPreviousStageTexture:!1,uniforms:r});this.stage=this.viewer.scene.postProcessStages.add(n),this.stage.selected=[]}addPickObject(e){e=this._doPickId(e);return Array.isArray(e)?this.addMany(e):this.add(e)}add(e){if(!e.pickId&&!e.pickIds)throw new Error("不支持选中的数据类型");-1==this.iscontainFeatrue(e)?this.stage.selected.push(e):this.remove(e)}addMany(t){for(let e=0;e<t.length;e++)this.add(t[e])}remove(e){e=this.iscontainFeatrue(e);-1<e&&this.stage.selected.splice(e,1)}removeAll(){this.stage.selected=[]}iscontainFeatrue(n){let o=-1;return this.stage.selected.forEach((t,i)=>{if(t.pickId&&Cesium.Color.equals(t.pickId.color,n.pickId.color)&&(o=i),t.pickIds){var r=t.pickIds.length;for(let e=0;e<r;e++)t.pickIds[e].pickId&&Cesium.Color.equals(t.pickIds[e].pickId.color,n.pickId.color)&&(o=i)}}),o}destroyed(){this.stage&&this.viewer.scene.postProcessStages.remove(this.stage)}_doPickId(e){var t=e.primitive;return e instanceof Cesium.Cesium3DTileFeature?{pickId:{color:e.pickId.color}}:e instanceof Cesium.Cesium3DTileset?this._getPickObjectById(e._url).map(e=>({pickId:{color:e.pickId.color}})):t&&(t instanceof Cesium.Polyline||t instanceof Cesium.Billboard||t instanceof Cesium.PointPrimitive)?{pickId:{color:t.pickId.color}}:t&&(t instanceof Cesium.Primitive||t instanceof Cesium.Model)?t._pickIds.map(e=>({pickId:{color:e.color}})):t&&t instanceof Cesium.Label?t._glyphs.map(e=>({pickId:{color:e.billboard.pickId.color}})):void 0}_getPickObjectById(t){return Object.values(this.viewer.scene.context._pickObjects).filter(e=>{if(e.primitive instanceof Cesium.Cesium3DTileset&&e.primitive._url==t)return e})}_createBlur(e,t,i,r){var n=`
#define SAMPLES 8

uniform float delta;
uniform float sigma;
uniform float direction; 
uniform sampler2D colorTexture;


uniform float stepSize;


in vec2 v_textureCoordinates;


void main()
{
    vec2 st = v_textureCoordinates;
    vec2 dir = vec2(1.0 - direction, direction);
    vec4 color = texture(colorTexture, v_textureCoordinates);

#ifdef CZM_SELECTED_FEATURE
    
    if (czm_selected()) { 
          vec2 step = vec2(stepSize * (czm_pixelRatio / czm_viewport.zw));

          vec3 g;
          g.x = 1.0 / (sqrt(czm_twoPi) * sigma);
          g.y = exp((-0.5 * delta * delta) / (sigma * sigma));
          g.z = g.y * g.y;
      
          vec4 result = texture(colorTexture, st) * g.x;
          for (int i = 1; i < SAMPLES; ++i)
          {
              g.xy *= g.yz;
      
              vec2 offset = float(i) * dir * step;
              result += texture(colorTexture, st - offset) * g.x;
              result += texture(colorTexture, st + offset) * g.x;
          }      
         out_FragColor =  result;     
         return;    
    }else{      
      out_FragColor = color;
    }
 #endif
    out_FragColor = color;
    
}

`;const o=new fe({name:e+"_x_direction",fragmentShader:n,uniforms:{delta:t,sigma:i,stepSize:r,direction:0},sampleMode:ge.LINEAR}),s=new fe({name:e+"_y_direction",fragmentShader:n,uniforms:{delta:t,sigma:i,stepSize:r,direction:1},sampleMode:ge.LINEAR});n={};return Object.defineProperties(n,{delta:{get:function(){return o.uniforms.delta},set:function(e){var t=o.uniforms,i=s.uniforms;t.delta=i.delta=e}},sigma:{get:function(){return o.uniforms.sigma},set:function(e){var t=o.uniforms,i=s.uniforms;t.sigma=i.sigma=e}},stepSize:{get:function(){return o.uniforms.stepSize},set:function(e){var t=o.uniforms,i=s.uniforms;t.stepSize=i.stepSize=e}}}),new de({name:e,stages:[o,s],uniforms:n})}get contrast(){return this.stage.uniforms.contrast}set contrast(e){this.stage.uniforms.contrast=e}get brightness(){return this.stage.uniforms.brightness}set brightness(e){this.stage.uniforms.brightness=e}get delta(){return this.stage.uniforms.delta}set delta(e){this.stage.uniforms.delta=e}get sigma(){return this.stage.uniforms.sigma}set sigma(e){this.stage.uniforms.sigma=e}get stepSize(){return this.stage.uniforms.stepSize}set stepSize(e){this.stage.uniforms.stepSize=e}get enabled(){return this.stage.enabled}set enabled(e){this.stage.enabled=e}};var _e=class{constructor(e,t){this.viewer=e;let{diffuseTexture:i,repeat:r=new Cesium.Cartesian2(1,1),diffuseColorDay:n=Cesium.Color.fromCssColorString("#ffffff"),diffuseColorDusk:o=Cesium.Color.fromCssColorString("#ffffff"),diffuseColorNight:s=Cesium.Color.fromCssColorString("#ffffff"),roughness:a,occlusion:l,baseColor:u=Cesium.Color.fromCssColorString("#ffffff"),topColor:c=Cesium.Color.fromCssColorString("#ffffff"),baseColorHeight:h,applay:A=!0,speed:p=5,brightness:f,contrast:d,nightEmissiveFactor:g=.7,alpha:m=.5}=t;"string"==typeof c&&(c=Cesium.Color.fromCssColorString(c)),"string"==typeof n&&(n=Cesium.Color.fromCssColorString(n)),"string"==typeof s&&(s=Cesium.Color.fromCssColorString(s)),"string"==typeof o&&(o=Cesium.Color.fromCssColorString(o)),this.startTime=performance.now(),this._speed=p,"string"==typeof u&&(u=Cesium.Color.fromCssColorString(u)),this.customShader=new Cesium.CustomShader({lightingModel:1,translucencyMode:0,maximumAnisotropy:.1,uniforms:{u_time:{type:Cesium.UniformType.FLOAT,value:0},u_applay:{type:Cesium.UniformType.BOOL,value:A},u_topColor:{type:Cesium.UniformType.VEC3,value:c},u_diffuseColorDay:{type:Cesium.UniformType.VEC3,value:n},u_diffuseColorNight:{type:Cesium.UniformType.VEC3,value:s},u_diffuseColorDusk:{type:Cesium.UniformType.VEC3,value:o},u_repeat:{type:Cesium.UniformType.VEC2,value:r},u_diffuseTexture:{type:Cesium.UniformType.SAMPLER_2D,value:new Cesium.TextureUniform(i)},u_baseColor:{type:Cesium.UniformType.VEC3,value:u},u_baseColorHeight:{type:Cesium.UniformType.FLOAT,value:h},u_nightEmissiveFactor:{type:Cesium.UniformType.FLOAT,value:g},u_alpha:{type:Cesium.UniformType.FLOAT,value:m},u_roughness:{type:Cesium.UniformType.FLOAT,value:a},u_occlusion:{type:Cesium.UniformType.FLOAT,value:l},u_brightness:{type:Cesium.UniformType.FLOAT,value:f},u_contrast:{type:Cesium.UniformType.FLOAT,value:d}},vertexShaderText:`
        void vertexMain(VertexInput vsInput, inout czm_modelVertexOutput vsOutput)
        {
            vec3 positionMC = vsOutput.positionMC;
            if(u_applay){
              positionMC.z *=  u_time;
            }else{
              positionMC.z *= 1.0;
            }         
            vsOutput.positionMC = positionMC;
        }`,fragmentShaderText:[`     
            vec3 setColorFactor(vec3 sceneColor,float brightness,float contrast)
                {
               
                    sceneColor = czm_RGBToHSB(sceneColor);
                    sceneColor.z += brightness;
                    sceneColor = czm_HSBToRGB(sceneColor);
                    float factor = (259.0 * (contrast + 255.0)) / (255.0 * (259.0 - contrast));
                    sceneColor = factor * (sceneColor - vec3(0.5)) + vec3(0.5);
                    return sceneColor;
                }
        
            void fragmentMain(FragmentInput fsInput, inout czm_modelMaterial material) {
              float featureId = float(fsInput.featureIds.featureId_0);
              vec2 st = fsInput.attributes.texCoord_0;
              vec3 positionMC = fsInput.attributes.positionMC;
              vec3 positionEC = (czm_view3D * vec4(positionMC, 1.0)).xyz;

              vec3 color;
              float hours = czm_globeTime.x;
              float emissiveFactor;
           
              if(hours >=6.0 && hours<17.0){
                color = u_diffuseColorDay * material.diffuse;             
                material.diffuse =  color * mix(u_baseColor,u_topColor, min(positionMC.z / u_baseColorHeight,1.0)); 
               }else if(hours >= 17.0 && hours<19.0){
                color = u_diffuseColorDusk * material.diffuse;               
                material.diffuse =  color * mix(u_baseColor,u_topColor, min(positionMC.z / u_baseColorHeight,1.0)); 
               }else{            
                color = u_diffuseColorNight;
                color.b -= fract(featureId/10.0)*0.5;
                color.g += fract(featureId/10.0)*0.5;
                color.r += fract(featureId/10.0)*0.3;
                color *=clamp(positionMC.z/150.0, 0.3,  1.0);
        
                emissiveFactor = u_nightEmissiveFactor;
                float colorCount = color.x + color.y + color.z;
           
                emissiveFactor*=clamp(colorCount, 1.0,  10.0);
                vec4 image = texture(u_diffuseTexture, vec2(fract(st.s * u_repeat.x), fract(st.t * u_repeat.y)));
                color = color*image.xyz;                   
                color = setColorFactor(color,u_brightness,u_contrast);
                color = czm_srgbToLinear(color);
                //漫反射
                material.diffuse =  color * mix(u_baseColor,u_topColor, min(positionMC.z / u_baseColorHeight,1.0));    
                material.emissive = material.diffuse * emissiveFactor;
               }                                 
                        
              material.roughness = u_roughness;
              material.occlusion = u_occlusion;
              material.alpha = u_alpha;
          }                                          
            `]}),(this.customShader.design=this).listener=this.viewer.scene.postUpdate.addEventListener(()=>{var e=(performance.now()-this.startTime)/(20100-2e3*this._speed);this.customShader.setUniform("u_time",e),1<e&&(this.startTime=performance.now(),this.applay=!1)})}get translucencyMode(){return this.customShader.translucencyMode}set translucencyMode(e){this.customShader.translucencyMode=e}get diffuseColorNight(){return this.customShader.uniforms.u_diffuseColorNight.value}set diffuseColorNight(e){"string"==typeof e&&(e=Cesium.Color.fromCssColorString(e)),this.customShader.uniforms.u_diffuseColorNight.value=e}get diffuseColorDay(){return this.customShader.uniforms.u_diffuseColorDay.value}set diffuseColorDay(e){"string"==typeof e&&(e=Cesium.Color.fromCssColorString(e)),this.customShader.uniforms.u_diffuseColorDay.value=e}get diffuseColorDusk(){return this.customShader.uniforms.u_diffuseColorDusk.value}set diffuseColorDusk(e){"string"==typeof e&&(e=Cesium.Color.fromCssColorString(e)),this.customShader.uniforms.u_diffuseColorDusk.value=e}get nightEmissiveFactor(){return this.customShader.uniforms.u_nightEmissiveFactor.value}set nightEmissiveFactor(e){this.customShader.uniforms.u_nightEmissiveFactor.value=e}get diffuseTexture(){return this.customShader.uniforms.u_diffuseTexture.value}set diffuseTexture(e){this.customShader.setUniform("u_diffuseTexture",new Cesium.TextureUniform(e))}get alpha(){return this.customShader.uniforms.u_alpha.value}set alpha(e){this.customShader.uniforms.u_alpha.value=e}get topColor(){return this.customShader.uniforms.u_topColor.value}set topColor(e){"string"==typeof e&&(e=Cesium.Color.fromCssColorString(e)),this.customShader.uniforms.u_topColor.value!=e&&(this.customShader.uniforms.u_topColor.value=e)}get baseColor(){return this.customShader.uniforms.u_baseColor.value}set baseColor(e){"string"==typeof e&&(e=Cesium.Color.fromCssColorString(e)),this.customShader.uniforms.u_baseColor.value!=e&&(this.customShader.uniforms.u_baseColor.value=e)}get baseColorHeight(){return this.customShader.uniforms.u_baseColorHeight.value}set baseColorHeight(e){this.customShader.uniforms.u_baseColorHeight.value!=e&&(this.customShader.uniforms.u_baseColorHeight.value=e)}get brightness(){return this.customShader.uniforms.u_brightness.value}set brightness(e){this.customShader.uniforms.u_brightness.value!=e&&(this.customShader.uniforms.u_brightness.value=e)}get contrast(){return this.customShader.uniforms.u_contrast.value}set contrast(e){this.customShader.uniforms.u_contrast.value!=e&&(this.customShader.uniforms.u_contrast.value=e)}get repeat(){return this.customShader.uniforms.u_repeat.value}set repeat(e){this.customShader.uniforms.u_repeat.value!=e&&(this.customShader.uniforms.u_repeat.value=e)}get roughness(){return this.customShader.uniforms.u_roughness.value}set roughness(e){this.customShader.uniforms.u_roughness.value!=e&&(this.customShader.uniforms.u_roughness.value=e)}get occlusion(){return this.customShader.uniforms.u_occlusion.value}set occlusion(e){this.customShader.uniforms.u_occlusion.value!=e&&(this.customShader.uniforms.u_occlusion.value=e)}get speed(){return this._speed}set speed(e){this._speed!=e&&(this._speed=e)}get applay(){return this.customShader.uniforms.u_applay.value}set applay(e){(this.customShader.uniforms.u_applay.value=e)&&(this.startTime=performance.now())}destroyed(){this.listener&&this.listener()}};var ve=class{constructor(e,t){this.viewer=e;var{url:e,flipY:t=!1,repeatVideo:i=new Cesium.Cartesian2(1,1),roughness:r,occlusion:n,brightness:o,contrast:s,bloomStageEnabled:a=!1,bloomContrast:l=100,bloomBrightness:u=.1,bloomDelta:c=5,bloomSigma:h=2,bloomStepSize:A=5,mixfactor:p=.5}=t;this._bloomStage=new ye(this.viewer),this.bloomStageEnabled=a,this.bloomContrast=l,this.bloomBrightness=u,this.bloomDelta=c,this.bloomSigma=h,this.bloomStepSize=A,this._url=e,this._flipY=t,this.createVideo(e),this.customShader=new Cesium.CustomShader({lightingModel:1,translucencyMode:0,maximumAnisotropy:.1,uniforms:{u_repeatVideo:{type:Cesium.UniformType.VEC2,value:i},u_videoTexture:{type:Cesium.UniformType.SAMPLER_2D,value:new Cesium.TextureUniform({url:e})},u_roughness:{type:Cesium.UniformType.FLOAT,value:r},u_occlusion:{type:Cesium.UniformType.FLOAT,value:n},u_brightness:{type:Cesium.UniformType.FLOAT,value:o},u_contrast:{type:Cesium.UniformType.FLOAT,value:s},u_mixfactor:{type:Cesium.UniformType.FLOAT,value:p}},vertexShaderText:`
           void vertexMain(VertexInput vsInput, inout czm_modelVertexOutput vsOutput)
           {
               vec3 positionMC = vsOutput.positionMC;                 
               vsOutput.positionMC = positionMC;
           }`,fragmentShaderText:[`     
               vec3 setColorFactor(vec3 sceneColor,float brightness,float contrast)
                   {             
                       sceneColor = czm_RGBToHSB(sceneColor);
                       sceneColor.z += brightness;
                       sceneColor = czm_HSBToRGB(sceneColor);
                       float factor = (259.0 * (contrast + 255.0)) / (255.0 * (259.0 - contrast));
                       sceneColor = factor * (sceneColor - vec3(0.5)) + vec3(0.5);
                       return sceneColor;
                   }
           
            void fragmentMain(FragmentInput fsInput, inout czm_modelMaterial material) {
                 vec2 st = fsInput.attributes.texCoord_0;
                 vec3 positionMC = fsInput.attributes.positionMC;
                 vec3 positionEC = (czm_view3D * vec4(positionMC, 1.0)).xyz;
                
                                                              
                 //漫反射
                 vec3 color = material.diffuse;                
                 vec2 videoSt = st;
                 float offserVideoX = videoSt.s * u_repeatVideo.x;
                 float offserVideoY = videoSt.t * u_repeatVideo.y;
                 
            
                 //白天
                if(czm_lightIntensity > 0.6){
                  color = material.diffuse;
                  //lightIntensity = czm_lightIntensity;             
                 }else{
                  color = material.emissive;
                  //lightIntensity = 1.0-czm_lightIntensity;
                }   
                vec4 videoImage = texture(u_videoTexture, vec2(fract(offserVideoX), fract(offserVideoY)));
                videoImage.xyz = setColorFactor(videoImage.xyz,u_brightness,u_contrast);  
                videoImage = czm_srgbToLinear(videoImage);
                material.emissive = mix(videoImage.xyz,color,u_mixfactor);  

                material.roughness = u_roughness;
                material.occlusion = u_occlusion;
             }                                          
               `]}),this.customShader.design=this}createVideo(e,t){this.activeVideoListener&&this.activeVideoListener();let i={repeat:!1,url:this._createVideoEle(e),flipY:t};this.activeVideoListener=this.viewer.clock.onTick.addEventListener(()=>{this.videoTexture=i})}_createVideoEle(e){var t=document.createElement("SOURCE"),i=(t.type="video/mp4",t.src=e,document.createElement("SOURCE")),e=(i.type="video/quicktime",i.src=e,document.createElement("VIDEO"));return e.setAttribute("autoplay",!0),e.setAttribute("loop",!0),e.setAttribute("crossorigin",!0),e.appendChild(t),e.appendChild(i),this._videoEle=e}get videoPlay(){return this._videoPlay}set videoPlay(e){e?this._videoEle.paly():this._videoEle.pause(),this._videoPlay=e}get url(){return this._url}set url(e){e!==this._url&&(this._url=e,this.createVideo(e,this._flipY))}get flipY(){return this._flipY}set flipY(e){e!==this._flipY&&(this._flipY=e,this.createVideo(this._url,this._flipY))}get videoTexture(){return this.customShader.uniforms.u_videoTexture.value}set videoTexture(e){this.customShader.setUniform("u_videoTexture",new Cesium.TextureUniform(e))}get brightness(){return this.customShader.uniforms.u_brightness.value}set brightness(e){this.customShader.uniforms.u_brightness.value!=e&&(this.customShader.uniforms.u_brightness.value=e)}get contrast(){return this.customShader.uniforms.u_contrast.value}set contrast(e){this.customShader.uniforms.u_contrast.value!=e&&(this.customShader.uniforms.u_contrast.value=e)}get repeatVideo(){return this.customShader.uniforms.u_repeatVideo.value}set repeatVideo(e){this.customShader.uniforms.u_repeatVideo.value!=e&&(this.customShader.uniforms.u_repeatVideo.value=e)}get roughness(){return this.customShader.uniforms.u_roughness.value}set roughness(e){this.customShader.uniforms.u_roughness.value!=e&&(this.customShader.uniforms.u_roughness.value=e)}get occlusion(){return this.customShader.uniforms.u_occlusion.value}set occlusion(e){this.customShader.uniforms.u_occlusion.value!=e&&(this.customShader.uniforms.u_occlusion.value=e)}get mixfactor(){return this.customShader.uniforms.u_mixfactor.value}set mixfactor(e){this.customShader.uniforms.u_mixfactor.value!=e&&(this.customShader.uniforms.u_mixfactor.value=e)}get bloomStageEnabled(){return this._bloomStage.stage.enabled}set bloomStageEnabled(e){this._bloomStage.stage.enabled=e}get bloomStage(){return this._bloomStage}get bloomContrast(){return this._bloomStage.contrast}set bloomContrast(e){this._bloomStage.contrast=e}get bloomBrightness(){return this._bloomStage.brightness}set bloomBrightness(e){this._bloomStage.brightness=e}get bloomDelta(){return this._bloomStage.delta}set bloomDelta(e){this._bloomStage.delta=e}get bloomSigma(){return this._bloomStage.sigma}set bloomSigma(e){this._bloomStage.sigma=e}get bloomStepSize(){return this._bloomStage.stepSize}set bloomStepSize(e){this._bloomStage.stepSize=e}destroyed(){this.listener&&this.listener(),this._bloomStage&&this._bloomStage.destroyed(),this.activeVideoListener&&this.activeVideoListener()}};var Ce=class{constructor(e){let{floodTexture:t,repeatFlood:i,floodMaxHeight:r,floodColor:n,floodDirection:o,floodBrightness:s=0,floodContrast:a=0,floodSaturation:l=0,floodHue:u=0}=e;"string"==typeof n&&(n=Cesium.Color.fromCssColorString(n)),this.uniforms={u_floodTexture:{type:Cesium.UniformType.SAMPLER_2D,value:new Cesium.TextureUniform(t)},u_repeatFlood:{type:Cesium.UniformType.VEC2,value:i},u_floodMaxHeight:{type:Cesium.UniformType.FLOAT,value:r},u_floodColor:{type:Cesium.UniformType.VEC3,value:n},u_floodDirection:{type:Cesium.UniformType.FLOAT,value:o},u_floodHue:{type:Cesium.UniformType.FLOAT,value:u},u_floodSaturation:{type:Cesium.UniformType.FLOAT,value:l},u_floodBrightness:{type:Cesium.UniformType.FLOAT,value:s},u_floodContrast:{type:Cesium.UniformType.FLOAT,value:a}},this.fragmentShaderText=`
    vec3 mainFlow( inout czm_modelMaterial material,vec2 st,  vec3 positionMC, float u_time,float hue, float saturation, float brightness, float contrast){
        if(positionMC.z < u_floodMaxHeight){
            vec4 floodImage = vec4(0.0);
            if(u_floodDirection == 0.0) { //下                 
                floodImage =  texture(u_floodTexture, vec2(st.s * u_repeatFlood.x , st.t * u_repeatFlood.y - u_time));
            } else if(u_floodDirection == 1.0) {//上
                floodImage =  texture(u_floodTexture, vec2(st.s * u_repeatFlood.x , st.t * u_repeatFlood.y + u_time));
            } else if(u_floodDirection == 2.0) {//左
                floodImage =  texture(u_floodTexture, vec2(st.s * u_repeatFlood.x - u_time, st.t * u_repeatFlood.y ));
            } else if(u_floodDirection == 3.0) {//右
                floodImage =  texture(u_floodTexture, vec2(st.s * u_repeatFlood.x + u_time, st.t * u_repeatFlood.y ));
            } else if(u_floodDirection == 4.0) {//左下
                floodImage =  texture(u_floodTexture, vec2(st.s * u_repeatFlood.x - u_time, st.t * u_repeatFlood.y - u_time));
            }  else if(u_floodDirection == 5.0) {//左上
                floodImage =  texture(u_floodTexture, vec2(st.s * u_repeatFlood.x - u_time, st.t * u_repeatFlood.y + u_time));
            } else if(u_floodDirection == 6.0) {//右下
                floodImage =  texture(u_floodTexture, vec2(st.s * u_repeatFlood.x + u_time, st.t * u_repeatFlood.y - u_time));
            } else if(u_floodDirection == 7.0) {//右上
                floodImage =  texture(u_floodTexture, vec2(st.s * u_repeatFlood.x + u_time, st.t * u_repeatFlood.y + u_time));
            }
                        
            floodImage = czm_srgbToLinear(floodImage);
            if(floodImage.a > 0.0){
                floodImage.xyz = setColorFactor(floodImage.xyz, hue, saturation, brightness, contrast);
            }                 
            vec3 color = vec3(0.0);
            if(u_floodColor.r==1.0 && u_floodColor.g==1.0 && u_floodColor.b==1.0){
                color =   material.diffuse * floodImage.rgb;
            }else{
                color =  floodImage.a * u_floodColor;
            }
            //color = material.diffuse * u_floodColor * floodImage.a;
            
            //material.emissive += color;
            return color;
                  
         }
    }
       
        `}setDefineProperties(t){Object.defineProperties(t,{floodTexture:{get(){return t.customShader.uniforms.u_floodTexture.value},set(e){t.customShader.setUniform("u_floodTexture",new Cesium.TextureUniform(e))}},repeatFlood:{get(){return t.customShader.uniforms.u_repeatFlood.value},set(e){t.customShader.uniforms.u_repeatFlood.value!=e&&(t.customShader.uniforms.u_repeatFlood.value=e)}},floodMaxHeight:{get(){return t.customShader.uniforms.u_floodMaxHeight.value},set(e){t.customShader.uniforms.u_floodMaxHeight.value!=e&&(t.customShader.uniforms.u_floodMaxHeight.value=e)}},floodColor:{get(){return t.customShader.uniforms.u_floodColor.value},set(e){"string"==typeof e&&(e=Cesium.Color.fromCssColorString(e)),t.customShader.uniforms.u_floodColor.value!=e&&(t.customShader.uniforms.u_floodColor.value=e)}},floodDirection:{get(){return t.customShader.uniforms.u_floodDirection.value},set(e){t.customShader.uniforms.u_floodDirection.value=e}},floodHue:{get(){return t.customShader.uniforms.u_floodHue.value},set(e){t.customShader.uniforms.u_floodHue.value=e}},floodSaturation:{get(){return t.customShader.uniforms.u_floodSaturation.value},set(e){t.customShader.uniforms.u_floodSaturation.value=e}},floodBrightness:{get(){return t.customShader.uniforms.u_floodBrightness.value},set(e){t.customShader.uniforms.u_floodBrightness.value=e}},floodContrast:{get(){return t.customShader.uniforms.u_floodContrast.value},set(e){t.customShader.uniforms.u_floodContrast.value=e}}})}};var we=class{constructor(e,t,i){this.viewer=e;let{roughness:r,occlusion:n,repeatFlood:o=new Cesium.Cartesian2(1,1),floodTexture:s,floodColor:a=Cesium.Color.fromCssColorString("yellow"),floodMaxHeight:l=460,floodDirection:u=1,floodBrightness:c,floodContrast:h,floodSaturation:A,floodHue:p,applay:f=!0,speed:d=5,bloom:g}=t;this.owner=i,this.bloomStage=new ye(this.viewer),this.startTime=performance.now(),this._speed=d,this.flow=new Ce({floodTexture:s,repeatFlood:o,floodMaxHeight:l,floodColor:a,floodDirection:u,floodHue:p,floodSaturation:A,floodBrightness:c,floodContrast:h});e={u_time:{type:Cesium.UniformType.FLOAT,value:0},u_applay:{type:Cesium.UniformType.BOOL,value:f},u_customEmissiveFactor:{type:Cesium.UniformType.FLOAT,value:1},u_roughness:{type:Cesium.UniformType.FLOAT,value:r},u_occlusion:{type:Cesium.UniformType.FLOAT,value:n}},e=Object.assign({},e,this.flow.uniforms);this.customShader=new Cesium.CustomShader({lightingModel:1,translucencyMode:0,maximumAnisotropy:.1,uniforms:e,vertexShaderText:`
           void vertexMain(VertexInput vsInput, inout czm_modelVertexOutput vsOutput)
           {
               vec3 positionMC = vsOutput.positionMC;
               if(u_applay){
                 positionMC.z *=  u_time;
               }else{
                 positionMC.z *= 1.0;
               }         
               vsOutput.positionMC = positionMC;
           }`,fragmentShaderText:[`              
             vec3 setColorFactor(vec3 color,float hue,float saturation,float brightness,float contrast){
                     vec3 hsb = czm_RGBToHSB(color);              
                     hsb.x += hue; // hue
                     hsb.y = clamp(hsb.y + saturation, 0.0, 1.0); // saturation
                     hsb.z = hsb.z > czm_epsilon7 ? hsb.z + brightness : 0.0; // brightness                          
                     float factor = (259.0 * (contrast + 255.0)) / (255.0 * (259.0 - contrast));
                     hsb = factor * (hsb - vec3(0.5)) + vec3(0.5);
                 
                     color = czm_HSBToRGB(hsb);
                     return color;
                   }
                   ${this.flow.fragmentShaderText}
           
               void fragmentMain(FragmentInput fsInput, inout czm_modelMaterial material) {
                 vec2 st = fsInput.attributes.texCoord_0;
                 vec3 positionMC = fsInput.attributes.positionMC;
                 vec3 positionEC = (czm_view3D * vec4(positionMC, 1.0)).xyz;
                                     
                 //漫反射
                 ${""!=this.flow.fragmentShaderText?"material.emissive +=  mainFlow( material, st, positionMC, u_time, u_floodHue, u_floodSaturation, u_floodBrightness, u_floodContrast);":""}                        
                 material.roughness = u_roughness;
                 material.occlusion = u_occlusion;
             }                                          
               `]}),(this.customShader.design=this).listener=this.viewer.scene.postUpdate.addEventListener(()=>{let e=this.viewer.scene.light.intensity;1<e&&(e=1);0===this.viewer.clock.modelType?this.bloom=g:(this.bloomStage.enabled=!1,e=.1);var t=(performance.now()-this.startTime)/(20100-2e3*this._speed);this.customShader.setUniform("u_time",t),1<t&&(this.startTime=performance.now(),this.applay=!1)}),this.flow.setDefineProperties(this)}get roughness(){return this.customShader.uniforms.u_roughness.value}set roughness(e){this.customShader.uniforms.u_roughness.value!=e&&(this.customShader.uniforms.u_roughness.value=e)}get occlusion(){return this.customShader.uniforms.u_occlusion.value}set occlusion(e){this.customShader.uniforms.u_occlusion.value!=e&&(this.customShader.uniforms.u_occlusion.value=e)}get speed(){return this._speed}set speed(e){this._speed!=e&&(this._speed=e)}get applay(){return this.customShader.uniforms.u_applay.value}set applay(e){(this.customShader.uniforms.u_applay.value=e)&&(this.startTime=performance.now())}get bloom(){return this.bloomStage}set bloom(e){for(var t in e)this._owner&&"enabled"===t&&e[t]&&0==this.bloomStage.stage.selected.length&&this.bloomStage.addPickObject(this._owner),this.bloomStage[t]=e[t]}get owner(){return this._owner}set owner(e){this._owner=e}destroyed(){this.listener&&this.listener(),this.bloomStage&&this.bloomStage.destroyed()}};var xe=class{constructor(e,t){this.viewer=e;let{emissiveColor:i=Cesium.Color.fromCssColorString("#fff"),roughness:r,occlusion:n,brightness:o=0,contrast:s=0,saturation:a=0,hue:l=0,emissiveFactor:u=.1}=t;"string"==typeof i&&(i=Cesium.Color.fromCssColorString(i)),this._emissiveFactor=u;e={u_emissiveColor:{type:Cesium.UniformType.VEC3,value:i},emissiveFactor:{type:Cesium.UniformType.FLOAT,value:1},u_roughness:{type:Cesium.UniformType.FLOAT,value:r},u_occlusion:{type:Cesium.UniformType.FLOAT,value:n},u_brightness:{type:Cesium.UniformType.FLOAT,value:o},u_contrast:{type:Cesium.UniformType.FLOAT,value:s},u_hue:{type:Cesium.UniformType.FLOAT,value:l},u_saturation:{type:Cesium.UniformType.FLOAT,value:a}};this.customShader=new Cesium.CustomShader({lightingModel:1,translucencyMode:0,maximumAnisotropy:.1,uniforms:e,fragmentShaderText:[`              
            vec3 setColorFactor(vec3 color,float hue,float saturation,float brightness,float contrast){
                      vec3 hsb = czm_RGBToHSB(color);              
                      hsb.x += hue; // hue
                      hsb.y = clamp(hsb.y + saturation, 0.0, 1.0); // saturation
                      hsb.z = hsb.z > czm_epsilon7 ? hsb.z + brightness : 0.0; // brightness                          
                      float factor = (259.0 * (contrast + 255.0)) / (255.0 * (259.0 - contrast));
                      hsb = factor * (hsb - vec3(0.5)) + vec3(0.5);               
                      color = czm_HSBToRGB(hsb);
                      return color;
                    }                       
                void fragmentMain(FragmentInput fsInput, inout czm_modelMaterial material) {
                  vec2 st = fsInput.attributes.texCoord_0;
                  vec3 positionMC = fsInput.attributes.positionMC;
                  vec3 positionEC = (czm_view3D * vec4(positionMC, 1.0)).xyz;
                 
                  vec3 color = material.diffuse;           
                  color = setColorFactor(color,u_hue,u_saturation,u_brightness,u_contrast);                      
                  //if(czm_lightIntensity < 0.6){
                    float tmp = step(czm_lightIntensity,0.6);
                    material.emissive = color * u_emissiveColor * emissiveFactor *(tmp);  
                 // }                                 
                  material.roughness = u_roughness;
                  material.occlusion = u_occlusion;
              }                                          
                `]}),(this.customShader.design=this).listener=this.viewer.scene.postUpdate.addEventListener(()=>{let e=0;0===this.viewer.clock.modelType&&(e=this.emissiveFactor),this.customShader.setUniform("emissiveFactor",e)})}get emissiveColor(){return this.customShader.uniforms.u_emissiveColor.value}set emissiveColor(e){"string"==typeof e&&(e=Cesium.Color.fromCssColorString(e)),this.customShader.uniforms.u_emissiveColor.value!=e&&(this.customShader.uniforms.u_emissiveColor.value=e)}get emissiveFactor(){return this._emissiveFactor}set emissiveFactor(e){this._emissiveFactor=e}get roughness(){return this.customShader.uniforms.u_roughness.value}set roughness(e){this.customShader.uniforms.u_roughness.value!=e&&(this.customShader.uniforms.u_roughness.value=e)}get occlusion(){return this.customShader.uniforms.u_occlusion.value}set occlusion(e){this.customShader.uniforms.u_occlusion.value!=e&&(this.customShader.uniforms.u_occlusion.value=e)}get brightness(){return this.customShader.uniforms.u_brightness.value}set brightness(e){this.customShader.uniforms.u_brightness.value!=e&&(this.customShader.uniforms.u_brightness.value=e)}get contrast(){return this.customShader.uniforms.u_contrast.value}set contrast(e){this.customShader.uniforms.u_contrast.value!=e&&(this.customShader.uniforms.u_contrast.value=e)}get hue(){return this.customShader.uniforms.u_hue.value}set hue(e){this.customShader.uniforms.u_hue.value!=e&&(this.customShader.uniforms.u_hue.value=e)}get saturation(){return this.customShader.uniforms.u_saturation.value}set saturation(e){this.customShader.uniforms.u_saturation.value!=e&&(this.customShader.uniforms.u_saturation.value=e)}destroyed(){this.listener&&this.listener()}};var be=class{constructor(e,t){this.viewer=e;let{materials:i,diffuseColor:r=Cesium.Color.fromCssColorString("#ffffff"),roughness:n,occlusion:o,nightEmissiveFactor:s=1,translucencyMode:a=0,featureDivision:l=10,speed:u=3}=t;this.startTime=performance.now(),this._speed=u,"string"==typeof r&&(r=Cesium.Color.fromCssColorString(r));var c={};for(let e=0;e<i.length;e++)c["u_image"+(e+1)]={type:Cesium.UniformType.SAMPLER_2D,value:new Cesium.TextureUniform(i[e].diffTexture)};e=this.multipById(i,l),t={u_time:{type:Cesium.UniformType.FLOAT,value:0},u_nightEmissiveFactor:{type:Cesium.UniformType.FLOAT,value:s},u_diffuseColor:{type:Cesium.UniformType.VEC3,value:r},u_roughness:{type:Cesium.UniformType.FLOAT,value:n},u_occlusion:{type:Cesium.UniformType.FLOAT,value:o}},t=Object.assign({},t,c);this.customShader=new Cesium.CustomShader({lightingModel:1,translucencyMode:a,uniforms:t,fragmentShaderText:[`                                      
                      void fragmentMain(FragmentInput fsInput, inout czm_modelMaterial material) {
                       
                            float featureId = float(fsInput.featureIds.featureId_0);
                            vec2 st = fsInput.attributes.texCoord_0;
                            vec3 positionMC = fsInput.attributes.positionMC;             
                            vec3 positionEC = (czm_view3D * vec4(positionMC, 1.0)).xyz;
                            vec3 color = u_diffuseColor;                                                                                                                       
                            float emissiveFactor = 0.0;                                                  
                            ${e}
                               color = imageColor.rgb;                                                       
                                //环境光                           
                                material.roughness = u_roughness;                                                                
                                if(czm_lightIntensity > 0.6){                                                              
                                }else{   
                                  emissiveFactor = u_nightEmissiveFactor;   
                                  float colorCount = color.x + color.y + color.z;
                                  if(colorCount > 0.5){
                                    colorCount = colorCount*3.0;
                                  }else{
                                    colorCount = colorCount/20.0;
                                  }
                                  material.emissive = color * emissiveFactor * colorCount;  
                                  material.emissive = czm_srgbToLinear(material.emissive);                            
                                }                                                                                                                                            
                            //漫反射
                            material.diffuse = color;                             
                            material.diffuse = czm_srgbToLinear(material.diffuse);                                         
                     }                                           
                      `]}),(this.customShader.design=this).listener=this.viewer.scene.postUpdate.addEventListener(()=>{var e=(performance.now()-this.startTime)/(40100-2e3*this._speed);this.customShader.setUniform("u_time",e),1<e&&(this.startTime=performance.now())})}get translucencyMode(){return this.customShader.translucencyMode}set translucencyMode(e){this.customShader.translucencyMode=e}get nightEmissiveFactor(){return this.customShader.uniforms.u_nightEmissiveFactor.value}set nightEmissiveFactor(e){this.customShader.uniforms.u_nightEmissiveFactor.value=e}get diffuseColor(){return this.customShader.uniforms.u_diffuseColor.value}set diffuseColor(e){"string"==typeof e&&(e=Cesium.Color.fromCssColorString(e)),this.customShader.uniforms.u_diffuseColor.value!=e&&(this.customShader.uniforms.u_diffuseColor.value=e)}get roughness(){return this.customShader.uniforms.u_roughness.value}set roughness(e){this.customShader.uniforms.u_roughness.value!=e&&(this.customShader.uniforms.u_roughness.value=e)}get occlusion(){return this.customShader.uniforms.u_occlusion.value}set occlusion(e){this.customShader.uniforms.u_occlusion.value!=e&&(this.customShader.uniforms.u_occlusion.value=e)}get speed(){return this._speed}set speed(e){this._speed!=e&&(this._speed=e)}multipById(i,e){var r=i.length,n=e+.001;let o="vec4 imageColor;";for(let t=0;t<r;t++){var s=i[t].light;let e="";s&&"flow"===s.type?1===s.floodDirection?e+=`imageColor = texture(u_image${t+1}, vec2(st.s,st.t+u_time));`:2===s.floodDirection?e+=`imageColor = texture(u_image${t+1}, vec2(st.s,st.t-u_time));`:3===s.floodDirection?e+=`imageColor = texture(u_image${t+1}, vec2(st.s-u_time,st.t));
          // float blue= imageColor.b - u_time;
          // imageColor.b = max(0.1,blue);
          // float green = imageColor.g - u_time;
          // imageColor.g = max(0.1,green);
          `:4===s.floodDirection&&(e+=`imageColor = texture(u_image${t+1}, vec2(st.s+u_time,st.t));`):s&&"breathe"===s.type?e+=`
        imageColor = texture(u_image${t+1}, st);
        imageColor.xy *= max(0.2,u_time*2.0);
        `:e+=`imageColor = texture(u_image${t+1}, vec2(st.s,st.t));`,o+=` 
      if(featureId < ${n*(t+1)+1e-4} && featureId >=  ${n*t+1e-4}){
        ${e}      
    }`}return o}destroyed(){}};var Ee=class{constructor(e,t){this.viewer=e;let{diffuseColor:i=Cesium.Color.fromCssColorString("#ffffff"),divisionTextureNum:r=4,nomalStrength:n,divisionNum:o=100,diffTexture:s,normalTexture:a,translucencyMode:l=0}=t;"string"==typeof i&&(i=Cesium.Color.fromCssColorString(i));var e={},t=(e.u_image={type:Cesium.UniformType.SAMPLER_2D,value:new Cesium.TextureUniform(s)},e.u_normal_textrue={type:Cesium.UniformType.SAMPLER_2D,value:new Cesium.TextureUniform(a)},this.multipById(o,r)),u={u_diffuseColor:{type:Cesium.UniformType.VEC3,value:i},u_nomalStrength:{type:Cesium.UniformType.FLOAT,value:n}},u=Object.assign({},u,e);this.customShader=new Cesium.CustomShader({lightingModel:1,translucencyMode:l,uniforms:u,fragmentShaderText:[`           
                        //获取相机坐标系下的法线
                        vec3 getNormalEC(vec2 st, vec2 repeat, mat3 tangentToEyeMatrix, float nomalStrength,sampler2D nomalImage) {
                            vec4 textureValue = texture(nomalImage, vec2(fract(st.s * repeat.x), fract(st.t * repeat.y)));
                            vec3 normalTangentSpace = textureValue.xyz;
                            normalTangentSpace.xy = normalTangentSpace.xy * 2.0 - 1.0;
                            normalTangentSpace.z = clamp(1.0 - nomalStrength, 0.1, 1.0);
                            normalTangentSpace = normalize(normalTangentSpace);
                            vec3 normalEC = tangentToEyeMatrix * normalTangentSpace;
                            return normalEC;
                        }              
                        void fragmentMain(FragmentInput fsInput, inout czm_modelMaterial material) {
                         
                              float featureId = float(fsInput.featureIds.featureId_0);
                              vec2 st = fsInput.attributes.texCoord_0;
                              vec3 positionMC = fsInput.attributes.positionMC;             
                              vec3 positionEC = (czm_view3D * vec4(positionMC, 1.0)).xyz;
                              vec3 color = u_diffuseColor; 
                                                   
                              mat3 tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(positionMC, material.normalEC);
                                                                                                                              
                              ${t}
                                 color = imageColor.rgb;                                                                          
                                                                                                                                              
                              //漫反射
                              material.diffuse = color;                             
                              material.diffuse = czm_srgbToLinear(material.diffuse);                                         
                       }                                           
                        `]})}get translucencyMode(){return this.customShader.translucencyMode}set translucencyMode(e){this.customShader.translucencyMode=e}multipById(e,t){var i=t,r=e+.001;let n="vec4 imageColor;";var o=1/i;for(let e=0;e<i;e++)n+=` if(featureId < ${r*(e+1)+1e-4} && featureId >=  ${r*e+1e-4}){   
         float division = float(${o});
         vec2 xy=vec2(st.s * division+(float(${e})*division),st.t);
          imageColor = texture(u_image, xy);  
          vec3 normalECT = getNormalEC(xy, vec2(1.0,1.0), tangentToEyeMatrix, u_nomalStrength,u_normal_textrue);
          material.normalEC = normalECT;
      }`;return n}getDayType(){let e=0;var t=Cesium.JulianDate.toDate(this.viewer.clock.currentTime).getHours();return e=5<=t&&t<=18?1:e}destroyed(){}};var Be=class{constructor(e,t){this.viewer=e;let{diffuseColor:i=Cesium.Color.fromCssColorString("blue"),floodColor:r=Cesium.Color.fromCssColorString("green"),roughness:n=1,flowHeight:o,occlusion:s=1,hierarchicalLineWidth:a=.4,dividerLevelHeight:l=10,speed:u=5,bloom:c}=t;this._speed=u,c&&(this._bloomState=this.viewer.postProcessStages.bloom.enabled,this.bloomBrightness=c.brightness,this.bloomContrast=c.contrast,this.bloomSigma=c.sigma),"string"==typeof i&&(i=Cesium.Color.fromCssColorString(i)),"string"==typeof r&&(r=Cesium.Color.fromCssColorString(r)),this.customShader=new Cesium.CustomShader({lightingModel:1,translucencyMode:0,uniforms:{u_speed:{type:Cesium.UniformType.FLOAT,value:u},u_diffuseColor:{type:Cesium.UniformType.VEC3,value:i},u_floodColor:{type:Cesium.UniformType.VEC3,value:r},u_flowHeight:{type:Cesium.UniformType.FLOAT,value:o},u_hierarchicalLineWidth:{type:Cesium.UniformType.FLOAT,value:a},u_dividerLevelHeight:{type:Cesium.UniformType.FLOAT,value:l},u_roughness:{type:Cesium.UniformType.FLOAT,value:n},u_occlusion:{type:Cesium.UniformType.FLOAT,value:s}},fragmentShaderText:[`                
        void fragmentMain(FragmentInput fsInput, inout czm_modelMaterial material) {
          vec3 positionMC = fsInput.attributes.positionMC;
          vec3 color = u_diffuseColor;
          float emissiveFactor = czm_lightIntensity;
          float iTime = fract((czm_frameNumber / 1000.0)*u_speed);
          if(czm_lightIntensity < 0.6){
            emissiveFactor=1.0-emissiveFactor;
            color *= positionMC.z / (u_flowHeight) + color * 0.1;
          }else{
            color *= positionMC.z / (u_flowHeight) + color * 0.3;
          }
          float diff = step(u_hierarchicalLineWidth, mod(positionMC.z, u_dividerLevelHeight));
          color = color + color * (1.0 - diff);
      
          float floodDiff = step(0.005, abs(clamp(positionMC.z / u_flowHeight, 0.0, 1.0) - iTime));
          color += u_floodColor * (1.0 - floodDiff);
        
          material.diffuse = color;
          material.emissive = color * emissiveFactor;
          material.occlusion = u_occlusion;
          material.roughness = u_roughness;                       
          material.emissive = czm_srgbToLinear(material.emissive);
          material.diffuse = czm_srgbToLinear(material.diffuse);     
      }
       `]}),this.listener=this.viewer.scene.postUpdate.addEventListener(()=>{let e=this.viewer.scene.light.intensity;(e=1<e?1:e)<.6?this.bloom=!0:this.bloom=!1})}get diffuseColor(){return this.customShader.uniforms.u_diffuseColor.value}set diffuseColor(e){"string"==typeof e&&(e=Cesium.Color.fromCssColorString(e)),this.customShader.uniforms.u_diffuseColor.value!=e&&(this.customShader.uniforms.u_diffuseColor.value=e)}get floodColor(){return this.customShader.uniforms.u_floodColor.value}set floodColor(e){"string"==typeof e&&(e=Cesium.Color.fromCssColorString(e)),this.customShader.uniforms.u_floodColor.value!=e&&(this.customShader.uniforms.u_floodColor.value=e)}get roughness(){return this.customShader.uniforms.u_roughness.value}set roughness(e){this.customShader.uniforms.u_roughness.value!=e&&(this.customShader.uniforms.u_roughness.value=e)}get flowHeight(){return this.customShader.uniforms.u_flowHeight.value}set flowHeight(e){this.customShader.uniforms.u_flowHeight.value!=e&&(this.customShader.uniforms.u_flowHeight.value=e)}get occlusion(){return this.customShader.uniforms.u_occlusion.value}set occlusion(e){this.customShader.uniforms.u_occlusion.value!=e&&(this.customShader.uniforms.u_occlusion.value=e)}get hierarchicalLineWidth(){return this.customShader.uniforms.u_hierarchicalLineWidth.value}set hierarchicalLineWidth(e){this.customShader.uniforms.u_hierarchicalLineWidth.value!=e&&(this.customShader.uniforms.u_hierarchicalLineWidth.value=e)}get dividerLevelHeight(){return this.customShader.uniforms.u_dividerLevelHeight.value}set dividerLevelHeight(e){this.customShader.uniforms.u_dividerLevelHeight.value!=e&&(this.customShader.uniforms.u_dividerLevelHeight.value=e)}get speed(){return this.customShader.uniforms.u_speed.value}set speed(e){this.customShader.uniforms.u_speed.value!=e&&(this.customShader.uniforms.u_speed.value=e)}get bloom(){return this.viewer.postProcessStages.bloom.enabled}set bloom(e){this.viewer.postProcessStages.bloom.enabled!=e&&(this.viewer.postProcessStages.bloom.enabled=e)}get bloomBrightness(){return this.viewer.postProcessStages.bloom._uniforms.brightness}set bloomBrightness(e){this.viewer.postProcessStages.bloom._uniforms.brightness!=e&&(this.viewer.postProcessStages.bloom._uniforms.brightness=e)}get bloomContrast(){return this.viewer.postProcessStages.bloom._uniforms.contrast}set bloomContrast(e){this.viewer.postProcessStages.bloom._uniforms.contrast!=e&&(this.viewer.postProcessStages.bloom._uniforms.contrast=e)}get bloomSigma(){return this.viewer.postProcessStages.bloom._uniforms.sigma}set bloomSigma(e){this.viewer.postProcessStages.bloom._uniforms.sigma!=e&&(this.viewer.postProcessStages.bloom._uniforms.sigma=e)}destroyed(){this.listener&&this.listener(),this.bloom=this._bloomState}};var Me=class{constructor(e,t){this.viewer=e;let{diffuseColor:i=Cesium.Color.fromCssColorString("blue"),translucencyMode:r=!1,dividerLevelHeight:n,hierarchyColors:o,hierarchicalLineWidth:s}=t,a=("string"==typeof i&&(i=Cesium.Color.fromCssColorString(i)),[]);for(let e=0;e<o.length;e++)a=a.concat(o[e].toBytes());e=o.length;let l=""+1/e,u=(-1===l.indexOf(".")&&(l+=".0"),"1");-1===u.indexOf(".")&&(u+=".0");t=new Cesium.TextureUniform({typedArray:new Uint8Array(a),width:e,height:1,repeat:!1,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.UNSIGNED_BYTE});this.customShader=new Cesium.CustomShader({lightingModel:1,translucencyMode:r,uniforms:{u_hierarchyColors:{type:Cesium.UniformType.SAMPLER_2D,value:t},u_diffuseColor:{type:Cesium.UniformType.VEC3,value:i},u_dividerLevelHeight:{type:Cesium.UniformType.FLOAT,value:n},u_hierarchicalLineWidth:{type:Cesium.UniformType.FLOAT,value:s}},fragmentShaderText:[`     
                        vec3 getColor(vec3 position,vec3 color,float dividerLevelHeight) {                                                                            
                            for(int i = 0; i < ${o.length}; i++) {
                                float height = float(i + 1) * dividerLevelHeight;
                                if(position.z < height) {                                   
                                    int pixY = i / ${e};
                                    int pixX = i - (pixY * ${e});
                                    float u = (float(pixX) + 0.5) * (${l});
                                    float v = (float(pixY) + 0.5) * (${u});
                                     vec3 imageColor = texture(u_hierarchyColors, vec2(u,v)).xyz;                         
                                    color = imageColor;                                 
                                    return color;
                                }
                            }
                            return color;
                        }
                      //获取材质参数              
                       void fragmentMain(FragmentInput fsInput, inout czm_modelMaterial material) {
                      
                        vec2 st = fsInput.attributes.texCoord_0;
                        vec3 positionMC = fsInput.attributes.positionMC;             
                        vec3 positionEC = (czm_view3D * vec4(positionMC, 1.0)).xyz;
                        vec3 color = u_diffuseColor;                                                                                  
                        vec3 heightColor = getColor(positionMC,color,u_dividerLevelHeight);
                        if(heightColor != color) {
                            color = heightColor;
                        }
                        float diff = step(u_hierarchicalLineWidth, mod(positionMC.z, u_dividerLevelHeight));
                        if(diff == 0.0) {
                          color = u_diffuseColor;
                        }
                        // color  = color + color * (1.0 - diff);  
                        
                        material.diffuse = color;     
                        material.emissive = color * 0.2;                                                                                                                        
                       }    
      `]})}get diffuseColor(){return this.customShader.uniforms.u_diffuseColor.value}set diffuseColor(e){"string"==typeof e&&(e=Cesium.Color.fromCssColorString(e)),this.customShader.uniforms.u_diffuseColor.value!=e&&(this.customShader.uniforms.u_diffuseColor.value=e)}get hierarchicalLineWidth(){return this.customShader.uniforms.u_hierarchicalLineWidth.value}set hierarchicalLineWidth(e){this.customShader.uniforms.u_hierarchicalLineWidth.value!=e&&(this.customShader.uniforms.u_hierarchicalLineWidth.value=e)}get dividerLevelHeight(){return this.customShader.uniforms.u_dividerLevelHeight.value}set dividerLevelHeight(e){this.customShader.uniforms.u_dividerLevelHeight.value!=e&&(this.customShader.uniforms.u_dividerLevelHeight.value=e)}destroyed(){this.listener&&this.listener()}};var Ie=class{constructor(e,t){this.viewer=e;let{highlightColor:i=Cesium.Color.fromCssColorString("red"),limiHeight:r,addHeight:n=0}=t;"string"==typeof i&&(i=Cesium.Color.fromCssColorString(i)),this.customShader=new Cesium.CustomShader({lightingModel:1,translucencyMode:0,uniforms:{u_highlightColor:{type:Cesium.UniformType.VEC3,value:i},u_limiHeight:{type:Cesium.UniformType.FLOAT,value:r},u_addHeight:{type:Cesium.UniformType.FLOAT,value:n}},vertexShaderText:`
          void vertexMain(VertexInput vsInput, inout czm_modelVertexOutput vsOutput)
          {
              vec3 positionMC = vsOutput.positionMC;
              if(positionMC.z>0.0){
                positionMC.z += u_addHeight;    
              }              
              vsOutput.positionMC = positionMC;
          }`,fragmentShaderText:[`                
        void fragmentMain(FragmentInput fsInput, inout czm_modelMaterial material) {
          vec2 st = fsInput.attributes.texCoord_0;
          vec3 positionMC = fsInput.attributes.positionMC;
          vec3 positionEC = (czm_view3D * vec4(positionMC, 1.0)).xyz;
             
          vec3 color = material.diffuse;
          if(positionMC.z > u_limiHeight) {
              color = u_highlightColor;
          }     
          //漫反射
          material.diffuse = color;                     
      }                                          
      `]})}get highlightColor(){return this.customShader.uniforms.u_highlightColor.value}set highlightColor(e){"string"==typeof e&&(e=Cesium.Color.fromCssColorString(e)),this.customShader.uniforms.u_highlightColor.value!=e&&(this.customShader.uniforms.u_highlightColor.value=e)}get limiHeight(){return this.customShader.uniforms.u_limiHeight.value}set limiHeight(e){this.customShader.uniforms.u_limiHeight.value!=e&&(this.customShader.uniforms.u_limiHeight.value=e)}get addHeight(){return this.customShader.uniforms.u_addHeight.value}set addHeight(e){this.customShader.uniforms.u_addHeight.value+=e}destroyed(){this.listener&&this.listener()}};var Se=class{constructor(t){var i={},r=t.lights.length;i.u_ambientLightFactor={type:Cesium.UniformType.FLOAT,value:t.ambientLight.factor};for(let e=0;e<r;e++){var n=e+1;i["u_position_"+n]={type:Cesium.UniformType.VEC3,value:t.lights[e].position},i["u_color_"+n]={type:Cesium.UniformType.VEC3,value:t.lights[e].color},i["u_distance_"+n]={type:Cesium.UniformType.FLOAT,value:t.lights[e].distance}}this.customShader=new Cesium.CustomShader({lightingModel:1,translucencyMode:!1,uniforms:i,fragmentShaderText:[`       
        float czm_private_getLambertDiffuseOfMaterial(vec3 lightPositionWC, vec3 normal,vec3 positionEC,float lightDistance) {       
            vec3 lightPositionEC = (czm_view3D * vec4(lightPositionWC, 1.0)).xyz; 
            vec3 surfaceToLight = lightPositionEC - positionEC;
            float surfaceToLightDistance = length(surfaceToLight);                 
            vec3 lightDirectionEC = normalize(surfaceToLight);
            float diffuse = czm_getLambertDiffuse(lightDirectionEC, normal);
            float lightFactor = (lightDistance - surfaceToLightDistance)/lightDistance;
            lightFactor = max(lightFactor,0.0);
            diffuse *=lightFactor;
            return diffuse;
        }   
         
            void fragmentMain(FragmentInput fsInput, inout czm_modelMaterial material) {
              vec2 st = fsInput.attributes.texCoord_0;
              vec3 positionMC = fsInput.attributes.positionMC;
              vec3 positionEC = fsInput.attributes.positionEC;;
              vec3 normal = material.normalEC;                                                                 
              ${this.getLightShaderFs(r)}
              float lightFactor = 1.0;
              //夜晚时候
              if(czm_lightIntensity < 0.6){ 
                lightFactor = u_ambientLightFactor;                                                            
              }
              vec3 ambientColor =  material.diffuse * lightFactor;       
              vec3 color = lightColor;
              material.diffuse = color + ambientColor;
              material.emissive = color;
          }                                          
            `]})}getLightShaderFs(t){let i="vec3 lightColor = vec3(0.0,0.0,0.0);";for(let e=1;e<t+1;e++)i=(i=(i+=` float diffuse${e} = czm_private_getLambertDiffuseOfMaterial(u_position_${e},normal,positionEC,u_distance_${e});`)+` vec3 diffuseColor${e} = u_color_${e} * diffuse${e};`)+`lightColor+=diffuseColor${e};`;return i}destroyed(){}};var Pe=class{constructor(e={}){this.type=Cesium.defaultValue(e.type,"AgFlowWater"),this.waterTexture=Cesium.defaultValue(e.waterTexture,Cesium.Material.DefaultImageId),this.normalMap=Cesium.defaultValue(e.normalMap,Cesium.Material.DefaultImageId),this.baseWaterColor=Cesium.defaultValue(e.baseWaterColor,new Cesium.Color(.2,.3,.6,1)),this.blendColor=Cesium.defaultValue(e.blendColor,new Cesium.Color(0,1,.699,1)),this.frequency=Cesium.defaultValue(e.frequency,10),this.animationSpeed=Cesium.defaultValue(e.animationSpeed,.01),this.amplitude=Cesium.defaultValue(e.amplitude,1),this.specularIntensity=Cesium.defaultValue(e.specularIntensity,.5),this.fadeFactor=Cesium.defaultValue(e.fadeFactor,1),this.flowdirection=Cesium.defaultValue(e.flowdirection,5),this.waterHeight=Cesium.defaultValue(e.waterHeight,3),this.reflectIndesity=Cesium.defaultValue(e.reflectIndesity,.9),Cesium.Material._materialCache.addMaterial(this.type,{fabric:{type:this.type,uniforms:{normalMap:this.normalMap,waterTexture:this.waterTexture,baseWaterColor:this.baseWaterColor,blendColor:this.blendColor,frequency:this.frequency,animationSpeed:this.animationSpeed,amplitude:this.amplitude,specularIntensity:this.specularIntensity,fadeFactor:this.fadeFactor,flowdirection:this.flowdirection,waterHeight:this.waterHeight,reflectIndesity:this.reflectIndesity},source:`
uniform sampler2D normalMap;
uniform vec4 baseWaterColor;
uniform vec4 blendColor;
uniform float frequency;
uniform float animationSpeed;
uniform float amplitude;
uniform float specularIntensity;
uniform float fadeFactor; //衰减因子
uniform float flowdirection; //水流方向
uniform float reflectIndesity;  

vec4 getBaseWaterColor(){
    return baseWaterColor;
} 
float private_getSpecularOfMaterial(vec3 lightDirectionEC, vec3 toEyeEC, vec3 normalEC, float shininess) {
    //return czm_getSpecular(lightDirectionEC, toEyeEC, normal, shininess);
    vec3 toReflectedLight = reflect(-lightDirectionEC, normalEC);
    float specular = max(dot(toReflectedLight, toEyeEC), 0.000000001);
    // pow has undefined behavior if both parameters <= 0.
    // Prevent this by making sure shininess is at least czm_epsilon2.
    return pow(specular, shininess);
}
czm_material czm_getMaterial(czm_materialInput materialInput) {
    czm_material material = czm_getDefaultMaterial(materialInput); //获取默认的材质

    float time = czm_frameNumber * animationSpeed; // 动画的时间频率/ 10000.0

    // fade is a function of the distance from the fragment and the frequency of the waves  衰减是片元和水波频率之间的距离的函数
    float fade = max(1.0, (length(materialInput.positionToEyeEC) / 10000000000.0) * frequency * fadeFactor);

    //float specularMapValue = texture(specularMap, materialInput.st).r;
    //计算高光
    float specularMapValue = private_getSpecularOfMaterial(czm_sunDirectionEC, materialInput.positionToEyeEC, materialInput.normalEC, 0.0001);
    //specularMapValue = min(specularMapValue, 0.8);
    //specularMapValue = fract((specularMapValue ));
    vec2 st = materialInput.st;
    // note: not using directional motion at this time, just set the angle to 0.0;
    // vec4 noise = czm_getWaterNoise(normalMap, materialInput.st * frequency, time, 0.0);
    //设置流向
    vec4 noise;
    if(flowdirection == 0.0) {
        noise = czm_getWaterNoise(normalMap, vec2(fract((st.s - time)), st.t) * frequency, time, 0.0);
    } else if(flowdirection == 1.0) {
        noise = czm_getWaterNoise(normalMap, -vec2(fract((st.s + time)), st.t) * frequency, time, 0.0);
    } else if(flowdirection == 2.0) {
        noise = czm_getWaterNoise(normalMap, vec2(st.s, fract((st.t - time))) * frequency, time, 0.0);
    } else if(flowdirection == 3.0) {
        noise = czm_getWaterNoise(normalMap, -vec2(st.s, fract((st.t + time))) * frequency, time, 0.0);
    } else {
        noise = czm_getWaterNoise(normalMap, vec2(fract(st.s * 10.0), fract(st.t * 1.0)) * frequency, time, 0.0);
    }

    //z方向上的动态振动
    vec3 normalTangentSpace = noise.xyz * vec3(1.0, 1.0, (1.0 / amplitude )); 
    // 当我们离水面越远时，减弱正常的扰动
    // fade out the normal perturbation as we move further from the water surface
    normalTangentSpace.xy /= fade;

    // attempt to fade out the normal perturbation as we approach non water areas (low specular map value)
    // 当我们接近非水域时，尝试淡出正常扰动（低镜面反射贴图值）
    normalTangentSpace = mix(vec3(0.0, 0.0, 10.0), normalTangentSpace, specularMapValue);
    //单位化
    normalTangentSpace = normalize(normalTangentSpace);
    // 获取新法向量与垂直于切平面的向量对齐的比率
    // get ratios for alignment of the new normal vector with a vector perpendicular to the tangent plane
    float tsPerturbationRatio = clamp(dot(normalTangentSpace, vec3(0.0, 0.0, 1.0)), 0.0, 1.0);

    // fade out water effect as specular map value decreases
    material.alpha = mix(blendColor.a, baseWaterColor.a, specularMapValue) * specularMapValue;

    // base color is a blend of the water and non-water color based on the value from the specular map
    // may need a uniform blend factor to better control this
    material.diffuse = mix(blendColor.rgb, baseWaterColor.rgb, specularMapValue);

    //diffuse highlights are based on how perturbed the normal is
    material.diffuse += (0.1 * tsPerturbationRatio);

    material.diffuse =  material.diffuse;
    //变回相机坐标系下的法向量
    material.normal = normalize(materialInput.tangentToEyeMatrix * normalTangentSpace);

    material.specular = specularIntensity;
    material.shininess = 20.0;
    // material.emission = vec3(0.5);
    return material;
}
`},translucent:e=>{e=e.uniforms;return e.baseWaterColor.alpha<1||e.blendColor.alpha<1}}),this.material=Cesium.Material.fromType(this.type)}};class Te{constructor(e){this._viewer=e.viewer,this._waterPolygon=e.waterPolygon,this._reflectView=void 0,this._skyView=void 0,this._reflectListener=void 0,this._options=e.options,this.enable=!1}closelayerIdsStartOnReflection(e){e instanceof Array&&0!==e.length&&e.forEach(e=>{CIM.layerTree.layerTreeDom.setLayerCheck(e,!1)})}showLayersEndOnReflection(e){e instanceof Array&&0!==e.length&&e.forEach(e=>{CIM.layerTree.layerTreeDom.setLayerCheck(e,!0)})}createView(e,t){var i=new Cesium.BoundingRectangle(0,0,e.context.drawingBufferWidth,e.context.drawingBufferHeight),r=new Cesium.View(e,t,i);return r.sceneFramebuffer.begin=function(){return r.sceneFramebuffer.clear(e.context,r.passState,Cesium.Color.TRANSPARENT),r.sceneFramebuffer.update(e.context,i,e.highDynamicRange),r.passState.framebuffer=r.sceneFramebuffer.getFramebuffer(),r.passState},r}getUniformMapByName(e,t){for(var i in e)if(0===i.indexOf(t))return i;return t}getWaterHeightAndWidth(e){if(e&&e instanceof Array&&0!==e.length){let t=[],i=[];e.forEach(e=>{e=Cesium.Cartographic.fromCartesian(e);t.push(Cesium.Math.toDegrees(e.longitude)),i.push(Cesium.Math.toDegrees(e.latitude))}),t.sort((e,t)=>e-t),i.sort((e,t)=>e-t);var e=t[0],r=t[t.length-1],n=i[0];return{WaterHeight:i[i.length-1]-n,WaterWidth:r-e}}}getBoxCoord(e){let t=[],i=[];e.forEach(e=>{e=Cesium.Cartographic.fromCartesian(e);t.push(Cesium.Math.toDegrees(e.longitude)),i.push(Cesium.Math.toDegrees(e.latitude))}),t.sort((e,t)=>e-t),i.sort((e,t)=>e-t);var e=t[0],r=t[t.length-1],n=i[0],o=i[i.length-1],s=[];return s.push(Cesium.Cartesian3.fromDegrees(e,n)),s.push(Cesium.Cartesian3.fromDegrees(e,o)),s.push(Cesium.Cartesian3.fromDegrees(r,o)),s.push(Cesium.Cartesian3.fromDegrees(r,n)),s}getBoxRectangle(e){let t=[],i=[];e.forEach(e=>{e=Cesium.Cartographic.fromCartesian(e);t.push(e.longitude),i.push(e.latitude)}),t.sort((e,t)=>e-t),i.sort((e,t)=>e-t);var e=t[0],r=t[t.length-1],n=i[0],o=i[i.length-1];return new Cesium.Rectangle(e,n,r,o)}stopReflectionByBoundingSphere(e,t){e.camera.distanceToBoundingSphere(t)>+t.radius||(e.frameState.cullingVolume.computeVisibility(t),Cesium.Intersect.OUTSIDE)}IsBeyondOBBMaxDistance(e,t){let i=!1;var r=CIM.viewer.scene.camera.position,e=Cesium.OrientedBoundingBox.distanceSquaredTo(e,r),r=Math.sqrt(e);return i=t<r?!0:i}addReflection(e){if(this._waterPolygon){for(var{WaterHeight:i,WaterWidth:r}=this.getWaterHeightAndWidth(e),n=this._waterPolygon.appearance,o=n.material,s=this._viewer.scene,a=this.getBoxCoord(e),e=this.getBoxRectangle(e),l=(Cesium.OrientedBoundingBox.fromRectangle(e,0,3e3),a.length),u=new Cesium.Cartesian3(0,0,0),c=0;c<l;++c)u.x+=a[c].x,u.y+=a[c].y,u.z+=a[c].z;u.x/=l,u.y/=l,u.z/=l;var h=Cesium.BoundingSphere.fromPoints(a),e=Cesium.Cartesian3.normalize(u,new Cesium.Cartesian3),A=new Cesium.Camera(s),p=(A.frustum.far=s.camera.frustum.far,A.frustum.near=.1,A.frustum.fov=s.camera.frustum.fov,this._reflectView=this.createView(s,A),this._skyView=this.createView(s,A),new Cesium.Cesium3DTilePassState({pass:Cesium.Cesium3DTilePass.PICK})),f=new Cesium.Plane(Cesium.Cartesian3.UNIT_Z,0),d=(Cesium.Plane.fromPointNormal(u,e,f),new Cesium.Matrix4(-2*f.normal.x*f.normal.x+1,-2*f.normal.x*f.normal.y,-2*f.normal.x*f.normal.z,-2*f.normal.x*f.distance,-2*f.normal.y*f.normal.x,-2*f.normal.y*f.normal.y+1,-2*f.normal.y*f.normal.z,-2*f.normal.y*f.distance,-2*f.normal.z*f.normal.x,-2*f.normal.z*f.normal.y,-2*f.normal.z*f.normal.z+1,-2*f.normal.z*f.distance,0,0,0,1));let t={_uniforms:n.material._uniforms,appearance:n,camera:A,reflection_Matrix4:d,WaterHeight:i,WaterWidth:r,_material:o,_reflectTexture:this._reflectTexture,dayBaseWaterColor:this._options.dayBaseWaterColor,nightBaseWaterColor:this._options.nightBaseWaterColor,morning:this._options.morning,night:this._options.night,reflectIndesity:this._options.reflectIndesity,baseWaterColor:this._options.baseWaterColor,dayReflectIndesity:this._options.dayReflectIndesity,nightReflectIndesity:this._options.nightReflectIndesity,distortion:this._options.distortion,foamIntensity:this._options.foamIntensity};this._reflectListener=this._reflectListener&&this._reflectListener(),this._reflectListener=s.postUpdate.addEventListener(e=>{this._options.baseWaterColor=6<=this._options.morning&&this._options.night<=19?this._options.dayBaseWaterColor:this._options.nightBaseWaterColor,e._defaultView!==this._reflectView&&e._defaultView===e.view&&(Cesium.defined(this._reflectTexture)&&this.stopReflectionByBoundingSphere(e,h),this._reflectView.viewport.width===e.context.drawingBufferWidth&&this._reflectView.viewport.height===e.context.drawingBufferHeight||((A=new Cesium.Camera(e)).frustum.far=e.camera.frustum.far,A.frustum.near=.1,A.frustum.fov=e.camera.frustum.fov,this._reflectView=this.createView(e,A),this._reflectView.destroy(),this._skyView=this.createView(e,A),this._skyView.destroy()),A=this.setReflectCameraView(e,d,A),this._reflectView=this.createView(e,A),this._skyView=this.createView(e,A),t.camera=A,this.closelayerIdsStartOnReflection(this._options.layerIds),this.startBuildingSceneFrameBufferTexture(this._waterPolygon,e,A,p),t._reflectTexture=this._reflectTexture,this.showLayersEndOnReflection(this._options.layerIds))}),this.replaceShader(t)}}startBuildingSceneFrameBufferTexture(e,t,i,r){var n,o=t.globe.show,s=(t.globe.show=!1,e&&(e.show=!1),t._hdr),a=t.skyAtmosphere.show,l=t.sun.show,u=t.skyBox.show;t.skyAtmosphere.show=!1,t._hdr=!1,t.skyBox.show=!1,t.sun.show=!1,t.view=this._reflectView,this._reflectView&&this._reflectView.sceneFramebuffer&&this._reflectView.sceneFramebuffer.begin&&(n=this._reflectView.sceneFramebuffer.begin(),t.jobScheduler.disableThisFrame(),t.updateFrameState(),t.frameState.invertClassification=!1,t.frameState.passes.render=!0,t.frameState.passes.pick=!1,t.frameState.passes.offscreen=!0,t.frameState.tilesetPassState=r,t.frameState.camera=i,t.frameState.cullingVolume=i.frustum.computeCullingVolume(i.positionWC,i.directionWC,i.upWC),t.context.uniformState.update(t.frameState),t.updateEnvironment(),r=Cesium.Color.fromCssColorString(this._options.baseWaterColor),t.updateAndExecuteCommands(n,r),t.resolveFramebuffers(n),t.view=t.defaultView,t.frameState.frameNumber=Cesium.Math.incrementWrap(t.frameState.frameNumber,15e6,1),t.context.endFrame(),t.globe.show=o,e&&(e.show=!0),t._hdr=s,t.skyAtmosphere.show=a,t.skyBox.show=u,t.sun.show=l,this._reflectView.sceneFramebuffer._colorTexture?this._reflectTexture=this._reflectView.sceneFramebuffer._colorTexture:this._reflectTexture=this._reflectView.sceneFramebuffer._colorFramebuffer._colorTextures[0])}replaceShader(e){var t=this.getUniformMapByName(e._uniforms,"animationSpeed"),i=this.getUniformMapByName(e._uniforms,"normalMap"),r=this.getUniformMapByName(e._uniforms,"frequency"),n=this.getUniformMapByName(e._uniforms,"amplitude"),o=(this.getUniformMapByName(e._uniforms,"fadeFactor"),this.getUniformMapByName(e._uniforms,"fadeFactor")),s=this.getUniformMapByName(e._uniforms,"flowdirection"),a=Cesium.ShaderSource.replaceMain(e.appearance._vertexShaderSource,"czm_water_main"),a=(e.appearance._vertexShaderSource=a+"\n"+` 
            uniform mat4 rttProjectionMatrix;       
            uniform mat4 rttViewMatrix;       
            uniform mat4 reflectMatrix;   
            out vec4 v_uv1;           
           
            void main()       
            {       
                    czm_water_main();          
                    mat4 modelView = rttViewMatrix * reflectMatrix * czm_model;   // 视图变换矩阵 * 反射矩阵 * 世界坐标变换矩阵
                    modelView[3][0] = 0.0;           
                    modelView[3][1] = 0.0;           
                    modelView[3][2] = 0.0;
                    v_uv1 = rttProjectionMatrix * modelView * czm_computePosition(); //  投影矩阵 * 视图和世界变换矩阵 * 世界坐标 
            }   `,Cesium.ShaderSource.replaceMain(e.appearance._fragmentShaderSource,"czm_water_main")),a=(e.appearance._fragmentShaderSource=a+"\n"+`   
                uniform sampler2D rt_texture; 
                uniform float _distortion; 
                uniform float _foamIntensity; 
                uniform float WaterWidth; 
                uniform float WaterHeight; 
                uniform float _reflectIndesity; 
                uniform float _nightReflectIndesity; 
                uniform float _dayReflectIndesity; 
                uniform float _morning; 
                uniform float _night; 
                uniform vec4 _baseWaterColor; 
                uniform vec4 _dayBaseWaterColor; 
                uniform vec4 _nightBaseWaterColor; 

                in vec4 v_uv1;
                const float specularReflectivity = 0.6;
                const float minBlueness = 0.5;
                const float fresnelReflective = 2.0;
                const vec2 lightBias = vec2(0.3, 0.8);
                const vec3 lightColour = vec3(1.0, 0.95, 0.95);

                const vec3 lightColor = vec3(1.0, 1.0, 1.0);
                // const vec3 lightColor = vec3(37.0,66.0,124.0)/256.0;
                const float shineDamper = 20.0;
                const float reflectivity = 0.4;
                float time1 = 0.0;

                vec3 _BaseWaterColor = (vec3(22.,79.,86.)/255.);
                // vec3 _BaseWaterColor = (vec3(0, 0.3, 0.5));
                vec3 _LightWaterColor= (vec3(0.,214.,10.)/255.);

                
                //计算光源的高光,只能算是水面的散射
                vec3 calcSpecularLighting(vec3 toCameraVector, vec3 toLightVector, vec3 normal){
                    vec3 halfVector = normalize(normalize(toCameraVector) + normalize(toLightVector));
                    float specular = max(dot(halfVector, normal), 0.0);
                    specular = pow(specular, shineDamper);
                    //这里的高光没有混合物体的颜色
                    vec3 specularHighlight = lightColor * specular * reflectivity; // mix(lightColor,vec3(0.1,0.1,0.1),0.5)
                    return specularHighlight;
                }
                //计算高光值
                float calcSpecularValue(vec3 toCameraVector, vec3 toLightVector, vec3 normal){
                    vec3 halfVector = normalize(normalize(toCameraVector) + normalize(toLightVector));
                    float specular = max(dot(halfVector, normal), 0.0);
                    specular = pow(specular, shineDamper);
                    return specular;
                }
                //计算光源的反射颜色
                vec3 calculateDiffuseLighting(vec3 toLightVector, vec3 normal){
                    float brightness = max(dot(toLightVector, normal), 0.0);
                    return lightColour * brightness ;//(lightColour * lightBias.x) + (brightness * lightColour * lightBias.y);
                }
                //获取环境光
                vec3 getAmbient(vec3 objectColor){
                    float ambientStrength = 0.2;
                    vec3 ambient = ambientStrength * lightColour;
                    vec3 result = ambient * objectColor;
                    return result;
                }
                //计算漫反射光照颜色
                vec3 getLightDiffuse(vec3 waterColor,vec3 lightDir,vec3 normal){
                    float diffuse = max(dot(normal, lightDir), 0.0);
                    vec3 materialDiffuse = waterColor * 1.0 * lightColour; //材质本身的颜色 * 因子 * 光照颜色
                    vec3 diffuse1 = materialDiffuse * diffuse * lightColour; //散射的颜色 = 材质的颜色 * 散射因子 * 光的颜色
                    // vec3 diffuse1 = diffuse * lightColour; //散射的颜色 = 材质的颜色 * 散射因子 * 光的颜色
                    return diffuse1;
                }
                //计算高光，镜面光照
                vec3 getSpecular(vec3 viewDir,vec3 reflectDir){
                    float specularStrength = 0.6;
                    float spec = max(dot(viewDir, reflectDir), 0.0);
                    spec = pow(spec, 32.0);
                    vec3 specular = specularStrength * spec * lightColour;
                    return specular;
                }
                //半反射的高光
                vec3 getBlinnPhongSpecular(vec3 normal,vec3 viewDir,vec3 lightDir){
                    // float specularStrength = 1.0;
                    vec3 halfwayDir = normalize(lightDir + viewDir);
                    float spec = pow(max(dot(normal, halfwayDir), 0.0), 128.0);
                    vec3 specular = spec * lightColor;
                    return specular;
                }
                //计算菲涅尔反射因子
                // float calculateFresnel(vec3 pass_toCameraVector,vec3 pass_normal){
                //     vec3 viewVector = normalize(pass_toCameraVector);
                //     vec3 normal = normalize(pass_normal);
                //     // float refractiveFactor = dot(viewVector, normal);
                //     float refractiveFactor = pow(max(dot(normal, viewVector), 0.0), fresnelReflective);
                //     // refractiveFactor = pow(refractiveFactor, fresnelReflective);
                //     // return clamp(refractiveFactor, 0.0, 1.0);
                //     return refractiveFactor;
                // }
                float calculateFresnel(vec3 eyeDirection,vec3 surfaceNormal){
                    float theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );
					   float rf0 = 0.02;
					   float reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0);
                    return reflectance;
                }
                //反射高光
                vec3 getNewSpecular(vec3 normal,vec3 viewDir,vec3 lightDir){
                    float specularStrength = 0.5;
                    vec3 reflectDir = reflect(-lightDir, normal);
                    float spec = pow(max(dot(viewDir, reflectDir), 0.0), 128.0);
                    vec3 specular = specularStrength * spec * lightColor;
                    return specular;
                }
                
                //生成泡沫
                //泡沫强度转泡沫颜色
                vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod) {
                    return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) + 50. * pow(foamPixelIntensity, 23.0)) * dayMod;
                }
                //法向量转泡沫强度
                float normals2FoamIntensity(vec3 n, float waveStrength){
                    float normalizationFactor =  max(0.015, waveStrength);
                    return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
                }

                void sunLight(  vec3 surfaceNormal,  vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {
                    vec3 reflection = normalize( reflect( -czm_lightDirectionEC, surfaceNormal ) );
                    float direction = max( 0.0, dot( eyeDirection, reflection ) );
                    specularColor += pow( direction, shiny ) * lightColor * spec; //高光颜色
                    diffuseColor += max( dot( czm_lightDirectionEC, surfaceNormal ), 0.0 ) * lightColor * diffuse;
                }
            
                //对于获取噪声要获取-1,1之间
                vec4 _czm_getWaterNoise(sampler2D normalMap,  vec2 uv, float time, float angleInRadians)
                {
                    float cosAngle = cos(angleInRadians) ;
                    float sinAngle = sin(angleInRadians) ;

                    // time dependent sampling directions
                    vec2 s0 = vec2(1.0/17.0, 0.0); //从右到左流向
                    vec2 s1 = vec2(-1.0/29.0, 0.0); //从左到右流向
                    vec2 s2 = vec2(1.0/101.0, 1.0/59.0); //从右上角到左下角流向
                    vec2 s3 = vec2(-1.0/109.0, -1.0/57.0); //从左下角到右上角流向

                    // rotate sampling direction by specified angle  旋转角度
                    s0 = vec2((cosAngle * s0.x) - (sinAngle * s0.y), (sinAngle * s0.x) + (cosAngle * s0.y)); 
                    s1 = vec2((cosAngle * s1.x) - (sinAngle * s1.y), (sinAngle * s1.x) + (cosAngle * s1.y));
                    s2 = vec2((cosAngle * s2.x) - (sinAngle * s2.y), (sinAngle * s2.x) + (cosAngle * s2.y));
                    s3 = vec2((cosAngle * s3.x) - (sinAngle * s3.y), (sinAngle * s3.x) + (cosAngle * s3.y));

                    vec2 uv0 = (uv/103.0) + (time * s0);
                    vec2 uv1 = uv/107.0 + (time * s1) + vec2(0.23);
                    vec2 uv2 = uv/vec2(897.0, 983.0) + (time * s2) + vec2(0.51);
                    vec2 uv3 = uv/vec2(991.0, 877.0) + (time * s3) + vec2(0.71);

                    // uv = fract(uv + cosAngle * time); (texture(normalMap, uv))+
                    uv0 = fract(uv0);
                    uv1 = fract(uv1);
                    uv2 = fract(uv2);
                    uv3 = fract(uv3);
                    vec4 noise = 
                                (texture(normalMap, uv0)) +
                                (texture(normalMap, uv1)) +
                                (texture(normalMap, uv2)) +
                                (texture(normalMap, uv3));

                    // average and scale to between -1 and 1
                    return ((noise / 4.0) - 0.5) * 2.0;
                }

                vec4 getFromLeftToRightFlow(sampler2D normalMap,  vec2 uv, float time, float angleInRadians){
                    float cosAngle = cos(angleInRadians * time) ;
                    float sinAngle = sin(angleInRadians * time) ;
                    vec2 s1 = vec2(-1.0/29.0, 0.0); //从左到右流向
                    s1 = vec2((cosAngle * s1.x) - (sinAngle * s1.y), (sinAngle * s1.x) + (cosAngle * s1.y));
                    vec2 uv1 = uv/107.0 + (time * s1) + vec2(0.23);
                    uv1 = fract(uv1);
                    vec4 noise = (texture(normalMap, uv1));
                    return noise; //rgba 是从 0 到 1的，跟uv坐标值从0到1一样
                }
                void main()       
                {       
                        czm_water_main();

                        //动画时间
                        float time = czm_frameNumber * ${t};
                        //片元到相机的向量
                        vec3 fragToCameraVector = (czm_view * vec4(czm_viewerPositionWC,1.0)).xyz - v_positionEC.xyz;
                        float distance = length(fragToCameraVector);
                        //单位化方向，片元到相机的方向向量
                        vec3 viewDir = normalize(fragToCameraVector);
                        
                        //反射贴图强弱
                        float _reflectVisibleBydistance = clamp((6000.0 - czm_eyeHeight)/6000.0,0.0,1.0);
                        float _reflectVisibleByEyeHeight = clamp((6000.0 - czm_eyeHeight)/6000.0,0.5,1.0);

                        float _reflectVisibleBydistance1 = clamp((6000.0 - distance)/6000.0,0.0,1.0);

                        vec2 st;
                        //法线贴图动画uv //重复采样贴图
                        if(WaterWidth/WaterHeight > 1.0){
                            st = vec2(fract(v_st.s * floor(WaterWidth/WaterHeight)), fract(v_st.t * 1.0));
                        }else{
                            st = vec2(fract(v_st.s * 1.0), fract(v_st.t * floor(WaterHeight/WaterWidth)));
                        }
                        
                        vec2 _st = st;
                        //东：0.0,南：1.0,西：2.0,北：3.0;
                        //  st = vec2(fract((st.s - time/1000.0)), st.t);
                        if(${s} == 0.0) {
                            st = vec2(fract((st.s - time/1000.0)), st.t);
                        } else if(${s} == 1.0) {
                            st = vec2(st.s, fract((st.t-time/1000.0)));
                        } else if(${s} == 2.0) {
                            st = vec2(fract((st.s + time/1000.0)), st.t);
                        } else if(${s} == 3.0) {
                            st = vec2(st.s, fract((st.t+time/1000.0)));
                        } 

                        //菲涅尔反射的颜色
                        //从顶点传来的在反射坐标系下的uv坐标
                        vec2 coord = (v_uv1.xy / v_uv1.w) * 0.5 + 0.5; 
                        if(coord.x < 0.0 || coord.x > 1.0) {             
                            return;           
                        } else if(coord.y < 0.0 || coord.y > 1.0) {
                            return;           
                        }  
                        vec2 staticCoord = coord;
                        //获取扰动坐标的变化量
                        vec4 noise = _czm_getWaterNoise(${i}  , st  * ${r} / 10.0 , time, 0.0) * 0.5 + 0.5;  //* _reflectVisibleByEyeHeight/10.0 /10.0
                        noise *=_reflectVisibleByEyeHeight * _reflectVisibleBydistance1;
                        vec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );
                        vec4 _flow = _czm_getWaterNoise(${i}  , st  * ${r} , time, 0.0) * 0.5 + 0.5;  // * _reflectVisibleByEyeHeight 
                        vec3 distortion3 = surfaceNormal.xyz * ( 0.001 + 1.0 / distance ) * 5.0;
                        // _flow.xyz += (distortion3 * _reflectVisibleByEyeHeight * _reflectVisibleBydistance1);

                        _flow.xyz *= _reflectVisibleByEyeHeight * _reflectVisibleBydistance1 * _distortion;

                        //菲涅尔反射因子
                        // float fresnelFactor = calculateFresnel(viewDir,normalize(_flow.xyz));
                        float fresnelFactor = calculateFresnel(viewDir,normalize(materialInput.normalEC));
                        // float fresnelFactor = (fresnelFactor1*0.8+fresnelFactor2*0.2);
                        // float fresnelFactor = 0.6 + 0.98 * pow(1.0 - dot(normalize(_flow.xyz), viewDir), 5.0);

                        //将扰动坐标的变化量加到原来的uv坐标上
                        coord.xy += noise.xy * 0.01 * _reflectVisibleByEyeHeight * _reflectVisibleBydistance1 * _distortion;
                        
                        //改进建筑倒影扰动
                        // vec2 distortion = surfaceNormal.xz * ( 0.01 + 1.0 / distance ) * 5.0;
                        // vec3 reflectionSample = vec3(texture( rt_texture, coord + distortion)); //反射采样
    
                        // coord.xy += (distortion * _reflectVisibleByEyeHeight * _reflectVisibleBydistance1);
                        //基本颜色
                        vec4 baseWaterColor = _baseWaterColor;
                        //采样反射建筑贴图的颜色
                        vec4 reflectColour = texture(rt_texture, coord); 
                        // out_FragColor = reflectColour;
                        // return;

                        
                        //采样反射天空盒贴图的颜色
                        //相机到片元的向量
                        vec3 camera2FragVector =  v_positionEC.xyz - (czm_view * vec4(czm_viewerPositionWC,1.0)).xyz;
                        //单位化方向，片元到相机的方向向量
                        vec3 camera2FragVectorNormalized = normalize(camera2FragVector);
                        vec3 reflectVector = reflect(camera2FragVectorNormalized, normalize(materialInput.normalEC));
                        vec4 reflectSkyColour = texture(czm_environmentMap, reflectVector);

                        // out_FragColor = reflectSkyColour;
                        float reflectIndesity = _reflectIndesity;
                    
                        if(czm_globeTime.x>_morning && czm_globeTime.x<_night){
                            reflectIndesity = _dayReflectIndesity;
                            baseWaterColor = _dayBaseWaterColor;
                        }else{
                            reflectIndesity = _nightReflectIndesity;
                            baseWaterColor = _nightBaseWaterColor;
                        }
                    
                        //6000米内才有水波纹的效果
                        if(_reflectVisibleBydistance<=0.0){
                            out_FragColor = baseWaterColor;
                            out_FragColor.xyz *= reflectIndesity;

                        }else{
                            baseWaterColor.xyz *= reflectIndesity;
                            reflectSkyColour.xyz *=  reflectIndesity;
                            reflectColour.xyz *= reflectIndesity;

                            vec3 diffuseLight = vec3(0.0);
                            vec3 specularLight = vec3(0.0);
                            vec3 sunColor = vec3(1.0);
                            vec3 waterColor = baseWaterColor.xyz;//vec3(0.0,30.0/256.0,15.0/256.0);
                            sunLight(_flow.xyz, viewDir, 100.0, 2.0, 0.5, diffuseLight, specularLight);

                            vec3 scatter = max(0.0, dot(_flow.xyz, viewDir)) * waterColor; //水的颜色深浅
                            vec3 mask = (sunColor * diffuseLight * 0.3 + scatter);//mask
                            vec3 reflectionSampleMix =  vec3( 0.1 ) + reflectColour.xyz * 0.9 + reflectColour.xyz * specularLight;//reflection
                            vec3 albedo = mix(mask,reflectionSampleMix,fresnelFactor);
                            // out_FragColor.xyz = albedo;
                            //菲涅尔混合
                            //vec4 waterAndSkyColor = vec4(baseWaterColor.xyz * 0.95 + reflectSkyColour.xyz * 0.05,1.0); //reflectSkyColour; // mix(reflectSkyColour,baseWaterColor,fresnelFactor) ;//
                            //常规混合
                            // fresnelFactor = clamp((1.0 - fresnelFactor)/fresnelFactor,0.0,1.0);
                            vec4 waterAndSkyColor =  mix(baseWaterColor  , reflectSkyColour ,fresnelFactor); //reflectSkyColour;
                            out_FragColor = waterAndSkyColor;
                            vec3 whiteColor;
                            if(czm_globeTime.x>_morning && czm_globeTime.x<_night){
                                if(reflectColour.r > 0.0){
                                    // whiteColor = vec3(0.3,0.4,0.4);
                                    // whiteColor*=reflectIndesity;
                                    // reflectColour.xyz = mix(whiteColor,reflectColour.xyz,0.5);
                                    // out_FragColor.xyz =   mix(reflectColour.xyz,baseWaterColor.xyz,fresnelFactor);//reflectColour.xyz*0.5 + out_FragColor.xyz*0.5;//
                                    // out_FragColor.xyz = mix(reflectColour.xyz,waterAndSkyColor.xyz,fresnelFactor);
                                }
                                if(czm_backgroundColor.rgb == reflectColour.xyz){
                                    
                                }
                                // out_FragColor.xyz = mix(baseWaterColor.xyz,reflectSkyColour.xyz,fresnelFactor);
                                // reflectColour.xyz = mix(reflectColour.xyz,waterAndSkyColor.xyz,fresnelFactor*1.2);
                                // reflectColour.xyz = mix(baseWaterColor.xyz,reflectSkyColour.xyz,fresnelFactor*1.2);
                                // reflectColour.xyz = vec3( 0.35 ) + reflectColour.xyz * 0.65 + reflectColour.xyz * specularLight;
                                // out_FragColor.xyz = mix(out_FragColor.xyz,reflectColour.xyz,fresnelFactor*1.2);// baseWaterColor.xyz * 0.95+ reflectColour.xyz * fresnelFactor;//
                                
                                out_FragColor.xyz = mix(out_FragColor.xyz,reflectColour.xyz,fresnelFactor);
                            }else{
                                // waterAndSkyColor = vec4(baseWaterColor.xyz * 0.95 + reflectSkyColour.xyz * 0.05,1.0);
                                out_FragColor.xyz =  (reflectColour.xyz + waterAndSkyColor.xyz)*0.6;
                                // reflectColour.xyz = mix(reflectColour.xyz,reflectSkyColour.xyz,0.5);
                                // reflectColour.xyz = vec3( 0.1 ) + reflectColour.xyz * 0.9 + reflectColour.xyz * specularLight;
                                // out_FragColor.xyz = mix(baseWaterColor.xyz,reflectColour.xyz,fresnelFactor);
                                // out_FragColor.xyz = mix(baseWaterColor.xyz,reflectColour.xyz,fresnelFactor) * 0.7;
                                // out_FragColor.xyz = mix(out_FragColor.xyz,reflectColour.xyz,fresnelFactor) * 0.7;
                            }
                            
                            // out_FragColor.xyz = mix(out_FragColor.xyz,waterAndSkyColor.xyz,0.5);
                            //光照的方向，太阳到片元向量
                            vec3 lightVector = (czm_view * vec4(czm_sunPositionWC,1.0)).xyz - v_positionEC.xyz;
                            // vec3 normalEC = normalize(czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));
                            vec3 toLightVector = normalize(lightVector);

                            //菲涅尔混合，第一个参数是菲涅尔效应产生后的颜色，第二参数是水体原来的颜色 它们的顺序有区别的。因为没有折射，故第二个参数应是直接用原来的gl_FragColor
                            // out_FragColor = mix(reflectColour , out_FragColor, 0.5);
                            // out_FragColor = mix( out_FragColor,reflectColour , fresnelFactor);
                            // out_FragColor = mix(reflectColour,out_FragColor,fresnelFactor);
                            
                            float fade = max(1.0, (length(materialInput.positionToEyeEC) / 10000000000.0) * ${r} * ${o});
                            //z方向上的动态振动
                            vec3 normalTangentSpace = _flow.xyz * vec3(1.0, 1.0, (1.0 / ${n} )); 
                            // 当我们离水面越远时，减弱正常的扰动
                            // fade out the normal perturbation as we move further from the water surface
                            normalTangentSpace.xy /= fade;

                            // attempt to fade out the normal perturbation as we approach non water areas (low specular map value)
                            // 当我们接近非水域时，尝试淡出正常扰动（低镜面反射贴图值）
                            float specularMapValue =  calcSpecularValue(fragToCameraVector,toLightVector,normalize(materialInput.normalEC));
                            normalTangentSpace = mix(vec3(0.0, 0.0, 10.0), normalTangentSpace, specularMapValue);
                            //单位化
                            normalTangentSpace = normalize(normalTangentSpace);

                            // normalTangentSpace = normalize(materialInput.tangentToEyeMatrix * _flow.xyz);
                            normalTangentSpace = normalize(materialInput.tangentToEyeMatrix * normalTangentSpace);

                        
                            // normalize(_flow.xyz)
                            //计算高光
                            // vec3 specular = calcSpecularLighting(fragToCameraVector,toLightVector, normalize( _flow.xyz));

                            vec4 _phongColor =  czm_phong(normalize(materialInput.positionToEyeEC), material, lightVector1);

                            // vec3 specular = getBlinnPhongSpecular(normalize(materialInput.normalEC),fragToCameraVector,toLightVector); //高光镜面反射 Blinn-Phong
                            // normalEC
                            vec3 specular = getNewSpecular(normalize(materialInput.normalEC),viewDir,toLightVector); //高光镜面反射 

                            //加高光
                            out_FragColor +=  vec4(specular, 0.0); //mix(out_FragColor, vec4(0, 0.3, 0.5, 1.0), 0.2)
                            //加泡沫
                            float foamIntensityExternal = 0.5 * _reflectVisibleBydistance;
                            //泡沫的强度跟法向量有关
                            float foamIntensity = normals2FoamIntensity(normalize(_flow.xyz),_foamIntensity );
                            vec3 skyZenitColor = vec3(.52,.68,.9);
                            float upDotL = max(dot(normalize(_flow.xyz), toLightVector), 0.0);
                            float daytimeMod = 0.1 + upDotL * 0.9;
                            vec3 foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);

                            out_FragColor+=vec4(foam,0.0);
                        }
                }   
            `,{rt_texture:function(){return e._reflectTexture},rttProjectionMatrix:function(){return e.camera.frustum.projectionMatrix},rttViewMatrix:function(){return e.camera.viewMatrix},reflectMatrix:function(){return e.reflection_Matrix4},WaterHeight:function(){return e.WaterHeight},WaterWidth:function(){return e.WaterWidth},_baseWaterColor:function(){return Cesium.Color.fromCssColorString(e.baseWaterColor)},_reflectIndesity:function(){return e.reflectIndesity},_dayReflectIndesity:function(){return e.dayReflectIndesity},_nightReflectIndesity:function(){return e.nightReflectIndesity},_dayBaseWaterColor:function(){return Cesium.Color.fromCssColorString(e.dayBaseWaterColor)},_nightBaseWaterColor:function(){return Cesium.Color.fromCssColorString(e.nightBaseWaterColor)},_morning:function(){return e.morning},_night:function(){return e.night},_distortion:function(){return e.distortion},_foamIntensity:function(){return e.foamIntensity}});e._material._uniforms=Cesium.combine(e._material._uniforms,a)}setReflectCameraView(e,t,i){var r=new Cesium.Cartesian3,n=new Cesium.Cartesian3,o=new Cesium.Cartesian3,s=e.camera.positionWC,a=e.camera.directionWC,e=e.camera.upWC;return Cesium.Matrix4.multiplyByPoint(t,s,r),Cesium.Cartesian3.multiplyByScalar(a,100,n),Cesium.Cartesian3.add(s,n,n),Cesium.Matrix4.multiplyByPoint(t,n,n),Cesium.Cartesian3.subtract(n,r,n),Cesium.Cartesian3.normalize(n,n),Cesium.Cartesian3.multiplyByScalar(e,100,o),Cesium.Cartesian3.add(s,o,o),Cesium.Matrix4.multiplyByPoint(t,o,o),Cesium.Cartesian3.subtract(o,r,o),Cesium.Cartesian3.normalize(o,o),i.setView({destination:r,orientation:{direction:n,up:o}}),i}clear(){this._reflectListener&&(this._reflectListener(),this._reflectListener=void 0),this._reflectView&&(this._reflectView.destroy(),this._reflectView=void 0),this._viewer.scene.requestRender()}}var Le=function(e,t){return new Cesium.CustomShader({lightingModel:1,uniforms:{u_lightIndesity:{type:Cesium.UniformType.FLOAT,value:e},u_nightLightIndesity:{type:Cesium.UniformType.FLOAT,value:t.nightLightIndesity},u_dayLightIndesity:{type:Cesium.UniformType.FLOAT,value:t.dayLightIndesity},u_modelScale:{type:Cesium.UniformType.FLOAT,value:t.modelScale},u_visiableDistance:{type:Cesium.UniformType.FLOAT,value:t.visiableDistance},u_morning:{type:Cesium.UniformType.FLOAT,value:t.morning},u_night:{type:Cesium.UniformType.FLOAT,value:t.night}},vertexShaderText:`
      void vertexMain(VertexInput vsInput, inout czm_modelVertexOutput vsOutput)
      {

            vec3 vertexToCameraVector = (czm_view * vec4(czm_viewerPositionWC,1.0)).xyz - (czm_view * czm_model * vec4(vsInput.attributes.positionMC,1.0)).xyz;
            float distance = length(vertexToCameraVector);
            float visiableFactor = clamp(((u_visiableDistance-distance)/u_visiableDistance)*u_modelScale,0.0,u_modelScale);
            vsOutput.positionMC *= visiableFactor;
      }
      `,fragmentShaderText:`
      void fragmentMain(FragmentInput fsInput, inout czm_modelMaterial material)
      {     

            vec3 fragToCameraVector = (czm_view * vec4(czm_viewerPositionWC,1.0)).xyz - (czm_view * czm_model * vec4(fsInput.attributes.positionMC,1.0)).xyz;
            float distance = length(fragToCameraVector);
            float visiableFactor = clamp(((u_visiableDistance-distance)/u_visiableDistance),0.0,1.0);
            if(czm_globeTime.x>=u_morning && czm_globeTime.x<=u_night){
               material.diffuse *= u_dayLightIndesity;
            }else{
              material.diffuse *= u_nightLightIndesity;
            }
            material.emissive = material.diffuse;
      }
      `})};var De=new class{constructor(){}getBoxCoord(e){let t=[],i=[];e.forEach(e=>{t.push(e[0]),i.push(e[1])}),t.sort((e,t)=>e-t),i.sort((e,t)=>e-t);var e=t[0],r=t[t.length-1];return{minX:e,minY:i[0],maxX:r,maxY:i[i.length-1]}}createGirdIndex(e,S=4e-4,P=4e-4){var T=e.box.maxX-e.box.minX,L=e.box.maxY-e.box.minY;if(S<T&&P<L&&null!=e.poisitions){let t=e.box.minX,i=(e.box.maxY+e.box.minY)/2,r=(e.box.minX+e.box.maxX)/2,n=e.box.maxY,o=[],s=e.box.minX,a=e.box.minY,l=(e.box.minX+e.box.maxX)/2,u=(e.box.maxY+e.box.minY)/2,c=[],h=(e.box.minX+e.box.maxX)/2,A=e.box.minY,p=e.box.maxX,f=(e.box.maxY+e.box.minY)/2,d=[],g=(e.box.minX+e.box.maxX)/2,m=(e.box.maxY+e.box.minY)/2,y=e.box.maxX,_=e.box.maxY,v=[],C=0,w=0,x=0,b=0,E=0,B=0,M=0,I=0;e.poisitions.forEach(e=>{e[0]>=t&&e[0]<=r&&e[1]>i&&e[1]<=n&&(o.push(e),C+=e[0],w+=e[1]),e[0]>=s&&e[0]<=l&&e[1]>=a&&e[1]<=u&&(c.push(e),x+=e[0],b+=e[1]),e[0]>h&&e[0]<=p&&e[1]>=A&&e[1]<=f&&(d.push(e),E+=e[0],B+=e[1]),e[0]>g&&e[0]<=y&&e[1]>m&&e[1]<=_&&(v.push(e),M+=e[0],I+=e[1])});var T=e.level+1,L={poisitions:0<o.length?o:void 0,meanPosition:0<o.length?[C/o.length,w/o.length]:void 0,box:{minX:t,minY:i,maxX:r,maxY:n},upperLeftCell:void 0,lowerLeftCell:void 0,lowerRightCell:void 0,upperRightCell:void 0,level:T},D={poisitions:0<c.length?c:void 0,meanPosition:0<c.length?[x/c.length,b/c.length]:void 0,box:{minX:s,minY:a,maxX:l,maxY:u},upperLeftCell:void 0,lowerLeftCell:void 0,lowerRightCell:void 0,upperRightCell:void 0,level:T},F={poisitions:0<d.length?d:void 0,meanPosition:0<d.length?[E/d.length,B/d.length]:void 0,box:{minX:h,minY:A,maxX:p,maxY:f},upperLeftCell:void 0,lowerLeftCell:void 0,lowerRightCell:void 0,upperRightCell:void 0,level:T},T={poisitions:0<v.length?v:void 0,meanPosition:0<v.length?[M/v.length,I/v.length]:void 0,box:{minX:g,minY:m,maxX:y,maxY:_},upperLeftCell:void 0,lowerLeftCell:void 0,lowerRightCell:void 0,upperRightCell:void 0,level:T};e.upperLeftCell=L,this.createGirdIndex(e.upperLeftCell,S,P),e.lowerLeftCell=D,this.createGirdIndex(e.lowerLeftCell,S,P),e.lowerRightCell=F,this.createGirdIndex(e.lowerRightCell,S,P),e.upperRightCell=T,this.createGirdIndex(e.upperRightCell,S,P),e.meanPosition=void 0}return e}getFilterMeanPositions(e,t){return e.upperLeftCell&&(e.upperLeftCell.meanPosition instanceof Array?t.push(e.upperLeftCell.meanPosition):this.getFilterMeanPositions(e.upperLeftCell,t)),e.lowerLeftCell&&(e.lowerLeftCell.meanPosition instanceof Array?t.push(e.lowerLeftCell.meanPosition):this.getFilterMeanPositions(e.lowerLeftCell,t)),e.lowerRightCell&&(e.lowerRightCell.meanPosition instanceof Array?t.push(e.lowerRightCell.meanPosition):this.getFilterMeanPositions(e.lowerRightCell,t)),e.upperRightCell&&(e.upperRightCell.meanPosition instanceof Array?t.push(e.upperRightCell.meanPosition):this.getFilterMeanPositions(e.upperRightCell,t)),t}filterByGrid(e,t=4e-4,i=4e-4){var r=this.getBoxCoord(e),e=this.createGirdIndex({poisitions:e,meanPosition:void 0,box:r,upperLeftCell:void 0,lowerLeftCell:void 0,lowerRightCell:void 0,upperRightCell:void 0,level:0},t,i);return this.getFilterMeanPositions(e,[])}intersectInCurrentScreen(t,i){for(var e in i)i[e]*=180/Math.PI;if(0!==t.length)for(let e=0;e<t.length;e++){var r=t[e],n=Cesium.Matrix4.getTranslation(r.modelMatrix,new Cesium.Cartesian3),n=Cesium.Cartographic.fromCartesian(n);n.longitude*=180/Math.PI,n.latitude*=180/Math.PI,n.longitude>=i.west&&n.longitude<=i.east&&n.latitude>=i.south&&n.latitude<=i.north?r.show=!0:r.show=!1}}};class Fe{constructor(e,t){this._viewer=e,this.treeModelExperimentalArray=[],this.config=t}async addPrimitive(e){var t=Cesium.Transforms.localFrameToFixedFrameGenerator("east","north"),i=new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(0),0,0),r={},i=((r=Object.assign({},this.config)).modelMatrix=Cesium.Transforms.headingPitchRollToFixedFrame(Cesium.Cartesian3.fromDegrees(e[0],e[1],this.config.height),i,Cesium.Ellipsoid.WGS84,t),r.customShader=this.config.isCreateCustomShader?Le(this._viewer.scene.light.intensity,this.config):null,r.featureIdLabel=e.id,await Cesium.Model.fromGltfAsync(r));this.treeModelExperimentalArray.push(i),this._viewer.scene.primitives.add(i)}addModelPoint(e,t=4e-4,i=4e-4){t=Cesium.defaultValue(this.config.deltaX,t),i=Cesium.defaultValue(this.config.deltaY,i),De.filterByGrid(e,t,i).forEach(e=>{this.addPrimitive(e,t,i)})}getConfig(){return this.config}removeModelPoint(){0<this.treeModelExperimentalArray.length&&(this.treeModelExperimentalArray.forEach(e=>{this._viewer.scene.primitives.remove(e)}),this.listener)&&(this.listener(),this.listener=void 0)}destory(){this.removeModelPoint(),this._viewer=void 0}}var Ne=class{constructor(e={}){this.type=Cesium.defaultValue(e.type,"AgBloomMaterial1114444"),this.color=Cesium.defaultValue(e.color,new Cesium.Color(1,1,1,1)),this.image=Cesium.defaultValue(e.image,Cesium.Material.DefaultImageId),this.repeat=Cesium.defaultValue(e.repeat,new Cesium.Cartesian2(1,1)),this.visiableDistance=e.visiableDistance,this.intensity=Cesium.defaultValue(e.intensity,1),this.material=new Cesium.Material({fabric:{type:this.type,uniforms:{color:this.color,image:this.image,repeat:this.repeat,intensity:this.intensity,u_visiableDistance:this.visiableDistance},source:`uniform float time;
uniform sampler2D image;
uniform vec4 color;
uniform vec2 repeat;
uniform float intensity;
uniform float u_visiableDistance;
czm_material czm_getMaterial(czm_materialInput materialInput) {
    czm_material material = czm_getDefaultMaterial(materialInput);
    vec2 st = materialInput.st;
    vec4 colorImage; 
    colorImage = texture(image, vec2(fract(st.s * repeat.x), fract(st.t * repeat.y)));
    float _intensity = intensity;
    if (_intensity > 1.0) {
      _intensity = 1.0;
    }
    if (czm_globeTime.x >= 6.0&& czm_globeTime.x <= 19.0) {
      _intensity = 0.0;
    } else {
      _intensity = 1.0 ; //- _intensity + 0.1
    }
    vec3 fragToCameraVector = materialInput.positionToEyeEC;
    float distance = length(fragToCameraVector);
    float visiableFactor = clamp(((u_visiableDistance-distance)/u_visiableDistance),0.0,1.0);
    material.diffuse = color.rgb * _intensity * visiableFactor;
    material.emission = colorImage.rgb;
    material.alpha = colorImage.a * _intensity * visiableFactor;
    return material;
}`}})}destroyed(){}};var Oe=class{constructor(e,t){this.viewer=e,this.config=t,this.primitiveList=[]}add(e,t,i){var r=this.viewer.scene,e=De.filterByGrid(e,t,i).map(e=>({geometry:new Cesium.EllipseGeometry({center:Cesium.Cartesian3.fromDegrees(e[0],e[1]),semiMajorAxis:this.config.semiMajorAxis,semiMinorAxis:this.config.semiMinorAxis,height:this.config.bloomHeight})})).map(e=>{return new Cesium.GeometryInstance({geometry:e.geometry,id:"rectangle5555",ins:this.config.ins})}),t=new Ne({image:this.config.BloomPath,repeat:new Cesium.Cartesian2(1,1),color:Cesium.Color.fromCssColorString("#cbc46d"),visiableDistance:this.config.visiableDistance}),i=new Cesium.Primitive({geometryInstances:e,appearance:new Cesium.MaterialAppearance({material:t.material,vertexShaderSource:`
in vec3 position3DHigh;
in vec3 position3DLow;
in vec3 normal;
in float batchId;


uniform float u_modelScale;
uniform float u_visiableDistance;

uniform float u_height;
out vec3 v_positionEC;
out vec3 v_normalEC;

in vec2 st;
out vec2 v_st;


vec4 translateRelativeToEye(vec3 high, vec3 low)
{
    // vec3 highDifference = high - czm_encodedCameraPositionMCHigh;
    // vec3 lowDifference = low - czm_encodedCameraPositionMCLow;
    vec3 modelP = high+low;
    //modelP.z= modelP.z+u_height;
    //modelP.yz= modelP.yz * 0.5;
    vec3 cameraP = czm_encodedCameraPositionMCHigh+czm_encodedCameraPositionMCLow;
    vec3 diff = modelP-cameraP;
    return vec4(diff, 1.0);
}
vec4 computePosition()
{
  vec3 position3DHigh1 = position3DHigh;
  vec3 position3DLow1 = position3DLow;
  //position3DHigh1.xy=position3DHigh1.xy*10.0;
  //position3DLow1.xy=position3DLow1.xy*10.0;
    vec4 p;
    if (czm_morphTime == 1.0)
    {
        p = translateRelativeToEye(position3DHigh1, position3DLow1);
    }
    else if (czm_morphTime == 0.0)
    {
        p = translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy);
    }
    else
    {
        p = czm_columbusViewMorph(
                translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy),
                translateRelativeToEye(position3DHigh1, position3DLow1),
                czm_morphTime);
    }
    return p;
}

void main()
{
    vec4 p = computePosition();

    v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates
    v_normalEC = czm_normal * normal;                         // normal in eye coordinates
    v_st = st; //纹理坐标
  
    vec4 positionMC = czm_inverseModelView * vec4(v_positionEC,1.0);
    
    vec3 fragToCameraVector = -v_positionEC;
    float distance = length(fragToCameraVector);
    float visiableFactor = clamp(((u_visiableDistance-distance)/u_visiableDistance),0.0,1.0);
    // positionMC*=visiableFactor;

    gl_Position = czm_modelViewProjectionRelativeToEye * p;//czm_projection * czm_view * czm_model * positionMC;//
}`,fragmentShaderSource:`
in vec3 v_normalEC;
in vec3 v_positionEC;
in vec2 v_st;

void main()
{
    czm_materialInput materialInput;
    materialInput.s = v_st.s;
    vec3 positionToEyeEC = -v_positionEC;
    materialInput.positionToEyeEC = positionToEyeEC;
    materialInput.st = v_st;
    materialInput.str = vec3(v_st, 0.0);
    materialInput.normalEC = v_normalEC;
    czm_material material = czm_getMaterial(materialInput);
    out_FragColor = vec4(material.diffuse + material.emission, material.alpha);
}`,uniforms:{u_visiableDistance:()=>2e3,u_modelScale:()=>1,u_height:this.config.bloomHeight}})});this.primitiveList.push(i),console.log(i),r.primitives.add(i)}destroy(){if(0<this.primitiveList.length)for(let e=0;e<this.primitiveList.length;e++)this.viewer.scene.primitives.remove(this.primitiveList[e]);this.primitiveList=[]}};var Re=new class{constructor(){this.clouds,this.viewer}get show(){return this.clouds.show}set show(e){this.clouds.show=e}get color(){this.clouds._clouds[0].color}set color(t){"string"==typeof t&&(t=Cesium.Color.fromCssColorString(t)),t=Cesium.Color.multiply(t,this.viewer.scene.light.color,t);var i=this.clouds._clouds,r=i.length;for(let e=0;e<r;e++)i[e].color=t}get dynamicShow(){return this.clouds._clouds.map(e=>!0===e.show)}set dynamicShow(t){var i=this.clouds._clouds,r=i.length;t=r<t?r:t;for(let e=0;e<r;e++)i[e].show=!1;for(let e=0;e<t;e++)i[e].show=!0}get translationalSpeed(){}set translationalSpeed(e){this.listener&&this.listener(),0===e.x&&0===e.y&&0===e.z||(this.listener=this.viewer.scene.postUpdate.addEventListener(()=>{var t=Cesium.Matrix4.fromArray([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,e.z,1]);if(!this.clouds)return this.listener();var i=this.clouds._clouds,r=i.length;for(let e=0;e<r;e++){var n=i[e].position.clone(),o=Cesium.Transforms.eastNorthUpToFixedFrame(n),o=Cesium.Matrix4.multiply(o,t,o);Cesium.Matrix4.getTranslation(o,n),i[e].position=n}}))}getClouds(){return this}setClouds(e,t){return this.viewer||(this.viewer=e),this.clouds||(this.clouds=new Cesium.CloudCollection({noiseDetail:t.noiseDetail}),e.scene.primitives.add(this.clouds),this.createRandomClouds(t)),this.color=t.color||this.viewer.scene.light.color,t.dynamicShow&&(this.dynamicShow=t.dynamicShow),this.translationalSpeed=t.translationalSpeed||new Cesium.Cartesian3(this.viewer.clock.multiplier/10,0,0),this}getRandomNumberInRange(e,t){return e+Cesium.Math.nextRandomNumber()*(t-e)}createRandomClouds(e){var{numClouds:t,startLong:i,stopLong:e,startLat:r,stopLat:n,minHeight:o,maxHeight:s,color:a=Cesium.Color.fromCssColorString("#ffffff")}=e,l=e-i,u=n-r;for(let e=0;e<t;e++){var c=i+this.getRandomNumberInRange(0,l),h=r+this.getRandomNumberInRange(0,u),A=this.getRandomNumberInRange(o,s),p=this.getRandomNumberInRange(5e4,1e5),f=p/2+this.getRandomNumberInRange(p/20,p/3),d=this.getRandomNumberInRange(.4,.8),g=this.getRandomNumberInRange(5,10),m=(this.getRandomNumberInRange(1.5,2.1),this.getRandomNumberInRange(5,10));this.clouds.add({position:Cesium.Cartesian3.fromDegrees(c,h,A),scale:new Cesium.Cartesian2(p,f),maximumSize:new Cesium.Cartesian3(m,m,g),slice:d,brightness:2,color:a})}}destroyed(){this.clouds&&this.viewer.scene.primitives.remove(this.clouds),this.clouds=void 0,this.viewer=void 0}};let{Check:Ue,defined:ke,DeveloperError:He,Resource:Qe}=Cesium;var Ve=function(e,t,i){if(Ue.defined("context",e),ke(t)&&ke(t.positiveX)&&ke(t.negativeX)&&ke(t.positiveY)&&ke(t.negativeY)&&ke(t.positiveZ)&&ke(t.negativeZ))return e={flipY:!0,skipColorSpaceConversion:i,preferImageBitmap:!0},i=[Qe.createIfNeeded(t.positiveX).fetchImage(e),Qe.createIfNeeded(t.negativeX).fetchImage(e),Qe.createIfNeeded(t.positiveY).fetchImage(e),Qe.createIfNeeded(t.negativeY).fetchImage(e),Qe.createIfNeeded(t.positiveZ).fetchImage(e),Qe.createIfNeeded(t.negativeZ).fetchImage(e)],Promise.all(i).then(function(e){e=e.map(e=>Cesium.resizeImageToNextPowerOfTwo(e));return{positiveX:e[0],negativeX:e[1],positiveY:e[2],negativeY:e[3],positiveZ:e[4],negativeZ:e[5]}});throw new He("urls is required and must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.")};var Ge=class{constructor(e,t,i){this.viewer=e,this.model=t;var{specularEnvironmentMaps:e,imageBasedLightingFactor:i,defaultCubeMap:r}=i;"string"==typeof e?(t._imageBasedLighting.sphericalHarmonicCoefficients=this.getSphericalHarmonicCoefficients(),t._imageBasedLighting.specularEnvironmentMaps=e,i&&(this.imageBasedLightingFactor=i)):e.positiveX&&"string"==typeof e.positiveX?(this.getCubeMapSources(e).then(e=>{t._imageBasedLighting.sphericalHarmonicCoefficients=this.getSphericalHarmonicCoefficients(),t._imageBasedLighting.specularEnvironmentMaps=[e,e,e,e,e,e]}),i&&(this.imageBasedLightingFactor=i)):e.positiveX&&(t._imageBasedLighting.sphericalHarmonicCoefficients=this.getSphericalHarmonicCoefficients(),t._imageBasedLighting.specularEnvironmentMaps=[sources,sources,sources,sources,sources,sources],i)&&(this.imageBasedLightingFactor=i),t._imageBasedLighting.defaultCubeMap=r}get imageBasedLightingFactor(){if(this.model)return this.model._imageBasedLighting.imageBasedLightingFactor}set imageBasedLightingFactor(e){this.model&&(Array.isArray(e)&&(e=new Cesium.Cartesian2(e[0],e[1])),this.model._imageBasedLighting.imageBasedLightingFactor=e)}async getCubeMapSources(e){return await Ve(this.viewer.scene.context,e)}getSphericalHarmonicCoefficients(){return[new Cesium.Cartesian3(1.234709620475769,1.221461296081543,1.273156881332397),new Cesium.Cartesian3(1.135921120643616,1.171217799186707,1.287644743919373),new Cesium.Cartesian3(1.245193719863892,1.245591878890991,1.282818794250488),new Cesium.Cartesian3(-1.106930732727051,-1.112522482872009,-1.153198838233948),new Cesium.Cartesian3(-1.086226940155029,-1.079731941223145,-1.101912498474121),new Cesium.Cartesian3(1.189834713935852,1.185906887054443,1.214385271072388),new Cesium.Cartesian3(.01778045296669,.02013735473156,.025313569232821),new Cesium.Cartesian3(-1.086826920509338,-1.084611177444458,-1.111204028129578),new Cesium.Cartesian3(-.05241484940052,-.048303380608559,-.041960217058659)]}destroyed(){this.model._imageBasedLighting.sphericalHarmonicCoefficients=void 0,this.model._imageBasedLighting.specularEnvironmentMaps=void 0}},o=__webpack_require__(3355),ze=function(){return new Cesium.Geometry({attributes:new Cesium.GeometryAttributes({position:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0])}),st:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:new Float32Array([0,0,1,0,1,1,0,1])})}),indices:new Uint32Array([3,2,0,0,2,1])})},s=function(e,t){Cesium.defined(t)&&((i={}).arrayBufferView=t,e.source=i);var i,t=new Cesium.Texture(e);return t},We=function(e,t,i){return new Cesium.Framebuffer({context:e,colorTextures:[t],depthTexture:i})},qe=function(e){e={viewport:e.viewport,depthTest:e.depthTest,depthMask:e.depthMask,blending:e.blending};return Cesium.Appearance.getDefaultRenderState(!0,!1,e)},Ke=function(e){var t={},i=Cesium.Math.mod(e.west,Cesium.Math.TWO_PI),r=Cesium.Math.mod(e.east,Cesium.Math.TWO_PI),n=e.width;let o,s;s=n>Cesium.Math.THREE_PI_OVER_TWO?(o=0,Cesium.Math.TWO_PI):r-i<n?(o=i)+n:(o=i,r),t.lon={min:Cesium.Math.toDegrees(o),max:Cesium.Math.toDegrees(s)};n=e.south,i=e.north,r=e.height,e=r>Cesium.Math.PI/12?r/2:0;let a=Cesium.Math.clampToLatitudeRange(n-e),l=Cesium.Math.clampToLatitudeRange(i+e);return a<-Cesium.Math.PI_OVER_THREE&&(a=-Cesium.Math.PI_OVER_TWO),l>Cesium.Math.PI_OVER_THREE&&(l=Cesium.Math.PI_OVER_TWO),t.lat={min:Cesium.Math.toDegrees(a),max:Cesium.Math.toDegrees(l)},t};var je=class{constructor(e){this.commandType=e.commandType,this.geometry=e.geometry,this.attributeLocations=e.attributeLocations,this.primitiveType=e.primitiveType,this.uniformMap=e.uniformMap,this.vertexShaderSource=e.vertexShaderSource,this.fragmentShaderSource=e.fragmentShaderSource,this.rawRenderState=e.rawRenderState,this.framebuffer=e.framebuffer,this.outputTexture=e.outputTexture,this.autoClear=Cesium.defaultValue(e.autoClear,!1),this.preExecute=e.preExecute,this.show=!0,this.commandToExecute=void 0,this.clearCommand=void 0,this.autoClear&&(this.clearCommand=new Cesium.ClearCommand({color:new Cesium.Color(0,0,0,0),depth:1,framebuffer:this.framebuffer,pass:Cesium.Pass.OPAQUE}))}createCommand(e){switch(this.commandType){case"Draw":var t=Cesium.VertexArray.fromGeometry({context:e,geometry:this.geometry,attributeLocations:this.attributeLocations,bufferUsage:Cesium.BufferUsage.STATIC_DRAW}),i=Cesium.ShaderProgram.fromCache({context:e,attributeLocations:this.attributeLocations,vertexShaderSource:this.vertexShaderSource,fragmentShaderSource:this.fragmentShaderSource}),r=Cesium.RenderState.fromCache(this.rawRenderState);return new Cesium.DrawCommand({owner:this,vertexArray:t,primitiveType:this.primitiveType,uniformMap:this.uniformMap,modelMatrix:Cesium.Matrix4.IDENTITY,shaderProgram:i,framebuffer:this.framebuffer,renderState:r,pass:Cesium.Pass.OPAQUE});case"Compute":return new Cesium.ComputeCommand({owner:this,fragmentShaderSource:this.fragmentShaderSource,uniformMap:this.uniformMap,outputTexture:this.outputTexture,persists:!0})}}setGeometry(e,t){this.geometry=t;t=Cesium.VertexArray.fromGeometry({context:e,geometry:this.geometry,attributeLocations:this.attributeLocations,bufferUsage:Cesium.BufferUsage.STATIC_DRAW});this.commandToExecute.vertexArray=t}update(e){this.show&&(Cesium.defined(this.commandToExecute)||(this.commandToExecute=this.createCommand(e.context)),Cesium.defined(this.preExecute)&&this.preExecute(),Cesium.defined(this.clearCommand)&&e.commandList.push(this.clearCommand),e.commandList.push(this.commandToExecute))}isDestroyed(){return!1}destroy(){return Cesium.defined(this.commandToExecute)&&(this.commandToExecute.shaderProgram=this.commandToExecute.shaderProgram&&this.commandToExecute.shaderProgram.destroy()),Cesium.destroyObject(this)}},Ze=__webpack_require__(9644),Ye=__webpack_require__.n(Ze);__webpack_require__(5014);function Xe(e,t="utf8"){return new TextDecoder(t).decode(e)}const Je=new TextEncoder;Ze=new Uint8Array(4);const $e=!((new Uint32Array(Ze.buffer)[0]=1)&Ze[0]),et={int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,uint64:BigUint64Array,int64:BigInt64Array,float32:Float32Array,float64:Float64Array};class tt{constructor(e=8192,t={}){let i=!1;"number"==typeof e?e=new ArrayBuffer(e):(i=!0,this.lastWrittenByte=e.byteLength);var t=t.offset?t.offset>>>0:0,r=e.byteLength-t;let n=t;(ArrayBuffer.isView(e)||e instanceof tt)&&(e.byteLength!==e.buffer.byteLength&&(n=e.byteOffset+t),e=e.buffer),i?this.lastWrittenByte=r:this.lastWrittenByte=0,this.buffer=e,this.length=r,this.byteLength=r,this.byteOffset=n,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,n,r),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){var e=this._marks.pop();if(void 0===e)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){var t;return this.available(e)||(e=2*(this.offset+e),(t=new Uint8Array(e)).set(new Uint8Array(this.buffer)),this.buffer=t.buffer,this.length=this.byteLength=e,this._data=new DataView(this.buffer)),this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,t){var e=et[t].BYTES_PER_ELEMENT*e,i=this.byteOffset+this.offset;const r=this.buffer.slice(i,i+e);if(this.littleEndian===$e&&"uint8"!==t&&"int8"!==t){const r=new Uint8Array(this.buffer.slice(i,i+e)),n=(r.reverse(),new et[t](r.buffer));return this.offset+=e,n.reverse(),n}const n=new et[t](r);return this.offset+=e,n}readInt16(){var e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){var e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){var e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){var e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){var e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){var e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){var e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){var e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let i="";for(let e=0;e<t;e++)i+=this.readChar();return i}readUtf8(e=1){return Xe(this.readBytes(e))}decodeText(e=1,t="utf-8"){return Xe(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(e){return this.writeBytes((e=e,Je.encode(e)))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function d(e,t){if(e)throw new TypeError("Not a valid NetCDF v3.x file: "+t)}function it(e){e.offset%4!=0&&e.skip(4-e.offset%4)}function rt(e){var t=e.readUint32(),t=e.readChars(t);return it(e),t}const a={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function nt(e){switch(Number(e)){case a.BYTE:return"byte";case a.CHAR:return"char";case a.SHORT:return"short";case a.INT:return"int";case a.FLOAT:return"float";case a.DOUBLE:return"double";default:return"undefined"}}function ot(e){switch(Number(e)){case a.BYTE:case a.CHAR:return 1;case a.SHORT:return 2;case a.INT:case a.FLOAT:return 4;case a.DOUBLE:return 8;default:return-1}}function st(e){switch(String(e)){case"byte":return a.BYTE;case"char":return a.CHAR;case"short":return a.SHORT;case"int":return a.INT;case"float":return a.FLOAT;case"double":return a.DOUBLE;default:return-1}}function at(t,i){if(1===t)return i();var r=new Array(t);for(let e=0;e<t;e++)r[e]=i();return r}function lt(e,t,i){switch(t){case a.BYTE:return e.readBytes(i);case a.CHAR:return 0!==(r=e.readChars(i)).charCodeAt(r.length-1)?r:r.substring(0,r.length-1);case a.SHORT:return at(i,e.readInt16.bind(e));case a.INT:return at(i,e.readInt32.bind(e));case a.FLOAT:return at(i,e.readFloat32.bind(e));case a.DOUBLE:return at(i,e.readFloat64.bind(e));default:return void d(!0,"non valid type "+t)}var r}const ut=0,ct=10,ht=11,At=12;function pt(e,t){var i={recordDimension:{length:e.readUint32()}},r=(i.version=t,function(t){let i,r;var e=t.readUint32();let n;{if(e===ut)return d(t.readUint32()!==ut,"wrong empty tag for list of dimensions"),[];d(e!==ct,"wrong tag for list of dimensions");var o=t.readUint32();n=new Array(o);for(let e=0;e<o;e++){var s=rt(t),a=t.readUint32();a===ft&&(i=e,r=s),n[e]={name:s,size:a}}}return{dimensions:n,recordId:i,recordName:r}}(e)),e=(i.recordDimension.id=r.recordId,i.recordDimension.name=r.recordName,i.dimensions=r.dimensions,i.globalAttributes=dt(e),function(r,n,o){var e=r.readUint32();let s=0,a;{if(e===ut)return d(r.readUint32()!==ut,"wrong empty tag for list of variables"),[];d(e!==ht,"wrong tag for list of variables");var t=r.readUint32();a=new Array(t);for(let i=0;i<t;i++){var l=rt(r),u=r.readUint32(),c=new Array(u);for(let e=0;e<u;e++)c[e]=r.readUint32();var h=dt(r),A=r.readUint32(),p=(d(A<1&&6<A,"non valid type "+A),r.readUint32());let e=r.readUint32(),t=(2===o&&(d(0<e,"offsets larger than 4GB not supported"),e=r.readUint32()),!1);void 0!==n&&c[0]===n&&(s+=p,t=!0),a[i]={name:l,dimensions:c,attributes:h,type:nt(A),size:p,offset:e,record:t}}}return{variables:a,recordStep:s}}(e,r.recordId,t));return i.variables=e.variables,i.recordDimension.recordStep=e.recordStep,i}const ft=0;function dt(t){var e=t.readUint32();let i;if(e===ut)return d(t.readUint32()!==ut,"wrong empty tag for list of attributes"),[];d(e!==At,"wrong tag for list of attributes");var r=t.readUint32();i=new Array(r);for(let e=0;e<r;e++){var n=rt(t),o=t.readUint32(),s=(d(o<1||6<o,"non valid type "+o),t.readUint32()),s=lt(t,o,s);it(t),i[e]={name:n,type:nt(o),value:s}}return i}class gt{constructor(e){var e=new tt(e),t=(e.setBigEndian(),d("CDF"!==e.readChars(3),"should start with CDF"),e.readByte());d(2<t,"unknown version"),this.header=pt(e,t),this.buffer=e}get version(){return 1===this.header.version?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}getAttribute(t){var e=this.globalAttributes.find(e=>e.name===t);return e?e.value:null}getDataVariableAsString(e){e=this.getDataVariable(e);return e?e.join(""):null}get variables(){return this.header.variables}toString(){return function(){var e,t,i=[];i.push("DIMENSIONS");for(e of this.dimensions)i.push(`  ${e.name.padEnd(30)} = size: `+e.size);i.push(""),i.push("GLOBAL ATTRIBUTES");for(t of this.globalAttributes)i.push(`  ${t.name.padEnd(30)} = `+t.value);var r,n=JSON.parse(JSON.stringify(this.variables));i.push(""),i.push("VARIABLES:");for(r of n){r.value=this.getDataVariable(r);let e=JSON.stringify(r.value);50<e.length&&(e=e.substring(0,50)),isNaN(r.value.length)||(e+=` (length: ${r.value.length})`),i.push(`  ${r.name.padEnd(30)} = `+e)}return i.join("\n")}.call(this)}getDataVariable(t){let e;if(d(void 0===(e="string"==typeof t?this.header.variables.find(e=>e.name===t):t),"variable not found: "+t),this.buffer.seek(e.offset),e.record){var i=this.buffer,r=e,n=this.header.recordDimension,o=st(r.type),s=r.size?r.size/ot(o):1,a=n.length,l=new Array(a),u=n.recordStep;for(let e=0;e<a;e++){var c=i.offset;l[e]=lt(i,o,s),i.seek(c+u)}return l}var h=this.buffer,r=e,A=st(r.type),p=r.size/ot(A),f=new Array(p);for(let e=0;e<p;e++)f[e]=lt(h,A,1);return f}dataVariableExists(t){return void 0!==this.header.variables.find(e=>e.name===t)}attributeExists(t){return void 0!==this.globalAttributes.find(e=>e.name===t)}}function mt(t){return new Promise(function(n){var e={method:"GET",url:t,responseType:"arraybuffer"};Ye()(e).then(e=>{function t(e){return e.reduce(function(e,t){return e[t.name]=t,e},{})}var e=new gt(e.data),i=(l={},t(e.dimensions)),i=(l.dimensions={},l.dimensions.lon=i.lon.size,l.dimensions.lat=i.lat.size,l.dimensions.lev=i.lev.size,t(e.variables)),r=t(i.U.attributes),i=t(i.V.attributes);l.lon={},l.lon.array=new Float32Array(e.getDataVariable("lon").flat()),l.lon.min=Math.min(...l.lon.array),l.lon.max=Math.max(...l.lon.array),l.lat={},l.lat.array=new Float32Array(e.getDataVariable("lat").flat()),l.lat.min=Math.min(...l.lat.array),l.lat.max=Math.max(...l.lat.array),l.lev={},l.lev.array=new Float32Array(e.getDataVariable("lev").flat()),l.lev.min=Math.min(...l.lev.array),l.lev.max=Math.max(...l.lev.array),l.U={},l.U.array=new Float32Array(e.getDataVariable("U").flat()),l.U.min=r.min.value,l.U.max=r.max.value,l.V={},l.V.array=new Float32Array(e.getDataVariable("V").flat()),l.V.min=i.min.value,l.V.max=i.max.value,n(l)})})}let l;let yt=function(e){let t={lev:{}},i=(t.lev.array=new Float32Array([1]),t.lev.min=1,t.lev.max=1,null);if(e.forEach(function(e){switch(e.header.parameterCategory+","+e.header.parameterNumber){case"2,2":t.U={},t.U.array=new Float32Array(e.data),t.U.min=Math.min(...e.data),t.U.max=Math.max(...e.data),i=e.header;break;case"2,3":t.V={},t.V.array=new Float32Array(e.data),t.V.min=Math.min(...e.data),t.V.max=Math.max(...e.data)}}),!i)throw new Error("风场JSON数据的header为空");var r=i.nx,n=i.ny,o=i.dx,s=i.dy,e=i.lo1,a=(i.lo2,i.la1,i.la2),l=[],u=[];let c=e;for(let e=0;e<r;e++)l.push(c),c+=o;c=a;for(let e=0;e<n;e++)u.push(c),c+=s;return t.lon={},t.lon.array=new Float32Array(l),t.lon.min=Math.min(...l),t.lon.max=Math.max(...l),t.lat={},t.lat.array=new Float32Array(u),t.lat.min=Math.min(...u),t.lat.max=Math.max(...u),t.dimensions={lon:r,lat:n,lev:1},t};var _t=async function(e){if("json"===e.dataType)t=e.dataJson,l=yt(t);else{if("nc"!==e.dataType)throw new Error("WindField不支持的数据类型");await mt(e.dataFilePath)}var t;return l},vt=function(t,i){var r=new Float32Array(4*t);for(let e=0;e<t;e++)r[4*e]=Cesium.Math.randomBetween(i.lonRange.x,i.lonRange.y),r[4*e+1]=Cesium.Math.randomBetween(i.latRange.x,i.latRange.y),r[4*e+2]=Cesium.Math.randomBetween(l.lev.min,l.lev.max),r[4*e+3]=0;return r};var Ct=class{constructor(e,t,i,r){this.createWindTextures(e,t),this.createParticlesTextures(e,i,r),this.createComputingPrimitives(t,i,r)}createWindTextures(e,t){e={context:e,width:t.dimensions.lon,height:t.dimensions.lat*t.dimensions.lev,pixelFormat:Cesium.PixelFormat.RED,pixelDatatype:Cesium.PixelDatatype.FLOAT,flipY:!1,sampler:new Cesium.Sampler({minificationFilter:Cesium.TextureMinificationFilter.NEAREST,magnificationFilter:Cesium.TextureMagnificationFilter.NEAREST})};this.windTextures={U:s(e,t.U.array),V:s(e,t.V.array)}}createParticlesTextures(e,t,i){e={context:e,width:t.particlesTextureSize,height:t.particlesTextureSize,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.FLOAT,flipY:!1,sampler:new Cesium.Sampler({minificationFilter:Cesium.TextureMinificationFilter.NEAREST,magnificationFilter:Cesium.TextureMagnificationFilter.NEAREST})},i=vt(t.maxParticles,i),t=new Float32Array(4*t.maxParticles).fill(0);this.particlesTextures={previousParticlesPosition:s(e,i),currentParticlesPosition:s(e,i),nextParticlesPosition:s(e,i),postProcessingPosition:s(e,i),particlesSpeed:s(e,t)}}destroyParticlesTextures(){Object.keys(this.particlesTextures).forEach(e=>{this.particlesTextures[e].destroy()})}createComputingPrimitives(e,t,i){const r=new Cesium.Cartesian3(e.dimensions.lon,e.dimensions.lat,e.dimensions.lev),n=new Cesium.Cartesian3(e.lon.min,e.lat.min,e.lev.min),o=new Cesium.Cartesian3(e.lon.max,e.lat.max,e.lev.max),s=new Cesium.Cartesian3((o.x-n.x)/(r.x-1),(o.y-n.y)/(r.y-1),1<r.z?(o.z-n.z)/(r.z-1):1),a=new Cesium.Cartesian2(e.U.min,e.U.max),l=new Cesium.Cartesian2(e.V.min,e.V.max),u=this;this.primitives={calculateSpeed:new je({commandType:"Compute",uniformMap:{U:function(){return u.windTextures.U},V:function(){return u.windTextures.V},currentParticlesPosition:function(){return u.particlesTextures.currentParticlesPosition},dimension:function(){return r},minimum:function(){return n},maximum:function(){return o},interval:function(){return s},uSpeedRange:function(){return a},vSpeedRange:function(){return l},pixelSize:function(){return i.pixelSize},speedFactor:function(){return t.speedFactor},speedScaleFactor:function(){return i.pixelSize*t.speedFactor}},fragmentShaderSource:new Cesium.ShaderSource({sources:[`
// the size of UV textures: width = lon, height = lat*lev
uniform sampler2D U; // eastward wind 
uniform sampler2D V; // northward wind
uniform sampler2D currentParticlesPosition; // (lon, lat, lev)

uniform vec3 dimension; // (lon, lat, lev)
uniform vec3 minimum; // minimum of each dimension
uniform vec3 maximum; // maximum of each dimension
uniform vec3 interval; // interval of each dimension

// used to calculate the wind norm
uniform vec2 uSpeedRange; // (min, max);
uniform vec2 vSpeedRange;
uniform float pixelSize;
uniform float speedFactor;
uniform float speedScaleFactor;

in vec2 v_textureCoordinates;

vec2 mapPositionToNormalizedIndex2D(vec3 lonLatLev) {
    // ensure the range of longitude and latitude
    lonLatLev.x = mod(lonLatLev.x, 360.0);
    lonLatLev.y = clamp(lonLatLev.y, -90.0, 90.0);

    vec3 index3D = vec3(0.0);
    index3D.x = (lonLatLev.x - minimum.x) / interval.x;
    index3D.y = (lonLatLev.y - minimum.y) / interval.y;
    index3D.z = (lonLatLev.z - minimum.z) / interval.z;

    // the st texture coordinate corresponding to (col, row) index
    // example
    // data array is [0, 1, 2, 3, 4, 5], width = 3, height = 2
    // the content of texture will be
    // t 1.0
    //    |  3 4 5
    //    |
    //    |  0 1 2
    //   0.0------1.0 s

    vec2 index2D = vec2(index3D.x, index3D.z * dimension.y + index3D.y);
    vec2 normalizedIndex2D = vec2(index2D.x / dimension.x, index2D.y / (dimension.y * dimension.z));
    return normalizedIndex2D;
}

float getWindComponent(sampler2D componentTexture, vec3 lonLatLev) {
    vec2 normalizedIndex2D = mapPositionToNormalizedIndex2D(lonLatLev);
    float result = texture(componentTexture, normalizedIndex2D).r;
    return result;
}

float interpolateTexture(sampler2D componentTexture, vec3 lonLatLev) {
    float lon = lonLatLev.x;
    float lat = lonLatLev.y;
    float lev = lonLatLev.z;

    float lon0 = floor(lon / interval.x) * interval.x;
    float lon1 = lon0 + 1.0 * interval.x;
    float lat0 = floor(lat / interval.y) * interval.y;
    float lat1 = lat0 + 1.0 * interval.y;

    float lon0_lat0 = getWindComponent(componentTexture, vec3(lon0, lat0, lev));
    float lon1_lat0 = getWindComponent(componentTexture, vec3(lon1, lat0, lev));
    float lon0_lat1 = getWindComponent(componentTexture, vec3(lon0, lat1, lev));
    float lon1_lat1 = getWindComponent(componentTexture, vec3(lon1, lat1, lev));

    float lon_lat0 = mix(lon0_lat0, lon1_lat0, lon - lon0);
    float lon_lat1 = mix(lon0_lat1, lon1_lat1, lon - lon0);
    float lon_lat = mix(lon_lat0, lon_lat1, lat - lat0);
    return lon_lat;
}

vec3 linearInterpolation(vec3 lonLatLev) {
    // https://en.wikipedia.org/wiki/Bilinear_interpolation
    float u = interpolateTexture(U, lonLatLev);
    float v = interpolateTexture(V, lonLatLev);
    float w = 0.0;
    return vec3(u, v, w);
}

vec2 lengthOfLonLat(vec3 lonLatLev) {
    // unit conversion: meters -> longitude latitude degrees
    // see https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree for detail

    // Calculate the length of a degree of latitude and longitude in meters
    float latitude = radians(lonLatLev.y);

    float term1 = 111132.92;
    float term2 = 559.82 * cos(2.0 * latitude);
    float term3 = 1.175 * cos(4.0 * latitude);
    float term4 = 0.0023 * cos(6.0 * latitude);
    float latLength = term1 - term2 + term3 - term4;

    float term5 = 111412.84 * cos(latitude);
    float term6 = 93.5 * cos(3.0 * latitude);
    float term7 = 0.118 * cos(5.0 * latitude);
    float longLength = term5 - term6 + term7;

    return vec2(longLength, latLength);
}

vec3 convertSpeedUnitToLonLat(vec3 lonLatLev, vec3 speed) {
    vec2 lonLatLength = lengthOfLonLat(lonLatLev);
    float u = speed.x / lonLatLength.x;
    float v = speed.y / lonLatLength.y;
    float w = 0.0;
    vec3 windVectorInLonLatLev = vec3(u, v, w);

    return windVectorInLonLatLev;
}

vec3 calculateSpeedByRungeKutta2(vec3 lonLatLev) {
    // see https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods#Second-order_methods_with_two_stages for detail
    const float h = 0.5;

    vec3 y_n = lonLatLev;
    vec3 f_n = linearInterpolation(lonLatLev);
    vec3 midpoint = y_n + 0.5 * h * convertSpeedUnitToLonLat(y_n, f_n) * speedScaleFactor;
    vec3 speed = h * linearInterpolation(midpoint) * speedScaleFactor;

    return speed;
}

float calculateWindNorm(vec3 speed) {
    vec3 percent = vec3(0.0);
    percent.x = (speed.x - uSpeedRange.x) / (uSpeedRange.y - uSpeedRange.x);
    percent.y = (speed.y - vSpeedRange.x) / (vSpeedRange.y - vSpeedRange.x);
    float norm = length(percent);

    return norm;
}

void main() {
    // texture coordinate must be normalized
    vec3 lonLatLev = texture(currentParticlesPosition, v_textureCoordinates).rgb;
    vec3 speed = calculateSpeedByRungeKutta2(lonLatLev);
    vec3 speedInLonLat = convertSpeedUnitToLonLat(lonLatLev, speed);

    vec4 particleSpeed = vec4(speedInLonLat, calculateWindNorm(speed / speedScaleFactor));
    out_FragColor = particleSpeed;
}
`]}),outputTexture:this.particlesTextures.particlesSpeed,preExecute:function(){var e=u.particlesTextures.previousParticlesPosition;u.particlesTextures.previousParticlesPosition=u.particlesTextures.currentParticlesPosition,u.particlesTextures.currentParticlesPosition=u.particlesTextures.postProcessingPosition,u.particlesTextures.postProcessingPosition=e,u.primitives.calculateSpeed.commandToExecute.outputTexture=u.particlesTextures.particlesSpeed}}),updatePosition:new je({commandType:"Compute",uniformMap:{currentParticlesPosition:function(){return u.particlesTextures.currentParticlesPosition},particlesSpeed:function(){return u.particlesTextures.particlesSpeed}},fragmentShaderSource:new Cesium.ShaderSource({sources:[`
uniform sampler2D currentParticlesPosition; // (lon, lat, lev)
uniform sampler2D particlesSpeed; // (u, v, w, norm) Unit converted to degrees of longitude and latitude 

in vec2 v_textureCoordinates;

void main() {
    // texture coordinate must be normalized
    vec3 lonLatLev = texture(currentParticlesPosition, v_textureCoordinates).rgb;
    vec3 speed = texture(particlesSpeed, v_textureCoordinates).rgb;
    vec3 nextParticle = lonLatLev + speed;

    out_FragColor = vec4(nextParticle, 0.0);
}
`]}),outputTexture:this.particlesTextures.nextParticlesPosition,preExecute:function(){u.primitives.updatePosition.commandToExecute.outputTexture=u.particlesTextures.nextParticlesPosition}}),postProcessingPosition:new je({commandType:"Compute",uniformMap:{nextParticlesPosition:function(){return u.particlesTextures.nextParticlesPosition},particlesSpeed:function(){return u.particlesTextures.particlesSpeed},lonRange:function(){return i.lonRange},latRange:function(){return i.latRange},randomCoefficient:function(){return Math.random()},dropRate:function(){return t.dropRate},dropRateBump:function(){return t.dropRateBump}},fragmentShaderSource:new Cesium.ShaderSource({sources:[`
uniform sampler2D nextParticlesPosition;
uniform sampler2D particlesSpeed; // (u, v, w, norm)

// range (min, max)
uniform vec2 lonRange;
uniform vec2 latRange;

uniform float randomCoefficient; // use to improve the pseudo-random generator
uniform float dropRate; // drop rate is a chance a particle will restart at random position to avoid degeneration
uniform float dropRateBump;

in vec2 v_textureCoordinates;

// pseudo-random generator
const vec3 randomConstants = vec3(12.9898, 78.233, 4375.85453);
const vec2 normalRange = vec2(0.0, 1.0);
float rand(vec2 seed, vec2 range) {
    vec2 randomSeed = randomCoefficient * seed;
    float temp = dot(randomConstants.xy, randomSeed);
    temp = fract(sin(temp) * (randomConstants.z + temp));
    return temp * (range.y - range.x) + range.x;
}

vec3 generateRandomParticle(vec2 seed, float lev) {
    // ensure the longitude is in [0, 360]
    float randomLon = mod(rand(seed, lonRange), 360.0);
    float randomLat = rand(-seed, latRange);

    return vec3(randomLon, randomLat, lev);
}

bool particleOutbound(vec3 particle) {
    return particle.y < -90.0 || particle.y > 90.0;
}

void main() {
    vec3 nextParticle = texture(nextParticlesPosition, v_textureCoordinates).rgb;
    vec4 nextSpeed = texture(particlesSpeed, v_textureCoordinates);
    float speedNorm = nextSpeed.a;
    float particleDropRate = dropRate + dropRateBump * speedNorm;

    vec2 seed1 = nextParticle.xy + v_textureCoordinates;
    vec2 seed2 = nextSpeed.xy + v_textureCoordinates;
    vec3 randomParticle = generateRandomParticle(seed1, nextParticle.z);
    float randomNumber = rand(seed2, normalRange);

    if (randomNumber < particleDropRate || particleOutbound(nextParticle)) {
        out_FragColor = vec4(randomParticle, 1.0); // 1.0 means this is a random particle
    } else {
        out_FragColor = vec4(nextParticle, 0.0);
    }
}
`]}),outputTexture:this.particlesTextures.postProcessingPosition,preExecute:function(){u.primitives.postProcessingPosition.commandToExecute.outputTexture=u.particlesTextures.postProcessingPosition}})}}},wt=`
in vec3 position;
in vec2 st;

out vec2 textureCoordinate;

void main() {
    textureCoordinate = st;
    gl_Position = vec4(position, 1.0);
}
`;var xt=class{constructor(e,t,i,r,n){this.createRenderingTextures(e,t),this.createRenderingFramebuffers(e),this.createRenderingPrimitives(e,i,r,n)}createRenderingTextures(e,t){var i={context:e,width:e.drawingBufferWidth,height:e.drawingBufferHeight,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.UNSIGNED_BYTE},e={context:e,width:e.drawingBufferWidth,height:e.drawingBufferHeight,pixelFormat:Cesium.PixelFormat.DEPTH_COMPONENT,pixelDatatype:Cesium.PixelDatatype.UNSIGNED_INT};this.textures={segmentsColor:s(i),segmentsDepth:s(e),currentTrailsColor:s(i),currentTrailsDepth:s(e),nextTrailsColor:s(i),nextTrailsDepth:s(e)}}createRenderingFramebuffers(e){this.framebuffers={segments:We(e,this.textures.segmentsColor,this.textures.segmentsDepth),currentTrails:We(e,this.textures.currentTrailsColor,this.textures.currentTrailsDepth),nextTrails:We(e,this.textures.nextTrailsColor,this.textures.nextTrailsDepth)}}createSegmentsGeometry(r){let n=[];for(let i=0;i<r.particlesTextureSize;i++)for(let t=0;t<r.particlesTextureSize;t++)for(let e=0;e<6;e++)n.push(i/r.particlesTextureSize),n.push(t/r.particlesTextureSize);n=new Float32Array(n);let i=[];var o=[-1,0,1],s=[-1,1];for(let e=0;e<r.maxParticles;e++)for(let t=0;t<o.length;t++)for(let e=0;e<s.length;e++)i.push(o[t]),i.push(s[e]),i.push(0);i=new Float32Array(i);var e=12*r.maxParticles,a=new Uint32Array(e);for(let e=0,t=0,i=0;e<r.maxParticles;e++)a[t++]=i+0,a[t++]=i+1,a[t++]=i+2,a[t++]=i+2,a[t++]=i+1,a[t++]=i+3,a[t++]=i+2,a[t++]=i+4,a[t++]=i+3,a[t++]=i+4,a[t++]=i+3,a[t++]=i+5,i+=6;return new Cesium.Geometry({attributes:new Cesium.GeometryAttributes({st:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:n}),normal:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:i})}),indices:a})}createRenderingPrimitives(e,t,i,r){const n=this;this.primitives={segments:new je({commandType:"Draw",attributeLocations:{st:0,normal:1},geometry:this.createSegmentsGeometry(t),primitiveType:Cesium.PrimitiveType.TRIANGLES,uniformMap:{previousParticlesPosition:function(){return r.particlesTextures.previousParticlesPosition},currentParticlesPosition:function(){return r.particlesTextures.currentParticlesPosition},postProcessingPosition:function(){return r.particlesTextures.postProcessingPosition},aspect:function(){return e.drawingBufferWidth/e.drawingBufferHeight},pixelSize:function(){return i.pixelSize},lineWidth:function(){return t.lineWidth},particleHeight:function(){return t.particleHeight}},vertexShaderSource:new Cesium.ShaderSource({sources:[`
in vec2 st;
// it is not normal itself, but used to control lines drawing
in vec3 normal; // (point to use, offset sign, not used component)

uniform sampler2D previousParticlesPosition;
uniform sampler2D currentParticlesPosition;
uniform sampler2D postProcessingPosition;

uniform float particleHeight;

uniform float aspect;
uniform float pixelSize;
uniform float lineWidth;

struct adjacentPoints {
    vec4 previous;
    vec4 current;
    vec4 next;
};

vec3 convertCoordinate(vec3 lonLatLev) {
    // WGS84 (lon, lat, lev) -> ECEF (x, y, z)
    // read https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates for detail

    // WGS 84 geometric constants 
    float a = 6378137.0; // Semi-major axis 
    float b = 6356752.3142; // Semi-minor axis 
    float e2 = 6.69437999014e-3; // First eccentricity squared

    float latitude = radians(lonLatLev.y);
    float longitude = radians(lonLatLev.x);

    float cosLat = cos(latitude);
    float sinLat = sin(latitude);
    float cosLon = cos(longitude);
    float sinLon = sin(longitude);

    float N_Phi = a / sqrt(1.0 - e2 * sinLat * sinLat);
    float h = particleHeight; // it should be high enough otherwise the particle may not pass the terrain depth test

    vec3 cartesian = vec3(0.0);
    cartesian.x = (N_Phi + h) * cosLat * cosLon;
    cartesian.y = (N_Phi + h) * cosLat * sinLon;
    cartesian.z = ((b * b) / (a * a) * N_Phi + h) * sinLat;
    return cartesian;
}

vec4 calculateProjectedCoordinate(vec3 lonLatLev) {
    // the range of longitude in Cesium is [-180, 180] but the range of longitude in the NetCDF file is [0, 360]
    // [0, 180] is corresponding to [0, 180] and [180, 360] is corresponding to [-180, 0]
    lonLatLev.x = mod(lonLatLev.x + 180.0, 360.0) - 180.0;
    vec3 particlePosition = convertCoordinate(lonLatLev);
    vec4 projectedCoordinate = czm_modelViewProjection * vec4(particlePosition, 1.0);
    return projectedCoordinate;
}

vec4 calculateOffsetOnNormalDirection(vec4 pointA, vec4 pointB, float offsetSign) {
    vec2 aspectVec2 = vec2(aspect, 1.0);
    vec2 pointA_XY = (pointA.xy / pointA.w) * aspectVec2;
    vec2 pointB_XY = (pointB.xy / pointB.w) * aspectVec2;

    float offsetLength = lineWidth / 2.0;
    vec2 direction = normalize(pointB_XY - pointA_XY);
    vec2 normalVector = vec2(-direction.y, direction.x);
    normalVector.x = normalVector.x / aspect;
    normalVector = offsetLength * normalVector;

    vec4 offset = vec4(offsetSign * normalVector, 0.0, 0.0);
    return offset;
}

vec4 calculateOffsetOnMiterDirection(adjacentPoints projectedCoordinates, float offsetSign) {
    vec2 aspectVec2 = vec2(aspect, 1.0);

    vec4 PointA = projectedCoordinates.previous;
    vec4 PointB = projectedCoordinates.current;
    vec4 PointC = projectedCoordinates.next;

    vec2 pointA_XY = (PointA.xy / PointA.w) * aspectVec2;
    vec2 pointB_XY = (PointB.xy / PointB.w) * aspectVec2;
    vec2 pointC_XY = (PointC.xy / PointC.w) * aspectVec2;

    vec2 AB = normalize(pointB_XY - pointA_XY);
    vec2 BC = normalize(pointC_XY - pointB_XY);

    vec2 normalA = vec2(-AB.y, AB.x);
    vec2 tangent = normalize(AB + BC);
    vec2 miter = vec2(-tangent.y, tangent.x);

    float offsetLength = lineWidth / 2.0;
    float projection = dot(miter, normalA);
    vec4 offset = vec4(0.0);
    // avoid to use values that are too small
    if (projection > 0.1) {
        float miterLength = offsetLength / projection;
        offset = vec4(offsetSign * miter * miterLength, 0.0, 0.0);
        offset.x = offset.x / aspect;
    } else {
        offset = calculateOffsetOnNormalDirection(PointB, PointC, offsetSign);
    }

    return offset;
}

void main() {
    vec2 particleIndex = st;

    vec3 previousPosition = texture(previousParticlesPosition, particleIndex).rgb;
    vec3 currentPosition = texture(currentParticlesPosition, particleIndex).rgb;
    vec3 nextPosition = texture(postProcessingPosition, particleIndex).rgb;

    float isAnyRandomPointUsed = texture(postProcessingPosition, particleIndex).a +
        texture(currentParticlesPosition, particleIndex).a +
        texture(previousParticlesPosition, particleIndex).a;

    adjacentPoints projectedCoordinates;
    if (isAnyRandomPointUsed > 0.0) {
        projectedCoordinates.previous = calculateProjectedCoordinate(previousPosition);
        projectedCoordinates.current = projectedCoordinates.previous;
        projectedCoordinates.next = projectedCoordinates.previous;
    } else {
        projectedCoordinates.previous = calculateProjectedCoordinate(previousPosition);
        projectedCoordinates.current = calculateProjectedCoordinate(currentPosition);
        projectedCoordinates.next = calculateProjectedCoordinate(nextPosition);
    }

    int pointToUse = int(normal.x);
    float offsetSign = normal.y;
    vec4 offset = vec4(0.0);
    // render lines with triangles and miter joint
    // read https://blog.scottlogic.com/2019/11/18/drawing-lines-with-webgl.html for detail
    if (pointToUse == -1) {
        offset = pixelSize * calculateOffsetOnNormalDirection(projectedCoordinates.previous, projectedCoordinates.current, offsetSign);
        gl_Position = projectedCoordinates.previous + offset;
    } else {
        if (pointToUse == 0) {
            offset = pixelSize * calculateOffsetOnMiterDirection(projectedCoordinates, offsetSign);
            gl_Position = projectedCoordinates.current + offset;
        } else {
            if (pointToUse == 1) {
                offset = pixelSize * calculateOffsetOnNormalDirection(projectedCoordinates.current, projectedCoordinates.next, offsetSign);
                gl_Position = projectedCoordinates.next + offset;
            } else {

            }
        }
    }
}
`]}),fragmentShaderSource:new Cesium.ShaderSource({sources:[`
void main() {
    const vec4 white = vec4(1.0);
    out_FragColor = white;
}
`]}),rawRenderState:qe({viewport:void 0,depthTest:{enabled:!0},depthMask:!0}),framebuffer:this.framebuffers.segments,autoClear:!0}),trails:new je({commandType:"Draw",attributeLocations:{position:0,st:1},geometry:ze(),primitiveType:Cesium.PrimitiveType.TRIANGLES,uniformMap:{segmentsColorTexture:function(){return n.textures.segmentsColor},segmentsDepthTexture:function(){return n.textures.segmentsDepth},currentTrailsColor:function(){return n.framebuffers.currentTrails.getColorTexture(0)},trailsDepthTexture:function(){return n.framebuffers.currentTrails.depthTexture},fadeOpacity:function(){return t.fadeOpacity}},vertexShaderSource:new Cesium.ShaderSource({defines:["DISABLE_GL_POSITION_LOG_DEPTH"],sources:[wt]}),fragmentShaderSource:new Cesium.ShaderSource({defines:["DISABLE_LOG_DEPTH_FRAGMENT_WRITE"],sources:[`
uniform sampler2D segmentsColorTexture;
uniform sampler2D segmentsDepthTexture;

uniform sampler2D currentTrailsColor;
uniform sampler2D trailsDepthTexture;

uniform float fadeOpacity;

in vec2 textureCoordinate;

void main() {
    vec4 pointsColor = texture(segmentsColorTexture, textureCoordinate);
    vec4 trailsColor = texture(currentTrailsColor, textureCoordinate);

    trailsColor = floor(fadeOpacity * 255.0 * trailsColor) / 255.0; // make sure the trailsColor will be strictly decreased

    float pointsDepth = texture(segmentsDepthTexture, textureCoordinate).r;
    float trailsDepth = texture(trailsDepthTexture, textureCoordinate).r;
    float globeDepth = czm_unpackDepth(texture(czm_globeDepthTexture, textureCoordinate));

    out_FragColor = vec4(0.0);
    if (pointsDepth < globeDepth) {
        out_FragColor = out_FragColor + pointsColor;
    }
    if (trailsDepth < globeDepth) {
        out_FragColor = out_FragColor + trailsColor;
    }
    gl_FragDepth = min(pointsDepth, trailsDepth);
}
`]}),rawRenderState:qe({viewport:void 0,depthTest:{enabled:!0,func:Cesium.DepthFunction.ALWAYS},depthMask:!0}),framebuffer:this.framebuffers.nextTrails,autoClear:!0,preExecute:function(){var e=n.framebuffers.currentTrails;n.framebuffers.currentTrails=n.framebuffers.nextTrails,n.framebuffers.nextTrails=e,n.primitives.trails.commandToExecute.framebuffer=n.framebuffers.nextTrails,n.primitives.trails.clearCommand.framebuffer=n.framebuffers.nextTrails}}),screen:new je({commandType:"Draw",attributeLocations:{position:0,st:1},geometry:ze(),primitiveType:Cesium.PrimitiveType.TRIANGLES,uniformMap:{trailsColorTexture:function(){return n.framebuffers.nextTrails.getColorTexture(0)},trailsDepthTexture:function(){return n.framebuffers.nextTrails.depthTexture}},vertexShaderSource:new Cesium.ShaderSource({defines:["DISABLE_GL_POSITION_LOG_DEPTH"],sources:[wt]}),fragmentShaderSource:new Cesium.ShaderSource({defines:["DISABLE_LOG_DEPTH_FRAGMENT_WRITE"],sources:[`
uniform sampler2D trailsColorTexture;
uniform sampler2D trailsDepthTexture;

in vec2 textureCoordinate;

void main() {
    vec4 trailsColor = texture(trailsColorTexture, textureCoordinate);
    float trailsDepth = texture(trailsDepthTexture, textureCoordinate).r;
    float globeDepth = czm_unpackDepth(texture(czm_globeDepthTexture, textureCoordinate));

    if (trailsDepth < globeDepth) {
        out_FragColor = trailsColor;
    } else {
        out_FragColor = vec4(0.0);
    }
}
`]}),rawRenderState:qe({viewport:void 0,depthTest:{enabled:!1},depthMask:!0,blending:{enabled:!0}}),framebuffer:void 0})}}};var bt=class{constructor(e,t,i,r){this.context=e,this.data=t,this.userInput=i,this.viewerParameters=r,this.particlesComputing=new Ct(this.context,this.data,this.userInput,this.viewerParameters),this.particlesRendering=new xt(this.context,this.data,this.userInput,this.viewerParameters,this.particlesComputing)}canvasResize(e){this.particlesComputing.destroyParticlesTextures(),Object.keys(this.particlesComputing.windTextures).forEach(e=>{this.particlesComputing.windTextures[e].destroy()}),Object.keys(this.particlesRendering.framebuffers).forEach(e=>{this.particlesRendering.framebuffers[e].destroy()}),this.context=e,this.particlesComputing=new Ct(this.context,this.data,this.userInput,this.viewerParameters),this.particlesRendering=new xt(this.context,this.data,this.userInput,this.viewerParameters,this.particlesComputing)}clearFramebuffers(){let t=new Cesium.ClearCommand({color:new Cesium.Color(0,0,0,0),depth:1,framebuffer:void 0,pass:Cesium.Pass.OPAQUE});Object.keys(this.particlesRendering.framebuffers).forEach(e=>{t.framebuffer=this.particlesRendering.framebuffers[e],t.execute(this.context)})}refreshParticles(e){this.clearFramebuffers(),this.particlesComputing.destroyParticlesTextures(),this.particlesComputing.createParticlesTextures(this.context,this.userInput,this.viewerParameters),e&&(e=this.particlesRendering.createSegmentsGeometry(this.userInput),this.particlesRendering.primitives.segments.geometry=e,e=Cesium.VertexArray.fromGeometry({context:this.context,geometry:e,attributeLocations:this.particlesRendering.primitives.segments.attributeLocations,bufferUsage:Cesium.BufferUsage.STATIC_DRAW}),this.particlesRendering.primitives.segments.commandToExecute.vertexArray=e)}applyUserInput(t){let e=!1;this.userInput.maxParticles!=t.maxParticles&&(e=!0),Object.keys(t).forEach(e=>{this.userInput[e]=t[e]}),this.refreshParticles(e)}applyViewerParameters(t){Object.keys(t).forEach(e=>{this.viewerParameters[e]=t[e]}),this.refreshParticles(!1)}};Ze=class{constructor(e){e=Cesium.defaultValue(e,{}),this.viewer=Cesium.defaultValue(e.viewer,CIM.viewer),this.scene=this.viewer.scene,this.camera=this.viewer.camera;let t={particlesTextureSize:32,maxParticles:1024,particleHeight:100,fadeOpacity:.996,dropRate:.003,dropRateBump:.01,speedFactor:1,lineWidth:4};Object.assign(t,e),this.viewerParameters={lonRange:new Cesium.Cartesian2,latRange:new Cesium.Cartesian2,pixelSize:0},this.globeBoundingSphere=new Cesium.BoundingSphere(Cesium.Cartesian3.ZERO,6314355.63),this.updateViewerParameters(),_t(t).then(e=>{this.particleSystem=new bt(this.scene.context,e,t,this.viewerParameters),this.addPrimitives(),this.setupEventListeners()}),this.imageryLayers=this.viewer.imageryLayers,this.agFeatureLayer=new n.Z(this.viewer),this.viewer.camera.flyTo({destination:CIM.viewer.camera.position,orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-90),roll:Cesium.Math.toRadians(0)}})}destroy(){this.removePrimitives(),this.clearEventListeners()}addPrimitives(){this.agFeatureLayer.addPrimitive(this.particleSystem.particlesComputing.primitives.calculateSpeed),this.agFeatureLayer.addPrimitive(this.particleSystem.particlesComputing.primitives.updatePosition),this.agFeatureLayer.addPrimitive(this.particleSystem.particlesComputing.primitives.postProcessingPosition),this.agFeatureLayer.addPrimitive(this.particleSystem.particlesRendering.primitives.segments),this.agFeatureLayer.addPrimitive(this.particleSystem.particlesRendering.primitives.trails),this.agFeatureLayer.addPrimitive(this.particleSystem.particlesRendering.primitives.screen)}removePrimitives(){this.agFeatureLayer.removeAll()}updateViewerParameters(){var e=this.camera.computeViewRectangle(this.scene.globe.ellipsoid),e=Ke(e),e=(this.viewerParameters.lonRange.x=e.lon.min,this.viewerParameters.lonRange.y=e.lon.max,this.viewerParameters.latRange.x=e.lat.min,this.viewerParameters.latRange.y=e.lat.max,this.camera.getPixelSize(this.globeBoundingSphere,this.scene.drawingBufferWidth,this.scene.drawingBufferHeight));0<e&&(this.viewerParameters.pixelSize=e)}setupEventListeners(){const e=this;this.moveStartRemoveCb=this.camera.moveStart.addEventListener(function(){e.agFeatureLayer.setVisible(!1)}),this.moveEndRemoveCb=this.camera.moveEnd.addEventListener(function(){e.updateViewerParameters(),e.particleSystem.applyViewerParameters(e.viewerParameters),e.agFeatureLayer.setVisible(!0)});let t=!1;function i(){t=!0,e.agFeatureLayer.setVisible(!1),e.removePrimitives()}window.addEventListener("resize",i),this.resizeRemoveCb=function(){window.removeEventListener("resize",i)},this.preRenderRemoveCb=this.scene.preRender.addEventListener(function(){t&&(e.particleSystem.canvasResize(e.scene.context),t=!1,e.addPrimitives(),e.agFeatureLayer.setVisible(!0))})}clearEventListeners(){this.moveStartRemoveCb(),this.moveEndRemoveCb(),this.resizeRemoveCb(),this.preRenderRemoveCb()}};function u(e){var t=(e=Cesium.defaultValue(e,{})).bounds,i=e.data,r=e.heatmapJS;if(!Cesium.defined(t))throw new Cesium.DeveloperError("options.bounds is required.");if(!(Cesium.defined(t.north)&&Cesium.defined(t.south)&&Cesium.defined(t.east)&&Cesium.defined(t.west)))throw new Cesium.DeveloperError("options.bounds.north, options.bounds.south, options.bounds.east and options.bounds.west are required.");if(!Cesium.defined(i))throw new Cesium.DeveloperError("data is required.");if(!Cesium.defined(i.min)||!Cesium.defined(i.max)||!Cesium.defined(i.points))throw new Cesium.DeveloperError("options.bounds.north, bounds.south, bounds.east and bounds.west are required.");if(!Cesium.defined(r))throw new Cesium.DeveloperError("heatmapJS is required.");this._wmp=new Cesium.WebMercatorProjection,this._mbounds=this.wgs84ToMercatorBB(t),this._options=Cesium.defaultValue(e.heatmapoptions,{}),this._options.gradient=Cesium.defaultValue(this._options.gradient,{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"}),this._setWidthAndHeight(this._mbounds),this._options.radius=Math.round(Cesium.defaultValue(this._options.radius,this.width>this.height?this.width/60:this.height/60)),this._spacing=1.5*this._options.radius,this._xoffset=this._mbounds.west,this._yoffset=this._mbounds.south,this.width=Math.round(this.width+2*this._spacing),this.height=Math.round(this.height+2*this._spacing),this._mbounds.west-=this._spacing*this._factor,this._mbounds.east+=this._spacing*this._factor,this._mbounds.south-=this._spacing*this._factor,this._mbounds.north+=this._spacing*this._factor,this.bounds=this.mercatorToWgs84BB(this._mbounds),this._container=this._getContainer(this.width,this.height,"heatmap-canvas"),this._options.container=this._container,this._heatmap=r.create(this._options),this._canvas=this._container.children[0],this._tilingScheme=new Cesium.WebMercatorTilingScheme({rectangleSouthwestInMeters:new Cesium.Cartesian2(this._mbounds.west,this._mbounds.south),rectangleNortheastInMeters:new Cesium.Cartesian2(this._mbounds.east,this._mbounds.north)}),this._image=this._canvas,this._texture=void 0,this._tileWidth=this.width,this._tileHeight=this.height,this._ready=!1,e.data&&(this._ready=this.setWGS84Data(e.data.min,e.data.max,e.data.points))}Object.defineProperties(u.prototype,{url:{get:function(){return this._url}},tileWidth:{get:function(){if(this._ready)return this._tileWidth;throw new Cesium.DeveloperError("tileWidth must not be called before the imagery provider is ready.")}},tileHeight:{get:function(){if(this._ready)return this._tileHeight;throw new Cesium.DeveloperError("tileHeight must not be called before the imagery provider is ready.")}},maximumLevel:{get:function(){if(this._ready)return 0;throw new Cesium.DeveloperError("maximumLevel must not be called before the imagery provider is ready.")}},minimumLevel:{get:function(){if(this._ready)return 0;throw new Cesium.DeveloperError("minimumLevel must not be called before the imagery provider is ready.")}},tilingScheme:{get:function(){if(this._ready)return this._tilingScheme;throw new Cesium.DeveloperError("tilingScheme must not be called before the imagery provider is ready.")}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new Cesium.DeveloperError("tileDiscardPolicy must not be called before the imagery provider is ready.")}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}}}),u.prototype._setWidthAndHeight=function(e){this.width=0<e.east&&e.west<0?e.east+Math.abs(e.west):Math.abs(e.east-e.west),this.height=0<e.north&&e.south<0?e.north+Math.abs(e.south):Math.abs(e.north-e.south),this._factor=1,this.width>this.height&&2e3<this.width?(this._factor=this.width/2e3,this.height/this._factor<700&&(this._factor=this.height/700)):this.height>this.width&&2e3<this.height?(this._factor=this.height/2e3,this.width/this._factor<700&&(this._factor=this.width/700)):this.width<this.height&&this.width<700?(this._factor=this.width/700,2e3<this.height/this._factor&&(this._factor=this.height/2e3)):this.height<this.width&&this.height<700&&(this._factor=this.height/700,2e3<this.width/this._factor)&&(this._factor=this.width/2e3),this.width=this.width/this._factor,this.height=this.height/this._factor},u.prototype._getContainer=function(e,t,i){var r=document.createElement("div");return i&&r.setAttribute("id",i),r.setAttribute("style","width: "+e+"px; height: "+t+"px; margin: 0px; display: none;"),document.body.appendChild(r),r},u.prototype.wgs84ToMercator=function(e){return this._wmp.project(Cesium.Cartographic.fromDegrees(e.x,e.y))},u.prototype.wgs84ToMercatorBB=function(e){var t=this._wmp.project(Cesium.Cartographic.fromDegrees(e.east,e.north)),e=this._wmp.project(Cesium.Cartographic.fromDegrees(e.west,e.south));return{north:t.y,south:e.y,east:t.x,west:e.x}},u.prototype.mercatorToWgs84=function(e){e=this._wmp.unproject(new Cesium.Cartesian3(e.x,e.y));return{x:e.longitude,y:e.latitude}},u.prototype.mercatorToWgs84BB=function(e){var t=this._wmp.unproject(new Cesium.Cartesian3(e.west,e.south)),e=this._wmp.unproject(new Cesium.Cartesian3(e.east,e.north));return{north:this.rad2deg(e.latitude),east:this.rad2deg(e.longitude),south:this.rad2deg(t.latitude),west:this.rad2deg(t.longitude)}},u.prototype.deg2rad=function(e){return e*(Math.PI/180)},u.prototype.rad2deg=function(e){return e/(Math.PI/180)},u.prototype.wgs84PointToHeatmapPoint=function(e){return this.mercatorPointToHeatmapPoint(this.wgs84ToMercator(e))},u.prototype.mercatorPointToHeatmapPoint=function(e){var t={};return t.x=Math.round((e.x-this._xoffset)/this._factor+this._spacing),t.y=Math.round((e.y-this._yoffset)/this._factor+this._spacing),t.y=this.height-t.y,t},u.prototype.setData=function(e,t,i){return!!(i&&0<i.length&&null!==e&&!1!==e&&null!==t&&!1!==t)&&(this._heatmap.setData({min:e,max:t,data:i}),!0)},u.prototype.setWGS84Data=function(e,t,i){if(i&&0<i.length&&null!==e&&!1!==e&&null!==t&&!1!==t){for(var r=[],n=0;n<i.length;n++){var o=i[n],s=this.wgs84PointToHeatmapPoint(o);!o.value&&0!==o.value||(s.value=o.value),r.push(s)}return this.setData(e,t,r)}return!1},u.prototype.getTileCredits=function(e,t,i){},u.prototype.requestImage=function(e,t,i){if(this._ready)return Promise.resolve(this._image);throw new Cesium.DeveloperError("requestImage must not be called before the imagery provider is ready.")},u.prototype.pickFeatures=function(){};var Et=u;var Bt=class{constructor(e,t){if(this.viewer=e,this.type="2D",this.options=Object.assign({},t),!t.data.points||!t.data.points.length)throw new Cesium.DeveloperError("The Name of data Source is required.");this.options.dataBounds&&(this.dataRectangle=Cesium.Rectangle.fromDegrees(this.options.dataBounds.west,this.options.dataBounds.south,this.options.dataBounds.east,this.options.dataBounds.north)),this.updated=!0;var i=this;this.updateEvent=function(){i.update()},this.viewer.camera.moveEnd.addEventListener(this.updateEvent),this.update()}async update(){var e;this.heatmapProvider&&!this.updated||(this.updated=!1,(e=this.getViewBounds())&&(this.heatmap2DLayer&&this.clear(),this.options.bounds=e,this.updateEvent)&&(this.heatmapProvider=new Et(this.options),this.heatmap2DLayer=this.viewer.scene.imageryLayers.addImageryProvider(this.heatmapProvider),this.updated=!0))}getViewBounds(){var e=this.viewer.camera.computeViewRectangle();if(this.dataRectangle){var t=Cesium.Rectangle.intersection(this.dataRectangle,e);if(!t)return;this.currentRectangle=t}else this.currentRectangle=e;return{west:Cesium.Math.toDegrees(this.currentRectangle.west),east:Cesium.Math.toDegrees(this.currentRectangle.east),south:Cesium.Math.toDegrees(this.currentRectangle.south),north:Cesium.Math.toDegrees(this.currentRectangle.north)}}clear(){this.heatmapProvider&&(this.heatmapProvider._heatmap.setData({max:1,data:[]}),this.heatmapProvider._heatmap.removeData(),this.heatmapProvider=void 0),this.heatmap2DLayer&&(this.viewer.scene.imageryLayers.remove(this.heatmap2DLayer),this.heatmap2DLayer=null)}dispose(){this.updateEvent&&(this.viewer.camera.moveEnd.removeEventListener(this.updateEvent),this.updateEvent=null),this.clear()}},Mt=__webpack_require__(8477),It=__webpack_require__.n(Mt);Mt=class{constructor(e){this.viewer=Cesium.defaultValue(e,CIM.viewer),this.heatmapoptions={radius:50,maxOpacity:1,minOpacity:0,blur:.85,gradient:{.25:"rgb(000,000,255)",.55:"rgb(000,255,255)",.65:"rgb(000,255,000)",.98:"rgb(255,255,000)",1:"rgb(255,000,000)"}}}setConfig(e){Object.assign(this.heatmapoptions,e)}create(e){if(this.heatmap&&this.heatmap.dispose(),!Cesium.defined(e.points)||!e.points instanceof Array)throw new Cesium.DeveloperError("热力图需要points数组");e={data:e,heatmapoptions:this.heatmapoptions,heatmapJS:It()};this.heatmap=new Bt(this.viewer,e)}clear(){this.heatmap&&this.heatmap.dispose()}};let St=null;class Pt{constructor(e){this.viewer=e}pointDataReduction(e,t){var i=0,r=this.viewer.scene._globe._surface._tilesToRender,r=(r&&0<r.length&&(i=this.viewer.scene._globe._surface._tilesToRender[0]._level),(t||1)*Math.pow(2,20-i.toFixed(2)));this.Ra=r,this.MinPts=2,this.arr=[],this.value=new Array,this.Clusterid=1;for(var n=0;n<e.length;n++)this.arr[n]={},this.arr[n]=e[n],this.arr[n].x=e[n]?.position?._value?.x,this.arr[n].y=e[n]?.position?._value?.y,this.arr[n].vis=!1,this.arr[n].cluster=0;for(n=0;n<this.arr.length;n++)this.exec(n)&&this.Clusterid++;return this.Output()}exec(e){if(!this.arr[e].vis){this.arr[e].vis=!0;for(var t=0,i=[],r=0;r<this.arr.length;r++){var n=Math.pow(this.arr[e].x-this.arr[r].x,2),o=Math.pow(this.arr[e].y-this.arr[r].y,2);Math.pow(n+o,.5)<this.Ra&&(t++,i.push(r))}if(t>this.MinPts){this.arr[e].cluster=this.Clusterid;for(var s=0;s<i.length;s++)this.exec(i[s]);return!0}return i.length=t=0,!1}}Output(){for(var e=0;e<this.Clusterid;e++)this.value[e]=new Array;for(var t=0;t<this.arr.length;t++)this.value[this.arr[t].cluster].push(this.arr[t]);for(var i=[],t=0;t<this.value.length;t++)0!=t&&(i[t-1]=new Array,i[t-1]=this.value[t][0],delete i[t-1].vis,delete i[t-1].cluster);for(var r=Number(i.length),t=0;t<this.value[0].length;t++){var n=r+parseInt(t);i[n]=new Array,i[n]=this.value[0][t],delete i[n].vis,delete i[n].cluster}return i}}var Tt=class{constructor(e){this.viewer=e,this.utilTools=new Pt(this.viewer),this.list=[]}async setRenderer(e,t=1){var i=this;i.dataSource=e,i.distScale=t,i.dataSource.entities._entities._array.forEach(e=>{i.list.push(e)}),i.fucWheel(),St=i.fucWheel.bind(i),i.viewer.camera.moveEnd.addEventListener(St)}async fucWheel(){this.list.forEach(e=>{e.show=!1}),(await this.utilTools.pointDataReduction(this.list,this.distScale)).forEach(e=>{for(var t=0;t<this.list.length;t++)e.id===this.list[t].id&&(this.list[t].show=!0)})}resetRenderer(){this.viewer.camera.moveEnd.removeEventListener(St),this.list=[]}},Lt=__webpack_require__(8151);z={LabelAvoidRenderer:class{constructor(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.dataSource=e.dataSource,this.viewer=Cesium.defaultValue(e.viewer,CIM.viewer),this.offsetX=Cesium.defaultValue(e.offsetX,0),this.offsetY=Cesium.defaultValue(e.offsetY,0),this._removeEventListener=void 0,this.initialize()}initialize(){if(!this.dataSource)throw new Cesium.RuntimeError("dataSource is undefined");this._removeEventListener&&this._removeEventListener();let i=this.dataSource;const r=this;this._removeEventListener=this.viewer.camera.changed.addEventListener(()=>{var e=i.entities.values,t=e[0].label&&0<e[0].label.text._value.length?"label":"billboard";r._avoidLalelOverlap(e,this.offsetX,this.offsetY,t)})}_avoidLalelOverlap(t,i,r,o="billboard"){if(t&&0!==t.length){var s=[];for(let n=0;n<t.length;n++){var a=t[n];if(!a.position)throw new Cesium.RuntimeError("entity position is undefined");var l=Cesium.SceneTransforms.wgs84ToDrawingBufferCoordinates(this.viewer.scene,a.position._value);if(l){var u,c=a.billboard;let e,t;if("billboard"===o&&(e=c.width._value??c.width,t=c.height._value??c.height,u=c.scale??1,e*=u,t*=u),"label"===o&&(u=writeTextToCanvas(a.label.text._value,{font:a.label.font._value}),e=u.width,t=u.height,a.label.width=e,a.label.height=t),!e)throw new Cesium.RuntimeError("width is undefined");if(!t)throw new Cesium.RuntimeError("height is undefined");let i=l.x;var h=c.horizontalOrigin?c.horizontalOrigin._value:Cesium.HorizontalOrigin.CENTER;h===Cesium.HorizontalOrigin.RIGHT?i-=e:h===Cesium.HorizontalOrigin.CENTER&&(i-=e/2);let r=l.y;h=c.verticalOrigin._value||Cesium.VerticalOrigin.CENTER;h===Cesium.VerticalOrigin.BOTTOM||h===Cesium.VerticalOrigin.BASELINE?r-=t/2:h===Cesium.VerticalOrigin.TOP&&(r+=t/2),l&&s.push({index:n,entity:a,coord:{x:i,y:r},hide:!1})}}var n=new Lt.Z(s.length,64,Uint32Array);for(let e=0;e<s.length;e++)n.add(s[e].coord.x,s[e].coord.y);n.finish();for(let e=0;e<t.length;e++){var A=t[e];"billboard"===o?A.billboard.show=!0:"label"===o&&(A.label.show=!0)}for(let e=0;e<s.length;e++){var p=s[e];if(!p.hide){let e;"billboard"===o&&(e=this._getScreenSpaceBoundingBox(p.entity.billboard,p.coord,i,r)),"label"===o&&(e=this._getScreenSpaceBoundingBox(p.entity.label,p.coord,i,r));var f=n.range(e.minx,e.miny,e.maxx,e.maxy);for(let e=0;e<f.length;e++){var d=s[f[e]];p.coord.x===d.coord.x&&p.coord.y===d.coord.y||("billboard"===o?d.entity.billboard.show=!1:"label"===o&&(d.entity.label.show=!1),d.hide=!0)}}}}}_getScreenSpaceBoundingBox(e,t,i=0,r=0){var n=e.width,o=e.height,e=e.scale??1,s=t.x,t=t.y;return{minx:s-i,maxx:s+(n*=e)+i,miny:t-(o*=e)-r,maxy:t+o+r}}destroy(){var t=this.dataSource.entities.values;for(let e=0;e<t.length;e++){var i=t[e];i.billboard&&(i.billboard.show=!0),i.label&&(i.label.show=!0)}this._removeEventListener&&this._removeEventListener()}},ClusterRenderer:z.Z,Renderer:W,HighlightHelper:Z,VideoFusion:t,StyleCondition:Y,Color:X.Z,ColorRamp:i,SilhouettePick:r,ReplaceTextrue:pe,ParseMaterial:he,BloomStage:ye,b3dmCustomShader:e,WaterRender:class{constructor(e,t){this.viewer=Cesium.defaultValue(e,CIM.viewer),this.options=t,this.positions=void 0,this.material=void 0,this.reflection=void 0}getOptions(){return{type:Cesium.defaultValue(this.options.type,"myWater"),baseWaterColor:Cesium.defaultValue(Cesium.Color.fromCssColorString(this.options.baseWaterColor),Cesium.Color.fromCssColorString("#006ab4")),normalMap:this.options.normalMap,frequency:Cesium.defaultValue(this.options.frequency,100),animationSpeed:Cesium.defaultValue(this.options.animationSpeed,.01),amplitude:Cesium.defaultValue(this.options.amplitude,10),flowdirection:Cesium.defaultValue(this.options.flowdirection,1),specularIntensity:Cesium.defaultValue(this.options.specularIntensity,.5),reflectIndesity:Cesium.defaultValue(this.options.reflectIndesity,.9),distortion:this.options._distortion,foamIntensity:this.options.foamIntensity}}init(e,t){this.positions=e;e=this.createGeometry(e,t);this.createInstance(e),this.addPrimitive(),this.addWaterReflection()}createGeometry(e,t){return new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(e,t),vertexFormat:Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,perPositionHeight:!0})}getAppearance(){return new Cesium.EllipsoidSurfaceAppearance({material:new Pe(this.getOptions()).material,vertexShaderSource:`
            //attribute属性只读，只出现在顶点着色器中
            //顶点坐标
            in vec3 position3DHigh;
            in vec3 position3DLow;
            // in vec3 position;
            //batchId
            in float batchId;
            //纹理顶点
            in vec2 st;
            //顶点颜色
            // in vec4 color;
            //顶点法线
            in vec3 normal;

            

            out vec3 v_positionEC;
            out vec3 v_normalEC;
            out vec2 v_st;
            out vec4 v_color;   
            out vec3 v_positionMC;
           
            void main(){
                v_positionMC = position3DHigh + position3DLow;
                vec4 positionWC  = czm_computePosition(); //世界坐标
                // v_positionMC = czm_inverseModel * positionWC; //模型坐标
                v_positionEC = (czm_modelViewRelativeToEye * positionWC).xyz; //相机坐标
                // v_color = color; //顶点颜色
                v_st = st; //纹理坐标
                v_normalEC = czm_normal * normal;//相机坐标下的法线
                gl_Position = czm_modelViewProjectionRelativeToEye * positionWC;
                //gl_Position =  czm_projection * czm_view * czm_model * vec4(v_positionMC,1.0) ;
            }
`,fragmentShaderSource:`
in vec3 v_positionMC;
in vec3 v_positionEC;
in vec2 v_st;
czm_material material; 
czm_materialInput materialInput;
vec3 lightVector1;
//求光照方向与片元法向量的点积，两个向量角度越大，散射因子越小，使用max避免出现负数没有意义
float czm_getLambertDiffuse1(vec3 lightDirectionEC, vec3 normalEC)
{
    return max(dot(lightDirectionEC, normalEC), 0.0);
}
float czm_private_getLambertDiffuseOfMaterial1(vec3 lightDirectionEC, czm_material material)
{
    return czm_getLambertDiffuse1(lightDirectionEC, material.normal);
}
//镜面反射光因子
float czm_getSpecular1(vec3 lightDirectionEC, vec3 toEyeEC, vec3 normalEC, float shininess)
{
    vec3 toReflectedLight = reflect(-lightDirectionEC, normalEC);
    float specular = max(dot(toReflectedLight, toEyeEC), 0.0);

    // pow has undefined behavior if both parameters <= 0. 
    // Prevent this by making sure shininess is at least czm_epsilon2.
    return pow(specular, max(shininess, czm_epsilon2));
}

float czm_private_getSpecularOfMaterial1(vec3 lightDirectionEC, vec3 toEyeEC, czm_material material)
{
    return czm_getSpecular1(lightDirectionEC, toEyeEC, material.normal, material.shininess);
}
vec4 czm_phong1(vec3 toEye, czm_material material, vec3 lightDirectionEC)
{
    // Diffuse from directional light sources at eye (for top-down)
    float diffuse = czm_private_getLambertDiffuseOfMaterial1(vec3(0.0, 0.0, 1.0), material);
    if (czm_sceneMode == czm_sceneMode3D) {
        // (and horizon views in 3D)
        diffuse += czm_private_getLambertDiffuseOfMaterial1(vec3(0.0, 1.0, 0.0), material);
    }

	

    float specular = czm_private_getSpecularOfMaterial1(lightDirectionEC, toEye, material);
	float specularStrength = 0.5;
	vec3 specular1 = specularStrength * specular * czm_lightColor;

    // Temporary workaround for adding ambient.
	// 
	vec3 waterColor = vec3(64.0/255.0, 157.0/255.0, 253.0/255.0);
    vec3 materialDiffuse = waterColor * 0.5 * czm_lightColor; //材质本身的颜色 * 因子 * 光照颜色

	vec3 diffuse1 = materialDiffuse * diffuse * czm_lightColor; //散射的颜色 = 材质的颜色 * 散射因子 * 光的颜色

	// vec3 ambient = ambientStrength * lightColor;
    // vec3 result = ambient * objectColor;
    vec3 ambient = materialDiffuse;//环境光=材质本身的颜色
    // vec3 color = ambient + material.emission; // 光热的颜色？
    // color += materialDiffuse * diffuse * czm_lightColor;
    // color += material.specular * specular * czm_lightColor;
	vec3 color = (ambient + material.emission + diffuse1 + specular1) * czm_lightColor; //冯氏光照

    return vec4(color, material.alpha);
}


//一块光滑的平面不会出现漫反射的，只有镜面反射高光的现象

void main()
{
    vec3 positionMC = (czm_inverseModelView * vec4(v_positionEC, 1.0)).xyz;

    
	
    //在相机坐标系下,材质的法向量
	vec3 normalEC = normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0))); 
	#ifdef FACE_FORWARD
		normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);
	#endif
	materialInput.s = v_st.s;
    vec3 positionToEyeEC = -v_positionEC;
	materialInput.positionToEyeEC = positionToEyeEC;
	materialInput.st = v_st;
	materialInput.str = vec3(v_st, 0.0);
	materialInput.normalEC = normalEC;
    // 根据材质的模型坐标，相机坐标系下的材质的法线向量，生成转换到相机坐标系的矩阵：
	materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC); 
    // czm_material material = czm_getMaterial(materialInput);
    material = czm_getMaterial(materialInput);
    // lightVector1 = (czm_view * vec4(czm_sunPositionWC,1.0)).xyz - v_positionEC.xyz;
    // lightVector1 = normalize(lightVector1);
    // #ifdef FLAT
    //     out_FragColor = vec4(material.diffuse + material.emission, material.alpha); //czm_lightDirectionEC
    // #else
    //     out_FragColor = czm_phong(normalize(positionToEyeEC), material, lightVector1);
    // #endif
    out_FragColor = getBaseWaterColor(); //
}`,renderState:{cull:!1},aboveGround:!1,translucent:!0})}updateWaterAppearance(){this.addPrimitive(),this.addWaterReflection()}updateWaterHeight(e){this.waterHeight=e,this.addPrimitive(),this.addWaterReflection()}createInstance(e){this.geometry=e,this.instance=new Cesium.GeometryInstance({geometry:this.geometry||this.polygon})}addPrimitive(){this.removePrimitive(),this.waterPrimitive=new Cesium.Primitive({geometryInstances:this.instance,appearance:this.getAppearance()}),this.viewer.scene.primitives.add(this.waterPrimitive)}addWaterReflection(){this.reflection&&this.reflection.clear(),this.viewer&&this.waterPrimitive?(this.reflection=new Te({viewer:this.viewer,waterPolygon:this.waterPrimitive,options:this.options}),this.reflection.addReflection(this.positions),this.viewer.scene.requestRender(),setTimeout(()=>{},100)):console.error("添加水面倒影失败！")}removePrimitive(){this.waterPrimitive&&(this.reflection.clear(),this.viewer.scene.primitives.remove(this.waterPrimitive))}getPrimitive(){return this.waterPrimitive}destroy(){this.removePrimitive(),this.geometry=void 0,this.instance=void 0,this.waterPrimitive=void 0}},BaseModel:Fe,Light:class extends Fe{constructor(e,t){super(e,t),this.RectangularBloomLight=new Oe(e,t)}addLightPoint(e,t=6e-4,i=6e-4){var r=super.getConfig();t=Cesium.defaultValue(r.deltaX,t),i=Cesium.defaultValue(r.deltaY,i),this.RectangularBloomLight.add(e,t,i),De.filterByGrid(e,t,i).forEach(e=>{this.addPrimitive(e)})}destory(){super.destory(),this.RectangularBloomLight.destroy()}},cloud:Re,CustomIBL:Ge,PrimitiveStyle:o.Z,WindField:Ze,HeatmapRender:Mt,RarefyRenderer:Tt};W=new class{getDomTopLeft(e){for(var t=e.offsetTop,i=e.offsetLeft,r=e.offsetParent;null!==r;)t+=r.offsetTop,i+=r.offsetLeft,r=r.offsetParent;return{left:i,top:t}}downloadByA(e,t){var i=document.createElement("a");i.download=t,i.target="_blank",i.style.display="none",i.href=e,document.body.appendChild(i),i.click(),document.body.removeChild(i)}};t=class{connect(){}disconnect(){}sendPositionMsg(){}responsePositionChange(){}};Y=class{createChart(e,t){}buildChartOption(e,t,i,r,n){return{title:{text:e,textStyle:{color:"#b6dbe9"}},tooltip:{},legend:{data:t,x:"right",padding:[25,45,0,0],textStyle:{color:"#b6dbe9"}},xAxis:{data:r,axisLabel:{color:"#FFE32C",interval:0,rotate:15,fontSize:"14px"},axisLine:{show:!0,symbol:["none","arrow"],symbolSize:[8,8],symbolOffset:[0,7],lineStyle:{color:"#FFE32C",width:1,type:"solid"}}},grid:i,yAxis:{axisLabel:{color:"#FFE32C"},axisLine:{show:!0,symbol:["none","arrow"],symbolSize:[8,8],symbolOffset:[0,7],lineStyle:{color:"#FFE32C",width:1,type:"solid"}}},series:n}}};i=class{constructor(e){this.viewer=e,this.listen=null}add(e,t,i){let r=this,n={dom:e,position:t,distanceDisplayCondition:i&&i.distanceDisplayCondition,xoffset:i?.xoffset||0,yoffset:i?.yoffset||0};this.listen&&this.remove(),this.listen=function(){r.refreshPosition(n)},r.viewer.scene.postRender.addEventListener(this.listen)}refreshPosition(e){this.viewer.scene.canvas.height;var t=new Cesium.Cartesian2,i=(Cesium.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,e.position,t),e.dom.style.position="absolute",e.dom.style.top=t.y-e.dom.offsetHeight-e.yoffset+"px",e.dom.offsetWidth||e.dom.scrollWidth);e.dom.style.left=t.x-i/2-e.xoffset+"px",e.distanceDisplayCondition&&(this.viewer.camera.positionCartographic.height>e.distanceDisplayCondition?e.dom.style.display="block":e.dom.style.display="none")}remove(){this.viewer.scene.postRender.removeEventListener(this.listen)}};var r=class{constructor(e){if(this===window)throw"Colorpicker: Can't call a function directly";this.init(e)}init(e){let{el:r,offset:n,initColor:t="rgb(255,0,0)",allMode:i=["hex","rgb"],color:o=""}=e;var s=document.getElementById(r);if(!s||!s.nodeType||1!==s.nodeType)throw`Colorpicker: not found  ID:${r}  HTMLElement,not `+{}.toString.call(r);this.Opt={...e,el:r,offset:n,initColor:t,allMode:i,color:o},this.bindElem=s,this.elem_wrap=null,this.fixedBg=null,this.elem_colorPancel=null,this.elem_picker=null,this.elem_barPicker1=null,this.elem_hexInput=null,this.elem_showColor=null,this.elem_showModeBtn=null,this.elem_inputWrap=null,this.pancelLeft=0,this.pancelTop=0,this.downX=0,this.downY=0,this.moveX=0,this.moveY=0,this.pointLeft=0,this.pointTop=0,this.current_mode="hex",this.rgba={r:0,g:0,b:0,a:1},this.hsb={h:0,s:100,b:100};var a=this,e=t.slice(4,-1).split(","),s=(this.rgba.r=parseInt(e[0]),this.rgba.g=parseInt(e[1]),this.rgba.b=parseInt(e[2]),document.getElementsByTagName("body")[0]),l=document.createElement("div");l.innerHTML=this.render(),s.appendChild(l),this.elem_wrap=l,this.fixedBg=l.children[0],this.elem_colorPancel=l.getElementsByClassName("color-pancel")[0],this.pancel_width=this.elem_colorPancel.offsetWidth,this.pancel_height=this.elem_colorPancel.offsetHeight,this.elem_picker=l.getElementsByClassName("pickerBtn")[0],this.elem_colorPalette=l.getElementsByClassName("color-palette")[0],this.elem_showColor=l.getElementsByClassName("colorpicker-showColor")[0],this.elem_barPicker1=l.getElementsByClassName("colorBar-color-picker")[0],this.elem_hexInput=l.getElementsByClassName("colorpicker-hexInput")[0],this.elem_showModeBtn=l.getElementsByClassName("colorpicker-showModeBtn")[0],this.elem_inputWrap=l.getElementsByClassName("colorpicker-inputWrap")[0],this.elem_okBtn=l.getElementsByClassName("colorpicker-okBtn")[0],this.elem_cancelBtn=l.getElementsByClassName("colorpicker-cancelBtn")[0],this.bindMove(this.elem_colorPancel,this.setPosition,!0),this.bindMove(this.elem_barPicker1.parentNode,this.setBar,!1);let u=document.documentElement.clientHeight||document.body.clientHeight;this.bindElem.addEventListener("click",function(){for(var e=document.getElementById(r),t=e.offsetTop,i=e.offsetLeft;e.offsetParent;)t+=e.offsetParent.offsetTop,i+=e.offsetParent.offsetLeft,e=e.offsetParent;n=n||0,t=u-t-88<180?t-88-180:t-n,a.pancelLeft=i+180,a.pancelTop=t+a.bindElem.offsetHeight,a.css(l,{position:"absolute","z-index":999,display:"none",left:i+"px",top:t+a.bindElem.offsetHeight+"px"}),a.show()},!1),this.fixedBg.addEventListener("click",function(e){a.hide()},!1),this.elem_showModeBtn.addEventListener("click",function(){a.switch_current_mode()},!1),this.elem_wrap.addEventListener("input",function(e){e=e.target.value;a.setColorByInput(e)},!1),this.elem_colorPalette.addEventListener("click",function(e){if("p"==e.target.tagName.toLocaleLowerCase()){var t=e.target.style.background,e=t.slice(4,-1).split(","),i={r:parseInt(e[0]),g:parseInt(e[1]),b:parseInt(e[2])};switch(a.current_mode){case"hex":a.setColorByInput("#"+a.rgbToHex(i));break;case"rgb":var r=a.elem_wrap.getElementsByTagName("input");r[0].value=i.r,r[1].value=i.g,r[2].value=i.b,a.setColorByInput(t)}}},!1),this.elem_okBtn.addEventListener("click",function(e){a.rgba&&a.setValue(a.rgba),a.hide()},!1),this.elem_cancelBtn.addEventListener("click",function(e){a.hide()},!1)}render(){return`<div style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 1000px;"></div>
				<div style="position: inherit;z-index: 100;display: flex;box-shadow: rgba(0, 0, 0, 0.3) 0px 0px 2px, rgba(0, 0, 0, 0.3) 0px 4px 8px;">
					<div style='width:180px;padding:10px;background: #f9f9f9;display: flex;flex-flow: row wrap;align-content: space-around;justify-content: space-around;' class='color-palette'>
						${this.getPaletteColorsItem()}
					</div>
					<div class="colorpicker-pancel" style="background: rgb(255, 255, 255);box-sizing: initial; width: 225px;">
						<div style="width: 100%; padding-bottom: 55%; position: relative; border-radius: 2px 2px 0px 0px; overflow: hidden;">
							<div class="color-pancel" style="position: absolute; top: 0px; right: 0px; bottom: 0px; left: 0px; background: rgb(${this.rgba.r},${this.rgba.g},${this.rgba.b})">
								<style>
									.saturation-white {background: -webkit-linear-gradient(to right, #fff, rgba(255,255,255,0));background: linear-gradient(to right, #fff, rgba(255,255,255,0));}
									.saturation-black {background: -webkit-linear-gradient(to top, #000, rgba(0,0,0,0));background: linear-gradient(to top, #000, rgba(0,0,0,0));}
								</style>
								<div class="saturation-white" style="position: absolute; top: 0px; right: 0px; bottom: 0px; left: 0px;">
									<div class="saturation-black" style="position: absolute; top: 0px; right: 0px; bottom: 0px; left: 0px;">
									</div>
									<div class="pickerBtn" style="position: absolute; top: 0%; left: 100%; cursor: default;">
										<div style="width: 12px; height: 12px; border-radius: 6px; box-shadow: rgb(255, 255, 255) 0px 0px 0px 1px inset; transform: translate(-6px, -6px);">
										</div>
									</div>
								</div>
							</div>
						</div>
						<div style="padding: 0 16px 20px;">
							<div class="flexbox-fix" style="display: flex;align-items: center;height: 40px;">
								<div style="width: 32px;">
									<div style="width: 16px; height: 16px; border-radius: 8px; position: relative; overflow: hidden;">
										<div class="colorpicker-showColor" style="position: absolute; top: 0px; right: 0px; bottom: 0px; left: 0px; border-radius: 8px; box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 0px 1px inset; background:rgb(${this.rgba.r},${this.rgba.g},${this.rgba.b}); z-index: 2;"></div>
										<div class="" style="position: absolute; top: 0px; right: 0px; bottom: 0px; left: 0px; background: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==&quot;) left center;"></div>
									</div>
								</div>
								<div style="-webkit-box-flex: 1; flex: 1 1 0%;"><div style="height: 10px; position: relative;">
									<div style="position: absolute; top: 0px;right: 0px; bottom: 0px; left: 0px;">
										<div class="hue-horizontal" style="padding: 0px 2px; position: relative; height: 100%;">
											<style>
												.hue-horizontal {background: linear-gradient(to right, #f00 0%, #ff0 17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);background: -webkit-linear-gradient(to right, #f00 0%, #ff0 17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);}
												.hue-vertical {background: linear-gradient(to top, #f00 0%, #ff0 17%, #0f0 33%,#0ff 50%, #00f 67%, #f0f 83%, #f00 100%);background: -webkit-linear-gradient(to top, #f00 0%, #ff0 17%,#0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);}
											</style>
											<div  class="colorBar-color-picker" style="position: absolute; left: 0%;">
												<div style="width: 12px; height: 12px; border-radius: 6px; transform: translate(-6px, -1px); background-color: rgb(248, 248, 248); box-shadow: rgba(0, 0, 0, 0.37) 0px 1px 4px 0px;">
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="flexbox-fix" style="display: flex;">
							<div class="flexbox-fix colorpicker-inputWrap" style="-webkit-box-flex: 1; flex: 1 1 0%; display: flex; margin-left: -6px;">
									${this.getInputTpl()}
							</div>
							<div class="colorpicker-showModeBtn" style="width: 32px; text-align: right; position: relative;">
								<div style="margin-right: -4px;  cursor: pointer; position: relative;">
									<svg viewBox="0 0 24 24" style="width: 24px; height: 24px; border: 1px solid transparent; border-radius: 5px;"><path fill="#333" d="M12,5.83L15.17,9L16.58,7.59L12,3L7.41,7.59L8.83,9L12,5.83Z"></path><path fill="#333" d="M12,18.17L8.83,15L7.42,16.41L12,21L16.59,16.41L15.17,15Z"></path></svg>
								</div>
							</div>
						</div>
						<div style="display: flex;margin-top:10px"> 
						  <button class="colorpicker-okBtn type="button" style="width: 100px;height: 22px;position: relative;border-width: 1px;border-radius: 3px;background: white;">确认</button> 
						  <button class="colorpicker-cancelBtn type="button" style="width: 100px;height: 22px;position: relative;margin-left: 20px;border-width: 1px;border-radius: 3px;background: white;cursor: pointer;">取消</button> 
						</div>
					</div>
				</div>
			</div>`}getInputTpl(){var e="";switch(this.current_mode){case"hex":e+=`
							<div style="padding-left: 6px; width: 100%;">
								<div style="position: relative;">
									<input class="colorpicker-hexInput" value="${"#"+this.rgbToHex(this.HSBToRGB(this.hsb))}" spellcheck="false" style="font-size: 11px; color: rgb(51, 51, 51); width: 100%; border-radius: 2px; border: none; box-shadow: rgb(218, 218, 218) 0px 0px 0px 1px inset; height: 21px; text-align: center;">
									<span style="text-transform: uppercase; font-size: 11px; line-height: 11px; color: rgb(150, 150, 150); text-align: center; display: block; margin-top: 12px;">hex</span>
								</div>
							</div>`;break;case"rgb":for(var t=0;t<3;t++)e+=`<div style="padding-left: 6px; width: 100%;">
								<div style="position: relative;">
									<input class="colorpicker-hexInput" value="${this.rgba["rgb"[t]]}" spellcheck="false" style="font-size: 11px; color: rgb(51, 51, 51); width: 100%; border-radius: 2px; border: none; box-shadow: rgb(218, 218, 218) 0px 0px 0px 1px inset; height: 21px; text-align: center;">
									<span style="text-transform: uppercase; font-size: 11px; line-height: 11px; color: rgb(150, 150, 150); text-align: center; display: block; margin-top: 12px;">${"rgb"[t]}</span>
								</div>
							</div>`}return e}getPaletteColorsItem(){let t="";return["rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(204, 204, 204)","rgb(217, 217, 217)","rgb(255, 255, 255)","rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)","rgb(230, 184, 175)","rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(201, 218, 248)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)","rgb(221, 126, 107)","rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(164, 194, 244)","rgb(159, 197, 232)","rgb(180, 167, 214)"].forEach(e=>t+=`<p style='width:20px;height:20px;background:${e};margin:0 5px;border: solid 1px #d0d0d0;'></p>`),t}setPosition(e,t){e=parseInt(e-this.pancelLeft),t=parseInt(t-this.pancelTop);this.pointLeft=Math.max(0,Math.min(e,this.pancel_width)),this.pointTop=Math.max(0,Math.min(t,this.pancel_height)),this.css(this.elem_picker,{left:this.pointLeft+"px",top:this.pointTop+"px"}),this.hsb.s=parseInt(100*this.pointLeft/this.pancel_width),this.hsb.b=parseInt(100*(this.pancel_height-this.pointTop)/this.pancel_height),this.setShowColor()}setBar(e,t){var i=e.getElementsByTagName("div")[0],r=e.getBoundingClientRect(),e=e.offsetWidth,t=Math.max(0,Math.min(t-r.x,e));i===this.elem_barPicker1?(this.css(i,{left:t+"px"}),this.hsb.h=parseInt(360*t/e)):(this.css(i,{left:t+"px"}),this.rgba.a=t/e),this.setPancelColor(this.hsb.h),this.setShowColor()}setPancelColor(e){e=this.HSBToRGB({h:e,s:100,b:100});this.css(this.elem_colorPancel,{background:"rgba("+e.r+","+e.g+","+e.b+","+this.rgba.a+")"})}setShowColor(){var e=this.HSBToRGB(this.hsb);this.rgba.r=e.r,this.rgba.g=e.g,this.rgba.b=e.b,this.css(this.elem_showColor,{background:"rgba("+e.r+","+e.g+","+e.b+","+this.rgba.a+")"})}setValue(e){e="#"+this.rgbToHex(e);this.elem_inputWrap.innerHTML=this.getInputTpl(),this.Opt.change(this.bindElem,e)}setColorByInput(e){switch(this.current_mode){case"hex":3==(e=e.slice(1)).length?(e="#"+e[0]+e[0]+e[1]+e[1]+e[2]+e[2],this.hsb=this.hexToHsb(e)):6==e.length&&(this.hsb=this.hexToHsb(e));break;case"rgb":var t=this.elem_wrap.getElementsByTagName("input"),t={r:t[0].value?parseInt(t[0].value):0,g:t[1].value?parseInt(t[1].value):0,b:t[2].value?parseInt(t[2].value):0};this.hsb=this.rgbToHsb(t)}this.changeViewByHsb()}changeViewByHsb(){this.pointLeft=parseInt(this.hsb.s*this.pancel_width/100),this.pointTop=parseInt((100-this.hsb.b)*this.pancel_height/100),this.css(this.elem_picker,{left:this.pointLeft+"px",top:this.pointTop+"px"}),this.setPancelColor(this.hsb.h),this.setShowColor(),this.css(this.elem_barPicker1,{left:this.hsb.h/360*this.elem_barPicker1.parentNode.offsetWidth+"px"})}switch_current_mode(){this.current_mode="hex"==this.current_mode?"rgb":"hex",this.elem_inputWrap.innerHTML=this.getInputTpl()}bindMove(t,r,n){var o=this;t.addEventListener("mousedown",function(e){function i(e){o.moveX=e.pageX,o.moveY=e.pageY,n?r.call(o,o.moveX,o.moveY):r.call(o,t,o.moveX,o.moveY),e.preventDefault()}o.downX=e.pageX,o.downY=e.pageY,n?r.call(o,o.downX,o.downY):r.call(o,t,o.downX,o.downY),document.addEventListener("mousemove",i,!1),document.addEventListener("mouseup",function e(t){o.rgbToHex(o.HSBToRGB(o.hsb));document.removeEventListener("mousemove",i,!1);document.removeEventListener("mouseup",e,!1);o.elem_inputWrap.innerHTML=o.getInputTpl()},!1)},!1)}show(){this.css(this.elem_wrap,{display:"block"})}hide(){this.css(this.elem_wrap,{display:"none"})}HSBToRGB(e){var t,i={},r=Math.round(e.h),n=Math.round(255*e.s/100),e=Math.round(255*e.b/100);return 0==n?i.r=i.g=i.b=e:(e=r%60*((t=e)-(n=(255-n)*e/255))/60,(r=360==r?0:r)<60?(i.r=t,i.b=n,i.g=n+e):r<120?(i.g=t,i.b=n,i.r=t-e):r<180?(i.g=t,i.r=n,i.b=n+e):r<240?(i.b=t,i.r=n,i.g=t-e):r<300?(i.b=t,i.g=n,i.r=n+e):r<360?(i.r=t,i.g=n,i.b=t-e):(i.r=0,i.g=0,i.b=0)),{r:Math.round(i.r),g:Math.round(i.g),b:Math.round(i.b)}}rgbToHex(e){var i=[e.r.toString(16),e.g.toString(16),e.b.toString(16)];return i.map(function(e,t){1==e.length&&(i[t]="0"+e)}),i.join("")}hexToRgb(e){return{r:(e=parseInt(-1<e.indexOf("#")?e.substring(1):e,16))>>16,g:(65280&e)>>8,b:255&e}}hexToHsb(e){return this.rgbToHsb(this.hexToRgb(e))}rgbToHsb(e){var t={h:0,s:0,b:0},i=Math.min(e.r,e.g,e.b),r=Math.max(e.r,e.g,e.b),i=r-i;return t.b=r,t.s=0!=r?255*i/r:0,0!=t.s?e.r==r?t.h=(e.g-e.b)/i:e.g==r?t.h=2+(e.b-e.r)/i:t.h=4+(e.r-e.g)/i:t.h=-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t}css(e,t){for(var i in t)e.style[i]=t[i]}hasClass(e,t){return-1!=e.getAttribute("class").indexOf(t)}},e=__webpack_require__(8621),Dt=__webpack_require__.n(e);function Ft(e,t){var i=e&&e.a,r=e&&e.hsl?Dt()(e.hsl):e&&e.hex&&0<e.hex.length?Dt()(e.hex):e&&e.hsv?Dt()(e.hsv):e&&e.rgba?Dt()(e.rgba):e&&e.rgb?Dt()(e.rgb):Dt()(e),i=(!r||void 0!==r._a&&null!==r._a||r.setAlpha(i||1),r.toHsl()),n=r.toHsv();return 0===i.s&&(n.h=i.h=e.h||e.hsl&&e.hsl.h||t||0),{hsl:i,hex:r.toHexString().toUpperCase(),hex8:r.toHex8String().toUpperCase(),rgba:r.toRgb(),hsv:n,oldHue:e.h||t||i.h,source:e.source,a:e.a||r.getAlpha()}}Ge={props:["value"],data(){return{val:Ft(this.value)}},computed:{colors:{get(){return this.val},set(e){this.val=e,this.$emit("input",e)}}},watch:{value(e){this.val=Ft(e)}},methods:{colorChange(e,t){this.oldHue=this.colors.hsl.h,this.colors=Ft(e,t||this.oldHue)},isValidHex(e){return Dt()(e).isValid()},simpleCheckForValidColor(e){for(var t=["r","g","b","a","h","s","l","v"],i=0,r=0,n=0;n<t.length;n++){var o=t[n];e[o]&&(i++,isNaN(e[o])||r++)}if(i===r)return e},paletteUpperCase(e){return e.map(e=>e.toUpperCase())},isTransparent(e){return 0===Dt()(e).getAlpha()}}};function Nt(e){return("0"+e.toString(16)).slice(-2)}const Ot=e=>{var{r:t,g:i,b:r}=e,e=e["a"],t=Math.floor(t*e),i=Math.floor(i*e),r=Math.floor(r*e);return"#"+Nt(t)+Nt(i)+Nt(r)};const Rt=e=>{var{containerDom:e,color:t,colors:i,point:r}=e;let n=e;var o,e=r,r=7*i[0].length+2,r=(n||(o=document.createElement("div"),n=o),e.x+r+25>window.innerWidth&&(e.x-=25+r),e.y+r+40>window.innerHeight&&(e.y-=40+r),n.style=`
    position: fixed;
    left: ${e.x+5}px;
    top: ${e.y}px;
    z-index: 10001;
    pointer-events: none;
  `,n.innerHTML="",o=i,r=7,e=document.createElement("div"),i=document.createElement("div"),o=function(e,r){const t=e.length,i=r*t,n=i/2,{canvas:o,ctx:s}=Ut({width:i,height:i,scale:2,attrs:{style:"border-radius: 50%;"}});if(s){e.forEach((e,i)=>e.forEach((e,t)=>{s.fillStyle=e,s.fillRect(t*r,i*r,r,r)}));for(let e=0;e<t;e+=1)s.beginPath(),s.strokeStyle="#eee",s.lineWidth=.6,s.moveTo(0,e*r),s.lineTo(i,e*r),s.stroke();for(let e=0;e<t;e+=1)s.beginPath(),s.strokeStyle="#eee",s.lineWidth=.6,s.moveTo(e*r,0),s.lineTo(e*r,i),s.stroke();return s.beginPath(),s.strokeStyle="#ddd",s.arc(n,n,n,0,2*Math.PI),s.stroke(),s.strokeStyle="#000",s.lineWidth=1,s.strokeRect(n-r/2,n-r/2,r,r),o}}(o,r),e.style="position: relative;",i.style=`
    position: absolute;
    top: 0;
    left: 0;
    width: ${o.width/2}px;
    height: ${o.height/2}px;
    border-radius: 50%;
    box-shadow: 0 0 10px 10px rgba(150,150,150,0.2) inset;
  `,e.appendChild(o),e.appendChild(i),e),t=(i=t,(e=document.createElement("div")).style=`
    display: flex;
    align-items: center;
    background-color: rgba(0,0,0,0.4);
    padding: 2px 4px;
    border-radius: 3px;
  `,e.innerHTML=`
    <div style="
      width: 20px;
      height: 20px;
      background-color: ${i};
      border-radius: 3px;
      border: 1px solid #eee;
    "></div>
    <div style="
      width: 65px;
      border-radius: 3px;
      color: #fff;
      margin-left: 4px;
    ">${i}</div>
  `,e),i=document.createElement("div");return i.style="height: 3px;",n.appendChild(r),n.appendChild(i),n.appendChild(t),n};function Ut({width:e=0,height:t=0,scale:i=1,attrs:r={}}){const n=document.createElement("canvas");Object.keys(r).forEach(e=>{var t=r[e];n.setAttribute(e,t)}),n.setAttribute("width",""+e*i),n.setAttribute("height",""+t*i),n.style=`${r.style||""};width: ${e}px;height: ${t}px;`;e=n.getContext("2d");return e&&e.scale&&e.scale(i,i),{canvas:n,ctx:e}}const kt=(e,t,i=1)=>{var{x:r,y:n,width:o,height:s}=t,e=e.getImageData(r*i,n*i,o*i,s*i)["data"],[a,r,l=1]=[e,t,i],u=[],{width:c,height:h}=r;for(let t=0;t<h;t+=1){u[t]||(u[t]=[]);var A=t*c*4*l*l;for(let e=0;e<c;e+=1){var p=A+4*e*l,f=a[p],d=a[1+p],g=a[2+p],p=a[3+p]/255,f=Ot({r:f,g:d,b:g,a:p});u[t][e]=f}}return u};var o=__webpack_require__(1763),Ht=__webpack_require__.n(o);Ze={domNode:W,multiScreenLink:t,chart:Y,FloatInfoBox:i,ColorPicker:r,Color:Ge,ColorPipette:class{constructor(e){this.init();try{var{container:t,listener:i,scale:r=1,useMagnifier:n=!1}=e,o=(this.container=t||document.body,this.listener=i||{},this.rect=this.container.getBoundingClientRect(),this.scale=4<r?4:r,this.useMagnifier=n,document.body.querySelector("noscript"));o&&o.parentNode&&o.parentNode.removeChild(o),this.initCanvas()}catch(e){console.error(e),this.destroy()}}init(){this.container={},this.listener={},this.canvas={},this.ctx={},this.scale=1,this.magnifier=null,this.colorContainer=null,this.colors=[],this.tooltipVisible=!0,this.useMagnifier=!1,this.rect={x:0,y:0,width:0,height:0}}initCanvas(){var{rect:e,scale:t}=this,{x:i,y:r,width:n,height:o}=e,{canvas:e,ctx:t}=Ut({width:e.width,height:e.height,scale:t,attrs:{class:"color-pipette-canvas-container",style:`
          position: fixed;
          left: ${i}px;
          top: ${r}px;
          z-index: 10000;
          cursor: pointer;
          width: ${n}px;
          height: ${o}px;
        `}});this.canvas=e,this.ctx=t}async start(){try{await this.drawCanvas(),document.body.appendChild(this.canvas);e="按Esc可退出",t=!0,(i=document.createElement("div")).id="color-pipette-tooltip-container",i.innerHTML=e,i.style=`
    position: fixed;
    left: 50%;
    top: 30%;
    z-index: 10002;
    display: ${t?"flex":"none"};
    align-items: center;
    background-color: rgba(0,0,0,0.4);
    padding: 4px 10px;
    border-radius: 3px;
    color: #fff;
    font-size: 20px;
    pointer-events: none;
  `;const r=i;document.body.appendChild(r),setTimeout(()=>{r&&r.parentNode&&r.parentNode.removeChild(r)},2e3),this.canvas.addEventListener("mousemove",this.handleMove.bind(this)),this.canvas.addEventListener("mousedown",this.handleDown.bind(this)),document.addEventListener("keydown",this.handleKeyDown.bind(this))}catch(e){console.error(e),this.destroy()}var e,t,i}destroy(){this.canvas.removeEventListener("mousemove",this.handleMove.bind(this)),this.canvas.removeEventListener("mousedown",this.handleDown.bind(this)),document.removeEventListener("keydown",this.handleKeyDown.bind(this)),this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.colorContainer&&this.colorContainer.parentNode&&this.colorContainer.parentNode.removeChild(this.colorContainer)}async drawCanvas(){var e=this.container;await Ht()(e,{useCORS:!0,height:e.offsetHeight,width:e.offsetWidth,scrollY:0,scrollX:0}).then(async e=>{var i,e=e.toDataURL();e&&(i=e,e=await new Promise(e=>{const t=new Image;t.src=i,t.onload=()=>e(t),t.onerror=()=>e(null)}))&&this.ctx.drawImage(e,0,0,this.rect.width,this.rect.height)})}handleMove(e){var{color:t,colors:i}=this.getPointColors(e),r=this.listener,e={x:e.pageX+15,y:e.pageY+15},e=Rt({containerDom:this.colorContainer,color:t,colors:i,point:e});this.colorContainer||(this.colorContainer=e,document.body.appendChild(e)),r({color:t,colors:i})}handleDown(e){var{onOk:t=()=>""}=this.listener;t(this.getPointColors(e)),this.destroy()}handleKeyDown(e){"Escape"===e.code&&this.destroy()}getPointColors(e){var{ctx:t,rect:i,scale:r}=this,{pageX:e,pageY:n}=e,i=(e-=i.x,n-=i.y,this.getPointColor(e,n)),o=Math.floor(5),e={x:e-o,y:n-o,width:10,height:10};return{color:i,colors:kt(t,e,r)}}getPointColor(e,t){var i=this["scale"],e=this.ctx.getImageData(e*i,t*i,1,1)["data"],t={r:e[0],g:e[1],b:e[2],a:e[3]/255};return Ot(t)}}};var Mt=class{constructor(){}initialize(e,t=1,i=300){this._fov=e,this._far=i,this._near=t,Object.defineProperties(this,{startPoint:{get:function(){return this._startPoint},set:function(e){return e}},endPoint:{get:function(){return this._endPoint},set:function(e){return e}},fov:{get:function(){return this._fov},set:function(e){return e}},near:{get:function(){return this._near},set:function(e){return e}},far:{get:function(){return this._far},set:function(e){return e}},heading:{get:function(){return this._isNullOrEmpty(this._heading)?0:this._heading},set:function(e){return e}},pitch:{get:function(){return this._isNullOrEmpty(this._pitch)?0:this._pitch},set:function(e){return e}}})}addFrustumWithCustom(i,r){var n=new Cesium.ScreenSpaceEventHandler(i.scene.canvas),o=this,s=!1;this._inputActionLeftClick(n,e=>{var t=i.scene.pick(e.position);s||(t=o._getPointByPick(t,"agPoint",e.position,i),s=!0,this._startPoint=t),o._inputActionMouseMove(n,e=>{var t=i.scene.pick(e.endPosition),t=o._getPointByPick(t,"agPoint",e.endPosition,i);o._endPoint=t,this._isNullOrEmpty(this.cameraFrustum)||(i.scene.primitives.remove(o.cameraFrustum),o.cameraFrustum=null),o._drawCamera(i)}),o._inputActionLeftDoubleClick(n,e=>{var t=i.scene.pick(e.position),t=o._getPointByPick(t,"agPoint",e.position,i),e=(s=!1,o._endPoint=t,n.destroy(),this._cartesianToDeggre(this.endPoint,i));r&&r({cameraFrustum:o.cameraFrustum,cameraInfo:o.camera,endPosition:new Cesium.Cartesian3(e.lng,e.lat,e.alt)})})})}addFrustumWithFiexdStartPoint(i,e,r){this._startPoint=e;var n=new Cesium.ScreenSpaceEventHandler(i.scene.canvas),o=this;i.camera.flyTo({destination:new Cesium.Cartesian3.fromDegrees(this.startPoint.lng,this.startPoint.lat,2*this.startPoint.alt)}),this._startPoint=new Cesium.Cartesian3.fromDegrees(this.startPoint.lng,this.startPoint.lat,this.startPoint.alt),o._inputActionMouseMove(n,e=>{var t=i.scene.pick(e.endPosition),t=o._getPointByPick(t,"agPoint",e.endPosition,i);o._endPoint=t,this._isNullOrEmpty(this.cameraFrustum)||(i.scene.primitives.remove(o.cameraFrustum),o.cameraFrustum=null),o._drawCamera(i)}),o._inputActionLeftDoubleClick(n,e=>{var t=i.scene.pick(e.position),t=o._getPointByPick(t,"agPoint",e.position,i),e=(o._endPoint=t,n.destroy(),this._cartesianToDeggre(this.endPoint,i));r&&r({cameraFrustum:o.cameraFrustum,cameraInfo:o.camera,endPosition:new Cesium.Cartesian3(e.lng,e.lat,e.alt)})})}addFrustumWithFiexdAllPoint(e,t,i,r){this._startPoint=t,this._endPoint=i;e.camera.flyTo({destination:new Cesium.Cartesian3.fromDegrees(this.startPoint.lng,this.startPoint.lat,2*this.startPoint.alt)}),this._startPoint=new Cesium.Cartesian3.fromDegrees(this.startPoint.lng,this.startPoint.lat,this.startPoint.alt),this._endPoint=new Cesium.Cartesian3.fromDegrees(this.endPoint.lng,this.endPoint.lat,this.endPoint.alt),this._drawCamera(e);t=this._cartesianToDeggre(this.endPoint,e);r&&r({cameraFrustum:this.cameraFrustum,cameraInfo:this.camera,endPosition:new Cesium.Cartesian3(t.lng,t.lat,t.alt)})}changeCameraOrientations(e,t,i,r){var t=this._isNullOrEmpty(t)?this.camera.heading:Cesium.Math.toRadians(t),i=this._isNullOrEmpty(i)?this.camera.pitch:Cesium.Math.toRadians(i),r=this._isNullOrEmpty(r)?this.camera.roll:Cesium.Math.toRadians(r),n=this._cartesianToDeggre(this.startPoint,e),n=new Cesium.Cartesian3.fromDegrees(n.lng,n.lat,n.alt),t=(this.camera.setView({orientation:{heading:t,pitch:i,roll:r}}),this._getFrustumOrientation());this._isNullOrEmpty(this.cameraFrustum)||(e.scene.primitives.remove(this.cameraFrustum),this.cameraFrustum=null),this._drawCameraFrustumGeometry(e,n,t)}changeCameraFov(e,t){var t=this._isNullOrEmpty(t)?this.camera.frustum.fov:Cesium.Math.toRadians(t),i=this._cartesianToDeggre(this.startPoint,e),i=new Cesium.Cartesian3.fromDegrees(i.lng,i.lat,i.alt),t=(this.camera.frustum.fov=t,this._getFrustumOrientation());this._isNullOrEmpty(this.cameraFrustum)||(e.scene.primitives.remove(this.cameraFrustum),this.cameraFrustum=null),this._drawCameraFrustumGeometry(e,i,t)}destroy(e){this._isNullOrEmpty(this.cameraFrustum)||(e.scene.primitives.remove(this.cameraFrustum),this.cameraFrustum=null,this._startPoint=null,this._endPoint=null,this._fov=null,this._far=null,this._near=null,this._heading=null,this._pitch=null)}_getFrustumOrientation(){var e=new Cesium.Cartesian3,t=new Cesium.Matrix3,i=new Cesium.Quaternion,r=this.camera.directionWC,n=this.camera.upWC,o=this.camera.rightWC,o=Cesium.Cartesian3.negate(o,e),e=t;return Cesium.Matrix3.setColumn(e,0,o,e),Cesium.Matrix3.setColumn(e,1,n,e),Cesium.Matrix3.setColumn(e,2,r,e),Cesium.Quaternion.fromRotationMatrix(e,i)}_drawCamera(e){var t=this._cartesianToDeggre(this.startPoint,e),i=new Cesium.Cartesian3(t.lng,t.lat,t.alt),t=new Cesium.Cartesian3.fromDegrees(t.lng,t.lat,t.alt),r=Cesium.Cartesian3.normalize(Cesium.Cartesian3.subtract(this.endPoint,this.startPoint,new Cesium.Cartesian3),new Cesium.Cartesian3),i=(this.camera=new Cesium.Camera(e.scene),this.camera.position=i,this.camera.direction=r,this.camera.frustum.near=this.near,this.camera.frustum.far=this.far,this.camera.setView({orientation:{heading:this.camera.heading,pitch:this.camera.pitch,roll:this.camera.roll}}),this._getFrustumOrientation());this._drawCameraFrustumGeometry(e,t,i)}_drawCameraFrustumGeometry(e,t,i){this.cameraFrustum=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.FrustumOutlineGeometry({frustum:this.camera.frustum,origin:t,orientation:i}),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color(0,.5,.5))}}),appearance:new Cesium.PerInstanceColorAppearance({translucent:!1,flat:!0}),asynchronous:!1,show:!0}),e.scene.primitives.add(this.cameraFrustum)}_inputActionLeftClick(e,t){e.setInputAction(e=>{t&&t(e)},Cesium.ScreenSpaceEventType.LEFT_CLICK)}_inputActionMouseMove(e,t){e.setInputAction(e=>{t&&t(e)},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}_inputActionLeftDoubleClick(e,t){e.setInputAction(e=>{t&&t(e)},Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)}_getPointByPick(e,t,i,r){e=!e||e.id&&e.id.name==t?r.camera.pickEllipsoid(i,r.scene.globe.ellipsoid):r.scene.pickPosition(i);return e}_isNullOrEmpty(e){return null==e||0==e.length||""==e}_cartesianToDeggre(e,t){t=t.scene.globe.ellipsoid.cartesianToCartographic(e),e=Cesium.Math.toDegrees(t.latitude);return{lng:Cesium.Math.toDegrees(t.longitude),lat:e,alt:t.height}}},Qt=__webpack_require__(7017),Vt=__webpack_require__(9720),Gt=__webpack_require__(5924),f=__webpack_require__(8728),zt=__webpack_require__(8986);var Wt=class{constructor(e,t,i,r){this.name=e,this.position=t,this.radius=i,this.options=r,this.agCircle=null,this.createEntity(i)}createEntity(e){e={material:Cesium.Color.RED.withAlpha(.4),semiMinorAxis:e,semiMajorAxis:e};this.agCircle=new Cesium.Entity({name:this.name,position:this.position,ellipse:{...e,...this.options}})}addToLayer(e){e.addEntity(this.agCircle)}setPosition(e){this.agCircle.position=e}getPosition(){return this.agCircle.position._value}changeRadius(e){this.agCircle.ellipse.semiMinorAxis=e,this.agCircle.ellipse.semiMajorAxis=e}dispose(){this.name=null,this.position=null,this.radius=null,this.options=null,this.agCircle=null}},g=__webpack_require__(9745),qt=__webpack_require__(920),Kt=__webpack_require__(1752),jt=__webpack_require__(7681),c=__webpack_require__(2053);var Zt=new class{constructor(){this._buildingTruck={}}setDrawOption(e){Kt.Z.requestOption=e.bimServer_requestOption}async getSelect3dTilesInfo(l){var e;if(l instanceof Cesium.Cesium3DTileFeature)return e=this.getBuildingidByUrl(l.tileset._url),agcim.net.apiPath.setAgcimServerBIM(l.tileset._url.substring(0,l.tileset._url.indexOf("/models-rest/"))+"/bim-rest"),e.then(async e=>{var t,i,r,n,o,s,a;if(e)return this._buildingTruck[e]||(t=await this.getTableName(e),i=l.tileset.root.transform,s=new Cesium.Cartesian3(0,0,0),r=jt.Z.getTilesetFeatureObjectIdField(l),l.tileset.asset.generatetool&&0<=l.tileset.asset.generatetool.indexOf("cesiumlab")&&(a=((n=t.boudingBox).Min.X+n.Max.X)/2,o=(n.Min.Y+n.Max.Y)/2,s=new Cesium.Cartesian3(a,o,n.Min.Z-1)),a=Qt.Z.createLocalCoordinateHelper(i),this._buildingTruck[e]={tableName:t.tableName,localCoordinate:a,center:s,idFeild:r}),this._buildingTruck[e]}).catch(e=>{console.error(e)})}async getBuildingidByUrl(t){if(t){let e=t.replace("preview","service");e=e.replace("/tileset.json",""),e+="?format=json";t=await c.Z.getData(e);return t&&t.bldgId?t.bldgId:!1}}async getTableName(e){var e=await Kt.Z.buildingTable.getBuildingInfo(e,["entitytable","boundingbox"]),t=JSON.parse(e.boundingbox);return{tableName:e.entitytable,boudingBox:t}}};var Yt=new class{constructor(){this.tableName="",this.center=null,this._entityTable=Kt.Z.entityTable,this.bimTableServer=Kt.Z}setDrawOption(e){Zt.setDrawOption(e),this.bimTableServer.requestOption=e.bimServer_requestOption}async compute(e){if(0==e.results.length)return null;var t=e.results[0].object,i=await Zt.getSelect3dTilesInfo(t);if(null==i)return null;this.tableName=i.tableName;var r=i.localCoordinate;if(!r)return null;var n=["objectid","revitID"],t=t.getProperty(i.idFeild)?t.getProperty(i.idFeild):t.getProperty(n[0])?t.getProperty(n[0]):t.getProperty(n[1]),n=(t||console.error("缺少 objectid 或者 revitID 字段"),await this._entityTable.getEntity(this.tableName,t).getProperties());if(null==n.simpifygeometry||" "==n.simpifygeometry||""==n.simpifygeometry)return console.error(" simpifygeometry 字段为空！"),null;this.center=i.center;t=r.transformToLocal([e.position])[0];return await this.getCurrentPolygon1(n,t,r)}async getCurrentPolygon1(e,i,t){var r=this.center,n=JSON.parse(e.simpifygeometry),o=(JSON.parse(e.boundingbox),i=new Cesium.Cartesian3(i.x+r.x,i.y+r.y,i.z+r.z),0),s=9999,a=[],l=n.length/4;for(let t=0;t<l;t++){var u=[];for(let e=0;e<4;e++){var c=new Cesium.Cartesian3(n[e+4*t].X,n[e+4*t].Y,n[e+4*t].Z);u.push(c)}a.push(u);var h=agcim.maths.math.getPlaneByCrossProduct(u),h=agcim.maths.math.getDistancePoint2Plane(i,u[0],h);h<s&&(o=t,s=h)}var A=a[o],p=[];for(let e=0;e<A.length;e++){var c=new Cesium.Cartesian3(A[e].x-r.x,A[e].y-r.y,A[e].z-r.z),f=t.transformToWorld([c])[0];p.push(f)}return p}async getCurrentPolygon(e,t,i){var r=this.center,n=JSON.parse(e.simpifygeometry),o=JSON.parse(e.boundingbox),s=(t=new Cesium.Cartesian3(t.x+r.x,t.y+r.y,t.z+r.z),{value:9999,compare:null}),a={value:9999,compare:null},l={value:9999,compare:null};for(let e=0;e<n.length;e++){var u=Math.abs(n[e].X-t.x),c=Math.abs(n[e].Y-t.y),h=Math.abs(n[e].Z-t.z);u<s.value&&(s.value=u,s.compare=n[e].X),c<a.value&&(a.value=c,a.compare=n[e].Y),h<l.value&&(l.value=h,l.compare=n[e].Z)}var A=l.value<s.value&&l.value<a.value?"Z":a.value<s.value&&a.value<l.value?"Y":s.value<a.value&&s.value<l.value?"X":"X",p=[],f=("X"==A?(p.push(new Cesium.Cartesian3(s.compare,o.Min.Y,o.Min.Z)),p.push(new Cesium.Cartesian3(s.compare,o.Min.Y,o.Max.Z)),p.push(new Cesium.Cartesian3(s.compare,o.Max.Y,o.Max.Z)),p.push(new Cesium.Cartesian3(s.compare,o.Max.Y,o.Min.Z))):"Y"==A?(p.push(new Cesium.Cartesian3(o.Max.X,a.compare,o.Min.Z)),p.push(new Cesium.Cartesian3(o.Max.X,a.compare,o.Max.Z)),p.push(new Cesium.Cartesian3(o.Min.X,a.compare,o.Max.Z)),p.push(new Cesium.Cartesian3(o.Min.X,a.compare,o.Min.Z))):"Z"==A&&(p.push(new Cesium.Cartesian3(o.Min.X,o.Min.Y,l.compare)),p.push(new Cesium.Cartesian3(o.Min.X,o.Max.Y,l.compare)),p.push(new Cesium.Cartesian3(o.Max.X,o.Max.Y,l.compare)),p.push(new Cesium.Cartesian3(o.Max.X,o.Min.Y,l.compare))),await this.getRelatedPostions(e,A,s,a)),d=[],f=p.concat(f);for(let e=0;e<f.length;e++){var g=new Cesium.Cartesian3(f[e].x-r.x,f[e].y-r.y,f[e].z-r.z),g=i.transformToWorld([g])[0];d.push(g)}return d}async getRelatedPostions(e,t,i,r){var n=[],o=JSON.parse(e.topologyelements).FacingOrientation;if("墙"==e.catagory&&("X"==t&&1==Math.abs(o.X)||"Y"==t&&1==Math.abs(o.Y))){var s=await this._entityTable.getEntity(this.tableName,e.objectid).getRelatedInfo();if(null!=s&&""!=s)for(let e=0;e<s.length;e++){var a=JSON.parse(s[e].boundingbox),l=[];"X"==t?(l.push(new Cesium.Cartesian3(i.compare,a.Max.Y,a.Min.Z)),l.push(new Cesium.Cartesian3(i.compare,a.Max.Y,a.Max.Z)),l.push(new Cesium.Cartesian3(i.compare,a.Min.Y,a.Max.Z)),l.push(new Cesium.Cartesian3(i.compare,a.Min.Y,a.Min.Z)),n=0<e&&l[0].y>n[n.length-1].y?l.concat(n):n.concat(l)):"Y"==t&&(l.push(new Cesium.Cartesian3(a.Min.X,r.compare,a.Min.Z)),l.push(new Cesium.Cartesian3(a.Min.X,r.compare,a.Max.Z)),l.push(new Cesium.Cartesian3(a.Max.X,r.compare,a.Max.Z)),l.push(new Cesium.Cartesian3(a.Max.X,r.compare,a.Min.Z)),n=0<e&&l[0].x<n[n.length-1].x?l.concat(n):n.concat(l))}}return n}};var Xt=class{constructor(){this.positions=[],this._polygonPositions=[],this._outlinePositions=[],this.entities=[],this._entities_pointParts=[],this.polygon=null,this.polyline=null,this.moveHandler=this._moveHandler.bind(this),this.clickHandler=this._clickHandler.bind(this),this.dblclickHandler=this._dblclickHandler.bind(this)}setParent(e,t,i,r,n,o){this.parentInstance=e,this.polygonRenderOptions=t,this.hasPoint=i,this.hasOutLine=r,this.pointStyle=n,this.outLineStyle=o}dispose(){this.polygon=null,this.polyline=null,this.positions=[],this.entities=[],this._entities_pointParts=[],this._polygonPositions=[],this._outlinePositions=[]}finishDraw(){return this.copyToPolygonPoints(this.positions),{positions:this.positions,entity:this.polygon}}_clickHandler(i,r){if(this.parentInstance.drawOption&&!this.parentInstance.drawOption.polygon_pickElement)this.addNodeOfPolygon(i);else{Yt.setDrawOption(this.parentInstance.drawOption);var e=Yt.compute(i);let t=this;e.then(function(e){null==e?t.addNodeOfPolygon(i):(t.pickElementArea(t,e),r({positions:e,entity:t.polygon}))}).catch(function(e){console.warn(e)})}}addNodeOfPolygon(e){var t=this.positions,e=e.position;t.push(e),1===t.length?this.createPolyline(e.clone()):2===t.length?this.updatePolyline(e):3<=t.length&&(this.removePolyline(),this.copyToPolygonPoints(t),this._createPolygon()),this.hasPoint&&(e=this.parentInstance._addPoint("agPoint",t[t.length-1].clone(),this.pointStyle),this.entities.push(e),this._entities_pointParts.push(e))}pickElementArea(e,t){e.parentInstance.removeAll(),e.positions=t,e._createPolygon();for(var i=0;i<t.length;i++){var r=e.parentInstance._addPoint("agPoint",t[i].clone(),e.pointStyle);e.entities.push(r),e._entities_pointParts.push(r)}e.parentInstance.drawOption&&e.parentInstance.drawOption.polygon_adjustToInSamePlane&&e.flatPolygon(e.positions),e.parentInstance.removeInputAction(),e.parentInstance._removeHighlight()}_createPolygon(){var e,t,i,r;Cesium.defined(this.polygon)||(e=this.positions,t=this.entities,r=this.polygonRenderOptions,this.hasOutLine&&(r.outline=!1),i=this.parentInstance.agFeatureLayer,this.copyToPolygonPoints(e),(r=new qt.Z("agPolygon",this._polygonPositions,{...r,isConstant:!1})).addToLayer(i),this.polygon=r.entity,t.push(this.polygon),this.hasOutLine&&2<=e.length&&this.createOutLine())}_moveHandler(e){var e=e.position,t=this.positions;0!==t.length&&(1===t.length?this.updatePolyline(e):2<=t.length&&(this.removePolyline(),this.copyToPolygonPoints([...t,e]),this._createPolygon()))}errHandler(e){console.warn(e)}copyToPolygonPoints(e){this._polygonPositions.splice(0,this._polygonPositions.length);for(var t=0;t<e.length;t++)this._polygonPositions.push(e[t]);this._outlinePositions.splice(0,this._outlinePositions.length);for(t=0;t<e.length;t++)this._outlinePositions.push(e[t]);3<=e.length&&this._outlinePositions.push(e[0])}flatPolygon(e){if(!(e.length<3)){var t=agcim.maths.math.createLocalCoordinateHelper(e[0]),e=t.transformToLocal(e),i=t.transformToLocal([CIM.viewer.camera.position])[0],r=agcim.maths.math.getPlaneByLSM(e),i=agcim.maths.math.computeAngle(r,new Cesium.Cartesian3,i),n=(90<i&&i<270&&(r.x*=-1,r.y*=-1,r.z*=-1),agcim.maths.math.projectPointsAtPlane(e,r,e[0]));if(this.parentInstance.drawOption&&0!=this.parentInstance.drawOption.polygon_adjustHeight)for(var i=this.parentInstance.drawOption.polygon_adjustHeight,o=r.x*i,s=r.y*i,a=r.z*i,l=0;l<n.length;l++)n[l].x+=o,n[l].y+=s,n[l].z+=a;e=t.transformToWorld(n);this.copyToPolygonPoints(e)}}createPolyline(e){var t=this.hasOutLine?this.outLineStyle:{material:this.polygonRenderOptions.material},i=(!0===this.polygonRenderOptions.perPositionHeight?t.clampToGround=!1:t.clampToGround=!0,this.parentInstance.agFeatureLayer);this.polyline=new f.Z("DrawPolygonInstance_line",[e,e],{...t,isConstant:!1}),this.polyline.addToLayer(i),this.entities.push(this.polyline.entity)}updatePolyline(e){this.polyline&&this.polyline.positions&&(this.polyline.positions.pop(),this.polyline.positions.push(e))}removePolyline(){this.polyline&&(this.polyline.remove(this.parentInstance.agFeatureLayer),this.polyline.dispose(),this.polyline=null)}createOutLine(){if(!this.polygon.polyline){var t=this.outLineStyle;!0===this.polygonRenderOptions.perPositionHeight?t.clampToGround=!1:t.clampToGround=!0;let e=this._outlinePositions;this.polygon.polyline={positions:new Cesium.CallbackProperty(()=>e,!1),material:Cesium.Color.YELLOW,width:2,...t}}}removeLastPoint(){this.positions.pop(),this._removeLastPoint_pointEntity(),this.copyToPolygonPoints(this.positions),this.parentInstance.drawOption&&this.parentInstance.drawOption.polygon_adjustToInSamePlane&&this.flatPolygon(this.positions)}_removeLastPoint_pointEntity(){var e;this.hasPoint&&(e=this._entities_pointParts.pop(),this.parentInstance.agFeatureLayer.removeEntity(e))}_dblclickHandler(e){this.removeLastPoint(),e({positions:this.positions,entity:this.polygon,pointEntities:this._entities_pointParts})}},Tt=__webpack_require__(5731);class Jt extends Tt.Z{async getAttachedPoint(e,t,i){e=await this.getBIMAdjoinPoint(e,t,i);if(e.success)return e.content}async getBIMAdjoinPoint(e,t,i){e=encodeURIComponent(e.x+","+e.y+","+e.z),t=encodeURIComponent(t.x+","+t.y+","+t.z),i=encodeURIComponent(i),e=agcim.net.apiPath.bimParamethy_getBIMAdjoinPoint+`?point1=${e}&point2=${t}&baseTableName=`+i;this.setNetInfo();return await c.Z.getDataByGet(e,{headers:{Authorization:"Basic YWRtaW46Z2Vvc2VydmVy"}})}}var $t=new Jt;var ei=new class{constructor(){this._pointMatchPool=[],this.requestOption=null}setSelected3DTiles(e){Zt.getSelect3dTilesInfo(e)}setDrawOption(e){this.requestOption=e.bimServer_requestOption,Zt.setDrawOption(e)}async compute(e){var t=e.position;if(0==e.results.length)return t;var i=this.getPointMatch(t);if(!i){e=await Zt.getSelect3dTilesInfo(e.results[0].object);if(null==e)return null;var r=e.localCoordinate;if(!r)return null;var n=e.center,o=r.transformToLocal([t])[0],o=new Cesium.Cartesian3(o.x+n.x,o.y+n.y,o.z+n.z),s=r.transformToLocal([CIM.viewer.camera.position])[0],s=new Cesium.Cartesian3(s.x+n.x,s.y+n.y,s.z+n.z),s=($t.requestOption=this.requestOption,await $t.getAttachedPoint(s,o,e.tableName));if(!s)return null;o=new Cesium.Cartesian3(s.point.x,s.point.y,s.point.z);if(o.equals(Cesium.Cartesian3.ZERO))return null;o=new Cesium.Cartesian3(o.x-n.x,o.y-n.y,o.z-n.z),this.removeUnusedPoint();i=r.transformToWorld([o])[0];this._pointMatchPool.push({pickPos:t.clone(),adjPos:i.clone(),t:100})}return i}getPointMatch(e){for(var t=0;t<this._pointMatchPool.length;t++)this._pointMatchPool[t].t--;for(t=0;t<this._pointMatchPool.length;t++)if(Cesium.Cartesian3.distance(this._pointMatchPool[t].pickPos,e)<=.1)return this._pointMatchPool[t].t++,this._pointMatchPool[t].adjPos}removeUnusedPoint(){if(!(this._pointMatchPool.length<100)){for(var e=0,t=0;t<this._pointMatchPool.length;t++)this._pointMatchPool[t].t<this._pointMatchPool[e].t&&(e=t);this._pointMatchPool.splice(e,1)}}},ti=__webpack_require__(7710);var ii=class{constructor(e){this.pointCount=e.pointCount||Number.MAX_VALUE,this.isMobile=e.isMobile||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}};var ri=class{constructor(){this.positions=[],this.entities=[],this._entities_pointParts=[],this.polyline=null,this.clickHandler=this._clickHandler.bind(this),this.moveHandler=this._moveHandler.bind(this),this.dblclickHandler=this._dblclickHandler.bind(this),this.parentInstance=null,this.agFeatureLayer=null}setParent(e,t,i,r){this.parentInstance=e,this.agFeatureLayer=new n.Z(e.viewer),this.polylineRenderOptions=t,this.hasPoint=i,this.pointStyle=r,this.drawPolylineOption=new ii(t)}addEntity(e){this.entities.push(e),"agPoint"==e.name&&this._entities_pointParts.push(e)}addPolyline(e,t){e=new f.Z("agPolyline",e,{...t,isConstant:!1}),e.addToLayer(this.parentInstance.agFeatureLayer),t=e.agPolyline;return this.addEntity(t),t}_clickHandler(e,t){var i=e.position,r=this.positions;0!=r.length||this.drawPolylineOption.isMobile||r.push(i.clone()),r.push(i),this.hasPoint&&(i=this.parentInstance._addPoint("agPoint",r[r.length-1],this.pointStyle),this.addEntity(i)),this.drawPolylineOption.isMobile&&!Cesium.defined(this.polyline)&&2<=r.length&&(this.polyline=this.addPolyline(r,this.polylineRenderOptions)),this._entities_pointParts.length>=this.drawPolylineOption.pointCount?(this.parentInstance.removeInputAction(),this.parentInstance._removeHighlight(),this.drawPolylineOption.isMobile||this.positions.pop(),this.resolve({positions:r,entity:this.polyline},e,t)):this.update({positions:r,entity:this.polyline},e)}_moveHandler(e){this.catchPoint(e),2<=this.positions.length&&(e=e.position,Cesium.defined(this.polyline)||(this.polyline=this.addPolyline(this.positions,this.polylineRenderOptions)),this.positions.pop(),this.positions.push(e))}_dblclickHandler(e,t){this.positions.pop(),this._removeTailDuplicatedPoint(this.positions),this.resolve({positions:this.positions,entity:this.polyline,pointEntities:this._entities_pointParts},e,t)}errHandler(e){console.warn(e)}_removeTailDuplicatedPoint(e){Cesium.Cartesian3.equals(e[e.length-1],e[e.length-2])&&(e.pop(),this._removeLastPoint_pointEntity(),this._removeTailDuplicatedPoint(e))}_removeLastPoint_pointEntity(){var e;this.hasPoint&&(e=this._entities_pointParts.pop(),this.parentInstance.agFeatureLayer.removeEntity(e))}resolve(i,r,n){if(this.agFeatureLayer.removeAll(),this.parentInstance.drawOption&&!this.parentInstance.drawOption.polyline_adjoinBIMPoint)n(i);else{ei.setDrawOption(this.parentInstance.drawOption);var e=ei.compute(r);let t=this;e.then(function(e){t.updatePositions(t,e,r),n(i)}).catch(function(e){console.warn(e),n(i)})}}update(e,i){if(!this.parentInstance.drawOption||this.parentInstance.drawOption.polyline_adjoinBIMPoint){ei.setDrawOption(this.parentInstance.drawOption);var r=ei.compute(i);let t=this;r.then(function(e){t.updatePositions(t,e,i)}).catch(function(e){console.warn(e)})}}updatePositions(t,e){if(null!=e){t.positions.pop(),t.positions.push(e);var i=t._entities_pointParts.length;t._entities_pointParts[i-1].position.setValue(e)}else if(1<t._entities_pointParts.length)for(let e=0;e<t._entities_pointParts.length;e++)t._entities_pointParts[e].position.setValue(t.positions[e])}updateCatchPositions(e,t){0==e.positions.length||e.positions.pop(),e.positions.push(t)}catchPoint(e){if(this.agFeatureLayer.removeAll(),!this.parentInstance.drawOption||this.parentInstance.drawOption.polyline_adjoinBIMPoint){ei.setDrawOption(this.parentInstance.drawOption);e=ei.compute(e);let t=this;e.then(function(e){null!=e&&(t.updateCatchPositions(t,e),t.addBox(t,e))}).catch(function(e){console.warn(e)})}}addBox(e,t){var i=new ti.Z({box:{dimensions:new Cesium.Cartesian3(.1,.1,.1),fill:!1,outline:!0,outlineColor:Cesium.Color.RED}});i.setPosition(t),i.addToLayer(e.agFeatureLayer)}finishDraw(){return this.drawPolylineOption.isMobile||this.positions.pop(),{positions:this.positions,entity:this.polyline}}dispose(){this.positions=[],this.entities=[],this._entities_pointParts=[],this.agFeatureLayer&&this.agFeatureLayer.removeAll()}};var ni=class{constructor(e){var t=document.createElement("DIV"),i=(this.setDivStyle(t),document.createElement("DIV")),r=(t.appendChild(i),this.setArrowDirection(i,"left"),this.setArrowStyle(i),document.createElement("DIV"));t.appendChild(r),this.setInnerTextStyle(r),e.appendChild(t),this._div=t,this._arrow=i,this._title=r,this._frameDiv=e}setVisible(e){this._div.style.display=e?"block":"none"}showAt(t,i){if(t&&i){this.setVisible(!0),this._title.innerHTML=i;let e=t.x+10+"px";i=t.y-this._div.clientHeight/2+"px";t.x>window.innerWidth-this._div.clientWidth-10?(e=t.x-this._div.clientWidth-10+"px",this.setArrowDirection(this._arrow,"right")):this.setArrowDirection(this._arrow,"left"),this._div.style.left=e,this._div.style.top=i}}setDivStyle(e){e.style.display="block",e.style.position="absolute",e.style.maxWidth="200px",e.style.minWidth="100px",e.style.padding="5px",e.style.fontSize="11px",e.style.opacity="0.8",e.style.zIndex="1000"}setArrowStyle(e){e.style.position="absolute",e.style.width="0px",e.style.height="0px",e.style.top="50%",e.style.marginTop="-5px",e.style.borderTop="5px solid transparent",e.style.borderBottom="5px solid transparent"}setArrowDirection(e,t){"right"===t?(e.style.left="unset",e.style.borderRight="unset",e.style.right="0px",e.style.borderLeft="5px solid #000000"):"left"===t&&(e.style.right="unset",e.style.borderLeft="unset",e.style.left="0px",e.style.borderRight="5px solid #000000")}setInnerTextStyle(e){e.style.padding="3px 8px",e.style.backgroundColor="#000000",e.style.color="white",e.style.textAlign="center",e.style.maxWidth="200px",e.style.textDecoration="none",e.style.borderRadius="4px"}};class oi extends ri{constructor(){super()}setParent(e,t,i,r,n){super.setParent(e,t,i,r),this.polygonStyle=n,this.tooltip=new ni(e.viewer.container)}_clickHandler(e,t){var i=e.position,r=this.positions;this.shouleClosed?(r.pop(),!0===this.polylineRenderOptions.clampToGround?this.polygonStyle.perPositionHeight=!1:this.polygonStyle.perPositionHeight=!0,this.polygon=new Cesium.Entity({polygon:{hierarchy:{positions:r},material:Cesium.Color.RED.withAlpha(.4),fill:!0,...this.polygonStyle},polyline:{positions:[...r,r[0]],material:Cesium.Color.YELLOW,width:2,...this.polylineRenderOptions}}),this.parentInstance.agFeatureLayer.addEntity(this.polygon),this.parentInstance.agFeatureLayer.removeEntity(this.polyline),this.entities.push(this.polygon),this.parentInstance.removeInputAction(),this.parentInstance._removeHighlight(),this.tooltip.setVisible(!1),this.closedCricle&&(this.parentInstance.agFeatureLayer.removeEntity(this.closedCricle),this.closedCricle=null),this.resolve({positions:r,entity:this.polygon,pointEntities:this._entities_pointParts},e,t)):(0!=r.length||this.drawPolylineOption.isMobile||r.push(i.clone()),r.push(i),this.hasPoint&&(i=this.parentInstance._addPoint("agPoint",r[r.length-1],this.pointStyle),this.addEntity(i)),this.drawPolylineOption.isMobile&&!Cesium.defined(this.polyline)&&2<=r.length&&(this.polyline=this.addPolyline(r,this.polylineRenderOptions)),this._entities_pointParts.length>=this.drawPolylineOption.pointCount?(this.parentInstance.removeInputAction(),this.parentInstance._removeHighlight(),this.closedCricle&&(this.parentInstance.agFeatureLayer.removeEntity(this.closedCricle),this.closedCricle=null),this.drawPolylineOption.isMobile||this.positions.pop(),this.resolve({positions:r,entity:this.polyline,pointEntities:this._entities_pointParts},e,t)):this.update({positions:r,entity:this.polyline},e))}_moveHandler(e){var t,i,r;this.tooltip.setVisible(!1),this.catchPoint(e),this.shouleClosed=!1,2<=this.positions.length&&(r=e.position,Cesium.defined(this.polyline)||(this.polyline=this.addPolyline(this.positions,this.polylineRenderOptions)),this.positions.pop(),this.positions.push(r),4<=this.positions.length)&&(t=this.positions[0],i=agcim.maths.coordinate.getScreen().fromCartesian(t,this.parentInstance.viewer),r=agcim.maths.coordinate.getScreen().fromCartesian(r,this.parentInstance.viewer),Cesium.Cartesian2.distance(i,r)<30?(this.tooltip.showAt(e.screenPoint,"闭合线"),this.shouleClosed=!0,this.closedCricle||(this.closedCricle=new Cesium.Entity({position:t,ellipse:{material:new Cesium.ColorMaterialProperty(Cesium.Color.WHITE.withAlpha(0)),semiMinorAxis:1,semiMajorAxis:1}}),this.parentInstance.agFeatureLayer.addEntity(this.closedCricle)),this.updateClosedCircleRadius(20),this.toggleClosedCircleShow(!0)):this.closedCricle&&this.toggleClosedCircleShow(!1))}updateClosedCircleRadius(e){var t=this.positions[0],i=agcim.maths.coordinate.getScreen().fromCartesian(t,this.parentInstance.viewer),e=new Cesium.Cartesian2(i.x+e,i.y),i=agcim.maths.coordinate.getScreen().toCartesian(e,this.parentInstance.viewer),e=Cesium.Cartesian3.distance(t,i);this.closedCricle.ellipse.semiMinorAxis=e,this.closedCricle.ellipse.semiMajorAxis=e}toggleClosedCircleShow(e){var t,i,r;e!==this.isCloseCircleShow&&((this.isCloseCircleShow=e)?(e=new Cesium.SampledProperty(Cesium.Color),t=this.parentInstance.viewer.clock._currentTime,r=Cesium.JulianDate.addSeconds(t,.7,new Cesium.JulianDate),i=this.closedCricle.ellipse.material.color.getValue(t),e.addSample(t,i),e.addSample(r,Cesium.Color.WHITE.withAlpha(.5)),e.forwardExtrapolationType=Cesium.ExtrapolationType.HOLD,this.closedCricle.ellipse.material=new Cesium.ColorMaterialProperty(e)):(t=new Cesium.SampledProperty(Cesium.Color),i=this.parentInstance.viewer.clock._currentTime,r=Cesium.JulianDate.addSeconds(i,.7,new Cesium.JulianDate),e=this.closedCricle.ellipse.material.color.getValue(i),t.addSample(i,e),t.addSample(r,Cesium.Color.WHITE.withAlpha(0)),t.forwardExtrapolationType=Cesium.ExtrapolationType.HOLD,this.closedCricle.ellipse.material=new Cesium.ColorMaterialProperty(t)))}}var si=oi;var ai=class{constructor(e,t){this.drawObject=t||new di(e),this.pickerHelper=new Vt.Z(e),this.viewer=e,this.selectEntity=null,this.saveDepthTestValue=!1,this._initMouse()}_initMouse(){this.pickerHelper.on("LEFT_DOWN",e=>{e=this.viewer.scene.pick(e.position);Cesium.defined(e)&&Cesium.defined(e.id)&&Cesium.defined(e.id.polygon)&&(this.selectEntity=e.id,this.viewer.scene.screenSpaceCameraController.enableInputs=!1)}),this.pickerHelper.on("LEFT_UP",()=>{Cesium.defined(this.selectEntity)&&(this.selectEntity=void 0,this.viewer.scene.screenSpaceCameraController.enableInputs=!0),this.pickerHelper.remove("MOUSE_MOVE")})}drawPolygon(){this.drawObject.drawPolygon({perPositionHeight:!0},!1).then(e=>(this.saveDepthTestValue=CIM.viewer.scene.globe.depthTestAgainstTerrain,CIM.viewer.scene.globe.depthTestAgainstTerrain=!1,this.startStretch(),e.entity))}startStretch(){this.pickerHelper.on("LEFT_CLICK",e=>{e=this.viewer.scene.pick(e.position);Cesium.defined(e)&&Cesium.defined(e.id)&&Cesium.defined(e.id.polygon)&&(e.id._polygon.extrudedHeight||(e.id._polygon.extrudedHeight=0),this._mouseMoveEvent(e.id))}).on("RIGHT_CLICK",()=>{this.dispose()})}_mouseMoveEvent(i){this.pickerHelper.on("MOUSE_MOVE",e=>{var t;this.selectEntity&&(t=i._polygon.extrudedHeight._value,e=e.startPosition.y-e.endPosition.y,i._polygon.extrudedHeight=0<(t+=e)?t:0)})}clearEvent(){this.pickerHelper.remove("MOUSE_MOVE"),this.pickerHelper.remove("LEFT_DOWN"),this.pickerHelper.remove("LEFT_UP"),CIM.viewer.scene.globe.depthTestAgainstTerrain=this.saveDepthTestValue}dispose(){this.clearEvent()}};var li=class{constructor(){this.serverUrl=null,this.authorization=null,this.headers=null,this.params=null,this.baseUrl=null}};var ui=class{constructor(){this.polygon_adjustToInSamePlane=!1,this.polygon_adjustHeight=0,this.polyline_adjoinBIMPoint=!1,this.polygon_pickElement=!1,this.bimServer_requestOption=new li}};var ci=class{constructor(e){this.isMobile=e.isMobile||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}};const hi={color:Cesium.Color.fromCssColorString("#FED430"),pixelSize:8},Ai={material:Cesium.Color.fromCssColorString("#FED430"),width:3},pi={material:Cesium.Color.fromCssColorString("#01ba5680")},fi={material:Cesium.Color.fromCssColorString("#01ba5680")};var di=class{constructor(e){this.viewer=e,this.viewerContainer=this.viewer._element,this.pickerHelper=new Vt.Z(e),this.agFeatureLayer=new n.Z(e),this.highlightHelper=new Z,this.enableHighlightSelectItem=!1,this.drawOption=new ui,this._currentSubDrawer=null}drawPoint(r){r=Cesium.defaultValue(r,Cesium.defaultValue.EMPTY_OBJECT),r={...hi,...r};var n,o=[];return this.pickerHelper.setCursor("crosshair"),new Promise((i,t)=>{this.pickerHelper.on("LEFT_CLICK",e=>{var t;this.pickerHelper.hitTest(e).then(e=>{t=e.position,o.push(t),n=this._addPoint("agPoint",t,r),this.removeInputAction(),this._removeHighlight(),i({positions:o,entity:n})})}).on("MOUSE_MOVE",e=>{this._addHighlight(this,e)}).on("RIGHT_CLICK",e=>{this.removeInputAction(),this._removeHighlight(),t("取消绘制")})})}drawPolyline(e,t=!0,i={}){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),e={...Ai,...e},i=Cesium.defaultValue(i,Cesium.defaultValue.EMPTY_OBJECT),i={...hi,...i};let r=new ii(e),n=new ri,o=(this._currentSubDrawer&&this._currentSubDrawer.dispose(),(this._currentSubDrawer=n).setParent(this,e,t,i),0),s=(this.pickerHelper.setCursor("crosshair"),this.agFeatureLayer._entities);return new Promise((t,i)=>{var e=this.pickerHelper.on("LEFT_CLICK",e=>{o&&(new Date).getTime()-o<500?o=(new Date).getTime():(o=(new Date).getTime(),this.pickerHelper.hitTest(e,s,1).then(e=>n.clickHandler(e,t)).catch(n.errHandler))});0==r.isMobile&&e.on("MOUSE_MOVE",e=>{this._addHighlight(this,e),this.pickerHelper.hitTest(e,s,1).then(n.moveHandler).catch(n.errHandler)}).on("LEFT_DOUBLE_CLICK",e=>{this.pickerHelper.hitTest(e,s,1).then(e=>{this.removeInputAction(),this._removeHighlight(),n.dblclickHandler(e,t)})}).on("RIGHT_CLICK",e=>{this.removeInputAction(),this.remove(n.entities),this._removeHighlight(),i("取消绘制")})})}drawPolylineOrPolygon(e,t=!0,i={},r={}){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),e={...Ai,...e},i=Cesium.defaultValue(i,Cesium.defaultValue.EMPTY_OBJECT),i={...hi,...i},r=Cesium.defaultValue(r,Cesium.defaultValue.EMPTY_OBJECT),r={...pi,...r};let n=new si,o=(this._currentSubDrawer&&this._currentSubDrawer.dispose(),(this._currentSubDrawer=n).setParent(this,e,t,i,r),0),s=(this.pickerHelper.setCursor("crosshair"),this.agFeatureLayer._entities);return new Promise((t,i)=>{this.pickerHelper.on("LEFT_CLICK",e=>{o&&(new Date).getTime()-o<500?o=(new Date).getTime():(o=(new Date).getTime(),this.pickerHelper.hitTest(e,s,1).then(e=>n.clickHandler(e,t)).catch(n.errHandler))}).on("MOUSE_MOVE",e=>{this._addHighlight(this,e),this.pickerHelper.hitTest(e,s,1).then(n.moveHandler).catch(n.errHandler)}).on("LEFT_DOUBLE_CLICK",e=>{this.pickerHelper.hitTest(e,s,1).then(e=>{this.removeInputAction(),this._removeHighlight(),n.dblclickHandler(e,t)})}).on("RIGHT_CLICK",e=>{this.removeInputAction(),this.remove(n.entities),this.agFeatureLayer.removeEntity(n.closeCircle),this._removeHighlight(),i("取消绘制")})})}drawMultiPolyline(r,n=!0,o={}){console.warn("本方法将在1.3.0删除。请使用drawPolyline()进行替换"),r=Cesium.defaultValue(r,Cesium.defaultValue.EMPTY_OBJECT);var s=[],a=[],l=null,u=(this.pickerHelper.setCursor("crosshair"),[]),c=[];let h=this;var A=this.agFeatureLayer._entities;return new Promise((t,i)=>{this.pickerHelper.on("LEFT_CLICK",e=>{var t;h.pickerHelper.hitTest(e,A).then(e=>{t=e.position,0==s.length&&s.push(t.clone()),s.push(t),u.push(g.Z.getGlobalCartesian().toGeographic(t)),n&&(e=this._addPoint("agPoint",s[s.length-1],o),a.push(e))})}).on("MOUSE_MOVE",e=>{var t;0!=s.length&&h.pickerHelper.hitTest(e,A).then(e=>{2<=s.length&&(t=e.position,Cesium.defined(l)?(s.pop(),s.push(t)):((e=new f.Z("agPolyline",s,{...r,isConstant:!1})).addToLayer(h.agFeatureLayer),c.push(e),l=e.agPolyline,a.push(l)))})}).on("LEFT_DOUBLE_CLICK",e=>{h.removeInputAction(),s.pop(),h._removeHighlight(h),t({positions:s,geographPosition:u,collectAgPolyline:c,layer:this.agFeatureLayer,entity:l})}).on("RIGHT_CLICK",e=>{h.removeInputAction(),h.remove(a),h._removeHighlight(h),i("取消绘制")})})}drawPolygon(e,t=!0,i=!0,r={},n={}){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),e={...pi,...e},r=Cesium.defaultValue(r,Cesium.defaultValue.EMPTY_OBJECT),r={...hi,...r},n=Cesium.defaultValue(n,Cesium.defaultValue.EMPTY_OBJECT),n={...Ai,...n};let o=new ci(e),s=(this._currentSubDrawer&&this._currentSubDrawer.dispose(),new Xt),a=((this._currentSubDrawer=s).setParent(this,e,t,i,r,n),this.pickerHelper.setCursor("crosshair"),this.agFeatureLayer._entities);return new Promise((t,e)=>{var i=this.pickerHelper.on("LEFT_CLICK",e=>{this.pickerHelper.hitTest(e,a,1).then(e=>s.clickHandler(e,t)).catch(s.errHandler)});o.isMobile||i.on("MOUSE_MOVE",e=>{this._addHighlight(this,e),this.pickerHelper.hitTest(e,a,1).then(s.moveHandler).catch(s.errHandler)}).on("LEFT_DOUBLE_CLICK",e=>{this.removeInputAction(),this._removeHighlight(),s.dblclickHandler(t)}).on("RIGHT_CLICK",e=>{this.removeInputAction(),this.remove(s.entities),this._removeHighlight(),t(null)})})}drawRect(r,n=!0,o=!0,s={},a={}){r=Cesium.defaultValue(r,Cesium.defaultValue.EMPTY_OBJECT),r={...fi,...r},s=Cesium.defaultValue(s,Cesium.defaultValue.EMPTY_OBJECT),s={...hi,...s},a=Cesium.defaultValue(a,Cesium.defaultValue.EMPTY_OBJECT),a={...Ai,...a};var l=[],u=[],c=[],h=null,A=null,p=(this.pickerHelper.setCursor("crosshair"),this.agFeatureLayer._entities);return new Promise((i,t)=>{this.pickerHelper.on("LEFT_CLICK",e=>{var t;this.pickerHelper.hitTest(e,p).then(e=>{t=e.position,0==l.length&&l.push(t.clone()),l.push(t),n&&(e=this._addPoint("agPoint",l[l.length-1],s),c.push(e)),2<l.length&&(this.removeInputAction(),l.pop(),this._removeHighlight(),i({positions:l,entity:h}))})}).on("MOUSE_MOVE",e=>{var t;this._addHighlight(this,e),0!=l.length&&this.pickerHelper.hitTest(e,p).then(e=>{t=e.position,2<=l.length&&(Cesium.defined(h)?(l.pop(),l.push(t)):((e=new zt.Z("agRectangle",l,{...r,isConstant:!1})).addToLayer(this.agFeatureLayer),h=e.agRectangle,c.push(h)),o)&&(e=l.map(e=>g.Z.getGlobalCartesian().toGeographic(e)),u.splice(0,u.length),u.push(l[0],new Cesium.Cartesian3.fromDegrees(e[1].lng,e[0].lat,e[0].alt),l[1],new Cesium.Cartesian3.fromDegrees(e[0].lng,e[1].lat,e[0].alt),l[0]),Cesium.defined(A)||((e=new f.Z("agRectangle_outline",u,{...a,clampToGround:!0,isConstant:!1})).addToLayer(this.agFeatureLayer),A=e.entity,c.push(A)))})}).on("RIGHT_CLICK",e=>{this.removeInputAction(),this.remove(c),this._removeHighlight(),t("取消绘制")})})}drawCircle(r,n=!0,o={}){r=Cesium.defaultValue(r,Cesium.defaultValue.EMPTY_OBJECT);var s=[],a=[],l=null,u=(this.pickerHelper.setCursor("crosshair"),this.agFeatureLayer._entities);return new Promise((i,t)=>{this.pickerHelper.on("LEFT_CLICK",e=>{var t;this.pickerHelper.hitTest(e,u).then(e=>{t=e.position,0==s.length&&(s.push(t.clone()),n)&&(e=this._addPoint("agPoint",t,o),a.push(e)),s.push(t),2<s.length&&(this.removeInputAction(),s.pop(),this._removeHighlight(),i({positions:s,entity:l}))})}).on("MOUSE_MOVE",e=>{var t;this._addHighlight(this,e),0!=s.length&&this.pickerHelper.hitTest(e,u).then(e=>{t=e.position,2<=s.length&&(Cesium.defined(l)?(s.pop(),s.push(t)):(e=new Cesium.CallbackProperty(function(){var e=Qt.Z.getDistance(s[0],s[1]);return e||e+1},!1),(e=new Wt("agCircle",s[0],e,r)).addToLayer(this.agFeatureLayer),l=e.agCircle,a.push(l)))})}).on("RIGHT_CLICK",e=>{this.removeInputAction(),this.remove(a),this._removeHighlight(),t("取消绘制")})})}drawPrism(){this._currentSubDrawer&&this._currentSubDrawer.dispose();var e=new ai(this.viewer,this);this._currentSubDrawer=e,this._currentSubDrawer.drawPolygon()}stretchToPrism(){this._currentSubDrawer&&this._currentSubDrawer.dispose();var e=new ai(this.viewer,this);this._currentSubDrawer=e,this._currentSubDrawer.startStretch()}finishDraw(){if(this.removeInputAction(),this._removeHighlight(),this._currentSubDrawer&&this._currentSubDrawer.finishDraw)return this._currentSubDrawer.finishDraw()}_addPoint(e,t,i){e=new Gt.Z(e,t,i);return e.addToLayer(this.agFeatureLayer),e.agPoint}_removeHighlight(e){(e=e||this).enableHighlightSelectItem&&e.highlightHelper.remove()}_addHighlight(e,t){(e=e||this).enableHighlightSelectItem&&(t=e.viewer.scene.pick(t.endPosition),e.highlightHelper.add(t,e.viewer))}removeInputAction(){this.pickerHelper.setCursor("default"),this.pickerHelper.remove("LEFT_CLICK"),this.pickerHelper.remove("RIGHT_CLICK"),this.pickerHelper.remove("MOUSE_MOVE"),this.pickerHelper.remove("LEFT_DOUBLE_CLICK")}remove(t){for(let e=t.length-1;-1<e;e--)this.viewer.entities.remove(t[e])}removeAll(){this.agFeatureLayer.removeAll()}dispose(){this.removeAll(),this.pickerHelper.off(),this.pickerHelper.setCursor("default"),this._currentSubDrawer&&this._currentSubDrawer.dispose()}};e=class{constructor(e){this.viewer=e,this.sliceLayer=null,this.clippingPlanes=[],this.planeNames=null,this.tileTransform=Cesium.Matrix4.IDENTITY}createClippingPlane(e,t,i,r=0,n=!1){this.sliceLayer=e;var e=Cesium.Matrix4.IDENTITY,o=(this.sliceLayer instanceof Cesium.Cesium3DTileset?e=this.sliceLayer._root.computedTransform:this.sliceLayer instanceof agcim.layer.AgS3MTilesLayer&&(e=this.sliceLayer.modelMatrix),Cesium.Matrix4.getTranslation(e,new Cesium.Cartesian3)),o=Qt.Z.computePartOffset(e,o,t),t=Cesium.Matrix4.fromTranslation(o),o=(n||(o=Cesium.Matrix3.inverse(Qt.Z.getRotationFromTransform(e),new Cesium.Matrix3),e=Cesium.Matrix4.fromRotationTranslation(o,Cesium.Cartesian3.ZERO,new Cesium.Matrix4),this.tileTransform=e),this._initClipingPlane(r,i),new Cesium.ClippingPlaneCollection({modelMatrix:t,planes:this.clippingPlanes,unionClippingRegions:n,edgeColor:new Cesium.Color(1,1,1,.5),edgeWidth:1}));return o}_initClipingPlane(e,t){for(var i in this.clippingPlanes=[],this.planeNames=[],e=e*Math.PI/180,t){var r,n=this._getNormal(i,e);n&&(r=this._getTransfromPanle(n,t[i]),r=Cesium.ClippingPlane.fromPlane(r,new Cesium.ClippingPlane(n,t[i])),this.clippingPlanes.push(r),this.planeNames.push(i))}}updateClippingPlane(e,t,i,r=0){r=r*Math.PI/180;var n=this.planeNames.indexOf(e),t=t.get(n);t.distance=i,"top"!=e&&"bottom"!=e&&(n=this._getNormal(e,r),e=this._getTransfromPanle(n,i),t.normal=e.normal)}_getNormal(e,t){var i=Cesium.Cartesian3.ZERO;return"top"==e?i=new Cesium.Cartesian3(0,0,-1):"left"==e?i=new Cesium.Cartesian3(-Math.cos(t),-Math.sin(t),0):"right"==e?i=new Cesium.Cartesian3(Math.cos(t),Math.sin(t),0):"afterward"==e?i=new Cesium.Cartesian3(-Math.sin(t),Math.cos(t),0):"forward"==e?i=new Cesium.Cartesian3(Math.sin(t),-Math.cos(t),0):"bottom"==e&&(i=new Cesium.Cartesian3(0,0,1)),i}_getTransfromPanle(e,t){e=new Cesium.Plane(e,t);return Cesium.Plane.transform(e,this.tileTransform,e),e}_computePerimeter(e){e=e*Math.PI/180,e=6378137*Math.cos(e);return 2*Math.PI*e}removeClippingPlanes(){this.sliceLayer&&(this.sliceLayer.clippingPlanes.removeAll(),this.sliceLayer=null,this.clippingPlanes=[])}};o=class{constructor(e,t){this.viewer=e,this.entity=void 0,this.url=t.modelUrl,this.time=t.time,this.start=void 0,this.stop=void 0,this.Lines=t.Lines,this.disArr=t.disArr,this.speed=t.speed||50,this.flyheight=t.flyheight||0,this.isPathShow=t.isPathShow,this.entityType=t.entityType,this.entityModel=t.entityModel,this.property=this.ComputeRoamingLineProperty(t.Lines,this.time,t.start),this.initRoaming(t.entityType)}ComputeRoamingLineProperty(r,e){var n,o=new Cesium.SampledPositionProperty,s=r.length,a=Cesium.JulianDate.now(),e=(this.start=a,Cesium.JulianDate.addSeconds(a,e,new Cesium.JulianDate));this.stop=e,this.viewer.clock.startTime=a.clone(),this.viewer.clock.stopTime=e.clone(),this.viewer.clock.currentTime=a.clone(),this.viewer.clock.clockRange=Cesium.ClockRange.UNBOUNDED,this.viewer.clock.multiplier=1;let l=0;for(let i=0;i<s;i++){let e=0,t=(e=0==i?Cesium.JulianDate.addSeconds(a,0,new Cesium.JulianDate):(l+=Math.floor(this.disArr[i-1]/this.speed),i==s-1&&l,Cesium.JulianDate.addSeconds(a,l,new Cesium.JulianDate)),r[i]);this.flyheight&&0!=this.flyheight&&((n=g.Z.getGlobalCartesian().toCartographic(r[i])).height+=this.flyheight,t=g.Z.getCartographic().toCartesian(n)),o.addSample(e,t)}return o}initRoaming(e){this.EndRoaming(),"empty"==e?this.InitEmptyRoaming(this.property,this.start,this.stop):this.InitModelRoaming(this.property,this.start,this.stop,this.isPathShow)}InitModelRoaming(e,t,i,r){this.entity=this.viewer.entities.add({availability:new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({start:t,stop:i})]),position:e,orientation:new Cesium.VelocityOrientationProperty(e),model:{uri:this.url,show:!0,silhouetteColor:Cesium.Color.WHITE,debugWireframe:!1,debugShowBoundingVolume:!1,scale:1,runAnimations:!0},path:{resolution:1,material:new Cesium.PolylineGlowMaterialProperty({glowPower:.1,color:Cesium.Color.YELLOW}),width:10,show:r}})}InitEmptyRoaming(e,t,i){t={name:"Blue box",availability:new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({start:t,stop:i})]),position:e,box:{dimensions:new Cesium.Cartesian3(4,3,5),material:Cesium.Color.BLUE},path:this.Lines,show:!1,viewFrom:new Cesium.Cartesian3(-200,0,200),orientation:new Cesium.VelocityOrientationProperty(e)};this.entity=this.viewer.entities.add(t)}PauseOrContinue(e){this.viewer.clock.shouldAnimate=e}ChangeRoamingSpeed(e){e/=this.speed;this.viewer.clock.multiplier=e}ChangeEntityBox(e,t,i){this.entity.box=e,t&&(this.entity.type=i)}ChangeEntityModel(e,t){this.url=t,this.initRoaming(e)}ChangeEntityPathShow(e){"empty"!=this.entityType&&(this.entity.path.show._value=e)}EndRoaming(){this.entity&&this.viewer.entities.remove(this.entity)}};W=class{constructor(e,t){this.viewer=e,this.entity=t,this._positions=[],this.supportEditTypes=["MOVE"],this.containEditTypes=[]}activate(){if(this._enabled)return this;this._enabled=!0,this.entity.inProgress=!0}disable(){return this._enabled&&(this._enabled=!1,this.entity.inProgress=!1),this}getMovePoints(){var t=[],i=(this._positions.length||this.getEntityPoints(),this._positions);for(let e=0;e<i.length;e++){var r=this.updatePositionHeight(i[e]);t.push({position:r,type:"MOVE",positionIndex:e})}return this.containEditTypes.indexOf("MOVE")<0&&this.containEditTypes.push("MOVE"),t}getCenterPoint(){this._positions.length||this.getEntityPoints();var e=this.getCenterPosition(this._positions);return this.containEditTypes.indexOf("CENTER")<0&&this.containEditTypes.push("CENTER"),{position:e,type:"CENTER"}}getUpPoints(){if(this.isClampToGround()&&this.getExtrudedHeightReference()===Cesium.HeightReference.CLAMP_TO_GROUND)return null;var t=[];let i=null;i=this._positions.length?this._positions:this.getEntityPoints();var r=null,e=this.getExtrudedPositionHeight(),n=e.extrudedHeight;e.hasClampHeight&&(r=this.getCenterPositionClampHeight());for(let e=0;e<i.length;e++){var o=this.setPositionsHeight(i[e],n);t.push({position:o,type:"UP",clampToGroundheight:r,positionIndex:e})}return this.containEditTypes.indexOf("UP")<0&&this.containEditTypes.push("UP"),t}getAddPoints(){var t=[],i=(this._positions.length||this.getEntityPoints(),this._positions),r=i.length,n=this._hasClosed?r:r-1;for(let e=0;e<n;e++){var o=(e+1)%r,s=Cesium.Cartesian3.midpoint(i[e],i[o],new Cesium.Cartesian3);t.push({position:s,type:"ADD",positionIndex:o})}return this.containEditTypes.indexOf("ADD")<0&&this.containEditTypes.push("ADD"),t}deleteEditPoint(e){return!!this._positions&&0<=(e=e.positionIndex)&&e<this._positions.length&&(this._positions.splice(e,1),!0)}getCenterPosition(e){e=Cesium.BoundingSphere.fromPoints(e).center;return this.updatePositionHeight(e)}getCenterPositionClampHeight(e){e=e||this._positions;e=Cesium.BoundingSphere.fromPoints(e).center;return this.getPositionClampHeight(e)}updatePositionHeight(e){if(this.isClampToGround())e=this.updateHeightForClampToGround(e);else if(this.isRelativeToGround())switch(this.getExtrudedHeightReference()){case Cesium.HeightReference.NONE:e=this.setGraphicHeight(e);break;case Cesium.HeightReference.CLAMP_TO_GROUND:e=this.updateHeightForClampToGround(e);break;case Cesium.HeightReference.RELATIVE_TO_GROUND:e=this.updateHeightForRelativeToGround(e,"height")}else e=this.getExtrudedHeightReference()===Cesium.HeightReference.CLAMP_TO_GROUND?this.updateHeightForClampToGround(e):this.setGraphicHeight(e);return e}getExtrudedPositionHeight(){let e=0,t=!0;var i=this.getExtrudedHeightReference();if(this.isClampToGround())e=i===Cesium.HeightReference.CLAMP_TO_GROUND?this.getCenterPositionClampHeight():this.getCenterPositionRelativeHeight("extrudedHeight");else if(this.isRelativeToGround())e=i===Cesium.HeightReference.CLAMP_TO_GROUND?this.getCenterPositionRelativeHeight("height"):this.getCenterPositionRelativeHeight("extrudedHeight");else switch(i){case Cesium.HeightReference.CLAMP_TO_GROUND:null!=this.getGraphic().height&&(e=this.getGraphic().height.getValue(this.viewer.clock.currentTime)),t=!1;break;case Cesium.HeightReference.RELATIVE_TO_GROUND:e=this.getCenterPositionRelativeHeight("extrudedHeight");break;default:e=this.getGraphic().extrudedHeight.getValue(this.viewer.clock.currentTime),t=!1}return{extrudedHeight:e,hasClampHeight:t}}isClampToGround(){var e=this.getGraphic().heightReference;return e?e==Cesium.HeightReference.CLAMP_TO_GROUND:!!(e=this.getGraphic().clampToGround)&&e.getValue(this.viewer.clock.currentTime)}isRelativeToGround(){var e=this.getGraphic().heightReference;return!!e&&e==Cesium.HeightReference.RELATIVE_TO_GROUND}getExtrudedHeightReference(){var e=this.getGraphic().extrudedHeightReference;return e?e._value:Cesium.HeightReference.NONE}setGraphicHeight(e){var t;return null!=this.getGraphic().height&&(t=this.getGraphic().height.getValue(this.viewer.clock.currentTime),e=this.setPositionsHeight(e,t)),e}updateHeightForRelativeToGround(e,t){t=this.getCenterPositionRelativeHeight(t);return e=this.setPositionsHeight(e,t)}updateHeightForClampToGround(e){var t=Cesium.Cartographic.fromCartesian(e),i=this.getPositionClampHeight(e);return void 0!==i?Cesium.Cartesian3.fromRadians(t.longitude,t.latitude,i):e}getCenterPositionRelativeHeight(e){let t=this.getCenterPositionClampHeight();return this.getGraphic()[e]&&(e=this.getGraphic()[e].getValue(this.viewer.clock.currentTime),t+=e),t}getPositionClampHeight(e){var e=Cesium.Cartographic.fromCartesian(e),t=this.viewer.scene.sampleHeight(e,[this.entity]);return Cesium.defined(t)&&-1e3<t||(t=this.viewer.scene.globe.getHeight(e)||0,Cesium.defined(t)&&-1e3<t)?t:void 0}setPositionsHeight(e,t){if(t=Number(t)||0,e instanceof Array){for(var i=[],r=0,n=e.length;r<n;r++){var o=g.Z.getGlobalCartesian().changePointHeight(e[r],t);i.push(o)}return i}return g.Z.getGlobalCartesian().changePointHeight(e,t)}addPositionsHeight(e,t){var i=Number(t)||0;if(e instanceof Array){for(var r=[],n=0,o=e.length;n<o;n++){var s=g.Z.getGlobalCartesian().changePointAddHeight(e[n],i);r.push(s)}return r}return g.Z.getGlobalCartesian().changePointAddHeight(e,i)}formatNum(e,t){return Number(e.toFixed(t||0))}};var gi=class extends W{constructor(e,t){super(e,t),this._maxPointNum=1,this._minPointNum=1,this._positions=[],this.supportEditTypes=["MOVE"]}getGraphic(){return this.entity.point}getEntityPoints(){var e=this.entity.position;return this._positions.push(e.getValue(this.viewer.clock.currentTime)),e instanceof Cesium.CallbackProperty?e.setCallback(()=>this._positions[0],!1):this.entity.position=new Cesium.CallbackProperty(()=>this._positions[0],!1),this._positions}removeCallbackProperty(){this.entity?.position instanceof Cesium.CallbackProperty&&(this.entity.position=this._positions[0],this._positions=[])}onEditPointUpdate(e,t){return t=this.updatePositionHeight(t),this._positions[e]=t}};var mi=class extends W{constructor(e,t){super(e,t),this._maxPointNum=9999,this._minPointNum=2,this._hasClosed=!1,this._positions=[],this.supportEditTypes=["MOVE","CENTER","ADD"]}getGraphic(){return this.entity.polyline}getEntityPoints(){var e;return!this._positions.length&&this.getGraphic()&&(e=this.getGraphic().positions,this._positions=e.getValue(this.viewer.clock.currentTime),e instanceof Cesium.CallbackProperty?e.setCallback(()=>this._positions,!1):this.getGraphic().positions=new Cesium.CallbackProperty(()=>this._positions,!1)),this._positions}removeCallbackProperty(){var e;this.entity?.positions instanceof Cesium.CallbackProperty&&(e=this.entity.positions.getValue(this.viewer.clock.currentTime),this.entity.positions=e,this._positions=[])}onEditPointUpdate(e,t){return t=this.updatePositionHeight(t),this._positions[e]=t}addPointUpdate(e,t){return t=this.updatePositionHeight(t),this._positions.splice(e,0,t),t}};class yi extends mi{constructor(e,t,i){super(e,t,i),this._maxPointNum=9999,this._minPointNum=3,this._hasClosed=!0,this.supportEditTypes=["MOVE","CENTER","UP","ADD"]}getGraphic(){return this.entity.polygon}getEntityPoints(){var e;return!this._positions.length&&this.entity.polygon&&(e=this.entity.polygon.hierarchy,this._positions=e.getValue(this.viewer.clock.currentTime).positions,e instanceof Cesium.CallbackProperty?e.setCallback(()=>new Cesium.PolygonHierarchy(this._positions),!1):this.entity.polygon.hierarchy=new Cesium.CallbackProperty(()=>new Cesium.PolygonHierarchy(this._positions),!1),this.entity.polyline)&&((e=this.entity.polyline.positions)instanceof Cesium.CallbackProperty?e.setCallback(()=>0<this._positions.length?[...this._positions,this._positions[0]]:this._positions,!1):this.entity.polyline.positions=new Cesium.CallbackProperty(()=>0<this._positions.length?[...this._positions,this._positions[0]]:this._positions,!1)),this._positions}removeCallbackProperty(){this.entity?.polygon?.hierarchy instanceof Cesium.CallbackProperty&&(this.entity.polygon.hierarchy=this._positions,this.entity.polyline.positions instanceof Cesium.CallbackProperty&&(this.entity.polyline.positions=[...this._positions,this._positions[0]]),this._positions=[])}}var _i=yi;class vi extends _i{constructor(e,t){super(e,t),this._maxPointNum=2,this._minPointNum=2,this.supportEditTypes=["MOVE","CENTER","UP"]}getGraphic(){return this.entity.rectangle}getEntityPoints(){var e,t;return!this._positions.length&&this.entity.rectangle&&(t=(e=this.entity.rectangle.coordinates).getValue(this.viewer.clock.currentTime),Cesium.Rectangle.pack(t,this._positions),this._positions=Cesium.Cartesian3.fromRadiansArray(this._positions),e instanceof Cesium.CallbackProperty?e.setCallback(()=>Cesium.Rectangle.fromCartesianArray(this._positions),!1):this.entity.rectangle.coordinates=new Cesium.CallbackProperty(()=>Cesium.Rectangle.fromCartesianArray(this._positions),!1)),this._positions}removeCallbackProperty(){this.entity?.rectangle?.coordinates instanceof Cesium.CallbackProperty&&(this.entity.rectangle.coordinates=this._positions,this._positions=[])}}var Ci=vi;class wi extends gi{constructor(e,t){super(e,t),this._maxPointNum=1,this._minPointNum=1,this.supportEditTypes=["MOVE"]}getGraphic(){return this.entity.ellipse}}var xi=wi;class bi extends mi{constructor(e,t){super(e,t),this._maxPointNum=9999,this._minPointNum=2,this.supportEditTypes=["MOVE","CENTER","ADD"]}getGraphic(){return this.entity.corridor}}var Ei=bi;class Bi extends gi{constructor(e,t){super(e,t),this._maxPointNum=1,this._minPointNum=1,this.supportEditTypes=["MOVE"]}getGraphic(){return this.entity.ellipsoid}getRadii(){return this.entity.ellipsoid.radii.getValue(this.viewer.clock.currentTime)}onEditPointUpdate(e,t){var i=this.getRadii();return t=this.updatePositionHeight(t),t=this.addPositionsHeight(t,i.z),this._positions[e]=t}}var Mi=Bi;class Ii extends gi{constructor(e,t){super(e,t),this._maxPointNum=1,this._minPointNum=1,this.supportEditTypes=["MOVE"]}getGraphic(){return this.entity.box}getDimensions(){return this.entity.box.dimensions.getValue(this.viewer.clock.currentTime)}}var Si=Ii;class Pi extends gi{constructor(e,t){super(e,t),this._maxPointNum=1,this._minPointNum=1,this.supportEditTypes=["MOVE"]}getGraphic(){return this.entity.cylinder}getLength(){return this.entity.cylinder.length.getValue(this.viewer.clock.currentTime)}}var Ti=Pi;class Li extends gi{constructor(e,t){super(e,t),this._maxPointNum=1,this._minPointNum=1,this._positions=[],this.supportEditTypes=["MOVE"]}getGraphic(){return this.entity.model}}var Di=Li;class Fi extends gi{constructor(e,t){super(e,t),this._maxPointNum=1,this._minPointNum=1,this._positions=[],this.supportEditTypes=["MOVE"]}getGraphic(){return this.entity.billboard}}var Ni=Fi;var Oi=new class{getType(){return"MOVE"}onEditUpdate(e,t,i){"MOVE"===e._pointType&&(t=i._edit.onEditPointUpdate(e.positionIndex,t),i.editPointsInfo[e.index].position=t)}};var Ri=new class{getType(){return"CENTER"}onEditUpdate(e,t,i){if("CENTER"===e._pointType){var r=i._edit,n=i.editPointsInfo[e.index].position,o=this.getCenterMoveMatrix(n,t);for(let e=0;e<r._positions.length;e++){var s=Cesium.Matrix4.multiplyByPoint(o,r._positions[e],new Cesium.Cartesian3);r.onEditPointUpdate(e,s)}for(let e=0;e<i.editPointsInfo.length;e++){var a,l=i.editPointsInfo[e];"MOVE"===l.type?l.position=r._positions[l.positionIndex]:"ADD"===l.type&&(a=Cesium.Matrix4.multiplyByPoint(o,l.position,new Cesium.Cartesian3),a=r.updatePositionHeight(a),l.position=a)}i.editPointsInfo[e.index].position=t}else if("MOVE"===e._pointType||"ADD"===e._pointType){n=i._edit;if(!(n.containEditTypes.indexOf("CENTER")<0)){let t=n.getCenterPoint();i.editPointsInfo.find(e=>{"CENTER"===e.type&&(e.position=t.position)})}}}getCenterMoveMatrix(e,t){e=Cesium.Matrix4.fromTranslation(e),t=Cesium.Matrix4.fromTranslation(t),e=Cesium.Matrix4.inverse(e,new Cesium.Matrix4);return Cesium.Matrix4.multiply(e,t,new Cesium.Matrix4)}};var Ui=new class{getType(){return"UP"}onEditUpdate(r,n,t,o){let s=t._edit;if("UP"===r._pointType){var a=t.editPointsInfo[r.index];let e=this.computeUpHeight(a.position,o);this.updateUpPoints(t,e),a.clampToGroundheight&&(e-=a.clampToGroundheight),s.getExtrudedHeightReference()===Cesium.HeightReference.CLAMP_TO_GROUND?s.getGraphic().height=e:s.getGraphic().extrudedHeight=e}else if("MOVE"===r._pointType){if(!(s.containEditTypes.indexOf("UP")<0)){o=s.getExtrudedPositionHeight();let i=o.extrudedHeight;o.hasClampHeight&&(a=s.getCenterPositionClampHeight(),this.updateUpPoints(t,i,a)),t.editPointsInfo.find(e=>{var t;"UP"===e.type&&e.positionIndex===r.positionIndex&&(t=s.setPositionsHeight(n,i),e.position=t)})}}else if("CENTER"===r._pointType&&!(s.containEditTypes.indexOf("UP")<0)){o=s.getExtrudedPositionHeight();let i=o.extrudedHeight;o.hasClampHeight&&(a=s.getCenterPositionClampHeight(),this.updateUpPoints(t,i,a)),t.editPointsInfo.find(e=>{var t;"UP"===e.type&&(t=s._positions[e.positionIndex],t=s.setPositionsHeight(t,i),e.position=t)})}}computeUpHeight(e,t){var t=t.endPosition.y-t.startPosition.y,i=new Cesium.EllipsoidTangentPlane(e),r=new Cesium.BoundingSphere,r=(r.center=e,r.radius=1,1.5*CIM.viewer.scene.frameState.camera.getPixelSize(r,CIM.viewer.scene.frameState.context.drawingBufferWidth,CIM.viewer.scene.frameState.context.drawingBufferHeight)),i=Cesium.Cartesian3.multiplyByScalar(i.zAxis,-t*r,new Cesium.Cartesian3),t=Cesium.Cartesian3.add(e,i,new Cesium.Cartesian3);return Cesium.Cartographic.fromCartesian(t).height}updateUpPoints(e,i,r){let n=e._edit;e.editPointsInfo.find(e=>{var t;"UP"===e.type&&(r&&(e.clampToGroundheight=r),t=n.setPositionsHeight(e.position,i),e.position=t)})}};var ki=new class{getType(){return"ADD"}startEditUpdate(e,t){var i;"ADD"===e._pointType&&(i=t.editPointsInfo[e.index].position,t._edit.addPointUpdate(e.positionIndex,i))}onEditUpdate(e,t,i){var r,n,o=i._edit;"ADD"===e._pointType?(t=o.onEditPointUpdate(e.positionIndex,t),i.editPointsInfo[e.index].position=t):"MOVE"===e._pointType&&(r=o._positions.length,e=e.positionIndex,(o._hasClosed||!o._hasClosed&&0!=e)&&(n=o._positions[0===e?r-1:e-1],this.updateAddPoint(n,t,e,i)),o._hasClosed||!o._hasClosed&&e!=r-1)&&(o=o._positions[n=e===r-1?0:e+1],this.updateAddPoint(t,o,n,i))}endEditUpdate(e,t,i){"ADD"===e._pointType&&(e=i.getEditPointsInfo(t._edit),t.editPointsInfo=e,i.updateEditPoints(e))}updateAddPoint(e,t,i,r){var n=r._edit;let o=Cesium.Cartesian3.midpoint(e,t,new Cesium.Cartesian3);o=n.updatePositionHeight(o),r.editPointsInfo.find(e=>{"ADD"===e.type&&e.positionIndex===i&&(e.position=o)})}};t=class{constructor(e){this.viewer=e,this.pickerHelper=new Vt.Z(e),this.featureLayer=new n.Z(e),this.editEnable=!0,this.pointsEntity=[],this.currEditEntity=null,this.subTools=[Oi,Ri,Ui,ki],this.deletePointEnable=!0,this.tooltip=new ni(e.container),this.editMsg=this.getEditMsg(),this.editHandle(),this.editStarted=new Cesium.Event,this.editStoped=new Cesium.Event,this.editUpdated=new Cesium.Event}addEntity(e){let t=null;if(e.point)t=new gi(this.viewer,e);else if(e.model)t=new Di(this.viewer,e);else if(e.billboard)t=new Ni(this.viewer,e);else if(e.polygon)t=new _i(this.viewer,e);else if(e.polyline)t=new mi(this.viewer,e);else if(e.rectangle)t=new Ci(this.viewer,e);else if(e.ellipse)t=new xi(this.viewer,e);else if(e.corridor)t=new Ei(this.viewer,e);else if(e.ellipsoid)t=new Mi(this.viewer,e);else if(e.box)t=new Si(this.viewer,e);else{if(!e.cylinder)return void console.log("不支持该类型图形的编辑！");t=new Ti(this.viewer,e)}t.tooltip=this.tooltip;var i=this.getEditPointsInfo(t);e.editPointsInfo=i,e._edit=t}editHandle(){this.pickerHelper.marker=null,this.pickerHelper.on("LEFT_CLICK",e=>{if(this.editEnable){e=this.viewer.scene.pick(e.position);if(e&&e.id){if(e.id._isMarker)return;if(e.id._edit)return void this.startEditing(e.id)}this.stopEditing()}}),this.pickerHelper.on("LEFT_DOWN",e=>{e=this.viewer.scene.pick(e.position);if(Cesium.defined(e)){var t=e.id||e.primitive.id||e.primitive;if(t&&t._isMarker){this.changeSceneSetting(!1),this.pickerHelper.marker=t;for(let e=0;e<this.subTools.length;e++)this.subTools[e].startEditUpdate&&this.subTools[e].startEditUpdate(t,this.currEditEntity)}}}),this.pickerHelper.on("MOUSE_MOVE",i=>{var r=this.pickerHelper.marker;if(r)this.tooltip.showAt(i.endPosition,this.editMsg.edit.end),this.pickerHelper.hitTest(i,[this.entity]).then(t=>{if(t.position){for(let e=0;e<this.subTools.length;e++)this.subTools[e].onEditUpdate(r,t.position,this.currEditEntity,i);this.editUpdated.raiseEvent(this.currEditEntity,r._pointType)}}).catch(()=>{});else{this.tooltip.setVisible(!1);var t=this.viewer.scene.pick(i.endPosition);if(Cesium.defined(t)){t=t.id;if(t&&t._isMarker&&t.tipMsg){let e=t.tipMsg;var n=this.currEditEntity._edit;this.deletePointEnable&&"MOVE"===t._pointType&&n._positions&&n._positions.length&&n._positions.length>n._minPointNum&&(e+=this.editMsg.delete.default),this.tooltip.showAt(i.endPosition,e)}}}}),this.pickerHelper.on("LEFT_UP",e=>{var t=this.pickerHelper.marker;if(t){for(let e=0;e<this.subTools.length;e++)this.subTools[e].endEditUpdate&&this.subTools[e].endEditUpdate(t,this.currEditEntity,this);this.pickerHelper.marker=null,this.changeSceneSetting(!0)}}),this.pickerHelper.on("RIGHT_CLICK",e=>{var t,i;this.deletePointEnable&&(t=this.viewer.scene.pick(e.position),Cesium.defined(t))&&(t=t.id)&&t._isMarker&&"MOVE"===t._pointType&&((i=this.currEditEntity._edit)._positions.length-1<i._minPointNum?this.tooltip.showAt(e.position,this.editMsg.delete.min+i._minPointNum):i.deleteEditPoint(t)&&(e=this.getEditPointsInfo(i),this.currEditEntity.editPointsInfo=e,this.updateEditPoints(e)))})}setEditEnable(e){this.editEnable=e}startEditing(e){this.stopEditing(),null!=e&&this.editEnable&&e._edit&&((this.currEditEntity=e)._edit.getEntityPoints(),e._edit.activate(),e._edit._enabled&&this.createEditPoints(e.editPointsInfo),this.editStarted.raiseEvent(e))}stopEditing(){this.destroyEditPoints(),this.currEditEntity&&this.currEditEntity._edit&&(this.editStoped.raiseEvent(this.currEditEntity),this.currEditEntity._edit.removeCallbackProperty&&this.currEditEntity._edit.removeCallbackProperty(),this.currEditEntity._edit.disable)&&this.currEditEntity._edit.disable(),this.currEditEntity=null}getEditMsg(){return{edit:{start:"单击后 激活编辑<br/>右击 单击菜单删除",end:"释放后 完成修改"},Type:{move:"拖动 修改位置",add:"拖动 增加点",up:"拖动 修改高度",radius:"拖动 修改半径",center:"拖动 整体平移"},delete:{default:"<br/>右击 删除该点",min:"无法删除，点数量不能少于"}}}getEditPointsInfo(t){let i=[];for(let e=0;e<this.subTools.length;e++){var r=this.subTools[e].getType();if(!(t.supportEditTypes.indexOf(r)<0)){let e=[];"MOVE"===r?e=t.getMovePoints():"CENTER"===r?e=t.getCenterPoint():"ADD"===r?e=t.getAddPoints():"UP"===r&&t.getGraphic().extrudedHeight&&(e=t.getUpPoints()),i=i.concat(e)}}return i}createEditPoints(r){for(let i=0,e=r.length;i<e;i++){let e=r[i];var n={scale:1,pixelSize:12,outlineColor:new Cesium.Color.fromCssColorString("#ffffff").withAlpha(.5),outlineWidth:2,scaleByDistance:new Cesium.NearFarScalar(1e3,1,1e6,.5),disableDepthTestDistance:Number.POSITIVE_INFINITY};let t=null;switch(e.type){case"CENTER":n.color=new Cesium.Color.fromCssColorString("#ffe599"),t=this.editMsg.Type.center;break;case"UP":n.color=new Cesium.Color.fromCssColorString("#9500eb"),t=this.editMsg.Type.up;break;case"ADD":n.color=new Cesium.Color.fromCssColorString("#04c2c9").withAlpha(.3),t=this.editMsg.Type.add;break;default:n.color=new Cesium.Color.fromCssColorString("#1c197d"),t=this.editMsg.Type.move}var o=this.featureLayer.addEntity({position:new Cesium.CallbackProperty(()=>e.position,!1),point:n,tipMsg:t});o._isMarker=!0,o.index=i,o._pointType=e.type,Cesium.defined(e.positionIndex)&&(o.positionIndex=e.positionIndex),this.pointsEntity.push(o)}}updateEditPoints(e){return!(!this.editEnable||!this.currEditEntity._edit._enabled||(this.destroyEditPoints(),this.createEditPoints(e),0))}changeSceneSetting(e){this.viewer.scene.screenSpaceCameraController.enableRotate=e,this.viewer.scene.screenSpaceCameraController.enableTilt=e,this.viewer.scene.screenSpaceCameraController.enableTranslate=e,this.viewer.scene.screenSpaceCameraController.enableInputs=e}editEntityByKeydown(o,s){const a=this;let e=e=>{if(e.ctrlKey&&86==e.keyCode&&o){if(!o.id.polygon||!o.id.polygon.hierarchy)return;var t=o.id.polygon,i=[];for(const n of t.hierarchy.getValue(a.viewer.clock.currentTime).positions){var r=Cesium.Cartographic.fromCartesian(n),r=Cesium.Cartesian3.fromRadians(r.longitude+1e-5,r.latitude,r.height);i.push(r)}t={newPositions:i,material:t.material,height:t.height,extrudedHeight:t.extrudedHeight,stRotation:t.stRotation};s[e.keyCode](t)}46==e.keyCode&&o&&(t=o.id.id,s[e.keyCode](t))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}destroyEditPoints(){for(var e=0,t=this.pointsEntity.length;e<t;e++)this.featureLayer.removeEntity(this.pointsEntity[e]);this.pointsEntity=[]}removeEntity(e){e._edit&&delete e._edit,e.tooltip&&delete e.tooltip}removeAll(){this.stopEditing(),this.tooltip.setVisible(!1),this.featureLayer&&this.featureLayer.removeAll()}dispose(){this.stopEditing(),this.tooltip.setVisible(!1),this.pickerHelper&&(this.pickerHelper.off(),this.pickerHelper=null),this.featureLayer&&(this.featureLayer.dispose(),this.featureLayer=null)}};var Hi=new class{constructor(){}applyTo(e){this.handleNode(e)}handleNode(t){t.updateTransform(t.parent?t.parent.computedTransform:null);var e=t._header.boundingVolume;if(e.region){Cesium.Matrix4.equalsEpsilon(t.computedTransform,t._initialTransform,Cesium.Math.EPSILON8)?(e=e.region,t._boundingVolume=new Cesium.TileBoundingRegion({rectangle:new Cesium.Rectangle(e[0],e[1],e[2],e[3]),minimumHeight:e[4],maximumHeight:e[5]})):t._boundingVolume=this.createRegionFromBox(t.boundingVolume._orientedBoundingBox);for(let e=0;e<t.children.length;e++)this.handleNode(t.children[e])}}createRegionFromBox(e){var t=Cesium.Matrix4.fromRotationTranslation(e.halfAxes,e.center,new Cesium.Matrix4),i=[new Cesium.Cartesian3(1,1,1),new Cesium.Cartesian3(-1,1,1),new Cesium.Cartesian3(1,-1,1),new Cesium.Cartesian3(-1,-1,1),new Cesium.Cartesian3(1,1,-1),new Cesium.Cartesian3(-1,1,-1),new Cesium.Cartesian3(1,-1,-1),new Cesium.Cartesian3(-1,-1,-1)];let r=Number.MAX_VALUE,n=Number.MIN_VALUE,o=Number.MAX_VALUE,s=Number.MIN_VALUE,a=Number.MAX_VALUE,l=Number.MIN_VALUE;for(let e=0;e<i.length;e++){var u=Cesium.Matrix4.multiplyByPoint(t,i[e],new Cesium.Cartesian3),u=Cesium.Cartographic.fromCartesian(u);r=Math.min(r,u.longitude),n=Math.max(n,u.longitude),o=Math.min(o,u.latitude),s=Math.max(s,u.latitude),a=Math.min(a,u.height),l=Math.max(l,u.height)}e=new Cesium.Rectangle(r,o,n,s);return new Cesium.TileBoundingRegion({rectangle:e,minimumHeight:a,maximumHeight:l})}resetToInitialRegion(){}};var Y=class{constructor(e,t={}){this.viewer=e,this.showTranslateAxis=!Cesium.defined(t.showTranslateAxis)||t.showTranslateAxis,this.showRotationAxis=!Cesium.defined(t.showRotationAxis)||t.showRotationAxis,this.axisColor={x:Cesium.Color.RED,y:Cesium.Color.GREEN,z:Cesium.Color.BLUE,h:Cesium.Color.RED,p:Cesium.Color.GREEN,r:Cesium.Color.BLUE,highlight:Cesium.Color.YELLOW},t.axisColor&&(this.axisColor=Object.assign({},this.axisColor,t.axisColor)),this._adjustObj=null,this._adjustObjMatrix=null,this._originPos=new Cesium.Cartesian3,this._translateAxisEntity={},this._rotationAxisEntity={},this._translateAxisPos={x:new Cesium.Cartesian3,y:new Cesium.Cartesian3,z:new Cesium.Cartesian3},this._rotationAxisPos={h:[],p:[],r:[]},this._scalarNumByCam=1,this._selectAxis=null,this._axisFeatureLayer=new n.Z(e),this._axisPickerHelper=new Vt.Z(e),this._modelPickerHelper=new Vt.Z(e)}get adjustObj(){return this._adjustObj}startPicker(){this._modelPickerHelper.on("LEFT_CLICK",e=>{var e=this.viewer.scene.pick(e.position),t=this._getAdjustObjFromPickerObj(e);t?t!=this._adjustObj&&this.selectedAdjustObj(t):e?.id&&("adjustAxis"===e.id.type||"adjustCircle"===e.id.type)||this.clearAdjustObj()})}stopPicker(){this._modelPickerHelper.reset()}_getAdjustObjFromPickerObj(e){return e?.id?.model instanceof Cesium.ModelGraphics?e.id:e instanceof Cesium.Cesium3DTileFeature?e.primitive:e?.tileset instanceof Cesium.Cesium3DTileset?e.tileset:e?.primitive instanceof Cesium.Model?e.primitive:e instanceof Cesium.Model&&e}selectedAdjustObj(e){if(!e instanceof Cesium.Cesium3DTileset&&!e instanceof Cesium.Model&&!(e instanceof Cesium.Entity&&e.model))throw new Error("不支持的类型！");this._adjustObj&&this.clearAdjustObj(),this._adjustObj=e,this._adjustObjMatrix=jt.Z.getModelTransform(this._adjustObj),this._originPos=Cesium.Matrix4.getTranslation(this._adjustObjMatrix,this._originPos),this._addListener(),this._axisFeatureLayer.removeAll(),this._translateAxisEntity={},this._rotationAxisEntity={},this.showTranslateAxis&&this._initTranslateAxis(),this.showRotationAxis&&this._initRotationAxis()}setTranslateAxisVisible(e,t){let i=!0;for(const r in this._translateAxisEntity)i=!1,this._translateAxisEntity[r].id!=t&&(this._translateAxisEntity[r].show=e);i&&e&&this._initTranslateAxis()}setRotationAxisVisible(e,t){let i=!0;for(const r in this._rotationAxisEntity)i=!1,this._rotationAxisEntity[r].id!=t&&(this._rotationAxisEntity[r].show=e);i&&e&&this._initRotationAxis()}clearAdjustObj(){this._axisFeatureLayer.removeAll(),this._translateAxisEntity={},this._rotationAxisEntity={},this._removeListener(),this._adjustObj=null,this._adjustObjMatrix=null,this._originPos=new Cesium.Cartesian3}dispose(){this.clearAdjustObj(),this._axisFeatureLayer.dispose(),this.endPicker()}_initTranslateAxis(){this._computeTranslateAxis(),this._translateAxisEntity.x=this._createTranslateAxis("xAxis",this.axisColor.x),this._translateAxisEntity.y=this._createTranslateAxis("yAxis",this.axisColor.y),this._translateAxisEntity.z=this._createTranslateAxis("zAxis",this.axisColor.z)}_createTranslateAxis(e,t){var i=this._axisFeatureLayer.addEntity({id:e,polyline:{width:20,material:new Cesium.PolylineArrowMaterialProperty(t)}});switch(e){case"xAxis":i.polyline.positions=new Cesium.CallbackProperty(()=>[this._originPos,this._translateAxisPos.x],!1);break;case"yAxis":i.polyline.positions=new Cesium.CallbackProperty(()=>[this._originPos,this._translateAxisPos.y],!1);break;case"zAxis":i.polyline.positions=new Cesium.CallbackProperty(()=>[this._originPos,this._translateAxisPos.z],!1)}return i.type="adjustAxis",i.oriColor=t,i}_computeTranslateAxis(){var e=Cesium.Transforms.eastNorthUpToFixedFrame(this._originPos);Cesium.Cartesian3.multiplyByScalar(Cesium.Cartesian3.UNIT_X,this._scalarNumByCam,this._translateAxisPos.x),Cesium.Cartesian3.multiplyByScalar(Cesium.Cartesian3.UNIT_Y,this._scalarNumByCam,this._translateAxisPos.y),Cesium.Cartesian3.multiplyByScalar(Cesium.Cartesian3.UNIT_Z,this._scalarNumByCam,this._translateAxisPos.z),Cesium.Matrix4.multiplyByPoint(e,this._translateAxisPos.x,this._translateAxisPos.x),Cesium.Matrix4.multiplyByPoint(e,this._translateAxisPos.y,this._translateAxisPos.y),Cesium.Matrix4.multiplyByPoint(e,this._translateAxisPos.z,this._translateAxisPos.z)}_initRotationAxis(){this._computeRotationAxis(),this._rotationAxisEntity.h=this._createRotationAxis("heading",this.axisColor.h),this._rotationAxisEntity.p=this._createRotationAxis("pitch",this.axisColor.p),this._rotationAxisEntity.r=this._createRotationAxis("roll",this.axisColor.r)}_createRotationAxis(e,t){var i=this._axisFeatureLayer.addEntity({id:e,polyline:{width:6,material:t}});switch(e){case"heading":i.polyline.positions=new Cesium.CallbackProperty(()=>this._rotationAxisPos.h,!1);break;case"pitch":i.polyline.positions=new Cesium.CallbackProperty(()=>this._rotationAxisPos.p,!1);break;case"roll":i.polyline.positions=new Cesium.CallbackProperty(()=>this._rotationAxisPos.r,!1)}return i.type="adjustCircle",i.oriColor=t,i}_computeRotationAxis(){this._rotationAxisPos.h=this._computeRotationAxisPos("heading"),this._rotationAxisPos.p=this._computeRotationAxisPos("pitch"),this._rotationAxisPos.r=this._computeRotationAxisPos("roll")}_computeRotationAxisPos(t){var i=[];let r=0;var n=this._scalarNumByCam/2;for(r=0;r<=360;r+=6){var o=Cesium.Math.toRadians(r);let e=new Cesium.Cartesian3;"heading"===t?e=new Cesium.Cartesian3(n*Math.cos(o),n*Math.sin(o),0):"pitch"===t?e=new Cesium.Cartesian3(n*Math.cos(o),0,n*Math.sin(o)):"roll"===t&&(e=new Cesium.Cartesian3(0,n*Math.cos(o),n*Math.sin(o))),Cesium.Matrix4.multiplyByPoint(this._adjustObjMatrix,e,e),i.push(e)}return i}_addListener(){this._addPreRenderListener(),this._addAxisListener()}_removeListener(){this._removePreRenderListener(),this._removeAxisListener()}_removePreRenderListener(){this.preRenderRemoveHandle&&(this.preRenderRemoveHandle(),this.preRenderRemoveHandle=null)}_addPreRenderListener(){this._removePreRenderListener(),this.preRenderRemoveHandle=this.viewer.scene.preRender.addEventListener(()=>{var e=new Cesium.Cartesian3,e=(Cesium.Cartesian3.subtract(this.viewer.camera.position,this._originPos,e),Cesium.Cartesian3.magnitude(e));this._scalarNumByCam=e/8,this._computeTranslateAxis(),this._computeRotationAxis()})}_removeAxisListener(){this._axisPickerHelper.reset()}_addAxisListener(){this._removeAxisListener(),this._axisPickerHelper.on("LEFT_DOWN",e=>{e=this.viewer.scene.pick(e.position);e&&e.id&&e.id.polyline&&("adjustAxis"!==e.id.type&&"adjustCircle"!==e.id.type||(this.changeSceneSetting(!1),this._setAxisSelected(e.id,!0)))}).on("MOUSE_MOVE",e=>{Cesium.defined(this._selectAxis)&&("adjustAxis"===this._selectAxis.type?this._computeTranslateMouseMove(e.startPosition,e.endPosition):"adjustCircle"===this._selectAxis.type&&this._computeRotationMouseMove(e.startPosition,e.endPosition))}).on("LEFT_UP",e=>{Cesium.defined(this._selectAxis)&&(this.changeSceneSetting(!0),this._setAxisSelected(this._selectAxis,!1))})}changeSceneSetting(e){this.viewer.scene.screenSpaceCameraController.enableRotate=e}_setAxisSelected(e,t){t?(this._selectAxis&&this._selectAxis.polyline.material.color.setValue(this._selectAxis.oriColor),e.show=!0,e.polyline.material.color.setValue(this.axisColor.highlight),this._selectAxis=e):(e.polyline.material.color.setValue(e.oriColor),this._selectAxis=void 0),this.showTranslateAxis&&this.setTranslateAxisVisible(!t,e.id),this.showRotationAxis&&this.setRotationAxisVisible(!t,e.id)}_computeTranslateMouseMove(e,t){var i=this.viewer.scene,r=new Cesium.Cartesian3,n=new Cesium.Cartesian3,o=new Cesium.Cartesian3,s=new Cesium.Cartesian2,a=new Cesium.Cartesian3,l=new Cesium.Cartesian2,t=(Cesium.SceneTransforms.wgs84ToWindowCoordinates(i,this._originPos,r),Cesium.Cartesian2.subtract(t,e,l),"xAxis"===this._selectAxis.id?(Cesium.Cartesian3.subtract(this._translateAxisPos.x,this._originPos,o),Cesium.SceneTransforms.wgs84ToWindowCoordinates(i,this._translateAxisPos.x,s)):"yAxis"===this._selectAxis.id?(Cesium.Cartesian3.subtract(this._translateAxisPos.y,this._originPos,o),Cesium.SceneTransforms.wgs84ToWindowCoordinates(i,this._translateAxisPos.y,s)):"zAxis"===this._selectAxis.id&&(Cesium.Cartesian3.subtract(this._translateAxisPos.z,this._originPos,o),Cesium.SceneTransforms.wgs84ToWindowCoordinates(i,this._translateAxisPos.z,s)),Cesium.Cartesian2.subtract(s,r,s),Cesium.Cartesian2.dot(l,s)/Cesium.Cartesian2.magnitudeSquared(s)),e=(Cesium.Cartesian3.normalize(o,n),Cesium.Cartesian3.magnitude(o));Cesium.Cartesian3.multiplyByScalar(n,t*e,a),Cesium.Cartesian3.add(this._originPos,a,this._originPos),Cesium.Cartesian3.add(this._translateAxisPos.x,a,this._translateAxisPos.x),Cesium.Cartesian3.add(this._translateAxisPos.y,a,this._translateAxisPos.y),Cesium.Cartesian3.add(this._translateAxisPos.z,a,this._translateAxisPos.z),Cesium.Matrix4.setTranslation(this._adjustObjMatrix,this._originPos,this._adjustObjMatrix),this._adjustObj instanceof Cesium.Cesium3DTileset?(this._adjustObj.root.transform=this._adjustObjMatrix,Hi.applyTo(this._adjustObj.root)):this._adjustObj instanceof Cesium.Model?this._adjustObj.modelMatrix=this._adjustObjMatrix:this._adjustObj instanceof Cesium.Entity&&this._adjustObj.model&&(this._adjustObj.position=this._originPos)}_computeRotationMouseMove(e,t){var i=this.viewer.scene,r=new Cesium.Cartesian3,n=new Cesium.Cartesian3,o=new Cesium.Matrix4,s=new Cesium.Cartesian2,a=new Cesium.Cartesian2,l=new Cesium.Cartesian2,u=new Cesium.Cartesian2,c=new Cesium.Matrix3;let h;Cesium.SceneTransforms.wgs84ToWindowCoordinates(i,this._originPos,r),Cesium.Cartesian2.subtract(e,r,u),Cesium.Cartesian2.subtract(t,r,l),h=Cesium.Cartesian2.angleBetween(l,u),a.x=u.x,a.y=u.y,a.z=0,s.x=l.x,s.y=l.y,s.z=0,Cesium.Cartesian3.cross(a,s,n),0<n.z&&(h=-h),Cesium.Matrix4.inverse(this._adjustObjMatrix,o);i=Cesium.Matrix4.multiplyByPoint(o,this.viewer.camera.positionWC,new Cesium.Cartesian3);let A;"heading"===this._selectAxis.id?(Cesium.Plane.projectPointOntoPlane(Cesium.Plane.ORIGIN_ZX_PLANE,i,i),A=Cesium.Cartesian3.angleBetween(i,Cesium.Cartesian3.UNIT_Z),Math.abs(A)>Math.PI/2&&(h=-h),Cesium.Matrix3.fromRotationZ(h,c)):"pitch"===this._selectAxis.id?(Cesium.Plane.projectPointOntoPlane(Cesium.Plane.ORIGIN_YZ_PLANE,i,i),A=Cesium.Cartesian3.angleBetween(i,Cesium.Cartesian3.UNIT_Y),Math.abs(A)>Math.PI/2&&(h=-h),Cesium.Matrix3.fromRotationY(h,c)):"roll"===this._selectAxis.id&&(Cesium.Plane.projectPointOntoPlane(Cesium.Plane.ORIGIN_XY_PLANE,i,i),A=Cesium.Cartesian3.angleBetween(i,Cesium.Cartesian3.UNIT_X),Math.abs(A)>Math.PI/2&&(h=-h),Cesium.Matrix3.fromRotationX(h,c)),Cesium.Matrix4.multiplyByMatrix3(this._adjustObjMatrix,c,this._adjustObjMatrix),this._adjustObj instanceof Cesium.Cesium3DTileset?(this._adjustObj.root.transform=this._adjustObjMatrix,Hi.applyTo(this._adjustObj.root)):this._adjustObj instanceof Cesium.Model?this._adjustObj.modelMatrix=this._adjustObjMatrix:this._adjustObj instanceof Cesium.Entity&&this._adjustObj.model&&(this._adjustObj.position=this._originPos,e=Cesium.Matrix4.getRotation(this._adjustObjMatrix,new Cesium.Matrix3),this._adjustObj.orientation=Cesium.Quaternion.fromRotationMatrix(e,new Cesium.Quaternion))}},Qi=__webpack_require__(3829);var Vi=new class{getTriangles(e){e.push(e[0]);e=Qi.polygon([e]),e=Qi.tesselate(e);let t=[];return e.features.forEach(e=>{e=Qi.getCoords(e);t.push(e[0][0]),t.push(e[0][1]),t.push(e[0][2])}),t.map(e=>Cesium.Cartesian3.fromDegrees(e[0],e[1]))}getNormals(t){var i=[];for(let e=0;e<t.length;e++){var r=this.getNormal([t[e],t[e+1],t[e+2]]);i.push(r),e+=2}return i}getNormal(e){var t=Cesium.Cartesian3.subtract(e[1],e[0],new Cesium.Cartesian3),e=Cesium.Cartesian3.subtract(e[2],e[0],new Cesium.Cartesian3),t=Cesium.Cartesian3.cross(t,e,new Cesium.Cartesian3);return Cesium.Cartesian3.normalize(t,new Cesium.Cartesian3)}};let{Cartesian2:Gi,Cartesian3:zi,Cartesian4:A,combine:Wi,ComponentDatatype:qi,defined:p,destroyObject:Ki,DeveloperError:ji,PixelFormat:Zi,Sampler:Yi,Texture:Xi,ContextLimits:Ji,PixelDatatype:m}=Cesium;function h(e,t,i){if(!p(e))throw new ji("context is required");if(!p(t))throw new ji("attributes is required");if(!p(i))throw new ji("numberOfInstances is required");var r,n,o,s,a,l,u,c;this._attributes=t,this._numberOfInstances=i,0!==t.length&&(r=function(t){let i=!1;var r=t.length;for(let e=0;e<r;++e)if(t[e].componentDatatype!==qi.UNSIGNED_BYTE){i=!0;break}return i?m.FLOAT:m.UNSIGNED_BYTE}(t),n=e.floatingPointTexture,t=function(e,t,i){var r=e.length,e=e[r-1],t=t[r-1],r=t.componentDatatype;if(r!==qi.UNSIGNED_BYTE&&i)return e+4;return e+1}(o=function(t,i){var r=new Array(t.length);let n=0;var o=t.length;for(let e=0;e<o;++e){var s=t[e].componentDatatype;r[e]=n,s!==qi.UNSIGNED_BYTE&&i?n+=4:++n}return r}(t,n=r===m.FLOAT&&!n),t,n),l=Math.floor(Ji.maximumTextureSize/t),a=.5*(c=1/(s=t*(l=Math.min(i,l)))),u=.5*(l=1/(i=Math.ceil(i/l))),this._textureDimensions=new Gi(s,i),this._textureStep=new A(c,a,l,u),this._pixelDatatype=n?m.UNSIGNED_BYTE:r,this._packFloats=n,this._offsets=o,this._stride=t,this._texture=void 0,this._uniforms=void 0,this._shaderSources=void 0,this._context=e,c=4*s*i,this._batchValues=new(r!==m.FLOAT||n?Uint8Array:Float32Array)(c),this._batchValuesDirty=!1)}function $i(e,t){e=e[t].componentsPerAttribute;return 2===e?Gi:3===e?zi:4===e?A:Number}Object.defineProperties(h.prototype,{attributes:{get:function(){return this._attributes}},numberOfInstances:{get:function(){return this._numberOfInstances}}});const er=new A;const tr=new A,ir=(h.prototype.getBatchedAttribute=function(e,t,i){if(e<0||e>=this._numberOfInstances)throw new ji("instanceIndex is out of range.");if(t<0||t>=this._attributes.length)throw new ji("attributeIndex is out of range");var r,n,o,s,a,l=this._attributes,u=this._offsets[t],e=4*this._stride*e+4*u;let c;c=this._packFloats&&l[t].componentDatatype!==m.UNSIGNED_BYTE?(u=this._batchValues,h=e,r=tr,n=A.unpack(u,h,er),o=A.unpackFloat(n),n=A.unpack(u,h+4,er),s=A.unpackFloat(n),n=A.unpack(u,h+8,er),a=A.unpackFloat(n),n=A.unpack(u,h+12,er),u=A.unpackFloat(n),A.fromElements(o,s,a,u,r)):A.unpack(this._batchValues,e,tr);var h=$i(l,t);return p(h.fromCartesian4)?h.fromCartesian4(c,i):p(h.clone)?h.clone(c,i):c.x},[void 0,void 0,new Gi,new zi,new A]),rr=new A;h.prototype.setBatchedAttribute=function(e,t,i){if(e<0||e>=this._numberOfInstances)throw new ji("instanceIndex is out of range.");if(t<0||t>=this._attributes.length)throw new ji("attributeIndex is out of range");if(!p(i))throw new ji("value is required.");var r=this._attributes,n=ir[r[t].componentsPerAttribute],n=this.getBatchedAttribute(e,t,n),o=$i(this._attributes,t);(p(o.equals)?o.equals(n,i):n===i)||((o=rr).x=p(i.x)?i.x:i,o.y=p(i.y)?i.y:0,o.z=p(i.z)?i.z:0,o.w=p(i.w)?i.w:0,n=this._offsets[t],i=4*this._stride*e+4*n,this._packFloats&&r[t].componentDatatype!==m.UNSIGNED_BYTE?(e=o,n=this._batchValues,r=i,t=A.packFloat(e.x,er),A.pack(t,n,r),t=A.packFloat(e.y,t),A.pack(t,n,r+4),t=A.packFloat(e.z,t),A.pack(t,n,r+8),t=A.packFloat(e.w,t),A.pack(t,n,r+12)):A.pack(o,this._batchValues,i),this._batchValuesDirty=!0)},h.prototype.createTexture=function(){var e,t,i;p(this._texture)||(t=(i=this)._context,e=i._textureDimensions,i._texture=new Xi({context:t,pixelFormat:Zi.RGBA,pixelDatatype:i._pixelDatatype,width:e.x,height:e.y,sampler:Yi.NEAREST,flipY:!1})),i=(t=this)._textureDimensions,t._texture.copyFrom({source:{width:i.x,height:i.y,arrayBufferView:t._batchValues}})},h.prototype.getUniformMapCallback=function(){const i=this;return function(e){var t;return 0===i._attributes.length?e:(t={u_batchTexture:function(){return i._texture},u_batchTextureDimensions:function(){return i._textureDimensions},u_batchTextureStep:function(){return i._textureStep}},e=Wi(e,t),i._uniforms=e,i._uniforms)}},h.prototype.get3dtilesUniformMapCallback=function(e){const i=this;return function(e){var t;return 0===i._attributes.length?e:(t=new Cesium.TextureUniform({typedArray:i._batchValues,width:i._textureDimensions.x,height:i._textureDimensions.y,repeat:!1,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:i._pixelDatatype,minificationFilter:Cesium.TextureMinificationFilter.NEAREST,magnificationFilter:Cesium.TextureMagnificationFilter.NEAREST}),t={u_batchTexture:{type:Cesium.UniformType.SAMPLER_2D,value:t},u_batchTextureStep:{type:Cesium.UniformType.VEC4,value:i._textureStep},u_batchTextureDimensions:{type:Cesium.UniformType.VEC2,value:i._textureDimensions}},e=Wi(e,t),i._uniforms=e,i._uniforms)}},h.prototype.getVertexShaderCallback=function(e=!1){let r=this;var t=this._attributes;if(0===t.length)return function(e){return e};let n="uniform highp sampler2D u_batchTexture; \n";n+=function(e,t){var i=e._stride;let r="";return t&&(r=1===e._textureDimensions.y?`uniform vec4 u_batchTextureStep; 
`:`
      uniform vec4 u_batchTextureStep; 

      uniform vec2 u_batchTextureDimensions; 

      `),1===e._textureDimensions.y?r+"vec2 computeSt1(float batchId) \n{ \n    float stepX = u_batchTextureStep.x; \n    float centerX = u_batchTextureStep.y; \n    float numberOfAttributes = float("+i+`); 
`+`    return vec2(centerX + (batchId * numberOfAttributes * stepX), 0.5); 
`+`} 
`:r+"vec2 computeSt1(float batchId) \n{ \n    float stepX = u_batchTextureStep.x; \n    float centerX = u_batchTextureStep.y; \n    float stepY = u_batchTextureStep.z; \n    float centerY = u_batchTextureStep.w; \n    float numberOfAttributes = float("+i+`); 
`+`    float xId = mod(batchId * numberOfAttributes, u_batchTextureDimensions.x); 
`+`    float yId = floor(batchId * numberOfAttributes / u_batchTextureDimensions.x); 
`+`    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); 
`+`} 
`}(this,e)+`
`;var i=t.length;for(let e=0;e<i;++e)n+=function(e,t){var i=e._attributes[t],r=i.componentsPerAttribute,n=i.functionName,o=1===(o=r)?"float":"vec"+o,r=1===(r=r)?".x":2===r?".xy":3===r?".xyz":"";let s=o+` ${n}(float batchId) 
`+`{ 
`+`    vec2 st = computeSt1(batchId); 
`+`    st.x += u_batchTextureStep.x * float(${e._offsets[t]}); 
`;return e._packFloats&&i.componentDatatype!==m.UNSIGNED_BYTE?s+="vec4 textureValue; \ntextureValue.x = czm_unpackFloat(texture(u_batchTexture, st)); \ntextureValue.y = czm_unpackFloat(texture(u_batchTexture, st + vec2(u_batchTextureStep.x, 0.0))); \ntextureValue.z = czm_unpackFloat(texture(u_batchTexture, st + vec2(u_batchTextureStep.x * 2.0, 0.0))); \ntextureValue.w = czm_unpackFloat(texture(u_batchTexture, st + vec2(u_batchTextureStep.x * 3.0, 0.0))); \n":s+="    vec4 textureValue = texture(u_batchTexture, st); \n",s+=`    ${o} value = textureValue${r}; 
`,e._pixelDatatype!==m.UNSIGNED_BYTE||i.componentDatatype!==qi.UNSIGNED_BYTE||i.normalize?e._pixelDatatype===m.FLOAT&&i.componentDatatype===qi.UNSIGNED_BYTE&&i.normalize&&(s+="value /= 255.0; \n"):s+="value *= 255.0; \n",s+="    return value; \n} \n"}(this,e);return function(e){var t=e.indexOf("void main"),i=e.substring(0,t),e=e.substring(t),t=`${i}
${n}
`+e;return r._shaderSources=t}},h.prototype.isDestroyed=function(){return!1},h.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),Ki(this)};var nr=h;class y{constructor(e){this.viewer=e,this.attributes=[{functionName:"getHightCoors",componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3},{functionName:"getLowCoors",componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3},{functionName:"getNormal",componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3}],this.terrainCustomShader=new Cesium.TerrainCustomShader(this.viewer.scene.globe)}add(e,t){y.add(this,this.viewer,this.attributes,e,t)}destroyed(){y.destroyed(this.viewer),this.terrainCustomShader.destroy()}resetTerrain(){y.invalidateAllTiles(this.viewer)}}y.add=(e,t,i,r,n)=>{y.createTextureValueTable(e,t,i,r,n)},y.destroyed=e=>{e.scene.globe._surface.tileProvider._flatBatchTexture=void 0,e.scene.globe.makeShadersDirty()};let or=new Cesium.OrientedBoundingBox;y.createTextureValueTable=(e,t,i,r,o)=>{let s=Cesium.Rectangle.fromCartesianArray(r);var r=r.map(e=>{e=agcim.maths.coordinate.getGlobalCartesian().toGeographic(e);return[e.lng,e.lat]}),r=Vi.getTriangles(r),n=Vi.getNormals(r);let a=new nr(t.scene.context,i,r.length);y.setBatchedAttribute(r,a),y.setBatchedNormal(n,a),a.createTexture(),a.getUniformMapCallback()({}),a.getVertexShaderCallback(!0)(""),e.terrainCustomShader.uniforms={u_batchTexture:()=>a._texture,u_batchTextureDimensions:function(){return a._textureDimensions},u_batchTextureStep:function(){return a._textureStep},u_polygonFlatHeight:function(){return o}},e.terrainCustomShader.vertexShaderText=(t=a,i=t.numberOfInstances||3,` 
  uniform float u_polygonFlatHeight;
 `+`
   ${t._shaderSources}
    vec3 projectPointOntoPlane(vec3 normal, vec3 planeOrigin, vec3 position) {
        vec3 v01 = position - planeOrigin;
        float scale = dot(normal, v01);
        vec3 scaledNormal = normal * scale;
        vec3 p = position - scaledNormal;
        return p;
    }
    bool cross1(vec3 point1, vec3 point2, vec3 point3, vec3 point) {
        vec3 ab = point2 - point1;
        vec3 ac = point3 - point1;
        vec3 ap = point - point1;
        vec3 v1 = cross(ab, ac);
        vec3 v2 = cross(ab, ap);
        return dot(v1, v2) >= 0.0;
    }
    //判断是否在三角形内
    bool isInTriangle(vec3 point1, vec3 point2, vec3 point3, vec3 point) {
        bool scale1 = cross1(point1, point2, point3, point);
        bool scale2 = cross1(point2, point3, point1, point);
        bool scale3 = cross1(point3, point1, point2, point);
        return scale1 && scale2 && scale3;
    }
    //判断是否在矩形内
   bool isInExtent(vec3 coors[${i}], vec3 point) {
        bool isIn = false;                            
        for(int i=0;i<${i/3};i++){  
         if(coors[i*3].x == coors[i*3].y){
            continue;
          }                        
        if(isInTriangle(coors[i*3], coors[i*3+1], coors[i*3+2], point)){
           return true;
          }
        }
      return isIn;                     
    }
  
    `+`
    //判断是否在压平的多边形内
    bool isInFlattenPolygon(vec3 positionWC) {
      bool isIn = false; 
      vec3 coors[${i}];      
      vec3 positionOnPlane;                                                                              
      for(int i = 0; i < ${i}; i++) {
          float index = float(i);
          vec3 coor = getHightCoors(index) + getLowCoors(index);        
          coors[i] = coor;                            
      }
    
        float index = float(0);
        vec3 normal = getNormal(index);        
        positionOnPlane = projectPointOntoPlane(normal, coors[0], positionWC);                            
   
      isIn = isInExtent(coors,positionOnPlane);
      return isIn;
  }
    `+`
void mainCustom(vec2 textureCoordinates,vec3 position,vec3 ellipsoidNormal,float height){
vec3 positionWC = (czm_inverseView * u_modifiedModelView * vec4(position, 1.0)).xyz;
if(isInFlattenPolygon(positionWC)){
    position -= ellipsoidNormal * height - ellipsoidNormal * u_polygonFlatHeight;
}
gl_Position = getPosition(position, height, textureCoordinates);
} 
`),e.terrainCustomShader.updateTileBoundingRegion=(e,t,i)=>{var r,i=i.tileBoundingRegion,n=e.tilingScheme.ellipsoid;return Cesium.Rectangle.intersection(s,i.rectangle)&&(r=Math.abs(i.maximumHeight-o),i.minimumHeight-=r,i.maximumHeight+=r,i._orientedBoundingBox)&&(i._orientedBoundingBox=Cesium.OrientedBoundingBox.fromRectangle(e.rectangle,i.minimumHeight,i.maximumHeight,n,or),i._boundingSphere=Cesium.BoundingSphere.fromOrientedBoundingBox(i._orientedBoundingBox)),i},e.terrainCustomShader.update()},y.setBatchedAttribute=(t,i)=>{for(let e=0;e<t.length;e++){var r=Cesium.EncodedCartesian3.fromCartesian(t[e]);i.setBatchedAttribute(e,0,r.high),i.setBatchedAttribute(e,1,r.low)}return i},y.setBatchedNormal=(t,i)=>{for(let e=0;e<t.length;e++)i.setBatchedAttribute(e,2,t[e]);return i},y.invalidateAllTiles=e=>{e.scene.globe._surface.invalidateAllTiles()};i=y;class _{constructor(e){this.viewer=e,this.attributes=[{functionName:"getHightCoors",componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3},{functionName:"getLowCoors",componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3},{functionName:"getNormal",componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3}],this.terrainCustomShader=new Cesium.TerrainCustomShader(this.viewer.scene.globe)}add(e){_.add(this,this.viewer,this.attributes,e)}destroyed(){_.destroyed(this.viewer),this.terrainCustomShader.destroy()}resetTerrain(){_.invalidateAllTiles(this.viewer)}}_.add=(e,t,i,r)=>{_.createTextureValueTable(e,t,i,r)},_.destroyed=e=>{e.scene.globe._surface.tileProvider._flatBatchTexture=void 0,e.scene.globe.makeShadersDirty()},_.createTextureValueTable=(e,t,i,r)=>{var r=r.map(e=>{e=agcim.maths.coordinate.getGlobalCartesian().toGeographic(e);return[e.lng,e.lat]}),r=Vi.getTriangles(r),n=Vi.getNormals(r);let o=new nr(t.scene.context,i,r.length);_.setBatchedAttribute(r,o),_.setBatchedNormal(n,o),o.createTexture(),o.getUniformMapCallback()({}),o.getVertexShaderCallback(!0)(""),e.terrainCustomShader.uniforms={u_batchTexture:()=>o._texture,u_batchTextureDimensions:function(){return o._textureDimensions},u_batchTextureStep:function(){return o._textureStep}},e.terrainCustomShader.fragmentShaderText=(t=o,i=t.numberOfInstances||3,` 
 `+`
   ${t._shaderSources}
    vec3 projectPointOntoPlane(vec3 normal, vec3 planeOrigin, vec3 position) {
        vec3 v01 = position - planeOrigin;
        float scale = dot(normal, v01);
        vec3 scaledNormal = normal * scale;
        vec3 p = position - scaledNormal;
        return p;
    }
    bool cross1(vec3 point1, vec3 point2, vec3 point3, vec3 point) {
        vec3 ab = point2 - point1;
        vec3 ac = point3 - point1;
        vec3 ap = point - point1;
        vec3 v1 = cross(ab, ac);
        vec3 v2 = cross(ab, ap);
        return dot(v1, v2) >= 0.0;
    }
    //判断是否在三角形内
    bool isInTriangle(vec3 point1, vec3 point2, vec3 point3, vec3 point) {
        bool scale1 = cross1(point1, point2, point3, point);
        bool scale2 = cross1(point2, point3, point1, point);
        bool scale3 = cross1(point3, point1, point2, point);
        return scale1 && scale2 && scale3;
    }
    //判断是否在矩形内
   bool isInExtent(vec3 coors[${i}], vec3 point) {
        bool isIn = false;                            
        for(int i=0;i<${i/3};i++){  
         if(coors[i*3].x == coors[i*3].y){
            continue;
          }                        
        if(isInTriangle(coors[i*3], coors[i*3+1], coors[i*3+2], point)){
           return true;
          }
        }
      return isIn;                     
    }
  
    `+`
    //判断是否在压平的多边形内
    bool isInFlattenPolygon(vec3 positionWC) {
      bool isIn = false; 
      vec3 coors[${i}];      
      vec3 positionOnPlane;                                                                              
      for(int i = 0; i < ${i}; i++) {
          float index = float(i);
          vec3 coor = getHightCoors(index) + getLowCoors(index);        
          coors[i] = coor;                            
      }
    
        float index = float(0);
        vec3 normal = getNormal(index);        
        positionOnPlane = projectPointOntoPlane(normal, coors[0], positionWC);                            
   
      isIn = isInExtent(coors,positionOnPlane);
      return isIn;
  }
    `+`
void mainCustom(vec3 positionMC,vec3 positionEC,vec3 textureCoordinates,vec4 finalColor){
vec3 positionWC = (czm_inverseView *  vec4(v_positionEC, 1.0)).xyz;
if(isInFlattenPolygon(positionWC)){
    discard;
}
} 
`),e.terrainCustomShader.update()},_.setBatchedAttribute=(t,i)=>{for(let e=0;e<t.length;e++){var r=Cesium.EncodedCartesian3.fromCartesian(t[e]);i.setBatchedAttribute(e,0,r.high),i.setBatchedAttribute(e,1,r.low)}return i},_.setBatchedNormal=(t,i)=>{for(let e=0;e<t.length;e++)i.setBatchedAttribute(e,2,t[e]);return i},_.invalidateAllTiles=e=>{e.scene.globe._surface.invalidateAllTiles()};r=_,Ge={divisionPolygon:Vi,FlattenTextureValueTable:nr,TerrainPolygonCut:r,TerrainPolygonFlatten:i};class sr{constructor(e,t,i){this.viewer=e,this.tileset=t,this.clip(t,i)}clip(e,t){var i=t.length,r=[],n=e._root.computedTransform;let o=Cesium.Matrix4.inverseTransformation(n,new Cesium.Matrix4);var s=t.map(e=>Cesium.Matrix4.multiplyByPoint(o,e,new Cesium.Cartesian3(0,0,0)));for(let e=0;e<i;++e){var a=(e+1)%i,l=Cesium.Cartesian3.add(s[e],s[a],new Cesium.Cartesian3),l=Cesium.Cartesian3.multiplyByScalar(l,.5,l),u=new Cesium.Cartesian3(0,0,10),a=Cesium.Cartesian3.subtract(s[a],l,new Cesium.Cartesian3),a=Cesium.Cartesian3.normalize(a,a),l=Cesium.Cartesian3.cross(a,u,new Cesium.Cartesian3),l=Cesium.Cartesian3.normalize(l,l),a=Cesium.Plane.fromPointNormal(s[e],l);r.push(Cesium.ClippingPlane.fromPlane(a))}e.clippingPlanes=new Cesium.ClippingPlaneCollection({planes:r,edgeWidth:1,edgeColor:Cesium.Color.WHITE,enabled:!0})}destroyed(){this.tileset&&this.tileset.clippingPlanes&&sr.destroyed(this.tileset)}}sr.destroyed=e=>{e.clippingPlanes.removeAll(),e.clippingPlanes=void 0};W=sr;let{Cartesian2:ar,Cartesian3:lr,Cartesian4:v,combine:ur,ComponentDatatype:cr,defined:C,destroyObject:hr,DeveloperError:Ar,PixelFormat:pr,Sampler:fr,Texture:dr,ContextLimits:gr,PixelDatatype:w}=Cesium;function x(e,t,i){if(!C(e))throw new Ar("context is required");if(!C(t))throw new Ar("attributes is required");if(!C(i))throw new Ar("numberOfInstances is required");var r,n,o,s,a,l,u,c;this._attributes=t,this._numberOfInstances=i,0!==t.length&&(r=function(t){let i=!1;var r=t.length;for(let e=0;e<r;++e)if(t[e].componentDatatype!==cr.UNSIGNED_BYTE){i=!0;break}return i?w.FLOAT:w.UNSIGNED_BYTE}(t),n=e.floatingPointTexture,t=function(e,t,i){var r=e.length,e=e[r-1],t=t[r-1],r=t.componentDatatype;if(r!==cr.UNSIGNED_BYTE&&i)return e+4;return e+1}(o=function(t,i){var r=new Array(t.length);let n=0;var o=t.length;for(let e=0;e<o;++e){var s=t[e].componentDatatype;r[e]=n,s!==cr.UNSIGNED_BYTE&&i?n+=4:++n}return r}(t,n=r===w.FLOAT&&!n),t,n),l=Math.floor(gr.maximumTextureSize/t),a=.5*(c=1/(s=t*(l=Math.min(i,l)))),u=.5*(l=1/(i=Math.ceil(i/l))),this._textureDimensions=new ar(s,i),this._textureStep=new v(c,a,l,u),this._pixelDatatype=n?w.UNSIGNED_BYTE:r,this._packFloats=n,this._offsets=o,this._stride=t,this._texture=void 0,this._uniforms=void 0,this._shaderSources=void 0,this._context=e,c=4*s*i,this._batchValues=new(r!==w.FLOAT||n?Uint8Array:Float32Array)(c),this._batchValuesDirty=!1)}function mr(e,t){e=e[t].componentsPerAttribute;return 2===e?ar:3===e?lr:4===e?v:Number}Object.defineProperties(x.prototype,{attributes:{get:function(){return this._attributes}},numberOfInstances:{get:function(){return this._numberOfInstances}}});const yr=new v;const _r=new v,vr=(x.prototype.getBatchedAttribute=function(e,t,i){if(e<0||e>=this._numberOfInstances)throw new Ar("instanceIndex is out of range.");if(t<0||t>=this._attributes.length)throw new Ar("attributeIndex is out of range");var r,n,o,s,a,l=this._attributes,u=this._offsets[t],e=4*this._stride*e+4*u;let c;c=this._packFloats&&l[t].componentDatatype!==w.UNSIGNED_BYTE?(u=this._batchValues,h=e,r=_r,n=v.unpack(u,h,yr),o=v.unpackFloat(n),n=v.unpack(u,h+4,yr),s=v.unpackFloat(n),n=v.unpack(u,h+8,yr),a=v.unpackFloat(n),n=v.unpack(u,h+12,yr),u=v.unpackFloat(n),v.fromElements(o,s,a,u,r)):v.unpack(this._batchValues,e,_r);var h=mr(l,t);return C(h.fromCartesian4)?h.fromCartesian4(c,i):C(h.clone)?h.clone(c,i):c.x},[void 0,void 0,new ar,new lr,new v]),Cr=new v;x.prototype.setBatchedAttribute=function(e,t,i){if(e<0||e>=this._numberOfInstances)throw new Ar("instanceIndex is out of range.");if(t<0||t>=this._attributes.length)throw new Ar("attributeIndex is out of range");if(!C(i))throw new Ar("value is required.");var r=this._attributes,n=vr[r[t].componentsPerAttribute],n=this.getBatchedAttribute(e,t,n),o=mr(this._attributes,t);(C(o.equals)?o.equals(n,i):n===i)||((o=Cr).x=C(i.x)?i.x:i,o.y=C(i.y)?i.y:0,o.z=C(i.z)?i.z:0,o.w=C(i.w)?i.w:0,n=this._offsets[t],i=4*this._stride*e+4*n,this._packFloats&&r[t].componentDatatype!==w.UNSIGNED_BYTE?(e=o,n=this._batchValues,r=i,t=v.packFloat(e.x,yr),v.pack(t,n,r),t=v.packFloat(e.y,t),v.pack(t,n,r+4),t=v.packFloat(e.z,t),v.pack(t,n,r+8),t=v.packFloat(e.w,t),v.pack(t,n,r+12)):v.pack(o,this._batchValues,i),this._batchValuesDirty=!0)},x.prototype.createTexture=function(){var e,t,i;C(this._texture)||(t=(i=this)._context,e=i._textureDimensions,i._texture=new dr({context:t,pixelFormat:pr.RGBA,pixelDatatype:i._pixelDatatype,width:e.x,height:e.y,sampler:fr.NEAREST,flipY:!1})),i=(t=this)._textureDimensions,t._texture.copyFrom({source:{width:i.x,height:i.y,arrayBufferView:t._batchValues}})},x.prototype.getUniformMapCallback=function(){const i=this;return function(e){var t;return 0===i._attributes.length?e:(t={u_batchTextureFlatten:function(){return i._texture},u_batchTextureFlattenDimensions:function(){return i._textureDimensions},u_batchTextureFlattenStep:function(){return i._textureStep}},e=ur(e,t),i._uniforms=e,i._uniforms)}},x.prototype.get3dtilesUniformMapCallback=function(e){const i=this;return function(e){var t;return 0===i._attributes.length?e:(t=new Cesium.TextureUniform({typedArray:i._batchValues,width:i._textureDimensions.x,height:i._textureDimensions.y,repeat:!1,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:i._pixelDatatype,minificationFilter:Cesium.TextureMinificationFilter.NEAREST,magnificationFilter:Cesium.TextureMagnificationFilter.NEAREST}),t={u_batchTextureFlatten:{type:Cesium.UniformType.SAMPLER_2D,value:t},u_batchTextureFlattenStep:{type:Cesium.UniformType.VEC4,value:i._textureStep},u_batchTextureFlattenDimensions:{type:Cesium.UniformType.VEC2,value:i._textureDimensions}},e=ur(e,t),i._uniforms=e,i._uniforms)}},x.prototype.getVertexShaderCallback=function(e=!1){let r=this;var t=this._attributes;if(0===t.length)return function(e){return e};let n=e?"uniform highp sampler2D u_batchTextureFlatten; \n":"";n+=function(e,t){var i=e._stride;let r="";return t&&(r=1===e._textureDimensions.y?`uniform vec4 u_batchTextureFlattenStep; 
`:`
      uniform vec4 u_batchTextureFlattenStep; 

      uniform vec2 u_batchTextureFlattenDimensions; 

      `),1===e._textureDimensions.y?r+"vec2 computeSt1(float batchId) \n{ \n    float stepX = u_batchTextureFlattenStep.x; \n    float centerX = u_batchTextureFlattenStep.y; \n    float numberOfAttributes = float("+i+`); 
`+`    return vec2(centerX + (batchId * numberOfAttributes * stepX), 0.5); 
`+`} 
`:r+"vec2 computeSt1(float batchId) \n{ \n    float stepX = u_batchTextureFlattenStep.x; \n    float centerX = u_batchTextureFlattenStep.y; \n    float stepY = u_batchTextureFlattenStep.z; \n    float centerY = u_batchTextureFlattenStep.w; \n    float numberOfAttributes = float("+i+`); 
`+`    float xId = mod(batchId * numberOfAttributes, u_batchTextureFlattenDimensions.x); 
`+`    float yId = floor(batchId * numberOfAttributes / u_batchTextureFlattenDimensions.x); 
`+`    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); 
`+`} 
`}(this,e)+`
`;var i=t.length;for(let e=0;e<i;++e)n+=function(e,t){var i=e._attributes[t],r=i.componentsPerAttribute,n=i.functionName,o=1===(o=r)?"float":"vec"+o,r=1===(r=r)?".x":2===r?".xy":3===r?".xyz":"";let s=o+` ${n}(float batchId) 
`+`{ 
`+`    vec2 st = computeSt1(batchId); 
`+`    st.x += u_batchTextureFlattenStep.x * float(${e._offsets[t]}); 
`;return e._packFloats&&i.componentDatatype!==w.UNSIGNED_BYTE?s+="vec4 textureValue; \ntextureValue.x = czm_unpackFloat(texture(u_batchTextureFlatten, st)); \ntextureValue.y = czm_unpackFloat(texture(u_batchTextureFlatten, st + vec2(u_batchTextureFlattenStep.x, 0.0))); \ntextureValue.z = czm_unpackFloat(texture(u_batchTextureFlatten, st + vec2(u_batchTextureFlattenStep.x * 2.0, 0.0))); \ntextureValue.w = czm_unpackFloat(texture(u_batchTextureFlatten, st + vec2(u_batchTextureFlattenStep.x * 3.0, 0.0))); \n":s+="    vec4 textureValue = texture(u_batchTextureFlatten, st); \n",s+=`    ${o} value = textureValue${r}; 
`,e._pixelDatatype!==w.UNSIGNED_BYTE||i.componentDatatype!==cr.UNSIGNED_BYTE||i.normalize?e._pixelDatatype===w.FLOAT&&i.componentDatatype===cr.UNSIGNED_BYTE&&i.normalize&&(s+="value /= 255.0; \n"):s+="value *= 255.0; \n",s+="    return value; \n} \n"}(this,e);return function(e){var t=e.indexOf("void main"),i=e.substring(0,t),e=e.substring(t),t=`${i}
${n}
`+e;return r._shaderSources=t}},x.prototype.isDestroyed=function(){return!1},x.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),hr(this)};var wr=x;var xr=new class{getTriangles(e){e.push(e[0]);e=Qi.polygon([e]),e=Qi.tesselate(e);let t=[];return e.features.forEach(e=>{e=Qi.getCoords(e);t.push(e[0][0]),t.push(e[0][1]),t.push(e[0][2])}),t.map(e=>Cesium.Cartesian3.fromDegrees(e[0],e[1]))}getNormals(t){var i=[];for(let e=0;e<t.length;e++){var r=this.getNormal([t[e],t[e+1],t[e+2]]);i.push(r),e+=2}return i}getNormal(e){var t=Cesium.Cartesian3.subtract(e[1],e[0],new Cesium.Cartesian3),e=Cesium.Cartesian3.subtract(e[2],e[0],new Cesium.Cartesian3),t=Cesium.Cartesian3.cross(t,e,new Cesium.Cartesian3);return Cesium.Cartesian3.normalize(t,new Cesium.Cartesian3)}};class br{constructor(){this.attributes=[{functionName:"getHightCoors",componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3},{functionName:"getLowCoors",componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3},{functionName:"getNormal",componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3}]}add(e,t){var t=t.map(e=>{e=agcim.maths.coordinate.getGlobalCartesian().toGeographic(e);return[e.lng,e.lat]}),t=xr.getTriangles(t),i=xr.getNormals(t),e=new wr(e.scene.context,this.attributes,t.length);return br.setBatchedAttribute(t,e),br.setBatchedNormal(i,e),e.createTexture(),e.get3dtilesUniformMapCallback()({}),e.getVertexShaderCallback(!1)(""),e}}br.setBatchedAttribute=(t,i)=>{for(let e=0;e<t.length;e++){var r=Cesium.EncodedCartesian3.fromCartesian(t[e]);i.setBatchedAttribute(e,0,r.high),i.setBatchedAttribute(e,1,r.low)}return i},br.setBatchedNormal=(t,i)=>{for(let e=0;e<t.length;e++)i.setBatchedAttribute(e,2,t[e]);return i};var Er=new br;class Br{constructor(e,t){this.viewer=e;var{flatHeight:e=0,positions:t,flattenType:i=0,tileset:r}=t,e={u_flatHeight:{type:Cesium.UniformType.FLOAT,value:e}},t=Er.add(this.viewer,t),e=Object.assign({},e,t._uniforms);this._customShader=this.getCustomShader(e,t,i),this._flattenType=i,this.ownwer=r,this._uniforms=e,this._batchTable=t,this.ownwer.customShader=this._customShader}get flatHeight(){return this._customShader.uniforms.u_flatHeight.value}set flatHeight(e){this._customShader.uniforms.u_flatHeight.value=e}get flattenType(){return this._flattenType}set flattenType(e){e!==this._flattenType&&(this._flattenType=e,this._customShader=this.getCustomShader(this._uniforms,this._batchTable,this._flattenType),this.ownwer.customShader=this._customShader)}getCustomShader(e,t,i){var r=t.numberOfInstances,r=`
    vec3 projectPointOntoPlane(vec3 normal, vec3 planeOrigin, vec3 position) {
        vec3 v01 = position - planeOrigin;
        float scale = dot(normal, v01);
        vec3 scaledNormal = normal * scale;
        vec3 p = position - scaledNormal;
        return p;
    }
    bool cross1(vec3 point1, vec3 point2, vec3 point3, vec3 point) {
        vec3 ab = point2 - point1;
        vec3 ac = point3 - point1;
        vec3 ap = point - point1;
        vec3 v1 = cross(ab, ac);
        vec3 v2 = cross(ab, ap);
        return dot(v1, v2) >= 0.0;
    }
    //判断是否在三角形内
    bool isInTriangle(vec3 point1, vec3 point2, vec3 point3, vec3 point) {
        bool scale1 = cross1(point1, point2, point3, point);
        bool scale2 = cross1(point2, point3, point1, point);
        bool scale3 = cross1(point3, point1, point2, point);
        return scale1 && scale2 && scale3;
    }
    //判断是否在矩形内
   bool isInExtent(vec3 coors[${r}], vec3 point) {
        bool isIn = false;                            
        for(int i=0;i<${r/3};i++){  
         if(coors[i*3].x == coors[i*3].y){
            continue;
          }                        
        if(isInTriangle(coors[i*3], coors[i*3+1], coors[i*3+2], point)){
           return true;
          }
        }
      return isIn;                     
    } 
    //判断是否在压平的多边形内
    bool isInFlattenPolygon(vec3 positionWC) {
      bool isIn = false; 
      vec3 coors[${r}];      
      vec3 positionOnPlane;                                                                              
      for(int i = 0; i < ${r}; i++) {
          float index = float(i);
          vec3 coor = getHightCoors(index) + getLowCoors(index);        
          coors[i] = coor;                            
      }
    
        float index = float(0);
        vec3 normal = getNormal(index);        
        positionOnPlane= projectPointOntoPlane(normal, coors[0], positionWC);                            
   
      isIn = isInExtent(coors,positionOnPlane);
      return isIn;
  }
    `;return new Cesium.CustomShader({lightingModel:1,isTranslucent:0,maximumAnisotropy:.1,uniforms:e,vertexShaderText:`
        ${t._shaderSources}
        ${r}
            void vertexMain(VertexInput vsInput, inout czm_modelVertexOutput vsOutput)
            {
                vec3 positionMC = vsOutput.positionMC;  
                
                ${0===i?` 
                    vec3 positionWC = (czm_model * vec4(positionMC,1.0)).xyz; 
                    if(isInFlattenPolygon(positionWC)){                                   
                    positionMC.z = u_flatHeight + fract(positionMC.z)/1000.0 + fract(positionMC.z)/10000.0;
                } `:""} 
                ${1===i?` 
                    vec3 positionWC = (czm_model * vec4(positionMC,1.0)).xyz; 
                    if(!isInFlattenPolygon(positionWC)){                                   
                    positionMC.z = u_flatHeight + fract(positionMC.z)/1000.0 + fract(positionMC.z)/10000.0;
                } `:""}   
                                 
                vsOutput.positionMC = positionMC;
            }`,fragmentShaderText:[`     ${t._shaderSources} 
                ${r}             
                void fragmentMain(FragmentInput fsInput, inout czm_modelMaterial material) {
                  vec2 st = fsInput.attributes.texCoord_0;
                  vec3 positionMC = fsInput.attributes.positionMC;
                  vec3 positionWC = fsInput.attributes.positionWC; 
                  ${2===i?`
                      if(isInFlattenPolygon(positionWC) && positionMC.z>u_flatHeight){
                          discard;
                        } 
                  `:""} 
                  ${3===i?`
                      if(!isInFlattenPolygon(positionWC) && positionMC.z>u_flatHeight){
                          discard;
                        } 
                  `:""}         
              }                                          
                `]})}destroyed(){this.ownwer.customShader=void 0}}Br.FlattenType={flatten:0,outFlatten:1,cut:2,outCut:3,none:4};var Mr=Br;var b=new class{constructor(){this.viewer=null,this.excavateMinHeight=0}clip(t,e){var i=t.length,r=[],n=[];this.excavateMinHeight=9999;for(let e=0;e<i;++e){var o=(e+1)%i,s=Cesium.Cartesian3.add(t[e],t[o],new Cesium.Cartesian3),s=Cesium.Cartesian3.multiplyByScalar(s,.5,s),a=Cesium.Cartographic.fromCartesian(t[e]),a=this.viewer.scene.globe.getHeight(a)||a.height,a=(a<this.excavateMinHeight&&(this.excavateMinHeight=a),Cesium.Cartesian3.normalize(s,new Cesium.Cartesian3)),o=Cesium.Cartesian3.subtract(t[o],s,new Cesium.Cartesian3),o=Cesium.Cartesian3.normalize(o,o),o=Cesium.Cartesian3.cross(o,a,new Cesium.Cartesian3),o=Cesium.Cartesian3.normalize(o,o),a=new Cesium.Plane(o,0),a=Cesium.Plane.getPointDistance(a,s);r.push(new Cesium.ClippingPlane(o,a)),n.push(new Cesium.ClippingPlane(Cesium.Cartesian3.negate(o,o),-a))}this.viewer.scene.globe.clippingPlanes=new Cesium.ClippingPlaneCollection({planes:r,edgeWidth:1,edgeColor:Cesium.Color.WHITE,enabled:!0}),this.viewer.scene.globe._surfaceExcavation.tileProvider.clippingPlanes=new Cesium.ClippingPlaneCollection({planes:n,edgeWidth:1,edgeColor:Cesium.Color.WHITE,unionClippingRegions:!0,enabled:!0})}clipConcavePolygon(e){this.viewer.scene.globe.clippingTerrain=new Cesium.ClippingTerrain({positions:e,reverseTerrainClipping:!1}),this.viewer.scene.globe._surfaceExcavation.tileProvider.clippingTerrain=new Cesium.ClippingTerrain({positions:e,reverseTerrainClipping:!0})}_createBottomSurface(t,e,i){if(t.length){var r=this._getMinHeight(t),n=[];for(let e=0;e<t.length;e++){var o=g.Z.getGlobalCartesian().toGeographic(t[e]);n.push(o.lng),n.push(o.lat),n.push(r)}var s=new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArrayHeights(n)),perPositionHeight:!0}),s=Cesium.PolygonGeometry.createGeometry(s),e=new Cesium.Material({fabric:{type:"Image",uniforms:{image:e}}}),e=new Cesium.MaterialAppearance({translucent:!1,flat:!0,material:e}),s=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:s}),appearance:e,asynchronous:!1});i.addPrimitive(s)}}_getMinHeight(t){let i=5e6,r=null;for(let e=0;e<t.length;e++){var n=t[e].z;n<i&&(i=n,r=g.Z.getGlobalCartesian().toGeographic(t[e]))}return r.alt}clear(){this.viewer&&this.viewer.scene.globe.clippingPlanes&&(this.viewer.scene.globe.clippingPlanes.removeAll(),this.viewer.scene.globe.clippingPlanes=void 0),this.viewer&&this.viewer.scene.globe.clippingTerrain&&(this.viewer.scene.globe.clippingTerrain.remove(),this.viewer.scene.globe.clippingTerrain=void 0)}};let Ir;let Sr=new Cesium.OrientedBoundingBox;var Pr=class{constructor(e){this.viewer=e,this.height=0,Ir=new n.Z(e);var t=this.viewer.scene.globe;b.viewer=e,this.terrainCustomShader=new Cesium.TerrainCustomShader(t,{surface:t._surfaceExcavation,surfaceShaderSet:t._surfaceShaderSetExcavation})}setImages(e,t){this.wallImg=e,this.bottomImg=t}add(e,t,i,r=!1){this.height=t,this.upTerrain(i),r?b.clipConcavePolygon(e):b.clip(e),this.createBody(e,0,b.excavateMinHeight),this.createBody(e,i,b.excavateMinHeight)}upTerrain(o){this.terrainCustomShader.uniforms={u_moveUpHeight:()=>o},this.terrainCustomShader.vertexShaderText=`
uniform float u_moveUpHeight;
void mainCustom(vec2 textureCoordinates,vec3 position,vec3 ellipsoidNormal,float height){
  position += ellipsoidNormal * u_moveUpHeight;
  gl_Position = getPosition(position, height, textureCoordinates);
  } 
`,this.terrainCustomShader.updateTileBoundingRegion=(e,t,i)=>{var i=i.tileBoundingRegion,r=e.tilingScheme.ellipsoid,n=Math.abs(i.maximumHeight-o);return i.minimumHeight-=n,i.maximumHeight+=n,i._orientedBoundingBox&&(i._orientedBoundingBox=Cesium.OrientedBoundingBox.fromRectangle(e.rectangle,i.minimumHeight,i.maximumHeight,r,Sr),i._boundingSphere=Cesium.BoundingSphere.fromOrientedBoundingBox(i._orientedBoundingBox)),i},this.terrainCustomShader.update(),this.terrainCustomShader.globe._isRenderExcavation=!0}createBody(e,t=0,i){e=this._prepareWell(e,i);0!==t&&(e.bottom_pos=e.bottom_pos.map(e=>g.Z.getGlobalCartesian().changePointAddHeight(e,t)),e.no_height_top=e.no_height_top.map(e=>g.Z.getGlobalCartesian().changePointAddHeight(e,t))),this._createWell(e,t)}_prepareWell(t,e){var i=t.length;if(0!=i){var r=e-this.height,n=[],o=[],s=[];for(let e=0;e<i;e++){var a=e==i-1?0:e+1,l=Cesium.Cartographic.fromCartesian(t[e]),a=Cesium.Cartographic.fromCartesian(t[a]),u=l.longitude,c=l.latitude,h=a.longitude,A=a.latitude;0==e&&(s.push(new Cesium.Cartographic(u,c)),o.push(Cesium.Cartesian3.fromRadians(u,c,r)),n.push(Cesium.Cartesian3.fromRadians(u,c,0)));for(let e=1;e<=50;e++){var p=Cesium.Math.lerp(u,h,e/50),f=Cesium.Math.lerp(c,A,e/50);s.push(new Cesium.Cartographic(p,f)),o.push(Cesium.Cartesian3.fromRadians(p,f,r)),n.push(Cesium.Cartesian3.fromRadians(p,f,0))}}return{lerp_pos:s,bottom_pos:o,no_height_top:n}}}_createWell(n,o){if(Boolean(this.viewer.terrainProvider._layers)){let e=this;b._createBottomSurface(n.bottom_pos,this.bottomImg,Ir);var t=Cesium.sampleTerrainMostDetailed(e.viewer.terrainProvider,n.lerp_pos);Promise.resolve(t).then(function(t){let i=[];for(let e=0;e<t.length;e++){var r=Cesium.Cartesian3.fromRadians(t[e].longitude,t[e].latitude,t[e].height);i.push(r)}i=i.map(e=>g.Z.getGlobalCartesian().changePointAddHeight(e,o)),e._createWellWall(n.bottom_pos,i)})}else b._createBottomSurface(n.bottom_pos,this.bottomImg,Ir),this._createWellWall(n.bottom_pos,n.no_height_top)}_getMinHeight(t){let i=5e6,r=null;for(let e=0;e<t.length;e++){var n=t[e].z;n<i&&(i=n,r=g.Z.getGlobalCartesian().toGeographic(t[e]))}return r.alt}_createWellWall(e,t){var i=this._getMinHeight(e),r=[],n=[];for(let e=0;e<t.length;e++){var o=g.Z.getGlobalCartesian().toGeographic(t[e]).alt;r.push(o),n.push(i)}var e=new Cesium.WallGeometry({positions:t,maximumHeights:r,minimumHeights:n}),e=Cesium.WallGeometry.createGeometry(e),s=new Cesium.Material({fabric:{type:"Image",uniforms:{image:this.wallImg}}}),s=new Cesium.MaterialAppearance({translucent:!1,flat:!0,material:s}),e=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:e,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.GREY)},id:"PitWall"}),appearance:s,asynchronous:!1});Ir.addPrimitive(e)}remove(){Ir.removeAll(),b.clear(),this.terrainCustomShader.destroy(),this.terrainCustomShader.globe._isRenderExcavation=!1}};var Tr=class{constructor(e){this.viewer=e,this.agFeatureLayer=new n.Z(e),this.layerTextures=null,this.bottomImg=null,b.viewer=e}setImages(e,t){this.layerTextures=e,this.bottomImg=t}addTerrainClip(e){b.clip(e)}addWall(e,t){var i;t||(i=Cesium.Cartesian3.midpoint(outerPoints[0],outerPoints[2],new Cesium.Cartesian3),t=Cesium.Matrix4.multiplyByTranslation(Cesium.Transforms.eastNorthUpToFixedFrame(i),new Cesium.Cartesian3(0,0,0),new Cesium.Matrix4)),this._createWellWall(e,t)}addBottomSurface(e,t,i){this.bottomImg=i;i=this._prepareWell(e,t);b._createBottomSurface(i,this.bottomImg,this.agFeatureLayer)}_createWellWall(e,t){for(var i=0;i<e.length;i++){var r=this._prepareGeologyLayer(e[i].triangles),r=new Cesium.GeometryInstance({geometry:r,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.RED)},show:new Cesium.ShowGeometryInstanceAttribute(!0),modelMatrix:t}),n=new Cesium.MaterialAppearance({material:new Cesium.Material({fabric:{type:"Image",uniforms:{image:this.layerTextures[e[i].textureId]}},translucent:!1}),translucent:!1,flat:!0}),r=new Cesium.Primitive({geometryInstances:[r],asynchronous:!1,appearance:n});this.agFeatureLayer.addPrimitive(r)}}_prepareGeologyLayer(t){var i=new Float64Array(3*t.length),r=new Float32Array(3*t.length),n=0;for(let e=0;e<t.length/3;e++){var o=t[3*e],s=t[3*e+1],a=t[3*e+2],l=new Cesium.Cartesian3(o.x-s.x,o.y-s.y,o.z-s.z),u=new Cesium.Cartesian3(o.x-a.x,o.y-a.y,o.z-a.z),l=Cesium.Cartesian3.cross(l,u,new Cesium.Cartesian3);Cesium.Cartesian3.normalize(l,l),i[n]=o.x,i[n+1]=o.y,i[n+2]=o.z,i[n+3]=s.x,i[n+4]=s.y,i[n+5]=s.z,i[n+6]=a.x,i[n+7]=a.y,i[n+8]=a.z,r[n]=l.x,r[n+1]=l.y,r[n+2]=l.z,r[n+3]=l.x,r[n+4]=l.y,r[n+5]=l.z,r[n+6]=l.x,r[n+7]=l.y,r[n+8]=l.z,n+=9}return new Cesium.Geometry({attributes:{position:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:i}),normal:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:r})},primitiveType:Cesium.PrimitiveType.TRIANGLES,boundingSphere:Cesium.BoundingSphere.fromVertices(i),boundingSphereCV:Cesium.BoundingSphere.fromVertices(i)})}_prepareWell(t,e){var i=t.length;if(0!=i){var r=e,n=[];for(let e=0;e<i;e++){var o=e==i-1?0:e+1,s=Cesium.Cartographic.fromCartesian(t[e]),o=Cesium.Cartographic.fromCartesian(t[o]),a=s.longitude,l=s.latitude,u=o.longitude,c=o.latitude;0==e&&n.push(Cesium.Cartesian3.fromRadians(a,l,r));for(var h=1;h<=50;h++){var A=Cesium.Math.lerp(a,u,h/50),p=Cesium.Math.lerp(l,c,h/50);n.push(Cesium.Cartesian3.fromRadians(A,p,r))}}return n}}remove(){b.clear(),this.agFeatureLayer.removeAll()}};var Lr=new class{constructor(){this.positions=[],this._polygonPositions=[],this.entities=[],this._entities_pointParts=[],this.polygon=null,this.moveHandle=this._moveHandle.bind(this),this.clickHandle=this._clickHandle.bind(this),this.polyline=null}setParent(e,t,i,r){this.parentInstance=e,this.polygonRenderOptions=t,this.hasPoint=i,this.pointStyle=r}clear(){for(const e of this.entities)this.parentInstance.agFeatureLayer.removeEntity(e);this.polygon=null,this.polyline=null,this.positions=[],this.entities=[],this._entities_pointParts=[],this._polygonPositions=[]}finishDraw(){this.copyToPolygonPoints(this.positions)}_clickHandle(i,r){if(this.parentInstance.drawOption&&!this.parentInstance.drawOption.polygon_pickElement)this.addNodeOfPolygon(i);else{Yt.setDrawOption(this.parentInstance.drawOption);var e=Yt.compute(i);let t=this;e.then(function(e){null==e?t.addNodeOfPolygon(i):(t.pickElementArea(t,e),r({positions:e,entity:t.polygon}))}).catch(function(e){console.warn(e)})}}addNodeOfPolygon(e){var t=this.positions,e=e.position;t.push(e),1===t.length?this.createPolyline(e.clone()):2===t.length?this.updatePolyline(e):3<=t.length&&(this.removePolyline(),this.copyToPolygonPoints(t),this._createPolygon()),this.hasPoint&&(e=this.parentInstance._addPoint("agPoint",t[t.length-1].clone(),this.pointStyle),this.entities.push(e),this._entities_pointParts.push(e))}pickElementArea(e,t){e.clear(),e.parentInstance.removeAll(),e.positions=t,e._createPolygon();for(var i=0;i<t.length;i++){var r=e.parentInstance._addPoint("agPoint",t[i].clone(),e.pointStyle);e.entities.push(r),e._entities_pointParts.push(r)}e.parentInstance.drawOption&&e.parentInstance.drawOption.polygon_adjustToInSamePlane&&e.flatPolygon(e.positions),e.parentInstance.removeInputAction(),e.parentInstance._removeHighlight()}_createPolygon(){var e,t,i,r;Cesium.defined(this.polygon)||(r=this.positions,e=this.entities,t=this.polygonRenderOptions,i=this.parentInstance.agFeatureLayer,this.copyToPolygonPoints(r),(r=new qt.Z("agPolygon",this._polygonPositions,{...t,isConstant:!1})).addToLayer(i),this.polygon=r.entity,e.push(this.polygon))}_moveHandle(e){var e=e.position,t=this.positions;0!==t.length&&(1===t.length?this.updatePolyline(e):2<=t.length&&(this.removePolyline(),this.copyToPolygonPoints([...t,e]),this._createPolygon()))}errHandler(e){console.warn(e)}copyToPolygonPoints(e){this._polygonPositions.splice(0,this._polygonPositions.length);for(var t=0;t<e.length;t++)this._polygonPositions.push(e[t])}flatPolygon(e){if(!(e.length<3)){var t=agcim.maths.math.createLocalCoordinateHelper(e[0]),e=t.transformToLocal(e),i=t.transformToLocal([CIM.viewer.camera.position])[0],r=agcim.maths.math.getPlaneByLSM(e),i=agcim.maths.math.computeAngle(r,new Cesium.Cartesian3,i),n=(90<i&&i<270&&(r.x*=-1,r.y*=-1,r.z*=-1),agcim.maths.math.projectPointsAtPlane(e,r,e[0]));if(this.parentInstance.drawOption&&0!=this.parentInstance.drawOption.polygon_adjustHeight)for(var i=this.parentInstance.drawOption.polygon_adjustHeight,o=r.x*i,s=r.y*i,a=r.z*i,l=0;l<n.length;l++)n[l].x+=o,n[l].y+=s,n[l].z+=a;e=t.transformToWorld(n);this.copyToPolygonPoints(e)}}createPolyline(e){var t=this.polygonRenderOptions,i=this.parentInstance.agFeatureLayer;this.polyline=new f.Z("DrawPolygonInstance_line",[e,e],{...t,isConstant:!1}),this.polyline.addToLayer(i),this.entities.push(this.polyline.entity)}updatePolyline(e){this.polyline&&this.polyline.positions&&(this.polyline.positions.pop(),this.polyline.positions.push(e))}removePolyline(){this.polyline&&(this.polyline.remove(this.parentInstance.agFeatureLayer),this.polyline.dispose(),this.polyline=null)}removeLastPoint(){this.positions.pop(),this._removeLastPoint_pointEntity(),this.parentInstance.drawOption&&this.parentInstance.drawOption.polygon_adjustToInSamePlane&&this.flatPolygon(this.positions)}_removeLastPoint_pointEntity(){var e;this.hasPoint&&(e=this._entities_pointParts.pop(),this.parentInstance.agFeatureLayer.removeEntity(e))}},Mt={draw:di,drawFrustum:Mt,TerrainExcavation:Pr,terrain:Ge,TerrainPolygonCut:r,TerrainPolygonFlatten:i,TerrainGeologyExcavation:Tr,PickerHelper:Vt.Z,Slice:e,Roaming:o,StretchPolygon:ai,EditTool:t,ModelAdjustTool:Y,TilesCut:W,CustomTilesFlattenAndCut:Mr,DrawPolygonInstance:Lr},Pr=__webpack_require__(7014),Ge=__webpack_require__(1558);r=new class{buildPrimitiveFromRectangle(e,t,i,r){return new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.RectangleGeometry({rectangle:Cesium.Rectangle.fromDegrees(e,t,i,r),vertexFormat:Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT})}),appearance:new Cesium.EllipsoidSurfaceAppearance({aboveGround:!1})})}},i=__webpack_require__(2130),Tr=__webpack_require__(2325);var e=class{constructor(e){this.name=e,this.primitive=null}createPrimitive(e,t,i,r){r=r||Cesium.Color.RED;var n=new Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),e=new Cesium.RectangleOutlineGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:Cesium.Rectangle.fromCartesianArray(e),height:t,extrudedHeight:i}),t=Cesium.RectangleOutlineGeometry.createGeometry(e),i=new Cesium.GeometryInstance({geometry:t,modelMatrix:n,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(r)}}),e=new Cesium.Primitive({geometryInstances:i,appearance:new Cesium.PerInstanceColorAppearance({translucent:!1,flat:!0}),asynchronous:!1});this.primitive=e}addToLayer(e){this.primitive&&e.addPrimitive(this.primitive)}remove(e){this.primitive&&e.removePrimitive(this.primitive)}dispose(){this.name=null,this.primitive=null}},o=__webpack_require__(1284),t=__webpack_require__(8423),Dr=__webpack_require__(6746);class Fr extends f.Z{constructor(e,t,i){super(),this.name=e,this.options=i,this.entity=null;let r=[];t.forEach(e=>{e=agcim.maths.coordinate.getGlobalCartesian().toGeographic(e);r.push([e.lng,e.lat])});e=Dr.Z.createBezier(r);this.positions=e,this.createEntity(e)}}class Nr extends f.Z{constructor(e,t,i,r,n,o){super(),this.name=e,this.options=o,this.entity=null;e=agcim.maths.coordinate.getGlobalCartesian().toGeographic(t),o=Dr.Z.createArc(e,i,r,n);this.positions=o,this.createEntity(o)}}var Y={Billboard:Ge.Z,Circle:Wt,geometry:r,Label:i.Z,Point:Gt.Z,Polygon:qt.Z,Polyline:f.Z,Rectangle:zt.Z,RectangleBox:Tr.Z,RectangleBoxOutline:e,Box:ti.Z,Cylinder:o.Z,Ellipsoid:t.Z,Arc:Nr,Bezier:Fr,PlotShapingUtil:Dr.Z},Or=__webpack_require__(3259),Rr=__webpack_require__(8706),W={axiosWraper:c.Z,http:Or.Z,apiPath:Rr.Z,RequestOption:li};Mr=class{constructor(e){this.viewer=e,this.agRectangle=null,this.agFeatureLayer=new n.Z(e),this.debugShowMiddlePoint=!1}analysis(e){this.positions=[],this.startPoint=e.start,this.endPoint=e.end,this.lineName=e.lineName||["agPolyline"];var t,i,e=e.limt||100,r=(this.agRectangle=Cesium.Rectangle.fromCartesianArray([this.startPoint,this.endPoint]),g.Z.getGlobalCartesian().toGeographic(this.startPoint).alt),r=g.Z.getGlobalCartesian().toGeographic(this.endPoint).alt<r?(n=this.endPoint,this.startPoint):(n=this.startPoint,this.endPoint),r=Cesium.Cartesian3.subtract(r,n,new Cesium.Cartesian3),r=Cesium.Cartesian3.normalize(r,new Cesium.Cartesian3),n=new Cesium.Ray(n,r),o=this.viewer.scene.drillPickFromRay(n,e,[]);this.showDebugMiddlePoint(o);for(let e=0;e<o.length;e++)o[e].object&&this._isContains(o[e].position)&&(t=Qt.Z.getDistance(o[e].position,this.startPoint),i=Qt.Z.getDistance(o[e].position,this.endPoint),.1<t)&&.1<i&&this.positions.push(o[e].position);this._showResult()}analysisArray(e,t,i,r){for(var n=0;n<e.length;n++)for(var o=0;o<t.length;o++){var s=i?{startName:i[n],endName:r}:{startName:n,endName:o};this.analysis({start:e[n],end:t[o],lineName:s})}}_isContains(e){return!!e&&(e=Cesium.Cartographic.fromCartesian(e),Cesium.Rectangle.contains(this.agRectangle,e))}_showResult(){var e={width:8,material:new Cesium.PolylineArrowMaterialProperty(Cesium.Color.GREEN)},t={width:8,material:new Cesium.PolylineArrowMaterialProperty(Cesium.Color.RED)};if(0==this.positions.length)new f.Z(this.lineName.startName+"to"+this.lineName.endName,[this.startPoint,this.endPoint],e).addToLayer(this.agFeatureLayer);else{var i,r=Number.MAX_VALUE;for(let e=0;e<this.positions.length;e++){var n=Qt.Z.getDistance(this.positions[e],this.startPoint);n<r&&(r=n,i=this.positions[e])}new f.Z(this.lineName.startName+"to"+this.lineName.endName,[this.startPoint,i],e).addToLayer(this.agFeatureLayer),new f.Z(this.lineName.startName+"and"+this.lineName.endName,[i,this.endPoint],t).addToLayer(this.agFeatureLayer)}}showDebugMiddlePoint(e){if(this.debugShowMiddlePoint)for(var t=0;t<e.length;t++)new agcim.geometry.Point("SDS"+t,e[t].position).addToLayer(this.agFeatureLayer)}remove(){this.agFeatureLayer.removeAll()}},Lr=__webpack_require__(8698);class Ur{constructor(e){this._viewer=e,this._pickerHelper=void 0,this.idExMap={point:"draw-point-"},this.drawingEntity=void 0}getEntityList(){let t=[];return this._viewer.entities.values.forEach(e=>{e.id.startsWith(this.idExMap.point)&&t.push(e)}),t}pickAndDrawPointOnce(e={}){1==e.alpha&&(e.alpha=.99);var t={color:Cesium.Color.fromCssColorString(e.colorString||"#FFFFFF").withAlpha(e.alpha||.9),outlineColor:Cesium.Color.fromCssColorString(e.outlineColorString||"#000000").withAlpha(e.alpha||.9),outlineWidth:0,pixelSize:10,scaleByDistance:new Cesium.NearFarScalar(100,1,1e6,.01),pointHeight:0,disableDepthTestDistance:Number.POSITIVE_INFINITY};let r=Object.assign(t,e);return new Promise((t,e)=>{let i;this._createPickerHelper(),this._pickerHelper.on("LEFT_CLICK",()=>{var e=this.drawingEntity;this.drawingEntity=void 0,this.cancel(),t(e)}).on("MOUSE_MOVE",e=>{this._pickerHelper.hitTest(e).then(e=>{e.position&&(i=e.position)&&!this.drawingEntity&&(e=Date.now(),this.drawingEntity=this._viewer.entities.add({name:"基础点"+e,id:this.idExMap.point+e,position:new Cesium.CallbackProperty(()=>g.Z.getGlobalCartesian().changePointAddHeight1(i,r.pointHeight),!1),point:r}))})}).on("RIGHT_CLICK",()=>{this.cancel(),e()})})}_createPickerHelper(){this.cancel(),this._pickerHelper=new Vt.Z(this._viewer),this._pickerHelper.setCursor("crosshair")}cancel(){this._viewer.entities.remove(this.drawingEntity),this.drawingEntity=void 0,this._pickerHelper&&(this._pickerHelper.off(),this._pickerHelper.setCursor("default"),this._pickerHelper=void 0)}}class kr{constructor(e,t){this.viewer=e,this.sketch=null,this.observePosition=t.observePosition,this.targetPosition=t.targetPosition,this.distance=t.distance,this.heading=t.heading||0,this.viewPitch=t.pitch||0,this.horizontalAngle=t.horizontalAngle||90,this.verticalAngle=t.verticalAngle||60,this.maxHorizontalAngle=t.maxHorizontalAngle||120,this.maxVerticalAngle=t.maxVerticalAngle||90,this.frustumOutline=null,this.lineColor=t.lineColor,this.drawSketch(),this.drawFrustumOutline()}setTargetPosition(e){this.targetPosition=e}setObservePosition(e){this.observePosition=e}setHeading(e){this.heading=e}setPitch(e){this.pitch=e}setDistance(e){this.distance=e}setHorizontalAngle(e){this.horizontalAngle=e}setVerticalAngle(e){this.verticalAngle=e}drawFrustumOutline(){this.frustumOutline=this.viewer.entities.add({name:"frustumOutline",position:new Cesium.CallbackProperty(()=>this.observePosition,!1),orientation:new Cesium.CallbackProperty(()=>Cesium.Transforms.headingPitchRollQuaternion(this.observePosition,Cesium.HeadingPitchRoll.fromDegrees(this.heading-90,this.pitch,0)),!1),ellipsoid:{radii:new Cesium.CallbackProperty(()=>{var e=this.distance;return new Cesium.Cartesian3(e,e,e)},!1),innerRadii:new Cesium.Cartesian3(.01,.01,.01),minimumClock:new Cesium.CallbackProperty(()=>Cesium.Math.toRadians(-this.horizontalAngle/2),!1),maximumClock:new Cesium.CallbackProperty(()=>Cesium.Math.toRadians(this.horizontalAngle/2),!1),minimumCone:new Cesium.CallbackProperty(()=>{var e=90-this.verticalAngle/this.maxVerticalAngle*30;return Cesium.Math.toRadians(e)},!1),maximumCone:new Cesium.CallbackProperty(()=>{var e=90-this.verticalAngle/this.maxVerticalAngle*30;return Cesium.Math.toRadians(180-e)},!1),fill:!1,outline:!0,subdivisions:64,slicePartitions:3,outlineColor:this.lineColor}})}drawSketch(){this.sketch=this.viewer.entities.add({name:"sketch",position:new Cesium.CallbackProperty(()=>this.observePosition,!1),orientation:new Cesium.CallbackProperty(()=>Cesium.Transforms.headingPitchRollQuaternion(this.observePosition,Cesium.HeadingPitchRoll.fromDegrees(this.heading-90,this.pitch,0)),!1),ellipsoid:{radii:new Cesium.CallbackProperty(()=>{var e=this.distance;return new Cesium.Cartesian3(e,e,e)},!1),minimumClock:new Cesium.CallbackProperty(()=>Cesium.Math.toRadians(-this.horizontalAngle/2),!1),maximumClock:new Cesium.CallbackProperty(()=>Cesium.Math.toRadians(this.horizontalAngle/2),!1),minimumCone:new Cesium.CallbackProperty(()=>{var e=90-this.verticalAngle/this.maxVerticalAngle*30;return Cesium.Math.toRadians(e)},!1),maximumCone:new Cesium.CallbackProperty(()=>{var e=90-this.verticalAngle/this.maxVerticalAngle*30;return Cesium.Math.toRadians(180-e)},!1),fill:!1,outline:!0,subdivisions:256,stackPartitions:48,slicePartitions:64,outlineColor:this.lineColor}})}clear(){this.sketch&&(this.viewer.entities.remove(this.sketch),this.sketch=null),this.frustumOutline&&(this.viewer.entities.remove(this.frustumOutline),this.frustumOutline=null)}}Ge={SightAnalysis:Mr,cartesian3Helper:Lr.Z,SpaceVisibilityAnalysis:class{constructor(e){this.viewer=e,this.observePosition=null,this.observeEntity=null,this.targetPosition=null,this.postProcess=null,this.cameraLine=null,this.postProcessOptions=null,this.pointRender=new Ur(e),this.pickerHelper=new Vt.Z(e),this.ShadowMode=e.scene.globe.shadows}async draw(e={}){this.clear(),this._cancel(),this.pickerHelper.setCursor("crosshair");let r=this._getNewOptions(e);this.postProcessOptions=r;var t,e=await this.pointRender.pickAndDrawPointOnce(r.pointOptions);if(e)return this._setShadowMode(),this.pointRender.cancel(),this.viewer.entities.remove(e),t=e.position.getValue(),e.position=this._getPosition(t,r.observeOffset),this.viewer.entities.add(e),this.observePosition=t,this.observeEntity=e,new Promise((t,e)=>{let i;this.pickerHelper.on("LEFT_DOUBLE_CLICK",async e=>{e=await this.pickerHelper.hitTest(e);i=e.position,this.targetPosition=i,r.analysis&&this.observePosition&&this.targetPosition&&this.analysis(),this.postProcessOptions.distance=this.distance,this._cancel(),t(this.postProcessOptions)}).on("MOUSE_MOVE",async e=>{e=await this.pickerHelper.hitTest(e);e.position&&(i=e.position,this.cameraLine||(this._createCameraLine(i,this.postProcessOptions),this.setFrustumOutline(this.postProcessOptions.frustumOutline)),this._setCameraLine(this.observePosition,i))}).on("RIGHT_CLICK",()=>{this._cancel(),e()})})}_setShadowMode(){var e=this.viewer.terrainProvider;this.viewer.scene.globe.shadows=e.availability?Cesium.ShadowMode.ENABLED:this.ShadowMode}_getNewOptions(e){e=Object.assign({pointOptions:{pointHeight:1.8},lineColor:Cesium.Color.fromCssColorString(e.lineColorString||"#FFFFFF").withAlpha(1),analysis:!0,maxHorizontalAngle:120,horizontalAngle:90,verticalAngle:90,maxVerticalAngle:90,alpha:.5,visibleColor:Cesium.Color.fromCssColorString(e.visibleColorString||"#00FF00").withAlpha(1),invisibleColor:Cesium.Color.fromCssColorString(e.invisibleColorString||"#FF0000").withAlpha(1),frustumOutline:!0,observeOffset:{x:0,y:0,z:0},pitch:0,heading:0,distance:0},e);return e.observeHeight<1.8&&(e.observeHeight=1.8),e}analysis(){if(!this.observePosition||!this.targetPosition)throw new Error("请绘制区域");this.postProcess||(this._createShadowMap(),this._addPostProcess())}setFrustumOutline(e=!0){this.cameraLine&&this.cameraLine.frustumOutline&&(this.cameraLine.frustumOutline.show=e)}_createShadowMap(){var e=this.postProcessOptions,t=(e.maxHorizontalAngle=180<=e.maxHorizontalAngle?179:e.maxHorizontalAngle<0?0:e.maxHorizontalAngle,e.maxVerticalAngle=180<=e.maxVerticalAngle?179:e.maxVerticalAngle<0?0:e.maxVerticalAngle,this.lightCamera=new Cesium.Camera(this.viewer.scene),this.lightCamera.position=this.observePosition,this.lightCamera.frustum.near=.001*this.distance,this.lightCamera.frustum.far=this.distance,Cesium.Math.toRadians(e.maxHorizontalAngle)),i=Cesium.Math.toRadians(e.maxVerticalAngle),r=this.distance*Math.tan(t/2)*2/(this.distance*Math.tan(i/2)*2);this.lightCamera.frustum.aspectRatio=r,this.lightCamera.frustum.fov=i<t?t:i,this.lightCamera.setView({destination:this.observePosition,orientation:{heading:Cesium.Math.toRadians(e.heading||0),pitch:Cesium.Math.toRadians(e.pitch||0),roll:0}}),this.viewShadowMap=new Cesium.ShadowMap({lightCamera:this.lightCamera,enabled:!0,isPointLight:!1,cascadesEnabled:!1,context:this.viewer.scene.context,pointLightRadius:this.distance,darkness:1}),this.viewer.scene.shadowMap=this.viewShadowMap}_getHeading(e,t){var i=new Cesium.Cartesian3,e=Cesium.Transforms.eastNorthUpToFixedFrame(e);return Cesium.Matrix4.inverse(e,e),Cesium.Matrix4.multiplyByPoint(e,t,i),Cesium.Cartesian3.normalize(i,i),Cesium.Math.toDegrees(Math.atan2(i.x,i.y))}_getPitch(e,t){var i=new Cesium.Cartesian3,e=Cesium.Transforms.eastNorthUpToFixedFrame(e);return Cesium.Matrix4.inverse(e,e),Cesium.Matrix4.multiplyByPoint(e,t,i),Cesium.Cartesian3.normalize(i,i),Cesium.Math.toDegrees(Math.asin(i.z))}_addPostProcess(){let t=this,i=t.viewShadowMap._isPointLight?t.viewShadowMap._pointBias:t.viewShadowMap._primitiveBias,e=new Cesium.Texture({context:this.viewer.scene.context,source:{width:1,height:1,arrayBufferView:new Uint8Array([0,0,0,0])},flipY:!1});this.postProcess=new Cesium.PostProcessStage({fragmentShader:`uniform float czzj;
uniform float dis;
uniform float spzj;
uniform vec3 visibleColor;
uniform vec3 disVisibleColor;
uniform float mixNum;
uniform sampler2D colorTexture;
uniform sampler2D stcshadow;
uniform sampler2D depthTexture;
uniform mat4 _shadowMap_matrix;
uniform vec4 shadowMap_lightPositionEC;
uniform vec3 shadowMap_lightPositionWC;
uniform vec4 shadowMap_lightDirectionEC;
uniform vec3 shadowMap_lightUp;
uniform vec3 shadowMap_lightDir;
uniform vec3 shadowMap_lightRight;
uniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness;
uniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth;
in vec2 v_textureCoordinates;
vec4 toEye(in vec2 uv, in float depth) {
    vec2 xy = vec2((uv.x * 2.0 - 1.0), (uv.y * 2.0 - 1.0));
    vec4 posInCamera = czm_inverseProjection * vec4(xy, depth, 1.0);
    posInCamera = posInCamera / posInCamera.w;
    return posInCamera;
}
float getDepth(in vec4 depth) {
    float z_window = czm_unpackDepth(depth);
    z_window = czm_reverseLogDepth(z_window);
    float n_range = czm_depthRange.near;
    float f_range = czm_depthRange.far;
    return (2.0 * z_window - n_range - f_range) / (f_range - n_range);
}
float _czm_sampleShadowMap(sampler2D shadowMap, vec2 uv) {
    return texture(shadowMap, uv).r;
}
float _czm_shadowDepthCompare(sampler2D shadowMap, vec2 uv, float depth) {
    return step(depth, _czm_sampleShadowMap(shadowMap, uv));
}
float _czm_shadowVisibility(sampler2D shadowMap, czm_shadowParameters shadowParameters) {
    float depthBias = shadowParameters.depthBias;
    float depth = shadowParameters.depth;
    float nDotL = shadowParameters.nDotL;
    float normalShadingSmooth = shadowParameters.normalShadingSmooth;
    float darkness = shadowParameters.darkness;
    vec2 uv = shadowParameters.texCoords;
    depth -= depthBias;
    vec2 texelStepSize = shadowParameters.texelStepSize;
    float radius = 1.0;
    float dx0 = -texelStepSize.x * radius;
    float dy0 = -texelStepSize.y * radius;
    float dx1 = texelStepSize.x * radius;
    float dy1 = texelStepSize.y * radius;
    float visibility = (_czm_shadowDepthCompare(shadowMap, uv, depth) + _czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy0), depth) +
        _czm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy0), depth) +
        _czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy0), depth) +
        _czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, 0.0), depth) +
        _czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, 0.0), depth) +
        _czm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy1), depth) +
        _czm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy1), depth) +
        _czm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy1), depth)) * (1.0 / 9.0);
    return visibility;
}
vec3 pointProjectOnPlane(in vec3 planeNormal, in vec3 planeOrigin, in vec3 point) {
    vec3 v01 = point - planeOrigin;
    float d = dot(planeNormal, v01);
    return (point - planeNormal * d);
}
float ptm(vec3 pt) {
    return sqrt(pt.x * pt.x + pt.y * pt.y + pt.z * pt.z);
}
void main() {
    const float PI = 3.141592653589793;
    //从纹理获取颜色
    vec4 color = texture(colorTexture, v_textureCoordinates);
    //从纹理获取深度
    vec4 currD = texture(depthTexture, v_textureCoordinates);

    // vec4 stcc = texture(stcshadow, v_textureCoordinates);
    // out_FragColor = currD;
    // return;
    //深度大于1的直接保留原来的颜色返回
    if(currD.r >= 1.0) {
        out_FragColor = color;
        return;
    }
    //获取解压之后的深度值
    float depth = getDepth(currD);
    // out_FragColor = vec4(depth,0.0,0.0,1.0);
    // return;
    // float depth = czm_unpackDepth(texture(depthTexture, v_textureCoordinates));
    //根据深度值获取片元的坐标
    vec4 positionEC = toEye(v_textureCoordinates, depth);
    vec3 normalEC = vec3(1.0);
    //阴影相关的参数
    czm_shadowParameters shadowParameters;
    shadowParameters.texelStepSize = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy;
    shadowParameters.depthBias = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z;
    shadowParameters.normalShadingSmooth = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w;
    shadowParameters.darkness = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w;
    shadowParameters.depthBias *= max(depth * 0.01, 1.0);
    //片元到点光源的方向
    vec3 directionEC = normalize(positionEC.xyz - shadowMap_lightPositionEC.xyz);
    float nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0);
    vec4 shadowPosition = _shadowMap_matrix * positionEC;
    shadowPosition /= shadowPosition.w;
    if(any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) {
        out_FragColor = color;
        return;
    }

    // 坐标与视点位置距离，大于最大距离则舍弃阴影效果
    vec4 lw = vec4(shadowMap_lightPositionWC, 1.0);
    vec4 vw = czm_inverseView * vec4(positionEC.xyz, 1.0);
    if(distance(lw.xyz, vw.xyz) > dis) {
        out_FragColor = color;
        return;
    }

    // 水平夹角限制
    vec3 ptOnSP = pointProjectOnPlane(shadowMap_lightUp, lw.xyz, vw.xyz);
    directionEC = ptOnSP - lw.xyz;
    float directionECMO = ptm(directionEC.xyz);
    float shadowMap_lightDirMO = ptm(shadowMap_lightDir.xyz);
    float cosJJ = dot(directionEC, shadowMap_lightDir) / (directionECMO * shadowMap_lightDirMO);
    float degJJ = acos(cosJJ) * (180.0 / PI);
    degJJ = abs(degJJ);
    if(degJJ > spzj / 2.0) {
        out_FragColor = color;
        return;
    }

    // 垂直夹角限制
    vec3 ptOnCZ = pointProjectOnPlane(shadowMap_lightRight, lw.xyz, vw.xyz);
    vec3 dirOnCZ = ptOnCZ - lw.xyz;
    float dirOnCZMO = ptm(dirOnCZ);
    float cosJJCZ = dot(dirOnCZ, shadowMap_lightDir) / (dirOnCZMO * shadowMap_lightDirMO);
    float degJJCZ = acos(cosJJCZ) * (180.0 / PI);
    degJJCZ = abs(degJJCZ);
    if(degJJCZ > czzj / 2.0) {
        out_FragColor = color;
        return;
    }

    shadowParameters.texCoords = shadowPosition.xy;
    shadowParameters.depth = shadowPosition.z;
    shadowParameters.nDotL = nDotL;
    float visibility = _czm_shadowVisibility(stcshadow, shadowParameters);
    if(visibility == 1.0) {
        out_FragColor = mix(color, vec4(visibleColor, 1.0), mixNum);
    } else {
         //if(abs(shadowPosition.z-0.0)<0.01){
          //   return;
        //}
        out_FragColor = mix(color, vec4(disVisibleColor, 1.0), mixNum);
    }
}
`,uniforms:{czzj:function(){return t.postProcessOptions.verticalAngle},dis:function(){return t.distance},spzj:function(){return t.postProcessOptions.horizontalAngle},visibleColor:function(){return t.postProcessOptions.visibleColor},disVisibleColor:function(){return t.postProcessOptions.invisibleColor},mixNum:function(){return t.postProcessOptions.alpha},stcshadow:function(){return t.viewShadowMap._shadowMapTexture||e},_shadowMap_matrix:function(){return t.viewShadowMap._shadowMapMatrix},shadowMap_lightPositionEC:function(){return t.viewShadowMap._lightPositionEC},shadowMap_lightPositionWC:function(){return t.viewShadowMap._lightCamera.position},shadowMap_lightDirectionEC:function(){return t.viewShadowMap._lightDirectionEC},shadowMap_lightUp:function(){return t.viewShadowMap._lightCamera.up},shadowMap_lightDir:function(){return t.viewShadowMap._lightCamera.direction},shadowMap_lightRight:function(){return t.viewShadowMap._lightCamera.right},shadowMap_texelSizeDepthBiasAndNormalShadingSmooth:function(){var e=new Cesium.Cartesian2;return e.x=1/t.viewShadowMap._textureSize.x,e.y=1/t.viewShadowMap._textureSize.y,Cesium.Cartesian4.fromElements(e.x,e.y,i.depthBias,i.normalShadingSmooth,this.combinedUniforms1)},shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness:function(){return Cesium.Cartesian4.fromElements(i.normalOffsetScale,t.viewShadowMap._distance,t.viewShadowMap.maximumDistance,t.viewShadowMap._darkness,this.combinedUniforms2)}}}),this.viewer.scene.postProcessStages.add(this.postProcess)}_cancel(){this.pickerHelper&&(this.pickerHelper.reset(),this.pickerHelper.setCursor("default")),this.pointRender&&this.pointRender.cancel(),this.targetPosition||(this.cameraLine&&this.cameraLine.clear(),this.observeEntity&&this.viewer.entities.remove(this.observeEntity))}_createCameraLine(e,t){this.cameraLine&&this.cameraLine.clear(),this.cameraLine=new kr(this.viewer,{observePosition:this.observePosition,targetPosition:e,horizontalAngle:t.horizontalAngle,verticalAngle:t.verticalAngle,maxHorizontalAngle:t.maxHorizontalAngle,maxVerticalAngle:t.maxVerticalAngle,heading:t.heading,pitch:t.pitch,distance:this.distance,lineColor:t.lineColor})}setHorizontalAngle(e){this.cameraLine&&this.cameraLine.setHorizontalAngle(e),this.postProcessOptions.horizontalAngle=e}setVerticalAngle(e){this.cameraLine&&this.cameraLine.setVerticalAngle(e),this.postProcessOptions.verticalAngle=e}setDistance(e){this.distance=e,this.postProcessOptions.distance=e,this._createShadowMap(),this.cameraLine&&this.cameraLine.setDistance(e)}setVisibleColor(e){this.postProcessOptions.visibleColor=Cesium.Color.fromCssColorString(e).withAlpha(1)}setInVisibleColor(e){this.postProcessOptions.invisibleColor=Cesium.Color.fromCssColorString(e).withAlpha(1)}_getPosition(e,t){e=g.Z.getGlobalCartesian().toWebMercator(e,this.viewer),e.x+=t.x||0,e.y+=t.y||0,e.z+=t.z||0,t=g.Z.getWebMercator().toCartesian(e,this.viewer);return t}_setCameraLine(e,t){this.distance=this.targetPosition?this.distance:Number(Cesium.Cartesian3.distance(e,t).toFixed(1)),this.postProcessOptions.heading=this._getHeading(e,t),this.postProcessOptions.pitch=this._getPitch(e,t),this.postProcessOptions.distance=this.distance,this.cameraLine.setHeading(this.postProcessOptions.heading),this.cameraLine.setPitch(this.postProcessOptions.pitch),this.cameraLine.setDistance(this.postProcessOptions.distance)}setOffset(e){this.viewer.entities.remove(this.observeEntity);var t=this.observeEntity.position._value,t=this._getPosition(t,e);this.observeEntity.position=t,this.observePosition=t,this.viewer.entities.add(this.observeEntity),this.cameraLine.setObservePosition(this.observePosition),this._setCameraLine(this.observePosition,this.targetPosition),this._createShadowMap()}_dataURLToBlob(e){var e=e.split(","),t=e[0].match(/:(.*?);/)[1],i=atob(e[1]);let r=i.length;for(var n=new Uint8Array(r);r--;)n[r]=i.charCodeAt(r);return new Blob([n],{type:t})}clear(){this.viewer.scene.postProcessStages.remove(this.postProcess),this.cameraLine&&this.cameraLine.clear(),this.observeEntity&&this.viewer.entities.remove(this.observeEntity),this.viewer.scene.globe.shadows=this.ShadowMode,this.observePosition=null,this.observeEntity=null,this.targetPosition=null,this.postProcess=null,this.cameraLine=null,this.postProcessOptions=null,this.ShadowMode=null}}};r=new class{str2Unicode(e){for(var t=[],i=0;i<e.length;i++)t[i]=("00"+e.charCodeAt(i).toString(16)).slice(-4);return"\\u"+t.join("\\u")}getCurrentData(){return(new Date).toLocaleDateString()}toPercent(e,t=2){e=Number(100*e).toFixed(t);return e+="%"}isNumber(e){return""!==e&&null!=e&&!isNaN(e)}resizeImage(e,l,u=200){var t;function i(e){var t=document.createElement("canvas"),i=t.getContext("2d"),r=e.width,n=e.height,o=u,s=r,a=n,o=((u<r||o<n)&&(u/o<r/n?(s=u,a=Math.round(u*(n/r))):(a=o,s=Math.round(o*(r/n)))),t.width=s,t.height=a,i.clearRect(0,0,s,a),i.drawImage(e,0,0,s,a),t.toDataURL("image/jpeg",.92));l(o)}/^\s*data:([a-z]+\/[a-z0-9-+.]+(;[a-z-]+=[a-z0-9-]+)?)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s]*?)\s*$/i.test(e)?((t=new Image).src=e,t.onload=function(){i(t)}):"IMG"==e.tagName&&i(e)}concat(e,t){if(!t)return e;var i,r={};for(i in t)r[i]={...e[i],...t[i]};return r}};function Hr(e,t,i=.1){var r=new Date,i=(r.setTime(r.getTime()+24*i*60*60*1e3),"expires="+r.toGMTString());document.cookie=e+"="+t+"; "+i}function Qr(e){for(var t=e+"=",i=document.cookie.split(";"),r=0;r<i.length;r++){var n=i[r].trim();if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""}var Vr={setCookie:Hr,getCookie:Qr,checkCookie:function(){Qr("username")}};function Gr(e){var t,i={};for(t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return i}function zr(e,t){t=t||"OBJECTID";var i,r={wkid:4326},n={};switch(e.type){case"Point":n.x=e.coordinates[0],n.y=e.coordinates[1],null!=e.coordinates[2]&&(n.z=e.coordinates[2]),n.spatialReference=r;break;case"MultiPoint":n.points=e.coordinates.slice(0),null!=e.coordinates[0][2]&&(n.hasZ=!0),n.spatialReference=r;break;case"LineString":n.paths=[e.coordinates.slice(0)],null!=e.coordinates[0][2]&&(n.hasZ=!0),n.spatialReference=r;break;case"MultiLineString":n.paths=e.coordinates.slice(0),null!=e.coordinates[0][0][2]&&(n.hasZ=!0),n.spatialReference=r;break;case"Polygon":n.rings=Zr(e.coordinates.slice(0)),null!=e.coordinates[0][0][2]&&(n.hasZ=!0),n.spatialReference=r;break;case"MultiPolygon":n.rings=function(e){for(var t=[],i=0;i<e.length;i++)for(var r=Zr(e[i]),n=r.length-1;0<=n;n--){var o=r[n].slice(0);t.push(o)}return t}(e.coordinates.slice(0)),null!=e.coordinates[0][0][0][2]&&(n.hasZ=!0),n.spatialReference=r;break;case"Feature":e.geometry&&(n.geometry=zr(e.geometry,t)),n.attributes=e.properties?Gr(e.properties):{},e.id&&(n.attributes[t]=e.id);break;case"FeatureCollection":for(n=[],i=0;i<e.features.length;i++)n.push(zr(e.features[i],t));break;case"GeometryCollection":for(n=[],i=0;i<e.geometries.length;i++)n.push(zr(e.geometries[i],t))}return n}var i=new class{constructor(){this.cubeMap={positiveX:"",negativeX:"",positiveY:"",negativeY:"",positiveZ:"",negativeZ:""},this._faces={top:this.cubeMap.positiveZ,bottom:this.cubeMap.negativeZ,left:this.cubeMap.negativeX,right:this.cubeMap.positiveX,front:this.cubeMap.positiveY,back:this.cubeMap.negativeY}}getCubeMap(e,t,i){i&&(i.show=!1);var r,e=e.scene,n=this.createSixNormal(t),o=this.createCamera(e);for(r in n)this.applyCubeMap(o,t,n[r],r);return i&&(i.show=!0),this.cubeMap}generateCameraPicture(e,t,i){t=this.sceneFrameBufferTextureToImage(t,i,this.createView(t.scene,i));this.downTextures(t,e)}createSixNormal(e){var t=this.setTranslation(e,0,0,100),t=new Cesium.Cartesian3(t.x-e.x,t.y-e.y,t.z-e.z),t=Cesium.Cartesian3.normalize(t,new Cesium.Cartesian3),i=this.setTranslation(e,0,0,-100),i=new Cesium.Cartesian3(i.x-e.x,i.y-e.y,i.z-e.z),i=Cesium.Cartesian3.normalize(i,new Cesium.Cartesian3),r=this.setTranslation(e,-100,0,0),r=new Cesium.Cartesian3(r.x-e.x,r.y-e.y,r.z-e.z),r=Cesium.Cartesian3.normalize(r,new Cesium.Cartesian3),n=this.setTranslation(e,100,0,0),n=new Cesium.Cartesian3(n.x-e.x,n.y-e.y,n.z-e.z),n=Cesium.Cartesian3.normalize(n,new Cesium.Cartesian3),o=this.setTranslation(e,0,-100,0),o=new Cesium.Cartesian3(o.x-e.x,o.y-e.y,o.z-e.z),o=Cesium.Cartesian3.normalize(o,new Cesium.Cartesian3),s=this.setTranslation(e,0,100,0),s=new Cesium.Cartesian3(s.x-e.x,s.y-e.y,s.z-e.z);return{top:{direction:t,up:s=Cesium.Cartesian3.normalize(s,new Cesium.Cartesian3)},bottom:{direction:i,up:s},left:{direction:r,up:t},right:{direction:n,up:t},front:{direction:o,up:t},back:{direction:s,up:t}}}createCamera(e){var t=new Cesium.Camera(e);return t.frustum.far=e.camera.frustum.far,t.frustum.near=.1,t.frustum.fov=Cesium.Math.toRadians(90),t}sceneFrameBufferTextureToImage(i,r,n){var o=new Cesium.Cesium3DTilePassState({pass:Cesium.Cesium3DTilePass.RENDER}),s=i.scene,a=s._hdr;if(s._hdr=!1,s.view=n,s._environmentState.useGlobeDepthFramebuffer=!0,n&&n.sceneFramebuffer.begin){var l=n.sceneFramebuffer.begin(),o=(s.jobScheduler.disableThisFrame(),s.updateFrameState(),s.frameState.invertClassification=!1,s.frameState.passes.render=!0,s.frameState.passes.pick=!1,s.frameState.passes.offscreen=!0,s.frameState.tilesetPassState=o,s.frameState.camera=r,s.frameState.cullingVolume=r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC),s.context.uniformState.update(s.frameState),Cesium.defined(s.globe)&&s.globe.beginFrame(s.frameState),Cesium.defaultValue(s.backgroundColor,Cesium.Color.TRANSPARENT));s.updateEnvironment(),s.updateAndExecuteCommands(l,o),s.resolveFramebuffers(l),s.view=s.defaultView,s.frameState.frameNumber=Cesium.Math.incrementWrap(s.frameState.frameNumber,15e6,1),Cesium.defined(s.globe)&&(s.globe.endFrame(s.frameState),s.globe.tilesLoaded||(s._renderRequested=!0)),s.context.endFrame(),s._hdr=a;let e=void 0,t=void 0;return n.sceneFramebuffer._colorTexture?e=n.sceneFramebuffer._colorTexture:(e=n.sceneFramebuffer._colorFramebuffer._colorTextures[0],t=n.sceneFramebuffer.depthStencilTexture),agcim.renderer.ReplaceTextrue.textureToImage(i,e,void 0,t)}}downTextures(e,t){var i=document.createElement("a");i.style.display="none",i.href=e,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i)}downloadCubeMapImages(e,t){this.downTextures(e,t),this._faces[t]=e}applyCubeMap(e,t,i,r,n){t.setView({destination:i,orientation:{direction:r.direction,up:r.up}});i=this.sceneFrameBufferTextureToImage(e,t,this.createView(e.scene,t));this.downloadCubeMapImages(i,n)}setTranslation(e,t,i,r){var e=Cesium.Transforms.eastNorthUpToFixedFrame(e),n=new Cesium.Matrix4,t=(Cesium.Matrix4.setTranslation(Cesium.Matrix4.IDENTITY,new Cesium.Cartesian3(t,i,r),n),Cesium.Matrix4.multiply(e,n,e));return Cesium.Matrix4.getTranslation(t,new Cesium.Cartesian3)}createView(e,t){let i=new Cesium.BoundingRectangle(0,0,e.drawingBufferWidth,e.drawingBufferHeight),r=new Cesium.View(e,t,i);return r.sceneFramebuffer.begin=function(){return r.sceneFramebuffer.clear(e.context,r.passState,Cesium.Color.TRANSPARENT),r.sceneFramebuffer.update(e.context,i,e.highDynamicRange),r.passState.framebuffer=r.sceneFramebuffer.getFramebuffer(),r.passState},r}},Tr={commonUtils:r,cookies:Vr,fileFonversion:ce,D3Captrue:i},Wr=__webpack_require__(4764),e=__webpack_require__(7171),o=__webpack_require__(9359),t=__webpack_require__(7830),qr=__webpack_require__.n(t),Kr=function(e){return function(e,t){for(var i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}(e[0],e[e.length-1])||e.push(e[0]),e},jr=function(e){for(var t,i=0,r=0,n=e.length,o=e[r];r<n-1;r++)i+=((t=e[r+1])[0]-o[0])*(t[1]+o[1]),o=t;return 0<=i},Zr=function(e){var t=[],i=e.slice(0),e=Kr(i.shift().slice(0));if(4<=e.length){jr(e)||e.reverse(),t.push(e);for(var r=0;r<i.length;r++){var n=Kr(i[r].slice(0));4<=n.length&&(jr(n)&&n.reverse(),t.push(n))}}return t},Mr=__webpack_require__(9126),Yr=__webpack_require__.n(Mr);Lr={CreateQuery:class{constructor(e){var t;if(!(e=Object.assign({coordinateSystemName:"EPSG:4326",outputFormat:"application/json",maxFeatures:1e3},e)).layerName)throw new Error("没有传入图层名称，图层名称是必填字段");this.typename=e.layerName,this.version=e.version,this.coordinateSystemName=e.coordinateSystemName,this.maxFeatures=e.maxFeatures,this.outputFormat=e.outputFormat,e.outFields&&(this.propertyname=e.outFields),e.extent&&(this.bbox=e.extent.join()+","+this.coordinateSystemName),e.spatialRelationship&&e.geometry&&(t="_"+(e.geometry.geometry.type+e.spatialRelationship).toLowerCase(),this.filter=this[t](e.geometry,e.geometryField,e.version)),e.where&&(this.cql_filter=e.where),e.sortBy&&(this.sortBy=e.sortBy),e.featureid&&(this.featureid=e.featureid)}_pointintersects(e,t="the_geom",i){return'<Filter xmlns="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml"><Intersects><PropertyName>'+t+'</PropertyName><gml:Point srsName="'+this.coordinateSystemName+'"><gml:coordinates>'+Wr.Z.featurecoorToWfsWGS84Stsring(e)+"</gml:coordinates></gml:Point></Intersects></Filter>"}_linestringintersects(e,t="the_geom",i){return'<Filter xmlns="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml"><Intersects><PropertyName>'+t+'</PropertyName><gml:LineString srsName="'+this.coordinateSystemName+'"><gml:coordinates>'+Wr.Z.featurecoorToWfsWGS84Stsring(e)+"</gml:coordinates></gml:LineString></Intersects></Filter>"}_polygonintersects(e,t="the_geom",i="2.0.0"){return i.startsWith("1")?'<Filter xmlns="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml"><Intersects><PropertyName>'+t+'</PropertyName><gml:Polygon srsName="'+this.coordinateSystemName+'"><gml:outerBoundaryIs><gml:LinearRing  srsName="'+this.coordinateSystemName+'"><gml:coordinates>'+Wr.Z.featurecoorToWfsWGS84Stsring(e)+"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon></Intersects></Filter>":'<Filter xmlns="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml"><Intersects><PropertyName>'+t+'</PropertyName><gml:Polygon srsName="'+this.coordinateSystemName+'"><gml:exterior><gml:LinearRing  srsName="'+this.coordinateSystemName+'"><gml:coordinates>'+Wr.Z.featurecoorToWfsWGS84Stsring(e)+"</gml:coordinates></gml:LinearRing></gml:exterior></gml:Polygon></Intersects></Filter>"}_polygoncontains(e,t="the_geom",i="2.0.0"){return i.startsWith("1")?'<Filter xmlns="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml"><Within><PropertyName>'+t+'</PropertyName><gml:Polygon srsName="'+this.coordinateSystemName+'"><gml:outerBoundaryIs><gml:LinearRing  srsName="'+this.coordinateSystemName+'"><gml:coordinates>'+Wr.Z.featurecoorToWfsWGS84Stsring(e)+"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon></Within></Filter>":'<Filter xmlns="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml"><Within><PropertyName>'+t+'</PropertyName><gml:Polygon srsName="'+this.coordinateSystemName+'"><gml:exterior><gml:LinearRing  srsName="'+this.coordinateSystemName+'"><gml:coordinates>'+Wr.Z.featurecoorToWfsWGS84Stsring(e)+"</gml:coordinates></gml:LinearRing></gml:exterior></gml:Polygon></Within></Filter>"}},QueryTask:e.Z,WFSQueryHelper:o.Z,ArcGISQueryHelper:class{constructor(e,t){this.url=e,this.spatialReference=t}async queryFeatureBySpatialRelationshipCQL(e,t,i="esriSpatialRelIntersects"){e=this.url+`/${e}/query`,t=qr().parse(t);let r="esriGeometryEnvelope";switch(t.type){case"Point":r="esriGeometryPoint";break;case"MultiPoint":r="esriGeometryMultipoint";break;case"LineString":case"MultiLineString":r="esriGeometryPolyline";break;case"Polygon":case"MultiPlygon":r="esriGeometryPolygon"}t=zr(t),t={where:"1=1",outFields:"*",geometry:JSON.stringify(t),geometryType:r,spatialRel:i,returnGeometry:!0,returnIdsOnly:!1,returnCountOnly:!1,returnZ:!1,returnM:!1,outSR:4326,returnDistinctValues:!1,f:"pjson"},i=Yr().stringify(t);return Ye()({method:"post",maxBodyLength:1/0,url:e,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:i})}}},r=__webpack_require__(5271),i=__webpack_require__(9195);class Xr extends Tt.Z{async getCompareDataTwo(e,t,i,r,n){var o,s=`paramType=${i}&baseTableName=${e}&targetTableName=${t}&columns=${r}&page=1&rows=50`;for(o in n)s+=`&${o}=`+n[o];return this.setNetInfo(),await c.Z.getData(this._baseUrl+"/dentity/get?"+s)}}t=new Xr;class Jr extends Tt.Z{async getStatics(e,t,i,r){var n,o=`tableName=${e}&countKey=${t}&groupKey=`+i;for(n in r)o+=`&${n}=`+r[n];return this.setNetInfo(),await c.Z.getData(this._baseUrl+"/dentity/statistics?"+o)}}var Mr=new Jr,$r=__webpack_require__(4207);class en extends Tt.Z{constructor(){super(),this.entityTable=new $r.Z}async getAllLevelInfo(e){e=await this.entityTable.getPropertyByParams(e,{infotype:"LevelInfo"});if(e.success&&null!==e.content&&""!=e.content){var t=e.content,i=[];for(let e=0;e<t.length;e++){var r=JSON.parse(t[e].topologyelements).Elevation;i.push({name:t[e].name,height:r})}return i}}}e=new en,o=__webpack_require__(2759);var Tt={revitHelper:r.Z,serverData4BIM:i.Z,bimTableServer:Kt.Z,bimDBTable:{entityTable:$r.Z},bussiness:{bimBuildingComparer:t,bimBuildingStatics:Mr,bimBuildingLevels:e},BIMPrimitive:o.Z,BIMLinePrimitive:class{constructor(e,t,i,r,n){this.name=e,this.primitive=null,this.createPrimitive(t,i,r,n)}createPrimitive(e,t,i,r){var n,o;null!=e&&""!=e&&(null==t&&(t={color:Cesium.Color.RED,translucent:!1}),n=this.name,e=this.computeGeometryBuffer(e,i,r),o=this.getApperance(t),(e=this.getInstance(e,i,t,r)).id=n,(i=new Cesium.Primitive({geometryInstances:e,appearance:o}))._compressVertices=!1,this.primitive=i)}getApperance(e){return new Cesium.PolylineMaterialAppearance({translucent:e.translucent,material:Cesium.Material.fromType("Color",{color:e.color})})}getInstance(e,t,i,r){var n=e.positions,o=null;return o="polyline"==r?(r=new Cesium.PolylineGeometry({positions:n,width:2,vertexFormat:Cesium.PolylineColorAppearance.VERTEX_FORMAT}),t=Cesium.Matrix4.IDENTITY,Cesium.PolylineGeometry.createGeometry(r)):new Cesium.Geometry({attributes:{position:new Cesium.GeometryAttribute({componentDatatype:Cesium.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:n})},indices:e.index,primitiveType:Cesium.PrimitiveType.LINES,boundingSphere:Cesium.BoundingSphere.fromVertices(n)}),new Cesium.GeometryInstance({geometry:o,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(i.color)},modelMatrix:t})}computeGeometryBuffer(e,t,i){var r=e.LineIndices||e.lineIndexes,n=[],o=[],s=Qt.Z.createLocalCoordinateHelper(t),a=e.Vertices||e.vertices;if(r[0].hasOwnProperty("X"))for(let e=0;e<r.length;e++){var l=r[e].X,u=r[e].Y,c=a[l],h=a[u];n.push(l),n.push(u),"polyline"==i&&(A=new Cesium.Cartesian3(c.X,c.Y,c.Z),u=new Cesium.Cartesian3(h.X,h.Y,c.Z),p=s.transformToWorld([A,u]),Array.prototype.push.apply(o,p))}else for(let e=0;e<r.length;e++){var A,p,c=a[l=r[e]];n.push(l),"polyline"==i&&(A=new Cesium.Cartesian3(c[0],c[1],c[2]),p=s.transformToWorld([A]),Array.prototype.push.apply(o,p))}if("polyline"!=i)if(o=new Float64Array(3*a.length),a[0].hasOwnProperty("X"))for(let e=0;e<a.length;e++){c=a[e];o[3*e]=c.X,o[3*e+1]=c.Y,o[3*e+2]=c.Z}else for(let e=0;e<a.length;e++){c=a[e];o[3*e]=c[0],o[3*e+1]=c[1],o[3*e+2]=c[2]}return{positions:o,index:new Uint16Array(n)}}addToLayer(e){e.addPrimitive(this.primitive)}remove(e){e.removePrimitive(this.primitive)}dispose(){this.name=null,this.primitive=null}}},r=__webpack_require__(2800),i=__webpack_require__(7637),t=__webpack_require__(1673),Mr=__webpack_require__(7073),e=__webpack_require__(7),o=__webpack_require__(7566),tn=__webpack_require__(2614),rn=__webpack_require__(3418),nn=__webpack_require__(1049),on=__webpack_require__(5875),sn=__webpack_require__(1979),an=__webpack_require__(8560),ln=__webpack_require__(8490),un=__webpack_require__(2499),cn=__webpack_require__(5205),hn=__webpack_require__(4499),An=__webpack_require__(4263),pn=__webpack_require__(8491),fn=__webpack_require__(8270);class dn extends n.Z{static layerType="040100";constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this._initialize(e)}_initialize(e){var t={layerType:dn.layerType,url:"",spatialReference:{wkid:"4326"},layerIndex:void 0,subdomains:[1,2,3]};if(Object.assign(this.agMetaData,t,e),!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.");this._isLoadData=!1,this._isAddViewer=!1,this._loadData()}_loadData(){var e;this._isLoadData||(e=new Cesium.UrlTemplateImageryProvider(this.agMetaData),this._imageryLayerProviders.push(e),this.loadDataPromise=Promise.resolve(e),this._isLoadData=!0)}zoomToLayer(){var e;this._imageryLayerProviders?.length&&(e=this._imageryLayerProviders[0]?._rectangle)&&this.viewer.camera.setView({destination:e})}}var gn=dn;class mn extends n.Z{static layerType="";constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this._initialize(e)}_initialize(e){var t={layerType:mn.layerType,url:"",spatialReference:{wkid:"4326"},layerIndex:void 0,minimumLevel:3,maximumLevel:18};if(Object.assign(this.agMetaData,t,e),!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.");this._isLoadData=!1,this._isAddViewer=!1,this._loadData()}_loadData(){var e;this._isLoadData||(e=new Cesium.UrlTemplateImageryProvider(this.agMetaData),this._imageryLayerProviders.push(e),this.loadDataPromise=Promise.resolve(e),this._isLoadData=!0)}zoomToLayer(){var e;this._imageryLayerProviders?.length&&(e=this._imageryLayerProviders[0]?._rectangle)&&this.viewer.camera.setView({destination:e})}}var yn=mn,_n=__webpack_require__(4420),vn=__webpack_require__(8726);class Cn extends n.Z{static layerType="015100";constructor(e){e=Cesium.defaultValue(e,{}),super(Cesium.defaultValue(e.viewer,CIM.viewer)),this.initialize(e)}initialize(e){if(Object.assign(this.agMetaData,e),this.agMetaData.layerType=Cn.layerType,!this.agMetaData.url)throw new Cesium.DeveloperError("The url of layer is required.");this._isLoadData=!1,this._isAddViewer=!1,this._loadData()}_loadData(){this._isLoadData||(this.setVisible=this.handlePackageLayer,this._isLoadData=!0,this.loadDataPromise=Promise.resolve())}async addTilesFun(e){this.isLayerAdded(e)||(e=await vn.Z.add3DTileset(e))&&this.addPrimitive(e)}isLayerAdded(t){return this._primitives.some(e=>e._url==t||e._id==t)}handleChildLayer(t,e){this._primitives.find(e=>e._id==t||e._url==t).show=e}removeChildLayer(t){var e=this._primitives,i=e.findIndex(e=>e._id==t||e._url==t);this.viewer.scene.primitives.remove(e[i]),e.splice(i,1)}handlePackageLayer(t){for(let e=0;e<this._primitives.length;e++)this._primitives[e].show=t}setStyle(e){for(var t=new Cesium.Cesium3DTileStyle(e),i=0;i<this._primitives.length;i++)this._primitives[i].style=t;this.tilesStyle=e}}var wn=Cn,xn=__webpack_require__(1618),bn=__webpack_require__(7007);var En=new class{async getTerrainHeights(e,t){var i,e=e.terrainProvider;return e._layers&&0<e._layers.length?(i=t.map(e=>Cesium.Cartographic.fromCartesian(e)),(await Cesium.sampleTerrainMostDetailed(e,i)).map(e=>Cesium.Cartographic.toCartesian(e))):t}},Bn=__webpack_require__(8727),Mn=__webpack_require__(922);var In=new class{splitPointsString(e,t){var i=[],r=(r=e).match(/\(([^)]*)\)/)[1],n=(-1!=e.indexOf("MULTIPOLYGON ")&&(r=r.replace("((","")),(r=-1!=e.indexOf("MULTILINESTRING ")?r.replace("(",""):r).split(","));if(t)for(var o=0;o<n.length;o++){var s=n[o].split(" ");i[o]=0==o?agcim.maths.coordinate.getGeographic().toCartesian({lng:parseFloat(s[0]),lat:parseFloat(s[1]),alt:0}):agcim.maths.coordinate.getGeographic().toCartesian({lng:parseFloat(s[1]),lat:parseFloat(s[2]),alt:0})}else for(o=0;o<n.length;o++){s=n[o].split(" ");i[o]=0==o?{x:parseFloat(s[0]),y:parseFloat(s[1]),z:parseFloat(s[2])}:{x:parseFloat(s[1]),y:parseFloat(s[2]),z:parseFloat(s[3])}}return i}encodeFromGeometry(i){let r=i.type+" (";let n="",o="";if("MULTILINESTRING"==i.type)n="(",o=")";else{if("MULTIPOLYGON"!=i.type)return;n="((",o="))"}for(let e=0;e<i.coordinates.length;e++){var s=i.coordinates[e];let t=n;s.forEach(e=>{t+=e.x+" "+e.y+", "}),t=t.substring(0,t.length-2),t+=o,r+=t+", "}return r=r.substring(0,r.length-2),r+=")"}},Sn=__webpack_require__(3006),Pn=__webpack_require__.n(Sn);var Sn=new class{async shapefileToGeoJSON(e){e=await Cesium.Resource.fetchArrayBuffer({url:e}).catch(function(e){console.log(e)});return await Pn()(e).catch(function(e){console.log(e)})}},Tn=__webpack_require__(6344),Ln=__webpack_require__(5255),Dn=__webpack_require__(3924),Fn=__webpack_require__(6559),Nn=__webpack_require__(115),On=__webpack_require__(4508),Rn=__webpack_require__(2398),Un=__webpack_require__(3998),kn=__webpack_require__(8928),Hn=__webpack_require__(5573),Qn=__webpack_require__(844),Vn=__webpack_require__(6642),Gn=__webpack_require__.n(Vn);var Vn=class{constructor(e){this.mapboxRenderer=new MapboxGL.Mapbox.default.BasicRenderer({style:e.style,requestTransformFn:e.requestTransformFn}),this.ready=!1,this.readyPromise=this.mapboxRenderer._style.loadedPromise.then(()=>this.ready=!0),this.tilingScheme=new Cesium.WebMercatorTilingScheme,this.rectangle=this.tilingScheme.rectangle,this.tileSize=this.tileWidth=this.tileHeight=e.tileSize||512,this.maximumLevel=e.maximumLevel||Number.MAX_SAFE_INTEGER,this.minimumLevel=e.minimumLevel||0,this.tileDiscardPolicy=void 0,this.errorEvent=new Cesium.Event,this.credit=new Cesium.Credit(e.credit||"",!1),this.proxy=new Cesium.DefaultProxy(""),this.hasAlphaChannel=void 0===e.hasAlphaChannel||e.hasAlphaChannel,this.sourceFilter=e.sourceFilter,e.mapboxAccessToken&&(Mapbox.accessToken=e.mapboxAccessToken),this.enablePickFeatures=!("enablePickFeatures"in e&&!e.enablePickFeatures),this.rectangleView=agcim.camera.camera.getScreenCornerCoordinates(CIM.viewer),CIM.viewer.camera.moveStart.removeEventListener(this.updateEvent,this),CIM.viewer.camera.moveStart.addEventListener(this.updateEvent,this),this.coordinateArr=[],this.bool=!0,this.labelType=e.labelType||!1}getTileCredits(e,t,i){return[]}createTile(){var e=document.createElement("canvas");return e.width=this.tileSize,e.height=this.tileSize,e.style.imageRendering="pixelated",e.getContext("2d").globalCompositeOperation="copy",e}_getTilesSpec(e,r){var{x:n,y:o,zoom:s}=e,a=this.tileSize,l=[],u=(1<<s)-1;for(let i=-1;i<=1;i++){let t=n+i;(t=t<0?u:t)>u&&(t=0);for(let e=-1;e<=1;e++){var c=o+e;c<0||u<c||l.push({source:r,z:s,x:t,y:c,left:0+i*a,top:0+e*a,size:a})}}return l}requestImage(i,r,n,o=!0){if(window.removeRecent&&(this.bool=!0,this.coordinateArr=[],CIM.viewer.entities.removeAll()),window.removeRecent=!1,n>this.maximumLevel||n<this.minimumLevel)return Promise.reject(void 0);this.mapboxRenderer.filterForZoom(n);const s=this.mapboxRenderer.getVisibleSources().reduce((e,t)=>e.concat(this._getTilesSpec({x:i,y:r,zoom:n},t)),[]);return new Promise((t,i)=>{const r=this.createTile();var e=r.getContext("2d");const n=this.mapboxRenderer.renderTiles(e,{srcLeft:0,srcTop:0,width:this.tileSize,height:this.tileSize,destLeft:0,destTop:0},s,e=>{"string"!=typeof e||e.endsWith("tiles not available")?o?(n.consumer.ctx=void 0,this.labelType&&this._addLabelLayer(n),t(r),this.mapboxRenderer.releaseRender(n)):t(n):i(void 0)})})}_addLabelLayer(e){for(var t of e.tiles)if(t.rawTileData){var i,r=t.tileID.canonical.x,n=t.tileID.canonical.y,o=t.tileID.canonical.z,s=new Qn.VectorTile(new(Gn())(t.rawTileData));for(i of Object.keys(s.layers)){var a=s.layers[i]._features;for(let e=0;e<a.length;e++){var l,u=s.layers[i].feature(e).toGeoJSON(r,n,o),c=u.properties;c.name&&"Point"==u.geometry.type&&(u=u.geometry.coordinates,l=agcim.maths.coordinate.getGeographic().toCartesian({lng:u[0],lat:u[1],alt:0}),Cesium.Rectangle.contains(this.rectangleView,Cesium.Cartographic.fromCartesian(l)))&&(c=c.name,this.coordinateArr.push({coordinate:u,label:c,position:l}))}}}setTimeout(()=>{if(this.bool){let i={};this.bool=!1;var e=this.coordinateArr.reduce((e,t)=>(i[t.label]||(i[t.label]=e.push(t)),e),[]);if(e&&e.length)for(var t of e)CIM.viewer.entities.add({name:t.label,position:Cesium.Cartesian3.fromDegrees(t.coordinate[0],t.coordinate[1]),label:{text:t.label,font:"500 25px Helvetica",scale:.5,style:Cesium.LabelStyle.FILL,fillColor:Cesium.Color.BLACK,pixelOffset:new Cesium.Cartesian2(0,0),showBackground:!1}})}},500)}updateEvent(){this.rectangleView=CIM.viewer.camera.computeViewRectangle()}pickFeatures(e,t,r,n,o){if(this.ready&&this.enablePickFeatures)return this.requestImage(e,t,r,!1).then(e=>{var t=this.mapboxRenderer.getVisibleSources(),t=this.sourceFilter?this.sourceFilter(t):t;const i=[];return n=Cesium.Math.toDegrees(n),o=Cesium.Math.toDegrees(o),t.forEach(e=>{i.push({data:this.mapboxRenderer.queryRenderedFeatures({source:e,renderedZoom:r,lng:n,lat:o,tileZ:r})})}),e.consumer.ctx=void 0,this.mapboxRenderer.releaseRender(e),i})}destroy(){this.mapboxRenderer._cancelAllPendingRenders(),Object.values(this.mapboxRenderer._style.sourceCaches).forEach(e=>e._tileCache.reset()),this.mapboxRenderer._gl.getExtension("WEBGL_lose_context").loseContext()}},zn=__webpack_require__(7201),Wn=__webpack_require__(7665);function qn(e,t){this._visibleColor=Cesium.defaultValue(t.visibleColor,new Cesium.Color(1,1,1,1)),this._disVisibleColor=Cesium.defaultValue(t.disVisibleColor,new Cesium.Color(1,1,1,1)),this._limitHeight=Cesium.defaultValue(t.limitHeight,0),this._positions=Cesium.defaultValue(t.positions,[]),this._viewer=e}function Kn(e){var t=function(e){(e=e.map(e=>{var e=Cesium.Cartographic.fromCartesian(e),t=Cesium.Math.toDegrees(e.latitude);return[Cesium.Math.toDegrees(e.longitude),t]})).push(e[0]),e=Qi.polygon([e]),e=Qi.tesselate(e);const t=[];return e.features.forEach(e=>{e=Qi.getCoords(e);t.push(e[0][0]),t.push(e[0][1]),t.push(e[0][2])}),t.map(e=>Cesium.Cartesian3.fromDegrees(e[0],e[1]))}(e.positions),i=Math.floor(Cesium.ContextLimits.maximumTextureSize/3),r=t.length,i=Math.min(r,i),n=3*i,r=Math.ceil(r/i),i=1/n,o=1/r,i=new Cesium.Cartesian4(i,.5*i,o,.5*o),s=new Float32Array(4*n*r);for(let e=0;e<t.length;e++){var a=Cesium.EncodedCartesian3.fromCartesian(t[e]),l=a.high,u=new Cesium.Cartesian4,l=(u.x=Cesium.defined(l.x)?l.x:l,u.y=Cesium.defined(l.y)?l.y:0,u.z=Cesium.defined(l.z)?l.z:0,u.w=Cesium.defined(l.w)?l.w:0,12*e+0),u=(new Cesium.Cartesian4.pack(u,s,l),a.low),l=new Cesium.Cartesian4,a=(l.x=Cesium.defined(u.x)?u.x:u,l.y=Cesium.defined(u.y)?u.y:0,l.z=Cesium.defined(u.z)?u.z:0,l.w=Cesium.defined(u.w)?u.w:0,12*e+4);new Cesium.Cartesian4.pack(l,s,a)}return{batchTexture:new Cesium.Texture({context:e._viewer.scene.context,width:n,height:r,pixelFormat:Cesium.PixelFormat.RGBA,pixelDatatype:Cesium.PixelDatatype.FLOAT,flipY:!1,source:{arrayBufferView:s,width:n,height:r}}),instanceLength:t.length,batchTextureFlattenStep:i}}Object.defineProperties(qn.prototype,{visibleColor:{get:function(){return this._visibleColor},set:function(e){Cesium.Check.typeOf.object("visible color",e),Cesium.Color.clone(e,this._visibleColor)}},disVisibleColor:{get:function(){return this._disVisibleColor},set:function(e){Cesium.Check.typeOf.object("disVisible color",e),Cesium.Color.clone(e,this._disVisibleColor)}},limitHeight:{get:function(){return this._limitHeight},set:function(e){Cesium.Check.typeOf.object("limit height",e),this._limitHeight=e}},positions:{get:function(){return this._positions},set:function(e){this._positions=e}}}),qn.prototype.getPostProcess=function(){const i=this,e=Kn(i);return new Cesium.PostProcessStage({fragmentShader:`
uniform highp sampler2D positionsTexture;
uniform sampler2D depthTexture;
uniform sampler2D colorTexture;
uniform vec3 standardPointWC;
uniform vec4 visibleColor;
uniform vec4 disVisibleColor;
uniform vec4 batchTextureFlattenStep;
uniform int instanceLength;
uniform bool showLimitHeight;
in vec2 v_textureCoordinates;
vec4 toEye(in vec2 uv, in float depth) {
    vec2 xy = vec2((uv.x * 2.0 - 1.0), (uv.y * 2.0 - 1.0));
    vec4 posInCamera = czm_inverseProjection * vec4(xy, depth, 1.0);
    posInCamera = posInCamera / posInCamera.w;
    return posInCamera;
}
float getDepth(in vec4 depth) {
    float z_window = czm_unpackDepth(depth);
    z_window = czm_reverseLogDepth(z_window);
    float n_range = czm_depthRange.near;
    float f_range = czm_depthRange.far;
    return (2.0 * z_window - n_range - f_range) / (f_range - n_range);
}
vec2 computeSt1(float batchId) {
    float stepX = batchTextureFlattenStep.x;
    float centerX = batchTextureFlattenStep.y;
    float numberOfAttributes = float(3);
    return vec2(centerX + (batchId * numberOfAttributes * stepX), 0.5);
}
vec3 getHightCoors(float batchId, highp sampler2D positionsTexture) {
    vec2 st = computeSt1(batchId);
    st.x += batchTextureFlattenStep.x * float(0);
    vec4 textureValue = texture(positionsTexture, st);
    vec3 value = textureValue.xyz;
    return value;
}
vec3 getLowCoors(float batchId, highp sampler2D positionsTexture) {
    vec2 st = computeSt1(batchId);
    st.x += batchTextureFlattenStep.x * float(1);
    vec4 textureValue = texture(positionsTexture, st);
    vec3 value = textureValue.xyz;
    return value;
}
bool cross2(vec3 point1, vec3 point2, vec3 point3, vec3 point) {
    vec3 ab = point2 - point1;
    vec3 ac = point3 - point1;
    vec3 ap = point - point1;
    vec3 v1 = cross(ab, ac);
    vec3 v2 = cross(ab, ap);
    return dot(v1, v2) >= 0.0;
}
bool isInTriangle(vec3 point1, vec3 point2, vec3 point3, vec3 point) {
    bool scale1 = cross2(point1, point2, point3, point);
    bool scale2 = cross2(point2, point3, point1, point);
    bool scale3 = cross2(point3, point1, point2, point);
    return scale1 && scale2 && scale3;
}
bool isInExtent(vec3 coors[64], vec3 point) {
    bool isIn = false;
    for(int i = 0; i < instanceLength / 3; i++) {
        if(coors[i * 3].x == coors[i * 3].y) {
            continue;
        }
        if(isInTriangle(coors[i * 3], coors[i * 3 + 1], coors[i * 3 + 2], point)) {
            return true;
        }
    }
    return isIn;
}
bool isInCoveragePolygon(vec3 positionWC, highp sampler2D positionsTexture) {
    bool isIn = false;
    vec3 coors[64];
    vec3 positionOnPlane;
    for(int i = 0; i < instanceLength; i++) {
        float index = float(i);
        vec3 coor = getHightCoors(index, positionsTexture) + getLowCoors(index, positionsTexture);
        coors[i] = coor;
    }
    isIn = isInExtent(coors, positionWC);
    return isIn;
}

void main() {
    vec4 color = texture(colorTexture, v_textureCoordinates);
    vec4 currD = texture(depthTexture, v_textureCoordinates);
    if(currD.r >= 1.0) {
        out_FragColor = color;
        return;
    }
    float depth = getDepth(currD);
    vec4 positionEC = toEye(v_textureCoordinates, depth);
    vec4 positionWC = czm_inverseView * vec4(positionEC.xyz, 1.0);
    bool isIn = false;
    isIn = isInCoveragePolygon(positionWC.xyz, positionsTexture);
    if(!isIn) {
        out_FragColor = color;
        return;
    } 
    if(!showLimitHeight) {
        out_FragColor = color * visibleColor;
        return;
    }
    if(isIn && showLimitHeight) {
        float height = length(positionWC) - length(standardPointWC);
        if(height > 0.0) {
            out_FragColor = color * disVisibleColor;
        } else {
            out_FragColor = color * visibleColor;
        }
    }
}

`,uniforms:{visibleColor:function(){return i.visibleColor},disVisibleColor:function(){return i.disVisibleColor},positionsTexture:function(){return e.batchTexture},standardPointWC:function(){return e=i,t=e.positions[0],t=e._viewer.scene.globe.ellipsoid.cartesianToCartographic(t),new Cesium.Cartesian3.fromRadians(t.longitude,t.latitude,e.limitHeight);var e,t},instanceLength:function(){return e.instanceLength},batchTextureFlattenStep:function(){return e.batchTextureFlattenStep},showLimitHeight:function(){return 0<i.limitHeight}}})};var jn=qn;var r={FeatureLayer:n.Z,AgBaiduLayer:r.Z,AgDynamicWFSLayer:i.Z,AgDynamicWMSLayer:t.Z,AgGeoSceneFeatureLayer:Mr.Z,AgGeoSceneTileLayer:e.Z,AgGeoSceneI3SLayer:o.Z,AgGeosceneMapImageLayer:tn.Z,Ag3DTilesLayer:rn.Z,AgS3MLayer:nn.Z,AgWMTSLayer:on.Z,AgWFSLayer:sn.Z,AgSuperMapWFSLayer:an.Z,AgSuperMapWMSLayer:ln.Z,AgSuperMapWMTSLayer:un.Z,AgTerrainLayer:cn.Z,AgGeoSceneElevationLayer:hn.Z,AgBingMapsWMTSLayer:An.Z,AgMapboxWMTSLayer:pn.Z,AgTDTWMTSLayer:fn.Z,AgTencentWMTSLayer:gn,AgGaoDeWMTSLayer:yn,AgPackageLayer:_n.Z,AgDynamicPackageLayer:wn,AgS3MTilesLayer:Dn.Z,AgSuperMapImageryLayer:Fn.Z,AgSuperMapTerrainLayer:Nn.Z,AgSuperMapS3MTilesLayer:On.Z,AgUnifiedPOILayer:Rn.Z,AgUnified3DTiles:Un.Z,AgUnifiedIntegratedMeshLayer:kn.Z,AgUnifiedBIM:Hn.Z,AgMVTImageryProvider:Vn,AgTileWMSLayer:zn.Z,AgRoadAnnotationLayer:Wn.Z,utils:{entityHelper:xn.Z,primitiveHelper:jt.Z,terrainHelper:En,rfsHelper:bn.Z,GeoJSONHelper:Bn.Z,WMTSHelper:Mn.Z,Ag3DTilesUtils:vn.Z,wktStringUtils:In,wfsLayerStyleUtils:Ln.Z,vector:Sn,layerStyleUtils:Tn.Z,S3MHelper:class{constructor(e){this._viewer=Cesium.defaultValue(e,null),this._postProcess=null}addS3MCoverageShader(e){e=new jn(this._viewer,e);this._postProcess=e.getPostProcess(),this._viewer.scene.postProcessStages.add(this._postProcess)}isPoinsInS3MLayer(t){let i=!1;var r=this._viewer.scene._primitives._primitives;for(let e=0;e<r.length;e++){var n=r[e];if(n instanceof Dn.Z&&(i=this.isInS3MLayer(n,t)))break}return i}isInS3MLayer(e,t){let i=!1;var r=e.rectangle;for(let e=0;e<t.length;e++){var n=t[e],n=Cesium.Cartographic.fromCartesian(n);if(i=n.longitude>=r.west&&n.longitude<=r.east&&n.latitude>=r.south&&n.latitude<=r.north)break}return i}removeS3MCoverageShader(){this._postProcess&&(this._viewer.scene.postProcessStages.remove(this._postProcess),this._postProcess=null)}destroyed(){this.removeS3MCoverageShader(),this._viewer=null}}}},Zn=__webpack_require__(2111);const Yn={lods:[{level:0,resolution:78237.03327406655,scale:295698432},{level:1,resolution:39118.51663703327,scale:147849216},{level:2,resolution:19559.258318516637,scale:73924608},{level:3,resolution:9779.629159258318,scale:36962304},{level:4,resolution:4889.814579629159,scale:18481152},{level:5,resolution:2444.9072898145796,scale:9240576},{level:6,resolution:1222.4536449072898,scale:4620288},{level:7,resolution:611.2268224536449,scale:2310144},{level:8,resolution:305.61341122682245,scale:1155072},{level:9,resolution:152.80670561341122,scale:577536},{level:10,resolution:76.40335280670561,scale:288768},{level:11,resolution:38.201676403352806,scale:144384},{level:12,resolution:19.100838201676403,scale:72192},{level:13,resolution:9.550419100838202,scale:36096},{level:14,resolution:4.775209550419101,scale:18048},{level:15,resolution:2.3876047752095504,scale:9024},{level:16,resolution:1.1938023876047752,scale:4512},{level:17,resolution:.5969011938023876,scale:2256},{level:18,resolution:.2984505969011938,scale:1128},{level:19,resolution:.1492252984505969,scale:564}]};var Xn=class{constructor(e,t){this.viewer=e,this.layerTree=t,this.updateEvent=null}getSceneScale(e){var t=new Cesium.EllipsoidGeodesic,i=e.canvas.clientWidth,r=e.canvas.clientHeight,n=e.camera.getPickRay(new Cesium.Cartesian2(i/2|0,r-1)),i=e.camera.getPickRay(new Cesium.Cartesian2(1+i/2|0,r-1));if(n&&i){var r=e.globe,n=r.pick(n,e),i=r.pick(i,e);if(Cesium.defined(n)&&Cesium.defined(i))return e=r.ellipsoid.cartesianToCartographic(n),n=r.ellipsoid.cartesianToCartographic(i),t.setEndPoints(e,n),r=t.surfaceDistance,Math.ceil(37.795275590551*r*100)}}getlayerLevelFromScale(t){if(!t)return 0;var i=Yn.lods.length;for(let e=0;e<i;e++)if(Yn.lods[e].scale<=t)return Yn.lods[e].level;return Yn.lods[i-1].level}layerLevelHandle(){var i=this;i.layerTree.addLayerShowHandler(function(t,e){if(e){let e=i.checkLayerVisible(t.id);e||t.addViewerPromise.then(()=>{t.setVisible(e)})}}),i.updateEvent=function(){i.update()},i.viewer.camera.moveEnd.addEventListener(i.updateEvent)}update(){var t=this.getSceneScale(this.viewer.scene),i=this.layerTree._aglayerIds,r=i.length;for(let e=0;e<r;e++){var n,o=this.layerTree._layerTreeData[i[e]];o&&(o.visibleMinZoom||o.visibleMaxZoom)&&(n=this.layerTree.getLayerById(i[e]))&&n.setVisible&&((!o.visibleMaxZoom||0!==parseFloat(o.visibleMaxZoom)||!o.visibleMinZoom||0!==parseFloat(o.visibleMinZoom))&&!(o.visibleMinZoom&&0===parseFloat(o.visibleMinZoom)&&o.visibleMaxZoom&&o.visibleMaxZoom&&t>parseFloat(o.visibleMaxZoom))&&!(0===parseFloat(o.visibleMaxZoom)&&o.visibleMinZoom&&t<parseFloat(o.visibleMinZoom))&&(o.visibleMinZoom&&t>parseFloat(o.visibleMinZoom)||o.visibleMaxZoom&&t<parseFloat(o.visibleMaxZoom))?n.setVisible(!1):n.setVisible(!0))}}checkLayerVisible(e){var t=this.getSceneScale(this.viewer.scene),i=this.layerTree._layerTreeData[e],e=this.layerTree.getLayerById(e);return!(e&&e.setVisible&&i&&i.visibleMinZoom&&(t>parseFloat(i.visibleMinZoom)||t<parseFloat(i.visibleMaxZoom)||(0===parseFloat(i.visibleMinZoom)&&t>parseFloat(i.visibleMaxZoom)||0===parseFloat(i.visibleMaxZoom)&&t<parseFloat(i.visibleMinZoom)||0===parseFloat(i.visibleMinZoom)&&parseFloat(i.visibleMaxZoom),0)))}dispose(){this.updateEvent&&this.viewer.camera.moveEnd.removeEventListener(this.updateEvent)}};i=class{constructor(e){this._viewer=e,this._layerTree=null}initialize(e,t,i){i=i||window.CIM,this._viewer=e,this._layerTree=new Zn.Z(e),i.layerTree&&(i.layerTree=null),i.layerTree=this._layerTree,this._layerTree.loadInitializeLayers(t),this.initializeOperationHabit()}initializeOperationHabit(){this._modifyMouseAction(this._viewer)}bindLayerVisibleLevel(){this._layerVisibleLevelControl=new Xn(this._viewer,this._layerTree),this._layerVisibleLevelControl.layerLevelHandle()}_modifyMouseAction(e){e.scene.screenSpaceCameraController.tiltEventTypes=[Cesium.CameraEventType.RIGHT_DRAG,Cesium.CameraEventType.PINCH,{eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.CTRL},{eventType:Cesium.CameraEventType.RIGHT_DRAG,modifier:Cesium.KeyboardEventModifier.CTRL}],e.scene.screenSpaceCameraController.zoomEventTypes=[Cesium.CameraEventType.MIDDLE_DRAG,Cesium.CameraEventType.WHEEL,Cesium.CameraEventType.PINCH],e.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)}setSceneConfig(e){var t,i=this._viewer.scene;for(t in e)switch(t){case"enableLighting":case"depthTestAgainstTerrain":case"preloadAncestors":case"preloadSiblings":case"show":case"showGroundAtmosphere":case"showWaterEffect":case"undergroundColor":i.globe[t]=e[t];break;case"skyBox":i[t]=e[t];break;case"fog":i[t].enabled=e[t];break;case"sun":case"moon":case"skyAtmosphere":i[t].show=e[t];break;case"enableCollisionDetection":i.screenSpaceCameraController[t]=e[t];break;case"baseColor":i.globe[t]=(new X.Z).getColor(e[t])}}addImageryLayerEvent(e,t){null!=this._viewer.imageryLayers[e]&&null!=this._viewer.imageryLayers[e]&&this._viewer.imageryLayers[e].addEventListener(function(e){t&&t(e)})}removeImageryLayerEvent(e,t){null!=this._viewer.imageryLayers[e]&&null!=this._viewer.imageryLayers[e]&&this._viewer.imageryLayers[e].removeEventListener(function(e){t&&t(e)})}setBaseMap(e){var t=this._viewer,i=t.imageryLayers._layers;0<i.length&&(i=i[0],t.imageryLayers.remove(i),t.imageryLayers.addImageryProvider(e,0),t.scene.globe._imageryLayerCollectionExcavation.addImageryProvider(e,0))}},t=window.Cesium;const Jn=t.BoxGeometry,$n=t.Cartesian3,eo=t.defaultValue,to=t.defined,io=t.destroyObject,ro=t.DeveloperError,no=t.GeometryPipeline;Mr=t.Matrix3;const oo=t.Matrix4,so=t.Transforms,ao=t.VertexFormat,lo=t.BufferUsage,uo=t.CubeMap,co=t.DrawCommand,ho=t.loadCubeMap,Ao=t.RenderState,po=t.VertexArray,fo=t.BlendingState,go=t.SceneMode,mo=t.ShaderProgram,yo=t.ShaderSource;function _o(e){this.sources=e.sources,this._sources=void 0,this.show=eo(e.show,!0),this._command=new co({modelMatrix:oo.clone(oo.IDENTITY),owner:this}),this._cubeMap=void 0,this._attributeLocations=void 0,this._useHdr=void 0}t.defined(t.Matrix4.getRotation)||(t.Matrix4.getRotation=t.Matrix4.getMatrix3);const vo=new Mr;_o.prototype.update=function(e,t){const i=this;if(this.show&&(e.mode===go.SCENE3D||e.mode===go.MORPHING)&&e.passes.render){var r=e.context;if(this._sources!==this.sources){this._sources=this.sources;var n=this.sources;if(!(to(n.positiveX)&&to(n.negativeX)&&to(n.positiveY)&&to(n.negativeY)&&to(n.positiveZ)&&to(n.negativeZ)))throw new ro("this.sources is required and must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.");if(typeof n.positiveX!=typeof n.negativeX||typeof n.positiveX!=typeof n.positiveY||typeof n.positiveX!=typeof n.negativeY||typeof n.positiveX!=typeof n.positiveZ||typeof n.positiveX!=typeof n.negativeZ)throw new ro("this.sources properties must all be the same type.");"string"==typeof n.positiveX?ho(r,this._sources).then(function(e){i._cubeMap=i._cubeMap&&i._cubeMap.destroy(),i._cubeMap=e}):(this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),this._cubeMap=new uo({context:r,source:n}))}const o=this._command;if(o.modelMatrix=so.eastNorthUpToFixedFrame(e.camera._positionWC),to(o.vertexArray)||(o.uniformMap={u_cubeMap:function(){return i._cubeMap},u_rotateMatrix:function(){return oo.getRotation(o.modelMatrix,vo)}},n=Jn.createGeometry(Jn.fromDimensions({dimensions:new $n(2,2,2),vertexFormat:ao.POSITION_ONLY})),e=this._attributeLocations=no.createAttributeLocations(n),o.vertexArray=po.fromGeometry({context:r,geometry:n,attributeLocations:e,bufferUsage:lo._DRAW}),o.renderState=Ao.fromCache({blending:fo.ALPHA_BLEND})),to(o.shaderProgram)&&this._useHdr===t||(n=new yo({defines:[t?"HDR":""],sources:["uniform samplerCube u_cubeMap;\n    in vec3 v_texCoord;\n    void main()\n    {\n    vec4 color = textureCube(u_cubeMap, normalize(v_texCoord));\n    out_FragColor = vec4(czm_gammaCorrect(color).rgb, czm_morphTime);\n    }\n    "]}),o.shaderProgram=mo.fromCache({context:r,vertexShaderSource:"in vec3 position;\n    out vec3 v_texCoord;\n    uniform mat3 u_rotateMatrix;\n    void main()\n    {\n    vec3 p = czm_viewRotation * u_rotateMatrix * (czm_temeToPseudoFixed * (czm_entireFrustum.y * position));\n    gl_Position = czm_projection * vec4(p, 1.0);\n    v_texCoord = position.xyz;\n    }\n    ",fragmentShaderSource:n,attributeLocations:this._attributeLocations}),this._useHdr=t),to(this._cubeMap))return o}},_o.prototype.isDestroyed=function(){return!1},_o.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy(),this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),io(this)};var Co=_o;new class{constructor(){let r=this;this._lastKeyDownTime=0,document.onkeydown=e=>{var t,i;"KeyC"==e.code&&e.ctrlKey?1e3<(t=Date.now())-r._lastKeyDownTime?r._lastKeyDownTime=t:(t=JSON.stringify(V.Z.getCameraAsJSON(CIM.viewer)),(i=document.createElement("input")).value=t,document.body.appendChild(i),i.select(),document.execCommand("Copy"),i.style.display="none"):"KeyV"==e.code&&e.ctrlKey&&document.addEventListener("paste",e=>{e=(e.clipboardData||window.clipboardData).getData("text");r.isJson(e)&&((e=JSON.parse(e)).position=new Cesium.Cartesian3(e.position.x,e.position.y,e.position.z),V.Z.setCamera(CIM.viewer,e))})}}isJson(t){if("string"==typeof t)try{var e=JSON.parse(t);return!("object"!=typeof e||!e)}catch(e){return console.log("error："+t+"!!!"+e),!1}}};var e=new class{constructor(){this.defaultConfig={contextOptions:{webgl:{alpha:!1,depth:!1,stencil:!0,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!0,powerPreference:"high-performance"},allowTextureFilterAnisotropic:!0,getWebGLStub:function(e,t,i=!1){if("undefined"==typeof WebGLRenderingContext)throw new RuntimeError("The browser does not support WebGL.  Visit http://get.webgl.org.");var r="undefined"!=typeof WebGL2RenderingContext,r=(i=i||r?i:!0)?"webgl":"webgl2",i=e.getContext(r,t);if(Cesium.defined(i))return i;throw new RuntimeError("The browser supports WebGL, but initialization failed.")}},infoBox:!0,fullscreenButton:!1,selectionIndicator:!1,animation:!1,homeButton:!1,geocoder:!1,timeline:!1,navigationHelpButton:!1,sceneModePicker:!1,requestRenderMode:!1,maximumRenderTimeChange:1/0,baseLayerPicker:!1,orderIndependentTranslucency:!0,baseLayer:Cesium.ImageryLayer.fromProviderAsync(Cesium.TileMapServiceImageryProvider.fromUrl(Cesium.buildModuleUrl("Assets/Textures/NaturalEarthII"),{fileExtension:"jpg",maximumLevel:2}))},this.prePrimitiveLength,this.preTilesetIds,this.scenePreUpdateMove}getViewerParam(){return this.defaultConfig}getIonToken(){return"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJlMmQ5OWE1ZS04ODMwLTQ5NmUtODk1Zi05OWVlOWM2NGQ2ZDYiLCJpZCI6MTY0NTgsInNjb3BlcyI6WyJhc3IiLCJnYyJdLCJpYXQiOjE1NzA1ODUxNTJ9.FUzgQG6PqlpXsLAu2-zlAxK8Z3g1aZTC8Hwr7i9cBFc"}initStyle(e){e._cesiumWidget._creditContainer.style.display="none",e.infoBox&&(e.infoBox._element.hidden=!0),e.clock.currentTime.secondsOfDay=50400}setSkyBox(t,i){var r=t.scene.skyBox,n=new Co({sources:{positiveX:"static/scene/SkyBoxOnGround/rightav9.jpg",negativeX:"static/scene/SkyBoxOnGround/leftav9.jpg",positiveY:"static/scene/SkyBoxOnGround/frontav9.jpg",negativeY:"static/scene/SkyBoxOnGround/backav9.jpg",positiveZ:"static/scene/SkyBoxOnGround/topav9.jpg",negativeZ:"static/scene/SkyBoxOnGround/bottomav9.jpg"}});t.scene.postRender.addEventListener(function(){var e=t.camera.position;Cesium.Cartographic.fromCartesian(e).height<1e4?i.setSceneConfig({skyAtmosphere:!1,skyBox:n}):i.setSceneConfig({skyAtmosphere:!0,skyBox:r})})}optimize(){Cesium.RequestScheduler.maximumRequestsPerServer=6,Cesium.RequestScheduler.maximumRequests=50}optimizeModel(e){Cesium.FeatureDetection.supportsImageRenderingPixelated()&&(e.resolutionScale=window.devicePixelRatio),Vr.getCookie("resolutionScale")&&(e.resolutionScale=2)}createViewer(e,t={}){this.optimize(),Cesium.Ion.defaultAccessToken=this.getIonToken();e=new Cesium.Viewer(e,Object.assign(this.defaultConfig,t));return this.initStyle(e),this.optimizeModel(e),t?.totalMemory&&this._distribute3DTilesetMemory(e,t?.totalMemory),e}_distribute3DTilesetMemory(e,u){e.scene.requestRenderMode=!0;const c=this;this.scenePreUpdateMove&&(this.scenePreUpdateMove(),this.prePrimitiveLength=void 0,this.preTilesetIds=void 0),this.scenePreUpdateMove=e.scene.preUpdate.addEventListener(()=>{var i=e.scene.primitives._primitives,r=i.length;if(r!==c.prePrimitiveLength){var n=[],o=[];let t=1;for(let e=r-1;-1<e;e--){var s,a=i[e];a instanceof Cesium.Cesium3DTileset&&(a._memoryWeight=0===n.length?5:n.length<5?3:1,s=i[e]._id,o.push(s),c.preTilesetIds&&!c.preTilesetIds.includes(s)&&(a._memoryWeight=5,0<n.length)&&(n[0]._memoryWeight=3),t+=a._memoryWeight,n.push(a))}var l=u/t;for(let e=0;e<n.length;e++)n[e].cacheBytes=n[e]._memoryWeight*l*1024*1024,n[e].maximumMemoryUsage=n[e]._memoryWeight*l;c.preTilesetIds=o,c.prePrimitiveLength=r}})}flyTo(e,t,i,r){setTimeout(()=>{V.Z.cameraFlyTo(e,{destination:t,duration:2})},0);setTimeout(()=>{V.Z.cameraFlyTo(e,{destination:i,duration:4,complete:function(){setTimeout(()=>{V.Z.cameraFlyTo(e,{destination:i,orientation:r,duration:4,easingFunction:Cesium.EasingFunction.LINEAR_NONE})},0)}})},2e3)}},wo=`
#extension GL_OES_standard_derivatives : enable
uniform sampler2D colorTexture;
uniform sampler2D depthTexture;
in vec2 v_textureCoordinates;

#define MAX_RADIUS 2
#define DOUBLE_HASH 0
#define HASHSCALE1 .1031
#define HASHSCALE3 vec3(.1031, .1030, .0973)

//Field of view
#define FOV (3.14159/1.)


vec4 toEye(in vec2 uv, in float depth){
    vec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0));
    vec4 posInCamera =czm_inverseProjection * vec4(xy, depth, 1.0);
    posInCamera =posInCamera / posInCamera.w;
    return posInCamera;
}
float getDepth(in vec4 depth){
    float z_window = czm_unpackDepth(depth);
    z_window = czm_reverseLogDepth(z_window);
    float n_range = czm_depthRange.near;
    float f_range = czm_depthRange.far;
    return (2.0 * z_window - n_range - f_range) / (f_range - n_range);
}

float hash12(vec2 p)
{
	vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
    p3 += dot(p3, p3.yzx + 19.19);
    return fract((p3.x + p3.y) * p3.z);
}

vec2 hash22(vec2 p)
{
	vec3 p3 = fract(vec3(p.xyx) * HASHSCALE3);
    p3 += dot(p3, p3.yzx+19.19);
    return fract((p3.xx+p3.yz)*p3.zy);

}

void mainImage( out vec4 fragColor, in vec2 fragCoord,float distance )
{   
    vec2 iResolution = czm_viewport.zw;
    float iTime = (czm_frameNumber / 50.0);
     float resolution = 200. * exp2(-3./iResolution.x) * distance;
     resolution = max(resolution,140.0);
	 vec2 uv = (fragCoord.xy / iResolution.y * resolution);
     vec2 p0 = floor(uv);
    vec2 circles = vec2(0.);
    for (int j = -MAX_RADIUS; j <= MAX_RADIUS; ++j)
    {
        for (int i = -MAX_RADIUS; i <= MAX_RADIUS; ++i)
        {
			vec2 pi = p0 + vec2(i, j);
            #if DOUBLE_HASH
            vec2 hsh = hash22(pi);
            #else
            vec2 hsh = pi;
            #endif
            vec2 p = pi + hash22(hsh);

            float t = fract(0.3*iTime + hash12(hsh));
            vec2 v = p - uv;
            float d = length(v) - (float(MAX_RADIUS) + 1.)*t;

            float h = 1e-3;
            float d1 = d - h;
            float d2 = d + h;
            float p1 = sin(31.*d1) * smoothstep(-0.6, -0.3, d1) * smoothstep(0., -0.3, d1);
            float p2 = sin(31.*d2) * smoothstep(-0.6, -0.3, d2) * smoothstep(0., -0.3, d2);
            circles += 0.5 * normalize(v) * ((p2 - p1) / (2. * h) * (1. - t) * (1. - t));
        }
    }
    circles /= float((MAX_RADIUS*2+1)*(MAX_RADIUS*2+1));
 

    float intensity = mix(0.01, 0.15, smoothstep(0.1, 0.6, abs(fract(0.05*iTime + 0.5)*2.-1.)));
    vec3 n = vec3(circles, sqrt(1. - dot(circles, circles)));
    vec3 color = fragColor.xyz + 5.*pow(clamp(dot(n, normalize(vec3(1., 0.7, 0.5))), 0., 1.), 6.);
	fragColor.xyz = color;
}
void main(void) {
    vec4 fragColor = texture(colorTexture, v_textureCoordinates);
    vec4 currD = texture(depthTexture, v_textureCoordinates);//计算深度
    if(currD.r>=1.0){//深度大于1的不处理
        out_FragColor = fragColor;
        return;
    }
    float depth = getDepth(currD);
    vec4 positionEC = toEye(v_textureCoordinates, depth);
    vec3 dx = dFdx(positionEC.xyz);
    vec3 dy = dFdy(positionEC.xyz);
    vec3 nor = normalize(cross(dx,dy));
    vec4 positionWC = normalize(czm_inverseView * positionEC);
    vec3 normalWC = normalize(czm_inverseViewRotation * nor);
    float dotNumWC = dot(positionWC.xyz,normalWC);
    float distance = length(positionEC);
    if(dotNumWC < 0.3 || distance >10000.0){
        out_FragColor = fragColor;
        return;
    }
    distance = distance/300.0;
    mainImage(fragColor,gl_FragCoord.xy,distance);
    out_FragColor = fragColor;
}

`;const E={snow:"snow",rain:"rain",fog:"fog",sunny:"sunny"};class xo{constructor(e,t={}){this.viewer=e,this.addWeathers(),t.type||(t.type=E.sunny),this.weather=t}addWeathers(){var e=Object.values(E);try{e.forEach(e=>{var t;this.viewer.postProcessStages[e]||e!=E.sunny&&((t=this.viewer.scene.postProcessStages.add(this["create_"+e]())).enabled=!1,this.viewer.postProcessStages[e]=t)})}catch(e){throw console.warn(e),new Error(e)}}create_snow(){let t=new Cesium.PostProcessStage({fragmentShader:`
uniform sampler2D colorTexture;
uniform float size;
uniform float speed;
in vec2 v_textureCoordinates;
float snow(vec2 uv, float scale) {
    float time = czm_frameNumber / speed;
    float w = smoothstep(1., 0., -uv.y * (scale / 10.));
    if(w < .1)
        return 0.;
    uv += time / scale;
    uv.y += time * 2. / scale;
    uv.x += sin(uv.y + time * .5) / scale;
    uv *= scale;
    vec2 s = floor(uv), f = fract(uv), p;
    float k = 3., d;
    p = .5 + .35 * sin(11. * fract(sin((s + p + scale) * mat2(7, 3, 6, 5)) * 5.)) - f;
    d = length(p);
    k = min(d, k);
    k = smoothstep(0., k, sin(f.x + f.y) * 0.01);
    return k * w;
}
void main(void) {
    vec2 resolution = czm_viewport.zw;
    vec2 uv = (gl_FragCoord.xy * 2. - resolution.xy) / min(resolution.x, resolution.y);
    vec3 finalColor = vec3(0);
    float c = 0.0;
    c += snow(uv, 300.) * .0;
    c += snow(uv, 200.) * .0;
    c += snow(uv, 150.) * .0;
    c += snow(uv, 10.);
    c += snow(uv, 8.);
    c += snow(uv, 6.);
    c += snow(uv, 5.);
    finalColor = (vec3(c))*size;
    out_FragColor = mix(texture(colorTexture, v_textureCoordinates), vec4(finalColor, 1), 0.5);
}
`,uniforms:{size:.5,speed:60}}),i=new Cesium.PostProcessStage({fragmentShader:`#extension GL_OES_standard_derivatives : enable
uniform sampler2D colorTexture;
uniform sampler2D depthTexture;
uniform float alpha;
in vec2 v_textureCoordinates;
void main(){
    vec4 color = texture(colorTexture, v_textureCoordinates);
    vec4 currD = texture(depthTexture, v_textureCoordinates);
    
    if(currD.r>=1.0){
        out_FragColor = color;
        return;
    }

    // 获取屏幕坐标
    vec2 texCoord = gl_FragCoord.xy / czm_viewport.zw;
    
    // 从深度纹理中获取深度值
    float depth = czm_unpackDepth(texture(depthTexture, texCoord));
    
    // 计算世界坐标系下的坐标
    vec4 positionEC = czm_inverseProjection * vec4(texCoord * 2.0 - 1.0, depth, 1.0);
    positionEC /= positionEC.w;
    
    // 将世界坐标系下的坐标转换为世界坐标系下的法线
    vec4 positionWC = czm_inverseView * positionEC;
    vec3 normalWC = normalize(positionWC.xyz);

    float dotNumWC = dot(positionWC.xyz,normalWC);
    dotNumWC = max(0.3,dotNumWC);
    dotNumWC = min(1.0,dotNumWC);
    out_FragColor = mix(color,vec4(1.0),dotNumWC*alpha);
}`,uniforms:{alpha:.5}});var e={},e=(Object.defineProperties(e,{size:{get(){return t.uniforms.size},set(e){t.uniforms.size=e}},speed:{get(){return t.uniforms.speed},set(e){t.uniforms.speed=e}},alpha:{get(){return i.uniforms.alpha},set(e){i.uniforms.alpha=e}}}),new Cesium.PostProcessStageComposite({name:E.snow,stages:[t,i],inputPreviousStageTexture:!0,uniforms:e}));return e}create_rain(){let t=new Cesium.PostProcessStage({name:"rain01",fragmentShader:`
uniform sampler2D colorTexture;
in vec2 v_textureCoordinates;
uniform float speed;
uniform float size;
float hash(float x) {
    return fract(sin(x * 133.3) * 13.13);
}
void main(void) {
    float time = (czm_frameNumber / speed);
    vec2 resolution = czm_viewport.zw;
    vec2 uv = (gl_FragCoord.xy * 2. - resolution.xy) / min(resolution.x, resolution.y);
    vec3 c = vec3(.6, .7, .8);
    float a = -.4;
    float si = sin(a), co = cos(a);
    uv *= mat2(co, -si, si, co);
    uv *= length(uv + vec2(0, 4.9)) * .3 + 1.;
    float v = 1. - sin(hash(floor(uv.x * 100.)) * 2.);
    float b = clamp(abs(sin(20. * time * v + uv.y * (5. / (2. + v)))) - .95, 0., 1.) * size;
    c *= v * b;
    out_FragColor = mix(texture(colorTexture, v_textureCoordinates), vec4(c, 1), 0.5);
}
`,uniforms:{speed:60,size:5}});var e=new Cesium.PostProcessStage({name:"rainRipple",fragmentShader:wo,uniforms:{}}),i={},e=(Object.defineProperties(i,{size:{get(){return t.uniforms.size},set(e){t.uniforms.size=e}},speed:{get(){return t.uniforms.speed},set(e){t.uniforms.speed=e}}}),new Cesium.PostProcessStageComposite({name:E.rain,stages:[t,e],inputPreviousStageTexture:!0,uniforms:i}));return e}create_fog(){return new Cesium.PostProcessStage({name:E.fog,fragmentShader:`

float getDistance(sampler2D depthTexture, vec2 texCoords) {

    float depth = czm_unpackDepth(texture(depthTexture, texCoords));
  
    if(depth == 0.0) {
  
        return czm_infinity;
  
    }
  
    vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, depth);
  
    return -eyeCoordinate.z / eyeCoordinate.w;
  
  }
  
      //计算雾化距离（当它远离眼睛位置时，系数变小）
  float interpolateByDistance(vec4 nearFarScalar, float distance) {
  
    float startDistance = nearFarScalar.x;//雾化的起点距离 
    float startValue = nearFarScalar.y;
  
    float endDistance = nearFarScalar.z;
  
    float endValue = nearFarScalar.w;
  
    float t = clamp((distance - startDistance) / (endDistance - startDistance), 0.0, 1.0);
  
    return mix(startValue, endValue, t);
  
  }
  
  vec4 alphaBlend(vec4 sourceColor, vec4 destinationColor) {
  
    return sourceColor * vec4(sourceColor.aaa, 1.0) + destinationColor * (1.0 - sourceColor.a);
  
  }
  
  uniform sampler2D colorTexture;
  
  uniform sampler2D depthTexture;
  
  uniform vec4 fogByDistance;
  
  uniform vec4 fogColor; //雾的颜色
  in vec2 v_textureCoordinates;
  
  void main(void) {
    float iTime =  fract((czm_frameNumber / 700.0))*1.5;
    iTime = max(0.7,iTime);
    // iTime = smoothstep(0.5,1.5,iTime);
    float distance = getDistance(depthTexture, v_textureCoordinates);
  
    vec4 sceneColor = texture(colorTexture, v_textureCoordinates);
  
    float blendAmount = interpolateByDistance(fogByDistance, distance);
  
    vec4 finalFogColor = vec4(fogColor.rgb, fogColor.a * blendAmount * iTime);
  
    out_FragColor = alphaBlend(finalFogColor, sceneColor);
  
  }

`,uniforms:{fogByDistance:new Cesium.Cartesian4(10,0,3e3,1),fogColor:new Cesium.Color(1,1,1,1)}})}getStage(t){let i;this.stages=this.viewer.scene.postProcessStages;for(let e=0;e<this.stages._stages.length;e++){var r=this.stages.get(e);if(r.name==t){i=r;break}}return i}getAllWeathers(){let t=[];return Object.values(E).forEach(e=>{e=this.getStage(e);e&&t.push(e)}),t}hideAllWeathers(){this.getAllWeathers().forEach(e=>{e.enabled=!1})}}Object.defineProperties(xo.prototype,{weather:{get(){return this},set(e){this._type=e.type,this[e.type]=e}},snow:{get(){return this.viewer.postProcessStages[E.snow]},set(e={}){this._type=E.snow,this.hideAllWeathers();var t,i=this.viewer.postProcessStages[E.snow];for(t in e)"enabled"==t?i.enabled=e[t]:Cesium.defined(e[t])&&(i.uniforms[t]=e[t])}},rain:{get(){return this.viewer.postProcessStages[E.rain]},set(e={}){this._type=E.rain,this.hideAllWeathers();var t,i=this.viewer.postProcessStages[E.rain];for(t in e)"enabled"==t?i.enabled=e[t]:Cesium.defined(e[t])&&(i.uniforms[t]=e[t])}},fog:{get(){return this.viewer.postProcessStages[E.fog]},set(e={}){this._type=E.fog,this.hideAllWeathers();var t,i=this.viewer.postProcessStages[E.fog];for(t in e)"enabled"==t?i.enabled=e[t]:Cesium.defined(e[t])&&(i.uniforms[t]=e[t])}},sunny:{get(){return{enabled:!0}},set(){this._type=E.sunny,this.hideAllWeathers()}}});var bo=xo;var Eo=new class{constructor(){this.weather}init(e){this.weather||(this.weather=new bo(e))}set_weather(e,t){this.init(e),this.weather.weather=t}get_weather(e){return this.init(e),{enabled:this.weather[this.weather._type].enabled,type:this.weather._type}}};var Bo=new class{constructor(){this.moonListener,this.enableLightingOld,this.chacheLight={sunLight:{light:new Cesium.SunLight},moonLight:{light:new Cesium.DirectionalLight({direction:new Cesium.Cartesian3(.5),name:"moonLight"})},customLight:{light:new Cesium.DirectionalLight({direction:new Cesium.Cartesian3(.5),name:"customLight"})}}}set_customLight(e,t){var e=e.scene,i=(this.reset(e),t.color&&"string"==typeof t.color&&(t.color=Cesium.Color.fromCssColorString(t.color)),t.intensity),r=this.chacheLight.customLight.light;r.color=t.color,r.intensity=i,r.direction=Cesium.defaultValue(t.direction,r.direction),e.light=r}set_moonLight(i,e){var t=i.scene,r=(this.reset(t),e.color&&"string"==typeof e.color&&(e.color=Cesium.Color.fromCssColorString(e.color)),e.intensity),n=this._getMoonDirection(i);let o=this.chacheLight.moonLight.light;return o.color=e.color,o.intensity=r,o.direction=n,t.light=o,this.moonListener&&this.moonListener(),this.moonListener=t.preRender.addEventListener((e,t)=>{e.light===o&&(e.light.direction=this._getMoonDirection(i,e.light.direction))}),this.moonListener}set_sunLight(e,t){var e=e.scene,i=(this.reset(e),this.chacheLight.sunLight.light);t.color&&("string"==typeof t.color&&(t.color=Cesium.Color.fromCssColorString(t.color)),i.color=t.color),i.intensity=t.intensity,e.light=i}setScenelight(e,t){var i=e.scene,r=t.type;t.enabled?Cesium.defined(r)&&this["set_"+r](e,t):i.globe.enableLighting=!1}getScenelight(e){let t=!1,i="sunLight";var r=e.scene,e=e.scene.light;return r.globe.enableLighting&&(t=!0,i=e instanceof Cesium.SunLight?"sunLight":e.name),{enabled:t,type:i,intensity:e.intensity,color:e.color,verticalAngle:Cesium.defaultValue(e.verticalAngle,0),horizontalAngle:Cesium.defaultValue(e.horizontalAngle,0)}}_getMoonDirection(e,t){t=Cesium.defined(t)?t:new Cesium.Cartesian3;var i=new Cesium.Matrix3,r=new Cesium.Cartesian3,n=new Cesium.Cartesian3,e=e.clock.currentTime,e=(Cesium.defined(Cesium.Transforms.computeIcrfToFixedMatrix(e,i))||Cesium.Transforms.computeTemeToPseudoFixedMatrix(e,i),Cesium.Simon1994PlanetaryPositions.computeMoonPositionInEarthInertialFrame(e,r)),r=(Cesium.Matrix3.multiplyByVector(i,e,e),Cesium.Cartesian3.normalize(e,n));return Cesium.Cartesian3.negate(r,t)}reset(e){this.moonListener&&(this.moonListener(),this.moonListener=void 0),this.enableLightingOld&&(e.globe.enableLighting=this.enableLightingOld,this.enableLightingOld=void 0),this.enableLightingOld=e.globe.enableLighting,e.globe.enableLighting=!0}},o=`
// Use mouse to control the camera & time.
uniform sampler2D iChannel0;
float time = 0.0;
vec3 rotate(vec3 r, float v) {
    return vec3(r.x * cos(v) + r.z * sin(v), r.y, r.z * cos(v) - r.x * sin(v));
}
float noise(in vec3 x) {
    float z = x.z * 64.0;
    vec2 offz = vec2(0.317, 0.123);
    vec2 uv1 = x.xy + offz * floor(z);
    vec2 uv2 = uv1 + offz;
    return mix(texture(iChannel0, uv1).x, texture(iChannel0, uv2).x, fract(z)) - 0.5;
}
float noises(in vec3 p) {
    float a = 0.0;
    for(float i = 1.0; i < 6.0; i++) {
        a += noise(p) / i;
        p = p * 2.0 + vec3(0.0, a * 0.001 / i, a * 0.0001 / i);
    }
    return a;
}
float base(in vec3 p) {
    return noise(p * 0.00002) * 1200.0;
}
float ground(in vec3 p) {
    return base(p) + noises(p.zxy * 0.00005 + 10.0) * 40.0 * (0.0 - p.y * 0.01) + p.y;
}
float clouds( in vec3 p,vec2 iMouse){
	float b = base(p);
	p.y += b*0.5/abs(p.y) + 100.0;
	return noises(vec3(p.x*0.3+((time+iMouse.y)*30.0),p.y,p.z)*0.00002)-max(p.y,0.0)*0.00009;
}

void mainImage( out vec4 fragColor,vec2 uv )
{
    vec2 fragCoord = gl_FragCoord.xy;
    vec2 iResolution = czm_viewport.zw;
    float iTime = (czm_frameNumber / 50.0);
    vec2 iMouse = czm_iMouse;

    time = iTime * 5.0 + floor(iTime * 0.1) * 150.0;
    //vec2 uv = fragCoord.xy / (iResolution.xx * 0.5) - vec2(1.0, iResolution.y / iResolution.x);
    //vec2 uv = (gl_FragCoord.xy * 2. - iResolution.xy) / min(iResolution.x, iResolution.y);


    // vec3 campos = vec3(30.0, 500.0, time * 8.0);
    // campos.y = 500.0 - base(campos);
    // //vec3 ray = rotate(normalize(vec3(uv.x, uv.y - sin(time * 0.05) * 0.2 - 0.1, 1.0).xyz), time * 0.01 + iMouse.x * 0.009);
    // vec3 ray = rotate(normalize(vec3(uv.x, uv.y - sin(time * 0.05) * 0.2 - 0.1, 1.0).xyz), time * 0.01);
    // vec3 pos = campos + ray;
    // vec3 sun = vec3(0.0, 0.6, -0.4);    	

    // // raymarch
    // float test = 0.0;
    // float fog = 0.0;
    // float dist = 0.0;

    // vec3 p1 = pos;
    // for(float i = 1.0; i < 50.0; i++) {
    //     test = ground(p1);
    //     fog += max(test * clouds(p1,iMouse), fog * 0.02);
    //     p1 += ray * min(test, i * i * 0.5);
    //     dist += test;
    //     if(abs(test) < 10.0 || dist > 4000000.0)
    //         break;
    // }

    // float l = sin(dot(ray, sun));
    // vec3 light = vec3(l, 0.0, -l);

    // //float amb = smoothstep(-100.0, 100.0, ground(p1 + vec3(0.0, 30.0, 0.0) + sun * 10.0)) - smoothstep(1000.0, -0.0, p1.y) * 0.7;
    // //vec3 ground = vec3(0.30, 0.30, 0.25) + sin(p1 * 0.001) * 0.01 + noise(vec3(p1 * 0.002)) * 0.1 + amb * 0.7 + light * 0.01;

    // float f = smoothstep(0.0, 800.0, fog);
    // vec3 cloud = vec3(0.70, 0.72, 0.70) + light * 0.05 + sin(fog * 0.0002) * 0.2 + noise(p1) * 0.05;

    // float h = smoothstep(10000., 40000.0, dist);
    // vec3 sky = cloud + ray.y * 0.1 - 0.02;

    // fragColor = vec4(sqrt(smoothstep(0.2, 1.0, mix(mix(fragColor.xyz, sky, h), cloud, f) - dot(uv, uv) * 0.1)), 1.0);


    vec3 campos   = vec3(30.0,500.0,time*8.0);
		 campos.y = 500.0-base(campos);
    vec3 ray   = rotate(normalize(vec3(uv.x,uv.y-sin(time*0.05)*0.2-0.1,1.0).xyz),time*0.01+iMouse.x*0.009);
    vec3 pos    = campos+ray;
    vec3 sun    = vec3(0.0,0.6,-0.4);    	
	
    // raymarch
    float test  = 0.0;
    float fog   = 0.0;
	float dist  = 0.0;

	vec3  p1 = pos;	
	for(float i=1.0;i<50.0;i++){
        test  = ground(p1); 
		fog  += max(test*clouds(p1,iMouse),fog*0.02);
		p1   += ray*min(test,i*i*0.5);
		dist += test;
		if(abs(test)<10.0||dist>4000000.0) break;
	}

	float l     = sin(dot(ray,sun));
	vec3  light = vec3(l,0.0,-l);
    
	float amb = smoothstep(-100.0,100.0,ground(p1+vec3(0.0,30.0,0.0)+sun*10.0))-smoothstep(1000.0,-0.0,p1.y)*0.7;
	vec3  ground = vec3(0.30,0.30,0.25)+sin(p1*0.001)*0.01+noise(vec3(p1*0.002))*0.1+amb*0.7+light*0.01;
		
	float f = smoothstep(0.0,800.0,fog);
	vec3  cloud = vec3(0.70,0.72,0.70)+light*0.05+sin(fog*0.0002)*0.2+noise(p1)*0.05;

	float h = smoothstep(10000.,40000.0,dist);
	vec3  sky = cloud+ray.y*0.1-0.02;	
	
	fragColor = vec4(sqrt(smoothstep(0.2,1.0,mix(mix(fragColor.xyz,sky,h),cloud,f)-dot(uv,uv)*0.1)),1.0);

}

`;var Mo=class{constructor(e){this.viewer=e}get sun(){var e=this.viewer;return{enabled:e.scene.sun.show,glowFactor:e.scene.sun.glowFactor}}set sun(e){var t=this.viewer;e.enabled?(t.scene.sun.show=!0,e.glowFactor&&(t.scene.sun.glowFactor=e.glowFactor)):t.scene.sun.show=!1}get moon(){var e=this.viewer;return{enabled:e.scene.moon.show,textureUrl:e.scene.moon.textureUrl}}set moon(e){var t=this.viewer;e.enabled?(t.scene.moon.show=!0,e.textureUrl&&(t.scene.moon.textureUrl=e.textureUrl)):t.scene.moon.show=!1}get fog(){var e=this.viewer.scene.fog;return{enabled:e.enabled,density:e.density,minimumBrightness:e.minimumBrightness,screenSpaceErrorFactor:e.screenSpaceErrorFactor}}set fog(e){var t=this.viewer.scene.fog;if(e.enabled)for(var i in t.enabled=!0,e)Cesium.defined(e[i])&&(t[i]=e[i]);else t.enabled=!1}get weather(){return Eo.get_weather(this.viewer)}set weather(e){Eo.set_weather(this.viewer,e)}get showGroundAtmosphere(){var e=this.viewer.scene;return{enabled:e.globe.showGroundAtmosphere,atmosphereHueShift:e.globe.atmosphereHueShift,atmosphereSaturationShift:e.globe.atmosphereSaturationShift,atmosphereBrightnessShift:e.globe.atmosphereBrightnessShift}}set showGroundAtmosphere(e){var t=this.viewer.scene;e.enabled?(t.globe.showGroundAtmosphere=!0,null!=e.atmosphereBrightnessShift&&(t.globe.atmosphereBrightnessShift=e.atmosphereBrightnessShift),null!=e.atmosphereHueShift&&(t.globe.atmosphereHueShift=e.atmosphereHueShift),null!=e.atmosphereSaturationShift&&(t.globe.atmosphereSaturationShift=e.atmosphereSaturationShift)):t.globe.showGroundAtmosphere=!1}get skyAtmosphere(){var e=this.viewer.scene;return{brightnessShift:e.skyAtmosphere.brightnessShift,hueShift:e.skyAtmosphere.hueShift,saturationShift:e.skyAtmosphere.saturationShift}}set skyAtmosphere(e){var t=this.viewer.scene;e.enabled?(t.skyAtmosphere.show=!0,null!=e.brightnessShift&&(t.skyAtmosphere.brightnessShift=e.brightnessShift),null!=e.hueShift&&(t.skyAtmosphere.hueShift=e.hueShift),null!=e.saturationShift&&(t.skyAtmosphere.saturationShift=e.saturationShift),null!=e.saturationShift&&(t.skyAtmosphere.saturationShift=e.saturationShift),t.globe.dynamicAtmosphereLightingFromSun=!0):(t.skyAtmosphere.show=!1,t.globe.dynamicAtmosphereLightingFromSun=!1)}get skyBox(){var e=this.viewer.scene;return{enabled:e.skyBox.show,sources:e.skyBox.sources,sampler:{minificationFilter:this.viewer.scene.skyBox._cubeMap.sampler.minificationFilter,magnificationFilter:this.viewer.scene.skyBox._cubeMap.sampler.magnificationFilter},hue:e.skyBox._hue,saturation:e.skyBox._saturation,brightness:e.skyBox._brightness,fragmentShaderText:e.skyBox._fragmentShaderText}}set skyBox(e){var t=this.viewer.scene;if(e.enabled){for(var i in e.fragmentShaderText?e.fragmentShaderText=unescape(e.fragmentShaderText):e.fragmentShaderText="",e)Cesium.defined(e[i])&&(t.skyBox[i]=e[i]);t.skyBox.show=!0}else t.skyBox.show=!1}get clouds(){return Re.getClouds()}set clouds(e){e.enabled?Re.setClouds(this.viewer,e):Re.destroyed()}get highDynamicRange(){return{enabled:this.viewer.scene.highDynamicRange}}set highDynamicRange(e){e.enabled?this.viewer.scene.highDynamicRange=!0:this.viewer.scene.highDynamicRange=!1}get light(){var e=this.viewer;return Bo.getScenelight(e)}set light(e){var t=this.viewer;Bo.setScenelight(t,e)}get shadowMap(){var e=this.viewer.scene.shadowMap;return{enabled:e.enabled,normalOffset:e.normalOffset,darkness:e.darkness,maximumDistance:e.maximumDistance,fromLightSource:e.fromLightSource}}set shadowMap(e){var t=this.viewer.scene.shadowMap;if(e.enabled)for(var i in t.enabled=!0,e)Cesium.defined(t[i])&&(t[i]=e[i]);else t.enabled=!1}get baseLayer(){}set baseLayer(i){setTimeout(()=>{var e=this.viewer.imageryLayers._layers.find(e=>{if(Cesium.defined(e._imageryProvider)&&Cesium.defined(e._imageryProvider._resource))return e._imageryProvider._resource._url===i.id});if(e)for(var t in i)t in e&&Cesium.defined(i[t])&&(e[t]=i[t])})}get fxaa(){return{enabled:this.viewer.scene.postProcessStages.fxaa.enabled}}set fxaa(e={}){var t=this.viewer.scene.postProcessStages;e.enabled?t.fxaa.enabled=!0:t.fxaa.enabled=!1}set nightVision(e={}){var t=this.viewer;let i=t.scene.postProcessStages;if(e.enabled){let e=i.add(Cesium.PostProcessStageLibrary.createNightVisionStage());return e.enabled=!0,()=>{i.remove(e)}}this._removeStage(t.scene,"czm_night_vision")}get nightVision(){var e=this.viewer;return{enabled:!!this._getStage(e.scene,"czm_night_vision")}}set brightness(i={}){var r=this.viewer.scene;if(i.enabled){let e=r.postProcessStages,t=e.add(Cesium.PostProcessStageLibrary.createBrightnessStage());return t.enabled=!0,i.brightness&&(t.uniforms.brightness=i.brightness),()=>{e.remove(t)}}this._removeStage(r,"czm_brightness")}get brightness(){var e=this.viewer.scene,e=this._getStage(e,"czm_brightness");return e?{enabled:!0,brightness:e.uniforms.brightness}:{enabled:!1}}set depthOfField(i={}){var r=this.viewer.scene,n="czm_depth_of_field";if(i.enabled){this._removeStage(r,n);let e=r.postProcessStages,t=e.add(Cesium.PostProcessStageLibrary.createDepthOfFieldStage());return t.enabled=!0,i.focalDistance&&(t.uniforms.focalDistance=i.focalDistance),i.delta&&(t.uniforms.delta=i.delta),i.sigma&&(t.uniforms.sigma=i.sigma),i.stepSize&&(t.uniforms.stepSize=i.stepSize),()=>{e.remove(t)}}this._removeStage(r,n)}get depthOfField(){var e=this.viewer.scene,e=this._getStage(e,"czm_depth_of_field");return e?{enabled:!0,focalDistance:e.uniforms.focalDistance,delta:e.uniforms.delta,sigma:e.uniforms.sigma,stepSize:e.uniforms.stepSize}:{enabled:!1}}set hueContrast(t={}){var i=this.viewer.scene,r="czm_hue_contrast";if(t.enabled){this._removeStage(i,r);let e=i.postProcessStages;return e.add(new Cesium.PostProcessStage({fragmentShader:`
    uniform sampler2D colorTexture; 
  in vec2 v_textureCoordinates; 

  uniform float hue;
  uniform float saturation;
  uniform float brightness;
  uniform float contrast;
  uniform float sharpness;
  uniform float filmStrength;
  uniform float blackStrength;

  vec3 setColorFactor(vec3 color,float hue,float saturation,float brightness,float contrast){
    vec3 hsb = czm_RGBToHSB(color);              
    hsb.x += hue; // hue
    hsb.y = clamp(hsb.y + saturation, 0.0, 1.0); // saturation
    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + brightness : 0.0; // brightness                          
    float factor = (259.0 * (contrast + 255.0)) / (255.0 * (259.0 - contrast));
    hsb = factor * (hsb - vec3(0.5)) + vec3(0.5);               
    color = czm_HSBToRGB(hsb);
    return color;
  }
  vec3 applySharpen( vec3 color,float sharpness){
    vec2 uv = v_textureCoordinates;
    vec2 iResolution = czm_viewport.zw;
    vec2 step = 1.0 / iResolution.xy;
    vec3 texA = texture( colorTexture, uv + vec2(-step.x, -step.y) * 1.5 ).rgb;
    vec3 texB = texture( colorTexture, uv + vec2( step.x, -step.y) * 1.5 ).rgb;
    vec3 texC = texture( colorTexture, uv + vec2(-step.x,  step.y) * 1.5 ).rgb;
    vec3 texD = texture( colorTexture, uv + vec2( step.x,  step.y) * 1.5 ).rgb;
     
    vec3 around = 0.25 * (texA + texB + texC + texD);
    vec3 center  = color;
    
    vec3 col = center + (center - around) * sharpness;
    return col;
  }
  vec4 film(vec4 color,float filmStrength){
    vec2 uv = v_textureCoordinates;
    vec2 iResolution = czm_viewport.zw;
    float iTime = (czm_frameNumber / 250.0);
    float x = (uv.x + 4.0 ) * (uv.y + 4.0 ) * (iTime * 10.0);
    vec4 grain = vec4(mod((mod(x, 13.0) + 1.0) * (mod(x, 123.0) + 1.0), 0.01)-0.005) * filmStrength;     
    color = color + grain;
    return color;
  }
  vec4 blackAndWhite(vec4 color,float strength){
    //strength=strength *10.0;
    if(strength < 0.1){
      return color;
    }else{
      float medianValue = (color.x + color.y + color.z) / strength;
      color = vec4(medianValue, medianValue, medianValue, 1.0);  
      return color;
    }
   
  }
  void main(void) 
  { 
    vec4 color = texture(colorTexture, v_textureCoordinates);
    color.xyz = setColorFactor(color.xyz,hue,saturation,brightness,contrast);
    color.xyz = applySharpen(color.xyz, sharpness);
    color = film(color, filmStrength);
    color = blackAndWhite(color, blackStrength);//设置黑白程度
    out_FragColor = color;   
  }
    `,uniforms:{hue:Cesium.defaultValue(t.hue,0),saturation:Cesium.defaultValue(t.saturation,0),brightness:Cesium.defaultValue(t.brightness,0),contrast:Cesium.defaultValue(t.contrast,0),sharpness:Cesium.defaultValue(t.sharpness,0),filmStrength:Cesium.defaultValue(t.filmStrength,0),blackStrength:Cesium.defaultValue(t.blackStrength,0)},name:r})),()=>{e.remove(depthOfFieldStages)}}this._removeStage(i,r)}get hueContrast(){var e=this.viewer.scene,e=this._getStage(e,"czm_hue_contrast");return e?{enabled:!0,hue:e.uniforms.hue,saturation:e.uniforms.saturation,brightness:e.uniforms.brightness,contrast:e.uniforms.contrast,sharpness:e.uniforms.sharpness,filmStrength:e.uniforms.filmStrength,blackStrength:e.uniforms.blackStrength}:{enabled:!1}}set dynamicFog(t={}){var i=this.viewer,r=i.scene,n="czm_dynamic_fog";if(t.enabled){this._removeStage(r,n);let e=r.postProcessStages;return e.add(new Cesium.PostProcessStage({fragmentShader:"\n    uniform sampler2D colorTexture; \n    in vec2 v_textureCoordinates; \n    \n// Use mouse to control the camera & time.\nuniform sampler2D iChannel0;\nfloat time = 0.0;\nvec3 rotate(vec3 r, float v) {\n    return vec3(r.x * cos(v) + r.z * sin(v), r.y, r.z * cos(v) - r.x * sin(v));\n}\nfloat noise(in vec3 x) {\n    float z = x.z * 64.0;\n    vec2 offz = vec2(0.317, 0.123);\n    vec2 uv1 = x.xy + offz * floor(z);\n    vec2 uv2 = uv1 + offz;\n    return mix(texture(iChannel0, uv1).x, texture(iChannel0, uv2).x, fract(z)) - 0.5;\n}\nfloat noises(in vec3 p) {\n    float a = 0.0;\n    for(float i = 1.0; i < 6.0; i++) {\n        a += noise(p) / i;\n        p = p * 2.0 + vec3(0.0, a * 0.001 / i, a * 0.0001 / i);\n    }\n    return a;\n}\nfloat base(in vec3 p) {\n    return noise(p * 0.00002) * 1200.0;\n}\nfloat ground(in vec3 p) {\n    return base(p) + noises(p.zxy * 0.00005 + 10.0) * 40.0 * (0.0 - p.y * 0.01) + p.y;\n}\nfloat clouds( in vec3 p,vec2 iMouse){\n\tfloat b = base(p);\n\tp.y += b*0.5/abs(p.y) + 100.0;\n\treturn noises(vec3(p.x*0.3+((time+iMouse.y)*30.0),p.y,p.z)*0.00002)-max(p.y,0.0)*0.00009;\n}\n\nvoid mainImage( out vec4 fragColor,vec2 uv )\n{\n    vec2 fragCoord = gl_FragCoord.xy;\n    vec2 iResolution = czm_viewport.zw;\n    float iTime = (czm_frameNumber / 50.0);\n    vec2 iMouse = czm_iMouse;\n\n    time = iTime * 5.0 + floor(iTime * 0.1) * 150.0;\n    //vec2 uv = fragCoord.xy / (iResolution.xx * 0.5) - vec2(1.0, iResolution.y / iResolution.x);\n    //vec2 uv = (gl_FragCoord.xy * 2. - iResolution.xy) / min(iResolution.x, iResolution.y);\n\n\n    // vec3 campos = vec3(30.0, 500.0, time * 8.0);\n    // campos.y = 500.0 - base(campos);\n    // //vec3 ray = rotate(normalize(vec3(uv.x, uv.y - sin(time * 0.05) * 0.2 - 0.1, 1.0).xyz), time * 0.01 + iMouse.x * 0.009);\n    // vec3 ray = rotate(normalize(vec3(uv.x, uv.y - sin(time * 0.05) * 0.2 - 0.1, 1.0).xyz), time * 0.01);\n    // vec3 pos = campos + ray;\n    // vec3 sun = vec3(0.0, 0.6, -0.4);    \t\n\n    // // raymarch\n    // float test = 0.0;\n    // float fog = 0.0;\n    // float dist = 0.0;\n\n    // vec3 p1 = pos;\n    // for(float i = 1.0; i < 50.0; i++) {\n    //     test = ground(p1);\n    //     fog += max(test * clouds(p1,iMouse), fog * 0.02);\n    //     p1 += ray * min(test, i * i * 0.5);\n    //     dist += test;\n    //     if(abs(test) < 10.0 || dist > 4000000.0)\n    //         break;\n    // }\n\n    // float l = sin(dot(ray, sun));\n    // vec3 light = vec3(l, 0.0, -l);\n\n    // //float amb = smoothstep(-100.0, 100.0, ground(p1 + vec3(0.0, 30.0, 0.0) + sun * 10.0)) - smoothstep(1000.0, -0.0, p1.y) * 0.7;\n    // //vec3 ground = vec3(0.30, 0.30, 0.25) + sin(p1 * 0.001) * 0.01 + noise(vec3(p1 * 0.002)) * 0.1 + amb * 0.7 + light * 0.01;\n\n    // float f = smoothstep(0.0, 800.0, fog);\n    // vec3 cloud = vec3(0.70, 0.72, 0.70) + light * 0.05 + sin(fog * 0.0002) * 0.2 + noise(p1) * 0.05;\n\n    // float h = smoothstep(10000., 40000.0, dist);\n    // vec3 sky = cloud + ray.y * 0.1 - 0.02;\n\n    // fragColor = vec4(sqrt(smoothstep(0.2, 1.0, mix(mix(fragColor.xyz, sky, h), cloud, f) - dot(uv, uv) * 0.1)), 1.0);\n\n\n    vec3 campos   = vec3(30.0,500.0,time*8.0);\n\t\t campos.y = 500.0-base(campos);\n    vec3 ray   = rotate(normalize(vec3(uv.x,uv.y-sin(time*0.05)*0.2-0.1,1.0).xyz),time*0.01+iMouse.x*0.009);\n    vec3 pos    = campos+ray;\n    vec3 sun    = vec3(0.0,0.6,-0.4);    \t\n\t\n    // raymarch\n    float test  = 0.0;\n    float fog   = 0.0;\n\tfloat dist  = 0.0;\n\n\tvec3  p1 = pos;\t\n\tfor(float i=1.0;i<50.0;i++){\n        test  = ground(p1); \n\t\tfog  += max(test*clouds(p1,iMouse),fog*0.02);\n\t\tp1   += ray*min(test,i*i*0.5);\n\t\tdist += test;\n\t\tif(abs(test)<10.0||dist>4000000.0) break;\n\t}\n\n\tfloat l     = sin(dot(ray,sun));\n\tvec3  light = vec3(l,0.0,-l);\n    \n\tfloat amb = smoothstep(-100.0,100.0,ground(p1+vec3(0.0,30.0,0.0)+sun*10.0))-smoothstep(1000.0,-0.0,p1.y)*0.7;\n\tvec3  ground = vec3(0.30,0.30,0.25)+sin(p1*0.001)*0.01+noise(vec3(p1*0.002))*0.1+amb*0.7+light*0.01;\n\t\t\n\tfloat f = smoothstep(0.0,800.0,fog);\n\tvec3  cloud = vec3(0.70,0.72,0.70)+light*0.05+sin(fog*0.0002)*0.2+noise(p1)*0.05;\n\n\tfloat h = smoothstep(10000.,40000.0,dist);\n\tvec3  sky = cloud+ray.y*0.1-0.02;\t\n\t\n\tfragColor = vec4(sqrt(smoothstep(0.2,1.0,mix(mix(fragColor.xyz,sky,h),cloud,f)-dot(uv,uv)*0.1)),1.0);\n\n}\n\n\n    void main(void) \n  { \n    vec4 color = texture(colorTexture, v_textureCoordinates);\n    out_FragColor = color;\n    mainImage(out_FragColor,v_textureCoordinates);  \n  }\n    ",uniforms:{iChannel0:Cesium.defaultValue(t.iChannel0,i.scene.context.defaultTexture)},name:n})),()=>{e.remove(depthOfFieldStages)}}this._removeStage(r,n)}get dynamicFog(){var e=this.viewer.scene,e=this._getStage(e,"czm_dynamic_fog");return e?{enabled:!0,iChannel0:e.uniforms.iChannel0}:{enabled:!1}}set bloom(e={}){let t=this.viewer.scene.postProcessStages.bloom;if(e.enabled){for(var i in t.enabled=!0,e)t.uniforms[i]=e[i];return()=>{t.enabled=!1}}t.enabled=!1}get bloom(){var e=this.viewer.scene.postProcessStages.bloom,t=e._uniforms;return{enabled:e.enabled,brightness:t.brightness,contrast:t.contrast,delta:t.delta,glowOnly:t.glowOnly,sigma:t.sigma,stepSize:t.stepSize}}set resolutionScale(e){var t=this.viewer;e.enabled?t.resolutionScale=e.value:t.resolutionScale=1}get resolutionScale(){return{enabled:!0,value:this.viewer.resolutionScale}}_removeStage(e,t){var i=e.postProcessStages,e=this._getStage(e,t);e&&i.remove(e)}_getStage(e,t){return e.postProcessStages._stages.find(e=>{if("_name"in e&&e._name===t)return e})}};var Io=new class{constructor(){this.viewer,this.oldSceneState={},this.environment}setScene(e,t,i){this.viewer=e,this.environment||(this.environment=new Mo(this.viewer));var r,n={};for(r in t){var o=t[r];if(o&&Cesium.defined(o.enabled)){var s,a={};for(s in o)Array.isArray(o[s])&&0<o[s].length&&"min"in o[s][0]?a[s]=this.getValueByTime(o[s],i):a[s]=this.transformValue(o[s]);n[r]=a}}var l,u=this._getSceneChange(n,this.oldSceneState);for(l in u)this.environment[l]=u[l];this.oldSceneState=n}getValueByTime(t,i){for(let e=0;e<t.length;e++){var r;if(i>=t[e].min&&i<=t[e].max)return r=t[e].value,Array.isArray(r)?this.getValueLine(t[e].min,t[e].max,r,i):this.transformValue(r)}}getValueLine(e,t,i,r){var n,o=this.transformValue(i[0]),i=this.transformValue(i[1]);return Number.isFinite(o)?o+(r-e)/(t-e)*(i-o):o instanceof Cesium.Color?(n=Cesium.Color.subtract(i,o,new Cesium.Color),Cesium.Color.multiplyByScalar(n,(r-e)/(t-e),n),Cesium.Color.add(o,n,new Cesium.Color)):o instanceof Cesium.Cartesian2?(n=Cesium.Cartesian2.subtract(i,o,new Cesium.Cartesian2),Cesium.Cartesian2.multiplyByScalar(n,(r-e)/(t-e),n),Cesium.Cartesian2.add(o,n,new Cesium.Cartesian2)):o instanceof Cesium.Cartesian3?(n=Cesium.Cartesian3.subtract(i,o,new Cesium.Cartesian3),Cesium.Cartesian3.multiplyByScalar(n,(r-e)/(t-e),n),Cesium.Cartesian3.add(o,n,new Cesium.Cartesian3)):o instanceof Cesium.Cartesian4?(n=Cesium.Cartesian4.subtract(i,o,new Cesium.Cartesian4),Cesium.Cartesian4.multiplyByScalar(n,(r-e)/(t-e),n),Cesium.Cartesian4.add(o,n,new Cesium.Cartesian4)):void 0}getRandomNumberInRange(e,t){return e+Cesium.Math.nextRandomNumber()*(t-e)}transformValue(e){return"string"==typeof e&&e.includes("#")&&(e=Cesium.Color.fromCssColorString(e)),e=3===Object.keys(e).length&&Cesium.defined(e.x)&&Cesium.defined(e.y)&&Cesium.defined(e.z)?new Cesium.Cartesian3(e.x,e.y,e.z):e}_getSceneChange(e,t){var i,r={};let n=!1;for(i in e){if(Cesium.defined(e[i])&&!Cesium.defined(t[i]))n=!0;else if(Cesium.defined(e[i])&&Cesium.defined(t[i]))for(var o in e[i])Cesium.defined(e[i][o])&&!Cesium.defined(t[i][o])?n=!0:Cesium.defined(e[i][o])&&Cesium.defined(t[i][o])&&(this._equals(e[i][o],t[i][o])||(n=!0));n&&(r[i]=e[i])}return r}_equals(e,t){let i=!1;return e instanceof Cesium.Cartesian4?Cesium.Cartesian4.equals(e,t)&&(i=!0):e instanceof Cesium.Cartesian3?Cesium.Cartesian3.equals(e,t)&&(i=!0):e instanceof Cesium.Cartesian2?Cesium.Cartesian2.equals(e,t)&&(i=!0):e instanceof Cesium.Color?Cesium.Color.equals(e,t)&&(i=!0):e===t&&(i=!0),i}};tn=new class{createMap(e,t,i){i={...i};i.treeData=t,this._initMap(e,i)}initMap(e,t){t=t||Object.assign({},{requestRenderMode:!1,fxaa:!0},t),this._initMap(e,t)}_initMap(e,t={}){let i=null;i=t&&t.CIM?(window[t.CIM]={},window[t.CIM]):(window.CIM={},window.CIM),this.initialize_WindowApends();var r=agcim.scene.sceneViewer,n=agcim.scene.Scene;let o=r.createViewer(e,t);r=new n(i.viewer=o);(i.agcimScene=r).initialize(o,t.treeData,i),r.setSceneConfig({sun:!1,moon:!1,fog:!1,depthTestAgainstTerrain:!0,baseColor:"#fff"}),t&&t.baseMap&&r.setBaseMap(t.baseMap),t.lightConfig&&o.clock.onTick.addEventListener(()=>{Io.setScene(o,t.lightConfig,60*o.clock.hours*60+60*o.clock.minutes+o.clock.seconds)}),t.fxaa&&(o.postProcessStages.fxaa.enabled=!0)}initialize_WindowApends(){window.CIM_LAYERTREE_NAME=window.CIM_LAYERTREE_NAME||"",window.CIM_APPLICATION_NAME=window.CIM_APPLICATION_NAME||"",window.CIM_USER_NAME=window.CIM_USER_NAME||"",window.CIM_USER_ID=window.CIM_USER_ID||"",window.TITLE_BAR=window.TITLE_BAR||"",window.CIM_PROJECT_CONFIG=window.CIM_PROJECT_CONFIG||{},window.CIM_PROJECT_CONFIG.serverApiVersion=window.CIM_PROJECT_CONFIG.serverApiVersion||1}},rn=__webpack_require__(8105),nn=__webpack_require__(9608),on={LayerTree:Zn.Z,Scene:i,sceneViewer:e,mapInit:tn,layerClass:rn.Z,layerLoader:nn.Z};var So=function(t=[]){let i="",r=[];for(let e=0;e<t.length;e++){n=t[e],o="stage"+e;n=n.replace(/(?=void\s).+(?=\()/g,"void "+o);i+=n,r+="stage"+e+"(out_FragColor);"}var n,o,e=i;return e+=`
  uniform samplerCube u_cubeMap;
  in vec3 v_texCoord;
  uniform float u_hue; // Hue, saturation, brightness
  uniform float u_saturation;
  uniform float u_brightness;
  uniform float u_contrast;
  uniform bool u_animation;

  vec3 AdjustColor(vec3 color,float hue,float saturation,float brightness,float contrast){
    vec3 hsb = czm_RGBToHSB(color);
                  
    hsb.x += hue; // hue
    hsb.y = clamp(hsb.y + saturation, 0.0, 1.0); // saturation
    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + brightness : 0.0; // brightness


    float factor = (259.0 * (contrast + 255.0)) / (255.0 * (259.0 - contrast));
    hsb = factor * (hsb - vec3(0.5)) + vec3(0.5);

    color = czm_HSBToRGB(hsb);
    return color;
  }
  void main()
  {
    float iTime = fract(czm_frameNumber / 2000.0);
     vec3 cood = v_texCoord;
     if(u_animation){
      iTime = iTime *0.98;
      if(iTime > 0.49){
       cood.x = 0.98 + cood.x - iTime;
      }else{
       cood.x+=iTime;
      }
     }    
  vec4 color = texture(u_cubeMap, normalize(cood));
  color.xyz = AdjustColor(color.xyz,u_hue,u_saturation,u_brightness,u_contrast);
  out_FragColor = vec4(czm_gammaCorrect(color).rgb, czm_morphTime);

  }
    `,e=Cesium.ShaderSource.replaceMain(e,"skybox_main"),e+=`
  void main(){
    skybox_main();
    ${r}
  }
  `};var Po=function(){return"\n    in vec3 position;\n    out vec3 v_texCoord;\n    uniform mat3 u_rotateMatrix;\n\n    uniform bool u_animation;\n    void main()\n    {\n      vec3 p;\n      if(u_animation){\n        p = czm_viewRotation * u_rotateMatrix * (czm_temeToPseudoFixed * (czm_entireFrustum.y * position));\n      }else{\n        p = czm_viewRotation * u_rotateMatrix * (czm_entireFrustum.y * position);\n      }\n    gl_Position = czm_projection * vec4(p, 1.0);\n    v_texCoord = position.xyz;\n    }\n    "};const B=window.Cesium,To=B.BoxGeometry,Lo=B.Cartesian3,Do=B.defaultValue,Fo=B.defined,No=B.destroyObject,Oo=B.DeveloperError,Ro=B.GeometryPipeline;sn=B.Matrix3;const Uo=B.Matrix4,ko=B.Transforms,Ho=B.VertexFormat,Qo=B.BufferUsage,Vo=B.CubeMap,Go=B.DrawCommand,zo=B.loadCubeMap,Wo=B.RenderState,qo=B.VertexArray,Ko=B.BlendingState,jo=B.SceneMode,Zo=B.ShaderProgram,Yo=B.ShaderSource;function Xo(e){this.sources=e.sources,this._sources=void 0,this.show=Do(e.show,!0),this._command=new Go({modelMatrix:Uo.clone(Uo.IDENTITY),owner:this}),this._cubeMap=void 0,this._attributeLocations=void 0,this._useHdr=void 0,this._hue=0,this._saturation=0,this._brightness=0,this._contrast=0,this._animation=!1,this._fragmentShaderText=void 0,this._shaderDirty=!1,this._unifrom={}}Object.defineProperties(Xo.prototype,{fragmentShaderText:{get(){return this._fragmentShaderText},set(e){B.defined(e)&&""!==e||(e=[]),Array.isArray(e)||(e=[e]),this._fragmentShaderText=e,this._shaderDirty=!0}},unifrom:{get(){return this._unifrom},set(e){B.defined(e)&&""!==e||(e={}),this._unifrom=e,this._shaderDirty=!0}},hue:{get(){return this._hue},set(e){this._hue=e}},saturation:{get(){return this._saturation},set(e){this._saturation=e}},brightness:{get(){return this._brightness},set(e){this._brightness=e}},contrast:{get(){return this._contrast},set(e){this._contrast=e}},animation:{get(){return this._animation},set(e){this._animation=e}}});const Jo=new sn;Xo.prototype.update=function(e,t){var i=this;if(this.show&&(e.mode===jo.SCENE3D||e.mode===jo.MORPHING)&&e.passes.render){var r=e.context;if(this._sources!==this.sources){this._sources=this.sources;var n=this.sources;if(!(Fo(n.positiveX)&&Fo(n.negativeX)&&Fo(n.positiveY)&&Fo(n.negativeY)&&Fo(n.positiveZ)&&Fo(n.negativeZ)))throw new Oo("this.sources is required and must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.");if(typeof n.positiveX!=typeof n.negativeX||typeof n.positiveX!=typeof n.positiveY||typeof n.positiveX!=typeof n.negativeY||typeof n.positiveX!=typeof n.positiveZ||typeof n.positiveX!=typeof n.negativeZ)throw new Oo("this.sources properties must all be the same type.");"string"==typeof n.positiveX?zo(r,this._sources).then(function(e){i._cubeMap=i._cubeMap&&i._cubeMap.destroy(),i._cubeMap=e}):(this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),this._cubeMap=new Vo({context:r,source:n}))}var o=this._command,n=(o.modelMatrix=ko.eastNorthUpToFixedFrame(e.camera._positionWC),{u_cubeMap:function(){return i._cubeMap},u_rotateMatrix:function(){return Uo.getRotation(o.modelMatrix,Jo)},u_hue:function(){return i._hue},u_saturation:function(){return i._saturation},u_brightness:function(){return i._brightness},u_contrast:function(){return i._contrast},u_animation:function(){return i._animation}}),n=Object.assign({},n,this._unifrom);if(o.uniformMap=n,Fo(o.vertexArray)||(e=To.createGeometry(To.fromDimensions({dimensions:new Lo(2,2,2),vertexFormat:Ho.POSITION_ONLY})),n=this._attributeLocations=Ro.createAttributeLocations(e),o.vertexArray=qo.fromGeometry({context:r,geometry:e,attributeLocations:n,bufferUsage:Qo.STATIC_DRAW}),o.renderState=Wo.fromCache({blending:Ko.ALPHA_BLEND})),Fo(o.shaderProgram)&&this._useHdr===t&&!this._shaderDirty||(e=new Yo({defines:[t?"HDR":""],sources:[So(this._fragmentShaderText)]}),o.shaderProgram=Zo.fromCache({context:r,vertexShaderSource:Po(),fragmentShaderSource:e,attributeLocations:this._attributeLocations}),this._useHdr=t,this._shaderDirty=!1),Fo(this._cubeMap))return o}},Xo.prototype.isDestroyed=function(){return!1},Xo.prototype.destroy=function(){var e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy(),this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),No(this)};var $o=Xo;let es=Cesium.Cartesian2,ts=Cesium.Cartesian3,is=Cesium.Color,M=Cesium.defaultValue,rs=Cesium.defined;var ns=new es(1,1);function os(e){e=M(e,M.EMPTY_OBJECT),this.mass=M(e.mass,1),this.scaleByDistance=e.scaleByDistance,this.translucencyByDistance=e.translucencyByDistance,this.pixelOffsetScaleByDistance=e.pixelOffsetScaleByDistance,this.distanceDisplayCondition=e.distanceDisplayCondition,this.disableDepthTestDistance=e.disableDepthTestDistance,this.position=ts.clone(M(e.position,ts.ZERO)),this.velocity=ts.clone(M(e.velocity,ts.ZERO)),this.life=M(e.life,Number.MAX_VALUE),this.image=e.image,this.startColor=is.clone(M(e.startColor,is.WHITE)),this.endColor=is.clone(M(e.endColor,is.WHITE)),this.startScale=M(e.startScale,1),this.endScale=M(e.endScale,1),this.imageSize=es.clone(M(e.imageSize,ns)),this._age=0,this._normalizedAge=0,this._billboard=void 0}Object.defineProperties(os.prototype,{age:{get:function(){return this._age}},normalizedAge:{get:function(){return this._normalizedAge}}});var ss=new ts,as=(os.prototype.update=function(e,t){return ts.multiplyByScalar(this.velocity,e,ss),ts.add(this.position,ss,this.position),rs(t)&&t(this,e),this._age+=e,this.life===Number.MAX_VALUE?this._normalizedAge=0:this._normalizedAge=this._age/this.life,this._age<=this.life},os);let ls=Cesium.Cartesian2,us=Cesium.Cartesian3,I=Cesium.Check,cs=Cesium.Color,S=Cesium.defaultValue,hs=Cesium.defined,As=Cesium.destroyObject,ps=Cesium.Event,fs=Cesium.JulianDate,L=Cesium.Math,D=Cesium.Matrix4,ds=Cesium.BillboardCollection,gs=Cesium.CircleEmitter,ms=Cesium.Particle;var ys=new ls(1,1);function _s(e){e=S(e,S.EMPTY_OBJECT),this.id=S(e.id,Cesium.createGuid()),this.show=S(e.show,!0),this.updateCallback=e.updateCallback,this.loop=S(e.loop,!0),this.image=S(e.image,void 0);var t=e.emitter;hs(t)||(t=new gs(.5)),this._emitter=t,this._bursts=e.bursts,this._modelMatrix=D.clone(S(e.modelMatrix,D.IDENTITY)),this._emitterModelMatrix=D.clone(S(e.emitterModelMatrix,D.IDENTITY)),this._matrixDirty=!0,this._combinedMatrix=new D,this._startColor=cs.clone(S(e.color,S(e.startColor,cs.WHITE))),this._endColor=cs.clone(S(e.color,S(e.endColor,cs.WHITE))),this._startScale=S(e.scale,S(e.startScale,1)),this._endScale=S(e.scale,S(e.endScale,1)),this._scaleByDistance=e.scaleByDistance,this._translucencyByDistance=e.translucencyByDistance,this._pixelOffsetScaleByDistance=e.pixelOffsetScaleByDistance,this._distanceDisplayCondition=e.distanceDisplayCondition,this._disableDepthTestDistance=e.disableDepthTestDistance,this._emissionRate=S(e.emissionRate,5),this._minimumSpeed=S(e.speed,S(e.minimumSpeed,1)),this._maximumSpeed=S(e.speed,S(e.maximumSpeed,1)),this._minimumParticleLife=S(e.particleLife,S(e.minimumParticleLife,5)),this._maximumParticleLife=S(e.particleLife,S(e.maximumParticleLife,5)),this._minimumMass=S(e.mass,S(e.minimumMass,1)),this._maximumMass=S(e.mass,S(e.maximumMass,1)),this._minimumImageSize=ls.clone(S(e.imageSize,S(e.minimumImageSize,ys))),this._maximumImageSize=ls.clone(S(e.imageSize,S(e.maximumImageSize,ys))),this._sizeInMeters=S(e.sizeInMeters,!1),this._lifetime=S(e.lifetime,Number.MAX_VALUE),this._billboardCollection=void 0,this._particles=[],this._particlePool=[],this._previousTime=void 0,this._currentTime=0,this._carryOver=0,this._complete=new ps,this._isComplete=!1,this._updateParticlePool=!0,this._particleEstimate=0,this.growth=S(e.growth,!1),this._growthTime=S(e.growthTime,3e3),this._growthCurrentTimeTime=0,this._growthRate=1,this.death=S(e.death,!1),this.deathTime=S(e.deathTime,3e3),this._deathCurrentTimeTime=0}function vs(e,t){var i=t._billboard,e=((i=hs(i)?i:t._billboard=e._billboardCollection.add({image:t.image})).width=t.imageSize.x,i.height=t.imageSize.y,i.position=t.position,i.sizeInMeters=e.sizeInMeters,i.show=!0,L.lerp(t.startColor.red,t.endColor.red,t.normalizedAge)),r=L.lerp(t.startColor.green,t.endColor.green,t.normalizedAge),n=L.lerp(t.startColor.blue,t.endColor.blue,t.normalizedAge),o=L.lerp(t.startColor.alpha,t.endColor.alpha,t.normalizedAge);i.color=new cs(e,r,n,o),i.scale=L.lerp(t.startScale,t.endScale,t.normalizedAge),i.scaleByDistance=t.scaleByDistance,i.translucencyByDistance=t.translucencyByDistance,i.pixelOffsetScaleByDistance=t.pixelOffsetScaleByDistance,i.distanceDisplayCondition=t.distanceDisplayCondition,i.disableDepthTestDistance=t.disableDepthTestDistance}Object.defineProperties(_s.prototype,{emitter:{get:function(){return this._emitter},set:function(e){I.defined("value",e),this._emitter=e}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(e){I.defined("value",e),this._scaleByDistance=e}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(e){I.defined("value",e),this._translucencyByDistance=e}},pixelOffsetScaleByDistance:{get:function(){return this._pixelOffsetScaleByDistance},set:function(e){I.defined("value",e),this._pixelOffsetScaleByDistance=e}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(e){I.defined("value",e),this._disableDepthTestDistance=e}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){I.defined("value",e),this._distanceDisplayCondition=e}},bursts:{get:function(){return this._bursts},set:function(e){this._bursts=e,this._updateParticlePool=!0}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){I.defined("value",e),this._matrixDirty=this._matrixDirty||!D.equals(this._modelMatrix,e),D.clone(e,this._modelMatrix)}},emitterModelMatrix:{get:function(){return this._emitterModelMatrix},set:function(e){I.defined("value",e),this._matrixDirty=this._matrixDirty||!D.equals(this._emitterModelMatrix,e),D.clone(e,this._emitterModelMatrix)}},startColor:{get:function(){return this._startColor},set:function(e){I.defined("value",e),cs.clone(e,this._startColor)}},endColor:{get:function(){return this._endColor},set:function(e){I.defined("value",e),cs.clone(e,this._endColor)}},startScale:{get:function(){return this._startScale},set:function(e){I.typeOf.number.greaterThanOrEquals("value",e,0),this._startScale=e}},endScale:{get:function(){return this._endScale},set:function(e){I.typeOf.number.greaterThanOrEquals("value",e,0),this._endScale=e}},emissionRate:{get:function(){return this._emissionRate},set:function(e){I.typeOf.number.greaterThanOrEquals("value",e,0),this._emissionRate=e,this._updateParticlePool=!0}},minimumSpeed:{get:function(){return this._minimumSpeed},set:function(e){I.typeOf.number.greaterThanOrEquals("value",e,0),this._minimumSpeed=e}},maximumSpeed:{get:function(){return this._maximumSpeed},set:function(e){I.typeOf.number.greaterThanOrEquals("value",e,0),this._maximumSpeed=e}},minimumParticleLife:{get:function(){return this._minimumParticleLife},set:function(e){I.typeOf.number.greaterThanOrEquals("value",e,0),this._minimumParticleLife=e}},maximumParticleLife:{get:function(){return this._maximumParticleLife},set:function(e){I.typeOf.number.greaterThanOrEquals("value",e,0),this._maximumParticleLife=e,this._updateParticlePool=!0}},minimumMass:{get:function(){return this._minimumMass},set:function(e){I.typeOf.number.greaterThanOrEquals("value",e,0),this._minimumMass=e}},maximumMass:{get:function(){return this._maximumMass},set:function(e){I.typeOf.number.greaterThanOrEquals("value",e,0),this._maximumMass=e}},minimumImageSize:{get:function(){return this._minimumImageSize},set:function(e){I.typeOf.object("value",e),I.typeOf.number.greaterThanOrEquals("value.x",e.x,0),I.typeOf.number.greaterThanOrEquals("value.y",e.y,0),this._minimumImageSize=e}},maximumImageSize:{get:function(){return this._maximumImageSize},set:function(e){I.typeOf.object("value",e),I.typeOf.number.greaterThanOrEquals("value.x",e.x,0),I.typeOf.number.greaterThanOrEquals("value.y",e.y,0),this._maximumImageSize=e}},sizeInMeters:{get:function(){return this._sizeInMeters},set:function(e){I.typeOf.bool("value",e),this._sizeInMeters=e}},lifetime:{get:function(){return this._lifetime},set:function(e){I.typeOf.number.greaterThanOrEquals("value",e,0),this._lifetime=e}},complete:{get:function(){return this._complete}},isComplete:{get:function(){return this._isComplete}}});var Cs=new us,ws=(_s.prototype.update=function(e){if(this.show){if(hs(this._billboardCollection)||(this._billboardCollection=new ds),this._updateParticlePool){var t=this,i=t._emissionRate,r=t._maximumParticleLife,n=0,o=t._bursts;if(hs(o))for(var s=o.length,a=0;a<s;++a)n+=o[a].maximum;for(var l=t._billboardCollection,u=t.image,i=Math.ceil(i*r+n),r=t._particles,c=t._particlePool,h=Math.max(i-r.length-c.length,0),A=0;A<h;++A){var p=new ms;p._billboard=l.add({image:u}),c.push(p)}t._particleEstimate=i,this._updateParticlePool=!1}if(this.growth&&(this._growthRate=function(e){let t=1;return e._growthCurrentTimeTime<e._growthTime?(e._growthCurrentTimeTime+=17,1<(t=e._growthCurrentTimeTime/e._growthTime)&&(t=1)):e.growth=!1,t}(this)),this.death&&(this._growthRate=function(e){let t=0;return e._deathCurrentTimeTime<e.deathTime?(e._deathCurrentTimeTime+=17,(t=(e.deathTime-e._deathCurrentTimeTime)/e._growthTime)<0&&(t=0)):e.death=!1,t}(this),0===this._growthRate))this._complete.raiseEvent(this);else{var f,d,g=0,m=((g=this._previousTime?fs.secondsDifference(e.time,this._previousTime):g)<0&&(g=0),this._particles),r=this._emitter,y=this.updateCallback,_=m.length;for(E=0;E<_;++E)(f=m[E]).update(g,y)?vs(this,f):(d=f,hs(d._billboard)&&(d._billboard.show=!1),d=f,this._particlePool.push(d),m[E]=m[_-1],--E,--_);m.length=_;var v,C,w,x=function(e,t){if(e._isComplete)return 0;var t=(t=L.mod(t,e._lifetime))*e._emissionRate,i=Math.floor(t);if(e._carryOver+=t-i,1<e._carryOver&&(i++,--e._carryOver),hs(e.bursts))for(var r=e.bursts.length,n=0;n<r;n++){var o=e.bursts[n],s=e._currentTime;hs(o)&&!o._complete&&s>o.time&&(i+=L.randomBetween(o.minimum,o.maximum),o._complete=!0)}return i}(this,g)*this._growthRate;if(0<x&&hs(r)){this._matrixDirty&&(this._combinedMatrix=D.multiply(this.modelMatrix,this.emitterModelMatrix,this._combinedMatrix),this._matrixDirty=!1);for(var b=this._combinedMatrix,E=0;E<x;E++)w=(w=this)._particlePool.pop(),f=w=hs(w)?w:new ms,this._emitter.emit(f),us.add(f.position,f.velocity,Cs),D.multiplyByPoint(b,Cs,Cs),f.position=D.multiplyByPoint(b,f.position,f.position),us.subtract(Cs,f.position,f.velocity),us.normalize(f.velocity,f.velocity),w=this,C=void 0,(v=f).startColor=cs.clone(w._startColor,v.startColor),v.endColor=cs.clone(w._endColor,v.endColor),v.startScale=w._startScale*w._growthRate,v.endScale=w._endScale*w._growthRate,v.scaleByDistance=w._scaleByDistance,v.translucencyByDistance=w._translucencyByDistance,v.pixelOffsetScaleByDistance=w._pixelOffsetScaleByDistance,v.distanceDisplayCondition=w._distanceDisplayCondition,v.disableDepthTestDistance=w._disableDepthTestDistance,v.image=w.image,v.life=L.randomBetween(w._minimumParticleLife*w._growthRate,w._maximumParticleLife*w._growthRate),v.mass=L.randomBetween(w._minimumMass*w._growthRate,w._maximumMass*w._growthRate),v.imageSize.x=L.randomBetween(w._minimumImageSize.x*w._growthRate,w._maximumImageSize.x*w._growthRate),v.imageSize.y=L.randomBetween(w._minimumImageSize.y*w._growthRate,w._maximumImageSize.y*w._growthRate),v._normalizedAge=0,v._age=0,C=L.randomBetween(w._minimumSpeed*w._growthRate,w._maximumSpeed*w._growthRate),us.multiplyByScalar(v.velocity,C,v.velocity),w._particles.push(v),vs(this,f)}if(this._billboardCollection.update(e),this._previousTime=fs.clone(e.time,this._previousTime),this._currentTime+=g,this._lifetime!==Number.MAX_VALUE&&this._currentTime>this._lifetime)if(this.loop){if(this._currentTime=L.mod(this._currentTime,this._lifetime),this.bursts){var B=this.bursts.length;for(E=0;E<B;E++)this.bursts[E]._complete=!1}}else this._isComplete=!0,this._complete.raiseEvent(this);if(e.frameNumber%120==0){for(var i=(t=this)._particles,M=t._particlePool,I=t._billboardCollection,i=i.length,S=M.length,t=t._particleEstimate,P=t=S-Math.max(t-i-S,0);P<S;++P){var T=M[P];I.remove(T._billboard)}M.length=t}}}},_s.prototype.isDestroyed=function(){return!1},_s.prototype.destroy=function(){return this._billboardCollection=this._billboardCollection&&this._billboardCollection.destroy(),As(this)},_s);let xs=Cesium.Cartesian3;function bs(e,t){t=Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3);return Cesium.Cartesian3.normalize(t,t)}function Es(e,t){this._origin=e,this._target=t,this._derection=bs(e,t)}Object.defineProperties(Es.prototype,{origin:{get:function(){return this._origin},set:function(e){this._derection=bs(e,this._target),this._origin=e}},target:{get:function(){return this._target},set:function(e){this._derection=bs(this._origin,e),this._target=e}},derection:{get:function(){return this._derection},set:function(e){this._derection=e}}}),Es.prototype.emit=function(e){e.velocity=this.derection.clone(),e.position=xs.clone(xs.ZERO,e.position)};var Bs=Es;var Ms=class{constructor(e={}){this.type=Cesium.defaultValue(e.type,"AgDiffuseMaterial"),this.color=Cesium.defaultValue(e.color,new Cesium.Color(1,1,1,1)),this.diffuseImage=Cesium.defaultValue(e.diffuseImage,Cesium.Material.DefaultImageId),this.normalImage=Cesium.defaultValue(e.normalImage,Cesium.Material.DefaultImageId),this.repeat=Cesium.defaultValue(e.repeat,new Cesium.Cartesian2(1,1)),this.hue=Cesium.defaultValue(e.hue,0),this.saturation=Cesium.defaultValue(e.saturation,0),this.brightness=Cesium.defaultValue(e.brightness,0),this.contrast=Cesium.defaultValue(e.contrast,0),this.strength=Cesium.defaultValue(e.strength,1),Cesium.Material._materialCache.getMaterial(this.type)||Cesium.Material._materialCache.addMaterial(this.type,{fabric:{type:this.type,uniforms:{diffuseImage:this.diffuseImage,normalImage:this.normalImage,strength:this.strength,repeat:this.repeat,color:this.color,hue:this.hue,saturation:this.saturation,brightness:this.brightness,contrast:this.contrast},source:`
uniform sampler2D normalImage;
uniform sampler2D diffuseImage;
uniform float strength;
uniform vec2 repeat;
uniform vec4 color;

uniform float hue;
uniform float saturation;
uniform float brightness;
uniform float contrast;
vec3 setColorFactor(vec3 color,float hue,float saturation,float brightness,float contrast){
    vec3 hsb = czm_RGBToHSB(color);              
    hsb.x += hue; // hue
    hsb.y = clamp(hsb.y + saturation, 0.0, 1.0); // saturation
    hsb.z = hsb.z > czm_epsilon7 ? hsb.z + brightness : 0.0; // brightness                          
    float factor = (259.0 * (contrast + 255.0)) / (255.0 * (259.0 - contrast));
    hsb = factor * (hsb - vec3(0.5)) + vec3(0.5);               
    color = czm_HSBToRGB(hsb);
    return color;
  }
czm_material czm_getMaterial(czm_materialInput materialInput)
{
    czm_material material = czm_getDefaultMaterial(materialInput);
    vec2 st = materialInput.st;
    vec4 colorImage = texture(diffuseImage, vec2(fract(st.s * repeat.x), fract(st.t * repeat.y)));
    vec3 diffuse = colorImage.rgb * color.rgb;
    diffuse = setColorFactor(diffuse,hue,saturation,brightness,contrast);
    float alpha =  colorImage.a * color.a;

    vec4 textureValue = texture(normalImage, vec2(fract(st.s * repeat.x), fract(st.t * repeat.y)));
    // vec3 normalTangentSpace = textureValue.xyz;
    // normalTangentSpace.xy = normalTangentSpace.xy * 2.0 - 1.0;
    // normalTangentSpace.z = clamp(1.0 - strength, 0.1, 1.0);
    // normalTangentSpace = normalize(normalTangentSpace);
    // vec3 normalEC = materialInput.tangentToEyeMatrix * normalTangentSpace;
    
    material.normal = textureValue.rgb;
 
    material.alpha = alpha;
    float hours = czm_globeTime.x;
    if(6.0 <hours && hours<20.0){
        material.diffuse = diffuse;
    }else{
        material.emission = diffuse;
    }
  
    return material;
}
`},translucent:e=>{return e.uniforms.color.alpha<1},minificationFilter:Cesium.TextureMinificationFilter.LINEAR_MIPMAP_LINEAR,magnificationFilter:Cesium.TextureMagnificationFilter.LINEAR}),this.material=Cesium.Material.fromType(this.type)}};var Is=class{constructor(e={}){this.type=Cesium.defaultValue(e.type,"AgCreateDotMaterial"),Cesium.Material._materialCache.getMaterial(this.type)||Cesium.Material._materialCache.addMaterial(this.type,{fabric:{type:this.type,uniforms:{},source:`


float pattern(vec2 point, float radius, float cellSize) {
    float c = 4.0 * radius * cellSize;
    // half
    float h = c / 2.0;  
    point = mod(point + h, c) - h;
    return length(point) - radius;
}

vec3 mainImage(in vec2 uv)
{
	//vec2 uv = ((fragCoord - 0.5 * iResolution.xy) / iResolution.y) / 0.5;
    uv = mat2(0.707, -0.707, 0.707, 0.707) * uv;
    float radius = 0.05;
    float dist = pattern(uv, radius, 1.5);
    vec3 dotcolor = vec3(0.95, 0.9, 0.0);
    vec3 bg = vec3(0.5, 0.8, 0.75);
 
    float sharpness = 200.;
	float circ = radius * sharpness - dist * sharpness;
    
    float alpha = clamp(circ, 0.0, 1.0);
   
    vec3 color = mix(bg, dotcolor, alpha);
	//fragColor = vec4(color,1.0);
    return color;
    
}



czm_material czm_getMaterial(czm_materialInput materialInput) {
   czm_material material = czm_getDefaultMaterial(materialInput);
   vec2 st = materialInput.st;
   material.diffuse =  mainImage(st); 
   //material.alpha *= time;
   return material;
}
`}}),this.material=Cesium.Material.fromType(this.type)}};var Ss=class{constructor(e={}){this.type=Cesium.defaultValue(e.type,"AgDynamicColor"),this.color=Cesium.defaultValue(e.color,new Cesium.Color(1,1,0,1)),this.image=Cesium.defaultValue(e.image,Cesium.Material.DefaultImageId),this.repeat=Cesium.defaultValue(e.repeat,new Cesium.Cartesian2(1,1)),Cesium.Material._materialCache.getMaterial(this.type)||Cesium.Material._materialCache.addMaterial(this.type,{fabric:{type:this.type,uniforms:{color:this.color,time:0,image:this.image,repeat:this.repeat},source:`
uniform vec2 repeat;
czm_material czm_getMaterial(czm_materialInput materialInput) {
   czm_material material = czm_getDefaultMaterial(materialInput);
   vec2 st = materialInput.st;
   vec4 colorImage = texture(image, vec2(fract(st.s * repeat.x), fract(st.t * repeat.y)));
   material.diffuse = colorImage.rgb * color.rgb * (time + 0.05); 
   //+ 1.0 / (time * 400.0);
   material.alpha *= time;
   return material;
}`},translucent:e=>{return e.uniforms.color.alpha<1}}),this.material=Cesium.Material.fromType(this.type)}};var Ps=class{constructor(e={}){this.type=Cesium.defaultValue(e.type,"AgFlowMaterial"),this.color=Cesium.defaultValue(e.color,new Cesium.Color(1,1,1,1)),this.image=Cesium.defaultValue(e.image,Cesium.Material.DefaultImageId),this.repeat=Cesium.defaultValue(e.repeat,new Cesium.Cartesian2(1,1)),this.flowdirection=Cesium.defaultValue(e.flowdirection,0),Cesium.Material._materialCache.getMaterial(this.type)||Cesium.Material._materialCache.addMaterial(this.type,{fabric:{type:this.type,uniforms:{color:this.color,image:this.image,time:0,repeat:this.repeat,flowdirection:this.flowdirection},source:`uniform float time;
uniform sampler2D image;
uniform vec4 color;
uniform vec2 repeat;
uniform float flowdirection;
czm_material czm_getMaterial(czm_materialInput materialInput) {
    czm_material material = czm_getDefaultMaterial(materialInput);
    vec2 st = materialInput.st;
    vec4 colorImage;
    if(flowdirection == 0.0) {
        colorImage = texture(image, vec2(fract(-(st.s * repeat.x + time)), fract(st.t * repeat.y)));
    } else if(flowdirection == 1.0) {
        colorImage = texture(image, vec2(fract(st.s * repeat.x - time), fract(st.t * repeat.y)));
    } else if(flowdirection == 2.0) {
        //colorImage = texture(image, vec2(st.s, fract(st.t * repeat.y + time)));
        colorImage = texture(image, vec2(fract(st.t * repeat.x - time), fract(st.t * repeat.y)));
    } else if(flowdirection == 3.0) {     
        colorImage = texture(image, vec2(fract(-(st.t * repeat.x + time)), fract(st.t * repeat.y)));
    }
     else if(flowdirection == 4.0) {
        colorImage = texture(image, vec2(fract(-st.t * repeat.x - time), fract((st.t * repeat.y))));
    } else if(flowdirection == 5.0) {
            colorImage = texture(image, vec2(fract(st.t * repeat.x - time), fract((st.t * repeat.y))));
    } 
    else {
        colorImage = texture(image, st);
    }
    if(colorImage.r > 0.0 || colorImage.g > 0.0) {
        // material.diffuse = colorImage.rgb + 1.0 / (time * 100.0);
        material.diffuse = colorImage.rgb * color.rgb;
        material.alpha = colorImage.a;
    } else {
        material.diffuse = colorImage.rgb * color.rgb;
        material.alpha = color.a;
    }
    return material;
}`},translucent:e=>{return e.uniforms.color.alpha<1}}),this.material=Cesium.Material.fromType(this.type)}};var Ts=class{constructor(e={}){this.type=Cesium.defaultValue(e.type,"AgFlowWater"),this.normalMap=Cesium.defaultValue(e.normalMap,Cesium.Material.DefaultImageId),this.baseWaterColor=Cesium.defaultValue(e.baseWaterColor,new Cesium.Color(.2,.3,.6,1)),this.blendColor=Cesium.defaultValue(e.blendColor,new Cesium.Color(0,1,.699,1)),this.frequency=Cesium.defaultValue(e.frequency,10),this.animationSpeed=Cesium.defaultValue(e.animationSpeed,.01),this.amplitude=Cesium.defaultValue(e.amplitude,1),this.specularIntensity=Cesium.defaultValue(e.specularIntensity,.5),this.fadeFactor=Cesium.defaultValue(e.fadeFactor,1),this.flowdirection=Cesium.defaultValue(e.flowdirection,5),Cesium.Material._materialCache.getMaterial(this.type)||Cesium.Material._materialCache.addMaterial(this.type,{fabric:{type:this.type,uniforms:{normalMap:this.normalMap,baseWaterColor:this.baseWaterColor,blendColor:this.blendColor,frequency:this.frequency,animationSpeed:this.animationSpeed,amplitude:this.amplitude,specularIntensity:this.specularIntensity,fadeFactor:this.fadeFactor,flowdirection:this.flowdirection},source:`uniform sampler2D normalMap;
uniform vec4 baseWaterColor;
uniform vec4 blendColor;
uniform float frequency;
uniform float animationSpeed;
uniform float amplitude;
uniform float specularIntensity;
uniform float fadeFactor;
uniform float flowdirection;

float private_getSpecularOfMaterial(vec3 lightDirectionEC, vec3 toEyeEC, vec3 normalEC, float shininess) {
    //return czm_getSpecular(lightDirectionEC, toEyeEC, normal, shininess);
    vec3 toReflectedLight = reflect(-lightDirectionEC, normalEC);
    float specular = max(dot(toReflectedLight, toEyeEC), 0.000000001);
    // pow has undefined behavior if both parameters <= 0.
    // Prevent this by making sure shininess is at least czm_epsilon2.
    return pow(specular, shininess);
}
czm_material czm_getMaterial(czm_materialInput materialInput) {
    czm_material material = czm_getDefaultMaterial(materialInput);

    float time = czm_frameNumber * animationSpeed;

    // fade is a function of the distance from the fragment and the frequency of the waves
    float fade = max(1.0, (length(materialInput.positionToEyeEC) / 10000000000.0) * frequency * fadeFactor);

    //float specularMapValue = texture(specularMap, materialInput.st).r;
    //计算高光
    float specularMapValue = private_getSpecularOfMaterial(czm_sunDirectionEC, materialInput.positionToEyeEC, materialInput.normalEC, 0.0001);
    //specularMapValue = min(specularMapValue, 0.8);
    //specularMapValue = fract((specularMapValue ));
    vec2 st = materialInput.st;
    // note: not using directional motion at this time, just set the angle to 0.0;
    // vec4 noise = czm_getWaterNoise(normalMap, materialInput.st * frequency, time, 0.0);
    //设置流向
    vec4 noise;
    if(flowdirection == 0.0) {
        noise = czm_getWaterNoise(normalMap, vec2(fract((st.s - time)), st.t) * frequency, time, 0.0);
    } else if(flowdirection == 1.0) {
        noise = czm_getWaterNoise(normalMap, -vec2(fract((st.s + time)), st.t) * frequency, time, 0.0);
    } else if(flowdirection == 2.0) {
        noise = czm_getWaterNoise(normalMap, vec2(st.s, fract((st.t - time))) * frequency, time, 0.0);
    } else if(flowdirection == 3.0) {
        noise = czm_getWaterNoise(normalMap, -vec2(st.s, fract((st.t + time))) * frequency, time, 0.0);
    } else {
        noise = czm_getWaterNoise(normalMap, st * frequency, time, 0.0);
    }
    vec3 normalTangentSpace = noise.xyz * vec3(1.0, 1.0, (1.0 / amplitude));

    // fade out the normal perturbation as we move further from the water surface
    normalTangentSpace.xy /= fade;

    // attempt to fade out the normal perturbation as we approach non water areas (low specular map value)
    normalTangentSpace = mix(vec3(0.0, 0.0, 50.0), normalTangentSpace, specularMapValue);

    normalTangentSpace = normalize(normalTangentSpace);

    // get ratios for alignment of the new normal vector with a vector perpendicular to the tangent plane
    float tsPerturbationRatio = clamp(dot(normalTangentSpace, vec3(0.0, 0.0, 1.0)), 0.0, 1.0);

    // fade out water effect as specular map value decreases
    material.alpha = mix(blendColor.a, baseWaterColor.a, specularMapValue) * specularMapValue;

    // base color is a blend of the water and non-water color based on the value from the specular map
    // may need a uniform blend factor to better control this
    material.diffuse = mix(blendColor.rgb, baseWaterColor.rgb, specularMapValue);

    // diffuse highlights are based on how perturbed the normal is
    material.diffuse += (0.1 * tsPerturbationRatio);

    material.diffuse = material.diffuse;

    material.normal = normalize(materialInput.tangentToEyeMatrix * normalTangentSpace);

    material.specular = specularIntensity;
    material.shininess = 10.0;
    // material.emission = vec3(0.5);

    return material;
}
`},translucent:e=>{e=e.uniforms;return e.baseWaterColor.alpha<1||e.blendColor.alpha<1}}),this.material=Cesium.Material.fromType(this.type)}};var Ls=class{constructor(e={}){this.type=Cesium.defaultValue(e.type,"AgLightMaterial1114444"),this.color=Cesium.defaultValue(e.color,new Cesium.Color(1,1,1,1)),this.image=Cesium.defaultValue(e.image,Cesium.Material.DefaultImageId),this.repeat=Cesium.defaultValue(e.repeat,new Cesium.Cartesian2(1,1)),this.dynamicTime=Cesium.defaultValue(e.dynamicTime,0),this.visiableDistance=Cesium.defaultValue(e.visiableDistance,200),this.intensity=Cesium.defaultValue(e.intensity,1),Cesium.Material._materialCache.getMaterial(this.type)||Cesium.Material._materialCache.addMaterial(this.type,{fabric:{type:this.type,uniforms:{color:this.color,image:this.image,repeat:this.repeat,intensity:this.intensity,visiableDistance:this.visiableDistance,dynamicTime:this.dynamicTime},source:`uniform float time;
uniform sampler2D image;
uniform vec4 color;
uniform vec2 repeat;
uniform float intensity;
uniform float visiableDistance;
czm_material czm_getMaterial(czm_materialInput materialInput) {
    czm_material material = czm_getDefaultMaterial(materialInput);
    vec2 st = materialInput.st;
    vec4 colorImage; 
    colorImage = texture(image, vec2(fract(st.s * repeat.x), fract(st.t * repeat.y)));
    float _intensity = intensity;
    if (_intensity > 1.0) {
      _intensity = 1.0;
    }
     //是否启用动态光照
    //  if(dynamicTime == 1.0){
    //   if (czm_globeTime.x >= 6.0&& czm_globeTime.x <= 19.0) {
    //     _intensity = 0.0;
    //   } else {
    //    // _intensity = 1.0 ; 
    //   }
    //  }
    if(czm_lightIntensity > 0.6){
      discard;
    }
    
    vec3 fragToCameraVector = materialInput.positionToEyeEC;
    float distance = length(fragToCameraVector);
    float visiableFactor = clamp(((visiableDistance-distance)/visiableDistance),0.0,1.0);
    material.diffuse = color.rgb * _intensity * visiableFactor;
    material.emission = colorImage.rgb;
    // material.diffuse = color.rgb * _intensity * visiableFactor;
    // material.emission = color.rgb;
    material.alpha = colorImage.a * _intensity * visiableFactor;
    return material;
}`}}),this.material=Cesium.Material.fromType(this.type)}destroyed(){}};var Ds=class{constructor(e={}){this.type=Cesium.defaultValue(e.type,"AgCreateSparklyMaterial"),Cesium.Material._materialCache.getMaterial(this.type)||Cesium.Material._materialCache.addMaterial(this.type,{fabric:{type:this.type,uniforms:{},source:`

float Hash31(in vec3 p) {
    return fract(937.276 * cos(836.826 * p.x + 263.736 * p.y + 374.723 * p.z + 637.839));
}

vec3 mainImage(  vec2 uv,float iTime) {
   
   float time = iTime * 2.0;
   vec3 color = vec3(0.0);
   uv-=0.5;
   uv*=4.0;
   for (float i=-3.0; i <= 3.0; i += 1.25) {
       for (float j=-2.0; j <= 2.0; j += 1.25) {
           vec2 p = uv;

           float freq = fract(643.376 * cos(264.863 * i + 136.937)) + 1.0;
           vec2 pos = 5.0 * vec2(i, j) + vec2(sin(freq * (iTime + 10.0 * j) - i), freq * iTime);
           pos.y = mod(pos.y + 15.0, 30.0) - 15.0;
           pos.x *= 0.1 * pos.y + 1.0;
           p -= 0.2 * pos;

           float an = mod(atan(p.y, p.x) + 6.2831 / 3.0, 6.2831 / 6.0) - 6.2831 / 3.0;
           p = vec2(cos(an), sin(an)) * length(p);

           float sec = floor(time);
           float frac = fract(time);
           float flicker = mix(Hash31(vec3(i, j, sec)), Hash31(vec3(i, j, sec + 1.0)), frac);

           float rad = 25.0 + 20.0 * flicker;
           float br = 250.0 * pow(1.0 / max(10.0, rad * (sqrt(abs(p.x)) + sqrt(abs(p.y))) + 0.9), 2.5);
           float rand = fract(847.384 * cos(483.846 * i + 737.487 * j + 264.836));
           if (rand > 0.5) color += mix(vec3(br, 0.4 * br, 0.0), vec3(1.0), br);
           else color += mix(vec3(0.0, 0.0, 0.6 * br), vec3(1.0), br);

           color *= 0.955 + 0.1 * flicker;
       }
   }

 return color;
}



czm_material czm_getMaterial(czm_materialInput materialInput) {
   czm_material material = czm_getDefaultMaterial(materialInput);
   vec2 st = materialInput.st;
   float time = czm_frameNumber / 200.0;
   material.diffuse =  mainImage(st,time); 
   return material;
}
`}}),this.material=Cesium.Material.fromType(this.type)}};var Fs=class{constructor(e={}){this.type=Cesium.defaultValue(e.type,"AgCreateStarfieldMaterial"),Cesium.Material._materialCache.getMaterial(this.type)||Cesium.Material._materialCache.addMaterial(this.type,{fabric:{type:this.type,uniforms:{},source:`

#define FORTY_FIVE_DEGREES acos(-1.) / 4.
#define SPACE_PURPLE vec3(0.409, 0.157, 0.567)
#define WHITE vec3(1.0)
#define ZOOM_OUT 6.8

mat2 Rotate(float angle)
{
	float c = cos(angle), s = sin(angle);
    return mat2(c, -s, s, c); 
}

// Random number between 0 and 1
float Random(vec2 seed)
{
    seed = fract(seed * vec2(123.34, 456.21));
	seed += dot(seed, seed + 632.39);
    return fract(seed.x * seed.y);
}


float Star(vec2 pos, float glow, float size)
{
    float d = length(pos);
    float res = 0.01 / d;
	
    float rays = max(0., 1.0 - abs(pos.x * pos.y) * 1000.) * glow * 0.3 * size;
	pos *= Rotate(FORTY_FIVE_DEGREES);
    rays += max(0., 5. - abs(pos.x * pos.y) * 100000.) * glow * .2;
    res += rays;
        
    // Fade the star light with distance
    res *= smoothstep(1., .3, d) * size;
    
    return res;
}

// Remaps the global uv coord to cell uv coord
vec2 Remap(vec2 pos, float rand, float origin)
{
	vec2 pos_in_cell = fract(pos) - origin;
    vec2 id = floor(pos); // get the id of the cell
    pos_in_cell -= vec2(rand, fract(rand * 34.));
    
    return pos_in_cell;
}

float LayoutStars(vec2 pos)
{
    float res = 0.;
    vec2 id = floor(pos);
	for (int y = -4; y <= 4; ++y)
    {
    	for (int x = -4; x <= 4; ++x)
        {
            vec2 neighbor_id = vec2(x, y); // Adds neighboring star contribution
        	float rand = Random(id + neighbor_id);
            res += Star(Remap(pos, rand, 0.7) - neighbor_id,
                        rand * .3,
                       	rand * 2.5);
        }
    }
    
    return res;
}

vec3 mainImage(  vec2 uv,float iTime) {
   
    float time = iTime * 2.0;
    uv *= ZOOM_OUT;
    vec3 col = SPACE_PURPLE * .3;
    vec2 id = floor(uv);
    float randP = Random(cos(vec2(iTime)));
    col += LayoutStars(uv)* (randP * SPACE_PURPLE + WHITE);
    
    return col;
}

czm_material czm_getMaterial(czm_materialInput materialInput) {
   czm_material material = czm_getDefaultMaterial(materialInput);
   vec2 st = materialInput.st;
   float time = czm_frameNumber / 200.0;
   material.diffuse =  mainImage(st,time); 
   return material;
}
`}}),this.material=Cesium.Material.fromType(this.type)}};var Ns=class{constructor(e={}){this.type=Cesium.defaultValue(e.type,"AgCreateMagmaMaterial"),Cesium.Material._materialCache.getMaterial(this.type)||Cesium.Material._materialCache.addMaterial(this.type,{fabric:{type:this.type,uniforms:{},source:`

float rand(vec2 n) {
    return fract(cos(dot(n, vec2(5.9898, 4.1414))) * 65899.89956);
}


float noise( in vec2 n )
{
    const vec2 d = vec2(0.0, 1.0);
    vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));
    return mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);
}

float fbm(vec2 n) {
    float total = 0.0;
    float amplitude = 1.0;
    for (int i = 0; i < 4; i++){
        total += noise(n) * amplitude;
        n += n;
        amplitude *= 0.51;
    }
    return total;
}

//void mainImage( out vec4 fragColor, in vec2 fragCoord ) {
vec3 mainImage(  vec2 uv,float iTime) {
   
    uv *= 17.5;
    
     vec3 col1 = vec3(0.5, 0.0, 0.1);
     vec3 col2 = vec3(0.9, 0.3, 0.1);
     vec3 col3 = vec3(0.0, 0.0, 0.0);
     vec3 col4 = vec3(1.0, 0.9, 0.6);
     vec3 col5 = vec3(0.1, 0.4, 0.8);
     vec3 col6 = vec3(1.155);

    vec2 speed = vec2(0.35, 0.35);

    vec2 nfbm = vec2( uv.x, uv.y - rand(vec2(1., 5.)));
    float q = fbm(nfbm);
    vec2 arg1 = vec2(uv + q +  iTime* speed.x -uv.x -uv.y);
    vec2 arg2 = vec2 (uv + q - rand(vec2(100., 100.)) * speed.y);
    vec2 r = vec2(fbm(arg1 ), fbm(arg2));

    vec2 agr3 = vec2(uv + r);
    vec3 c = mix(col1, col2, fbm(agr3)) + mix(col3, col4, r.x) - mix(col5, col6, r.y);

    return c;
}


czm_material czm_getMaterial(czm_materialInput materialInput) {
   czm_material material = czm_getDefaultMaterial(materialInput);
   vec2 st = materialInput.st;
   float time = czm_frameNumber / 200.0;
   material.diffuse =  mainImage(st,time); 
   return material;
}
`}}),this.material=Cesium.Material.fromType(this.type)}},Os=__webpack_require__(7156);let{Cartesian2:Rs,Color:Us,defaultValue:ks,defined:Hs,Event:Qs,createPropertyDescriptor:Vs,Property:P}=Cesium;const Gs=new Rs(1,1),zs=Us.WHITE;function Ws(e){e=ks(e,ks.EMPTY_OBJECT),this.type=e.type||"AgDiffuseMaterial",e.type=this.type,Cesium.Material._materialCache.getMaterial(this.type)||new Ms(e),this._definitionChanged=new Qs,this._diffuseImage=void 0,this._diffuseImageSubscription=void 0,this._repeat=void 0,this._repeatSubscription=void 0,this._color=void 0,this._colorSubscription=void 0,this._transparent=void 0,this._transparentSubscription=void 0,this._normalImage=void 0,this._strength=void 0,this._hue=void 0,this._saturation=void 0,this._brightness=void 0,this._contrast=void 0,this.strength=Cesium.defaultValue(e.strength,.8),this.hue=Cesium.defaultValue(e.hue,0),this.saturation=Cesium.defaultValue(e.saturation,0),this.brightness=Cesium.defaultValue(e.brightness,0),this.contrast=Cesium.defaultValue(e.contrast,0),this.diffuseImage=Cesium.defaultValue(e.diffuseImage,Cesium.Material.DefaultImageId),this.normalImage=Cesium.defaultValue(e.normalImage,Cesium.Material.DefaultImageId),this.repeat=Cesium.defaultValue(e.repeat,Gs),this.color=Cesium.defaultValue(e.color,zs),this.transparent=e.transparent}Object.defineProperties(Ws.prototype,{isConstant:{get:function(){return P.isConstant(this._diffuseImage)&&P.isConstant(this._normalImage)&&P.isConstant(this._strength)&&P.isConstant(this._hue)&&P.isConstant(this._saturation)&&P.isConstant(this._brightness)&&P.isConstant(this._contrast)&&P.isConstant(this._repeat)}},definitionChanged:{get:function(){return this._definitionChanged}},diffuseImage:Vs("diffuseImage"),repeat:Vs("repeat"),color:Vs("color"),transparent:Vs("transparent"),normalImage:Vs("normalImage"),strength:Vs("strength"),hue:Vs("hue"),saturation:Vs("saturation"),brightness:Vs("brightness"),contrast:Vs("contrast")}),Ws.prototype.getType=function(e){return this.type},Ws.prototype.getValue=function(e,t){return(t=Hs(t)?t:{}).diffuseImage=P.getValueOrUndefined(this._diffuseImage,e),t.normalImage=P.getValueOrUndefined(this._normalImage,e),t.repeat=P.getValueOrClonedDefault(this._repeat,e,Gs,t.repeat),t.color=P.getValueOrClonedDefault(this._color,e,zs,t.color),P.getValueOrDefault(this._transparent,e,!1)&&(t.color.alpha=Math.min(.99,t.color.alpha)),t.strength=P.getValueOrClonedDefault(this._strength,e,.8,t.strength),t.hue=P.getValueOrClonedDefault(this._hue,e,0,t.hue),t.saturation=P.getValueOrClonedDefault(this._saturation,e,0,t.saturation),t.brightness=P.getValueOrClonedDefault(this._brightness,e,0,t.brightness),t.contrast=P.getValueOrClonedDefault(this._contrast,e,0,t.contrast),t},Ws.prototype.equals=function(e){return this===e||e instanceof Ws&&P.equals(this._diffuseImage,e._diffuseImage)&&P.equals(this._normalImage,e._normalImage)&&P.equals(this._repeat,e._repeat)&&P.equals(this._color,e._color)&&P.equals(this._transparent,e._transparent)&&P.equals(this._strength,e._strength)&&P.equals(this._hue,e._hue)&&P.equals(this._saturation,e._saturation)&&P.equals(this._brightness,e._brightness)&&P.equals(this._contrast,e._contrast)};var qs=Ws;let Ks=Cesium.defaultValue;Cesium.createPropertyDescriptor,Cesium.Property;class js{constructor(e){e=Ks(e,Ks.EMPTY_OBJECT),this.type=e.type||"AgCreateDotMaterial",e.type=this.type,Cesium.Material._materialCache.getMaterial(this.type)||new Is(e),this._definitionChanged=new Cesium.Event,this._color=Cesium.Color.WHITE}}Object.defineProperties(js.prototype,{}),js.prototype.getType=function(e){return this.type},js.prototype.getValue=function(e,t){return t=Cesium.defined(t)?t:{}},js.prototype.equals=function(e){return this===e||e instanceof js};var Zs=js;let Ys=Cesium.defaultValue;an=Cesium.createPropertyDescriptor;let T=Cesium.Property;class Xs{constructor(e){e=Ys(e,Ys.EMPTY_OBJECT),this.type=e.type||"AgDynamicColor",e.type=this.type,Cesium.Material._materialCache.getMaterial(this.type)||new Ss(e),this._definitionChanged=new Cesium.Event,this._color=Cesium.Color.WHITE,this._time=0,this._duration=1500,this.color=Ys(e.color,this._color),this.time=this._time,this.duration=Ys(e.duration,this._duration),this._image=Cesium.Material.DefaultImageId,this.image=Ys(e.image,this._image),this._repeat=new Cesium.Cartesian2(1,1),this.repeat=Ys(e.repeat,this._repeat)}}Object.defineProperties(Xs.prototype,{isConstant:{get:function(){return T.isConstant(this._color)&&T.isConstant(this._time)&&T.isConstant(this._duration)&&T.isConstant(this._repeat)}},definitionChanged:{get:function(){return this._definitionChanged}},color:an("color"),time:an("time"),repeat:an("repeat"),duration:an("duration"),image:an("image")}),Xs.prototype.getType=function(e){return this.type},Xs.prototype.getValue=function(e,t){return(t=Cesium.defined(t)?t:{}).duration=T.getValueOrClonedDefault(this._duration,e,1500,t.duration),t.repeat=T.getValueOrClonedDefault(this._repeat,e,new Cesium.Cartesian2(1,1),t.repeat),t.image=T.getValueOrClonedDefault(this._image,e,Cesium.Material.DefaultImageId,t.image),t.time=((new Date).getTime()-this._time)%this.duration/this.duration,t.color=T.getValueOrClonedDefault(this._color,e,Cesium.Color.WHITE,t.color),t},Xs.prototype.equals=function(e){return this===e||e instanceof Xs&&T.equals(this._time,e._time)&&T.equals(this._color,e._color)&&T.equals(this._duration,e._duration)&&T.equals(this._image,e._image)&&T.equals(this._repeat,e._repeat)};var Js=Xs;let $s=Cesium.defaultValue;ln=Cesium.createPropertyDescriptor;let F=Cesium.Property;class ea{constructor(e){e=$s(e,$s.EMPTY_OBJECT),this.type=e.type||"AgFlowMaterial",e.type=this.type,Cesium.Material._materialCache.getMaterial(this.type)||new Ps(e),this._definitionChanged=new Cesium.Event,this._color=Cesium.Color.WHITE,this._time=0,this._image=Cesium.Material.DefaultImageId,this._duration=1500,this._repeat=new Cesium.Cartesian2(1,1),this.color=$s(e.color,this._color),this.time=this._time,this.duration=$s(e.duration,this._duration),this.image=$s(e.image,this._image),this.repeat=$s(e.repeat,this._repeat),this._flowdirection=0,this.flowdirection=$s(e.flowdirection,this._flowdirection)}}Object.defineProperties(ea.prototype,{isConstant:{get:function(){return F.isConstant(this._color)&&F.isConstant(this._time)&&F.isConstant(this._duration)&&F.isConstant(this._image)&&F.isConstant(this._repeat)&&F.isConstant(this._flowdirection)}},definitionChanged:{get:function(){return this._definitionChanged}},color:ln("color"),time:ln("time"),qq:ln("qq"),duration:ln("duration"),image:ln("image"),repeat:ln("repeat"),flowdirection:ln("flowdirection")}),ea.prototype.getType=function(e){return this.type},ea.prototype.getValue=function(e,t){return(t=Cesium.defined(t)?t:{}).duration=F.getValueOrClonedDefault(this._duration,e,1500,t.duration),t.flowdirection=F.getValueOrClonedDefault(this._flowdirection,e,0,t.flowdirection),t.image=F.getValueOrClonedDefault(this._image,e,Cesium.Material.DefaultImageId,t.image),t.repeat=F.getValueOrClonedDefault(this._repeat,e,new Cesium.Cartesian2(1,1),t.repeat),t.time=((new Date).getTime()-this._time)%this.duration/this.duration,t.color=F.getValueOrClonedDefault(this._color,e,Cesium.Color.WHITE,t.color),t},ea.prototype.equals=function(e){return this===e||e instanceof ea&&F.equals(this._time,e._time)&&F.equals(this._color,e._color)&&F.equals(this._duration,e._duration)&&F.equals(this._image,e._image)&&F.equals(this._repeat,e._repeat)&&F.equals(this._flowdirection,e._flowdirection)};var ta=ea;let ia=Cesium.defaultValue;un=Cesium.createPropertyDescriptor;let N=Cesium.Property;const ra=Cesium.Color.WHITE;class na{constructor(e){e=ia(e,ia.EMPTY_OBJECT),this.type=e.type||"AgLightMaterial1114444",e.type=this.type,Cesium.Material._materialCache.getMaterial(this.type)||new Ls(e),this._definitionChanged=new Cesium.Event,this._color=Cesium.Color.WHITE,this.color=Cesium.defaultValue(e.color,this._color),this._image=Cesium.Material.DefaultImageId,this.image=Cesium.defaultValue(e.image,this._image),this._intensity=1,this.intensity=Cesium.defaultValue(e.intensity,this._intensity),this._visiableDistance=200,this.visiableDistance=Cesium.defaultValue(e.visiableDistance,this._visiableDistance),this._dynamicTime=0,this.dynamicTime=Cesium.defaultValue(e.dynamicTime,this._dynamicTime)}}Object.defineProperties(na.prototype,{isConstant:{get:function(){return N.isConstant(this._color)&&N.isConstant(this._image)&&N.isConstant(this._intensity)&&N.isConstant(this._visiableDistance)&&N.isConstant(this._dynamicTime)}},definitionChanged:{get:function(){return this._definitionChanged}},color:un("color"),image:un("image"),intensity:un("intensity"),visiableDistance:un("visiableDistance"),dynamicTime:un("dynamicTime")}),na.prototype.getType=function(e){return this.type},na.prototype.getValue=function(e,t){return(t=Cesium.defined(t)?t:{}).color=N.getValueOrClonedDefault(this._color,e,ra,t.color),t.image=N.getValueOrClonedDefault(this._image,e,Cesium.Material.DefaultImageId,t.image),t.intensity=N.getValueOrClonedDefault(this._intensity,e,0,t.intensity),t.visiableDistance=N.getValueOrClonedDefault(this._visiableDistance,e,0,t.visiableDistance),t.dynamicTime=N.getValueOrClonedDefault(this._dynamicTime,e,0,t.dynamicTime),t},na.prototype.equals=function(e){return this===e||e instanceof na&&N.equals(this._color,e._color)&&N.equals(this._image,e._image)&&N.equals(this._intensity,e._intensity)&&N.equals(this._visiableDistance,e._visiableDistance)&&N.equals(this._dynamicTime,e._dynamicTime)};var oa=na;let sa=Cesium.defaultValue;Cesium.createPropertyDescriptor,Cesium.Property;class aa{constructor(e){e=sa(e,sa.EMPTY_OBJECT),this.type=e.type||"AgCreateSparklyMaterial",e.type=this.type,Cesium.Material._materialCache.getMaterial(this.type)||new Ds(e),this._definitionChanged=new Cesium.Event,this._color=Cesium.Color.WHITE}}Object.defineProperties(aa.prototype,{}),aa.prototype.getType=function(e){return this.type},aa.prototype.getValue=function(e,t){return t=Cesium.defined(t)?t:{}},aa.prototype.equals=function(e){return this===e||e instanceof aa};var la=aa;let ua=Cesium.defaultValue;Cesium.createPropertyDescriptor,Cesium.Property;class ca{constructor(e){e=ua(e,ua.EMPTY_OBJECT),this.type=e.type||"AgCreateStarfieldMaterial",e.type=this.type,Cesium.Material._materialCache.getMaterial(this.type)||new Fs(e),this._definitionChanged=new Cesium.Event,this._color=Cesium.Color.WHITE}}Object.defineProperties(ca.prototype,{}),ca.prototype.getType=function(e){return this.type},ca.prototype.getValue=function(e,t){return t=Cesium.defined(t)?t:{}},ca.prototype.equals=function(e){return this===e||e instanceof ca};var ha=ca,Aa=__webpack_require__(1696);var pa=class{constructor(e={}){this.type=Cesium.defaultValue(e.type,"AgLineFlowMaterial"),this.color=Cesium.defaultValue(e.color,new Cesium.Color(1,0,0,1)),this.speed=Cesium.defaultValue(e.speed,10),this.percent=Cesium.defaultValue(e.percent,.1),this.gradient=Cesium.defaultValue(e.gradient,.01),Cesium.Material._materialCache.getMaterial(this.type)||Cesium.Material._materialCache.addMaterial(this.type,{fabric:{type:this.type,uniforms:{color:this.color,speed:this.speed,percent:this.percent,gradient:this.gradient},source:`
    uniform vec4 color;
    uniform float speed;
    uniform float percent;
    uniform float gradient;

    czm_material czm_getMaterial(czm_materialInput materialInput){
    czm_material material = czm_getDefaultMaterial(materialInput);
    vec2 st = materialInput.st;
    float t =fract(czm_frameNumber * speed / 1000.0);
    t *= (1.0 + percent);
    float alpha = smoothstep(t- percent, t, st.s) * step(-t, -st.s);
    alpha += gradient;
    material.diffuse = color.rgb;
    material.alpha = alpha;
    return material;
    }
`},translucent:function(e){return!0}}),this.material=Cesium.Material.fromType(this.type)}};class fa{constructor(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.type=e.type||"AgLineFlowMaterialType",e.type=this.type,Cesium.Material._materialCache.getMaterial(this.type)||new pa(e),this._definitionChanged=new Cesium.Event,this._color=new Cesium.Color(1,0,0,1),this.color=Cesium.defaultValue(e.color,this._color),this._speed=10,this.speed=Cesium.defaultValue(e.speed,this._speed),this._percent=.1,this.percent=Cesium.defaultValue(e.percent,.1),this._gradient=.01,this.gradient=Cesium.defaultValue(e.gradient,.01)}}Object.defineProperties(fa.prototype,{isConstant:{get:function(){return Cesium.Property.isConstant(this._color)&&Cesium.Property.isConstant(this._speed)&&Cesium.Property.isConstant(this._percent)&&Cesium.Property.isConstant(this._gradient)}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium.createPropertyDescriptor("color"),speed:Cesium.createPropertyDescriptor("speed"),percent:Cesium.createPropertyDescriptor("percent"),gradient:Cesium.createPropertyDescriptor("gradient")}),fa.prototype.getType=function(e){return this.type},fa.prototype.getValue=function(e,t){return(t=Cesium.defined(t)?t:{}).color=Cesium.Property.getValueOrClonedDefault(this._color,e,Cesium.Color.RED,t.color),t.speed=Cesium.Property.getValueOrClonedDefault(this._speed,e,5,t.speed),t.percent=Cesium.Property.getValueOrClonedDefault(this._percent,e,.1,t.percent),t.gradient=Cesium.Property.getValueOrClonedDefault(this._gradient,e,.01,t.gradient),t},fa.prototype.equals=function(e){return this===e||e instanceof fa&&Cesium.Property.equals(this._color,e._color)&&Cesium.Property.equals(this._speed,e._speed)&&Cesium.Property.equals(this._percent,e._percent)&&Cesium.Property.equals(this._gradient,e._gradient)};var da=fa;var ga=class{constructor(e={}){this.type=Cesium.defaultValue(e.type,"AgCircleSpiralMaterial"),this.color=Cesium.defaultValue(e.color,Cesium.Color.YELLOW),this.speed=Cesium.defaultValue(e.speed,12),Cesium.Material._materialCache.getMaterial(this.type)||Cesium.Material._materialCache.addMaterial(this.type,{fabric:{type:this.type,uniforms:{color:this.color,speed:this.speed},source:`
uniform vec4 color;
uniform float speed;
#define PI 3.14159265359

vec2 rotate2D (vec2 _st, float _angle) {
_st =  mat2(cos(_angle),-sin(_angle),  sin(_angle),cos(_angle)) * _st;
return _st;
}
czm_material czm_getMaterial(czm_materialInput materialInput){
czm_material material = czm_getDefaultMaterial(materialInput);
vec2 st = materialInput.st * 2.0 - 1.0;
st *= 1.6;
float time = czm_frameNumber * speed / 1000.0;
float r = length(st);
float w = .3;
st = rotate2D(st,(r*PI*6.-time*2.));
float a = smoothstep(-w,.2,st.x) * smoothstep(w,.2,st.x);
float b = abs(1./(sin(pow(r,2.)*2.-time*1.3)*6.))*.4;
material.alpha = a * b ;
material.diffuse = color.rgb * a * b  * 3.0;
return material;
}
`},translucent:function(e){return!0}}),this.material=Cesium.Material.fromType(this.type)}};class ma{constructor(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.type=e.type||"AgCircleSpiralMaterial",e.type=this.type,Cesium.Material._materialCache.getMaterial(this.type)||new ga(e),this._definitionChanged=new Cesium.Event,this._color=new Cesium.Color(1,0,0,1),this.color=Cesium.defaultValue(e.color,this._color),this._speed=12,this.speed=Cesium.defaultValue(e.speed,this._speed)}}Object.defineProperties(ma.prototype,{isConstant:{get:function(){return Cesium.Property.isConstant(this._color)&&Cesium.Property.isConstant(this._speed)}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium.createPropertyDescriptor("color"),speed:Cesium.createPropertyDescriptor("speed")}),ma.prototype.getType=function(e){return this.type},ma.prototype.getValue=function(e,t){return(t=Cesium.defined(t)?t:{}).color=Cesium.Property.getValueOrClonedDefault(this._color,e,Cesium.Color.RED,t.color),t.speed=Cesium.Property.getValueOrClonedDefault(this._speed,e,5,t.speed),t},ma.prototype.equals=function(e){return this===e||e instanceof ma&&Cesium.Property.equals(this._color,e._color)&&Cesium.Property.equals(this._speed,e._speed)};var ya=ma;var _a=class{constructor(e={}){this.type=Cesium.defaultValue(e.type,"AgCircleColorfulMaterial"),this.color=Cesium.defaultValue(e.color,Cesium.Color.YELLOW),this.speed=Cesium.defaultValue(e.speed,12),Cesium.Material._materialCache.getMaterial(this.type)||Cesium.Material._materialCache.addMaterial(this.type,{fabric:{type:this.type,uniforms:{color:this.color,speed:this.speed},source:`
uniform vec4 color;
uniform float speed;

czm_material czm_getMaterial(czm_materialInput materialInput){
czm_material material = czm_getDefaultMaterial(materialInput);
vec2 st = materialInput.st  * 2.0 - 1.0;
float time =czm_frameNumber * speed / 1000.0;
float radius = length(st);
float angle = atan(st.y/st.x);
float radius1 = sin(time * 2.0) + sin(40.0*angle+time)*0.01;
float radius2 = cos(time * 3.0);
vec3 fragColor = 0.2 + 0.5 * cos( time + color.rgb + vec3(0,2,4));
float inten1 = 1.0 - sqrt(abs(radius1 - radius));
float inten2 = 1.0 - sqrt(abs(radius2 - radius));
material.alpha = pow(inten1 + inten2 , 5.0) ;
material.diffuse = fragColor * (inten1 + inten2);
return material;
}`},translucent:function(e){return!0}}),this.material=Cesium.Material.fromType(this.type)}};class va{constructor(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.type=e.type||"AgCircleColorfulMaterialType",e.type=this.type,Cesium.Material._materialCache.getMaterial(this.type)||new _a(e),this._definitionChanged=new Cesium.Event,this._color=new Cesium.Color(1,0,0,1),this.color=Cesium.defaultValue(e.color,this._color),this._speed=12,this.speed=Cesium.defaultValue(e.speed,this._speed)}}Object.defineProperties(va.prototype,{isConstant:{get:function(){return Cesium.Property.isConstant(this._color)&&Cesium.Property.isConstant(this._speed)}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium.createPropertyDescriptor("color"),speed:Cesium.createPropertyDescriptor("speed")}),va.prototype.getType=function(e){return this.type},va.prototype.getValue=function(e,t){return(t=Cesium.defined(t)?t:{}).color=Cesium.Property.getValueOrClonedDefault(this._color,e,Cesium.Color.RED,t.color),t.speed=Cesium.Property.getValueOrClonedDefault(this._speed,e,10,t.speed),t},va.prototype.equals=function(e){return this===e||e instanceof va&&Cesium.Property.equals(this._color,e._color)&&Cesium.Property.equals(this._speed,e._speed)};var Ca=va;var wa=class{constructor(e={}){this.type=Cesium.defaultValue(e.type,"AgEllipsoidElectricMaterial"),this.color=Cesium.defaultValue(e.color,Cesium.Color.YELLOW),this.speed=Cesium.defaultValue(e.speed,12),Cesium.Material._materialCache.getMaterial(this.type)||Cesium.Material._materialCache.addMaterial(this.type,{fabric:{type:this.type,uniforms:{color:this.color,speed:this.speed},source:`
uniform vec4 color;
uniform float speed;

#define pi 3.1415926535
#define PI2RAD 0.01745329252
#define TWO_PI (2. * PI)

float rands(float p){
return fract(sin(p) * 10000.0);
}

float noise(vec2 p){
float time = fract( czm_frameNumber * speed / 1000.0);
float t = time / 20000.0;
if(t > 1.0) t -= floor(t);
return rands(p.x * 14. + p.y * sin(t) * 0.5);
}

vec2 sw(vec2 p){
return vec2(floor(p.x), floor(p.y));
}

vec2 se(vec2 p){
return vec2(ceil(p.x), floor(p.y));
}

vec2 nw(vec2 p){
return vec2(floor(p.x), ceil(p.y));
}

vec2 ne(vec2 p){
return vec2(ceil(p.x), ceil(p.y));
}

float smoothNoise(vec2 p){
vec2 inter = smoothstep(0.0, 1.0, fract(p));
float s = mix(noise(sw(p)), noise(se(p)), inter.x);
float n = mix(noise(nw(p)), noise(ne(p)), inter.x);
return mix(s, n, inter.y);
}

float fbm(vec2 p){
float z = 2.0;
float rz = 0.0;
vec2 bp = p;
for(float i = 1.0; i < 6.0; i++){
    rz += abs((smoothNoise(p) - 0.5)* 2.0) / z;
    z *= 2.0;
    p *= 2.0;
}
return rz;
}

czm_material czm_getMaterial(czm_materialInput materialInput)
{
czm_material material = czm_getDefaultMaterial(materialInput);
vec2 st = materialInput.st;
vec2 st2 = materialInput.st;
float time = fract( czm_frameNumber * speed / 1000.0);
if (st.t < 0.5) {
    discard;
}
st *= 4.;
float rz = fbm(st);
st /= exp(mod( time * 2.0, pi));
rz *= pow(15., 0.9);
vec4 temp = vec4(0);
temp = mix( color / rz, vec4(color.rgb, 0.1), 0.2);
if (st2.s < 0.05) {
    temp = mix(vec4(color.rgb, 0.1), temp, st2.s / 0.05);
}
if (st2.s > 0.95){
    temp = mix(temp, vec4(color.rgb, 0.1), (st2.s - 0.95) / 0.05);
}
material.diffuse = temp.rgb;
material.alpha = temp.a * 2.0;
return material;
}
`},translucent:function(e){return!0}}),this.material=Cesium.Material.fromType(this.type)}};class xa{constructor(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this.type=e.type||"AgEllipsoidElectricMaterialType",e.type=this.type,Cesium.Material._materialCache.getMaterial(this.type)||new wa(e),this._definitionChanged=new Cesium.Event,this._color=new Cesium.Color(1,0,0,1),this.color=Cesium.defaultValue(e.color,this._color),this._speed=12,this.speed=Cesium.defaultValue(e.speed,this._speed)}}Object.defineProperties(xa.prototype,{isConstant:{get:function(){return Cesium.Property.isConstant(this._color)&&Cesium.Property.isConstant(this._speed)}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium.createPropertyDescriptor("color"),speed:Cesium.createPropertyDescriptor("speed")}),xa.prototype.getType=function(e){return this.type},xa.prototype.getValue=function(e,t){return(t=Cesium.defined(t)?t:{}).color=Cesium.Property.getValueOrClonedDefault(this._color,e,Cesium.Color.RED,t.color),t.speed=Cesium.Property.getValueOrClonedDefault(this._speed,e,10,t.speed),t},xa.prototype.equals=function(e){return this===e||e instanceof xa&&Cesium.Property.equals(this._color,e._color)&&Cesium.Property.equals(this._speed,e._speed)};var ba=xa;var Ea=class{constructor(e={}){this.type=Cesium.defaultValue(e.type,"AgEllipsoidFadeMaterial"),this.color=Cesium.defaultValue(e.color,Cesium.Color.YELLOW),Cesium.Material._materialCache.getMaterial(this.type)||Cesium.Material._materialCache.addMaterial(this.type,{fabric:{type:this.type,uniforms:{color:this.color,time:0},source:`
czm_material czm_getMaterial(czm_materialInput materialInput){
    czm_material material = czm_getDefaultMaterial(materialInput);
    material.diffuse = 1.5 * color.rgb;
    vec2 st = materialInput.st;
    float dis = distance(st, vec2(0.5, 0.5));
    float per = fract(time);
    if(dis > per * 0.5){
        material.alpha = 0.0;
        discard;
    }else {
        material.alpha = color.a  * dis / per / 1.0;
    }
    return material;
}
`},translucent:function(e){return!0}}),this.material=Cesium.Material.fromType(this.type)}};class Ba{constructor(e){this.type=Cesium.defaultValue(e.type,"AgEllipsoidFadeMaterialType"),e.type=this.type,Cesium.Material._materialCache.getMaterial(this.type)||new Ea(e),this._definitionChanged=new Cesium.Event,this._color=Cesium.Color.WHITE,this.color=Cesium.defaultValue(e.color,Cesium.Color.YELLOW),this._duration=1500,this.duration=Cesium.defaultValue(e.duration,this._duration),this._time=(new Date).getTime()}}Object.defineProperties(Ba.prototype,{isConstant:{get:function(){return Cesium.Property.isConstant(this._color)&&Cesium.Property.isConstant(this._duration)}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium.createPropertyDescriptor("color")}),Ba.prototype.getType=function(e){return this.type},Ba.prototype.getValue=function(e,t){return(t=Cesium.defined(t)?t:{}).color=Cesium.Property.getValueOrClonedDefault(this._color,e,Cesium.Color.WHITE,t.color),t.time=((new Date).getTime()-this._time)%this.duration/this.duration,t},Ba.prototype.equals=function(e){return this===e||e instanceof Ba&&Property.equals(this._color,e._color)};var Ma=Ba;var Ia=class{constructor(e={}){this.type=Cesium.defaultValue(e.type,"AgCircleWaveMaterial"),this.color=Cesium.defaultValue(e.color,Cesium.Color.YELLOW),Cesium.Material._materialCache.getMaterial(this.type)||Cesium.Material._materialCache.addMaterial(this.type,{fabric:{type:this.type,uniforms:{color:this.color,time:1,count:1,gradient:.1},source:`czm_material czm_getMaterial(czm_materialInput materialInput)

{

    czm_material material = czm_getDefaultMaterial(materialInput);

    material.diffuse = 1.5 * color.rgb;

    vec2 st = materialInput.st;

    vec3 str = materialInput.str;

    float dis = distance(st, vec2(0.5, 0.5));

    float per = fract(time);

    if (abs(str.z) > 0.001) {

        discard;

    }

    if (dis > 0.5) { 

        discard; 

    } else { 

        float perDis = 0.5 / count;

        float disNum; 

        float bl = .0; 

        for (int i = 0; i <= 999; i++) { 

            if (float(i) <= count) { 

                disNum = perDis * float(i) - dis + per / count; 

                if (disNum > 0.0) { 

                    if (disNum < perDis) { 

                        bl = 1.0 - disNum / perDis;

                    }

                    else if (disNum - perDis < perDis) { 

                        bl = 1.0 - abs(1.0 - disNum / perDis); 

                    } 

                    material.alpha = pow(bl, gradient); 

                } 

            } 
 
        } 
 
    } 

    return material; 

} 
`},translucent:function(e){return!0}}),this.material=Cesium.Material.fromType(this.type)}};class Sa{constructor(e){this.type=Cesium.defaultValue(e.type,"AgCircleWaveMaterialType"),e.type=this.type,Cesium.Material._materialCache.getMaterial(this.type)||new Ia(e),this._definitionChanged=new Cesium.Event,this._color=Cesium.Color.WHITE,this.color=Cesium.defaultValue(e.color,Cesium.Color.YELLOW),this._duration=1500,this.duration=Cesium.defaultValue(e.duration,this._duration),this._time=performance.now(),this._count=1,this.count=Cesium.defaultValue(e.count,this._count),this.count<=0&&(this.count=1),this._gradient=0,this.gradient=Cesium.defaultValue(e.gradient,this._gradient),this.gradient<0?this.gradient=0:1<this.gradient&&(this.gradient=1)}}Object.defineProperties(Sa.prototype,{isConstant:{get:function(){return Cesium.Property.isConstant(this._color)&&Cesium.Property.isConstant(this._duration)&&Cesium.Property.isConstant(this._count)&&Cesium.Property.isConstant(this._gradient)}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium.createPropertyDescriptor("color")}),Sa.prototype.getType=function(e){return this.type},Sa.prototype.getValue=function(e,t){return(t=Cesium.defined(t)?t:{}).color=Cesium.Property.getValueOrClonedDefault(this._color,e,Cesium.Color.WHITE,t.color),t.time=(performance.now()-this._time)/this.duration,t.count=this.count,t.gradient=1+10*(1-this.gradient),t},Sa.prototype.equals=function(e){return this===e||e instanceof Sa&&Property.equals(this._color,e._color)};var Pa=Sa;var Ta=class{constructor(e={}){this.type=Cesium.defaultValue(e.type,"AgPolylineTrailLinkMaterial"),this.color=Cesium.defaultValue(e.color,Cesium.Color.YELLOW),Cesium.Material._materialCache.getMaterial(this.type)||Cesium.Material._materialCache.addMaterial(this.type,{fabric:{type:this.type,uniforms:{color:this.color,image:Cesium.Material.PolylineTrailLinkImage,time:0},source:`czm_material czm_getMaterial(czm_materialInput materialInput)
{
     czm_material material = czm_getDefaultMaterial(materialInput);
     vec2 st = materialInput.st;
     vec4 colorImage = texture(image, vec2(fract(st.s - time), st.t));
     material.alpha = colorImage.a * color.a;
     material.diffuse = (colorImage.rgb+color.rgb)/2.0;
     return material;
 }`},translucent:function(e){return!0}}),this.material=Cesium.Material.fromType(this.type)}};class La{constructor(e){this.type=Cesium.defaultValue(e.type,"AgPolylineTrailLinkMaterialType"),e.type=this.type,Cesium.Material._materialCache.getMaterial(this.type)||new Ta(e),this._definitionChanged=new Cesium.Event,this._color=Cesium.Color.WHITE,this.color=Cesium.defaultValue(e.color,Cesium.Color.YELLOW),this._duration=1500,this.duration=Cesium.defaultValue(e.duration,this._duration),this._time=(new Date).getTime(),this._image=Cesium.Material.PolylineTrailLinkImage,this.image=Cesium.defaultValue(e.image,this._image)}}Object.defineProperties(La.prototype,{isConstant:{get:function(){return Cesium.Property.isConstant(this._color)&&Cesium.Property.isConstant(this._duration)&&Cesium.Property.isConstant(this._image)}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium.createPropertyDescriptor("color")}),La.prototype.getType=function(e){return this.type},La.prototype.getValue=function(e,t){return(t=Cesium.defined(t)?t:{}).color=Cesium.Property.getValueOrClonedDefault(this._color,e,Cesium.Color.WHITE,t.color),t.image=Cesium.Material.PolylineTrailLinkImage,t.time=((new Date).getTime()-this._time)%this.duration/this.duration,t},La.prototype.equals=function(e){return this===e||e instanceof La&&Property.equals(this._color,e._color)};var Da=La,cn=(__webpack_require__(5808),{skyBox:O,particleSystem:R,weather:U,material:k,property:H}),hn={crs:__webpack_require__(4723).Z};let Fa={softCode:"agcim-map-viewer"},Na="/agsupport-rest/agsupport/configManager/widgetAssetsTable";An=new class{add(e){var t,i={id:Number(Math.random().toString().substr(3,10)+Date.now()).toString(36),...Fa};for(t in i)e.append(t,i[t]);var r={headers:{"Content-Type":"multipart/form-data;boundary = "+(new Date).getTime()}};return Or.Z.post(Na+"/add",e,r)}update(e){var t,i={...Fa};for(t in i)e.append(t,i[t]);var r={headers:{"Content-Type":"multipart/form-data;boundary = "+(new Date).getTime()}};return Or.Z.post(Na+"/update",e,r)}delete(e){e={...Fa,...e};return Or.Z.post(Na+"/delete",{params:e})}find(e){e={...Fa,...e};return Or.Z.get(Na+"/find",{params:e})}get(e,t){return c.Z.getData(this.get_netInfo(e,t))}get_netInfo(e,t){return t=t||"agcim-map-viewer",Na+"/get?tableName="+e+"&softCode="+t}download(e){e={...Fa,...e};window.location.href=Na+`/download?softCode=${e.softCode}&tableName=${e.tableName}&id=${e.id}&fieldName=${e.fieldName}&fileName=`+e.fileName}preview(e){e={...Fa,...e};return Na+`/preview?softCode=${e.softCode}&tableName=${e.tableName}&id=${e.id}&fieldName=${e.fieldName}&fileName=`+e.fileName}},pn=__webpack_require__(2401);fn=new class{constructor(){}_saveOrUpdateWidgtTableData(e,t){return c.Z.getDataByPost(Rr.Z.saveOrUpdataAllWidgetData,{widgetLevelsId:e,widgetLevelsData:t})}async addWidgtTableData(o,e){return new Promise((i,r)=>{let n=null;this.getWidgetInfoByCode(e).then(e=>{var t;e.success?(t=e.content.widgetLevelsId,(n=""!=e.content.widgetLevelsData?JSON.parse(e.content.widgetLevelsData):[]).push(o),n=JSON.stringify(n),this._saveOrUpdateWidgtTableData(t,n).then(e=>{i(e)}).catch(e=>{r(e)})):i(null)})})}async deleteWidgtTableDataByRowDataId(o,e){return new Promise((i,r)=>{let n=null;this.getWidgetInfoByCode(e).then(e=>{var t;e.success?(t=e.content.widgetLevelsId,e=(n=JSON.parse(e.content.widgetLevelsData)).findIndex(e=>{if(e.id===o)return e}),n.splice(e,1),n=JSON.stringify(n),this._saveOrUpdateWidgtTableData(t,n).then(e=>{i(e)}).catch(e=>{r(e)})):i(null)})})}async updataWidgtTableData(o,e){return new Promise((i,r)=>{let n=null;this.getWidgetInfoByCode(e).then(e=>{var t;e.success?(t=e.content.widgetLevelsId,(n=JSON.parse(e.content.widgetLevelsData)).forEach((e,t)=>{e.id===o.id&&(n[t]=o)}),n=JSON.stringify(n),this._saveOrUpdateWidgtTableData(t,n).then(e=>{i(e)}).catch(e=>{r(e)})):i(null)})})}_getWidgetByProjectName(e){var t=Rr.Z.func_findFuncByUser;return c.Z.getData(t,{rootCode:e,code:e})}async getWidgetAllData(){return new Promise((i,t)=>{this._getWidgetByProjectName(CIM_APPLICATION_NAME).then(e=>{var t=[];e&&0<e.content.length&&this.getWidgetEachItem(e.content,t),i(t)}).catch(e=>{t(e)})})}async getOriginWidgetAllData(){return new Promise((t,i)=>{this._getWidgetByProjectName(CIM_APPLICATION_NAME).then(e=>{e&&0<e.content.length&&t(e.content)}).catch(e=>{i(e)})})}getWidgetEachItem(e,t){e.forEach(e=>{e.childrenList&&0<e.childrenList.length?this.getWidgetEachItem(e.childrenList,t):t.push(e)})}getWidgetInfoByCode(e,t=CIM_APPLICATION_NAME){return c.Z.getData(Rr.Z.findWidgetByCode,{rootCode:t,code:e})}_saveOrUpdataWidgtInfoByCode(e,t){return c.Z.getDataByPost(Rr.Z.saveOrUpdataWidgetDataByCode,{code:e,data:t})}async addWidgtInfoData(n,o){return new Promise((t,i)=>{let r=null;this.getWidgetInfoByCode(o).then(e=>{e.success?((r=""!=e.content.data?JSON.parse(e.content.data):[]).push(n),r=JSON.stringify(r),this._saveOrUpdataWidgtInfoByCode(o,r).then(e=>{t(e)}).catch(e=>{i(e)})):t(null)})})}async saveOrUpdataWidgtTableData(n,o){return new Promise((t,r)=>{this.getWidgetInfoByCode(o).then(e=>{if(e.success){let i=JSON.parse(e.content.data);i.forEach((e,t)=>{e.id===n.id&&(i[t]=n)}),i=JSON.stringify(i),this._saveOrUpdataWidgtInfoByCode(o,i).then(e=>{t(e)}).catch(e=>{r(e)})}else t(null)})})}async deleteWidgtInfoByRowDataId(n,o){return new Promise((t,i)=>{let r=null;this.getWidgetInfoByCode(o).then(e=>{e.success?(e=(r=JSON.parse(e.content.data)).findIndex(e=>{if(e.id===n)return e}),r.splice(e,1),r=JSON.stringify(r),this._saveOrUpdataWidgtInfoByCode(o,r).then(e=>{t(e)}).catch(e=>{i(e)})):t(null)})})}},gn={widgetAssetsTable:An,widgetConfigHelper:pn.Z,widgetExtendField:fn},yn={environment:{firework01:`
#define PI 3.141592653589793238
#define TWOPI 6.283185307179586
#define S(x,y,z) smoothstep(x,y,z)
#define B(x,y,z,w) S(x-z, x+z, w)*S(y+z, y-z, w)
#define saturate(x) clamp(x,0.,1.)

#define NUM_EXPLOSIONS 18.
#define NUM_PARTICLES 70.

// Noise functions by Dave Hoskins 
#define MOD3 vec3(.1031,.11369,.13787)
uniform sampler2D colorTexture;
in vec2 v_textureCoordinates;
vec3 hash31(float p) {
    vec3 p3 = fract(vec3(p) * MOD3);
    p3 += dot(p3, p3.yzx + 19.19);
    return fract(vec3((p3.x + p3.y) * p3.z, (p3.x + p3.z) * p3.y, (p3.y + p3.z) * p3.x));
}
float hash12(vec2 p) {
    vec3 p3 = fract(vec3(p.xyx) * MOD3);
    p3 += dot(p3, p3.yzx + 19.19);
    return fract((p3.x + p3.y) * p3.z);
}

float circ(vec2 uv, vec2 pos, float size) {
    uv -= pos;

    size *= size;
    return S(size * 1.1, size, dot(uv, uv));
}

float light(vec2 uv, vec2 pos, float size) {
    uv -= pos;

    size *= size;
    return size / dot(uv, uv);
}

vec3 explosion(vec2 uv, vec2 p, float seed, float t) {

    vec3 col = vec3(0.);

    vec3 en = hash31(seed);
    vec3 baseCol = en;
    for(float i = 0.; i < NUM_PARTICLES; i++) {
        vec3 n = hash31(i) - .5;

        vec2 startP = p - vec2(0., t * t * .1);
        vec2 endP = startP + normalize(n.xy) * n.z;

        float pt = 1. - pow(t - 1., 2.);
        vec2 pos = mix(p, endP, pt);
        float size = mix(.01, .005, S(0., .1, pt));
        size *= S(1., .1, pt);

        float sparkle = (sin((pt + n.z) * 100.) * .5 + .5);
        sparkle = pow(sparkle, pow(en.x, 3.) * 50.) * mix(0.01, .01, en.y * n.y);

    	//size += sparkle*B(.6, 1., .1, t);
        size += sparkle * B(en.x, en.y, en.z, t);

        col += baseCol * light(uv, pos, size);
    }

    return col;
}

vec3 Rainbow(vec3 c, float iTime) {

    float t = iTime;

    float avg = (c.r + c.g + c.b) / 3.;
    c = avg + (c - avg) * sin(vec3(0., .333, .666) + t);

    c += sin(vec3(.4, .3, .3) * t + vec3(1.1244, 3.43215, 6.435)) * vec3(.4, .1, .5);

    return c;
}

void mainImage(out vec4 fragColor) {
    vec2 iResolution = czm_viewport.zw;
    float iTime = (czm_frameNumber / 50.0);
    vec2 uv = (gl_FragCoord.xy * 2. - iResolution.xy) / min(iResolution.x, iResolution.y);
    // uv.x -= .9;
    uv.x *= iResolution.x / iResolution.y;
    uv.x *=0.5;
    float n = hash12(uv + 10.);
    float t = iTime * .5;

    vec3 c = vec3(0.);

    for(float i = 0.; i < NUM_EXPLOSIONS; i++) {
        float et = t + i * 1234.45235;
        float id = floor(et);
        et -= id;

        vec2 p = hash31(id).xy;
        p.x -= .5;
        p.x *= 1.6;
        c += explosion(uv, p, id, et);
    }
    c = Rainbow(c, iTime);
    //时间
    // float hours = czm_globeTime.x;
    // if(hours>=22.0 && hours <= 24.0){
    //     fragColor += vec4(c, 1.);
    // }
    fragColor += vec4(c, 1.);
    
}`,starts01:`
#define round(x, f) (floor((x)/(f) + 0.5) * (f))
float random(float p) {
    return fract(52.043 * sin(p * 205.429));
}
float random2(float p) {
    return random(p) * 2.0 - 1.0;
}
vec3 stars(vec2 uv) {
    vec2 iResolution = czm_viewport.zw;
    float iTime = (czm_frameNumber / 50.0);
    vec2 r = round(uv, 0.1);

    float rand = r.x * 2.32 + r.y;

    uv -= r;
    uv.x += 0.05 * random2(rand);
    uv.y += 0.05 * random2(rand + 0.541);

    float blink = random(rand + 0.5) < 0.1 ? 0.8 + 0.2 * sin(35.0 * iTime + random(rand + 1.5)) : 0.0;
    float dark = random(rand + 52.0) < 0.5 ? 1.0 : 0.3;

    return vec3(dark * max(0.0, 0.8 + blink - iResolution.y * length(uv)));
}
void mainImage(out vec4 fragColor) {
    vec2 iResolution = czm_viewport.zw;
    float iTime = (czm_frameNumber / 50.0);
    vec2 uv = (gl_FragCoord.xy * 2. - iResolution.xy) / min(iResolution.x, iResolution.y);
    vec3 c = stars(uv);
    //时间
    // float hours = czm_globeTime.x;
    // if(hours>=21.0 && hours <= 24.0){
    //     fragColor += vec4(c, 1.);
    // } 
    // if(hours>=0.0 && hours <= 5.0){
    //     fragColor += vec4(c, 1.);
    // }  
    fragColor += vec4(c, 1.);   
}
`,firework02:`
uniform sampler2D colorTexture;
in vec2 v_textureCoordinates;
vec2 hash21(float p) {
    vec3 p3 = fract(vec3(p) * vec3(.1031, .1030, .0973));
    p3 += dot(p3, p3.yzx + 33.33);
    return fract((p3.xx + p3.yz) * p3.zy);

}

vec3 hash31(float p) {
    vec3 p2 = fract(p * vec3(5.3983, 5.4427, 6.9371));
    p2 += dot(p2.zxy, p2.xyz + vec3(21.5351, 14.3137, 15.3219));
    return fract(vec3(p2.x * p2.y * 95.4337, p2.y * p2.z * 97.597, p2.z * p2.x * 93.8365));
}

vec2 dir(float id) {
    vec2 h = hash21(id);
    h.y *= 2. * acos(-1.);
    return h.x * vec2(cos(h.y), sin(h.y));
}

#define PARTICLES_MIN 20.
#define PARTICLES_MAX 200.

float bang(vec2 uv, float t, float id) {
    float o = 0.;
    if(t <= 0.) {
        return .04 / dot(uv, uv);
    }
    float s = (sqrt(t) + t * exp2(-t / .125) * .8) * 10.;
    float brightness = sqrt(1. - t) * .015 * (step(.0001, t) * .9 + .1);
    float blinkI = exp2(-t / .125);
    float PARTICLES = PARTICLES_MIN + (PARTICLES_MAX - PARTICLES_MIN) * fract(cos(id) * 45241.45);
    for(float i = 0.; i < 100.0; i++) {
        vec2 d = dir(i + .012 * id);

        vec2 p = d * s;

        vec2 h = hash21(5.33345 * i + .015 * id);
        float blink = mix(cos((t + h.x) * 10. * (2. + h.y) + h.x * h.y * 10.) * .3 + .7, 1., blinkI);

        o += blink * brightness / dot(uv - p, uv - p);
    }
    return o;
}

const float ExT = 1. / 4.;

#define duration 2.2

float firework(vec2 uv, float t, float id) {
    if(id < 1.)
        return 0.;
    vec2 h = hash21(id * 5.645) * 2. - 1.;
    vec2 offset = vec2(h.x * .1, 0.);
    h.y = h.y * .95;
    h.y *= abs(h.y);
    vec2 di = vec2(h.y, sqrt(1. - h.y * h.y));
    float thrust = sqrt(min(t, ExT) / ExT) * 25.;
    vec2 p = offset + duration * (di * thrust + vec2(0., -9.81) * t) * t;
    return sqrt(1. - t) * bang(uv - p, max(0., (t - ExT) / (1. - ExT)), id);
}

#define NUM_ROCKETS 3.

void mainImage(out vec4 fragColor) {
    vec2 iResolution = czm_viewport.zw;
    float iTime = (czm_frameNumber / 50.0);
    vec2 uv = (gl_FragCoord.xy * 2. - iResolution.xy) / min(iResolution.x, iResolution.y);
    uv.x *=0.5;
    vec3 col = vec3(.01, .011, .015) * 0.;

    float time = .75 * iTime;
    float t = time / duration;
    uv.y -= .25;
    uv *= 35.;
    float m = 1.;
    float d = 0.;

    for(float i = 0.; i < 6.0; i++) {
        float T = 1. + t + i / 30.0;

        float id = floor(T) - i / 30.0; //should give a unique integer for each rocket

        vec3 color = hash31(id * .75645);
        color /= max(color.r, max(color.g, color.b));//making colors as bright as possible

        col += firework(uv, fract(T), id) * color;
    }

    vec4 c = pow(vec4(m * col, 1.0), vec4(1. / 2.4));
    c.a = d;
    fragColor += c; 
}

`,firework03:`
uniform sampler2D colorTexture;
in vec2 v_textureCoordinates;
#define rad(x) radians(x)
#define np 50.
#define snp 40.
#define spawn 1
#define trail 1

//random value
vec2 N22(vec2 p) {
    vec3 a = fract(p.xyx * vec3(123.34, 234.34, 345.65));
    a += dot(a, a + 34.45);
    return fract(vec2(a.x * a.y, a.y * a.z));
}
float hash(vec2 uv) {
    return fract(sin(dot(uv, vec2(154.45, 64.548))) * 124.54);
}

//particle
vec3 particle(vec2 st, vec2 p, float r, vec3 col, vec2 iResolution) {
    float d = length(st - p);
    d = smoothstep(r, r - 2.0 / iResolution.y, d);//d<r?1.0:0.0;
    return d * col;
}
//particle with light
vec3 burst(vec2 st, vec2 pos, float r, vec3 col, int heart) {
    st -= pos;
    if(heart == 1)
        st.y -= sqrt(abs(st.x)) * 0.1;
    r *= 0.6 * r;
    return (r / dot(st, st)) * col * 0.6;
}

//displacement with s = p0 + ut + 0.5at^2
vec2 get_pos(vec2 u, vec2 a, vec2 p0, float t, float ang) {
    ang = rad(ang);
    vec2 d = p0 + vec2(u.x * cos(ang), u.y * sin(ang)) * t + 0.5 * a * t * t;
    return d;
}
//velocity at time t
vec2 get_velocity(vec2 u, vec2 a, float t, float ang) {
    ang = rad(ang);
    return vec2(u.x * cos(ang), u.y * sin(ang)) + a * t;
}

void mainImage(out vec4 fragColor) {
    vec2 iResolution = czm_viewport.zw;
    float iTime = (czm_frameNumber / 50.0);
    vec2 uv = (gl_FragCoord.xy * 2. - iResolution.xy) / min(iResolution.x, iResolution.y);
   
    uv.y -= .45;
    float aspect = iResolution.x / iResolution.y;
    vec3 col = vec3(0.0);
    float t = mod(iTime, 10.);

    //particle
    float r = 0.04;
    vec2 u = vec2(5.); //init velocity
    vec2 a = vec2(0.0, -9.8); //acc due to gravity
    float ang = 75.0; //angle of projection

    vec3 p1 = vec3(0.0); //particle

    for(float i = 0.; i < 50.; i++) {
        vec2 rand = N22(vec2(i));
        vec2 ip = vec2(sin(15. * rand.x) * aspect, -1. + r); //initial pos
        u = vec2(sin(5. * rand.x), 5. + sin(4. * rand.y)); //initial velocity
        float t1 = t - i / 5.;
        vec2 s = get_pos(u, a, ip, t1, ang); // displacement
        vec2 v = get_velocity(u, a, t1, ang);
        float Tf = 2.0 * u.y * sin(rad(ang)) / abs(a.y); //time of flight
        vec2 H = get_pos(u, a, ip, Tf / 2.0, ang); //max height

        vec3 pcol = vec3(sin(22. * rand.x), sin(5. * rand.y), sin(1. * rand.x)); //color per particle

        if(v.y < -0.5) {
            //p1+= burst(uv, H, max(0.0, 0.1-(t1*t1-Tf*0.5)), pcol*0.5, 1 );
            r = 0.0; //die
        }
        p1 += burst(uv, s, r, pcol, 0); //main particle

        //trail particle
        if(trail == 1) {
            for(float k = 4.0; k > 0.0; k--) {
                vec2 strail = get_pos(u, a, ip, t1 - (k * 0.02), ang); //delay for trail particles
                p1 += burst(uv, strail, v.y < -0.5 ? 0.0 : r - (k * 0.006), pcol, 0);
            }
        }

        //spawn
        if(v.y <= 0.0 && t1 >= Tf / 2.0 && spawn == 1) {
            for(float j = 0.0; j < 40.; j++) {
                vec2 rand2 = N22(vec2(j));
                float ang2 = (j * (360. / 40.));
                r = 0.035; // radius of spawned particles
                r -= (t1 - Tf * 0.5) * 0.04;
                //r/=(t-(Tf/2.)+0.2);

                float x = cos(rad(ang2)); //coords of unit circle 
                float y = sin(rad(ang2));

                y = y + abs(x) * sqrt((8. - abs(x)) / 50.0); // heart shape as a function of j

                vec2 heart = vec2(x * x + y * y) * (0.4 / (t1 * sqrt(t1))); //velocity vector
                vec2 S = get_pos(heart, a * 0.03, H, t1 - (Tf / 2.), ang2);
                pcol = vec3(sin(8. * rand2.x), sin(6. * rand2.y), sin(2. * rand2.x)); // color per spawn particle
                p1 += burst(uv, S, max(0.0, r), pcol, 0);

            }
        }

    }

    //bg
    float stars = pow(hash(uv), 200.) * 0.5;
    col = p1;
    vec3 night = vec3(0.06, 0.02, 0.18) * vec3(uv.y * 0.5 + 0.5);   
    col += night * (1.0 - p1);
    //col = vec3(light(uv, vec2(0.0), 0.1));
    fragColor += vec4(col, 1.0);   
}

`,fireflies01:`
# define radius 0.003
# define sphere_Counts 300.0
float N21(vec2 p) {
	vec3 a = fract(vec3(p.xyx) * vec3(213.897, 653.453, 253.098));
    a += dot(a, a.yzx + 79.76);
    return fract((a.x + a.y) * a.z);
}

vec2 N22(vec2 p){
    float n = N21(p);
    return vec2(n,N21(n+p));
}

void mainImage( out vec4 fragColor )
{
    //vec2 uv = fragCoord/(iResolution.xy /2.0)-1.0;
    vec2 iResolution = czm_viewport.zw;
    //iResolution.x *= 0.9;
    float iTime = (czm_frameNumber / 250.0);
    vec2 coor=gl_FragCoord.xy;
    coor.y*=2.7;
    coor.x*=2.0;
    vec2 uv = (coor - iResolution.xy) / min(iResolution.x, iResolution.y);
	uv.x *= (iResolution.x/iResolution.y)*0.5;
    
    vec3 pointLight;
    for (float i=0.0; i<sphere_Counts; i+=1.0)
    {
        vec2 rnd = N22(vec2(i,i*2.0));
    	vec2 point = vec2(cos(iTime*rnd.x+i)*2.0,sin(iTime*rnd.y+i));
    	float distanceToPoint = distance(uv, point);
    	pointLight += vec3(radius/distanceToPoint)*vec3(sin(iTime+i)/2.5+0.7);
    }
    pointLight *= vec3(0.3,0.3,0.0);
    
    /*
    vec3 pointLight2;
    for (float i=60.0; i<80.0;i+=1.0)
    {
        vec2 rnd = N22(vec2(i,i+2.0));
    	vec2 point = vec2(cos(iTime*rnd.x+i)*1.5,sin(iTime*rnd.y+i));
    	float distanceToPoint = distance(uv, point);
    	pointLight2 += vec3(radius/distanceToPoint) * vec3(clamp(sin(iTime+i)/2.0+0.6,0.1,1.0));
    }
    pointLight2 *= vec3(0.8,0.8,0.0);
   	pointLight += pointLight2;
    */
    
    fragColor += vec4(pointLight,1.0);
}



`,starts02:`
float hash( const in float n ) {
	return fract(sin(n)*4378.5453);
}

float pnoise(in vec3 o) 
{
	vec3 p = floor(o);
	vec3 fr = fract(o);
		
	float n = p.x + p.y*57.0 + p.z * 1009.0;

	float a = hash(n+  0.0);
	float b = hash(n+  1.0);
	float c = hash(n+ 57.0);
	float d = hash(n+ 58.0);
	
	float e = hash(n+  0.0 + 1009.0);
	float f = hash(n+  1.0 + 1009.0);
	float g = hash(n+ 57.0 + 1009.0);
	float h = hash(n+ 58.0 + 1009.0);
	
	
	vec3 fr2 = fr * fr;
	vec3 fr3 = fr2 * fr;
	
	vec3 t = 3.0 * fr2 - 2.0 * fr3;
	
	float u = t.x;
	float v = t.y;
	float w = t.z;

	// this last bit should be refactored to the same form as the rest :)
	float res1 = a + (b-a)*u +(c-a)*v + (a-b+d-c)*u*v;
	float res2 = e + (f-e)*u +(g-e)*v + (e-f+h-g)*u*v;
	
	float res = res1 * (1.0- w) + res2 * (w);
	
	return res;
}

const mat3 m = mat3( 0.00,  0.80,  0.60,
                    -0.80,  0.36, -0.48,
                    -0.60, -0.48,  0.64 );

float SmoothNoise( vec3 p )
{
    float f;
    f  = 0.5000*pnoise( p ); p = m*p*2.02;
    f += 0.2500*pnoise( p ); 
	
    return f * (1.0 / (0.5000 + 0.2500));
}

// 2D rotation function
mat2 rot2D(float a) {
	return mat2(cos(a),sin(a),-sin(a),cos(a));	
}

vec3 getStars1(in vec3 from, in vec3 dir, int levels, float power) 
{
	vec3 color=vec3(0.0);
	vec3 st = (dir * 2.+ vec3(0.3,2.5,1.25)) * .3;
	for (int i = 0; i < 1; i++) st = abs(st) / dot(st,st) - .9;
    float star = min( 1., pow( min( 5., length(st) ), 3. ) * .0025 )*1.5;

   	vec3 randc = vec3(SmoothNoise( dir.xyz*10.0*float(levels) ), SmoothNoise( dir.xzy*10.0*float(levels) ), SmoothNoise( dir.yzx*10.0*float(levels) ));
	color += star * randc;

	return pow(color*2.25, vec3(power));
}
vec3 getStars2(in vec3 from, in vec3 dir, int levels, float power) 
{
	vec3 color=vec3(0.0);
	vec3 st = (dir * 2.+ vec3(0.3,2.5,1.25)) * .3;
	for (int i = 0; i < 2; i++) st = abs(st) / dot(st,st) - .9;
    float star = min( 1., pow( min( 5., length(st) ), 3. ) * .0025 )*1.5;

   	vec3 randc = vec3(SmoothNoise( dir.xyz*10.0*float(levels) ), SmoothNoise( dir.xzy*10.0*float(levels) ), SmoothNoise( dir.yzx*10.0*float(levels) ));
	color += star * randc;

	return pow(color*2.25, vec3(power));
}
vec3 getStars3(in vec3 from, in vec3 dir, int levels, float power) 
{
	vec3 color=vec3(0.0);
	vec3 st = (dir * 2.+ vec3(0.3,2.5,1.25)) * .3;
	for (int i = 0; i < 3; i++) st = abs(st) / dot(st,st) - .9;
    float star = min( 1., pow( min( 5., length(st) ), 3. ) * .0025 )*1.5;

   	vec3 randc = vec3(SmoothNoise( dir.xyz*10.0*float(levels) ), SmoothNoise( dir.xzy*10.0*float(levels) ), SmoothNoise( dir.yzx*10.0*float(levels) ));
	color += star * randc;

	return pow(color*2.25, vec3(power));
}
vec3 getStars4(in vec3 from, in vec3 dir, int levels, float power) 
{
	vec3 color=vec3(0.0);
	vec3 st = (dir * 2.+ vec3(0.3,2.5,1.25)) * .3;
	for (int i = 0; i < 17; i++) st = abs(st) / dot(st,st) - .9;
    float star = min( 1., pow( min( 5., length(st) ), 3. ) * .0025 )*1.5;

   	vec3 randc = vec3(SmoothNoise( dir.xyz*10.0*float(levels) ), SmoothNoise( dir.xzy*10.0*float(levels) ), SmoothNoise( dir.yzx*10.0*float(levels) ));
	color += star * randc;

	return pow(color*2.25, vec3(power));
}
void mainImage(out vec4 fragColor) {
    vec2 iResolution = czm_viewport.zw;
    float iTime = (czm_frameNumber / 50.0);
    vec2 uv = (gl_FragCoord.xy * 2. - iResolution.xy) / min(iResolution.x, iResolution.y);
    uv.x *= (iResolution.x/iResolution.y)*1.5;
    
    vec2 uvo=(uv-.5)*2.;
	vec2 oriuv=uv;
	uv=uv*2.-1.;
	uv.y*=iResolution.y/iResolution.x;
	uv.y-=.03;

	vec3 dir=normalize(vec3(uv,.8));


    
    dir = normalize(dir);
	vec3 from=vec3(0.0);
    vec3 color=clamp(getStars1(from, dir, 1, 0.5) * 1.5, 0.0, 1.0) * vec3(0.0, 0.0, 1.0);
	vec3 color2=clamp(getStars2(from, -dir, 2, 0.5) * 0.9, 0.0, 1.0) * vec3(1.0, 0.0, 0.0);
    vec3 color3=clamp(getStars3(from, -dir, 3, 0.5) * 0.7, 0.0, 1.0) * vec3(1.0, 1.0, 0.0);
    
    vec3 colorStars=clamp(getStars4(from, dir, 17, 0.9), 0.0, 1.0);
    color = color + colorStars;
	color = clamp(color,vec3(0.0),vec3(1.0));
    color = pow(color, vec3(1.2));
	fragColor = vec4(color,1.);
    
}
`,night01:`
#define PI 3.1416
#define SKY_COLOR vec3(0.027, 0.151, 0.354)
#define LIGHT_SKY vec3(0.45, 0.61, 0.98)
#define STAR_COLOR vec3(0.92, 0.92, 0.14)
#define STAR_COLOR2 vec3(1.0, 1.0, 1.0)
#define MOON_COLOR vec3(0.81, 0.81, 0.81)


float noise11(float p) {
	return fract(sin(p*633.1847) * 9827.95);
}
    
float noise21(vec2 p) {
	return fract(sin(p.x*827.221 + p.y*3228.8275) * 878.121);
}

vec2 noise22(vec2 p) {
	return fract(vec2(sin(p.x*9378.35), sin(p.y*75.589)) * 556.89);
}


float cosineInterpolation(float a, float b, float x) {
    float ft = x * PI;
    float f = (1. - cos(ft)) * .5;
    return a * (1. - f) + b * f;
}

float smoothNoise11(float p, float dist) {
    float prev = noise11(p-dist);
    float next = noise11(p+dist);
       
    return cosineInterpolation(prev, next, .5);
}

float smoothNoise21(vec2 uv, float cells) {
	vec2 lv = fract(uv*cells);
    vec2 id = floor(uv*cells);
    
    //smoothstep function: maybe change it later!
    lv = lv*lv*(3.-2.*lv);
    
    float bl = noise21(id);
    float br = noise21(id+vec2(1.,0.));
    float b = mix(bl, br, lv.x);
    
    float tl = noise21(id+vec2(0.,1.));
    float tr = noise21(id+vec2(1.,1.));
    float t = mix(tl, tr, lv.x);
    
    return mix(b, t, lv.y);
}

vec2 smoothNoise22(vec2 uv, float cells) {
	vec2 lv = fract(uv*cells);
    vec2 id = floor(uv*cells);
    
    //smoothstep function: maybe change it later!
    lv = lv*lv*(3.-2.*lv);
    
    vec2 bl = noise22(id);
    vec2 br = noise22(id+vec2(1.,0.));
    vec2 b = mix(bl, br, lv.x);
    
    vec2 tl = noise22(id+vec2(0.,1.));
    vec2 tr = noise22(id+vec2(1.,1.));
    vec2 t = mix(tl, tr, lv.x);
    
    return mix(b, t, lv.y);
}


float valueNoise11(float p) {
	float c = smoothNoise11(p, 0.5);
    c += smoothNoise11(p, 0.25)*.5;
    c += smoothNoise11(p, 0.125)*.25;
    c += smoothNoise11(p, 0.0625)*.125;
    
    return c /= .875;
}

float valueNoise21(vec2 uv) {
	float c = smoothNoise21(uv, 4.);
    c += smoothNoise21(uv, 8.)*.5;
    c += smoothNoise21(uv, 16.)*.25;
    c += smoothNoise21(uv, 32.)*.125;
    c += smoothNoise21(uv, 64.)*.0625;
    
    return c /= .9375;
}

vec2 valueNoise22(vec2 uv) {
	vec2 c = smoothNoise22(uv, 4.);
    c += smoothNoise22(uv, 8.)*.5;
    c += smoothNoise22(uv, 16.)*.25;
    c += smoothNoise22(uv, 32.)*.125;
    c += smoothNoise22(uv, 64.)*.0625;
    
    return c /= .9375;
}

vec3 point(vec2 p, vec2 uv, vec3 color, float size, float blur) {
	float dist = distance(p, uv);  
    return color*smoothstep(size, size*(0.999-blur), dist);
}

float mapInterval(float x, float a, float b, float c, float d) {
	return (x-a)/(b-a) * (d-c) + c;
}

float blink(float time, float timeInterval) {
    float halfInterval = timeInterval / 2.0;
    //Get relative position in the bucket
    float p = mod(time, timeInterval);
    
    if (p <= timeInterval / 2.) {
    	return smoothstep(0., 1., p/halfInterval);
    } else {
        return smoothstep(1., 0., (p-halfInterval)/halfInterval);
    }
}

vec3 sampleBumps(vec2 p, vec2 uv, float radius) {
	float dist = distance(p, uv);
    
    if (dist < radius) {
    	return vec3((1.-valueNoise21(uv*10.))*.1);
    }
    return vec3(0.); 
}

//获取月亮的uv坐标
vec3 getMoonPosition(){
    vec4 moonClipCoordinates =   czm_projection * czm_view * czm_moonRotation * vec4(czm_moonPositionWC, 1.0);
    moonClipCoordinates.xyz /= moonClipCoordinates.w;
    vec3 moonWindowCoordinates = (czm_viewportTransformation * vec4(moonClipCoordinates.xyz, 1.0)).xyz;
    return moonWindowCoordinates;
}

void mainImage(out vec4 fragColor) {
    vec2 iResolution = czm_viewport.zw;
    float iTime = (czm_frameNumber / 50.0);
 
    vec2 uv = gl_FragCoord.xy/iResolution.xy;
    vec2 ouv = uv;
    uv -= .5;
    uv.x *= iResolution.x/iResolution.y;
    uv*=2.0;

    vec2 iMouse = czm_iMouse;
    vec2 mouse = iMouse.xy / iResolution.xy;
    float time = iTime + mouse.x*10.;
        
    //vec3 col = vec3(0.0);
    //float m = valueNoise21(uv);    
	vec3 col = mix(LIGHT_SKY, SKY_COLOR, ouv.y+.6);
    
    col *= .65 + (1.-ouv.y);
    
    //Add clouds
    vec2 timeUv = uv;
    timeUv.x += time*.1;
    timeUv.y += valueNoise11(timeUv.x+.352)*.01;
    float cloud = valueNoise21(timeUv);
    col += cloud*.1;
    
    //Add stars in the top part of the scene
    float timeInterval = 5.;
    float timeBucket = floor(time / timeInterval);
    
    // Moon
    //vec2 moonPosition = vec2(-0.2, 0.65);
    vec2 moonPosition = getMoonPosition().xy;
    moonPosition = moonPosition/iResolution.xy;
    moonPosition -= .5;
    moonPosition.x *= iResolution.x/iResolution.y;
    moonPosition*=2.0;

    //moonPosition  = (moonPosition * 2. - iResolution.xy) / iResolution;


    col += point(moonPosition, uv, MOON_COLOR, 0.15, 0.3);
    // Moon bumps
    col += sampleBumps(moonPosition, uv, 0.12);
    
    for (float i = 0.; i < 25.; i++) {
	    vec2 starPosition = vec2(i/10., i/10.);
        
        starPosition.x = mapInterval(valueNoise11(timeBucket + i*827.913)-.4, 0., 1., -0.825, 0.825);
        starPosition.y = mapInterval(valueNoise11(starPosition.x)-.3, 0., 1., -0.445, 0.445);
	    
        float starIntensity = blink(time, timeInterval);
        //Hide stars that are behind the moon
        if (distance(starPosition, moonPosition) > 0.14) {
        	col += point(starPosition, uv*0.50, STAR_COLOR, 0.001, 0.0)*clamp(starIntensity-.1, 0.0, 1.0)*10.0;
        	col += point(starPosition, uv*0.50, STAR_COLOR2, 0.009, 3.5)*starIntensity*3.0;
        }
    }
  //col = vec3(blink(time, timeInterval));
    
    // Output to screen
    fragColor = vec4(col,1.0);
}

`,starts03:`
float random(vec2 fv, float d1, float d2, float r) {
    return fract(sin(dot(fv, vec2(d1, d2))) * r);
}
void mainImage(out vec4 fragColor) {
    vec2 iResolution = czm_viewport.zw;
    float iTime = (czm_frameNumber / 50.0);
    vec2 uv = (gl_FragCoord.xy * 2. - iResolution.xy) / min(iResolution.x, iResolution.y);
    vec2 sv = uv + iTime * .0005;
    
    vec2 iv = floor(sv * 500.0);
    vec2 iv2 = floor(sv * 300.0);
    vec2 iv3 = floor(sv * 400.0);
    
    vec3 cell_noise1 = vec3(random(iv, 12.0, 80.0, 4000.0));
    vec3 cell_noise2 = vec3(random(iv2, 12.333, 13.0, 5000.0));
    vec3 cell_noise3 = vec3(random(iv3, 90.4325, 12.0, 2000.0));
    vec3 cell_noise = ((cell_noise1 + cell_noise2 + cell_noise3) * .3333 - .9) * 10.0;
    
    vec2 fv_s = uv * 20.0;
    vec2 fv = fract(vec2(fv_s.x + sin(iTime * .005) * 10.0, fv_s.y + cos(iTime * .005) * 10.0) * .5);
    vec3 circle = vec3(1.0 - smoothstep(length(fv - .25), .0, (sin(uv.x * 40.0) * cos(uv.y * 50.0)) * .015));
    

    fragColor += vec4(circle + clamp(cell_noise, .0, 1.0),1.0);
}

`,night02:`

#define PI 3.1415
#define S(x,y,z) smoothstep(x,y,z)
#define B(x,y,z,b) S(x, x+b, z)*S(y+b, y, z)
#define saturate(x) clamp(x,0.,1.)

#define MOD3 vec3(.1031,.11369,.13787)

#define MOONPOS vec2(1.0, .0)

//  1 out, 2 in...
float hash12(vec2 p) {
	vec3 p3  = fract(vec3(p.xyx) * MOD3);
    p3 += dot(p3, p3.yzx + 19.19);
    return fract((p3.x + p3.y) * p3.z);
}

vec4 gradient(vec2 uv,vec2 moonP) {
    
	float c = 1.-length(moonP-uv)/1.4;
    
    vec4 col = vec4(c);
    
    return col;
}

float circ(vec2 uv, vec2 pos, float radius, float blur) {
	float dist = length(uv-pos);
    return S(radius+blur, radius-blur, dist);
}

vec4 moon(vec2 uv,vec2 moonP) {
   	float c = circ(uv, moonP, .07, .001);
    
    c *= 1.-circ(uv, moonP+vec2(.03), .07, .001)*.95;
    c = saturate(c);
    
    vec4 col = vec4(c);
    col.rgb *=.8;
    
    return col;
}

vec4 moonglow(vec2 uv, float foreground,vec2 moonP) {
    
   	float c = circ(uv, moonP, 0.1, .2);
    
    vec4 col = vec4(c);
    col.rgb *=.8;
    
    return col;
}

float stars(vec2 uv, float t) {
    t*=3.;
    
    float n1 = hash12(uv*10000.);
    float n2 = hash12(uv*11234.);
    float alpha1 = pow(n1, 20.);
    float alpha2 = pow(n2, 20.);
    
    float twinkle = sin((uv.x-t+cos(uv.y*20.+t))*10.);
    twinkle *= cos((uv.y*.234-t*3.24+sin(uv.x*12.3+t*.243))*7.34);
    twinkle = (twinkle + 1.)/2.;
    return alpha1 * alpha2 * twinkle;
}
//获取月亮的uv坐标
vec3 getMoonPosition(){
    vec4 moonClipCoordinates =   czm_projection * czm_view * czm_moonRotation * vec4(czm_moonPositionWC, 1.0);
    moonClipCoordinates.xyz /= moonClipCoordinates.w;
    vec3 moonWindowCoordinates = (czm_viewportTransformation * vec4(moonClipCoordinates.xyz, 1.0)).xyz;
    return moonWindowCoordinates;
}
void mainImage(out vec4 fragColor) {
    vec2 iResolution = czm_viewport.zw;
    float iTime = (czm_frameNumber / 50.0);
    vec2 uv = (gl_FragCoord.xy * 2. - iResolution.xy) / min(iResolution.x, iResolution.y);
    // vec2 uv = gl_FragCoord.xy / iResolution.xy; // cesium官方window to  [0,1] uv
    //    uv -= vec2(0.5);
    //    uv.y /= iResolution.x / iResolution.y;

    vec2 bgUV = uv*vec2(iResolution.x/iResolution.y, 1.);

    bgUV.x *=0.5;
    bgUV.x +=0.2;
    float t = iTime*.05;

    //获取屏幕坐标
    vec2 moonP = getMoonPosition().xy;
    vec2 moonUV  = (moonP * 2. - iResolution.xy) / iResolution;//min(iResolution.x, iResolution.y); 长方形的UV
    // vec2 moonUV  = moonP / iResolution; // cesium官方window to  [0,1] uv


    vec4 col = gradient(bgUV,moonUV)*.4;
    col += moon(bgUV,moonUV); //月牙
    col += stars(uv, t);
         
    col += moonglow(bgUV, 1.,moonUV); //月圆
    col = saturate(col);
    
    // vec4 foreground = landscape(uv, .02, t, 3., .0, -0.04, 1., .1);
    // foreground.rgb *= vec3(.1, .1, .2)*.5;
    
    // col = mix(col, foreground, foreground.a);
    
    fragColor += vec4(col);
  
}

`,lightning01:`
float hash(float x)
{
	return fract(21654.6512 * sin(385.51 * x));
}

float hash(vec2 p)
{
	return fract(1654.65157 * sin(15.5134763 * p.x + 45.5173247 * p.y+ 5.21789));
}

vec2 hash2(vec2 p)
{
	return vec2(hash(p*.754),hash(1.5743*p+4.5476351));
}
vec2 add = vec2(1.0, 0.0);

vec2 noise2(vec2 x)
{
    vec2 p = floor(x);
    vec2 f = fract(x);
    f = f*f*(3.0-2.0*f);
    
    vec2 res = mix(mix( hash2(p),          hash2(p + add.xy),f.x),
                    mix( hash2(p + add.yx), hash2(p + add.xx),f.x),f.y);
    return res;
}

vec2 fbm2(vec2 x)
{
    vec2 r = vec2(0.0);
    float a = 1.0;
    
    for (int i = 0; i < 8; i++)
    {
        r += noise2(x) * a;
        x *= 2.;
        a *= .5;
    }
     
    return r;
}


float dseg( vec2 ba, vec2 pa )
{
	
	float h = clamp( dot(pa,ba)/dot(ba,ba), -0.2, 1. );	
	return length( pa - ba*h );
}



void mainImage(out vec4 fragColor) {
    vec2 iResolution = czm_viewport.zw;
    float iTime = (czm_frameNumber / 100.0);
  
	
	vec2 p = 2.*gl_FragCoord.xy/iResolution.yy-1.;
    vec2 d;
    vec2 tgt = vec2(1., -1.);
    float c=0.;
    if(p.y>=0.)
        c= (1.-(fbm2((p+.2)*p.y+.1*iTime)).x)*p.y;
	else 
        c = (1.-(fbm2(p+.2+.1*iTime)).x)*p.y*p.y;
	vec3 col=vec3(0.),col1 = c*vec3(.3,.5,1.);
    float mdist = 100000.;
    
    float t = hash(floor(5.*iTime));
    tgt+=4.*hash2(tgt+t)-1.5;
    if(hash(t+2.3)>.6)
	for (int i=0; i<100; i++) {
		
		vec2 dtgt = tgt-p;		
		d = .05*(vec2(-.5, -1.)+hash2(vec2(float(i), t)));
        float dist =dseg(d,dtgt);
		mdist = min(mdist,dist);
		tgt -= d;
		c=exp(-.5*dist)+exp(-125.*mdist);
        col=c*vec3(.7,.8,1.);
	}
    col+=col1;
	fragColor += vec4(col, 0.0);
}


`,lightning02:`
float rand(float x)
{
    return fract(sin(x)*75154.32912);
}

float rand3d(vec3 x)
{
    return fract(375.10297 * sin(dot(x, vec3(103.0139,227.0595,31.05914))));
}

float noise(float x)
{
    float i = floor(x);
    float a = rand(i), b = rand(i+1.);
    float f = x - i;
    return mix(a,b,f);
}

float perlin(float x)
{
    float r=0.,s=1.,w=1.;
    for (int i=0; i<6; i++) {
        s *= 2.0;
        w *= 0.5;
        r += w * noise(s*x);
    }
    return r;
}

float noise3d(vec3 x)
{
    vec3 i = floor(x);
    float i000 = rand3d(i+vec3(0.,0.,0.)), i001 = rand3d(i+vec3(0.,0.,1.));
    float i010 = rand3d(i+vec3(0.,1.,0.)), i011 = rand3d(i+vec3(0.,1.,1.));
    float i100 = rand3d(i+vec3(1.,0.,0.)), i101 = rand3d(i+vec3(1.,0.,1.));
    float i110 = rand3d(i+vec3(1.,1.,0.)), i111 = rand3d(i+vec3(1.,1.,1.));
    vec3 f = x - i;
    return mix(mix(mix(i000,i001,f.z), mix(i010,i011,f.z), f.y),
               mix(mix(i100,i101,f.z), mix(i110,i111,f.z), f.y), f.x);
}

float perlin3d(vec3 x)
{
    float r = 0.0;
    float w = 1.0, s = 1.0;
    for (int i=0; i<5; i++) {
        w *= 0.5;
        s *= 2.0;
        r += w * noise3d(s * x);
    }
    return r;
}

float f(float y)
{
    float w = 0.4; // width of strike
    return w * (perlin(2. * y) - 0.5);
}

float plot(vec2 p, float d, bool thicker)
{
    if (thicker) d += 5. * abs(f(p.y + 0.001) - f(p.y));
    return smoothstep(d, 0., abs(f(p.y) - p.x));
}

float cloud(vec2 uv, float speed, float scale, float cover,float iTime)
{
    float c = perlin3d(vec3(uv * scale, iTime * speed * 2.));
    return max(0., c - (1. - cover));
}

float mountain(vec2 uv, float scale, float offset, float h1, float h2)
{
    float h = h1 + perlin(scale*uv.x + offset) * (h2 - h1);
    return smoothstep(h, h+0.01, uv.y);
}

vec3 render(vec2 uv,float iTime)
{
    float x = iTime + 0.1;

    float m = 0.25; // max duration of strike
    float i = floor(x/m);
    float f = x/m - i;
    float k = 0.4; // frequency of strikes
    float n = noise(i);
    float t = ceil(n-k); // occurrence
    float d = max(0., n-k) / (1.-k); // duration
    float o = ceil(t - f - (1. - d)); // occurrence with duration
    float gt = 0.1; // glare duration
    float go = ceil(t - f - (1. - gt)); // glare occurrence
    
    float lightning = 0.;
    float light = 0.;
    float glare = 0.;
    
    if (o == 1.) {
        vec2 uv2 = uv;
        uv2.y += i * 2.; // select type of lightning
        float p = (noise(i+10.) - 0.5) * 2.; // position of lightning
        uv2.x -= p;
        
        float strike = plot(uv2, 0.01, true);
        float glow = plot(uv2, 0.04, false);
        float glow2 = plot(uv2, 1.5, false);

        lightning = strike * 0.2 + glow * 0.15;

        float h = noise(i+5.); // height
        lightning *= smoothstep(h, h+0.05, uv.y + perlin(1.2*uv.x + 4.*h)*0.03);
        lightning += glow2 * 0.3;
        light = smoothstep(5., 0., abs(uv.x - p));
        glare = go * light;
    }
    
    vec3 clouds =
        vec3(0.5,0.7,1.) * mix(0.6, 0.9, cloud(uv, 0.2, 0.1, 1.0,iTime)) +
        vec3(0.7,0.8,1.) * 0.6 * cloud(uv*vec2(0.5,1.), 0.06, 0.8, 0.8,iTime) +
        vec3(0.9,0.9,1.) * 0.3 * cloud(uv*vec2(0.1,1.), 0.08, 5.5, 0.6,iTime) +
        vec3(1.,1.,1.) * 0.4 * cloud(uv*vec2(0.1,1.), 0.07, 10., 0.5,iTime);
    
    // float horizon = mountain(uv, 0.8, 9., 0.3, 0.6);
    // vec3 terrain = mix(vec3(0.25,0.3,0.3)*0.5, 1.5*vec3(0.15,0.2,0.3),
    //     1. - (1. - mountain(uv, 0.8, 3., 0.2, 0.4)) * 0.5 - 
    //     (1. - mountain(uv, 0.8, 17.5, 0.05, 0.25)) * 0.5);
    
    // vec3 background = mix(terrain, clouds, horizon);
    vec3 background = clouds;
    background *= (0.2 + light * 0.5);
    
    return vec3(background + lightning + glare);
}

// void mainImage( out vec4 fragColor, in vec2 fragCoord )
// {
	// vec2 uv = fragCoord.xy / iResolution.xy;
    // uv.x = 2. * uv.x - 1.;
    // uv.x *= iResolution.x / iResolution.y;
void mainImage(out vec4 fragColor) { 
    vec2 iResolution = czm_viewport.zw;
    float iTime = (czm_frameNumber / 100.0);
    vec2 uv = (gl_FragCoord.xy * 2. - iResolution.xy) / min(iResolution.x, iResolution.y);
    uv.x *=1.5;
	fragColor += vec4(render(uv,iTime),1.0);
}

`,cloud01:`
/**
 Trying to whip up some noise that might work on clouds and such. 
 Well I guess almost any noise works with clouds. But still :)
*/
float cloudyNoise(vec2 uv)
{
    float sx = cos(500. * uv.x);
    float sy = sin(500. * uv.y);
    sx = mix(sx, cos(uv.y * 1000.), .5);
    sy = mix(sy, sin(uv.x * 1000.), .5);
    
    vec2 b = (vec2(sx, sy));
    vec2 bn = normalize(b);

    vec2 _b = b;
	b.x = _b.x * bn.x - _b.y * bn.y;
    b.y = _b.x * bn.y + _b.y * bn.x; 
    vec2 l = uv - vec2(sin(b.x), cos(b.y));
    return length(l - b) - 0.5;
}

float cloudyFbm(vec2 uv)
{
    float f = 0.0;
    vec2 _uv = uv;
    vec2 rotator = (vec2(.91, 1.5));
    
    for (int i = 0; i < 5; ++i)
    {
        vec2 tmp = uv;
        uv.x = tmp.x * rotator.x - tmp.y * rotator.y; 
        uv.y = tmp.x * rotator.y + tmp.y * rotator.x; 
        f += .5 * cloudyNoise(uv) * pow(0.5, float(i + 1));
    }
    return f;
}

float clouds (vec2 uv,float iTime)
{
    float T = iTime * .001;

	float x = 0.0;
    x += cloudyFbm( 0.5 * uv + vec2(.1,  -.01) * T) * 0.5;
    x += cloudyFbm( 1.0 * uv + vec2(.12,  .03) * T) * 0.5 * 0.5;
 	x += cloudyFbm( 2.0 * uv + vec2(.15, -.02) * T) * 0.5 * 0.5 * 0.5;
 	x += cloudyFbm( 4.0 * uv + vec2(.2,   .01) * T) * 0.5 * 0.5 * 0.5 * 0.5;
 	x += cloudyFbm( 8.0 * uv + vec2(.15, -.01) * T) * 0.5 * 0.5 * 0.5 * 0.5 * 0.5;
	
    x = smoothstep(0.0, .6, x);
    float f = 0.6;
	x = (x - f) / (1.0 - f);
    float _x = x;    
    x = smoothstep(0.4, 0.55, x);
	return x * _x;    
}
  


void mainImage( out vec4 fragColor )
{
     vec2 fragCoord = gl_FragCoord.xy;
     vec2 iResolution = czm_viewport.zw;
     float iTime = (czm_frameNumber / 200.0);

	vec2 uv = fragCoord.xy / iResolution.xy;
   
  

    vec2 ouv = uv;
    uv -= vec2(0.5);
    uv.y /= iResolution.x / iResolution.y;
    vec2 _uv = uv * 0.007;
    
    // clouds 
	float x = clouds(_uv,iTime);
    // sky colors
    //  vec4 top = vec4(0.1, 0.45, 0.9, 1.0) * .6;
    //  vec4 bottom = vec4(0., 0.45, .7, 1.0) * 1.2;
 
    // vec4 top = vec4(0, 0.5, 1, 1.0) * 1.0;
    // vec4 bottom = vec4(0.7, 0.86, 0.99, 1.0) * 1.0;


    vec4 top = vec4(0.14, 0.576, 0.91, 1.0) * 1.0;
    vec4 bottom = vec4(0.7, 0.86, 0.99, 1.0) * 1.0;

     vec4 color = mix(bottom, top, smoothstep(0., .9, ouv.y));
    // vec4 color = fragColor;
    //vec4 color = vec4(0.0,0.0,0.8,1.0);
    // clouds color
    color += x;
    color = mix(vec4(x), color, 1. - x);
	
    // some fake lighting
    vec2 ld = .005 * normalize(vec2(1.0, 1.)) * fwidth(uv);
    float f = .0;
    const int steps = 14;
    for (int i = 1; i <= steps; ++i)
    {
    	float c = clouds(_uv - float(i * i) * ld,iTime) * pow(0.55, float(i));
        f += max(c, 0.0);
    }
    f = clamp(f, 0.0, 1.0);
    f = 1.0 - f;
    f = pow(f, 1.2);
    color += vec4(f) * x * .5;
    fragColor = color;  
}
`,fog01:o,cloud02:`
const mat2 m2 = mat2(0.8, 0.6, -0.6, 0.8);
const mat2 im2 = mat2(0.8, -0.6, 0.6, 0.8);

float noise(in vec2 p) {
    float res = 0.;
    float f = 1.;
    for(int i = 0; i < 3; i++) {
        p = m2 * p * f + .6;
        f *= 1.2;
        res += sin(p.x + sin(2. * p.y));
    }
    return res / 3.;
}

float fbmabs(vec2 p) {
    float f = 1.;
    float r = 0.0;
    for(int i = 0; i < 8; i++) {
        r += abs(noise(p * f) + .5) / f;
        f *= 2.;
        p = im2 * p;

    }
    return 1. - r * .5;
}

vec3 sky(in vec2 p,float time) {	
	//return sin(vec3(1.7,1.5,1.)+1.8- .9*fbmabs(p*4.-.02*time))+.2;
    return sin(vec3(1.7, 1.5, 1) + .7 + .9 * fbmabs(p * 4. - .02 * time)) + .25;
}

vec3 transform(in vec3 p) {
    p.zx = p.xz;
    p.z = -p.z;
    return p;
}

void mainImage( out vec4 fragColor )
{

    vec2 fragCoord = gl_FragCoord.xy;
    vec2 iResolution = czm_viewport.zw;
    float iTime = (czm_frameNumber / 50.0);
    vec2 iMouse = czm_iMouse;


    float time = iTime;
    vec2 p = (2.0 * fragCoord.xy - iResolution.xy) / iResolution.y;
    vec3 col = vec3(0.);
    vec3 rd = normalize(vec3(p, -2.));
    vec3 sd = rd;
    vec3 ro = vec3(0.0, 2.0, -2. + .2 * time);
    if(iMouse.y > iResolution.y * 0.125) {
        ro.xy += 2.0 * (2.0 * iMouse.xy - iResolution.xy) / iResolution.y;
        sd = normalize(vec3(p + 0.125 * (2.0 * iMouse.xy - iResolution.xy) / iResolution.y, -2.));
    }
    vec3 li = normalize(vec3(-2., 2., -4.));
    ro = transform(ro);
    rd = transform(rd);
    sd = transform(sd);

    //sky
    col = sky(sd.xz * (.1 + sd.y),time);

    fragColor.xyz = col;
}

`,cloud03:`

// Made by Darko Supe (omegasbk)

float noise(vec2 uv)
{
    return fract(sin(uv.x * 113. + uv.y * 412.) * 6339.);
}

vec3 noiseSmooth(vec2 uv)
{
    vec2 index = floor(uv);
    
    vec2 pq = fract(uv);
    pq = smoothstep(0., 1., pq);
     
    float topLeft = noise(index);
    float topRight = noise(index + vec2(1, 0.));
    float top = mix(topLeft, topRight, pq.x);
    
    float bottomLeft = noise(index + vec2(0, 1));
    float bottomRight = noise(index + vec2(1, 1));
    float bottom = mix(bottomLeft, bottomRight, pq.x);
    
    return vec3(mix(top, bottom, pq.y));
}

void mainImage( out vec4 fragColor )
{


    vec2 fragCoord = gl_FragCoord.xy;
    vec2 iResolution = czm_viewport.zw;
    float iTime = (czm_frameNumber / 50.0);
    vec2 iMouse = czm_iMouse;

    // Normalized pixel coordinates (from 0 to 1)
    vec2 uv = fragCoord/iResolution.xy;
    uv.x *= iResolution.x / iResolution.y;
    
    vec3 sky = vec3(0.5, 0.7, 0.85) * ((1. - uv.y) + 1.5) / 2.;

    
    uv += iMouse.xy / 20.;
    
    uv.x += iTime / 40.;
    
    vec2 uv2 = uv;
    uv2.x += iTime / 10.;
    
    vec2 uv3 = uv;
    uv3.x += iTime / 30.;
        
    vec3 col = noiseSmooth(uv * 4.);
    
    col += noiseSmooth(uv * 8.) * 0.5;
    col += noiseSmooth(uv2 * 16.) * 0.25;
    col += noiseSmooth(uv3 * 32.) * 0.125;
    col += noiseSmooth(uv3 * 64.) * 0.0625;
    
    
    col /= 2.;   
    
    col *= smoothstep(0.2, .6, col);   
    
    col = mix(1. - (col / 7.), sky, 1. - col);    
    
    // Output to screen
    fragColor = vec4(vec3(col),1.0);
}


`,cloud04:`
//The more layers, the higher the quality
//Try higher values if your computer can take it
#define LAYERS 70
//Draw distance of the grass
#define DISTANCE 50.

//Height darkening of grass(to approximate AO)
#define DARKNESS .15
//Darkening factor for far distance, where grass is not drawn
#define FARDARK vec3(.87,.59, .78)

//Higher values make grass blades thinner and spaced closer together
//Set to 2.0 for hilarious chubby grass blades
#define SCALING 18.
//Height of grass
#define HEIGHT 1.

//Field of view
#define FOV (3.14159/3.)

const float cloudscale = 1.6;
const float speed = 0.02;
const float clouddark = 0.5;
const float cloudlight = 0.3;
const float cloudcover = 0.2;
const float cloudalpha = 8.0;
const float skytint = 0.5;
const vec3 skycolour1 = vec3(0.2, 0.4, 0.6);
const vec3 skycolour2 = vec3(0.4, 0.7, 1.0);

const mat2 m = mat2(1.6, 1.2, -1.2, 1.6);

vec2 hash(vec2 p) {
    p = vec2(dot(p, vec2(127.1, 311.7)), dot(p, vec2(269.5, 183.3)));
    return -1.0 + 2.0 * fract(sin(p) * 43758.5453123);
}

float noise(in vec2 p) {
    const float K1 = 0.366025404; // (sqrt(3)-1)/2;
    const float K2 = 0.211324865; // (3-sqrt(3))/6;
    vec2 i = floor(p + (p.x + p.y) * K1);
    vec2 a = p - i + (i.x + i.y) * K2;
    vec2 o = (a.x > a.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0); //vec2 of = 0.5 + 0.5*vec2(sign(a.x-a.y), sign(a.y-a.x));
    vec2 b = a - o + K2;
    vec2 c = a - 1.0 + 2.0 * K2;
    vec3 h = max(0.5 - vec3(dot(a, a), dot(b, b), dot(c, c)), 0.0);
    vec3 n = h * h * h * h * vec3(dot(a, hash(i + 0.0)), dot(b, hash(i + o)), dot(c, hash(i + 1.0)));
    return dot(n, vec3(70.0));
}

float fbm(vec2 n) {
    float total = 0.0, amplitude = 0.1;
    for(int i = 0; i < 7; i++) {
        total += noise(n) * amplitude;
        n = m * n;
        amplitude *= 0.4;
    }
    return total;
}

#define HALF_PI 1.5707963267948966

float sineOut(float t) {
    return sin(t * HALF_PI);
}

float cubicOut(float t) {
    float f = t - 1.0;
    return f * f * f + 1.0;
}

float easeWhite(float x) {
    if(x > sqrt(3.) / 2.) {
        float temp = (2. * x - 2.);
        return 1. - temp * temp;
    } else {
        return x * 1.0717968;
    }
}

float easeIn(float t, float b, float strength) {
    float a = 1. / (2. * b - b * b);
    if(t <= b)
        return mix(t, a * t * t, strength);

    else
        return mix(t, mix(a * b * b, 1., (t - b) / (1. - b)), strength);
}

// -----------------------------------------------

vec4 clouds(vec2 fragCoord,float iTime,vec2 iResolution) {
    vec2 p = fragCoord.xy * 4.;
    vec2 uv = p;
    float time = iTime * speed;
    float q = fbm(uv * cloudscale * 0.5);

    //ridged noise shape
    float r = 0.0;
    uv *= cloudscale;
    uv -= q - time;
    float weight = 0.8;
    for(int i = 0; i < 11; i++) {
        r += abs(weight * noise(uv));
        uv = m * uv + time;
        weight *= i >= 6 ? .56 : .7;
    }
  //if(iMouse.z <= 0.) r -= .04;  //TRYTHIS
    r *= .984;
    //noise shape
    float f = 0.0;
    uv = p;
    uv *= cloudscale;
    uv -= q - time;
    weight = 0.7;
    for(int i = 0; i < 13; i++) {
        f += weight * noise(uv);
        uv = m * uv + time;
        weight *= 0.6;
    }

    f *= r + f;

    //noise colour
    float c = 0.0;
    time = iTime * speed * 2.0;
    uv = p * vec2(iResolution.x / iResolution.y, 1.0);
    uv *= cloudscale * 2.0;
    uv -= q - time;
    weight = 0.4;
    for(int i = 0; i < 7; i++) {
        c += weight * noise(uv);
        uv = m * uv + time;
        weight *= 0.6;
    }

    //noise ridge colour
    float c1 = 0.0;
    time = iTime * speed * 3.0;
    uv = p * vec2(iResolution.x / iResolution.y, 1.0);
    uv *= cloudscale * 3.0;
    uv -= q - time;
    weight = 0.4;
    for(int i = 0; i < 7; i++) {
        c1 += abs(weight * noise(uv));
        uv = m * uv + time;
        weight *= 0.6;
    }

    c += c1;

    vec3 skycolour = mix(skycolour2, skycolour1, 2.3 - 2. * sqrt(length(p)));
    vec3 cloudcolour = vec3(1.1, 1.1, 0.9) * clamp((clouddark + cloudlight * c), 0.0, 1.0);

    f = cloudcover + cloudalpha * f * r;

    vec3 result;

    float fc = max(0., f + c) * 2.;

    //if(iMouse.z > 0.) result = mix(skycolour, clamp(skytint * skycolour + cloudcolour, 0.0, 1.0), cubicOut(clamp((f + c)*.5, 0.0, 1.0)));
    /*else*/  result = mix(skycolour, clamp(skytint * skycolour + cloudcolour, 0.0, 1.0), easeIn(easeWhite(min(1., 1.07 * fc / (1. + fc))), .35, .65));
    return vec4(result, 1.0);
}

#define HASHSCALE (2.711651661)

#define PREVIEWSCALE (iResolution.y > 271. ? 1. : .5)


void mainImage(out vec4 fragColor) {
    vec2 iResolution = czm_viewport.zw;
    float iTime = (czm_frameNumber / 200.0);
    vec2 fragCoord = gl_FragCoord.xy;

    vec3 rd = normalize(vec3((fragCoord.xy * 2. - iResolution.xy) / iResolution.x, FOV));
    vec3 raydir = rd.xzy;
    vec3 dir2 = normalize(raydir + vec3(0., 0., .1));

    float t = 1. / dir2.z;
    vec2 uv = dir2.xy * t;


    fragColor = clouds(uv / 24.0,iTime,iResolution.xy);
     
}

`,sun01:`

vec3 skyColor( in vec3 rd )
{
    vec3 sundir = normalize( vec3(.0, .5, 1.) );
    
    float yd = min(rd.y, 0.);
    rd.y = max(rd.y, 0.);
    
    vec3 col = vec3(0.);
    
    col += vec3(.4, .4 - exp( -rd.y*20. )*.15, .0) * exp(-rd.y*9.); // Red / Green 
    col += vec3(.3, .5, .6) * (1. - exp(-rd.y*8.) ) * exp(-rd.y*.9) ; // Blue
    
    col = mix(col*1.2, vec3(.3),  1.-exp(yd*100.)); // Fog
    
    col += vec3(1.0, .8, .55) * pow( max(dot(rd,sundir),0.), 15. ) * .6; // Sun
    col += pow(max(dot(rd, sundir),0.), 150.0) *.15;
    
    return col;
}

//获取太阳的uv坐标
vec3 getSunPosition(){
    vec4 sunClipCoordinates =   czm_projection * czm_view *  vec4(czm_sunPositionWC, 1.0);
    sunClipCoordinates.xyz /= sunClipCoordinates.w;
    vec3 sunWindowCoordinates = (czm_viewportTransformation * vec4(sunClipCoordinates.xyz, 1.0)).xyz;
    return sunWindowCoordinates;
}


 void mainImage(out vec4 fragColor) {
     vec2 iResolution = czm_viewport.zw;
     float iTime = (czm_frameNumber / 50.0);
     vec2 iMouse = czm_iMouse;
     vec2 fragCoord= gl_FragCoord.xy;
    //screen coords
	vec2 q = fragCoord.xy/iResolution.xy;
	vec2 v = -1.0+2.0*q;
	v.x *= iResolution.x/iResolution.y;
	
	//camera ray
	vec3 dir = normalize( vec3(v.x, v.y+.5, 1.5) );
	
    //Scene
    vec3 col =  skyColor(reflect(dir,vec3(0.,1.,0.)))*.3;
    col = mix(col, skyColor(dir), exp(-max(-v.y*9.-4.8,0.)) );

    //Vignetting
	col *= .7 + .3*pow(q.x*q.y*(1.-q.x)*(1.-q.y)*16., .1);
        
	fragColor.xyz = col;
}


`,sun02:`
const float coeiff = 0.25;
const vec3 totalSkyLight = vec3(0.3, 0.5, 1.0);

vec3 mie(float dist, vec3 sunL){
    return max(exp(-pow(dist, 0.25)) * sunL - 0.4, 0.0);
}

vec3 getSky(vec2 uv,vec2 sunPos){
	
	// vec2 sunPos = vec2(0.5, cos(iTime * 0.3 + 3.14 * 0.564));
    
    float sunDistance = distance(uv, clamp(sunPos, -1.0, 1.0));
	
	float scatterMult = clamp(sunDistance, 0.0, 1.0);
	float sun = clamp(1.0 - smoothstep(0.01, 0.011, scatterMult), 0.0, 1.0);
	
	float dist = uv.y;
	dist = (coeiff * mix(scatterMult, 1.0, dist)) / dist;
    
    vec3 mieScatter = mie(sunDistance, vec3(1.0));
	
	vec3 color = dist * totalSkyLight;
    
    color = max(color, 0.0);
    
	color = max(mix(pow(color, 1.0 - color),
	color / (2.0 * color + 0.5 - color),
	clamp(sunPos.y * 2.0, 0.0, 1.0)),0.0)
	+ sun + mieScatter;
	
	color *=  (pow(1.0 - scatterMult, 10.0) * 10.0) + 1.0;
	
	float underscatter = distance(sunPos.y * 0.5 + 0.5, 1.0);
	
	color = mix(color, vec3(0.0), clamp(underscatter, 0.0, 1.0));
	
	return color;	
}
//获取太阳的uv坐标
vec2 getSunPosition(){
    vec4 sunClipCoordinates =   czm_projection * czm_view *  vec4(czm_sunPositionWC, 1.0);
    sunClipCoordinates.xyz /= sunClipCoordinates.w;
    vec3 sunWindowCoordinates = (czm_viewportTransformation * vec4(sunClipCoordinates.xyz, 1.0)).xyz;
    return sunWindowCoordinates.xy;
}
void mainImage(out vec4 fragColor) {
    vec2 iResolution = czm_viewport.zw;
    float iTime = (czm_frameNumber / 50.0);
    vec2 iMouse = czm_iMouse;
    vec2 fragCoord= gl_FragCoord.xy;

    vec2 uv = (gl_FragCoord.xy * 2. - iResolution.xy) / min(iResolution.x, iResolution.y);


    vec2 sunPos = vec2(0.5, cos(iTime * 0.3 + 3.14 * 0.564));

    //vec2 sunPos = getSunPosition();
    //sunPos = (sunPos * 2. - iResolution.xy) / min(iResolution.x, iResolution.y);

	vec3 color = getSky(uv,sunPos);
	
	color = color / (2.0 * color + 0.5 - color);
	
	fragColor = vec4(color, 1.0);
}


`},postProcessStages:{rainRipple:wo}};class Oa{constructor(e){this.viewer=e,this.onTickListener,this.listenerChache={}}get hours(){return Cesium.JulianDate.toDate(viewer.clock.currentTime).getHours()}set hours(e){Oa.changeHours(this.viewer,e)}get startTime(){var e=this.viewer;return Cesium.JulianDate.toDate(e.clock.startTime)}set startTime(e){let t;if(e){if(e instanceof Cesium.JulianDate)t=e;else if(e instanceof Cesium.GregorianDate)t=Cesium.JulianDate.fromGregorianDate(e);else{if(!(e instanceof Date&&e.getTime()))throw new DeveloperError("Unable To Recognize Parameters");t=Cesium.JulianDate.fromDate(e)}this.viewer.clock.startTime=t}}get endTime(){var e=this.viewer;return Cesium.JulianDate.toDate(e.clock.endTime)}set endTime(e){let t;if(e){if(e instanceof Cesium.JulianDate)t=e;else if(e instanceof Cesium.GregorianDate)t=Cesium.JulianDate.fromGregorianDate(e);else{if(!(e instanceof Date&&e.getTime()))throw new DeveloperError("Unable To Recognize Parameters");t=Cesium.JulianDate.fromDate(e)}this.viewer.clock.endTime=t}}get stopTime(){var e=this.viewer;return Cesium.JulianDate.toDate(e.clock.stopTime)}set stopTime(e){let t;if(e){if(e instanceof Cesium.JulianDate)t=e;else if(e instanceof Cesium.GregorianDate)t=Cesium.JulianDate.fromGregorianDate(e);else{if(!(e instanceof Date&&e.getTime()))throw new DeveloperError("Unable To Recognize Parameters");t=Cesium.JulianDate.fromDate(e)}this.viewer.clock.stopTime=t}}get currentTime(){var e=this.viewer;return Cesium.JulianDate.toDate(e.clock.currentTime)}set currentTime(e){let t;if(e){if(e instanceof Cesium.JulianDate)t=e;else if(e instanceof Cesium.GregorianDate)t=Cesium.JulianDate.fromGregorianDate(e);else{if(!(e instanceof Date&&e.getTime()))throw new DeveloperError("Unable To Recognize Parameters");t=Cesium.JulianDate.fromDate(e)}this.viewer.clock.currentTime=t}}get multiplier(){return this.viewer.clock.multiplier}set multiplier(e){var t=this.viewer;e&&e instanceof Number&&(t.clock.multiplier=e)}get canAnimate(){return this.viewer.clock.canAnimate}set canAnimate(e){var t=this.viewer;t.clock.canAnimate=e||!1}get shouldAnimate(){return this.viewer.clock.shouldAnimate}set shouldAnimate(e){var t=this.viewer;t.clock.shouldAnimate=e||!1}get clockRange(){return this.viewer.clock.clockRange}set clockRange(e){var t=this.viewer;let i=-1;if("UNBOUNDED"==e)i=Cesium.ClockRange.UNBOUNDED;else if("CLAMPED"==e)i=Cesium.ClockRange.CLAMPED;else{if("LOOP_STOP"!=e)throw new DeveloperError("Unable To Recognize Parameters");i=Cesium.ClockRange.LOOP_STOP}t.clock.clockRange=i}addOnTickEventListener(e,t){let i=this.viewer;i.clock.shouldAnimate=!0;var r=i.clock.onTick.addEventListener(()=>{var e=Cesium.JulianDate.toDate(i.clock.currentTime);t(e)});return this.listenerChache[e]&&this.listenerChache[e](),this.listenerChache[e]=r}removeOnTickEventListener(e){var t=this.viewer;this.listenerChache[e]&&(t.clock.shouldAnimate=!1,this.listenerChache[e]())}addOnStopEventListener(e,t){let i=this.viewer;var r=i.clock.onStop.addEventListener(()=>{var e=Cesium.JulianDate.toDate(i.clock.currentTime);t(e)});return this.listenerChache[e]&&this.listenerChache[e](),this.listenerChache[e]=r}removeOnStopEventListener(e){this.listenerChache[e]&&this.listenerChache[e]()}}Oa.morning=5,Oa.day=7,Oa.dusk=17,Oa.night=18,Oa.changeHours=function(e,t){var i=Cesium.JulianDate.toDate(e.clock.currentTime),t=(i.setHours(t),i.setMinutes(0),i.setSeconds(0),Cesium.JulianDate.fromDate(i));e.clock.currentTime=t};_n=Oa;wn=new class{constructor(){this.oldOptions,this.environment}setSceneSetting(e,t={}){this.environment||(this.environment=new Mo(e));let i;i=this.oldOptions?this._getChange(t,this.oldOptions):t,this.oldOptions=t;try{for(var r in i)i[r]&&r in this.environment&&(this.environment[r]=i[r])}catch(e){throw new Error(e)}}getSceneSettingAsJson(e,t){this.environment||(this.environment=new Mo(e));var i={};for(let e=0;e<t.length;e++){var r=t[e];this.environment[r]&&(i[r]=this.environment[r])}return JSON.stringify(i)}_getChange(t,i){var r,n={};for(r in t){let e=!1;if(Cesium.defined(t[r])&&!Cesium.defined(i[r]))e=!0;else if(Cesium.defined(t[r])&&Cesium.defined(i[r]))for(var o in t[r])Cesium.defined(t[r][o])&&!Cesium.defined(i[r][o])?e=!0:Cesium.defined(t[r][o])&&Cesium.defined(i[r][o])&&(this._equals(t[r][o],i[r][o])||(e=!0));e&&(n[r]=t[r])}return n}_equals(t,i){let r=!1;if(t instanceof Cesium.Cartesian4)Cesium.Cartesian4.equals(t,i)&&(r=!0);else if(t instanceof Cesium.Cartesian3)Cesium.Cartesian3.equals(t,i)&&(r=!0);else if(t instanceof Cesium.Cartesian2)Cesium.Cartesian2.equals(t,i)&&(r=!0);else if(t instanceof Cesium.Color)Cesium.Color.equals(t,i)&&(r=!0);else if("object"==typeof t&&"object"==typeof i){let e=!0;for(var n in t)t[n]!==i[n]&&(e=!1);r=e}else t===i&&(r=!0);return r}},Fn={sceneControl:Io,Environment:Mo,Clock:_n,sceneSetting:wn};console.log("%c             \n%cSDK版本：1.2.2\ncesium版本："+Cesium.VERSION+"\nagCloud版本：\n版权声明：Copyright©2021 All Rights Reserved 版权所有 奥格AgCIM基础研发部","font-size: 3em;background:url('http://www.augurit.com/r/cms/www/red/images/weblogo.png') no-repeat;background-size: 90%;","color:#1d6402;font-size:12px"),window.agcim={version:"1.2.2",animation:Q,camera:G,renderer:z,ui:Ze,interactive:Mt,maths:Pr.Z,geometry:Y,net:W,spatialAnalysis:Ge,utils:Tr,wfs:Lr,bim:Tt,layer:r,scene:on,crs:hn,widgets:gn,shader:yn,excesium:cn,webscene:Fn},agcim}()}();